{"title":"Python Testing Cookbook","authors":["Greg L. Turnquist & Bhaskar N. Das"],"publisher":"packt","version":1,"chapters":[{"title":"Preface","author":"","block":"k6bfv33q","number":0,"contents":[{"block_type":"element","block":"k6bfv9o7","search_text":"Python Testing Cookbook - Second Edition","text_count":40,"tag_name":"h2","attributes":{"id":"maintitle"},"children":[{"block_type":"text","content":"Python Testing Cookbook - Second Edition"}]},{"block_type":"element","block":"k6bfv9o8","search_text":"Easy solutions to test your Python projects using test-driven development and Selenium","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Easy solutions to test your Python projects using test-driven development and Selenium"}]},{"block_type":"element","block":"k6bfv9o9","search_text":"Greg L. Turnquist","text_count":17,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Greg L. Turnquist"}]},{"block_type":"element","block":"k6bfv9oa","search_text":"Bhaskar N. Das","text_count":14,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Bhaskar N. Das"}]},{"block_type":"element","block":"k6bfv9ob","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000039.jpg","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9oc","search_text":"BIRMINGHAM - MUMBAI","text_count":19,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"BIRMINGHAM - MUMBAI"}]}]}]},{"block_type":"element","block":"k6bfv9od","search_text":"Copyright © 2018 Packt Publishing","text_count":33,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Copyright &copy; 2018 Packt Publishing"}]},{"block_type":"element","block":"k6bfv9oe","search_text":"All rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews.","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews."}]},{"block_type":"element","block":"k6bfv9of","search_text":"Every effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the author(s), nor Packt Publishing or its dealers and distributors, will be held liable for any damages caused or alleged to have been caused directly or indirectly by this book.","text_count":400,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Every effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the author(s), nor Packt Publishing or its dealers and distributors, will be held liable for any damages caused or alleged to have been caused directly or indirectly by this book."}]},{"block_type":"element","block":"k6bfv9og","search_text":"Packt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information.","text_count":240,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Packt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information."}]},{"block_type":"element","block":"k6bfv9oh","search_text":"Commissioning Editor: Merint Matthew Acquisition Editor: Chaitanya Nair Content Development Editor: Rohit Singh Technical Editor: Romy Dias Copy Editor: Safis Editing Project Coordinator: Vaidehi Sawant Proofreader: Safis Editing Indexer: Pratik Shirodkar Graphics: Jason Monteiro Production Coordinator: Deepika Naik","text_count":317,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Commissioning Editor:"}]},{"block_type":"text","content":"&nbsp;Merint Matthew"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Acquisition Editor:"}]},{"block_type":"text","content":"&nbsp;Chaitanya Nair"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Content Development Editor:"}]},{"block_type":"text","content":"&nbsp;Rohit Singh"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Technical Editor:"}]},{"block_type":"text","content":"&nbsp;Romy Dias"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Copy Editor:"}]},{"block_type":"text","content":"Safis Editing"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Project Coordinator:"}]},{"block_type":"text","content":"Vaidehi Sawant"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Proofreader:"}]},{"block_type":"text","content":"Safis Editing"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Indexer:&nbsp;"}]},{"block_type":"text","content":"Pratik Shirodkar"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Graphics:"}]},{"block_type":"text","content":"Jason Monteiro"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Production Coordinator:"}]},{"block_type":"text","content":"Deepika Naik"}]},{"block_type":"element","block":"k6bfv9oi","search_text":"First published: May 2011 Second edition: June 2018","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"First published: May 2011"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Second edition: June 2018"}]},{"block_type":"element","block":"k6bfv9oj","search_text":"Production reference: 1290618","text_count":29,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Production reference: 1290618"}]},{"block_type":"element","block":"k6bfv9ok","search_text":"Published by Packt Publishing Ltd. Livery Place 35 Livery Street Birmingham B3 2PB, UK.","text_count":87,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Published by Packt Publishing Ltd."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Livery Place"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"35 Livery Street"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Birmingham"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"B3 2PB, UK."}]},{"block_type":"element","block":"k6bfv9ol","search_text":"978-1-78712-252-9","text_count":17,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"978-1-78712-252-9"}]},{"block_type":"element","block":"k6bfv9om","search_text":"www.packtpub.com","text_count":16,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packtpub.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packtpub.com"}]}]},{"block_type":"element","block":"k6bfv9on","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000030.jpg","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9oo","search_text":"mapt.io","text_count":7,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://mapt.io/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"mapt.io"}]}]},{"block_type":"element","block":"k6bfv9op","search_text":"Mapt is an online digital library that gives you full access to over 5,000 books and videos, as well as industry leading tools to help you plan your personal development and advance your career. For more information, please visit our website.","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Mapt is an online digital library that gives you full access to over 5,000 books and videos, as well as industry leading tools to help you plan your personal development and advance your career. For more information, please visit our website."}]},{"block_type":"element","block":"k6bfv9oq","search_text":"Contributors","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Contributors"}]},{"block_type":"element","block":"k6bfv9or","search_text":"About the authors","text_count":17,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"About the authors"}]},{"block_type":"element","block":"k6bfv9os","search_text":"Greg L. Turnquist has worked in the software industry since 1997. He is an active participant in the open source community and has contributed patches to several projects, including MythTV, Spring Security, MediaWiki, and the TestNG Eclipse plugin. As a test-obsessed script junky, he has always sought the right tool for the job. He is a firm believer in agile practices and automated testing. He has developed distributed systems and LAMP-based setups, and he has supported mission-critical systems hosted on various platforms. After graduating from Auburn University with a master's in computer engineering, Greg started working with the Harris Corporation. He worked on many contracts utilizing many types of technology. In 2006, he created the Spring Python project and went on to write Spring Python 1.1 in 2010. He joined SpringSource, a division of VMware in 2010, as part of its international software development team.","text_count":928,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Greg L. Turnquist"}]},{"block_type":"text","content":"&nbsp;has worked in the software industry since 1997. He is an active participant in the open source community and has contributed patches to several projects, including MythTV, Spring Security, MediaWiki, and the TestNG Eclipse plugin. As a test-obsessed script junky, he has always sought the right tool for the job. He is a firm believer in agile practices and automated testing. He has developed distributed systems and LAMP-based setups, and he has supported mission-critical systems hosted on various platforms."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"After graduating from Auburn University with a master's in computer engineering, Greg started working with the Harris Corporation. He worked on many contracts utilizing many types of technology. In 2006, he created the Spring Python project and went on to write Spring Python 1.1 in 2010. He joined SpringSource, a division of VMware in 2010, as part of its international software development team."}]},{"block_type":"element","block":"k6bfv9ot","search_text":"Bhaskar N. Das has 8 years' experience in various projects involving application development, maintenance, and support with IBM. He has worked in various technologies and domains including Java, Python, application servers, the cloud, and various database technologies. His domain expertise includes finance and asset management (IT and finance assets). His areas of interest include big data, business finance optimization and scaling, data science, and Machine Learning.","text_count":472,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Bhaskar N. Das"}]},{"block_type":"text","content":"has 8 years' experience in various projects involving application development, maintenance, and support with IBM. He has worked in various technologies and domains including Java, Python, application servers, the cloud, and various database technologies. His domain expertise includes finance and asset management (IT and finance assets). His areas of interest include big data, business finance optimization and scaling, data science, and Machine Learning."}]},{"block_type":"element","block":"k6bfv9ou","search_text":"About the reviewers","text_count":19,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"About the reviewers"}]},{"block_type":"element","block":"k6bfv9ov","search_text":"Maurice HT Ling is a Research Assistant Professor at the Perdana University School of Data Sciences. He obtained his BSc.(Hons.) in Molecular and Cell Biology from The University of Melbourne, Australia, in 2004, and his BSc. in Computing from the University of Portsmouth, United Kingdom, in 2007, before obtaining his Ph.D. in Bioinformatics from The University of Melbourne, Australia, in 2009. He is a bioinformatician who is currently working on looking at evolutionary biology and various aspects of life. His main techniques involve experimental evolution and simulations, such as artificial life simulation, for accessing evolutionary perspectives, and using existing published data. He has developed computational algorithms as part of this research. He has a wide range of other interests, including professional and social aspects of science and education, and studies this area using autoethnographical and autobiographical methods. He co-founded Python User Group (Singapore), and has been instrumental in inaugurating PyCon Asia-Pacific as one of the 3 major Python conferences worldwide, together with PyCon US and EuroPython. On the commercial side, he is the principal partner of Colossus Technologies LLP, Singapore. In his free time, he likes to read, enjoy a cup of coffee, writing his personal journal, or philosophizing on various aspects of life.","text_count":1369,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Maurice HT Ling"}]},{"block_type":"text","content":"is a Research Assistant Professor at the Perdana University School of Data Sciences. He obtained his BSc.(Hons.) in Molecular and Cell Biology from The University of Melbourne, Australia, in 2004, and his BSc. in Computing from the University of Portsmouth, United Kingdom, in 2007, before obtaining his Ph.D. in Bioinformatics from The University of Melbourne, Australia, in 2009. He is a bioinformatician who is currently working on looking at evolutionary biology and various aspects of life. His main techniques involve experimental evolution and simulations, such as artificial life simulation, for accessing evolutionary perspectives, and using existing published data. He has developed computational algorithms as part of this research. He has a wide range of other interests, including professional and social aspects of science and education, and studies this area using autoethnographical and autobiographical methods. He co-founded Python User Group (Singapore), and has been instrumental in inaugurating PyCon Asia-Pacific as one of the 3 major Python conferences worldwide, together with PyCon US and EuroPython. On the commercial side, he is the principal partner of Colossus Technologies LLP, Singapore. In his free time, he likes to read, enjoy a cup of coffee, writing his personal journal, or philosophizing on various aspects of life."}]},{"block_type":"element","block":"k6bfv9ow","search_text":"Packt is searching for authors like you","text_count":39,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Packt is searching for authors like you"}]},{"block_type":"element","block":"k6bfv9ox","search_text":"If you're interested in becoming an author for Packt, please visit authors.packtpub.com and apply today. We have worked with thousands of developers and tech professionals, just like you, to help them share their insight with the global tech community. You can make a general application, apply for a specific hot topic that we are recruiting an author for, or submit your own idea.","text_count":382,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you're interested in becoming an author for Packt, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://authors.packtpub.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"authors.packtpub.com"}]},{"block_type":"text","content":"and apply today. We have worked with thousands of developers and tech professionals, just like you, to help them share their insight with the global tech community. You can make a general application, apply for a specific hot topic that we are recruiting an author for, or submit your own idea."}]},{"block_type":"element","block":"k6bfv9oy","search_text":"Preface","text_count":7,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Preface"}]},{"block_type":"element","block":"k6bfv9oz","search_text":"Testing has always been part of software development. For decades, comprehensive testing was defined by complex manual test procedures backed by big budgets; but something revolutionary happened in 1998. In his Guide to Better Smalltalk, Smalltalk guru, Kent Beck, introduced an automated test framework called SUnit. This triggered an avalanche of test frameworks, including JUnit, PyUnit, and many others for different languages and various platforms, dubbed the xUnit movement. Automated testing was made a cornerstone of the agile movement when the top 17 software experts signed the Agile Manifesto in 2001.","text_count":612,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Testing has always been part of software development. For decades, comprehensive testing was defined by complex manual test procedures backed by big budgets; but something revolutionary happened in 1998. In his Guide to Better Smalltalk, Smalltalk guru, Kent Beck, introduced an automated test framework called SUnit. This triggered an avalanche of test frameworks, including JUnit, PyUnit, and many others for different languages and various platforms, dubbed the xUnit movement. Automated testing was made a cornerstone of the agile movement when the top 17 software experts signed the Agile Manifesto in 2001."}]},{"block_type":"element","block":"k6bfv9p0","search_text":"Testing includes many different styles, including unit testing, integration testing, acceptance testing, smoke testing, load testing, and countless others. This book delves deeper and explores testing at all the important levels while using the nimble power of Python. It also demonstrates many tools.","text_count":301,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Testing includes many different styles, including unit testing, integration testing, acceptance testing, smoke testing, load testing, and countless others. This book delves deeper and explores testing at all the important levels while using the nimble power of Python. It also demonstrates many tools."}]},{"block_type":"element","block":"k6bfv9p1","search_text":"This book is meant to expand your knowledge of testing from something you either heard about, or have practiced a little, into something you can apply at any level to meet your needs in improving software quality. We hope to give you the tools to reap huge rewards in better software development and customer satisfaction.","text_count":322,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This book is meant to expand your knowledge of testing from something you either heard"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"about, or have practiced a little, into something you can apply at any level to meet your needs in improving software quality. We hope to give you the tools to reap huge rewards in better software development and customer satisfaction."}]},{"block_type":"element","block":"k6bfv9p2","search_text":"Who this book is for","text_count":20,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Who this book is for"}]},{"block_type":"element","block":"k6bfv9p3","search_text":"If you're a Python developer who wants to take testing to the next level and would like to expand your testing skills, this book is for you. It is assumed that you have some Python programming knowledge.","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you're a Python developer who wants to take testing to the next level and would like to expand your testing skills, this book is for you. It is assumed that you have some Python programming knowledge."}]},{"block_type":"element","block":"k6bfv9p4","search_text":"What this book covers","text_count":21,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"What this book covers"}]},{"block_type":"element","block":"k6bfv9p5","search_text":"Chapter 1, Using Unittest to Develop Basic Tests , gives you a quick introduction to the most commonly used test framework in the Python community.","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic Tests"}]},{"block_type":"text","content":", gives you a quick introduction to the most commonly used test framework in the Python community."}]},{"block_type":"element","block":"k6bfv9p6","search_text":"Chapter 2, Running Automated Test Suites with Nose , introduces the most ubiquitous Python test tool and gets busy by showing you how to write specialized plugins.","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 2,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Running Automated Test Suites with Nose"}]},{"block_type":"text","content":", introduces the most ubiquitous Python test tool and gets busy by showing you how to write specialized plugins."}]},{"block_type":"element","block":"k6bfv9p7","search_text":"Chapter 3, Creating Testable Documentation with doctest , shows many different ways of using Python's docstrings to build runnable doctests as well as write custom test runners.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 3,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating Testable Documentation with doctest"}]},{"block_type":"text","content":", shows many different ways of using Python's docstrings to build runnable doctests as well as write custom test runners."}]},{"block_type":"element","block":"k6bfv9p8","search_text":"Chapter 4, Testing Customer Stories with Behavior-Driven Development, dives into writing easy-to-read testable customer stories using doctest, mocking, and Lettuce/Should DSL.","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 4,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing Customer Stories with Behavior-Driven Development,"}]},{"block_type":"text","content":"dives into writing easy-to-read testable customer stories using doctest, mocking, and Lettuce/Should DSL."}]},{"block_type":"element","block":"k6bfv9p9","search_text":"Chapter 5, High Level Customer Scenarios with Acceptance Testing , helps you get into the mindset of the customer and write tests from their perspective using Pyccuracy and the Robot Framework.","text_count":193,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 5,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"High Level Customer Scenarios with Acceptance Testing"}]},{"block_type":"text","content":", helps you get into the mindset of the customer and write tests from their perspective using Pyccuracy and the Robot Framework."}]},{"block_type":"element","block":"k6bfv9pa","search_text":"Chapter 6, Integrating Automated Tests with Continuous Integration , shows you how to add continuous integration to your development process with Jenkins and TeamCity.","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 6,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Integrating Automated Tests with Continuous Integration"}]},{"block_type":"text","content":", shows you how to add continuous integration to your development process with Jenkins and TeamCity."}]},{"block_type":"element","block":"k6bfv9pb","search_text":"Chapter 7, Measuring your Success with Test Coverage , explores how to create coverage reports and interpret them correctly. It also delves deeper in terms of seeing how to tie them in with your continuous integration system.","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 7,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Measuring your Success with Test Coverage"}]},{"block_type":"text","content":", explores how to create coverage reports and interpret them correctly. It also delves deeper in terms of seeing how to tie them in with your continuous integration system."}]},{"block_type":"element","block":"k6bfv9pc","search_text":"Chapter 8, Smoke/Load Testing – Testing Major Parts, focuses on how to create smoke test suites to get a pulse from the system. It also demonstrates how to put the system under load in order to ensure that it can handle the current load as well as find the next breaking point for future loads.","text_count":294,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 8,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Smoke/Load Testing&nbsp;&ndash; Testing Major Parts,"}]},{"block_type":"text","content":"focuses on how to create smoke test suites to get a pulse from the system. It also demonstrates how to put the system under load in order to ensure that it can handle the current load as well as find the next breaking point for future loads."}]},{"block_type":"element","block":"k6bfv9pd","search_text":"Chapter 9, Good Test Habits for New and Legacy Systems , takes you through many different lessons learned from the author about what works when it comes to software testing.","text_count":173,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 9,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Good Test Habits for New and Legacy Systems"}]},{"block_type":"text","content":", takes you through many different lessons learned from the author about what works when it comes to software testing."}]},{"block_type":"element","block":"k6bfv9pe","search_text":"Chapter 10 , Web UI Tesing Using Selenium , teaches you how to write suitable test sets for their software. It will explain the various test sets and frameworks to use. This chapter is not available in the book, it is available online in the following link: https://www.packtpub.com/sites/default/files/downloads/Web_UI_Testing_Using_Selenium.pdf","text_count":346,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Chapter 10"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Web UI Tesing Using Selenium"}]},{"block_type":"text","content":", teaches you how to write suitable test sets for their software. It will explain the various test sets and frameworks to use. This chapter is not available in the book, it is available online in the following link:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.packtpub.com/sites/default/files/downloads/Web_UI_Testing_Using_Selenium.pdf"},"children":[{"block_type":"text","content":"https://www.packtpub.com/sites/default/files/downloads/Web_UI_Testing_Using_Selenium.pdf"}]}]},{"block_type":"element","block":"k6bfv9pf","search_text":"To get the most out of this book","text_count":32,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"To get the most out of this book"}]},{"block_type":"element","block":"k6bfv9pg","search_text":"You will need Python installed on your machine. This book uses many other Python test tools but includes detailed steps showing how to install and use them.","text_count":156,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You will need Python installed on your machine. This book uses many other Python test tools but includes detailed steps showing how to install and use them."}]},{"block_type":"element","block":"k6bfv9ph","search_text":"Download the example code files","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Download the example code files"}]},{"block_type":"element","block":"k6bfv9pi","search_text":"You can download the example code files for this book from your account at www.packtpub.com . If you purchased this book elsewhere, you can visit www.packtpub.com/support and register to have the files emailed directly to you.","text_count":226,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can download the example code files for this book from your account at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packtpub.com"},"children":[{"block_type":"text","content":"www.packtpub.com"}]},{"block_type":"text","content":". If you purchased this book elsewhere, you can visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packtpub.com/support","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packtpub.com/support"}]},{"block_type":"text","content":"and register to have the files emailed directly to you."}]},{"block_type":"element","block":"k6bfv9pj","search_text":"You can download the code files by following these steps:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can download the code files by following these steps:"}]},{"block_type":"element","block":"k6bfv9pk","search_text":"Log in or register at www.packtpub.com . Select the SUPPORT tab. Click on Code Downloads & Errata. Enter the name of the book in the Search box and follow the onscreen instructions. ","text_count":182,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Log in or register at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packtpub.com/support","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packtpub.com"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select the SUPPORT tab."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Code Downloads &amp; Errata."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter the name of the book in the Search box and follow the onscreen instructions."}]}]},{"block_type":"element","block":"k6bfv9pl","search_text":"Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:"}]},{"block_type":"element","block":"k6bfv9pm","search_text":"WinRAR/7-Zip for Windows Zipeg/iZip/UnRarX for Mac 7-Zip/PeaZip for Linux ","text_count":74,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"WinRAR/7-Zip for Windows"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Zipeg/iZip/UnRarX for Mac"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"7-Zip/PeaZip for Linux"}]}]},{"block_type":"element","block":"k6bfv9pn","search_text":"The code bundle for the book is also hosted on GitHub at https://github.com/PacktPublishing/Python-Testing-Cookbook-Second-Edition . We also have other code bundles from our rich catalog of books and videos available at https://github.com/PacktPublishing/ . Check them out!","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code bundle for the book is also hosted on GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Testing-Cookbook-Second-Edition"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Testing-Cookbook-Second-Edition"}]},{"block_type":"text","content":". We also have other code bundles from our rich catalog of books and videos available at"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/"}]}]},{"block_type":"text","content":". Check them out!"}]},{"block_type":"element","block":"k6bfv9po","search_text":"Conventions used","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Conventions used"}]},{"block_type":"element","block":"k6bfv9pp","search_text":"There are a number of text conventions used throughout this book.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are a number of text conventions used throughout this book."}]},{"block_type":"element","block":"k6bfv9pq","search_text":"CodeInText : Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: \"You can also use pip install virtualenv as well.\"","text_count":233,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CodeInText"}]},{"block_type":"text","content":": Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example:&nbsp;\"You can also use&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install virtualenv"}]},{"block_type":"text","content":"&nbsp;as well.\""}]},{"block_type":"element","block":"k6bfv9pr","search_text":"A block of code is set as follows:","text_count":34,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A block of code is set as follows:"}]},{"block_type":"element","block":"k6bfv9ps","search_text":"if __name__== \"__main__\": suite = unittest.TestLoader().loadTestsFromTestCase(\\ RomanNumeralConverterTest) unittest.TextTestRunner(verbosity=2).run(suite) ","text_count":155,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__== \"__main__\": \n    suite = unittest.TestLoader().loadTestsFromTestCase(\\\n              RomanNumeralConverterTest) \n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9pt","search_text":"When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we wish to draw your attention to a particular part of a code block, the relevant lines or items are set in bold:"}]},{"block_type":"element","block":"k6bfv9pu","search_text":"def test_bad_inputs(self): r = self.cvt.convert_to_roman d = self.cvt.convert_to_decimal edges = [(\"equals\", r, \"\", None),\\ ","text_count":124,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_bad_inputs(self): \n    r = self.cvt.convert_to_roman \n    d = self.cvt.convert_to_decimal \n    edges = [(\"equals\", r, \"\", None),\\"}]}]},{"block_type":"element","block":"k6bfv9pv","search_text":"Any command-line input or output is written as follows:","text_count":55,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Any command-line input or output is written as follows:"}]},{"block_type":"element","block":"k6bfv9pw","search_text":"$ python recipe3.py","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python recipe3.py"}]}]},{"block_type":"element","block":"k6bfv9px","search_text":"Bold : Indicates a new term, an important word, or words that you see on screen. For example, words in menus or dialog boxes appear in the text like this. Here is an example: \"Pick a class to test. This is known as the class under test .\"","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Bold"}]},{"block_type":"text","content":": Indicates a new term, an important word, or words that you see on screen. For example, words in menus or dialog boxes appear in the text like this. Here is an example: \"Pick a class to test. This is known as the&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"class under test"}]},{"block_type":"text","content":".\""}]},{"block_type":"element","block":"k6bfv9py","search_text":"Note Warnings or important notes appear like this. ","text_count":51,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Warnings or important notes appear like this."}]}]},{"block_type":"element","block":"k6bfv9pz","search_text":"Tip Tips and tricks appear like this. ","text_count":38,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Tips and tricks appear like this."}]}]},{"block_type":"element","block":"k6bfv9q0","search_text":"Sections","text_count":8,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Sections"}]},{"block_type":"element","block":"k6bfv9q1","search_text":"In this book, you will find several headings that appear frequently ( Getting ready , How to do it... , How it works... , There's more... , and See also ).","text_count":155,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this book, you will find several headings that appear frequently ("},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfv9q2","search_text":"To give clear instructions on how to complete a recipe, use these sections as follows:","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To give clear instructions on how to complete a recipe, use these sections as follows:"}]},{"block_type":"element","block":"k6bfv9q3","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfv9q4","search_text":"This section tells you what to expect in the recipe and describes how to set up any software or any preliminary settings required for the recipe.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section tells you what to expect in the recipe and describes how to set up any software or any preliminary settings required for the recipe."}]},{"block_type":"element","block":"k6bfv9q5","search_text":"How to do it…","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"element","block":"k6bfv9q6","search_text":"This section contains the steps required to follow the recipe.","text_count":62,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section contains the steps required to follow the recipe."}]},{"block_type":"element","block":"k6bfv9q7","search_text":"How it works…","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works&hellip;"}]},{"block_type":"element","block":"k6bfv9q8","search_text":"This section usually consists of a detailed explanation of what happened in the previous section.","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section usually consists of a detailed explanation of what happened in the previous section."}]},{"block_type":"element","block":"k6bfv9q9","search_text":"There's more…","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more&hellip;"}]},{"block_type":"element","block":"k6bfv9qa","search_text":"This section includes of additional information about the recipe in order to make you more knowledgeable about the recipe.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section includes of additional information about the recipe in order to make you more knowledgeable about the recipe."}]},{"block_type":"element","block":"k6bfv9qb","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfv9qc","search_text":"This section provides helpful links to other useful information for the recipe.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section provides helpful links to other useful information for the recipe."}]},{"block_type":"element","block":"k6bfv9qd","search_text":"Get in touch","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Get in touch"}]},{"block_type":"element","block":"k6bfv9qe","search_text":"Feedback from our readers is always welcome.","text_count":44,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Feedback from our readers is always welcome."}]},{"block_type":"element","block":"k6bfv9qf","search_text":"General feedback : Email feedback@packtpub.com and mention the book title in the subject of your message. If you have questions about any aspect of this book, please email us at questions@packtpub.com .","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"General feedback"}]},{"block_type":"text","content":": Email"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feedback@packtpub.com"}]},{"block_type":"text","content":"&nbsp;and mention the book title in the subject of your message. If you have questions about any aspect of this book, please email us at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"questions@packtpub.com"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9qg","search_text":"Errata : Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit www.packtpub.com/submit-errata , selecting your book, clicking on the Errata Submission Form link, and entering the details.","text_count":334,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Errata"}]},{"block_type":"text","content":": Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packtpub.com/submit-errata","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packtpub.com/submit-errata"}]},{"block_type":"text","content":", selecting your book, clicking on the Errata Submission Form link, and entering the details."}]},{"block_type":"element","block":"k6bfv9qh","search_text":"Piracy : If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at copyright@packtpub.com with a link to the material.","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Piracy"}]},{"block_type":"text","content":": If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"copyright@packtpub.com"}]},{"block_type":"text","content":"with a link to the material."}]},{"block_type":"element","block":"k6bfv9qi","search_text":"If you are interested in becoming an author : If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit authors.packtpub.com .","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"If you are interested in becoming an author"}]},{"block_type":"text","content":": If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://authors.packtpub.com/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"authors.packtpub.com"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9qj","search_text":"Reviews","text_count":7,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Reviews"}]},{"block_type":"element","block":"k6bfv9qk","search_text":"Please leave a review. Once you have read and used this book, why not leave a review on the site that you purchased it from? Potential readers can then see and use your unbiased opinion to make purchase decisions, we at Packt can understand what you think about our products, and our authors can see your feedback on their book. Thank you!","text_count":339,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please leave a review. Once you have read and used this book, why not leave a review on the site that you purchased it from? Potential readers can then see and use your unbiased opinion to make purchase decisions, we at Packt can understand what you think about our products, and our authors can see your feedback on their book. Thank you!"}]},{"block_type":"element","block":"k6bfv9ql","search_text":"For more information about Packt, please visit packtpub.com .","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more information about Packt, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.packtpub.com/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"packtpub.com"}]},{"block_type":"text","content":"."}]}]},{"title":"Using Unittest to Develop Basic Tests","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv38n","number":1,"contents":[{"block_type":"element","block":"k6bfv9qm","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k6bfv9qn","search_text":"Asserting the basics Setting up and tearing down a test harness Running test cases from the command line Running a subset of test case methods Chaining together a suite of tests Defining test suites inside the test module Retooling old test code to run inside unittest Breaking down obscure tests into simple ones Testing the edges Testing corner cases by iteration ","text_count":366,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Asserting the basics"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Setting up and tearing down a test harness"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Running test cases from the command line"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Running a subset of test case methods"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Chaining together a suite of tests"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Defining test suites inside the test module"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retooling old test code to run inside unittest"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Breaking down obscure tests into simple ones"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing corner cases by iteration"}]}]},{"block_type":"element","block":"k6bfv9qo","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfv9qp","search_text":"Testing has always been a part of software development. However, the world was introduced to a new concept called automated testing when Kent Beck and Erich Gamma introduced JUnit for Java development ( http://junit.org ). It was based on Kent's earlier work with Smalltalk and automated testing . Currently, automated testing has become a well-accepted concept in the software industry.","text_count":387,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Testing has always been a part of software development. However, the world was introduced to a new concept called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"automated testing"}]},{"block_type":"text","content":"when Kent Beck and Erich Gamma introduced JUnit for Java development ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://junit.org"},"children":[{"block_type":"text","content":"http://junit.org"}]},{"block_type":"text","content":"). It was based on Kent's earlier work with Smalltalk and automated testing"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.xprogramming.com/testfram.htm)"},"children":[{"block_type":"text","content":"."}]},{"block_type":"text","content":"Currently, automated testing has become a well-accepted concept in the software industry."}]},{"block_type":"element","block":"k6bfv9qq","search_text":"A Python version, originally dubbed PyUnit , was created in 1999 and added to Python's standard set of libraries later in 2001 in Python 2.1. Currently, the PyUnit library is available for both versions of Python, that is, 2.7 ( https://docs.python.org/2.7/library/unittest.html ) and 3.x ( https://docs.python.org/3.6/library/unittest.html ). Since then, the Python community has referred to it as unittest , the name of the library imported into the test code.","text_count":462,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A Python version, originally dubbed"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"PyUnit"}]},{"block_type":"text","content":", was created in 1999 and added to Python's standard set of libraries later in 2001 in Python 2.1. Currently, the PyUnit library is available for both versions of Python, that is, 2.7 ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/2.7/library/unittest.html"},"children":[{"block_type":"text","content":"https://docs.python.org/2.7/library/unittest.html"}]},{"block_type":"text","content":") and 3.x ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.6/library/unittest.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3.6/library/unittest.html"}]},{"block_type":"text","content":"). Since then, the Python community has referred to it as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"unittest"}]},{"block_type":"text","content":", the name of the library imported into the test code."}]},{"block_type":"element","block":"k6bfv9qr","search_text":"Unittest is the foundation of automated testing in the Python world. In this chapter, we will explore the basics of testing and asserting code functionality, building suites of tests, test situations to avoid, and finally testing edges and corner cases.","text_count":253,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest is the foundation of automated testing in the Python world. In this chapter, we will explore the basics of testing and asserting code functionality, building suites of tests, test situations to avoid, and finally testing edges and corner cases."}]},{"block_type":"element","block":"k6bfv9qs","search_text":"For all the recipes in this chapter, we will use virtualenv ( https://pypi.python.org/pypi/virtualenv ) to create a controlled Python runtime environment. Unittest is part of the standard library, which requires no extra installation steps. But in later chapters, using virtualenv will allow us to conveniently install other test tools, without cluttering up our default Python installation. The steps to install virtualenv are as follows:","text_count":439,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For all the recipes in this chapter, we will use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pypi.python.org/pypi/virtualenv"},"children":[{"block_type":"text","content":"https://pypi.python.org/pypi/virtualenv"}]},{"block_type":"text","content":") to create a controlled Python runtime environment. Unittest is part of the standard library, which requires no extra installation steps. But in later chapters, using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"will allow us to conveniently install other test tools, without cluttering up our default Python installation. The steps to install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"are as follows:"}]},{"block_type":"element","block":"k6bfv9qt","search_text":"To install virtualenv , either download it from the site mentioned previously or if you have Easy Install, just type: easy_install virtualenv . You can also use pip install virtualenv as well. ","text_count":193,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":", either download it from the site mentioned previously or if you have Easy Install, just type:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"easy_install virtualenv"}]},{"block_type":"text","content":". You can also use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install virtualenv"}]},{"block_type":"text","content":"as well."}]}]},{"block_type":"element","block":"k6bfv9qu","search_text":"Note For some systems, you may need to install it either as root or by using sudo . ","text_count":84,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For some systems, you may need to install it either as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"root"}]},{"block_type":"text","content":"or by using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sudo"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfv9qv","search_text":"After installing virtualenv , use it to create a clean environment named ptc (an abbreviation used for Python Testing Cookbook ) by using --no-site-packages . Activate the virtual Python environment. This can vary, depending on which shell you are using. Take a look at this screenshot: For the Windows platform, you can either select the folder where you want to create the ptc folder or you can directly get it created in your desired drive. Look at this screenshot: Finally, verify that the environment is active by checking the path of pip . ","text_count":546,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"After installing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":", use it to create a clean environment named&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ptc"}]},{"block_type":"text","content":"&nbsp;(an abbreviation used for"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Python Testing Cookbook"}]},{"block_type":"text","content":") by using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--no-site-packages"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Activate the virtual Python environment. This can vary, depending on which shell you are using. Take a look at this screenshot:"},{"block_type":"element","tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000020.png","class":"lazyload"},"children":[]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For the Windows platform, you can either select the folder where you want to create the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ptc"}]},{"block_type":"text","content":"folder or you can directly get it created in your desired drive. Look at this screenshot:"},{"block_type":"element","tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000010.png","class":"lazyload"},"children":[]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, verify that the environment is active by checking the path of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfv9qw","search_text":"Note For more information on the usage and benefits of virtualenv , please read http://iamzed.com/2009/05/07/a-primer-on-virtualenv . ","text_count":134,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more information on the usage and benefits of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":", please read&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://iamzed.com/2009/05/07/a-primer-on-virtualenv"},"children":[{"block_type":"text","content":"http://iamzed.com/2009/05/07/a-primer-on-virtualenv"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfv9qx","search_text":"Asserting the basics","text_count":20,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Asserting the basics"}]},{"block_type":"element","block":"k6bfv9qy","search_text":"The basic concept of an automated unittest test case is to instantiate part of our code, subject it to operations, and verify certain results using assertions:","text_count":159,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic concept of an automated unittest test case is to instantiate part of our code, subject it to operations, and verify certain results using assertions:"}]},{"block_type":"element","block":"k6bfv9qz","search_text":"If the results are as expected, unittest counts it as a test success If the results don't match, an exception is thrown, and unittest counts it as a test failure ","text_count":162,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If the results are as expected, unittest counts it as a test success"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If the results don't match, an exception is thrown, and unittest counts it as a test failure"}]}]},{"block_type":"element","block":"k6bfv9r0","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfv9r1","search_text":"Unittest was added to Python's standard batteries included library suite and doesn't require any extra installation.","text_count":116,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest was added to Python's standard batteries included library suite and doesn't require any extra installation."}]},{"block_type":"element","block":"k6bfv9r2","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9r3","search_text":"With these steps, we will code a simple program and then write some automated tests using unittest:","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will code a simple program and then write some automated tests using unittest:"}]},{"block_type":"element","block":"k6bfv9r4","search_text":"Create a new file called recipe1.py for this recipe's code. Pick a class to test. This is known as the class under test . For this recipe, we'll pick a class that uses a simplistic Roman numeral converter: ","text_count":206,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe1.py"}]},{"block_type":"text","content":"for this recipe's code. Pick a class to test. This is known as the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"class under test"}]},{"block_type":"text","content":". For this recipe, we'll pick a class that uses a simplistic Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9r5","search_text":"class RomanNumeralConverter(object): def __init__ (self, roman_numeral): self.roman_numeral = roman_numeral self.digit_map = {\"M\":1000, \"D\":500,\"C\":100,\\ \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self): val = 0 for char in self.roman_numeral: val += self.digit_map[char] return val ","text_count":293,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object):\n    def __init__ (self, roman_numeral): \n        self.roman_numeral = roman_numeral \n        self.digit_map = {\"M\":1000, \"D\":500,\"C\":100,\\\n                         \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n     def convert_to_decimal(self): \n        val = 0 \n        for char in self.roman_numeral: \n            val += self.digit_map[char] \n        return val"}]}]},{"block_type":"element","block":"k6bfv9r6","search_text":"Note This Roman numeral converter applies the simple rules of addition, but it doesn't have the special subtraction patterns such as XL mapping to 40 . The purpose is not to have the best Roman numeral converter, but to observe the various test assertions. ","text_count":257,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This Roman numeral converter applies the simple rules of addition, but it doesn't have the special subtraction patterns such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"XL"}]},{"block_type":"text","content":"mapping to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"40"}]},{"block_type":"text","content":". The purpose is not to have the best Roman numeral converter, but to observe the various test assertions."}]}]},{"block_type":"element","block":"k6bfv9r7","search_text":"Write a new class and give it the same name with Test appended to the end, subclassing unittest.TestCase . Appending a test class with Test is a common convention, but not a requirement. Extending unittest.TestCase is a requirement needed to hook into unittest's standard test runner: ","text_count":285,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a new class and give it the same name with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"appended to the end, subclassing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.TestCase"}]},{"block_type":"text","content":". Appending a test class with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"is a common convention, but not a requirement. Extending"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.TestCase"}]},{"block_type":"text","content":"is a requirement needed to hook into unittest's standard test runner:"}]}]},{"block_type":"element","block":"k6bfv9r8","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): ","text_count":68,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nclass RomanNumeralConverterTest(unittest.TestCase):"}]}]},{"block_type":"element","block":"k6bfv9r9","search_text":"Create several methods with names starting with test , so they are automatically picked up by the test number of unittest: ","text_count":123,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create several methods with names starting with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":", so they are automatically picked up by the test number of unittest:"}]}]},{"block_type":"element","block":"k6bfv9ra","search_text":"def test_parsing_millenia(self): value =RomanNumeralConverter(\"M\") self.assertEqual(1000, value.convert_to_decimal()) def test_parsing_century(self): value =RomanNumeralConverter(\"C\") self.assertEqual(100, value.convert_to_decimal()) def test_parsing_half_century(self): value =RomanNumeralConverter(\"L\") self.assertEqual(50, value.convert_to_decimal()) def test_parsing_decade(self): value =RomanNumeralConverter(\"X\") self.assertEqual(10, value.convert_to_decimal()) def test_parsing_half_decade(self): value =RomanNumeralConverter(\"V\") self.assertEqual(5, value.convert_to_decimal()) def test_parsing_one(self): value = RomanNumeralConverter(\"I\") self.assertEqual(1, value.convert_to_decimal()) def test_empty_roman_numeral(self): value =RomanNumeralConverter(\"\") self.assertTrue(value.convert_to_decimal() == 0) self.assertFalse(value.convert_to_decimal() > 0) def test_no_roman_numeral(self): value =RomanNumeralConverter(None) self.assertRaises(TypeError, value.convert_to_decimal) ","text_count":987,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_parsing_millenia(self):\n        value =RomanNumeralConverter(\"M\") \n        self.assertEqual(1000, value.convert_to_decimal()) \n     def test_parsing_century(self): \n        value =RomanNumeralConverter(\"C\") \n        self.assertEqual(100, value.convert_to_decimal()) \n     def test_parsing_half_century(self): \n        value =RomanNumeralConverter(\"L\") \n        self.assertEqual(50, value.convert_to_decimal()) \n     def test_parsing_decade(self): \n        value =RomanNumeralConverter(\"X\") \n        self.assertEqual(10, value.convert_to_decimal()) \n     def test_parsing_half_decade(self): \n        value =RomanNumeralConverter(\"V\") \n        self.assertEqual(5, value.convert_to_decimal()) \n     def test_parsing_one(self): \n        value = RomanNumeralConverter(\"I\") \n        self.assertEqual(1, value.convert_to_decimal()) \n     def test_empty_roman_numeral(self): \n        value =RomanNumeralConverter(\"\") \n        self.assertTrue(value.convert_to_decimal() == 0) \n        self.assertFalse(value.convert_to_decimal() &gt; 0) \n     def test_no_roman_numeral(self): \n        value =RomanNumeralConverter(None) \n        self.assertRaises(TypeError, value.convert_to_decimal)"}]}]},{"block_type":"element","block":"k6bfv9rb","search_text":"Make the entire script runnable and then use unittest's test runner: ","text_count":69,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make the entire script runnable and then use unittest's test runner:"}]}]},{"block_type":"element","block":"k6bfv9rc","search_text":"if __name__==\"__main__\": unittest.main()","text_count":40,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__==\"__main__\": \n    unittest.main()"}]}]},{"block_type":"element","block":"k6bfv9rd","search_text":"Run the file from the command line, as shown in this screenshot: ","text_count":65,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the file from the command line, as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9re","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000156.jpg","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9rf","search_text":"Note self.assertEquals() has been deprecated in Python 3. ","text_count":58,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self.assertEquals()"}]},{"block_type":"text","content":"has been deprecated in Python 3."}]}]},{"block_type":"element","block":"k6bfv9rg","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9rh","search_text":"In the first step, we picked a class to test. Next, we created a separate class to test. By naming the test class as [class under test]Test , it is easy to tell which class is under test. Each test method name must start with test , so that unittest will automatically pick it up and run it. To add more tests, just define more test methods. Each of these tests utilizes various assertions:","text_count":390,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the first step, we picked a class to test. Next, we created a separate class to test. By naming the test class as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[class under test]Test"}]},{"block_type":"text","content":", it is easy to tell which class is under test. Each test method name must start with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":", so that unittest will automatically pick it up and run it. To add more tests, just define more"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":"methods. Each of these tests utilizes various assertions:"}]},{"block_type":"element","block":"k6bfv9ri","search_text":"assertEqual(first, second[, msg]) : Compares first and second expressions and fails if they don't have the same value. We can optionally print a special message if there is a failure. assertTrue(expression[, msg]) : Tests the expression and fails if it is false. We can optionally print a special message if there is a failure. assertFalse(expression[, msg]) : Tests the expression and fails if it is true. We can optionally print a special message if there is a failure. assertRaises(exception, callable, ...) : Runs the callable with any arguments, for the callable listed afterwards, and fails if it doesn't raise the exception. ","text_count":632,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertEqual(first, second[, msg])"}]},{"block_type":"text","content":": Compares first and second expressions and fails if they don't have the same value. We can optionally print a special message if there is a failure."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertTrue(expression[, msg])"}]},{"block_type":"text","content":": Tests the expression and fails if it is false. We can optionally print a special message if there is a failure."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertFalse(expression[, msg])"}]},{"block_type":"text","content":": Tests the expression and fails if it is true. We can optionally print a special message if there is a failure."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertRaises(exception, callable, ...)"}]},{"block_type":"text","content":": Runs the callable with any arguments, for the callable listed afterwards, and fails if it doesn't raise the exception."}]}]},{"block_type":"element","block":"k6bfv9rj","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9rk","search_text":"Unittest provides many options for asserting, failing, and other convenient options. The following sections show some recommendations on how to pick and choose from these options.","text_count":179,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest provides many options for asserting, failing, and other convenient options. The following sections show some recommendations on how to pick and choose from these options."}]},{"block_type":"element","block":"k6bfv9rl","search_text":"assertEquals is preferred over assertTrue and assertFalse","text_count":57,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"assertEquals is preferred over assertTrue and assertFalse"}]},{"block_type":"element","block":"k6bfv9rm","search_text":"When an assertEquals assertion fails, the first and second values are printed in the error report, giving a better feedback of what went wrong, whereas assertTrue and assertFalse simply report failure. Not all testable results fit this, but, if possible, use assertEquals .","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertEquals"}]},{"block_type":"text","content":"&nbsp;assertion fails, the first and second values are printed in the error report, giving a better feedback of what went wrong, whereas"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertTrue"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertFalse"}]},{"block_type":"text","content":"simply report failure. Not all testable results fit this, but, if possible, use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertEquals"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9rn","search_text":"It's important to understand the concept of equality. When comparing integers, strings, and other scalars, it's very simple. It doesn't work as well with collections such as dictionaries, lists, and sets. Complex, custom-defined objects may carry custom definitions of equality. These complex objects may require more fine-grained assertions. That is why it's probably a good idea to also include some test methods that directly target equality and inequality when working with custom objects.","text_count":493,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to understand the concept of equality. When comparing integers, strings, and other scalars, it's very simple. It doesn't work as well with collections such as dictionaries, lists, and sets. Complex, custom-defined objects may carry custom definitions of equality. These complex objects may require more fine-grained assertions. That is why it's probably a good idea to also include some test methods that directly target equality and inequality when working with custom objects."}]},{"block_type":"element","block":"k6bfv9ro","search_text":"self.fail([msg]) can usually be rewritten with assertions","text_count":57,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"self.fail([msg]) can usually be rewritten with assertions"}]},{"block_type":"element","block":"k6bfv9rp","search_text":"Unittest has a self.fail([msg]) operation that unconditionally causes the test to fail, along with an optional message. This was not shown earlier because it is not recommended for use.","text_count":185,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest has a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self.fail([msg])"}]},{"block_type":"text","content":"operation that unconditionally causes the test to fail, along with an optional message. This was not shown earlier because it is not recommended for use."}]},{"block_type":"element","block":"k6bfv9rq","search_text":"The fail method is often used to detect certain situations such as exceptions. A common idiom is as follows:","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fail"}]},{"block_type":"text","content":"method is often used to detect certain situations such as exceptions. A common idiom is as follows:"}]},{"block_type":"element","block":"k6bfv9rr","search_text":"import unittest class BadTest(unittest.TestCase): def test_no_roman_number(self): value = RomanNumeralConverter(None) try: value.convert_to_decimal() self.fail(\"Expected a TypeError\") except TypeError: pass if __name__==\"__main__\": unittest.main()","text_count":247,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nclass BadTest(unittest.TestCase): \n  def test_no_roman_number(self): \n    value = RomanNumeralConverter(None) \n    try: \n      value.convert_to_decimal() \n      self.fail(\"Expected a TypeError\") \n    except TypeError: \n      pass \n    if  __name__==\"__main__\": \n      unittest.main()"}]}]},{"block_type":"element","block":"k6bfv9rs","search_text":"This tests the same behavior as the earlier test_no_roman_numeral . The problem with this approach is that when the code is working properly the fail method is never executed. Code not executed regularly is at risk of becoming out of date and invalid. This will also interfere with coverage reports. Instead, it is better to use assertRaises as we used in the earlier examples. For other situations look at rewriting the test using the other assertions.","text_count":453,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This tests the same behavior as the earlier"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test_no_roman_numeral"}]},{"block_type":"text","content":". The problem with this approach is that when the code is working properly the fail method is never executed. Code not executed regularly is at risk of becoming out of date and invalid. This will also interfere with coverage reports. Instead, it is better to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertRaises"}]},{"block_type":"text","content":"as we used in the earlier examples. For other situations look at rewriting the test using the other assertions."}]},{"block_type":"element","block":"k6bfv9rt","search_text":"Our version of Python can impact our options","text_count":44,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Our version of Python can impact our options"}]},{"block_type":"element","block":"k6bfv9ru","search_text":"Python's official documentation on unittest shows many other assertions; however, they depend on the version of Python we are using. Some have been deprecated; others are only available in later versions, such as Python 3.6.","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python's official documentation on unittest shows many other assertions; however, they depend on the version of Python we are using. Some have been deprecated; others are only available in later versions, such as Python 3.6."}]},{"block_type":"element","block":"k6bfv9rv","search_text":"If our code must support multiple versions of Python then we must use the lowest common denominator. This recipe shows core assertions available in all versions since Python 3.6.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If our code must support multiple versions of Python then we must use the lowest common denominator. This recipe shows core assertions available in all versions since Python 3.6."}]},{"block_type":"element","block":"k6bfv9rw","search_text":"Setting up and tearing down a test harness","text_count":42,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Setting up and tearing down a test harness"}]},{"block_type":"element","block":"k6bfv9rx","search_text":"Unittest provides an easy mechanism to configure the state of the system when a piece of code is put through a test. It also allows us to clean things up afterward, if needed. This is commonly needed when a particular test case has repetitive steps used in every test method.","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest provides an easy mechanism to configure the state of the system when a piece of code is put through a test. It also allows us to clean things up afterward, if needed. This is commonly needed when a particular test case has repetitive steps used in every test method."}]},{"block_type":"element","block":"k6bfv9ry","search_text":"Barring any references to external variables or resources that carry state from one test method to the next, each test method starts from the same state.","text_count":153,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Barring any references to external variables or resources that carry state from one test method to the next, each test method starts from the same state."}]},{"block_type":"element","block":"k6bfv9rz","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9s0","search_text":"With the following steps, we will set up and teardown a test harness for each test method:","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will set up and teardown a test harness for each test method:"}]},{"block_type":"element","block":"k6bfv9s1","search_text":"Create a new file called recipe2.py for the code in this recipe. Pick a class to test. In this case, we will use a slightly altered version of our Roman numeral converter, where the function, not the constructor, provides the input value to convert: ","text_count":250,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe2.py"}]},{"block_type":"text","content":"for the code in this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use a slightly altered version of our Roman numeral converter, where the function, not the constructor, provides the input value to convert:"}]}]},{"block_type":"element","block":"k6bfv9s2","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500, \"C\":100,\\ \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] return val ","text_count":253,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n        self.digit_map = {\"M\":1000, \"D\":500, \"C\":100,\\\n                         \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n    def convert_to_decimal(self, roman_numeral):\n        val = 0 \n        for char in roman_numeral: \n            val += self.digit_map[char] \n        return val"}]}]},{"block_type":"element","block":"k6bfv9s3","search_text":"Create a class to test using the same name as the class under test with Test appended to the end: ","text_count":98,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a class to test using the same name as the class under test with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"appended to the end:"}]}]},{"block_type":"element","block":"k6bfv9s4","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): ","text_count":68,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nclass RomanNumeralConverterTest(unittest.TestCase):"}]}]},{"block_type":"element","block":"k6bfv9s5","search_text":"Create a setUp method that creates an instance of the class under test: ","text_count":72,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"method that creates an instance of the class under test:"}]}]},{"block_type":"element","block":"k6bfv9s6","search_text":"def setUp(self): print (\"Creating a new RomanNumeralConverter...\") self.cvt =RomanNumeralConverter()","text_count":100,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def setUp(self): \n        print (\"Creating a new RomanNumeralConverter...\") \n        self.cvt =RomanNumeralConverter()"}]}]},{"block_type":"element","block":"k6bfv9s7","search_text":"Create a tearDown method that destroys the instance of the class under test: ","text_count":77,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"method that destroys the instance of the class under test:"}]}]},{"block_type":"element","block":"k6bfv9s8","search_text":"def tearDown(self): print (\"Destroying the RomanNumeralConverter...\") self.cvt = None ","text_count":86,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def tearDown(self): \n        print (\"Destroying the RomanNumeralConverter...\") \n        self.cvt = None"}]}]},{"block_type":"element","block":"k6bfv9s9","search_text":"Create all the test methods using self.converter : ","text_count":51,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create all the test methods using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self.converter"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfv9sa","search_text":"def test_parsing_millenia(self): self.assertEqual(1000,\\ self.cvt.convert_to_decimal(\"M\")) def test_parsing_century(self): self.assertEqual(100, \\ self.cvt.convert_to_decimal(\"C\")) def test_parsing_half_century(self): self.assertEqual(50,\\ self.cvt.convert_to_decimal(\"L\")) def test_parsing_decade(self): self.assertEqual(10,self.cvt.convert_to_decimal(\"X\")) def test_parsing_half_decade(self): self.assertEqual(5,self.cvt.convert_to_decimal(\"V\")) def test_parsing_one(self): self.assertEqual(1,self.cvt.convert_to_decimal(\"I\")) def test_empty_roman_numeral(self): self.assertTrue(self.cvt.convert_to_decimal() == 0) self.assertFalse(self.cvt.convert_to_decimal() > 0) def test_no_roman_numeral(self): self.assertRaises(TypeError,\\ self.cvt.convert_to_decimal,None)","text_count":765,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_parsing_millenia(self):\n        self.assertEqual(1000,\\\n                         self.cvt.convert_to_decimal(\"M\")) \n     def test_parsing_century(self): \n        self.assertEqual(100, \\\n                          self.cvt.convert_to_decimal(\"C\")) \n     def test_parsing_half_century(self): \n        self.assertEqual(50,\\\n                         self.cvt.convert_to_decimal(\"L\")) \n     def test_parsing_decade(self): \n        self.assertEqual(10,self.cvt.convert_to_decimal(\"X\")) \n     def test_parsing_half_decade(self): \n        self.assertEqual(5,self.cvt.convert_to_decimal(\"V\")) \n     def test_parsing_one(self): \n        self.assertEqual(1,self.cvt.convert_to_decimal(\"I\")) \n     def test_empty_roman_numeral(self): \n        self.assertTrue(self.cvt.convert_to_decimal() == 0) \n        self.assertFalse(self.cvt.convert_to_decimal() &gt; 0) \n     def test_no_roman_numeral(self): \n        self.assertRaises(TypeError,\\\n                          self.cvt.convert_to_decimal,None)"}]}]},{"block_type":"element","block":"k6bfv9sb","search_text":"Make the entire script runnable and then use the test runner of unittest: ","text_count":74,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make the entire script runnable and then use the test runner of unittest:"}]}]},{"block_type":"element","block":"k6bfv9sc","search_text":"if __name__==\"__main__\": unittest.main()","text_count":40,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__==\"__main__\": \n     unittest.main()"}]}]},{"block_type":"element","block":"k6bfv9sd","search_text":"Run the file from the command line, as shown in this screenshot: ","text_count":65,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the file from the command line, as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9se","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000146.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9sf","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9sg","search_text":"In the first step, we picked a class to test. Next, we created a separate test class. By naming the test class [class under test]Test , it is easy to tell which class is under test.","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the first step, we picked a class to test. Next, we created a separate test class. By naming the test class"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[class under test]Test"}]},{"block_type":"text","content":", it is easy to tell which class is under test."}]},{"block_type":"element","block":"k6bfv9sh","search_text":"Then, we defined a setUp method that unittest runs before every Test method. Next, we created a tearDown method that unittest runs after every Test method. In this case, we added a print statement in each of them to demonstrate unittest rerunning these two methods for every test method. In reality, it would probably add too much noise to our testing.","text_count":352,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, we defined a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"method that unittest runs before every"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"method. Next, we created a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"method that unittest runs after every"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"method. In this case, we added a print statement in each of them to demonstrate unittest rerunning these two methods for every test method. In reality, it would probably add too much noise to our testing."}]},{"block_type":"element","block":"k6bfv9si","search_text":"One deficiency of unittest is the lack of setUpClass / tearDownClass and setUpModule / tearDownModule , providing the opportunity to run code in greater scopes than at the test method level. This has been added to unittest2 .","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One deficiency of unittest is the lack of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUpClass"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDownClass"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUpModule"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDownModule"}]},{"block_type":"text","content":", providing the opportunity to run code in greater scopes than at the test method level. This has been added to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest2"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9sj","search_text":"Note Each test case can have one setUp and one tearDown method: Our RomanNumeralConverter is pretty simple and fits easily into a single test class. But the test class allows only one setUp method and one tearDown method. If different combinations of setUp / tearDown methods are needed for various test scenarios, then this is a cue to code more test classes. Just because we write a setUp method, doesn't mean we need a tearDown method. In our case, we could have skipped destroying the RomanNumeralConverter , because a new instance would be replacing it for every test method. It was really for demonstration purposes only. What are the other uses of those cases that need a tearDown method? Using a library that requires some sort of close operation is a ripe candidate for writing a tearDown method. ","text_count":806,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Each test case can have one setUp and one tearDown method:&nbsp;"}]},{"block_type":"text","content":"Our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RomanNumeralConverter"}]},{"block_type":"text","content":"is pretty simple and fits easily into a single test class. But the test class allows only one"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"method and one"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"method. If different combinations of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"methods are needed for various test scenarios, then this is a cue to code more test classes. Just because we write a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"method, doesn't mean we need a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"method. In our case, we could have skipped destroying the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RomanNumeralConverter"}]},{"block_type":"text","content":", because a new instance would be replacing it for every test method. It was really for demonstration purposes only. What are the other uses of those cases that need a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"method? Using a library that requires some sort of close operation is a ripe candidate for writing a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tearDown"}]},{"block_type":"text","content":"method."}]}]},{"block_type":"element","block":"k6bfv9sk","search_text":"Running test cases from the command line","text_count":40,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Running test cases from the command line"}]},{"block_type":"element","block":"k6bfv9sl","search_text":"It is easy to adjust the test runner to print out every test method as it is run.","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is easy to adjust the test runner to print out every test method as it is run."}]},{"block_type":"element","block":"k6bfv9sm","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9sn","search_text":"In the following steps, we will run test cases with more detailed output, giving us better insight into how things run:","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the following steps, we will run test cases with more detailed output, giving us better insight into how things run:"}]},{"block_type":"element","block":"k6bfv9so","search_text":"Create a new file called recipe3.py for this recipe's code. Pick a class to test. In this case, we will use our Roman numeral converter: ","text_count":137,"tag_name":"ol","attributes":{"start":"1"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe3.py"}]},{"block_type":"text","content":"for this recipe's code."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use our Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9sp","search_text":"class RomanNumeralConverter(object): def __init__(self, roman_numeral): self.roman_numeral = roman_numeral self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50,\\ \"X\":10,\"V\":5, \"I\":1} def convert_to_decimal(self): val = 0 for char in self.roman_numeral: val += self.digit_map[char] return val","text_count":291,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self, roman_numeral): \n        self.roman_numeral = roman_numeral \n        self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50,\\\n                           \"X\":10,\"V\":5, \"I\":1} \n \n    def convert_to_decimal(self):\n        val = 0 \n        for char in self.roman_numeral:\n            val += self.digit_map[char] \n        return val"}]}]},{"block_type":"element","block":"k6bfv9sq","search_text":"Create a test class using the same name as the class under test with Test appended to the end: ","text_count":95,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test class using the same name as the class under test with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"appended to the end:"}]}]},{"block_type":"element","block":"k6bfv9sr","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): ","text_count":68,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nclass RomanNumeralConverterTest(unittest.TestCase):"}]}]},{"block_type":"element","block":"k6bfv9ss","search_text":"Create several test methods. For this recipe, the second test have been deliberately coded to fail: ","text_count":100,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create several test methods. For this recipe, the second test have been deliberately coded to fail:"}]}]},{"block_type":"element","block":"k6bfv9st","search_text":"def test_parsing_millenia(self): value =RomanNumeralConverter(\"M\") self.assertEqual(1000, value.convert_to_decimal()) def test_parsing_century(self): \"This test method is coded to fail for demo.\" value =RomanNumeralConverter(\"C\") self.assertEqual(10, value.convert_to_decimal()) ","text_count":279,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_parsing_millenia(self): \n    value =RomanNumeralConverter(\"M\") \n    self.assertEqual(1000, value.convert_to_decimal()) \n\ndef test_parsing_century(self): \n    \"This test method is coded to fail for demo.\"\n     value =RomanNumeralConverter(\"C\") \n     self.assertEqual(10, value.convert_to_decimal())"}]}]},{"block_type":"element","block":"k6bfv9su","search_text":"Define a test suite that automatically loads all the test methods, and then runs them with the higher level of verbosity: ","text_count":122,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define a test suite that automatically loads all the test methods, and then runs them with the higher level of verbosity:"}]}]},{"block_type":"element","block":"k6bfv9sv","search_text":"if __name__== \"__main__\": suite = unittest.TestLoader().loadTestsFromTestCase(\\ RomanNumeralConverterTest) unittest.TextTestRunner(verbosity=2).run(suite) ","text_count":155,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__== \"__main__\": \n    suite = unittest.TestLoader().loadTestsFromTestCase(\\\n              RomanNumeralConverterTest) \n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9sw","search_text":"Run the file from the command line. Notice how, in this screenshot the test method that fails, prints out its Python docstring: ","text_count":128,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the file from the command line. Notice how, in this screenshot the test method that fails, prints out its Python docstring:"}]}]},{"block_type":"element","block":"k6bfv9sx","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000136.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9sy","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9sz","search_text":"A key part of automated testing is organizing the tests. The base units are called test cases . These can be combined together into test suites . Python's unittest module provides TestLoader().loadTestsFromTestCase to fetch all the test* methods automatically into a test suite. This test suite is then run through unittest's TextTestRunner with an increased level of verbosity.","text_count":378,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A key part of automated testing is organizing the tests. The base units are called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"test cases"}]},{"block_type":"text","content":". These can be combined together into"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"test suites"}]},{"block_type":"text","content":". Python's unittest module provides"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestLoader().loadTestsFromTestCase"}]},{"block_type":"text","content":"to fetch all the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test*"}]},{"block_type":"text","content":"methods automatically into a test suite. This test suite is then run through unittest's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TextTestRunner"}]},{"block_type":"text","content":"with an increased level of verbosity."}]},{"block_type":"element","block":"k6bfv9t0","search_text":"Note TextTestRunner is unittest's only test runner. Later in this book, we will look at other test tools that have different runners, including the one that plugs in a different unittest test runner. ","text_count":200,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TextTestRunner"}]},{"block_type":"text","content":"is unittest's only test runner. Later in this book, we will look at other test tools that have different runners, including the one that plugs in a different unittest test runner."}]}]},{"block_type":"element","block":"k6bfv9t1","search_text":"The previous screenshot shows each method along with its module and class name, as well as success/failure.","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The previous screenshot shows each method along with its module and class name, as well as success/failure."}]},{"block_type":"element","block":"k6bfv9t2","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9t3","search_text":"This recipe not only demonstrates how to turn up the verbosity of running tests, but also shows what happens when a test case fails. It renames the test method with the document string embedded in the test method, and prints the details later after all the test methods have been reported.","text_count":289,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe not only demonstrates how to turn up the verbosity of running tests, but also shows what happens when a test case fails. It renames the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":"method with the document string embedded in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":"method, and prints the details later after all the test methods have been reported."}]},{"block_type":"element","block":"k6bfv9t4","search_text":"Running a subset of test case methods","text_count":37,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Running a subset of test case methods"}]},{"block_type":"element","block":"k6bfv9t5","search_text":"Sometimes, it's convenient to run only a subset of test methods in a given test case. This recipe will show how to run either the whole test case, or pick a subset from the command line.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sometimes, it's convenient to run only a subset of test methods in a given test case. This recipe will show how to run either the whole test case, or pick a subset from the command line."}]},{"block_type":"element","block":"k6bfv9t6","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9t7","search_text":"The following steps show how to code a command-line script to run subsets of tests:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps show how to code a command-line script to run subsets of tests:"}]},{"block_type":"element","block":"k6bfv9t8","search_text":"Create a new file named recipe4.py to put all the code for this recipe. Pick a class to test. In this case, we will use our Roman numeral converter: ","text_count":149,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe4.py"}]},{"block_type":"text","content":"to put all the code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use our Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9t9","search_text":"class RomanNumeralConverter(object): def __init__(self, roman_numeral): self.roman_numeral = roman_numeral self.digit_map = {\"M\":1000, \"D\":500,\\ \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self): val = 0 for char in self.roman_numeral: val+=self.digit_map[char] return val","text_count":290,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object):\n    def __init__(self, roman_numeral): \n        self.roman_numeral = roman_numeral \n        self.digit_map = {\"M\":1000, \"D\":500,\\\n                        \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n \n    def convert_to_decimal(self):\n        val = 0 \n        for char in self.roman_numeral: \n            val+=self.digit_map[char]\n        return val"}]}]},{"block_type":"element","block":"k6bfv9ta","search_text":"Create a test class using the same name as the class under test with Test appended to the end: ","text_count":95,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test class using the same name as the class under test with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"appended to the end:"}]}]},{"block_type":"element","block":"k6bfv9tb","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): ","text_count":68,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nclass RomanNumeralConverterTest(unittest.TestCase):"}]}]},{"block_type":"element","block":"k6bfv9tc","search_text":"Create several test methods: ","text_count":29,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create several"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":"methods:"}]}]},{"block_type":"element","block":"k6bfv9td","search_text":"def test_parsing_millenia(self): value = RomanNumeralConverter(\"M\") self.assertEquals(1000, value.convert_to_decimal()) def test_parsing_century(self): value = RomanNumeralConverter(\"C\") self.assertEquals(100, value.convert_to_decimal()) ","text_count":238,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_parsing_millenia(self):\n        value = RomanNumeralConverter(\"M\") \n        self.assertEquals(1000, value.convert_to_decimal()) \n \n    def test_parsing_century(self):\n        value = RomanNumeralConverter(\"C\") \n        self.assertEquals(100, value.convert_to_decimal())"}]}]},{"block_type":"element","block":"k6bfv9te","search_text":"Write a main runner that either runs the entire test case or accepts a variable number of test methods: ","text_count":104,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a main runner that either runs the entire test case or accepts a variable number of test methods:"}]}]},{"block_type":"element","block":"k6bfv9tf","search_text":"if __name__= \"__main__\": import sys suite = unittest.TestSuite() if len(sys.argv) == 1: suite = unittest.TestLoader().loadTestsFromTestCase(\\ RomanNumeralConverterTest) else: for test_name in sys.argv[1:]: suite.addTest(RomanNumeralConverterTest(test_name)) unittest.TextTestRunner(verbosity=2).run(suite) ","text_count":306,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__= \"__main__\":\n    import sys\n    suite = unittest.TestSuite()\n    if len(sys.argv) == 1:\n        suite = unittest.TestLoader().loadTestsFromTestCase(\\                                                                       RomanNumeralConverterTest) \n    else: \n        for test_name in sys.argv[1:]:\n            suite.addTest(RomanNumeralConverterTest(test_name))\n\n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9tg","search_text":"Run the recipe with no extra command-line arguments and see it run all the tests, as shown in this screenshot: ","text_count":111,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the recipe with no extra command-line arguments and see it run all the tests, as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9th","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000128.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9ti","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9tj","search_text":"For this test case, we coded a couple of test methods. But instead of simply running all the tests, or defining a fixed list, we used Python's sys library to parse the command-line arguments. If there are no extra arguments, it runs the entire test case. If there are extra arguments, then they are assumed to be test method names. It uses unittest's inbuilt ability to specify test method names when instantiating RomanNumeralConverterTest .","text_count":442,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this test case, we coded a couple of test methods. But instead of simply running all the tests, or defining a fixed list, we used Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sys"}]},{"block_type":"text","content":"library to parse the command-line arguments. If there are no extra arguments, it runs the entire test case. If there are extra arguments, then they are assumed to be test method names. It uses unittest's inbuilt ability to specify test method names when instantiating"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RomanNumeralConverterTest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9tk","search_text":"Chaining together a suite of tests","text_count":34,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Chaining together a suite of tests"}]},{"block_type":"element","block":"k6bfv9tl","search_text":"Unittest makes it easy to chain together test cases into a TestSuite . A TestSuite can be run just like a TestCase , but it also provides additional functionality to add a single/multiple tests, and count them.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest makes it easy to chain together test cases into a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestSuite"}]},{"block_type":"text","content":". A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestSuite"}]},{"block_type":"text","content":"can be run just like a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestCase"}]},{"block_type":"text","content":", but it also provides additional functionality to add a single/multiple tests, and count them."}]},{"block_type":"element","block":"k6bfv9tm","search_text":"Why do we need this? Chaining together tests into a suite gives us the ability to pull together more than one module of test cases for a test run, as well as picking and choosing a subset of test cases. Up until now, we have generally run all the test methods from a single class. TestSuite gives us an alternative means to define a block of testing.","text_count":350,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why do we need this? Chaining together tests into a suite gives us the ability to pull together more than one module of test cases for a test run, as well as picking and choosing a subset of test cases. Up until now, we have generally run all the test methods from a single class."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestSuite"}]},{"block_type":"text","content":"gives us an alternative means to define a block of testing."}]},{"block_type":"element","block":"k6bfv9tn","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9to","search_text":"In the following steps, we will code multiple test case classes, and then load their test methods into suites so we can run them:","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the following steps, we will code multiple test case classes, and then load their test methods into suites so we can run them:"}]},{"block_type":"element","block":"k6bfv9tp","search_text":"Create a new file named recipe5.py to put our sample application and test cases. Pick a class to test. In this case, we will use our Roman numeral converter: ","text_count":158,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe5.py"}]},{"block_type":"text","content":"to put our sample application and test cases."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use our Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9tq","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500,\\ \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] return val ","text_count":253,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n            self.digit_map = {\"M\":1000, \"D\":500,\\\n                        \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n \n    def convert_to_decimal(self, roman_numeral):\n            val = 0 \n            for char in roman_numeral: \n                val += self.digit_map[char] \n            return val"}]}]},{"block_type":"element","block":"k6bfv9tr","search_text":"Create two test classes with various test methods spread between them: ","text_count":71,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create two test classes with various test methods spread between them:"}]}]},{"block_type":"element","block":"k6bfv9ts","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): def setUp(self): self.cvt = RomanNumeralConverter() def test_parsing_millenia(self): self.assertEquals(1000, \\ self.cvt.convert_to_decimal(\"M\")) def test_parsing_century(self): self.assertEquals(100, \\ self.cvt.convert_to_decimal(\"C\")) class RomanNumeralComboTest(unittest.TestCase): def setUp(self): self.cvt=RomanNumeralConverter() def test_multi_millenia(self): self.assertEquals(4000,\\ def test_multi_add_up(self): self.assertEquals(2010, \\ self.cvt.convert_to_decimal(\"MMX\"))","text_count":548,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nclass RomanNumeralConverterTest(unittest.TestCase): \n    def setUp(self): \n        self.cvt = RomanNumeralConverter()\n    def test_parsing_millenia(self): \n        self.assertEquals(1000, \\ \n                    self.cvt.convert_to_decimal(\"M\")) \n \n    def test_parsing_century(self): \n        self.assertEquals(100, \\ \n                    self.cvt.convert_to_decimal(\"C\")) \n \nclass RomanNumeralComboTest(unittest.TestCase):\n    def setUp(self):\n        self.cvt=RomanNumeralConverter()\n    def test_multi_millenia(self):\n        self.assertEquals(4000,\\\n    def test_multi_add_up(self): \n        self.assertEquals(2010, \\ \n        self.cvt.convert_to_decimal(\"MMX\"))"}]}]},{"block_type":"element","block":"k6bfv9tt","search_text":"Create a test runner in a separate file named recipe5_runner.py that pulls in both test cases: ","text_count":95,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test runner in a separate file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe5_runner.py"}]},{"block_type":"text","content":"that pulls in both test cases:"}]}]},{"block_type":"element","block":"k6bfv9tu","search_text":"if __name__ == \"__main__\": import unittest from recipe5 import * suite1 = unittest.TestLoader().loadTestsFromTestCase( \\ RomanNumeralConverterTest) suite2 = unittest.TestLoader().loadTestsFromTestCase( \\ RomanNumeralComboTest) suite = unittest.TestSuite([suite1, suite2]) unittest.TextTestRunner(verbosity=2).run(suite)","text_count":319,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n    import unittest \n    from recipe5 import * \n    suite1 = unittest.TestLoader().loadTestsFromTestCase( \\  \n                RomanNumeralConverterTest) \n    suite2 = unittest.TestLoader().loadTestsFromTestCase( \\ \n                RomanNumeralComboTest) \n    suite = unittest.TestSuite([suite1, suite2])     \n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9tv","search_text":"Execute the test runner, and observe from this screenshot how tests are pulled in from both test cases. ","text_count":104,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Execute the test runner, and observe from this screenshot how tests are pulled in from both test cases."}]}]},{"block_type":"element","block":"k6bfv9tw","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000117.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9tx","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9ty","search_text":"The unittest module provides a convenient way to find all the test methods in a TestClass and bundle them together as a suite using its loadTestsFromTestCase . To further the usage of test suites, we are able to combine these two suites together as a single suite using unittest.TestSuite([list...]) . The TestSuite class is designed to act as a TestCase class does, even though it doesn't subclass TestClass , allowing us to run it using TextTestRunner . This recipe shows the verbosity turned up, allowing us to see exactly what test methods were run, and from what test case they came from.","text_count":593,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The unittest module provides a convenient way to find all the test methods in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestClass"}]},{"block_type":"text","content":"and bundle them together as a suite using its"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"loadTestsFromTestCase"}]},{"block_type":"text","content":". To further the usage of test suites, we are able to combine these two suites together as a single suite using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.TestSuite([list...])"}]},{"block_type":"text","content":". The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestSuite"}]},{"block_type":"text","content":"class is designed to act as a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestCase"}]},{"block_type":"text","content":"class does, even though it doesn't subclass"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestClass"}]},{"block_type":"text","content":", allowing us to run it using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TextTestRunner"}]},{"block_type":"text","content":". This recipe shows the verbosity turned up, allowing us to see exactly what test methods were run, and from what test case they came from."}]},{"block_type":"element","block":"k6bfv9tz","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9u0","search_text":"In this recipe, we ran the tests from a different file than where the test cases are defined. This is different than the previous recipes where the runnable code and the test case were contained in the same file. Since the runner is defining the tests we run, we can easily create more runners that combine different suites of tests.","text_count":333,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we ran the tests from a different file than where the test cases are defined. This is different than the previous recipes where the runnable code and the test case were contained in the same file. Since the runner is defining the tests we run, we can easily create more runners that combine different suites of tests."}]},{"block_type":"element","block":"k6bfv9u1","search_text":"The name of the test case should be significant","text_count":47,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"The name of the test case should be significant"}]},{"block_type":"element","block":"k6bfv9u2","search_text":"In the previous recipes, it has been advised to name the test case as [class under test]Test . This is to make it apparent to the reader that the class under test and the related test share an important relationship. Now that we are introducing another test case, we need to pick a different name. The name should explain clearly why these particular test methods are split out into a separate class. For this recipe, the methods are split out to show more complex combinations of Roman numerals.","text_count":496,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous recipes, it has been advised to name the test case as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[class under test]Test"}]},{"block_type":"text","content":". This is to make it apparent to the reader that the class under test and the related test share an important relationship. Now that we are introducing another test case, we need to pick a different name. The name should explain clearly why these particular test methods are split out into a separate class. For this recipe, the methods are split out to show more complex combinations of Roman numerals."}]},{"block_type":"element","block":"k6bfv9u3","search_text":"Defining test suites inside the test module","text_count":43,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Defining test suites inside the test module"}]},{"block_type":"element","block":"k6bfv9u4","search_text":"Each test module can provide one or more methods that define a different test suite. One method can exercise all the tests in a given module, another method can define a particular subset.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each test module can provide one or more methods that define a different test suite. One method can exercise all the tests in a given module, another method can define a particular subset."}]},{"block_type":"element","block":"k6bfv9u5","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9u6","search_text":"With the following steps, we will create some methods that define test suites using different means:","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will create some methods that define test suites using different means:"}]},{"block_type":"element","block":"k6bfv9u7","search_text":"Create a new file called recipe6.py to put our code for this recipe. Pick a class to test. In this case, we will use our Roman numeral converter: ","text_count":146,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe6.py"}]},{"block_type":"text","content":"to put our code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use our Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9u8","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] return val ","text_count":252,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n        self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n \n    def convert_to_decimal(self, roman_numeral): \n    val = 0 \n    for char in roman_numeral: \n        val += self.digit_map[char] \n    return val"}]}]},{"block_type":"element","block":"k6bfv9u9","search_text":"Create a test class using the same name as the class under test with Test appended to the end: ","text_count":95,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test class using the same name as the class under test with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":"appended to the end:"}]}]},{"block_type":"element","block":"k6bfv9ua","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): ","text_count":68,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nclass RomanNumeralConverterTest(unittest.TestCase):"}]}]},{"block_type":"element","block":"k6bfv9ub","search_text":"Write a series of test methods, including a setUp method that creates a new instance of the RomanNumeralConverter for each test method: ","text_count":136,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a series of test methods, including a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"method that creates a new instance of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RomanNumeralConverter"}]},{"block_type":"text","content":"for each test method:"}]}]},{"block_type":"element","block":"k6bfv9uc","search_text":"import unittest class RomanNumeralConverterTest(unittest.TestCase): def setUp(self): self.cvt = RomanNumeralConverter() def test_parsing_millenia(self): self.assertEquals(1000, \\ self.cvt.convert_to_decimal(\"M\")) def test_parsing_century(self): self.assertEquals(100, \\ self.cvt.convert_to_decimal(\"C\")) def test_parsing_half_century(self): self.assertEquals(50, \\ self.cvt.convert_to_decimal(\"L\")) def test_parsing_decade(self): self.assertEquals(10, \\ self.cvt.convert_to_decimal(\"X\")) def test_parsing_half_decade(self): self.assertEquals(5, self.cvt.convert_to_decimal(\"V\")) def test_parsing_one(self): self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) def test_empty_roman_numeral(self): self.assertTrue(self.cvt.convert_to_decimal(\"\") == 0) self.assertFalse(self.cvt.convert_to_decimal(\"\") > 0) def test_no_roman_numeral(self): self.assertRaises(TypeError, \\ self.cvt.convert_to_decimal, None) def test_combo1(self): self.assertEquals(4000, \\ self.cvt.convert_to_decimal(\"MMMM\")) def test_combo2(self): self.assertEquals(2010, \\ self.cvt.convert_to_decimal(\"MMX\")) def test_combo3(self): self.assertEquals(4668, \\ self.cvt.convert_to_decimal(\"MMMMDCLXVIII\")) ","text_count":1170,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \n \nclass RomanNumeralConverterTest(unittest.TestCase): \n    def setUp(self): \n        self.cvt = RomanNumeralConverter() \n \n    def test_parsing_millenia(self): \n        self.assertEquals(1000, \\ \n             self.cvt.convert_to_decimal(\"M\")) \n \n    def test_parsing_century(self): \n        self.assertEquals(100, \\ \n            self.cvt.convert_to_decimal(\"C\")) \n \n    def test_parsing_half_century(self): \n        self.assertEquals(50, \\ \n            self.cvt.convert_to_decimal(\"L\")) \n \n    def test_parsing_decade(self): \n        self.assertEquals(10, \\ \n            self.cvt.convert_to_decimal(\"X\")) \n \n    def test_parsing_half_decade(self): \n        self.assertEquals(5, self.cvt.convert_to_decimal(\"V\")) \n \n    def test_parsing_one(self): \n        self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) \n \n    def test_empty_roman_numeral(self):     \n        self.assertTrue(self.cvt.convert_to_decimal(\"\") == 0) \n        self.assertFalse(self.cvt.convert_to_decimal(\"\") &gt; 0) \n\n    def test_no_roman_numeral(self): \n        self.assertRaises(TypeError, \\ \n            self.cvt.convert_to_decimal, None) \n \n    def test_combo1(self): \n        self.assertEquals(4000, \\ \n            self.cvt.convert_to_decimal(\"MMMM\")) \n \n    def test_combo2(self): \n        self.assertEquals(2010, \\ \n            self.cvt.convert_to_decimal(\"MMX\")) \n \n    def test_combo3(self): \n        self.assertEquals(4668, \\ \n            self.cvt.convert_to_decimal(\"MMMMDCLXVIII\"))"}]}]},{"block_type":"element","block":"k6bfv9ud","search_text":"Create some methods in the recipe's module (but not in the test case) that define different test suites: ","text_count":105,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create some methods in the recipe's module (but not in the test case) that define different test suites:"}]}]},{"block_type":"element","block":"k6bfv9ue","search_text":"def high_and_low(): suite = unittest.TestSuite() suite.addTest(\\ RomanNumeralConverterTest(\"test_parsing_millenia\")) suite.addTest(\\ RomanNumeralConverterTest(\"test_parsing_one\")) return suite def combos(): return unittest.TestSuite(map(RomanNumeralConverterTest,\\ [\"test_combo1\", \"test_combo2\", \"test_combo3\"])) def all(): return unittest.TestLoader().loadTestsFromTestCase(\\ RomanNumeralConverterTest) ","text_count":404,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def high_and_low(): \n    suite = unittest.TestSuite() \n    suite.addTest(\\ \n        RomanNumeralConverterTest(\"test_parsing_millenia\"))    \n    suite.addTest(\\ \n        RomanNumeralConverterTest(\"test_parsing_one\")) return suite \ndef combos(): \n    return unittest.TestSuite(map(RomanNumeralConverterTest,\\    \n        [\"test_combo1\", \"test_combo2\", \"test_combo3\"])) \ndef all(): \n    return unittest.TestLoader().loadTestsFromTestCase(\\   \n            RomanNumeralConverterTest)"}]}]},{"block_type":"element","block":"k6bfv9uf","search_text":"Create a runner that will iterate over each of these test suites and run them through unittest's TextTestRunner : ","text_count":114,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a runner that will iterate over each of these test suites and run them through unittest's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TextTestRunner"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfv9ug","search_text":"if __name__ == \"__main__\": for suite_func in [high_and_low, combos, all]: print (\"Running test suite '%s'\" % suite_func.__name__) suite = suite_func() unittest.TextTestRunner(verbosity=2).run(suite)","text_count":198,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n    for suite_func in [high_and_low, combos, all]: \n        print (\"Running test suite '%s'\" % suite_func.__name__)  \n        suite = suite_func()    \n        unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9uh","search_text":"Run the combination of test suites, and see the results. Take a look at this screenshot: ","text_count":89,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the combination of test suites, and see the results. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9ui","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000108.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9uj","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9uk","search_text":"We pick a class to test and define a number of test methods that check things out. Then we define a few module-level methods such as, high_and_low , combos , and all , to define test suites. Two of them contain fixed subsets of methods while all dynamically loads the test* methods from the class. Finally, the main part of our module iterates over a listing of all these functions that generate suites to smoothly create and run them.","text_count":435,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We pick a class to test and define a number of test methods that check things out. Then we define a few module-level methods such as,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"high_and_low"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"combos"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"all"}]},{"block_type":"text","content":", to define test suites. Two of them contain fixed subsets of methods while"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"all"}]},{"block_type":"text","content":"dynamically loads the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test*"}]},{"block_type":"text","content":"methods from the class. Finally, the main part of our module iterates over a listing of all these functions that generate suites to smoothly create and run them."}]},{"block_type":"element","block":"k6bfv9ul","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9um","search_text":"All of our test suites were run from the recipe's main runner. But this probably wouldn't be the case for a real project. Instead, the idea is to define different suites, and code a mechanism to pick which suite to run. Each suite is geared towards a different purpose, and it is necessary to allow the developer to pick which suite to run. This can be done by coding a command-line script using Python's optparse module to define command-line flags to pick one of these suites.","text_count":478,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All of our test suites were run from the recipe's main runner. But this probably wouldn't be the case for a real project. Instead, the idea is to define different suites, and code a mechanism to pick which suite to run. Each suite is geared towards a different purpose, and it is necessary to allow the developer to pick which suite to run. This can be done by coding a command-line script using Python's optparse module to define command-line flags to pick one of these suites."}]},{"block_type":"element","block":"k6bfv9un","search_text":"Test suite methods must be outside of the test class","text_count":52,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Test suite methods must be outside of the test class"}]},{"block_type":"element","block":"k6bfv9uo","search_text":"If we make these suite-defining methods members of the test class, we would have to instantiate the test class. Classes that extend unittest.TestCase have a specialized init method that doesn't work well with an instance that is created just to call a non-test method. That is why the methods are outside the test class. While these methods can be in other modules, it is very convenient to define them inside the module containing the test code, to keep things in proximity.","text_count":475,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If we make these suite-defining methods members of the test class, we would have to instantiate the test class. Classes that extend"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.TestCase"}]},{"block_type":"text","content":"have a specialized"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"init"}]},{"block_type":"text","content":"method that doesn't work well with an instance that is created just to call a non-test method. That is why the methods are outside the test class. While these methods can be in other modules, it is very convenient to define them inside the module containing the test code, to keep things in proximity."}]},{"block_type":"element","block":"k6bfv9up","search_text":"Why have different suites?","text_count":26,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why have different suites?"}]},{"block_type":"element","block":"k6bfv9uq","search_text":"What if we started our project off by running all tests? Sounds like a good idea, right? But what if the time to run the entire test suite grew to over an hour? There is a certain threshold after which developers tend to stop running tests, and nothing is worse than an un-run test suite . By defining subsets of tests, it is easy to run alternate suites during the day, and then perhaps run the comprehensive test suite once a day. Bear in mind the following:","text_count":460,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What if we started our project off by running all tests? Sounds like a good idea, right? But what if the time to run the entire test suite grew to over an hour? There is a certain threshold after which developers tend to stop running tests, and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"nothing is worse than an un-run test"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"suite"}]},{"block_type":"text","content":". By defining subsets of tests, it is easy to run alternate suites during the day, and then perhaps run the comprehensive test suite once a day. Bear in mind the following:"}]},{"block_type":"element","block":"k6bfv9ur","search_text":"all is the comprehensive suite high_and_low is an example of testing the edges combos is a random sampling of values used to show that things are generally working ","text_count":164,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"all"}]},{"block_type":"text","content":"is the comprehensive suite"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"high_and_low"}]},{"block_type":"text","content":"is an example of testing the edges"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"combos"}]},{"block_type":"text","content":"is a random sampling of values used to show that things are generally working"}]}]},{"block_type":"element","block":"k6bfv9us","search_text":"Defining our test suites is a judgment call. It's also worth re-evaluating each test suite every so often. If one test suite is getting too costly to run, consider moving some of its more expensive tests to another suite.","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Defining our test suites is a judgment call. It's also worth re-evaluating each test suite every so often. If one test suite is getting too costly to run, consider moving some of its more expensive tests to another suite."}]},{"block_type":"element","block":"k6bfv9ut","search_text":"optparse is being phased out and replaced by argparse","text_count":53,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"optparse is being phased out and replaced by argparse"}]},{"block_type":"element","block":"k6bfv9uu","search_text":"While optparse is a convenient way to add command-line flags to Python scripts, it won't be available forever. Python 2.7 has deprecated this module and is continuing this development in argparse .","text_count":197,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse"}]},{"block_type":"text","content":"is a convenient way to add command-line flags to Python scripts, it won't be available forever. Python 2.7 has deprecated this module and is continuing this development in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9uv","search_text":"Retooling old test code to run inside unittest","text_count":46,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Retooling old test code to run inside unittest"}]},{"block_type":"element","block":"k6bfv9uw","search_text":"Sometimes, we may have developed demo code to exercise our system. We don't have to rewrite it to run it inside unittest. Instead, it is easy to hook it up to the test framework and run it with some small changes.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sometimes, we may have developed demo code to exercise our system. We don't have to rewrite it to run it inside unittest. Instead, it is easy to hook it up to the test framework and run it with some small changes."}]},{"block_type":"element","block":"k6bfv9ux","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9uy","search_text":"With these steps, we will dive into capturing the test code that was written without using unittest, and repurposing it with minimal effort to run inside unittest:","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will dive into capturing the test code that was written without using unittest, and repurposing it with minimal effort to run inside unittest:"}]},{"block_type":"element","block":"k6bfv9uz","search_text":"Create a file named recipe7.py to put our application code that we will be testing. Pick a class to test. In this case, we will use our Roman numeral converter: ","text_count":161,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe7.py"}]},{"block_type":"text","content":"to put our application code that we will be testing."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use our Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9v0","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] return val ","text_count":252,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n        self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n \n    def convert_to_decimal(self, roman_numeral): \n        val = 0 \n        for char in roman_numeral: \n            val += self.digit_map[char] \n        return val"}]}]},{"block_type":"element","block":"k6bfv9v1","search_text":"Create a new file named recipe7_legacy.py to contain test code that doesn't use the unittest module. Create a set of legacy tests that are coded, based on Python's assert function, not with unittest, along with a runner: ","text_count":221,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe7_legacy.py"}]},{"block_type":"text","content":"to contain test code that doesn't use the unittest module."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a set of legacy tests that are coded, based on Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"function, not with unittest, along with a runner:"}]}]},{"block_type":"element","block":"k6bfv9v2","search_text":"from recipe7 import * class RomanNumeralTester(object): def init (self): self.cvt = RomanNumeralConverter() def simple_test(self): print (\"+++ Converting M to 1000\") assert self.cvt.convert_to_decimal(\"M\") == 1000 def combo_test1(self): print (\"+++ Converting MMX to 2010\") assert self.cvt.convert_to_decimal(\"MMXX\") == 2010 def combo_test2(self): print (\"+++ Converting MMMMDCLXVIII to 4668\") val = self.cvt.convert_to_decimal(\"MMMMDCLXVII\") self.check(val, 4668) def other_test(self): print (\"+++ Converting MMMM to 4000\") val = self.cvt.convert_to_decimal(\"MMMM\") self.check(val, 4000) def check(self, actual, expected): if (actual != expected): raise AssertionError(\"%s doesn't equal %s\" % \\ (actual, expected)) def test_the_system(self): self.simple_test() self.combo_test1() self.combo_test2() self.other_test() if __name == \"__main__\": tester = RomanNumeralTester() tester.test_the_system()","text_count":897,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe7 import * \nclass RomanNumeralTester(object): \n  def   init  (self): \n    self.cvt = RomanNumeralConverter() \n  def simple_test(self):\n    print (\"+++ Converting M to 1000\")\n    assert self.cvt.convert_to_decimal(\"M\") == 1000\n  def combo_test1(self): \n    print (\"+++ Converting MMX to 2010\") \n    assert self.cvt.convert_to_decimal(\"MMXX\") == 2010 \n  def combo_test2(self): \n    print (\"+++ Converting MMMMDCLXVIII to 4668\") \n    val = self.cvt.convert_to_decimal(\"MMMMDCLXVII\")         \n    self.check(val, 4668) \n  def other_test(self): \n    print (\"+++ Converting MMMM to 4000\") \n    val = self.cvt.convert_to_decimal(\"MMMM\") \n    self.check(val, 4000) \n  def check(self, actual, expected): \n    if (actual != expected): \n      raise AssertionError(\"%s doesn't equal %s\" % \\ \n            (actual,  expected)) \n  def test_the_system(self): \n    self.simple_test() \n    self.combo_test1() \n    self.combo_test2() \n    self.other_test() \nif __name == \"__main__\": \n  tester = RomanNumeralTester() \n  tester.test_the_system()"}]}]},{"block_type":"element","block":"k6bfv9v3","search_text":"Note This set of legacy tests is meant to represent legacy test code that our team has developed to exercise things before unittest was an option. ","text_count":147,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This set of legacy tests is meant to represent legacy test code that our team has developed to exercise things before unittest was an option."}]}]},{"block_type":"element","block":"k6bfv9v4","search_text":"Run the legacy tests. What is wrong with this situation? Did all the test methods run? Have we caught all the bugs? Take a look at this screenshot: Create a new file called recipe7_pyunit.py . Create a unittest set of tests, wrapping each legacy test method inside unittest's FunctionTestCase : ","text_count":295,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the legacy tests. What is wrong with this situation? Did all the test methods run? Have we caught all the bugs? Take a look at this screenshot:"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000072.png","class":"lazyload"},"children":[]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe7_pyunit.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a unittest set of tests, wrapping each legacy test method inside unittest's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FunctionTestCase"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfv9v5","search_text":"from recipe7 import * from recipe7_legacy import * import unittest if __name__ == \"__main__\": tester = RomanNumeralTester() suite = unittest.TestSuite() for test in [tester.simple_test, tester.combo_test1, \\ tester.combo_test2, tester.other_test]: testcase = unittest.FunctionTestCase(test) suite.addTest(testcase) unittest.TextTestRunner(verbosity=2).run(suite)","text_count":362,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe7 import * \nfrom recipe7_legacy import * import unittest \n \nif __name__ == \"__main__\":  \n    tester = RomanNumeralTester() \n    suite = unittest.TestSuite() \n    for test in [tester.simple_test, tester.combo_test1, \\ \n            tester.combo_test2, tester.other_test]: \n        testcase = unittest.FunctionTestCase(test)   \n        suite.addTest(testcase) \n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9v6","search_text":"Run the unittest test. Did all the tests run this time? Which test failed? Where is the bug? Look at this screenshot: ","text_count":118,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the unittest test. Did all the tests run this time? Which test failed? Where is the bug? Look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9v7","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000118.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9v8","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9v9","search_text":"Python provides a convenient assert statement that tests a condition. When true, the code continues. When false, it raises an AssertionError . In the first test runner, we have several tests that check results using a mixture of assert statements or raising an AssertionError .","text_count":277,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python provides a convenient assert statement that tests a condition. When true, the code continues. When false, it raises an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"AssertionError"}]},{"block_type":"text","content":". In the first test runner, we have several tests that check results using a mixture of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"statements or raising an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"AssertionError"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9va","search_text":"unittest provides a convenient class, unittest.FunctionTestCase , that wraps a bound function as a unittest test case. If an AssertionError is thrown, FunctionTestCase catches it, flags it as a test failure , and proceeds to the next test case. If any other type of exception is thrown, it will be flagged as a test error. In the second test runner, we wrap each of these legacy test methods with FunctionTestCase , and chain them together in a suite for unittest to run.","text_count":471,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"unittest provides a convenient class,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.FunctionTestCase"}]},{"block_type":"text","content":", that wraps a bound function as a unittest test case. If an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"AssertionError"}]},{"block_type":"text","content":"is thrown,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FunctionTestCase"}]},{"block_type":"text","content":"catches it, flags it as a test"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"failure"}]},{"block_type":"text","content":", and proceeds to the next test case. If any other type of exception is thrown, it will be flagged as a test error. In the second test runner, we wrap each of these legacy test methods with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FunctionTestCase"}]},{"block_type":"text","content":", and chain them together in a suite for unittest to run."}]},{"block_type":"element","block":"k6bfv9vb","search_text":"As seen by running the second test run, there is a bug lurking in the third test method. We were not aware of it because the test suite was prematurely interrupted.","text_count":164,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As seen by running the second test run, there is a bug lurking in the third test method. We were not aware of it because the test suite was prematurely interrupted."}]},{"block_type":"element","block":"k6bfv9vc","search_text":"Another deficiency of Python's assert statement is shown by the first failure, as seen in the previous screenshot. When an assert fails, there is little to no information about the values that were compared. All we have is the line of code where it failed. The second assert in that screenshot was more useful, because we coded a custom checker that threw a custom AssertionError .","text_count":381,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another deficiency of Python's assert statement is shown by the first failure, as seen in the previous screenshot. When an assert fails, there is little to no information about the values that were compared. All we have is the line of code where it failed. The second assert in that screenshot was more useful, because we coded a custom checker that threw a custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"AssertionError"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9vd","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9ve","search_text":"Unittest does more than just run tests. It has a built-in mechanism to trap errors and failures, and then it continues running as much of our test suite as possible. This helps, because we can shake out more errors and fix more things within a given test run. This is especially important when a test suite grows to the point of taking minutes or hours to run.","text_count":360,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest does more than just run tests. It has a built-in mechanism to trap errors and failures, and then it continues running as much of our test suite as possible. This helps, because we can shake out more errors and fix more things within a given test run. This is especially important when a test suite grows to the point of taking minutes or hours to run."}]},{"block_type":"element","block":"k6bfv9vf","search_text":"Where are the bugs?","text_count":19,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Where are the bugs?"}]},{"block_type":"element","block":"k6bfv9vg","search_text":"They exist in the test methods, and fundamentally were made by making slight alterations to the Roman numeral being converted, as shown in the code:","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"They exist in the test methods, and fundamentally were made by making slight alterations to the Roman numeral being converted, as shown in the code:"}]},{"block_type":"element","block":"k6bfv9vh","search_text":"def combo_test1(self): print (\"+++ Converting MMX to 2010\") assert self.cvt.convert_to_decimal(\"MMXX\") == 2010 def combo_test2(self): print (\"+++ Converting MMMMDCLXVIII to 4668\") val = self.cvt.convert_to_decimal(\"MMMMDCLXVII\") self.check(val, 4668) ","text_count":251,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def combo_test1(self): \n    print (\"+++ Converting MMX to 2010\") \n    assert self.cvt.convert_to_decimal(\"MMXX\") == 2010 \ndef combo_test2(self): \n    print (\"+++ Converting MMMMDCLXVIII to 4668\")\n    val = self.cvt.convert_to_decimal(\"MMMMDCLXVII\") \n    self.check(val, 4668)"}]}]},{"block_type":"element","block":"k6bfv9vi","search_text":"The combo_test1 test method prints out that it is converting MMX , but actually tries to convert MMXX . The combo_test2 test method prints out that it is converting MMMMDCLXVIII , but actually tries to convert MMMMDCLXVII .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"combo_test1"}]},{"block_type":"text","content":"test method prints out that it is converting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MMX"}]},{"block_type":"text","content":", but actually tries to convert"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MMXX"}]},{"block_type":"text","content":". The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"combo_test2"}]},{"block_type":"text","content":"test method prints out that it is converting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MMMMDCLXVIII"}]},{"block_type":"text","content":", but actually tries to convert"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MMMMDCLXVII"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9vj","search_text":"This is a contrived example, but have you ever run into bugs just as small that drove you mad trying to track them down? The point is, showing how easy or hard it can be to track them down is based on how the values are checked. Python's assert statement isn't very effective at telling us what values are compared where. The customized check method is much better at pinpointing the problem with combo_test2 .","text_count":410,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is a contrived example, but have you ever run into bugs just as small that drove you mad trying to track them down? The point is, showing how easy or hard it can be to track them down is based on how the values are checked. Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"statement isn't very effective at telling us what values are compared where. The customized"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"check"}]},{"block_type":"text","content":"method is much better at pinpointing the problem with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"combo_test2"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9vk","search_text":"Note This highlights the problem with having comments or print statements trying to reflect what the asserts do. They can easily get out of sync and the developer may face some problems trying to track down bugs. Avoiding this situation is known as the DRY principle ( Don't Repeat Yourself ). ","text_count":294,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This highlights the problem with having comments or print statements trying to reflect what the asserts do. They can easily get out of sync and the developer may face some problems trying to track down bugs. Avoiding this situation is known as the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DRY"}]},{"block_type":"text","content":"principle ("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Don't Repeat Yourself"}]},{"block_type":"text","content":")."}]}]},{"block_type":"element","block":"k6bfv9vl","search_text":"FunctionTestCase is a temporary measure","text_count":39,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"FunctionTestCase is a temporary measure"}]},{"block_type":"element","block":"k6bfv9vm","search_text":"FunctionTestCase is a test case that provides an easy way to quickly migrate tests based on Python's assert statement, so they can be run with unittest. But things shouldn't stop there. If we take the time to convert RomanNumeralTester into a unittest TestCase , then we gain access to other useful features such as the various assert* methods that come with TestCase . It's a good investment. The FunctionTestCase just lowers the bar to migrate to unittest.","text_count":458,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FunctionTestCase"}]},{"block_type":"text","content":"&nbsp;is a test case that provides an easy way to quickly migrate tests based on Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"statement, so they can be run with unittest. But things shouldn't stop there. If we take the time to convert"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RomanNumeralTester"}]},{"block_type":"text","content":"into a unittest"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestCase"}]},{"block_type":"text","content":", then we gain access to other useful features such as the various"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert*"}]},{"block_type":"text","content":"methods that come with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TestCase"}]},{"block_type":"text","content":". It's a good investment. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FunctionTestCase"}]},{"block_type":"text","content":"just lowers the bar to migrate to unittest."}]},{"block_type":"element","block":"k6bfv9vn","search_text":"Breaking down obscure tests into simple ones","text_count":44,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Breaking down obscure tests into simple ones"}]},{"block_type":"element","block":"k6bfv9vo","search_text":"Unittest provides the means to test the code through a series of assertions. I have often felt the temptation to exercise many aspects of a particular piece of code within a single test method. If any part fails, it becomes obscured as to which part failed. It is preferable to split things up into several smaller test methods, so that when some part of the code under test fails, it is obvious.","text_count":396,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest provides the means to test the code through a series of assertions. I have often felt the temptation to exercise many aspects of a particular piece of code within a single test method. If any part fails, it becomes obscured as to which part failed. It is preferable to split things up into several smaller test methods, so that when some part of the code under test fails, it is obvious."}]},{"block_type":"element","block":"k6bfv9vp","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9vq","search_text":"With these steps, we will investigate what happens when we put too much into a single test method:","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will investigate what happens when we put too much into a single test method:"}]},{"block_type":"element","block":"k6bfv9vr","search_text":"Create a new file named recipe8.py to put out application code in for this recipe. ","text_count":83,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe8.py"}]},{"block_type":"text","content":"to put out application code in for this recipe."}]}]},{"block_type":"element","block":"k6bfv9vs","search_text":"Pick a class to test. In this case, we will use an alternative version of the Roman numeral converter, which converts both ways: ","text_count":129,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this case, we will use an alternative version of the Roman numeral converter, which converts both ways:"}]}]},{"block_type":"element","block":"k6bfv9vt","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] return val def convert_to_roman(self, decimal): val = \"\" while decimal > 1000: val += \"M\" decimal -= 1000 while decimal > 500: val += \"D\" decimal -= 500 while decimal > 100: val += \"C\" decimal -= 100 while decimal > 50: val += \"L\" decimal -= 50 while decimal > 10: val += \"X\" decimal -= 10 while decimal > 5: val += \"V\" decimal -= 5 while decimal > 1: val += \"I\" decimal -= 1 return val ","text_count":628,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n        self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n \n    def convert_to_decimal(self, roman_numeral): \n        val = 0 \n        for char in roman_numeral: \n        val += self.digit_map[char] \n    return val \n \n    def convert_to_roman(self, decimal): \n        val = \"\" \n    while decimal &gt; 1000: \n        val += \"M\" \n        decimal -= 1000 \n    while decimal &gt; 500: \n        val += \"D\"\n        decimal -= 500 \n    while decimal &gt; 100: \n        val += \"C\" \n        decimal -= 100 \n    while decimal &gt; 50: \n        val += \"L\" \n        decimal -= 50 \n    while decimal &gt; 10: \n        val += \"X\" \n        decimal -= 10 \n    while decimal &gt; 5: \n        val += \"V\" \n        decimal -= 5 \n    while decimal &gt; 1: \n        val += \"I\" \n        decimal -= 1 \n    return val"}]}]},{"block_type":"element","block":"k6bfv9vu","search_text":"Create a new file called recipe8_obscure.py to put some longer test methods. Create some test methods that combine several test assertions: ","text_count":140,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe8_obscure.py"}]},{"block_type":"text","content":"to put some longer test methods."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create some test methods that combine several test assertions:"}]}]},{"block_type":"element","block":"k6bfv9vv","search_text":"import unittest from recipe8 import * class RomanNumeralTest(unittest.TestCase): def setUp(self): self.cvt = RomanNumeralConverter() def test_convert_to_decimal(self): self.assertEquals(0, self.cvt.convert_to_decimal(\"\")) self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) self.assertEquals(2010, \\ self.cvt.convert_to_decimal(\"MMX\")) self.assertEquals(4000, \\ self.cvt.convert_to_decimal(\"MMMM\")) def test_convert_to_roman(self): self.assertEquals(\"\", self.cvt.convert_to_roman(0)) self.assertEquals(\"II\", self.cvt.convert_to_roman(2)) self.assertEquals(\"V\", self.cvt.convert_to_roman(5)) self.assertEquals(\"XII\", \\ self.cvt.convert_to_roman(12)) self.assertEquals(\"MMX\", \\ self.cvt.convert_to_roman(2010)) self.assertEquals(\"MMMM\", \\ self.cvt.convert_to_roman(4000)) if __name__ == \"__main__\": unittest.main()","text_count":815,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nfrom recipe8 import * \n \nclass RomanNumeralTest(unittest.TestCase): \n    def setUp(self): \n        self.cvt = RomanNumeralConverter() \n \n    def test_convert_to_decimal(self): \n        self.assertEquals(0, self.cvt.convert_to_decimal(\"\"))     \n        self.assertEquals(1, self.cvt.convert_to_decimal(\"I\"))    \n        self.assertEquals(2010, \\ \n            self.cvt.convert_to_decimal(\"MMX\")) \n        self.assertEquals(4000, \\ \n            self.cvt.convert_to_decimal(\"MMMM\")) \n    def test_convert_to_roman(self): \n        self.assertEquals(\"\", self.cvt.convert_to_roman(0)) \n        self.assertEquals(\"II\", self.cvt.convert_to_roman(2))     \n        self.assertEquals(\"V\", self.cvt.convert_to_roman(5))    \n        self.assertEquals(\"XII\", \\ \n            self.cvt.convert_to_roman(12)) \n        self.assertEquals(\"MMX\", \\ \n            self.cvt.convert_to_roman(2010)) \n        self.assertEquals(\"MMMM\", \\ \n            self.cvt.convert_to_roman(4000))\n \nif __name__ == \"__main__\":  \n    unittest.main()"}]}]},{"block_type":"element","block":"k6bfv9vw","search_text":"Run the obscure tests. Why did it fail? Where is the bug? It reports that II is not equal to I , so something appears to be off. Is this the only bug? Create another file called recipe8_clear.py to create a more fine-grained set of test methods. Take a look at this screenshot: ","text_count":278,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the obscure tests. Why did it fail? Where is the bug? It reports that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"II"}]},{"block_type":"text","content":"is not equal to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"I"}]},{"block_type":"text","content":", so something appears to be off. Is this the only bug? Create another file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe8_clear.py"}]},{"block_type":"text","content":"to create a more fine-grained set of test methods. Take a look at this screenshot:"},{"block_type":"element","tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000132.png","class":"lazyload"},"children":[]}]}]}]},{"block_type":"element","block":"k6bfv9vx","search_text":"Split up the assertions into separate test methods to give a higher fidelity of output: ","text_count":88,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Split up the assertions into separate test methods to give a higher fidelity of output:"}]}]},{"block_type":"element","block":"k6bfv9vy","search_text":"import unittest from recipe8 import * class RomanNumeralTest(unittest.TestCase): def setUp(self): self.cvt = RomanNumeralConverter() def test_to_decimal1(self): self.assertEquals(0, self.cvt.convert_to_decimal(\"\")) def test_to_decimal2(self): self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) def test_to_decimal3(self): self.assertEquals(2010, \\ self.cvt.convert_to_decimal(\"MMX\")) def test_to_decimal4(self): self.assertEquals(4000, \\ self.cvt.convert_to_decimal(\"MMMM\")) def test_convert_to_roman1(self): self.assertEquals(\"\", self.cvt.convert_to_roman(0)) def test_convert_to_roman2(self): self.assertEquals(\"II\", self.cvt.convert_to_roman(2)) def test_convert_to_roman3(self): self.assertEquals(\"V\", self.cvt.convert_to_roman(5)) def test_convert_to_roman4(self): self.assertEquals(\"XII\", \\ self.cvt.convert_to_roman(12)) def test_convert_to_roman5(self): self.assertEquals(\"MMX\", \\ self.cvt.convert_to_roman(2010)) def test_convert_to_roman6(self): self.assertEquals(\"MMMM\", \\ self.cvt.convert_to_roman(4000)) if __name__ == \"__main__\": unittest.main() ","text_count":1064,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \nfrom recipe8 import * \n \nclass RomanNumeralTest(unittest.TestCase): \n    def setUp(self): \n        self.cvt = RomanNumeralConverter() \n \n    def test_to_decimal1(self): \n        self.assertEquals(0, self.cvt.convert_to_decimal(\"\")) \n \n    def test_to_decimal2(self): \n        self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) \n \n    def test_to_decimal3(self): \n        self.assertEquals(2010, \\ \n            self.cvt.convert_to_decimal(\"MMX\")) \n \n    def test_to_decimal4(self): \n        self.assertEquals(4000, \\ \n            self.cvt.convert_to_decimal(\"MMMM\")) \n \n    def test_convert_to_roman1(self): \n        self.assertEquals(\"\", self.cvt.convert_to_roman(0)) \n\n    def test_convert_to_roman2(self): \n        self.assertEquals(\"II\", self.cvt.convert_to_roman(2)) \n\n    def test_convert_to_roman3(self): \n        self.assertEquals(\"V\", self.cvt.convert_to_roman(5)) \n\n    def test_convert_to_roman4(self): \n        self.assertEquals(\"XII\", \\ \n                    self.cvt.convert_to_roman(12)) \n \n    def test_convert_to_roman5(self): \n        self.assertEquals(\"MMX\", \\ \n                    self.cvt.convert_to_roman(2010)) \n \n    def test_convert_to_roman6(self): \n        self.assertEquals(\"MMMM\", \\ \n                    self.cvt.convert_to_roman(4000)) \n \nif __name__ == \"__main__\": \nunittest.main()"}]}]},{"block_type":"element","block":"k6bfv9vz","search_text":"Run the clearer test suite. Is it a bit clearer where the bug is? What did we trade in to get this higher degree of test failure? Was it worth the effort? Refer to this screenshot: ","text_count":181,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the clearer test suite. Is it a bit clearer where the bug is? What did we trade in to get this higher degree of test failure? Was it worth the effort? Refer to this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9w0","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000095.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9w1","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9w2","search_text":"In this case, we created a modified Roman numeral converter that converts both ways. We then started creating test methods to exercise things. Since each of these tests were a simple, one line assertion, it was convenient to put them all in the same test method.","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this case, we created a modified Roman numeral converter that converts both ways. We then started creating test methods to exercise things. Since each of these tests were a simple, one line assertion, it was convenient to put them all in the same test method."}]},{"block_type":"element","block":"k6bfv9w3","search_text":"In the second test case, we put each assertion into a separate test method. Running it exposes the fact that there are multiple bugs in this Roman numeral converter.","text_count":165,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the second test case, we put each assertion into a separate test method. Running it exposes the fact that there are multiple bugs in this Roman numeral converter."}]},{"block_type":"element","block":"k6bfv9w4","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9w5","search_text":"When we started off writing tests, it was very convenient to bundle all these assertions into a single test method. After all, if everything is working, there is no harm, right? But what if everything does not work; what do we have to deal with? An obscure error report!","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we started off writing tests, it was very convenient to bundle all these assertions into a single test method. After all, if everything is working, there is no harm, right? But what if everything does"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"work; what do we have to deal with? An obscure error report!"}]},{"block_type":"element","block":"k6bfv9w6","search_text":"Where is the bug?","text_count":17,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Where is the bug?"}]},{"block_type":"element","block":"k6bfv9w7","search_text":"The obscured test runner may not be clear. All we have to go on is II != I which isn't much. The clue is that it is only off by one. The clear test runner gives more clues. We see that V != IIII, XII != XI , and some more. Each of these failures shows things being off by one.","text_count":276,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The obscured test runner may not be clear. All we have to go on is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"II != I"}]},{"block_type":"text","content":"&nbsp;which isn't much. The clue is that it is only off by one. The clear test runner gives more clues. We see that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"V != IIII, XII != XI"}]},{"block_type":"text","content":", and some more. Each of these failures shows things being off by one."}]},{"block_type":"element","block":"k6bfv9w8","search_text":"The bug involves the various Boolean conditions in the while checks:","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The bug involves the various Boolean conditions in the while checks:"}]},{"block_type":"element","block":"k6bfv9w9","search_text":"while decimal > 1000: while decimal > 500: while decimal > 100: while decimal > 50: while decimal > 10: while decimal > 5: while decimal > 1:","text_count":141,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"while decimal &gt; 1000: \nwhile decimal &gt; 500: \nwhile decimal &gt; 100: \nwhile decimal &gt; 50: \nwhile decimal &gt; 10: \nwhile decimal &gt; 5: \nwhile decimal &gt; 1:"}]}]},{"block_type":"element","block":"k6bfv9wa","search_text":"Instead of testing greater than, it should test for greater than or equal to . This causes it to skip out of each Roman numeral before counting the last one.","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead of testing greater than, it should test for"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"greater than"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"equal to"}]},{"block_type":"text","content":". This causes it to skip out of each Roman numeral before counting the last one."}]},{"block_type":"element","block":"k6bfv9wb","search_text":"What is the right size for a test method?","text_count":41,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What is the right size for a test method?"}]},{"block_type":"element","block":"k6bfv9wc","search_text":"In this recipe, we broke things down to a single assertion per test. But I wouldn't advise thinking along these lines.","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we broke things down to a single assertion per test. But I wouldn't advise thinking along these lines."}]},{"block_type":"element","block":"k6bfv9wd","search_text":"If we look a little closer, each test method also involves a single usage of the Roman numeral API. For the converter, there is only one result to examine when exercising the code. For other systems, the output may be more complex. It is completely warranted to use several assertions in the same test method to check the outcome by making that single call.","text_count":357,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If we look a little closer, each test method also involves a single usage of the Roman numeral API. For the converter, there is only one result to examine when exercising the code. For other systems, the output may be more complex. It is completely warranted to use several assertions in the same test method to check the outcome by making that single call."}]},{"block_type":"element","block":"k6bfv9we","search_text":"When we proceed to make more calls to the Roman numeral API, it should signal us to consider splitting it off into a new test method.","text_count":133,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we proceed to make more calls to the Roman numeral API, it should signal us to consider splitting it off into a new test method."}]},{"block_type":"element","block":"k6bfv9wf","search_text":"This raises the question: What is a unit of code? There has been much debate over what defines a unit of code, and what makes a good unit test. There are many opinions. Hopefully, reading this chapter and weighing it against the other test tactics covered throughout this book will help you enhance your own opinion and ultimately improve your own testing talent.","text_count":363,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This raises the question:"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"What is a unit of code?"}]},{"block_type":"text","content":"There has been much debate over what defines a unit of code, and what makes a good unit test. There are many opinions. Hopefully, reading this chapter and weighing it against the other test tactics covered throughout this book will help you enhance your own opinion and ultimately improve your own testing talent."}]},{"block_type":"element","block":"k6bfv9wg","search_text":"Unittests versus integration tests","text_count":34,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Unittests versus integration tests"}]},{"block_type":"element","block":"k6bfv9wh","search_text":"Unittest can easily help us write both unittests as well as integration tests. Unittests exercise smaller blocks of code. When writing unittests, it is best to keep the testing as small and fine-grained as possible. Breaking testing up into lots of smaller tests is often a better approach to detecting and pinpointing bugs.","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest can easily help us write both unittests as well as integration tests. Unittests exercise smaller blocks of code. When writing unittests, it is best to keep the testing as small and fine-grained as possible. Breaking testing up into lots of smaller tests is often a better approach to detecting and pinpointing bugs."}]},{"block_type":"element","block":"k6bfv9wi","search_text":"When we move up to a higher level (such as integration testing), it makes sense to test multiple steps in a single test method. But this is only recommended if there are adequate low-level unit tests. This will shed some light on whether it is broken at the unit level, or there exists a sequence of steps that causes the error.","text_count":328,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we move up to a higher level (such as integration testing), it makes sense to test multiple steps in a single test method. But this is only recommended if there are adequate low-level unit tests. This will shed some light on whether it is broken at the unit level, or there exists a sequence of steps that causes the error."}]},{"block_type":"element","block":"k6bfv9wj","search_text":"Integration tests often extend to things such as external systems. For example, many argue that unit testing should never connect to a database, talk to an LDAP server, or interact with other systems.","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Integration tests often extend to things such as external systems. For example, many argue that unit testing should never connect to a database, talk to an LDAP server, or interact with other systems."}]},{"block_type":"element","block":"k6bfv9wk","search_text":"Note Just because we are using unittest doesn't mean the tests we are writing are unit tests. Later in this book, we will visit the concept that unittest can be used to write many types of tests including integration tests, smoke tests, and other types as well. ","text_count":262,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Just because we are using unittest doesn't mean the tests we are writing are unit tests. Later in this book, we will visit the concept that unittest can be used to write many types of tests including integration tests, smoke tests, and other types as well."}]}]},{"block_type":"element","block":"k6bfv9wl","search_text":"Testing the edges","text_count":17,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]},{"block_type":"element","block":"k6bfv9wm","search_text":"When we write automated tests, we pick the inputs and assert the expected outputs. It is important to test the limits of the inputs to make sure our code can handle good and bad inputs. This is also known as testing corner cases .","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we write automated tests, we pick the inputs and assert the expected outputs. It is important to test the limits of the inputs to make sure our code can handle good and bad inputs. This is also known as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"testing corner cases"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9wn","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9wo","search_text":"As we dig into this recipe, we will look for good boundaries to test against:","text_count":77,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As we dig into this recipe, we will look for good boundaries to test against:"}]},{"block_type":"element","block":"k6bfv9wp","search_text":"Create a new file named recipe9.py for the code in this recipe. Pick a class to test. In this recipe, we'll use another variation of our Roman numeral converter. This one doesn't process values greater than 4000 : ","text_count":214,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe9.py"}]},{"block_type":"text","content":"for the code in this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this recipe, we'll use another variation of our Roman numeral converter. This one doesn't process values greater than"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfv9wq","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] if val > 4000: raise Exception(\"We don't handle values over 4000\") return val def convert_to_roman(self, decimal): if decimal > 4000: raise Exception(\"We don't handle values over 4000\") val = \"\" mappers = [(1000,\"M\"), (500,\"D\"), (100,\"C\"), (50,\"L\"), (10,\"X\"), (5,\"V\"), (1,\"I\")] for (mapper_dec, mapper_rom) in mappers: while decimal >= mapper_dec: val += mapper_rom decimal -= mapper_dec return val ","text_count":640,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n      self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n    def convert_to_decimal(self, roman_numeral): \n        val = 0 \n        for char in roman_numeral: \n            val += self.digit_map[char] \n        if val &gt; 4000: \n        raise Exception(\"We don't handle values over 4000\") \n    return val\n \n    def convert_to_roman(self, decimal): \n        if decimal &gt; 4000: \n            raise Exception(\"We don't handle values over 4000\") \n        val = \"\" \n        mappers = [(1000,\"M\"), (500,\"D\"), (100,\"C\"), (50,\"L\"), \n(10,\"X\"), (5,\"V\"), (1,\"I\")] \n        for (mapper_dec, mapper_rom) in mappers: \n            while decimal &gt;= mapper_dec: \n                val += mapper_rom \n                decimal -= mapper_dec \n        return val"}]}]},{"block_type":"element","block":"k6bfv9wr","search_text":"Create a test case that sets up an instance of the Roman numeral converter: ","text_count":76,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that sets up an instance of the Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9ws","search_text":"import unittest class RomanNumeralTest(unittest.TestCase): def setUp(self): self.cvt = RomanNumeralConverter() ","text_count":111,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \n \nclass RomanNumeralTest(unittest.TestCase): \n    def setUp(self): \n      self.cvt = RomanNumeralConverter()"}]}]},{"block_type":"element","block":"k6bfv9wt","search_text":"Add several test methods that exercise the edges of converting to Roman numeral notation: ","text_count":90,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add several test methods that exercise the edges of converting to Roman numeral notation:"}]}]},{"block_type":"element","block":"k6bfv9wu","search_text":"def test_to_roman_bottom(self): self.assertEquals(\"I\", self.cvt.convert_to_roman(1)) def test_to_roman_below_bottom(self): self.assertEquals(\"\", self.cvt.convert_to_roman(0)) def test_to_roman_negative_value(self): self.assertEquals(\"\", self.cvt.convert_to_roman(-1)) def test_to_roman_top(self): self.assertEquals(\"MMMM\", \\ self.cvt.convert_to_roman(4000)) def test_to_roman_above_top(self): self.assertRaises(Exception, \\ self.cvt.convert_to_roman, 4001) ","text_count":457,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_to_roman_bottom(self): \n    self.assertEquals(\"I\", self.cvt.convert_to_roman(1))  \n\ndef test_to_roman_below_bottom(self): \n    self.assertEquals(\"\", self.cvt.convert_to_roman(0)) \n\ndef test_to_roman_negative_value(self): \n    self.assertEquals(\"\", self.cvt.convert_to_roman(-1)) \n\ndef test_to_roman_top(self): \n    self.assertEquals(\"MMMM\", \\ \n                self.cvt.convert_to_roman(4000)) \n\ndef test_to_roman_above_top(self): \n    self.assertRaises(Exception, \\ \n                self.cvt.convert_to_roman, 4001)"}]}]},{"block_type":"element","block":"k6bfv9wv","search_text":"Add several test methods that exercise the edges of converting to decimal notation: ","text_count":84,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add several test methods that exercise the edges of converting to decimal notation:"}]}]},{"block_type":"element","block":"k6bfv9ww","search_text":"def test_to_decimal_bottom(self): self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) def test_to_decimal_below_bottom(self): self.assertEquals(0, self.cvt.convert_to_decimal(\"\")) def test_to_decimal_top(self): self.assertEquals(4000, \\ self.cvt.convert_to_decimal(\"MMMM\")) def test_to_decimal_above_top(self): self.assertRaises(Exception, \\ self.cvt.convert_to_decimal, \"MMMMI\")","text_count":382,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_to_decimal_bottom(self): \n    self.assertEquals(1, self.cvt.convert_to_decimal(\"I\")) \n\ndef test_to_decimal_below_bottom(self): \n    self.assertEquals(0, self.cvt.convert_to_decimal(\"\")) \n\ndef test_to_decimal_top(self):  \n    self.assertEquals(4000, \\ \n                self.cvt.convert_to_decimal(\"MMMM\")) \n\ndef test_to_decimal_above_top(self):      \n    self.assertRaises(Exception, \\ \n                self.cvt.convert_to_decimal, \"MMMMI\")"}]}]},{"block_type":"element","block":"k6bfv9wx","search_text":"Add some tests that exercise the tiers of converting decimals to Roman numerals: ","text_count":81,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some tests that exercise the tiers of converting decimals to Roman numerals:"}]}]},{"block_type":"element","block":"k6bfv9wy","search_text":"def test_to_roman_tier1(self): self.assertEquals(\"V\", self.cvt.convert_to_roman(5)) def test_to_roman_tier2(self): self.assertEquals(\"X\", self.cvt.convert_to_roman(10)) def test_to_roman_tier3(self): self.assertEquals(\"L\", self.cvt.convert_to_roman(50)) def test_to_roman_tier4(self): self.assertEquals(\"C\", self.cvt.convert_to_roman(100)) def test_to_roman_tier5(self): self.assertEquals(\"D\", self.cvt.convert_to_roman(500)) def test_to_roman_tier6(self): self.assertEquals(\"M\", \\ self.cvt.convert_to_roman(1000)) ","text_count":515,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_to_roman_tier1(self): \n    self.assertEquals(\"V\", self.cvt.convert_to_roman(5)) \n \ndef test_to_roman_tier2(self): \n    self.assertEquals(\"X\", self.cvt.convert_to_roman(10)) \n \ndef test_to_roman_tier3(self): \n    self.assertEquals(\"L\", self.cvt.convert_to_roman(50)) \n \ndef test_to_roman_tier4(self): \n    self.assertEquals(\"C\", self.cvt.convert_to_roman(100)) \n \ndef test_to_roman_tier5(self): \n    self.assertEquals(\"D\", self.cvt.convert_to_roman(500)) \n \ndef test_to_roman_tier6(self): \n    self.assertEquals(\"M\", \\ \n                self.cvt.convert_to_roman(1000))"}]}]},{"block_type":"element","block":"k6bfv9wz","search_text":"Add some tests that input unexpected values to the Roman numeral converter: ","text_count":76,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some tests that input unexpected values to the Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9x0","search_text":"def test_to_roman_bad_inputs(self): self.assertEquals(\"\", self.cvt.convert_to_roman(None)) self.assertEquals(\"I\", self.cvt.convert_to_roman(1.2)) def test_to_decimal_bad_inputs(self): self.assertRaises(TypeError, \\ self.cvt.convert_to_decimal, None) self.assertRaises(TypeError, \\ self.cvt.convert_to_decimal, 1.2) ","text_count":315,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_to_roman_bad_inputs(self): \n    self.assertEquals(\"\", self.cvt.convert_to_roman(None))     \n    self.assertEquals(\"I\", self.cvt.convert_to_roman(1.2)) \n\ndef test_to_decimal_bad_inputs(self):   \n    self.assertRaises(TypeError, \\ \n                self.cvt.convert_to_decimal, None) \n    self.assertRaises(TypeError, \\ \n                self.cvt.convert_to_decimal, 1.2)"}]}]},{"block_type":"element","block":"k6bfv9x1","search_text":"Add a unit test runner: ","text_count":24,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a unit test runner:"}]}]},{"block_type":"element","block":"k6bfv9x2","search_text":"if __name__ == \"__main__\": unittest.main() ","text_count":43,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n  unittest.main()"}]}]},{"block_type":"element","block":"k6bfv9x3","search_text":"Run the test case. Take a look at this screenshot: ","text_count":51,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test case. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9x4","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000040.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9x5","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9x6","search_text":"We have a specialized Roman numeral converter that only converts values up to MMMM or 4000 . We have written several test methods to exercise it. The immediate edges we write tests for are 1 and 4000 . We also write some tests for one step past that: 0 and 4001 . To make things complete, we also test against -1 .","text_count":314,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have a specialized Roman numeral converter that only converts values up to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MMMM"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":". We have written several test methods to exercise it. The immediate edges we write tests for are"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":". We also write some tests for one step past that:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4001"}]},{"block_type":"text","content":". To make things complete, we also test against"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-1"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9x7","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9x8","search_text":"A key part of the algorithm involves handling the various tiers of Roman numerals (5, 10, 50, 100, 500, and 1000). These could be considered mini-edges , so we wrote tests to check that the code handled those as well. Do you think we should test one past the mini-edges?","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A key part of the algorithm involves handling the various tiers of Roman numerals (5, 10, 50, 100, 500, and 1000). These could be considered"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"mini-edges"}]},{"block_type":"text","content":", so we wrote tests to check that the code handled those as well. Do you think we should test one past the mini-edges?"}]},{"block_type":"element","block":"k6bfv9x9","search_text":"It's recommended we should. Many bugs erupt due to coding greater than , when it should be greater than or equal (or vice versa), and so on. Testing one past the boundary, in both directions, is the perfect way to make sure that things are working exactly as expected. We also need to check bad inputs, so we tried converting None and a float .","text_count":344,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's recommended we should. Many bugs erupt due to coding"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"greater than"}]},{"block_type":"text","content":", when it should be"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"greater than or equal"}]},{"block_type":"text","content":"(or vice versa), and so on. Testing one past the boundary, in both directions, is the perfect way to make sure that things are working exactly as expected. We also need to check bad inputs, so we tried converting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"and a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"float"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9xa","search_text":"That previous statement raises an important question: How many invalid types should we test against ? Because Python is dynamic, we can expect a lot of input types. So, what is reasonable? If our code hinges on a dictionary lookup, such as certain parts of our Roman numeral API does, then confirming that we correctly handle a KeyError would probably be adequate. We don't need to input lots of different types if they all result in a KeyError .","text_count":446,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That previous statement raises an important question:"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How many invalid types should"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"we test against"}]},{"block_type":"text","content":"? Because Python is dynamic, we can expect a lot of input types. So, what is reasonable? If our code hinges on a dictionary lookup, such as certain parts of our Roman numeral API does, then confirming that we correctly handle a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"KeyError"}]},{"block_type":"text","content":"would probably be adequate. We don't need to input lots of different types if they all result in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"KeyError"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9xb","search_text":"Identifying the edges is important","text_count":34,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Identifying the edges is important"}]},{"block_type":"element","block":"k6bfv9xc","search_text":"It's important to identify the edges of our system, because we need to know our software can handle these boundaries. We also need to know it can handle both sides of these boundaries that are good values and bad values. That is why we need to check 4000 and 4001 as well as 0 and 1 . This is a common place where software breaks.","text_count":330,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to identify the edges of our system, because we need to know our software can handle these boundaries. We also need to know it can handle both sides of these boundaries that are good values and bad values. That is why we need to check"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4001"}]},{"block_type":"text","content":"as well as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":". This is a common place where software breaks."}]},{"block_type":"element","block":"k6bfv9xd","search_text":"Testing for unexpected conditions","text_count":33,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Testing for unexpected conditions"}]},{"block_type":"element","block":"k6bfv9xe","search_text":"Does this sound a little awkward? Expect the unexpected? Our code involves converting integers and strings back and forth. By unexpected, we mean types of inputs passed in when someone uses our library that doesn't understand the edges, or wires it to receive inputs that are wider ranging types than we expected to receive.","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does this sound a little awkward? Expect the unexpected? Our code involves converting integers and strings back and forth. By unexpected, we mean types of inputs passed in when someone uses our library that doesn't understand the edges, or wires it to receive inputs that are wider ranging types than we expected to receive."}]},{"block_type":"element","block":"k6bfv9xf","search_text":"A common occurrence of misuse is when a user of our API is working against a collection, such as a list, and accidentally passes the entire list instead of a single value by iteration. Another, often seen situation is when a user of our API passes in None due to some other bug in their code. It's good to know that our API is resilient enough to handle this.","text_count":359,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common occurrence of misuse is when a user of our API is working against a collection, such as a list, and accidentally passes the entire list instead of a single value by iteration. Another, often seen situation is when a user of our API passes in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"due to some other bug in their code. It's good to know that our API is resilient enough to handle this."}]},{"block_type":"element","block":"k6bfv9xg","search_text":"Testing corner cases by iteration","text_count":33,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing corner cases by iteration"}]},{"block_type":"element","block":"k6bfv9xh","search_text":"While developing code, new corner-case inputs are often discovered. Being able to capture these inputs in an iterable array makes it easy to add related test methods.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While developing code, new corner-case inputs are often discovered. Being able to capture these inputs in an iterable array makes it easy to add related test methods."}]},{"block_type":"element","block":"k6bfv9xi","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9xj","search_text":"In this recipe, we will look at a different way to test corner cases:","text_count":69,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will look at a different way to test corner cases:"}]},{"block_type":"element","block":"k6bfv9xk","search_text":"Create a new file called recipe10.py for our code in this recipe. Pick a class to test. In this recipe, we'll use another variation of our Roman numeral converter. This one doesn't process values greater than 4000 : ","text_count":216,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe10.py"}]},{"block_type":"text","content":"for our code in this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick a class to test. In this recipe, we'll use another variation of our Roman numeral converter. This one doesn't process values greater than"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfv9xl","search_text":"class RomanNumeralConverter(object): def __init__(self): self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} def convert_to_decimal(self, roman_numeral): val = 0 for char in roman_numeral: val += self.digit_map[char] if val > 4000: raise Exception(\\ \"We don't handle values over 4000\") return val def convert_to_roman(self, decimal): if decimal > 4000: raise Exception(\\ \"We don't handle values over 4000\") val = \"\" mappers = [(1000,\"M\"), (500,\"D\"), (100,\"C\"), (50,\"L\"), (10,\"X\"), (5,\"V\"), (1,\"I\")] for (mapper_dec, mapper_rom) in mappers: while decimal >= mapper_dec: val += mapper_rom decimal -= mapper_dec return val ","text_count":644,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class RomanNumeralConverter(object): \n    def __init__(self): \n        self.digit_map = {\"M\":1000, \"D\":500, \"C\":100, \"L\":50, \"X\":10, \"V\":5, \"I\":1} \n \n    def convert_to_decimal(self, roman_numeral): \n        val = 0 \n        for char in roman_numeral: \n            val += self.digit_map[char] \n        if val &gt; 4000: \n            raise Exception(\\ \n                \"We don't handle values over 4000\") \n        return val \n\n    def convert_to_roman(self, decimal): \n        if decimal &gt; 4000: \n            raise Exception(\\ \n                \"We don't handle values over 4000\") \n        val = \"\"  \n        mappers = [(1000,\"M\"), (500,\"D\"), (100,\"C\"), (50,\"L\"), \n(10,\"X\"), (5,\"V\"), (1,\"I\")] \n        for (mapper_dec, mapper_rom) in mappers: \n            while decimal &gt;= mapper_dec: \n                val += mapper_rom \n                decimal -= mapper_dec \n        return val"}]}]},{"block_type":"element","block":"k6bfv9xm","search_text":"Create a test class to exercise the Roman numeral converter: ","text_count":61,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test class to exercise the Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9xn","search_text":"import unittest class RomanNumeralTest(unittest.TestCase): def setUp(self): self.cvt = RomanNumeralConverter()","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest \n \nclass RomanNumeralTest(unittest.TestCase): \n    def setUp(self): \n        self.cvt = RomanNumeralConverter()"}]}]},{"block_type":"element","block":"k6bfv9xo","search_text":"Write a test method that exercises the edges of the Roman numeral converter: ","text_count":77,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test method that exercises the edges of the Roman numeral converter:"}]}]},{"block_type":"element","block":"k6bfv9xp","search_text":"def test_edges(self): r = self.cvt.convert_to_roman d = self.cvt.convert_to_decimal edges = [(\"equals\", r, \"I\", 1),\\ (\"equals\", r, \"\", 0),\\ (\"equals\", r, \"\", -1),\\ (\"equals\", r, \"MMMM\", 4000),\\ (\"raises\", r, Exception, 4001),\\ (\"equals\", d, 1, \"I\"),\\ (\"equals\", d, 0, \"\"),\\ (\"equals\", d, 4000, \"MMMM\"),\\ (\"raises\", d, Exception, \"MMMMI\") ] [self.checkout_edge(edge) for edge in edges","text_count":383,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_edges(self): \n    r = self.cvt.convert_to_roman \n    d = self.cvt.convert_to_decimal \n    edges = [(\"equals\", r, \"I\", 1),\\ \n          (\"equals\", r, \"\", 0),\\ \n          (\"equals\", r, \"\", -1),\\ \n          (\"equals\", r, \"MMMM\", 4000),\\ \n          (\"raises\", r, Exception, 4001),\\ \n          (\"equals\", d, 1, \"I\"),\\ \n          (\"equals\", d, 0, \"\"),\\ \n          (\"equals\", d, 4000, \"MMMM\"),\\\n          (\"raises\", d, Exception, \"MMMMI\") \n         ] \n    [self.checkout_edge(edge) for edge in edges"}]}]},{"block_type":"element","block":"k6bfv9xq","search_text":"Create a test method that exercises the tiers converting from decimal to Roman numerals: ","text_count":89,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test method that exercises the tiers converting from decimal to Roman numerals:"}]}]},{"block_type":"element","block":"k6bfv9xr","search_text":"def test_tiers(self): r = self.cvt.convert_to_roman edges = [(\"equals\", r, \"V\", 5),\\ (\"equals\", r, \"VIIII\", 9),\\ (\"equals\", r, \"X\", 10),\\ (\"equals\", r, \"XI\", 11),\\ (\"equals\", r, \"XXXXVIIII\", 49),\\ (\"equals\", r, \"L\", 50),\\ (\"equals\", r, \"LI\", 51),\\ (\"equals\", r, \"LXXXXVIIII\", 99),\\ (\"equals\", r, \"C\", 100),\\ (\"equals\", r, \"CI\", 101),\\ (\"equals\", r, \"CCCCLXXXXVIIII\", 499),\\ (\"equals\", r, \"D\", 500),\\ (\"equals\", r, \"DI\", 501),\\ (\"equals\", r, \"M\", 1000)\\ ] [self.checkout_edge(edge) for edge in edges]","text_count":499,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_tiers(self):\n    r = self.cvt.convert_to_roman\n    edges = [(\"equals\", r, \"V\", 5),\\\n         (\"equals\", r, \"VIIII\", 9),\\\n         (\"equals\", r, \"X\", 10),\\\n         (\"equals\", r, \"XI\", 11),\\\n         (\"equals\", r, \"XXXXVIIII\", 49),\\\n         (\"equals\", r, \"L\", 50),\\\n         (\"equals\", r, \"LI\", 51),\\\n         (\"equals\", r, \"LXXXXVIIII\", 99),\\\n         (\"equals\", r, \"C\", 100),\\\n         (\"equals\", r, \"CI\", 101),\\\n         (\"equals\", r, \"CCCCLXXXXVIIII\", 499),\\\n         (\"equals\", r, \"D\", 500),\\\n         (\"equals\", r, \"DI\", 501),\\\n         (\"equals\", r, \"M\", 1000)\\\n        ]\n    [self.checkout_edge(edge) for edge in edges]"}]}]},{"block_type":"element","block":"k6bfv9xs","search_text":"Create a test method that exercises a set of invalid inputs: ","text_count":61,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test method that exercises a set of invalid inputs:"}]}]},{"block_type":"element","block":"k6bfv9xt","search_text":"def test_bad_inputs(self): r = self.cvt.convert_to_roman d = self.cvt.convert_to_decimal edges = [(\"equals\", r, \"\", None),\\ (\"equals\", r, \"I\", 1.2),\\ (\"raises\", d, TypeError, None),\\ (\"raises\", d, TypeError, 1.2)\\ ] [self.checkout_edge(edge) for edge in edges]","text_count":260,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_bad_inputs(self): \n    r = self.cvt.convert_to_roman \n    d = self.cvt.convert_to_decimal \n    edges = [(\"equals\", r, \"\", None),\\ \n        (\"equals\", r, \"I\", 1.2),\\ \n        (\"raises\", d, TypeError, None),\\ \n        (\"raises\", d, TypeError, 1.2)\\ \n       ] \n    [self.checkout_edge(edge) for edge in edges]"}]}]},{"block_type":"element","block":"k6bfv9xu","search_text":"Code a utility method that iterates over the edge cases and runs different assertions based on each edge: ","text_count":106,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Code a utility method that iterates over the edge cases and runs different assertions based on each edge:"}]}]},{"block_type":"element","block":"k6bfv9xv","search_text":"def checkout_edge(self, edge): if edge[0] == \"equals\": f, output, input = edge[1], edge[2], edge[3] print(\"Converting %s to %s...\" % (input, output)) self.assertEquals(output, f(input)) elif edge[0] == \"raises\": f, exception, args = edge[1], edge[2], edge[3:] print(\"Converting %s, expecting %s\" % \\ (args, exception)) self.assertRaises(exception, f, *args)","text_count":357,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def checkout_edge(self, edge): \n    if edge[0] == \"equals\": \n      f, output, input = edge[1], edge[2], edge[3]    \n      print(\"Converting %s to %s...\" % (input, output))    \n      self.assertEquals(output, f(input)) \n    elif edge[0] == \"raises\": \n      f, exception, args = edge[1], edge[2], edge[3:]    \n      print(\"Converting %s, expecting %s\" % \\ \n                      (args, exception)) \n      self.assertRaises(exception, f, *args)"}]}]},{"block_type":"element","block":"k6bfv9xw","search_text":"Make the script runnable by loading the test case into TextTestRunner : ","text_count":72,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make the script runnable by loading the test case into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TextTestRunner"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfv9xx","search_text":"if __name__ == \"__main__\": suite = unittest.TestLoader().loadTestsFromTestCase( \\ RomanNumeralTest) unittest.TextTestRunner(verbosity=2).run(suite)","text_count":147,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n    suite = unittest.TestLoader().loadTestsFromTestCase( \\    \n                RomanNumeralTest) \n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9xy","search_text":"Run the test case, as shown in this screenshot: ","text_count":48,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test case, as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfv9xz","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000079.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9y0","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9y1","search_text":"We have a specialized Roman numeral converter that only converts values up to MMMM or 4000 . The immediate edges we write tests for are 1 and 4000 . We also write some tests for one step past that: 0 and 4001 . To make things complete, we also test against -1 .","text_count":261,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have a specialized Roman numeral converter that only converts values up to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MMMM"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":". The immediate edges we write tests for are"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4000"}]},{"block_type":"text","content":". We also write some tests for one step past that:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4001"}]},{"block_type":"text","content":". To make things complete, we also test against"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-1"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9y2","search_text":"But we've written the tests a little differently. Instead of writing each test input/output combination as a separate test method, we capture the input and output values in a tuple that is embedded in a list. We then feed it to our test iterator, checkout_edge . Because we need both assertEqual and assertRaise calls, the tuple also includes either equals or raises to flag which assertion to use.","text_count":398,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But we've written the tests a little differently. Instead of writing each test input/output combination as a separate test method, we capture the input and output values in a tuple that is embedded in a list. We then feed it to our test iterator,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"checkout_edge"}]},{"block_type":"text","content":". Because we need both"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertEqual"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assertRaise"}]},{"block_type":"text","content":"calls, the tuple also includes either equals or raises to flag which assertion to use."}]},{"block_type":"element","block":"k6bfv9y3","search_text":"Finally, to make it flexibly handle the conversion of both Roman numerals and decimals, the handles on the convert_to_roman and convert_to_decimal functions of our Roman numeral API are embedded in each tuple as well.","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, to make it flexibly handle the conversion of both Roman numerals and decimals, the handles on the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"convert_to_roman"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"convert_to_decimal"}]},{"block_type":"text","content":"functions of our Roman numeral API are embedded in each tuple as well."}]},{"block_type":"element","block":"k6bfv9y4","search_text":"As shown in the following highlighted parts, we grab a handle on convert_to_roman and store it in r . Then we embed it in the third element of the highlighted tuple, allowing the checkout_edge function to call it when needed:","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As shown in the following highlighted parts, we grab a handle on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"convert_to_roman"}]},{"block_type":"text","content":"&nbsp;and store it in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r"}]},{"block_type":"text","content":". Then we embed it in the third element of the highlighted tuple, allowing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"checkout_edge"}]},{"block_type":"text","content":"function to call it when needed:"}]},{"block_type":"element","block":"k6bfv9y5","search_text":"def test_bad_inputs(self): r = self.cvt.convert_to_roman d = self.cvt.convert_to_decimal edges = [(\"equals\", r, \"\", None),\\ (\"equals\", r, \"I\", 1.2),\\ (\"raises\", d, TypeError, None),\\ (\"raises\", d, TypeError, 1.2)\\ ] [self.checkout_edge(edge) for edge in edges] ","text_count":261,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_bad_inputs(self): \n    r = self.cvt.convert_to_roman \n    d = self.cvt.convert_to_decimal \n    edges = [(\"equals\", r, \"\", None),\\ \n         (\"equals\", r, \"I\", 1.2),\\ \n         (\"raises\", d, TypeError, None),\\ \n         (\"raises\", d, TypeError, 1.2)\\ \n        ] \n \n    [self.checkout_edge(edge) for edge in edges]"}]}]},{"block_type":"element","block":"k6bfv9y6","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9y7","search_text":"A key part of the algorithm involves handling the various tiers of Roman numerals (5, 10, 50, 100, 500, and 1000). These could be considered mini-edges , so we wrote a separate test method that has a list of input/output values to check those out as well. In the Testing the edges recipe, we didn't include testing before and after these mini-edges, for example, 4 and 6 for 5 . Now that it only takes one line of data to capture this test, we have it in this recipe. The same was done for all the others (except 1000).","text_count":519,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A key part of the algorithm involves handling the various tiers of Roman numerals (5, 10, 50, 100, 500, and 1000). These could be considered"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"mini-edges"}]},{"block_type":"text","content":", so we wrote a separate test method that has a list of input/output values to check those out as well. In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]},{"block_type":"text","content":"recipe, we didn't include testing before and after these mini-edges, for example,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"6"}]},{"block_type":"text","content":"for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"5"}]},{"block_type":"text","content":". Now that it only takes one line of data to capture this test, we have it in this recipe. The same was done for all the others (except 1000)."}]},{"block_type":"element","block":"k6bfv9y8","search_text":"Finally, we need to check bad inputs, so we created one more test method where we try to convert None and a float to and from a Roman numeral.","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we need to check bad inputs, so we created one more test method where we try to convert"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"and a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"float"}]},{"block_type":"text","content":"to and from a Roman numeral."}]},{"block_type":"element","block":"k6bfv9y9","search_text":"Does this defy the recipe – breaking down obscure tests into simple ones?","text_count":73,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Does this defy the recipe&nbsp;&ndash; breaking down obscure tests into simple ones?"}]},{"block_type":"element","block":"k6bfv9ya","search_text":"In a way, it does. If something goes wrong in one of the test data entries, then that entire test method will have failed. That is one reason why this recipe split things up into three test methods instead of one big test method to cover them all. This is a judgment call about when it makes sense to view inputs and outputs as more data than test method. If you find the same sequence of test steps occurring repeatedly, consider if it makes sense to capture the values in some sort of table structure, such as a list used in this recipe.","text_count":539,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In a way, it does. If something goes wrong in one of the test data entries, then that entire test method will have failed. That is one reason why this recipe split things up into three test methods instead of one big test method to cover them all. This is a judgment call about when it makes sense to view inputs and outputs as more data than test method. If you find the same sequence of test steps occurring repeatedly, consider if it makes sense to capture the values in some sort of table structure, such as a list used in this recipe."}]},{"block_type":"element","block":"k6bfv9yb","search_text":"How does this compare with the recipe – testing the edges?","text_count":58,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"How does this compare with the recipe&nbsp;&ndash; testing the edges?"}]},{"block_type":"element","block":"k6bfv9yc","search_text":"In case it wasn't obvious, these are the exact same tests used in the Testing the edges recipe. The question is, which version do you find more readable? Both are perfectly acceptable. Breaking things up into separate methods makes it more fine-grained and easier to spot if something goes wrong. Collecting things together into a data structure, the way we did in this recipe, makes it more succinct and could spur us on to write more test combinations as we did for the conversion tiers.","text_count":489,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In case it wasn't obvious, these are the exact same tests used in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]},{"block_type":"text","content":"recipe. The question is, which version do you find more readable? Both are perfectly acceptable. Breaking things up into separate methods makes it more fine-grained and easier to spot if something goes wrong. Collecting things together into a data structure, the way we did in this recipe, makes it more succinct and could spur us on to write more test combinations as we did for the conversion tiers."}]},{"block_type":"element","block":"k6bfv9yd","search_text":"In my own opinion, when testing algorithmic functions that have simple inputs and outputs, it's more suitable to use this recipe's mechanism to code an entire battery of test inputs in this concise format. For example, a mathematical function, a sorting algorithm, or perhaps a transform function.","text_count":297,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In my own opinion, when testing algorithmic functions that have simple inputs and outputs, it's more suitable to use this recipe's mechanism to code an entire battery of test inputs in this concise format. For example, a mathematical function, a sorting algorithm, or perhaps a transform function."}]},{"block_type":"element","block":"k6bfv9ye","search_text":"When testing functions that are more logical and imperative, the other recipe may be more useful. For example, functions that interact with a database, cause changes in the state of the system, or other types of side effects that aren't encapsulated in the return value would be hard to capture using this recipe.","text_count":313,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When testing functions that are more logical and imperative, the other recipe may be more useful. For example, functions that interact with a database, cause changes in the state of the system, or other types of side effects that aren't encapsulated in the return value would be hard to capture using this recipe."}]},{"block_type":"element","block":"k6bfv9yf","search_text":"See also","text_count":8,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfv9yg","search_text":"Breaking down obscure tests into simple ones Testing the edges ","text_count":63,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Breaking down obscure tests into simple ones"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]}]}]}]},{"title":"Running Automated Test Suites with Nose","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3fs","number":2,"contents":[{"block_type":"element","block":"k6bfv9yh","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k6bfv9yi","search_text":"Getting nosy with testing Embedding nose inside Python Writing a nose extension to pick tests based on regular expressions Writing a nose extension to generate a CSV report Writing a project-level script that lets you run different test suites ","text_count":244,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Getting nosy with testing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Embedding nose inside Python"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a nose extension to pick tests based on regular expressions"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a nose extension to generate a CSV report"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a project-level script that lets you run different test suites"}]}]},{"block_type":"element","block":"k6bfv9yj","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfv9yk","search_text":"In the previous chapter, we looked at several ways to utilize unittest in creating automated tests. Now, we will look at different ways to gather tests together and run them. Nose is a useful utility that was built to discover tests and run them. It is flexible, can be run from either the command-line or embedded inside scripts, and is extensible through plugin. Due to its embeddable nature and high-level tools, such as project scripts, it can be built with testing as an option.","text_count":483,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous chapter, we looked at several ways to utilize unittest in creating automated tests. Now, we will look at different ways to gather tests together and run them. Nose is a useful utility that was built to discover tests and run them. It is flexible, can be run from either the command-line or embedded inside scripts, and is extensible through plugin. Due to its embeddable nature and high-level tools, such as project scripts, it can be built with testing as an option."}]},{"block_type":"element","block":"k6bfv9yl","search_text":"What does nose offer that unittest does not? Key things include automatic test discovery and a useful plugin API. There are many nose plugins that provide everything from specially formatted test reports to integration with other tools. We will explore this in more detail in this chapter and in later parts of this book.","text_count":321,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What does nose offer that unittest does not? Key things include automatic test discovery and a useful plugin API. There are many nose plugins that provide everything from specially formatted test reports to integration with other tools. We will explore this in more detail in this chapter and in later parts of this book."}]},{"block_type":"element","block":"k6bfv9ym","search_text":"Note For more information about nose refer to: http://somethingaboutorange.com/mrl/projects/nose . ","text_count":99,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more information about nose refer to:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://somethingaboutorange.com/mrl/projects/nose"},"children":[{"block_type":"text","content":"http://somethingaboutorange.com/mrl/projects/nose"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfv9yn","search_text":"We need to activate our virtual environment and then install nose for the recipes in this chapter.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to activate our virtual environment and then install nose for the recipes in this chapter."}]},{"block_type":"element","block":"k6bfv9yo","search_text":"Create a virtual environment, activate it, and verify that the tools are working:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Create a virtual environment, activate it, and verify that the tools are working:"}]},{"block_type":"element","block":"k6bfv9yp","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000094.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9yq","search_text":"Next, use pip install nose , as shown in the following screenshot:","text_count":66,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Next, use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip&nbsp;install nose"}]},{"block_type":"text","content":", as shown in the following screenshot:"}]},{"block_type":"element","block":"k6bfv9yr","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000054.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9ys","search_text":"Getting nosy with testing","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Getting nosy with testing"}]},{"block_type":"element","block":"k6bfv9yt","search_text":"Nose automatically discovers tests when fed with a package, a module, or a file.","text_count":80,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Nose automatically discovers tests when fed with a package, a module, or a file."}]},{"block_type":"element","block":"k6bfv9yu","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9yv","search_text":"With the following steps, we will explore how nose automatically finds test cases and runs them:","text_count":96,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will explore how nose automatically finds test cases and runs them:"}]},{"block_type":"element","block":"k6bfv9yw","search_text":"Create a new file called recipe11.py to store all the code for this recipe. Create a class to test. For this recipe, we will use a shopping cart application that lets us load items and then calculate the bill: ","text_count":210,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe11.py"}]},{"block_type":"text","content":"to store all the code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a class to test. For this recipe, we will use a shopping cart application that lets us load items and then calculate the bill:"}]}]},{"block_type":"element","block":"k6bfv9yx","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price def total(self, sales_tax): sum_price = sum([item.price for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return len(self.items) class Item(object): def __init__(self, item, price): self.item = item self.price = price","text_count":505,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n      def __init__(self):\n          self.items = []\n      def add(self, item, price):\n          self.items.append(Item(item, price))\n          return self\n     def item(self, index):\n          return self.items[index-1].item\n     def price(self, index):\n          return self.items[index-1].price\n     def total(self, sales_tax):\n          sum_price = sum([item.price for item in self.items])\n          return sum_price*(1.0 + sales_tax/100.0)\n     def __len__(self):\n          return len(self.items)\nclass Item(object):\n     def __init__(self, item, price):\n          self.item = item\n          self.price = price"}]}]},{"block_type":"element","block":"k6bfv9yy","search_text":"Create a test case that exercises the various parts of the shopping cart application: ","text_count":86,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that exercises the various parts of the shopping cart application:"}]}]},{"block_type":"element","block":"k6bfv9yz","search_text":"import unittest class ShoppingCartTest(unittest.TestCase): def setUp(self): self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) def test_length(self): self.assertEquals(1, len(self.cart)) def test_item(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) def test_price(self): self.assertEquals(15.00, self.cart.price(1)) def test_total_with_sales_tax(self): self.assertAlmostEquals(16.39, self.cart.total(9.25), 2)","text_count":426,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nclass ShoppingCartTest(unittest.TestCase):\n     def setUp(self):\n        self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00)\n     def test_length(self):\n        self.assertEquals(1, len(self.cart))\n     def test_item(self):\n        self.assertEquals(\"tuna sandwich\", self.cart.item(1))\n     def test_price(self):\n        self.assertEquals(15.00, self.cart.price(1))\n     def test_total_with_sales_tax(self):\n        self.assertAlmostEquals(16.39,\n        self.cart.total(9.25), 2)"}]}]},{"block_type":"element","block":"k6bfv9z0","search_text":"Use the command-line nosetests tool to run this recipe by filename and also by module: ","text_count":87,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the command-line"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"tool to run this recipe by filename and also by module:"}]}]},{"block_type":"element","block":"k6bfv9z1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000000.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9z2","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9z3","search_text":"We started off by creating a simple application that lets us load up a ShoppingCart with Items . This application lets us look up each item and its price. Finally, we can calculate the total billing amount including the sales tax.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We started off by creating a simple application that lets us load up a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":"with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Items"}]},{"block_type":"text","content":". This application lets us look up each item and its price. Finally, we can calculate the total billing amount including the sales tax."}]},{"block_type":"element","block":"k6bfv9z4","search_text":"Next, we coded some test methods to exercise all these features using unittest.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Next, we coded some test methods to exercise all these features using unittest."}]},{"block_type":"element","block":"k6bfv9z5","search_text":"Finally, we used the command-line nosetests tool, which discovers test cases and automatically runs them. This saved us from hand coding a test runner to load test suites.","text_count":171,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we used the command-line"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"tool, which discovers test cases and automatically runs them. This saved us from hand coding a test runner to load test suites."}]},{"block_type":"element","block":"k6bfv9z6","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9z7","search_text":"Why is it so important to not write the test runner? What do we gain by using nosetests ? After all, unittest gives us the ability to embed an auto-discovering test runner like this:","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why is it so important to not write the test runner? What do we gain by using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"? After all, unittest gives us the ability to embed an auto-discovering test runner like this:"}]},{"block_type":"element","block":"k6bfv9z8","search_text":"if __name__ == \"__main__\": unittest.main()","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n    unittest.main()"}]}]},{"block_type":"element","block":"k6bfv9z9","search_text":"Would the same block of code work if the tests are spread across several modules? No, because unittest.main() only looks in the current module. To grow into multiple modules, we need to start loading tests using unittest's loadTestsFromTestCase method or other customized suites. It doesn't matter how we assemble suites. When we risk missing test cases, nosetests conveniently lets us search for all tests, or a subset of tests if needed.","text_count":439,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Would the same block of code work if the tests are spread across several modules? No, because"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.main()"}]},{"block_type":"text","content":"only looks in the current module. To grow into multiple modules, we need to start loading tests using unittest's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"loadTestsFromTestCase"}]},{"block_type":"text","content":"method or other customized suites. It doesn't matter how we assemble suites. When we risk missing test cases,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"conveniently lets us search for all tests, or a subset of tests if needed."}]},{"block_type":"element","block":"k6bfv9za","search_text":"A common situation on projects is to spread out test cases between lots of modules. Instead of writing one big test case, we typically break things up into smaller test cases based on various setups, scenarios, and other logical groupings. It's a common practice to split up test cases based on which module is being tested. The point is that manually loading all the test cases for a real-world test suite can become labor-intensive.","text_count":434,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common situation on projects is to spread out test cases between lots of modules. Instead of writing one big test case, we typically break things up into smaller test cases based on various setups, scenarios, and other logical groupings. It's a common practice to split up test cases based on which module is being tested. The point is that manually loading all the test cases for a real-world test suite can become labor-intensive."}]},{"block_type":"element","block":"k6bfv9zb","search_text":"Nose is extensible","text_count":18,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Nose is extensible"}]},{"block_type":"element","block":"k6bfv9zc","search_text":"Auto-discovery of tests isn't the only reason to use nose. Later in this chapter, we will explore how we can write a plugin to customize what it discovers and also the output of a test run.","text_count":189,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Auto-discovery of tests isn't the only reason to use nose. Later in this chapter, we will explore how we can write a plugin to customize what it discovers and also the output of a test run."}]},{"block_type":"element","block":"k6bfv9zd","search_text":"Nose is embeddable","text_count":18,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Nose is embeddable"}]},{"block_type":"element","block":"k6bfv9ze","search_text":"All the functionality nose provides can be utilized either by the command-line, or from inside a Python script. We will also explore this further in this chapter.","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the functionality nose provides can be utilized either by the command-line, or from inside a Python script. We will also explore this further in this chapter."}]},{"block_type":"element","block":"k6bfv9zf","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfv9zg","search_text":"The Asserting the basics recipe in Chapter 1, Using Unittest to Develop Basic Tests .","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Asserting&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"the&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"basics"}]},{"block_type":"text","content":"recipe in Chapter&nbsp;1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic Tests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfv9zh","search_text":"Embedding nose inside Python","text_count":28,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Embedding nose inside Python"}]},{"block_type":"element","block":"k6bfv9zi","search_text":"It's very convenient to embed nose inside a Python script. This lets us create higher-level test tools besides allowing the developer to add testing to an existing tool.","text_count":169,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's very convenient to embed nose inside a Python script. This lets us create higher-level test tools besides allowing the developer to add testing to an existing tool."}]},{"block_type":"element","block":"k6bfv9zj","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfv9zk","search_text":"With these steps, we will explore using nose's API inside a Python script to run some tests:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore using nose's API inside a Python script to run some tests:"}]},{"block_type":"element","block":"k6bfv9zl","search_text":"Create a new file called recipe12.py to contain the code from this recipe. Create a class to test. For this recipe, we will use a shopping cart application that lets us load items and then calculate the bill: ","text_count":209,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe12.py"}]},{"block_type":"text","content":"to contain the code from this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a class to test. For this recipe, we will use a shopping cart application that lets us load items and then calculate the bill:"}]}]},{"block_type":"element","block":"k6bfv9zm","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price def total(self, sales_tax): sum_price = sum([item.price for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return len(self.items) class Item(object): def __init__(self, item, price): self.item = item self.price = price","text_count":505,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n   def __init__(self):\n      self.items = []\n   def add(self, item, price):\n      self.items.append(Item(item, price))\n      return self\n   def item(self, index):\n      return self.items[index-1].item\n   def price(self, index):\n      return self.items[index-1].price\n   def total(self, sales_tax):\n      sum_price = sum([item.price for item in self.items])\n      return sum_price*(1.0 + sales_tax/100.0)\n   def __len__(self):\n      return len(self.items)\nclass Item(object):\n   def __init__(self, item, price):\n      self.item = item\n      self.price = price"}]}]},{"block_type":"element","block":"k6bfv9zn","search_text":"Create a test case with several test methods: ","text_count":46,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case with several test methods:"}]}]},{"block_type":"element","block":"k6bfv9zo","search_text":"import unittest class ShoppingCartTest(unittest.TestCase): def setUp(self): self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) def test_length(self): self.assertEquals(1, len(self.cart)) def test_item(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) def test_price(self): self.assertEquals(15.00, self.cart.price(1)) def test_total_with_sales_tax(self): self.assertAlmostEquals(16.39, self.cart.total(9.25), 2)","text_count":426,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nclass ShoppingCartTest(unittest.TestCase):\n   def setUp(self): \n      self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00)\n   def test_length(self):\n      self.assertEquals(1, len(self.cart))\n   def test_item(self):\n      self.assertEquals(\"tuna sandwich\", self.cart.item(1))\n   def test_price(self):\n      self.assertEquals(15.00, self.cart.price(1))\n   def test_total_with_sales_tax(self):\n      self.assertAlmostEquals(16.39,\n      self.cart.total(9.25), 2)"}]}]},{"block_type":"element","block":"k6bfv9zp","search_text":"Create a script named recipe12_nose.py to use nose's API to run tests. Make the script runnable and use nose's run() method to run selected arguments: ","text_count":151,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a script named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe12_nose.py"}]},{"block_type":"text","content":"to use nose's API to run tests."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make the script runnable and use nose's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"run()"}]},{"block_type":"text","content":"method to run selected arguments:"}]}]},{"block_type":"element","block":"k6bfv9zq","search_text":"if __name__ == \"__main__\": import nose nose.run(argv=[\"\", \"recipe12\", \"--verbosity=2\"])","text_count":87,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import nose\n    nose.run(argv=[\"\", \"recipe12\", \"--verbosity=2\"])"}]}]},{"block_type":"element","block":"k6bfv9zr","search_text":"Run the test script from the command line and see the verbose output: ","text_count":70,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test script from the command line and see the verbose output:"}]}]},{"block_type":"element","block":"k6bfv9zs","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000044.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfv9zt","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfv9zu","search_text":"In the test running code, we are using nose.run() . With no arguments, it simply picks up on sys.argv and acts like the command-line nosetests . But in this recipe, we are plugging in the name of the current module along with increased verbosity.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the test running code, we are using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.run()"}]},{"block_type":"text","content":". With no arguments, it simply picks up on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sys.argv"}]},{"block_type":"text","content":"and acts like the command-line"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":". But in this recipe, we are plugging in the name of the current module along with increased verbosity."}]},{"block_type":"element","block":"k6bfv9zv","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfv9zw","search_text":"Unittest has unittest.main() , which discovers and runs test cases as well. How is this different? unittest.main() is geared to discover test cases in the same module where it is run. The nose.run() function is geared to let us pass in command-line arguments or load them programmatically.","text_count":289,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unittest has"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.main()"}]},{"block_type":"text","content":", which discovers and runs test cases as well. How is this different?"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.main()"}]},{"block_type":"text","content":"is geared to discover test cases in the same module where it is run. The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.run()"}]},{"block_type":"text","content":"&nbsp;function is geared to let us pass in command-line arguments or load them programmatically."}]},{"block_type":"element","block":"k6bfv9zx","search_text":"For example, look at the following steps; we must complete them to turn up verbosity with unittest:","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, look at the following steps; we must complete them to turn up verbosity with unittest:"}]},{"block_type":"element","block":"k6bfv9zy","search_text":"if __name__ == \"__main__\": import unittest from recipe12 import * suite = unittest.TestLoader().loadTestsFromTestCase( ShoppingCartTest) unittest.TextTestRunner(verbosity=2).run(suite) ","text_count":185,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n    import unittest \n    from recipe12 import * \n    suite = unittest.TestLoader().loadTestsFromTestCase( \n                                        ShoppingCartTest) \n    unittest.TextTestRunner(verbosity=2).run(suite)"}]}]},{"block_type":"element","block":"k6bfv9zz","search_text":"We had to import the test cases, use a test loader to create a test suite, and then run it through TextTestRunner .","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We had to import the test cases, use a test loader to create a test suite, and then run it through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TextTestRunner"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva00","search_text":"To do the same thing with nose, this is all we need:","text_count":52,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To do the same thing with nose, this is all we need:"}]},{"block_type":"element","block":"k6bfva01","search_text":"if __name__ == \"__main__\": import nose nose.run(argv=[\"\", \"recipe12\", \"--verbosity=2\"]) ","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n    import nose \n    nose.run(argv=[\"\", \"recipe12\", \"--verbosity=2\"])"}]}]},{"block_type":"element","block":"k6bfva02","search_text":"This is much more succinct. Any command-line options we could use with nosetests can be used here. This comes in handy when we use the the nose plugin, which we will explore in more detail in this chapter and throughout the rest of the book.","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is much more succinct. Any command-line options we could use with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"&nbsp;can&nbsp;be used here. This comes in handy when we use the the nose plugin, which we will explore in more detail in this chapter and throughout the rest of the book."}]},{"block_type":"element","block":"k6bfva03","search_text":"Writing a nose extension to pick tests based on regular expressions","text_count":67,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a nose extension to pick tests based on regular expressions"}]},{"block_type":"element","block":"k6bfva04","search_text":"Out-of-the-box test tools such as nose are very useful. But eventually, we reach a point where the options don't match our needs. Nose has the powerful ability to code custom plugins, and this gives us the ability to fine-tune nose to meet our needs. This recipe will help us write a plugin that allows us to selectively choose test methods by matching their method names using a regular expression when we run nosetests .","text_count":422,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Out-of-the-box test tools such as nose are very useful. But eventually, we reach a point where the options don't match our needs. Nose has the powerful ability to code custom plugins, and this gives us the ability to fine-tune nose to meet our needs. This recipe will help us write a plugin that allows us to selectively choose test methods by matching their method names using a regular expression when we run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva05","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfva06","search_text":"We need to have easy_install loaded in order to install the nose plugin that we are about to create. If you don't already have it, please visit http://pypi.python.org/pypi/setuptools to download and install the package as indicated at the site.","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to have"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"easy_install"}]},{"block_type":"text","content":"loaded in order to install the nose plugin that we are about to create. If you don't already have it, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pypi.python.org/pypi/setuptools"},"children":[{"block_type":"text","content":"http://pypi.python.org/pypi/setuptools"}]},{"block_type":"text","content":"to download and install the package as indicated at the site."}]},{"block_type":"element","block":"k6bfva07","search_text":"If you have just installed it now, then you will have to do the following:","text_count":74,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you have just installed it now, then you will have to do the following:"}]},{"block_type":"element","block":"k6bfva08","search_text":"Rebuild your virtualenv used for running code samples in this book Reinstall nose using pip ","text_count":92,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Rebuild your"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"used for running code samples in this book"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reinstall"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]}]}]},{"block_type":"element","block":"k6bfva09","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva0a","search_text":"With the following steps, we will code a nose plugin that picks test methods to run by using a regular expression:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will code a nose plugin that picks test methods to run by using a regular expression:"}]},{"block_type":"element","block":"k6bfva0b","search_text":"Create a new file called recipe13.py to store the code for this recipe. Create a shopping cart application that we can build some tests around: ","text_count":144,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe13.py"}]},{"block_type":"text","content":"to store the code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a shopping cart application that we can build some tests around:"}]}]},{"block_type":"element","block":"k6bfva0c","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price def total(self, sales_tax): sum_price = sum([item.price for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return len(self.items) class Item(object): def __init__(self, item, price): self.item = item self.price = price","text_count":505,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n   def __init__(self):\n     self.items = []\n   def add(self, item, price):\n     self.items.append(Item(item, price))\n     return self\n   def item(self, index):\n     return self.items[index-1].item\n   def price(self, index):\n     return self.items[index-1].price\n   def total(self, sales_tax):\n     sum_price = sum([item.price for item in self.items])\n     return sum_price*(1.0 + sales_tax/100.0)\n   def __len__(self):\n     return len(self.items)\nclass Item(object):\n   def __init__(self, item, price):\n     self.item = item\n     self.price = price"}]}]},{"block_type":"element","block":"k6bfva0d","search_text":"Create a test case that contains several test methods, including one that does not start with the word test : ","text_count":110,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that contains several test methods, including one that does not start with the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva0e","search_text":"import unittest class ShoppingCartTest(unittest.TestCase): def setUp(self): self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) def length(self): self.assertEquals(1, len(self.cart)) def test_item(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) def test_price(self): self.assertEquals(15.00, self.cart.price(1)) def test_total_with_sales_tax(self): self.assertAlmostEquals(16.39, self.cart.total(9.25), 2)","text_count":421,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nclass ShoppingCartTest(unittest.TestCase):\n   def setUp(self):\n     self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00)\n   def length(self):\n     self.assertEquals(1, len(self.cart))\n   def test_item(self):\n     self.assertEquals(\"tuna sandwich\", self.cart.item(1))\n   def test_price(self):\n     self.assertEquals(15.00, self.cart.price(1))\n   def test_total_with_sales_tax(self):\n     self.assertAlmostEquals(16.39,\n     self.cart.total(9.25), 2)"}]}]},{"block_type":"element","block":"k6bfva0f","search_text":"Run the module using nosetests from the command line, with verbosity turned on. How many test methods get run? How many test methods did we define? ","text_count":148,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the module using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"from the command line, with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"verbosity"}]},{"block_type":"text","content":"turned on. How many test methods get run? How many test methods did we define?"}]}]},{"block_type":"element","block":"k6bfva0g","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000034.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva0h","search_text":"Create a new file called recipe13_plugin.py to write a nose plugin for this recipe. ","text_count":84,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe13_plugin.py"}]},{"block_type":"text","content":"to write a nose plugin for this recipe."}]}]},{"block_type":"element","block":"k6bfva0i","search_text":"Capture a handle to sys.stderr to support debugging and verbose output: ","text_count":72,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Capture a handle to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sys.stderr"}]},{"block_type":"text","content":"to support debugging and verbose output:"}]}]},{"block_type":"element","block":"k6bfva0j","search_text":"import sys err = sys.stderr ","text_count":28,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import sys \nerr = sys.stderr"}]}]},{"block_type":"element","block":"k6bfva0k","search_text":"Create a nose plugin named RegexPicker by subclassing nose.plugins.Plugin : ","text_count":76,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a nose plugin named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RegexPicker"}]},{"block_type":"text","content":"by subclassing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.plugins.Plugin"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva0l","search_text":"import nose import re from nose.plugins import Plugin class RegexPicker(Plugin): name = \"regexpicker\" def __init__(self): Plugin.__init__(self) self.verbose = False","text_count":164,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import nose\nimport re\nfrom nose.plugins import Plugin\nclass RegexPicker(Plugin):\n   name = \"regexpicker\"\n   def __init__(self):\n      Plugin.__init__(self)\n      self.verbose = False"}]}]},{"block_type":"element","block":"k6bfva0m","search_text":"Our nose plugin requires a class-level name. This is used to define the with-<name> command-line option.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Our nose plugin requires a class-level name. This is used to define the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with-&lt;name&gt;"}]},{"block_type":"text","content":"command-line option."}]},{"block_type":"element","block":"k6bfva0n","search_text":"Override Plugin.options and add an option to provide the pattern on the command line: ","text_count":86,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.options"}]},{"block_type":"text","content":"and add an option to provide the pattern on the command line:"}]}]},{"block_type":"element","block":"k6bfva0o","search_text":"def options(self, parser, env): Plugin.options(self, parser, env) parser.add_option(\"--re-pattern\", dest=\"pattern\", action=\"store\", default=env.get(\"NOSE_REGEX_PATTERN\", \"test.*\"), help=(\"Run test methods that have a method name matching this regular expression\"))","text_count":264,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def options(self, parser, env):\n    Plugin.options(self, parser, env)\n    parser.add_option(\"--re-pattern\",\n       dest=\"pattern\", action=\"store\",\n       default=env.get(\"NOSE_REGEX_PATTERN\", \"test.*\"),\n       help=(\"Run test methods that have a method name matching this regular expression\"))"}]}]},{"block_type":"element","block":"k6bfva0p","search_text":"Override Plugin.configuration by having it fetch the pattern and verbosity: ","text_count":76,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.configuration"}]},{"block_type":"text","content":"by having it fetch the pattern and verbosity:"}]}]},{"block_type":"element","block":"k6bfva0q","search_text":"def configure(self, options, conf): Plugin.configure(self, options, conf) self.pattern = options.pattern if options.verbosity >= 2: self.verbose = True if self.enabled: err.write(\"Pattern for matching test methods is %sn\" % self.pattern)","text_count":237,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def configure(self, options, conf):\n     Plugin.configure(self, options, conf)\n     self.pattern = options.pattern\n     if options.verbosity &gt;= 2:\n        self.verbose = True\n        if self.enabled:\n           err.write(\"Pattern for matching test methods is %sn\" % self.pattern)"}]}]},{"block_type":"element","block":"k6bfva0r","search_text":"When we extend Plugin , we inherit some other features, such as self.enabled , which is switched on when -with-<name> is used with nose.","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we extend"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin"}]},{"block_type":"text","content":", we inherit some other features, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self.enabled"}]},{"block_type":"text","content":", which is switched on when"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-with-&lt;name&gt;"}]},{"block_type":"text","content":"is used with nose."}]},{"block_type":"element","block":"k6bfva0s","search_text":"Override Plugin.wantedMethod so that it accepts test methods that match our regular expression: ","text_count":96,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.wantedMethod"}]},{"block_type":"text","content":"&nbsp;so that it accepts test methods that match our regular expression:"}]}]},{"block_type":"element","block":"k6bfva0t","search_text":"def wantMethod(self, method): wanted = re.match(self.pattern, method.func_name) is not None if self.verbose and wanted: err.write(\"nose will run %sn\" % method.func_name) return wanted","text_count":183,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def wantMethod(self, method):\n   wanted =\n     re.match(self.pattern, method.func_name) is not None\n   if self.verbose and wanted:\n      err.write(\"nose will run %sn\" % method.func_name)\n   return wanted"}]}]},{"block_type":"element","block":"k6bfva0u","search_text":"Write a test runner that programmatically tests our plugin by running the same test case that we ran earlier:","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Write a test runner that programmatically tests our plugin by running the same test case that we ran earlier:"}]},{"block_type":"element","block":"k6bfva0v","search_text":"if __name__ == \"__main__\": args = [\"\", \"recipe13\", \"--with-regexpicker\", \"--re-pattern=test.*|length\", \"--verbosity=2\"] print \"With verbosity...\" print \"====================\" nose.run(argv=args, plugins=[RegexPicker()]) print \"Without verbosity...\" print \"====================\" args = args[:-1] nose.run(argv=args, plugins=[RegexPicker()])","text_count":339,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n     args = [\"\", \"recipe13\", \"--with-regexpicker\", \"--re-pattern=test.*|length\", \"--verbosity=2\"]\n     print \"With verbosity...\"\n     print \"====================\"\n     nose.run(argv=args, plugins=[RegexPicker()])\n     print \"Without verbosity...\"\n     print \"====================\"\n     args = args[:-1]\n     nose.run(argv=args, plugins=[RegexPicker()])"}]}]},{"block_type":"element","block":"k6bfva0w","search_text":"Execute the test runner. Looking at the results in the following screenshot, how many test methods ran this time? ","text_count":114,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Execute the test runner. Looking at the results in the following screenshot, how many test methods ran this time?"}]}]},{"block_type":"element","block":"k6bfva0x","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000023.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva0y","search_text":"Create a setup.py script that allows us to install and register our plugin with nosetests : ","text_count":92,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py"}]},{"block_type":"text","content":"script that allows us to install and register our plugin with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva0z","search_text":"import sys try: import ez_setup ez_setup.use_setuptools() except ImportError: pass from setuptools import setup setup( name=\"RegexPicker plugin\", version=\"0.1\", author=\"Greg L. Turnquist\", author_email=\"Greg.L.Turnquist@gmail.com\", description=\"Pick test methods based on a regular expression\", license=\"Apache Server License 2.0\", py_modules=[\"recipe13_plugin\"], entry_points = { 'nose.plugins': [ 'recipe13_plugin = recipe13_plugin:RegexPicker' ] } )","text_count":452,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import sys\ntry:\n        import ez_setup\n        ez_setup.use_setuptools()\nexcept ImportError:\n        pass\nfrom setuptools import setup\nsetup(\n        name=\"RegexPicker plugin\",\n        version=\"0.1\",\n        author=\"Greg L. Turnquist\",\n        author_email=\"Greg.L.Turnquist@gmail.com\",\n        description=\"Pick test methods based on a regular expression\",\n        license=\"Apache Server License 2.0\",\n        py_modules=[\"recipe13_plugin\"],\n        entry_points = {\n            'nose.plugins': [\n                'recipe13_plugin = recipe13_plugin:RegexPicker'\n               ]\n        }\n)"}]}]},{"block_type":"element","block":"k6bfva10","search_text":"Install our new plugin: ","text_count":24,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install our new plugin:"}]}]},{"block_type":"element","block":"k6bfva11","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000122.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva12","search_text":"Run nosetests using --with-regexpicker from the command line: ","text_count":62,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--with-regexpicker"}]},{"block_type":"text","content":"from the command line:"}]}]},{"block_type":"element","block":"k6bfva13","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000001.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva14","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva15","search_text":"Writing a nose plugin has some requirements. First of all, we need the class-level name attribute. It is used in several places, including defining the command-line switch to invoke our plugin, --with-<name> .","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Writing a nose plugin has some requirements. First of all, we need the class-level"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"name"}]},{"block_type":"text","content":"attribute. It is used in several places, including defining the command-line switch to invoke our plugin,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--with-&lt;name&gt;"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva16","search_text":"Next, we write options . There is no requirement to override Plugin.options , but in this case we need a way to supply our plugin with the regular expression. To avoid destroying the useful machinery of Plugin.options , we call it first, and then add a line for our extra parameter using parser.add_option :","text_count":307,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Next, we write"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"options"}]},{"block_type":"text","content":". There is no requirement to override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.options"}]},{"block_type":"text","content":", but in this case we need a way to supply our plugin with the regular expression. To avoid destroying the useful machinery of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.options"}]},{"block_type":"text","content":", we call it first, and then add a line for our extra parameter using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parser.add_option"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfva17","search_text":"The first, unnamed arguments are string versions of the parameter, and we can specify multiple ones. We could have had -rp and -re-pattern if we had wanted to. Dest : This is the name of the attribute that stores the results (see configure). Action : This specifies what to do with the value of the parameter (store, append, and so on). Default : This specifies what value to store when none are provided (notice we use test.* to match standard unittest behavior). Help : This provides help info to print out on the command line. ","text_count":530,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first, unnamed arguments are string versions of the parameter, and we can specify multiple ones. We could have had"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-rp"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-re-pattern"}]},{"block_type":"text","content":"if we had wanted to."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Dest"}]},{"block_type":"text","content":": This is the name of the attribute that stores the results (see configure)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Action"}]},{"block_type":"text","content":": This specifies what to do with the value of the parameter (store, append, and so on)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Default"}]},{"block_type":"text","content":": This specifies what value to store when none are provided (notice we use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test.*"}]},{"block_type":"text","content":"to match standard unittest behavior)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Help"}]},{"block_type":"text","content":": This provides help info to print out on the command line."}]}]},{"block_type":"element","block":"k6bfva18","search_text":"Nose uses Python's optparse.OptionParser library to define options.","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Nose uses Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse.OptionParser"}]},{"block_type":"text","content":"library to define options."}]},{"block_type":"element","block":"k6bfva19","search_text":"Note To find out more about Python's optparse.OptionParser , please refer to http://docs.python.org/library/optparse.html . ","text_count":124,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To find out more about Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse.OptionParser"}]},{"block_type":"text","content":", please refer to"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python.org/library/optparse.html"},"children":[{"block_type":"text","content":"http://docs.python.org/library/optparse.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfva1a","search_text":"Then, we write configure . There is also no requirement to override Plugin.configure . Because we had an extra option, --pattern , we need to harvest it. We also want to turn on a flag driven by verbosity , a standard nose option.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, we write"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"configure"}]},{"block_type":"text","content":". There is also no requirement to override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.configure"}]},{"block_type":"text","content":". Because we had an extra option,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--pattern"}]},{"block_type":"text","content":", we need to harvest it. We also want to turn on a flag driven by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"verbosity"}]},{"block_type":"text","content":", a standard nose option."}]},{"block_type":"element","block":"k6bfva1b","search_text":"There are many things we can do when writing a nose plugin. In our case, we wanted to zero in on test selection . There are several ways to load tests, including by module, and filename. After loading, they are then run through a method where they are voted in or out. These voters are called want* methods and they include wantModule , wantName , wantFunction , and wantMethod , as well some others. We implemented wantMethod where we test method.func_name matches our pattern using Python's re module. want* methods have three return value types:","text_count":548,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are many things we can do when writing a nose plugin. In our case, we wanted to zero in on"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"test&nbsp;"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"selection"}]},{"block_type":"text","content":". There are several ways to load tests, including by module, and filename. After loading, they are then run through a method where they are voted in or out. These voters are called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"want*"}]},{"block_type":"text","content":"methods and they include"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wantModule"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wantName"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wantFunction"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wantMethod"}]},{"block_type":"text","content":", as well some others. We implemented"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wantMethod"}]},{"block_type":"text","content":"where we test"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"method.func_name"}]},{"block_type":"text","content":"matches our pattern using Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re"}]},{"block_type":"text","content":"module."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"want*"}]},{"block_type":"text","content":"methods have three return value types:"}]},{"block_type":"element","block":"k6bfva1c","search_text":"True : This test is wanted. False : This test is not wanted (and will not be considered by another plugin). None : The plugin does not care whether another plugin (or nose) gets to choose. ","text_count":189,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":": This test is wanted."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"False"}]},{"block_type":"text","content":": This test is not wanted (and will not be considered by another plugin)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":": The plugin does not care whether another plugin (or nose) gets to choose."}]}]},{"block_type":"element","block":"k6bfva1d","search_text":"Note This is succinctly achieved by not returning anything from the want* method. ","text_count":82,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is succinctly achieved by not returning anything from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"want*"}]},{"block_type":"text","content":"method."}]}]},{"block_type":"element","block":"k6bfva1e","search_text":"wantMethod only looks at functions defined inside classes. nosetests is geared to find tests by many different methods and is not confined to just searching subclasses of unittest.TestCase . If tests are found in the module, but not as class methods, then this pattern matching is not utilized. For this plugin to be more robust, we would need lot of different tests and probably need to override the other want* test selectors.","text_count":428,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wantMethod"}]},{"block_type":"text","content":"only looks at functions defined inside classes."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"is geared to find tests by many different methods and is not confined to just searching subclasses of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest.TestCase"}]},{"block_type":"text","content":". If tests are found in the module, but not as class methods, then this pattern matching is not utilized. For this plugin to be more robust, we would need lot of different tests and probably need to override the other"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"want*"}]},{"block_type":"text","content":"test selectors."}]},{"block_type":"element","block":"k6bfva1f","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva1g","search_text":"This recipe just scratches the surface on plugin functionality. It focuses on the test selection process.","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe just scratches the surface on plugin functionality. It focuses on the test selection process."}]},{"block_type":"element","block":"k6bfva1h","search_text":"Later in this chapter, we will explore generating a specialized report. This involves using other plugin hooks that gather information after each test is run as well as generating a report after the test suite is exhausted. Nose provides a robust set of hooks allowing detailed customization to meet our changing needs.","text_count":319,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Later in this chapter, we will explore generating a specialized report. This involves using other plugin hooks that gather information after each test is run as well as generating a report after the test suite is exhausted. Nose provides a robust set of hooks allowing detailed customization to meet our changing needs."}]},{"block_type":"element","block":"k6bfva1i","search_text":"Plugins should subclass nose.plugins.Plugin .","text_count":45,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Plugins should subclass"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.plugins.Plugin"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva1j","search_text":"Tip There is a lot of valuable machinery built into Plugin . Subclassing is the recommended means of developing a plugin. If you don't so this, you may have to add on methods and attributes you didn't realize were needed by nose (and that come for free when you subclass). ","text_count":273,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is a lot of valuable machinery built into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin"}]},{"block_type":"text","content":". Subclassing is the recommended means of developing a plugin. If you don't so this, you may have to add on methods and attributes you didn't realize were needed by nose (and that come for free when you subclass)."}]}]},{"block_type":"element","block":"k6bfva1k","search_text":"It's a good rule of thumb to subclass the parts of the nose API that we are plugging into instead of overriding.","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's a good rule of thumb to subclass the parts of the nose API that we are plugging into instead of overriding."}]},{"block_type":"element","block":"k6bfva1l","search_text":"The online documentation for the nose API is a little incomplete. It tends to assume too much knowledge. If we override and our plugin doesn't work correctly, it may be difficult to debug what is happening.","text_count":206,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The online documentation for the nose API is a little incomplete. It tends to assume too much knowledge. If we override and our plugin doesn't work correctly, it may be difficult to debug what is happening."}]},{"block_type":"element","block":"k6bfva1m","search_text":"Do not subclass nose.plugins.IPluginInterface .","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Do not subclass"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.plugins.IPluginInterface"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva1n","search_text":"Tip This class is used for documentation purposes only. It provides information about each of the hooks our plugin can access. But it is not designed for subclassing real plugins. ","text_count":180,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This class is used for documentation purposes only. It provides information about each of the hooks our plugin can access. But it is not designed for subclassing real plugins."}]}]},{"block_type":"element","block":"k6bfva1o","search_text":"Writing a nose extension to generate a CSV report","text_count":49,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a nose extension to generate a CSV report"}]},{"block_type":"element","block":"k6bfva1p","search_text":"This recipe will help us write a plugin that generates a custom report listing successes and failures in a CSV file. It is used to demonstrate how to gather information after each test method completes.","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe will help us write a plugin that generates a custom report listing successes and failures in a CSV file. It is used to demonstrate how to gather information after each test method completes."}]},{"block_type":"element","block":"k6bfva1q","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfva1r","search_text":"We need to have easy_install loaded in order to install the nose plugin we are about to create. If you don't already have it, please visit http://pypi.python.org/pypi/setuptools to download and install the package as indicated on the site.","text_count":239,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to have"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"easy_install"}]},{"block_type":"text","content":"loaded in order to install the nose plugin we are about to create. If you don't already have it, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pypi.python.org/pypi/setuptools"},"children":[{"block_type":"text","content":"http://pypi.python.org/pypi/setuptools"}]},{"block_type":"text","content":"to download and install the package as indicated on the site."}]},{"block_type":"element","block":"k6bfva1s","search_text":"If you have just installed it now, then you will have to do the following:","text_count":74,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you have just installed it now, then you will have to do the following:"}]},{"block_type":"element","block":"k6bfva1t","search_text":"Rebuild your virtualenv used for running code samples in this book Reinstall nose using easy_install ","text_count":101,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Rebuild your"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"used for running code samples in this book"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reinstall nose using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"easy_install"}]}]}]},{"block_type":"element","block":"k6bfva1u","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva1v","search_text":"Create a new file named recipe14.py to store the code for this recipe. Create a shopping cart application that we can build some tests around: ","text_count":143,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe14.py"}]},{"block_type":"text","content":"to store the code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a shopping cart application that we can build some tests around:"}]}]},{"block_type":"element","block":"k6bfva1w","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price def total(self, sales_tax): sum_price = sum([item.price for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return len(self.items) class Item(object): def __init__(self, item, price): self.item = item self.price = price","text_count":505,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n   def __init__(self):\n     self.items = [] \n   def add(self, item, price):\n     self.items.append(Item(item, price))\n     return self\n   def item(self, index):\n     return self.items[index-1].item\n   def price(self, index):\n     return self.items[index-1].price\n   def total(self, sales_tax):\n     sum_price = sum([item.price for item in self.items])\n     return sum_price*(1.0 + sales_tax/100.0)\n   def __len__(self):\n     return len(self.items)\nclass Item(object):\n   def __init__(self, item, price):\n     self.item = item\n     self.price = price"}]}]},{"block_type":"element","block":"k6bfva1x","search_text":"Create a test case that contains several test methods, including one deliberately set to fail: ","text_count":95,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that contains several test methods, including one deliberately set to fail:"}]}]},{"block_type":"element","block":"k6bfva1y","search_text":"import unittest class ShoppingCartTest(unittest.TestCase): def setUp(self): self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) def test_length(self): self.assertEquals(1, len(self.cart)) def test_item(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) def test_price(self): self.assertEquals(15.00, self.cart.price(1)) def test_total_with_sales_tax(self): self.assertAlmostEquals(16.39, self.cart.total(9.25), 2) def test_assert_failure(self): self.fail(\"You should see this failure message in the report.\")","text_count":521,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nclass ShoppingCartTest(unittest.TestCase):\n    def setUp(self):\n      self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00)\n    def test_length(self):\n      self.assertEquals(1, len(self.cart))\n    def test_item(self):\n      self.assertEquals(\"tuna sandwich\", self.cart.item(1))\n    def test_price(self):\n      self.assertEquals(15.00, self.cart.price(1))\n    def test_total_with_sales_tax(self):\n      self.assertAlmostEquals(16.39,\n      self.cart.total(9.25), 2)\n    def test_assert_failure(self):\n      self.fail(\"You should see this failure message in the report.\")"}]}]},{"block_type":"element","block":"k6bfva1z","search_text":"Run the module using nosetests from the command line. Looking at the output in the following screenshot, does it appear that a CSV report exists? ","text_count":146,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the module using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"from the command line. Looking at the output in the following screenshot, does it appear that a CSV report exists?"}]}]},{"block_type":"element","block":"k6bfva20","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000151.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva21","search_text":"Create a new file called recipe14_plugin.py to store our new nose plugin. Create a nose plugin named CsvReport by subclassing nose.plugins.Plugin : ","text_count":148,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe14_plugin.py"}]},{"block_type":"text","content":"to store our new nose plugin."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a nose plugin named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CsvReport"}]},{"block_type":"text","content":"by subclassing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.plugins.Plugin"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva22","search_text":"import nose import re from nose.plugins import Plugin class CsvReport(Plugin): name = \"csv-report\" def __init__(self): Plugin.__init__(self) self.results = []","text_count":158,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import nose\nimport re\nfrom nose.plugins import Plugin\nclass CsvReport(Plugin):\n    name = \"csv-report\"\n    def __init__(self):\n      Plugin.__init__(self)\n      self.results = []"}]}]},{"block_type":"element","block":"k6bfva23","search_text":"Our nose plugin requires a class-level name . This is used to define the -with-<name> command-line option.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Our nose plugin requires a class-level"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"name"}]},{"block_type":"text","content":". This is used to define the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-with-&lt;name&gt;"}]},{"block_type":"text","content":"command-line option."}]},{"block_type":"element","block":"k6bfva24","search_text":"Override Plugin.options and add an option to provide the report's filename on the command line: ","text_count":96,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.options"}]},{"block_type":"text","content":"and add an option to provide the report's filename on the command line:"}]}]},{"block_type":"element","block":"k6bfva25","search_text":"def options(self, parser, env): Plugin.options(self, parser, env) parser.add_option(\"--csv-file\", dest=\"filename\", action=\"store\", default=env.get(\"NOSE_CSV_FILE\", \"log.csv\"), help=(\"Name of the report\"))","text_count":204,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def options(self, parser, env):\n  Plugin.options(self, parser, env)\n  parser.add_option(\"--csv-file\",\n    dest=\"filename\", action=\"store\",\n    default=env.get(\"NOSE_CSV_FILE\", \"log.csv\"),\n    help=(\"Name of the report\"))"}]}]},{"block_type":"element","block":"k6bfva26","search_text":"Override Plugin.configuration by having it fetch the filename from options: ","text_count":76,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.configuration"}]},{"block_type":"text","content":"by having it fetch the filename from options:"}]}]},{"block_type":"element","block":"k6bfva27","search_text":"def configure(self, options, conf): Plugin.configure(self, options, conf) self.filename = options.filename","text_count":106,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def configure(self, options, conf):\n  Plugin.configure(self, options, conf)\n  self.filename = options.filename"}]}]},{"block_type":"element","block":"k6bfva28","search_text":"When we extend Plugin , we inherit some other features, such as self.enabled , which is switched on when -with-<name> is used with nose.","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we extend"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin"}]},{"block_type":"text","content":", we inherit some other features, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self.enabled"}]},{"block_type":"text","content":", which is switched on when"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-with-&lt;name&gt;"}]},{"block_type":"text","content":"is used with nose."}]},{"block_type":"element","block":"k6bfva29","search_text":"Override addSuccess , addFailure , and addError to collect the results in an internal list: ","text_count":92,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addSuccess"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addFailure"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addError"}]},{"block_type":"text","content":"to collect the results in an internal list:"}]}]},{"block_type":"element","block":"k6bfva2a","search_text":"def addSuccess(self, *args, **kwargs): test = args[0] self.results.append((test, \"Success\")) def addError(self, *args, **kwargs): test, error = args[0], args[1] self.results.append((test, \"Error\", error)) def addFailure(self, *args, **kwargs): test, error = args[0], args[1] self.results.append((test, \"Failure\", error))","text_count":320,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def addSuccess(self, *args, **kwargs):\n  test = args[0]\n  self.results.append((test, \"Success\"))\ndef addError(self, *args, **kwargs):\n  test, error = args[0], args[1]\n  self.results.append((test, \"Error\", error))\ndef addFailure(self, *args, **kwargs):\n  test, error = args[0], args[1]\n  self.results.append((test, \"Failure\", error))"}]}]},{"block_type":"element","block":"k6bfva2b","search_text":"Override finalize to generate the CSV report: ","text_count":46,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"finalize"}]},{"block_type":"text","content":"to generate the CSV report:"}]}]},{"block_type":"element","block":"k6bfva2c","search_text":"def finalize(self, result): report = open(self.filename, \"w\") report.write(\"Test,Success/Failure,Detailsn\") for item in self.results: if item[1] == \"Success\": report.write(\"%s,%sn\" % (item[0], item[1])) else: report.write(\"%s,%s,%sn\" % (item[0],item[1], item[2][1])) report.close()","text_count":281,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def finalize(self, result):\n   report = open(self.filename, \"w\")\n   report.write(\"Test,Success/Failure,Detailsn\")\n   for item in self.results:\n       if item[1] == \"Success\":\n           report.write(\"%s,%sn\" % (item[0], item[1]))\n       else:\n           report.write(\"%s,%s,%sn\" % (item[0],item[1], item[2][1]))\n    report.close()"}]}]},{"block_type":"element","block":"k6bfva2d","search_text":"Write a test runner that programmatically tests our plugin by running the same test case that we ran earlier: ","text_count":110,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test runner that programmatically tests our plugin by running the same test case that we ran earlier:"}]}]},{"block_type":"element","block":"k6bfva2e","search_text":"if __name__ == \"__main__\": args = [\"\", \"recipe14\", \"--with-csv-report\", \"--csv-file=recipe14.csv\"] nose.run(argv=args, plugin=[CsvReport()])","text_count":140,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n   args = [\"\", \"recipe14\", \"--with-csv-report\", \"--csv-file=recipe14.csv\"]\nnose.run(argv=args, plugin=[CsvReport()])"}]}]},{"block_type":"element","block":"k6bfva2f","search_text":"Execute the test runner. Looking at the output in the next screenshot, is there a test report now? ","text_count":99,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Execute the test runner. Looking at the output in the next screenshot, is there a test report now?"}]}]},{"block_type":"element","block":"k6bfva2g","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000139.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva2h","search_text":"Open up and view the report using your favorite spreadsheet: ","text_count":61,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open up and view the report using your favorite spreadsheet:"}]}]},{"block_type":"element","block":"k6bfva2i","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000085.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva2j","search_text":"Create a setup.py script that allows us to install and register our plugin with nosetests : ","text_count":92,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py"}]},{"block_type":"text","content":"script that allows us to install and register our plugin with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva2k","search_text":"import sys try: import ez_setup ez_setup.use_setuptools() except ImportError: pass from setuptools import setup setup( name=\"CSV report plugin\", version=\"0.1\", author=\"Greg L. Turnquist\", author_email=\"Greg.L.Turnquist@gmail.com\", description=\"Generate CSV report\", license=\"Apache Server License 2.0\", py_modules=[\"recipe14_plugin\"], entry_points = { 'nose.plugins': [ 'recipe14_plugin = recipe14_plugin:CsvReport' ] } )","text_count":421,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import sys\ntry:\n   import ez_setup\n   ez_setup.use_setuptools()\nexcept ImportError:\n   pass\nfrom setuptools import setup\nsetup(\n   name=\"CSV report plugin\",\n   version=\"0.1\",\n   author=\"Greg L. Turnquist\",\n   author_email=\"Greg.L.Turnquist@gmail.com\",\n   description=\"Generate CSV report\",\n   license=\"Apache Server License 2.0\",\n   py_modules=[\"recipe14_plugin\"],\n   entry_points = {\n       'nose.plugins': [\n           'recipe14_plugin = recipe14_plugin:CsvReport'\n         ]\n   }\n)"}]}]},{"block_type":"element","block":"k6bfva2l","search_text":"Install our new plugin: ","text_count":24,"tag_name":"ol","attributes":{"start":"15"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install our new plugin:"}]}]},{"block_type":"element","block":"k6bfva2m","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000051.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva2n","search_text":"Run nosetests using --with-csv-report from the command line: ","text_count":61,"tag_name":"ol","attributes":{"start":"16"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--with-csv-report"}]},{"block_type":"text","content":"from the command line:"}]}]},{"block_type":"element","block":"k6bfva2o","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000147.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva2p","search_text":"In the previous screenshot, notice how we have the previous log file, recipe14.csv , and the new one, log.csv .","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous screenshot, notice how we have the previous log file,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe14.csv"}]},{"block_type":"text","content":", and the new one,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"log.csv"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva2q","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva2r","search_text":"Writing a nose plugin has some requirements. First of all, we need the class-level name attribute. It is used in several places including defining the command-line switch to invoke our plugin, --with-<name> .","text_count":208,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Writing a nose plugin has some requirements. First of all, we need the class-level"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"name"}]},{"block_type":"text","content":"attribute. It is used in several places including defining the command-line switch to invoke our plugin,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--with-&lt;name&gt;"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva2s","search_text":"Next, we write options . There is no requirement to override Plugin.options . But in this case, we need a way to supply our plugin with the name of the CSV report it will write. To avoid destroying the useful machinery of Plugin.options , we call it first, and then add a line for our extra parameter using parser.add_option :","text_count":326,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Next, we write"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"options"}]},{"block_type":"text","content":". There is no requirement to override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.options"}]},{"block_type":"text","content":". But in this case, we need a way to supply our plugin with the name of the CSV report it will write. To avoid destroying the useful machinery of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.options"}]},{"block_type":"text","content":", we call it first, and then add a line for our extra parameter using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parser.add_option"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfva2t","search_text":"The first, unnamed arguments are string versions of the parameter dest : This is the name of the attribute that stores the results (see configure) action : This tells what to do with the value of the parameter (store, append, and so on) default : This tells what value to store when none is provided help : This provides help info to print out on the command line ","text_count":364,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first, unnamed arguments are string versions of the parameter"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dest"}]},{"block_type":"text","content":": This is the name of the attribute that stores the results (see configure)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"action"}]},{"block_type":"text","content":": This tells what to do with the value of the parameter (store, append, and so on)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"default"}]},{"block_type":"text","content":": This tells what value to store when none is provided"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"help"}]},{"block_type":"text","content":": This provides help info to print out on the command line"}]}]},{"block_type":"element","block":"k6bfva2u","search_text":"Nose uses Python's optparse.OptionParser library to define options.","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Nose uses Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse.OptionParser"}]},{"block_type":"text","content":"library to define options."}]},{"block_type":"element","block":"k6bfva2v","search_text":"Note To learn more about optparse.OptionParser , visit http://docs.python.org/optparse.html . ","text_count":94,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To learn more about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse.OptionParser"}]},{"block_type":"text","content":", visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python.org/optparse.html"},"children":[{"block_type":"text","content":"http://docs.python.org/optparse.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfva2w","search_text":"Then, we write configure . There is also no requirement to override Plugin.configure . Because we had an extra option, --csv-file , we need to harvest it.","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, we write"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"configure"}]},{"block_type":"text","content":". There is also no requirement to override"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Plugin.configure"}]},{"block_type":"text","content":". Because we had an extra option,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--csv-file"}]},{"block_type":"text","content":", we need to harvest it."}]},{"block_type":"element","block":"k6bfva2x","search_text":"In this recipe, we want to capture the test case and the error report whenever a test method completes. To do this, we implement addSuccess , addFailure , and addError , because nose varies in what arguments are sent to these methods when called either programmatically or by the command-line, so we must use Python's *args :","text_count":325,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we want to capture the test case and the error report whenever a test method completes. To do this, we implement"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addSuccess"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addFailure"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addError"}]},{"block_type":"text","content":", because nose varies in what arguments are sent to these methods when called either programmatically or by the command-line, so we must use Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"*args"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfva2y","search_text":"The first slot of this tuple contains the test , an instance of nose.case.Test . Simply printing it is sufficient for our needs. The second slot of this tuple contains the error , an instance of the 3-tuple for sys.exc_info() . It is only included for addFailure and addError . No more slots of this tuple are documented on nose's website. We generally ignore them. ","text_count":366,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first slot of this tuple contains the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":", an instance of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose.case.Test"}]},{"block_type":"text","content":". Simply printing it is sufficient for our needs."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The second slot of this tuple contains the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"error"}]},{"block_type":"text","content":", an instance of the 3-tuple for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sys.exc_info()"}]},{"block_type":"text","content":". It is only included for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addFailure"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addError"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"No more slots of this tuple are documented on nose's website. We generally ignore them."}]}]},{"block_type":"element","block":"k6bfva2z","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva30","search_text":"This recipe digs a little deeper into the plugin's functionality. It focuses on processing done after a test method succeeds, fails, or causes an error. In our case, we just gather the results to put into a report. We could do other things, such as capture stack traces, send email failures to the development team, or send a page to the QA team letting them know a test suite is complete.","text_count":389,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe digs a little deeper into the plugin's functionality. It focuses on processing done after a test method succeeds, fails, or causes an error. In our case, we just gather the results to put into a report. We could do other things, such as capture stack traces, send email failures to the development team, or send a page to the QA team letting them know a test suite is complete."}]},{"block_type":"element","block":"k6bfva31","search_text":"For more details about writing a nose plugin, read the Writing a nose extension recipe to pick tests based on regular expressions.","text_count":130,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more details about writing a nose plugin, read the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"nose&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"extension"}]},{"block_type":"text","content":"&nbsp;recipe&nbsp;to pick tests based on regular expressions."}]},{"block_type":"element","block":"k6bfva32","search_text":"Writing a project-level script that lets you run different test suites","text_count":70,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a project-level script that lets you run different test suites"}]},{"block_type":"element","block":"k6bfva33","search_text":"Python, with its multi-paradigm nature, makes it easy to build applications and provide scripting support.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python, with its multi-paradigm nature, makes it easy to build applications and provide scripting support."}]},{"block_type":"element","block":"k6bfva34","search_text":"This recipe will help us explore building a project-level script that allows us to run different test suites. We will also show some extra command-line options to create hooks for packaging, publishing, registering, and writing automated documentation.","text_count":252,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe will help us explore building a project-level script that allows us to run different test suites. We will also show some extra command-line options to create hooks for packaging, publishing, registering, and writing automated documentation."}]},{"block_type":"element","block":"k6bfva35","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva36","search_text":"Create a script called recipe15.py that parses a set of options using Python's getopt library: ","text_count":95,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe15.py"}]},{"block_type":"text","content":"that parses a set of options using Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library:"}]}]},{"block_type":"element","block":"k6bfva37","search_text":"import getopt import glob import logging import nose import os import os.path import pydoc import re import sys def usage(): print print \"Usage: python recipe15.py [command]\" print print \"t--help\" print \"t--test\" print \"t--suite [suite]\" print \"t--debug-level [info|debug]\" print \"t--package\" print \"t--publish\" print \"t--register\" print \"t--pydoc\" print try: optlist, args = getopt.getopt(sys.argv[1:], \"ht\", [\"help\", \"test\", \"suite=\", \"debug-level=\", \"package\", \"publish\", \"register\", \"pydoc\"]) except getopt.GetoptError: # print help information and exit: print \"Invalid command found in %s\" % sys.argvusage() sys.exit(2)","text_count":624,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import getopt\nimport glob\nimport logging\nimport nose\nimport os\nimport os.path\nimport pydoc\nimport re\nimport sys\ndef usage():\n    print\n    print \"Usage: python recipe15.py [command]\"\n    print\n    print \"t--help\"\n    print \"t--test\"\n    print \"t--suite [suite]\"\n    print \"t--debug-level [info|debug]\"\n    print \"t--package\"\n    print \"t--publish\"\n    print \"t--register\"\n    print \"t--pydoc\"\n    print\ntry:\n    optlist, args = getopt.getopt(sys.argv[1:],\n                    \"ht\", \n                    [\"help\", \"test\", \"suite=\",\n                    \"debug-level=\", \"package\",\n                    \"publish\", \"register\", \"pydoc\"])\nexcept getopt.GetoptError:\n    # print help information and exit:\n    print \"Invalid command found in %s\" % sys.argvusage()\n    sys.exit(2)"}]}]},{"block_type":"element","block":"k6bfva38","search_text":"Create a function that maps to -test : ","text_count":39,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that maps to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-test"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva39","search_text":"def test(test_suite, debug_level): logger = logging.getLogger(\"recipe15\") loggingLevel = debug_level logger.setLevel(loggingLevel) ch = logging.StreamHandler() ch.setLevel(loggingLevel) formatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\") ch.setFormatter(formatter) logger.addHandler(ch) nose.run(argv=[\"\", test_suite, \"--verbosity=2\"])","text_count":369,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test(test_suite, debug_level):\n    logger = logging.getLogger(\"recipe15\")\n    loggingLevel = debug_level\n    logger.setLevel(loggingLevel)\n    ch = logging.StreamHandler()\n    ch.setLevel(loggingLevel)\n    formatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s -\n%(message)s\")\n    ch.setFormatter(formatter)\n    logger.addHandler(ch)\n    nose.run(argv=[\"\", test_suite, \"--verbosity=2\"])"}]}]},{"block_type":"element","block":"k6bfva3a","search_text":"Create stub functions that support package , publish , and register : ","text_count":70,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create stub functions that support"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"package"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"publish"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"register"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva3b","search_text":"def package(): print \"This is where we can plug in code to run \" + \"setup.py to generate a bundle.\" def publish(): print \"This is where we can plug in code to upload \" + \"our tarball to S3 or some other download site.\" def register(): print \"setup.py has a built in function to \" + \"'register' a release to PyPI. It's \" + \"convenient to put a hook in here.\" # os.system(\"%s setup.py register\" % sys.executable)","text_count":410,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def package():\n    print \"This is where we can plug in code to run \" +\n    \"setup.py to generate a bundle.\"\ndef publish():\n    print \"This is where we can plug in code to upload \" +\n          \"our tarball to S3 or some other download site.\"\ndef register():\n    print \"setup.py has a built in function to \" +\n          \"'register' a release to PyPI. It's \" +\n          \"convenient to put a hook in here.\"\n    # os.system(\"%s setup.py register\" % sys.executable)"}]}]},{"block_type":"element","block":"k6bfva3c","search_text":"Create a function to auto-generate docs using Python's pydoc module: ","text_count":69,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function to auto-generate docs using Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pydoc"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k6bfva3d","search_text":"def create_pydocs(): print \"It's useful to use pydoc to generate docs.\" pydoc_dir = \"pydoc\" module = \"recipe15_all\" __import__(module) if not os.path.exists(pydoc_dir): os.mkdir(pydoc_dir) cur = os.getcwd() os.chdir(pydoc_dir) pydoc.writedoc(\"recipe15_all\") os.chdir(cur)","text_count":271,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def create_pydocs():\n    print \"It's useful to use pydoc to generate docs.\"\n    pydoc_dir = \"pydoc\"\n    module = \"recipe15_all\"\n    __import__(module)\n    if not os.path.exists(pydoc_dir):\n        os.mkdir(pydoc_dir)\n    cur = os.getcwd()\n    os.chdir(pydoc_dir)\n    pydoc.writedoc(\"recipe15_all\")\n    os.chdir(cur)"}]}]},{"block_type":"element","block":"k6bfva3e","search_text":"Add some code that defines debug levels and then parses options to allow the user to override: ","text_count":95,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that defines debug levels and then parses options to allow the user to override:"}]}]},{"block_type":"element","block":"k6bfva3f","search_text":"debug_levels = {\"info\":logging.INFO, \"debug\":logging.DEBUG} # Default debug level is INFO debug_level = debug_levels[\"info\"] for option in optlist: if option[0] in (\"--debug-level\"): # Override with a user-supplied debug level debug_level = debug_levels[option[1]]","text_count":264,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"debug_levels = {\"info\":logging.INFO, \"debug\":logging.DEBUG}\n# Default debug level is INFO\ndebug_level = debug_levels[\"info\"]\nfor option in optlist:\n    if option[0] in (\"--debug-level\"):\n        # Override with a user-supplied debug level\n        debug_level = debug_levels[option[1]]"}]}]},{"block_type":"element","block":"k6bfva3g","search_text":"Add some code that scans the command-line options for -help and, if it's found, exits the script: ","text_count":98,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that scans the command-line options for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":"&nbsp;and, if it's found, exits the script:"}]}]},{"block_type":"element","block":"k6bfva3h","search_text":"# Check for help requests, which cause all other # options to be ignored. for option in optlist: if option[0] in (\"--help\", \"-h\"): usage() sys.exit(1)","text_count":150,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Check for help requests, which cause all other\n# options to be ignored.\nfor option in optlist:\nif option[0] in (\"--help\", \"-h\"):\n   usage()\n   sys.exit(1)"}]}]},{"block_type":"element","block":"k6bfva3i","search_text":"Finish it by iterating through each of the command-line options and invoking the other functions based on which options are picked: ","text_count":132,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finish it by iterating through each of the command-line options and invoking the other functions based on which options are picked:"}]}]},{"block_type":"element","block":"k6bfva3j","search_text":"# Parse the arguments, in order for option in optlist: if option[0] in (\"--test\"): print \"Running recipe15_checkin tests...\" test(\"recipe15_checkin\", debug_level) if option[0] in (\"--suite\"): print \"Running test suite %s...\" % option[1] test(option[1], debug_level) if option[0] in (\"--package\"): package() if option[0] in (\"--publish\"): publish() if option[0] in (\"--register\"): register() if option[0] in (\"--pydoc\"): create_pydocs()","text_count":435,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Parse the arguments, in order\nfor option in optlist:\n    if option[0] in (\"--test\"):\n       print \"Running recipe15_checkin tests...\"\n       test(\"recipe15_checkin\", debug_level)\n    if option[0] in (\"--suite\"):\n       print \"Running test suite %s...\" % option[1]\n       test(option[1], debug_level)\n    if option[0] in (\"--package\"):\n       package()\n    if option[0] in (\"--publish\"):\n       publish()\n    if option[0] in (\"--register\"):\n       register()\n    if option[0] in (\"--pydoc\"):\n       create_pydocs()"}]}]},{"block_type":"element","block":"k6bfva3k","search_text":"Run the recipe15.py script with -help : ","text_count":40,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe15.py"}]},{"block_type":"text","content":"script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva3l","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000101.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva3m","search_text":"Create a new file called recipe15_checkin.py to create a new test suite. Reuse the test cases from the Getting nosy with testing recipe to define a check in test suite: ","text_count":169,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe15_checkin.py"}]},{"block_type":"text","content":"to create a new test suite."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reuse the test cases from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"nosy&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testing"}]},{"block_type":"text","content":"&nbsp;recipe&nbsp;to define a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"check"}]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"in"}]},{"block_type":"text","content":"test suite:"}]}]},{"block_type":"element","block":"k6bfva3n","search_text":"import recipe11 class Recipe11Test(recipe11.ShoppingCartTest): pass ","text_count":68,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import recipe11 \n \nclass Recipe11Test(recipe11.ShoppingCartTest): \n    pass"}]}]},{"block_type":"element","block":"k6bfva3o","search_text":"Run the recipe15.py script, using -test -package -publish -register -pydoc . In the following screenshot, do you notice how it exercises each option in the same sequence as it was supplied on the command line? ","text_count":210,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe15.py"}]},{"block_type":"text","content":"script, using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-test -package -publish -register -pydoc"}]},{"block_type":"text","content":". In the following screenshot, do you notice how it exercises each option in the same sequence as it was supplied on the command line?"}]}]},{"block_type":"element","block":"k6bfva3p","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000055.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva3q","search_text":"Inspect the report generated in the pydoc directory: ","text_count":53,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inspect the report generated in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pydoc"}]},{"block_type":"text","content":"directory:"}]}]},{"block_type":"element","block":"k6bfva3r","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000082.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva3s","search_text":"Create a new file named recipe15_all.py to define another new test suite. Reuse the test code from the earlier recipes of this chapter to define an all test suite: ","text_count":164,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe15_all.py"}]},{"block_type":"text","content":"to define another new test suite."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reuse the test code from the earlier recipes of this chapter to define an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"all"}]},{"block_type":"text","content":"test suite:"}]}]},{"block_type":"element","block":"k6bfva3t","search_text":"import recipe11 import recipe12 import recipe13 import recipe14 class Recipe11Test(recipe11.ShoppingCartTest): pass class Recipe12Test(recipe12.ShoppingCartTest): pass class Recipe13Test(recipe13.ShoppingCartTest): pass class Recipe14Test(recipe14.ShoppingCartTest): pass","text_count":271,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import recipe11\nimport recipe12\nimport recipe13\nimport recipe14\nclass Recipe11Test(recipe11.ShoppingCartTest):\n    pass\nclass Recipe12Test(recipe12.ShoppingCartTest):\n    pass\nclass Recipe13Test(recipe13.ShoppingCartTest):\n    pass\nclass Recipe14Test(recipe14.ShoppingCartTest):\n    pass"}]}]},{"block_type":"element","block":"k6bfva3u","search_text":"Run the recipe15.py script with -suite=recipe15_all : ","text_count":54,"tag_name":"ol","attributes":{"start":"15"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe15.py"}]},{"block_type":"text","content":"script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-suite=recipe15_all"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva3v","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000110.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva3w","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva3x","search_text":"This script uses Python's getopt library, which is modeled after the C programming language's getopt() function. This means we use the API to define a set of commands, and then we iterate over the options, calling the corresponding functions:","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This script uses Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library, which is modeled after the C programming language's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt()"}]},{"block_type":"text","content":"function. This means we use the API to define a set of commands, and then we iterate over the options, calling the corresponding functions:"}]},{"block_type":"element","block":"k6bfva3y","search_text":"Note Visit http://docs.python.org/library/getopt.html for more details on the getopt library. ","text_count":94,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python.org/library/getopt.html"},"children":[{"block_type":"text","content":"http://docs.python.org/library/getopt.html"}]},{"block_type":"text","content":"for more details on the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library."}]}]},{"block_type":"element","block":"k6bfva3z","search_text":"usage : This is a function that provides help to the user. key : The option definitions are included in the following block: ","text_count":125,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"usage"}]},{"block_type":"text","content":": This is a function that provides help to the user."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"key"}]},{"block_type":"text","content":": The option definitions are included in the following block:"}]}]},{"block_type":"element","block":"k6bfva40","search_text":"optlist, args = getopt.getopt(sys.argv[1:], \"ht\", [\"help\", \"test\", \"suite=\", \"debug-level=\", \"package\", \"publish\", \"register\", \"pydoc\"])","text_count":136,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"optlist, args = getopt.getopt(sys.argv[1:],\n                \"ht\",\n                [\"help\", \"test\", \"suite=\",\n                \"debug-level=\", \"package\",\n                \"publish\", \"register\", \"pydoc\"])"}]}]},{"block_type":"element","block":"k6bfva41","search_text":"We parse everything in the arguments except the first, as this is the executable itself:","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We parse everything in the arguments except the first, as this is the executable itself:"}]},{"block_type":"element","block":"k6bfva42","search_text":"\"ht\" defines short options: -h and -t . The list defines long options. Those with \"=\" accept an argument. Those without it are flags. If an option is received that isn't on the list, an exception is thrown; we print out usage() and then exit. Test : This activates loggers, which can be very useful if our app uses Python's logging library. Package : This generates tarballs. We created a stub, but it can be handy to provide a shortcut by running setup.py sdist|bdist . Publish : Its function is to push tarballs to the deployment site. We created a stub, but deploying it to an S3 site or somewhere else is useful. Register : This is the register with PyPI. We created a stub, but it would be handy to provide a shortcut to running setup.py register . create_pydocs : These are auto-generated docs. Generating HTML files based on code is very convenient. ","text_count":857,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"ht\""}]},{"block_type":"text","content":"defines short options:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-t"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The list defines long options. Those with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"=\""}]},{"block_type":"text","content":"accept an argument. Those without it are flags."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If an option is received that isn't on the list, an exception is thrown; we print out"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"usage()"}]},{"block_type":"text","content":"&nbsp;and then exit."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test"}]},{"block_type":"text","content":": This activates loggers, which can be very useful if our app uses Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging"}]},{"block_type":"text","content":"library."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Package"}]},{"block_type":"text","content":": This generates tarballs. We created a stub, but it can be handy to provide a shortcut by running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py sdist|bdist"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Publish"}]},{"block_type":"text","content":": Its function is to push tarballs to the deployment site. We created a stub, but deploying it to an S3 site or somewhere else is useful."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Register"}]},{"block_type":"text","content":": This is the register with PyPI. We created a stub, but it would be handy to provide a shortcut to running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py register"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_pydocs"}]},{"block_type":"text","content":": These are auto-generated docs. Generating HTML files based on code is very convenient."}]}]},{"block_type":"element","block":"k6bfva43","search_text":"With each of these functions defined, we can iterate over the options that were parsed. For this script, there is a sequence as follows:","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With each of these functions defined, we can iterate over the options that were parsed. For this script, there is a sequence as follows:"}]},{"block_type":"element","block":"k6bfva44","search_text":"Check whether there is a debugging override. We default to logging.INFO , but provide the ability to switch to logging.DEBUG . Check whether -h or -help was called. If so, print out the usage() information and then exit with no more parsing. Finally, iterate over the options and call their corresponding functions. ","text_count":316,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check whether there is a debugging override. We default to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging.INFO"}]},{"block_type":"text","content":", but provide the ability to switch to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging.DEBUG"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check whether&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":"was called. If so, print out the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"usage()"}]},{"block_type":"text","content":"information and then exit with no more parsing."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, iterate over the options and call their corresponding functions."}]}]},{"block_type":"element","block":"k6bfva45","search_text":"To exercise things, we first called this script with the -help option. That printed out the command choices we had.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To exercise things, we first called this script with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":"option. That printed out the command choices we had."}]},{"block_type":"element","block":"k6bfva46","search_text":"Then we called it with all the options to demonstrate the features. The script is coded to exercise a check in suite when we use -test . This short test suite simulates running a quicker test that's designed to see whether things look alright.","text_count":243,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then we called it with all the options to demonstrate the features. The script is coded to exercise a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"check in"}]},{"block_type":"text","content":"suite when we use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-test"}]},{"block_type":"text","content":". This short test suite simulates running a quicker test that's designed to see whether things look alright."}]},{"block_type":"element","block":"k6bfva47","search_text":"Finally, we called the script with -suite=recipe15_all . This test suite simulates running a more complete test suite that typically takes longer.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we called the script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-suite=recipe15_all"}]},{"block_type":"text","content":". This test suite simulates running a more complete test suite that typically takes longer."}]},{"block_type":"element","block":"k6bfva48","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva49","search_text":"The features this script provides could easily be handled by commands that are already built. We looked at nosetests earlier in this chapter and saw how it can flexibly take arguments to pick tests.","text_count":198,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The features this script provides could easily be handled by commands that are already built. We looked at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"earlier in this chapter and saw how it can flexibly take arguments to pick tests."}]},{"block_type":"element","block":"k6bfva4a","search_text":"Using setup.py to generate tarballs and register releases is also a commonly used feature in the Python community.","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py"}]},{"block_type":"text","content":"to generate tarballs and register releases is also a commonly used feature in the Python community."}]},{"block_type":"element","block":"k6bfva4b","search_text":"So, why write this script? Because we can tap all these features with a single command script, setup.py contains a prebuilt set of commands that involve bundling and uploading to the Python Project Index. Doing other tasks, such as generating pydocs , deploying to a location such as an Amazon S3 bucket, or any other system-level task, is not included. This script demonstrates how easy it is to wire in other command-line options and link them with the project management functions.","text_count":484,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So, why write this script? Because we can tap all these features with a single command script,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py"}]},{"block_type":"text","content":"contains a prebuilt set of commands that involve bundling and uploading to the Python Project Index. Doing other tasks, such as generating"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"pydocs"}]},{"block_type":"text","content":", deploying to a location such as an Amazon S3 bucket, or any other system-level task, is not included. This script demonstrates how easy it is to wire in other command-line options and link them with the project management functions."}]},{"block_type":"element","block":"k6bfva4c","search_text":"We can also conveniently embed the usage of pydoc . Basically, any Python library that serves project management needs can be embedded as well.","text_count":143,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We can also conveniently embed the usage of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pydoc"}]},{"block_type":"text","content":". Basically, any Python library that serves project management needs can be embedded as well."}]},{"block_type":"element","block":"k6bfva4d","search_text":"Tip On an existing project, I developed a script to provide a unified way to embed version info into a templated setup.py as well as documentation generated by pydoc , sphinx , and DocBook . The script saved me from having to remember all the commands needed to manage the project. Why didn't I extend distutils to create my own commands? It was a matter of taste. I preferred using getopt and working outside the framework of distutils instead of creating and registering new sub-commands. ","text_count":491,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"On an existing project, I developed a script to provide a unified way to embed version info into a templated"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py"}]},{"block_type":"text","content":"as well as documentation generated by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pydoc"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sphinx"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DocBook"}]},{"block_type":"text","content":". The script saved me from having to remember all the commands needed to manage the project."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Why didn't I extend"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"distutils"}]},{"block_type":"text","content":"to create my own commands? It was a matter of taste. I preferred using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"and working outside the framework of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"distutils"}]},{"block_type":"text","content":"instead of creating and registering new sub-commands."}]}]},{"block_type":"element","block":"k6bfva4e","search_text":"Why use getopt instead of optparse?","text_count":35,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why use getopt instead of optparse?"}]},{"block_type":"element","block":"k6bfva4f","search_text":"Python has several options for handling command-line option parsing. getopt is possibly the simplest. It is meant to quickly allow defining short and long options, but it has limits. It requires custom coding help output, as we did with the usage function.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python has several options for handling command-line option parsing."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"is possibly the simplest. It is meant to quickly allow defining short and long options, but it has limits. It requires custom coding help output, as we did with the usage function."}]},{"block_type":"element","block":"k6bfva4g","search_text":"It also requires custom handling of the arguments. optparse provides more sophisticated options, such as better handling of arguments and auto-built help. But it also requires more code to get functional. optparse is also scheduled to be replaced by argparse in the future.","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It also requires custom handling of the arguments."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse"}]},{"block_type":"text","content":"provides more sophisticated options, such as better handling of arguments and auto-built help. But it also requires more code to get functional."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse"}]},{"block_type":"text","content":"is also scheduled to be replaced by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"in the future."}]},{"block_type":"element","block":"k6bfva4h","search_text":"It is left as an exercise for you to write an alternative version of this script using optparse , to assess which one is a better solution.","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is left as an exercise for you to write an alternative version of this script using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse"}]},{"block_type":"text","content":", to assess which one is a better solution."}]}]},{"title":"Creating Testable Documentation with doctest","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3ki","number":3,"contents":[{"block_type":"element","block":"k6bfva4i","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k6bfva4j","search_text":"Documenting the basics Catching stack traces Running a doctest from the command line Coding a test harness for doctest Filtering out test noise Printing out all your documentation including a status report Testing the edges Testing corner cases by iteration Getting nosy with doctest Updating the project-level script to run this chapter's doctests ","text_count":349,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Documenting the basics"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Catching stack traces"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Running a&nbsp;doctest&nbsp;from the command line"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Coding a test harness for doctest"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Filtering out test noise"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Printing out all your documentation including a status report"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing corner cases by iteration"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Getting nosy with doctest"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Updating the project-level script to run this chapter's doctests"}]}]},{"block_type":"element","block":"k6bfva4k","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfva4l","search_text":"Python provides a useful ability to embed comments inside functions that are accessible from a Python shell. These are known as docstrings .","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python provides a useful ability to embed comments inside functions that are accessible from a Python shell. These are known as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"docstrings"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva4m","search_text":"A docstring provides the ability to embed not only information, but also code samples that are runnable.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A docstring provides the ability to embed not only information, but also code samples that are runnable."}]},{"block_type":"element","block":"k6bfva4n","search_text":"There is an old adage that says comments aren't code . This is because comments don't undergo syntax checks and are often not maintained. Thus, the information they carry can lose its value over time. doctest counters this by turning comments into code, which can serve many useful purposes.","text_count":291,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is an old adage that says&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"comments&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"aren't&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"code"}]},{"block_type":"text","content":".&nbsp;This is because comments don't undergo syntax checks and are often not maintained. Thus, the information they carry can lose its value over time."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"counters this by turning comments into code, which can serve many useful purposes."}]},{"block_type":"element","block":"k6bfva4o","search_text":"In this chapter, we will explore different ways to use doctest to develop testing, documentation, and project support. No special setup is required, as doctest is part of Python's standard libraries.","text_count":199,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will explore different ways to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"to develop testing, documentation, and project support. No special setup is required, as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"is part of Python's standard libraries."}]},{"block_type":"element","block":"k6bfva4p","search_text":"Documenting the basics","text_count":22,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Documenting the basics"}]},{"block_type":"element","block":"k6bfva4q","search_text":"Python provides an out-of-the-box capability to put comments in code, known as docstrings. Docstrings can be read when looking at the source and also when inspecting the code interactively from a Python shell. In this recipe, we will demonstrate how these interactive docstrings can be used as runnable tests.","text_count":309,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python provides an out-of-the-box capability to put comments in code, known as docstrings. Docstrings can be read when looking at the source and also when inspecting the code interactively from a Python shell. In this recipe, we will demonstrate how these interactive docstrings can be used as runnable tests."}]},{"block_type":"element","block":"k6bfva4r","search_text":"What does this provide? It offers easy-to-read code samples for the users. Not only are the code samples readable, they are also runnable, meaning we can ensure the documentation stays up-to-date.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What does this provide? It offers easy-to-read code samples for the users. Not only are the code samples readable, they are also runnable, meaning we can ensure the documentation stays up-to-date."}]},{"block_type":"element","block":"k6bfva4s","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva4t","search_text":"With the following steps, we will create an application combined with runnable docstring comments, and see how to execute these tests:","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will create an application combined with runnable docstring comments, and see how to execute these tests:"}]},{"block_type":"element","block":"k6bfva4u","search_text":"Create a new file named recipe16.py to put all the code we write for this recipe. ","text_count":82,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe16.py"}]},{"block_type":"text","content":"to put all the code we write for this recipe."}]}]},{"block_type":"element","block":"k6bfva4v","search_text":"Create a function that converts base-10 numbers to any other base using recursion: ","text_count":83,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that converts base-10 numbers to any other base using recursion:"}]}]},{"block_type":"element","block":"k6bfva4w","search_text":"def convert_to_basen(value, base): import math def _convert(remaining_value, base, exp): def stringify(value): if value > 9: return chr(value + ord('a')-10) else: return str(value) if remaining_value >= 0 and exp >= 0: factor = int(math.pow(base, exp)) if factor <= remaining_value: multiple = remaining_value / factor return stringify(multiple) + \\ _convert(remaining_value-multiple*factor, \\ base, exp-1) else: return \"0\" + \\ _convert(remaining_value, base, exp-1) else: return \"\" return \"%s/%s\" % (_convert(value, base, \\ int(math.log(value, base))), base)","text_count":559,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    import math\n    def _convert(remaining_value, base, exp):\n        def stringify(value):\n            if value &gt; 9:\n                return chr(value + ord('a')-10)\n            else:\n                return str(value)\n        if remaining_value &gt;= 0 and exp &gt;= 0:\n            factor = int(math.pow(base, exp))\n            if factor &lt;= remaining_value:\n                multiple = remaining_value / factor\n                return stringify(multiple) + \\\n                  _convert(remaining_value-multiple*factor, \\\n                    base, exp-1)\n        else:\n            return \"0\" + \\\n                _convert(remaining_value, base, exp-1)\n        else:\n            return \"\"\n    return \"%s/%s\" % (_convert(value, base, \\\n                int(math.log(value, base))), base)"}]}]},{"block_type":"element","block":"k6bfva4x","search_text":"Add a docstring just below the external function, as shown in the highlighted section of the following code. This docstring declaration includes several examples of using the function: ","text_count":185,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a docstring just below the external function, as shown in the highlighted section of the following code. This docstring declaration includes several examples of using the function:"}]}]},{"block_type":"element","block":"k6bfva4y","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen >>> convert_to_basen(1, 2) '1/2' >>> convert_to_basen(2, 2) '10/2' >>> convert_to_basen(3, 2) '11/2' >>> convert_to_basen(4, 2) '100/2' >>> convert_to_basen(5, 2) '101/2' >>> convert_to_basen(6, 2) '110/2' >>> convert_to_basen(7, 2) '111/2' >>> convert_to_basen(1, 16) '1/16' >>> convert_to_basen(10, 16) 'a/16' >>> convert_to_basen(15, 16) 'f/16' >>> convert_to_basen(16, 16) '10/16' >>> convert_to_basen(31, 16) '1f/16' >>> convert_to_basen(32, 16) '20/16' \"\"\" import math","text_count":545,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen\n    &gt;&gt;&gt; convert_to_basen(1, 2)\n    '1/2'\n    &gt;&gt;&gt; convert_to_basen(2, 2)\n    '10/2'\n    &gt;&gt;&gt; convert_to_basen(3, 2)\n    '11/2'\n    &gt;&gt;&gt; convert_to_basen(4, 2)\n    '100/2'\n    &gt;&gt;&gt; convert_to_basen(5, 2)\n    '101/2'\n    &gt;&gt;&gt; convert_to_basen(6, 2)\n    '110/2'\n    &gt;&gt;&gt; convert_to_basen(7, 2)\n    '111/2'\n    &gt;&gt;&gt; convert_to_basen(1, 16)\n    '1/16'\n    &gt;&gt;&gt; convert_to_basen(10, 16)\n    'a/16'\n    &gt;&gt;&gt; convert_to_basen(15, 16)\n    'f/16'\n    &gt;&gt;&gt; convert_to_basen(16, 16)\n    '10/16'\n    &gt;&gt;&gt; convert_to_basen(31, 16)\n    '1f/16'\n    &gt;&gt;&gt; convert_to_basen(32, 16)\n    '20/16'\n    \"\"\"\n    import math"}]}]},{"block_type":"element","block":"k6bfva4z","search_text":"Add a test runner block that invokes Python's doctest module: ","text_count":62,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test runner block that invokes Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k6bfva50","search_text":"if __name__ == \"__main__\": import doctest doctest.testmod()","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import doctest\n    doctest.testmod()"}]}]},{"block_type":"element","block":"k6bfva51","search_text":"From an interactive Python shell, import the recipe and view its documentation. Take a look at this screenshot: ","text_count":112,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"From an interactive Python shell, import the recipe and view its documentation. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfva52","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000063.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva53","search_text":"Run the code from the command line. In the following screenshot, notice how nothing is printed. This is what happens when all the tests pass. Look at this screenshot: ","text_count":167,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code from the command line. In the following screenshot, notice how nothing is printed. This is what happens when all the tests pass. Look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfva54","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000014.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva55","search_text":"Run the code from the command line with -v to increase verbosity. In the following screenshot, we see a piece of the output, showing what was run and what was expected. This can be useful when debugging doctest : ","text_count":213,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code from the command line with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"to increase verbosity. In the following screenshot, we see a piece of the output, showing what was run and what was expected. This can be useful when debugging"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva56","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000047.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva57","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva58","search_text":"The doctest module looks for blocks of Python inside docstrings and runs it like real code. >>> is the same prompt we see when we use the interactive Python shell. The line following >>> shows the expected output. doctest runs the statements it sees and then compares the actual output with the expected output.","text_count":311,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module looks for blocks of Python inside docstrings and runs it like real code."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&gt;&gt;&gt;"}]},{"block_type":"text","content":"is the same prompt we see when we use the interactive Python shell. The line&nbsp;following"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&gt;&gt;&gt;"}]},{"block_type":"text","content":"&nbsp;shows the expected output."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"runs the statements it sees and then compares the actual output with the expected output."}]},{"block_type":"element","block":"k6bfva59","search_text":"Later in this chapter, we will see how to catch things such as stack traces, errors, and also add extra code that equates to a test fixture.","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Later in this chapter, we will see how to catch things such as stack traces, errors, and also add extra code that equates to a test fixture."}]},{"block_type":"element","block":"k6bfva5a","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva5b","search_text":"doctest is very picky when matching expected output with actual results:","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"is very picky when matching expected output with actual results:"}]},{"block_type":"element","block":"k6bfva5c","search_text":"An extraneous space or tab can cause things to break. Structures such as dictionaries are tricky to test, because Python doesn't guarantee the order of items. On each test run, the items could be stored in a different order. Simply printing out a dictionary is bound to break. It is strongly advised not to include object references in expected outputs. These values also vary every time the test is run. ","text_count":405,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"An extraneous space or tab can cause things to break."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Structures such as dictionaries are tricky to test, because Python doesn't guarantee the order of items. On each test run, the items could be stored in a different order. Simply printing out a dictionary is bound to break."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It is strongly advised not to include object references in expected outputs. These values also vary every time the test is run."}]}]},{"block_type":"element","block":"k6bfva5d","search_text":"Catching stack traces","text_count":21,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Catching stack traces"}]},{"block_type":"element","block":"k6bfva5e","search_text":"It's a common fallacy that we should write tests only for successful code paths. We also need to code against error conditions including the ones that generate stack traces. With this recipe, we will explore how stack traces are pattern-matched in doc testing, which allows us to confirm expected errors.","text_count":304,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's a common fallacy that we should write tests only for successful code paths. We also need to code against error conditions including the ones that generate stack traces. With this recipe, we will explore how stack traces are pattern-matched in doc testing, which allows us to confirm expected errors."}]},{"block_type":"element","block":"k6bfva5f","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva5g","search_text":"With the following steps, we will see how to use doctest to verify error conditions:","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will see how to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"to verify error conditions:"}]},{"block_type":"element","block":"k6bfva5h","search_text":"Create a new file called recipe17.py for all our code in this recipe. ","text_count":70,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe17.py"}]},{"block_type":"text","content":"for all our code in this recipe."}]}]},{"block_type":"element","block":"k6bfva5i","search_text":"Create a function that converts base-10 numbers to any other base using recursion: ","text_count":83,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that converts base-10 numbers to any other base using recursion:"}]}]},{"block_type":"element","block":"k6bfva5j","search_text":"def convert_to_basen(value, base): import math def _convert(remaining_value, base, exp): def stringify(value): if value > 9: return chr(value + ord('a')-10) else: return str(value) if remaining_value >= 0 and exp >= 0: factor = int(math.pow(base, exp)) if factor <= remaining_value: multiple = remaining_value / factor return stringify(multiple) + \\ _convert(remaining_value-multiple*factor, \\ base, exp-1) else: return \"0\" + \\ _convert(remaining_value, base, exp-1) else: return \"\" return \"%s/%s\" % (_convert(value, base, \\ int(math.log(value, base))), base)","text_count":559,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    import math\n    def _convert(remaining_value, base, exp):\n        def stringify(value):\n            if value &gt; 9:\n                return chr(value + ord('a')-10)\n            else:\n                return str(value)\n        if remaining_value &gt;= 0 and exp &gt;= 0:\n            factor = int(math.pow(base, exp))\n            if factor &lt;= remaining_value:\n                multiple = remaining_value / factor\n                return stringify(multiple) + \\\n                    _convert(remaining_value-multiple*factor, \\\n                                base, exp-1)\n            else:\n                return \"0\" + \\\n                    _convert(remaining_value, base, exp-1)\n        else:\n            return \"\"\n    return \"%s/%s\" % (_convert(value, base, \\\n                int(math.log(value, base))), base)"}]}]},{"block_type":"element","block":"k6bfva5k","search_text":"Add a docstring just below the external function declaration that includes two examples that are expected to generate stack traces: ","text_count":132,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a docstring just below the external function declaration that includes two examples that are expected to generate stack traces:"}]}]},{"block_type":"element","block":"k6bfva5l","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. >>> convert_to_basen(0, 2) Traceback (most recent call last): ... ValueError: math domain error >>> convert_to_basen(-1, 2) Traceback (most recent call last): ... ValueError: math domain error \"\"\" import math","text_count":280,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen.\n\n    &gt;&gt;&gt; convert_to_basen(0, 2)\n    Traceback (most recent call last):\n        ...\n    ValueError: math domain error\n\n    &gt;&gt;&gt; convert_to_basen(-1, 2)\n    Traceback (most recent call last):\n        ...\n    ValueError: math domain error\n    \"\"\"\n    import math"}]}]},{"block_type":"element","block":"k6bfva5m","search_text":"Add a test runner block that invokes Python's doctest module: ","text_count":62,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test runner block that invokes Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k6bfva5n","search_text":"if __name__ == \"__main__\": import doctest doctest.testmod()","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import doctest\n    doctest.testmod()"}]}]},{"block_type":"element","block":"k6bfva5o","search_text":"Run the code from the command line. In the following screenshot, notice how nothing is printed. This is what happens when all the tests pass: ","text_count":142,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code from the command line. In the following screenshot, notice how nothing is printed. This is what happens when all the tests pass:"}]}]},{"block_type":"element","block":"k6bfva5p","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000073.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva5q","search_text":"Run the code from the command line with -v to increase verbosity. In the following screenshot, we can see that 0 and -1 generate math domain errors. This is due to using math.log to find the starting exponent: ","text_count":210,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code from the command line with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"to increase verbosity. In the following screenshot, we can see that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-1"}]},{"block_type":"text","content":"generate math domain errors. This is due to using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"math.log"}]},{"block_type":"text","content":"to find the starting exponent:"}]}]},{"block_type":"element","block":"k6bfva5r","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000026.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva5s","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva5t","search_text":"The doctest module looks for blocks of Python inside docstrings and runs it like real code. >>> is the same prompt we see when we use the interactive Python shell. The line following >>> shows the expected output. doctest runs the statements it sees and then compares the actual output with the expected output.","text_count":311,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module looks for blocks of Python inside docstrings and runs it like real code."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&gt;&gt;&gt;"}]},{"block_type":"text","content":"is the same prompt we see when we use the interactive Python shell.&nbsp;The line&nbsp;following&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&gt;&gt;&gt;"}]},{"block_type":"text","content":"&nbsp;shows the expected output."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"runs the statements it sees and then compares the actual output with the expected output."}]},{"block_type":"element","block":"k6bfva5u","search_text":"With regard to stack traces, there is a lot of detailed information provided in the stack trace. Pattern matching the entire trace is ineffective. By using the ellipsis, we are able to skip the intermediate parts of the stack trace and just match on the distinguishing part: ValueError: math domain error .","text_count":306,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With regard to stack traces, there is a lot of detailed information provided in the stack trace. Pattern matching the entire trace is ineffective. By using the ellipsis, we are able to skip the intermediate parts of the stack trace and just match on the distinguishing part:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ValueError: math domain error"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva5v","search_text":"This is valuable, because our users will not only see the way it handles good values, but will also observe what errors to expect when bad values are provided.","text_count":159,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is valuable, because our users will not only see the way it handles good values, but will also observe what errors to expect when bad values are provided."}]},{"block_type":"element","block":"k6bfva5w","search_text":"Running a doctest from the command line","text_count":39,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Running a&nbsp;doctest&nbsp;from the command line"}]},{"block_type":"element","block":"k6bfva5x","search_text":"We have seen how to develop tests by embedding runnable fragments of code in docstrings. But for each of these tests, we had to make the module runnable. What if we wanted to run something else other than our doctest from the command line? We would have to get rid of the doctest.testmod() statements!","text_count":301,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have seen how to develop tests by embedding runnable fragments of code in docstrings. But for each of these tests, we had to make the module runnable. What if we wanted to run something else other than our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"from the command line? We would have to get rid of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest.testmod()"}]},{"block_type":"text","content":"statements!"}]},{"block_type":"element","block":"k6bfva5y","search_text":"The good news is that, starting with Python 2.6, there is a command-line option to run a specific module using doctest without coding a runner.","text_count":143,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The good news is that, starting with Python 2.6, there is a command-line option to run a specific module using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"without coding a runner."}]},{"block_type":"element","block":"k6bfva5z","search_text":"The python -m doctest -v example.py command will import example.py and run it through doctest.testmod() . According to the documentation, this may fail if the module is part of a package and imports other sub modules.","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python -m doctest -v example.py"}]},{"block_type":"text","content":"&nbsp;command will import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example.py"}]},{"block_type":"text","content":"and run it through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest.testmod()"}]},{"block_type":"text","content":". According to the documentation, this may fail if the module is part of a package and imports other sub modules."}]},{"block_type":"element","block":"k6bfva60","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva61","search_text":"In the following steps, we will create a simple application. We will add some doctests and then run them from the command line without writing a special test runner:","text_count":165,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the following steps, we will create a simple application. We will add some doctests and then run them from the command line without writing a special test runner:"}]},{"block_type":"element","block":"k6bfva62","search_text":"Create a new file called recipe18.py to store the code written for this recipe. ","text_count":80,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe18.py"}]},{"block_type":"text","content":"to store the code written for this recipe."}]}]},{"block_type":"element","block":"k6bfva63","search_text":"Create a function that converts base-10 numbers to any other base using recursion: ","text_count":83,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that converts base-10 numbers to any other base using recursion:"}]}]},{"block_type":"element","block":"k6bfva64","search_text":"def convert_to_basen(value, base): import math def _convert(remaining_value, base, exp): def stringify(value): if value > 9: return chr(value + ord('a')-10) else: return str(value) if remaining_value >= 0 and exp >= 0: factor = int(math.pow(base, exp)) if factor <= remaining_value: multiple = remaining_value / factor return stringify(multiple) + \\ _convert(remaining_value-multiple*factor, \\ base, exp-1) else: return \"0\" + \\ _convert(remaining_value, base, exp-1) else: return \"\" return \"%s/%s\" % (_convert(value, base, \\ int(math.log(value, base))), base)","text_count":559,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    import math\n    def _convert(remaining_value, base, exp):\n        def stringify(value):\n            if value &gt; 9:\n                return chr(value + ord('a')-10)\n            else:\n                return str(value)\n        if remaining_value &gt;= 0 and exp &gt;= 0:\n            factor = int(math.pow(base, exp))\n            if factor &lt;= remaining_value:\n                multiple = remaining_value / factor\n                return stringify(multiple) + \\\n                  _convert(remaining_value-multiple*factor, \\\n                                base, exp-1)\n            else:\n                return \"0\" + \\\n                       _convert(remaining_value, base, exp-1)\n        else:\n            return \"\"\n    return \"%s/%s\" % (_convert(value, base, \\\n                         int(math.log(value, base))), base)"}]}]},{"block_type":"element","block":"k6bfva65","search_text":"Add a docstring just below the external function declaration that includes some of the tests: ","text_count":94,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a docstring just below the external function declaration that includes some of the tests:"}]}]},{"block_type":"element","block":"k6bfva66","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. >>> convert_to_basen(10, 2) '1010/2' >>> convert_to_basen(15, 16) 'f/16' >>> convert_to_basen(0, 2) Traceback (most recent call last): ... ValueError: math domain error >>> convert_to_basen(-1, 2) Traceback (most recent call last): ... ValueError: math domain error \"\"\" import math","text_count":353,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen.\n    \n    &gt;&gt;&gt; convert_to_basen(10, 2)\n    '1010/2'\n    \n    &gt;&gt;&gt; convert_to_basen(15, 16)\n    'f/16'\n    \n    &gt;&gt;&gt; convert_to_basen(0, 2)\n    Traceback (most recent call last):\n        ...\n    ValueError: math domain error\n    \n    &gt;&gt;&gt; convert_to_basen(-1, 2)\n    Traceback (most recent call last):\n        ...\n    ValueError: math domain error\n    \"\"\"\n    import math"}]}]},{"block_type":"element","block":"k6bfva67","search_text":"Run the code from the command line using -m doctest . As shown in the following screenshot, no output indicates that all the tests have passed: ","text_count":144,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code from the command line using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-m doctest"}]},{"block_type":"text","content":". As shown in the following screenshot, no output indicates that all the tests have passed:"}]}]},{"block_type":"element","block":"k6bfva68","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000133.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva69","search_text":"Run the code from the command line with -v to increase verbosity. What happens if we forget to include -m doctest ? Using the -v option helps us to avoid this by giving us a warm fuzzy feeling that our tests are working. Take a look at this screenshot: ","text_count":253,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code from the command line with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"to increase verbosity. What happens if we forget to include"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-m doctest"}]},{"block_type":"text","content":"? Using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"option helps us to avoid this by giving us a warm fuzzy&nbsp;feeling that our tests are working. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfva6a","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000006.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva6b","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva6c","search_text":"In the previous chapter, we were using the __main__ block of a module to run other test suites. What if we wanted to do the same here? We would have to pick whether __main__ would be for unittest tests, doctests, or both! What if we didn't even want to run testing through __main__ , but instead run our application?","text_count":316,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous chapter, we were using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__main__"}]},{"block_type":"text","content":"block of a module to run other test suites. What if we wanted to do the same here? We would have to pick whether"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__main__"}]},{"block_type":"text","content":"would be for unittest tests, doctests, or both! What if we didn't even want to run testing through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__main__"}]},{"block_type":"text","content":", but instead run our application?"}]},{"block_type":"element","block":"k6bfva6d","search_text":"That is why Python added the option of invoking testing right from the command line using -m doctest .","text_count":102,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That is why Python added the option of invoking testing right from the command line using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-m doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva6e","search_text":"Don't you want to know whether your tests are running or working? Is the test suite really doing what it promised? With other tools, we usually have to embed print statements, or deliberate failures just to know things are being trapped properly. Doesn't it appear that the -v option in doctest provides a convenient quick glance at what's happening?","text_count":350,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Don't you want to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"know"}]},{"block_type":"text","content":"whether your tests are running or working? Is the test suite really doing what it promised? With other tools, we usually have to embed print statements, or deliberate failures just to know things are being trapped properly. Doesn't it appear that the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"option in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"provides a convenient quick glance at what's happening?"}]},{"block_type":"element","block":"k6bfva6f","search_text":"Coding a test harness for doctest","text_count":33,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Coding a test harness for doctest"}]},{"block_type":"element","block":"k6bfva6g","search_text":"The tests we have written so far are very simple, because the function we are testing is simple. There are two inputs and one output with no side effects. No objects have to be created. This isn't the most common use case for us. Often, we have objects that interact with other objects.","text_count":286,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The tests we have written so far are very simple, because the function we are testing is simple. There are two inputs and one output with no side effects. No objects have to be created. This isn't the most common use case for us. Often, we have objects that interact with other objects."}]},{"block_type":"element","block":"k6bfva6h","search_text":"The doctest module supports creating objects, invoking methods, and checking results. With this recipe, we will explore this in more detail.","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module supports creating objects, invoking methods, and checking results. With this recipe, we will explore this in more detail."}]},{"block_type":"element","block":"k6bfva6i","search_text":"An important aspect of doctest is that it finds individual instances of docstrings, and runs them in a local context. Variables declared in one docstring cannot be used in another docstring.","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An important aspect of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"is that it finds individual instances of docstrings, and runs them in a local context. Variables declared in one docstring cannot be used in another docstring."}]},{"block_type":"element","block":"k6bfva6j","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva6k","search_text":"Create a new file called recipe19.py to contain the code from this recipe. ","text_count":75,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe19.py"}]},{"block_type":"text","content":"to contain the code from this recipe."}]}]},{"block_type":"element","block":"k6bfva6l","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","block":"k6bfva6m","search_text":"Write a simple shopping cart application: ","text_count":42,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a simple shopping cart application:"}]}]},{"block_type":"element","block":"k6bfva6n","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price def total(self, sales_tax): sum_price = sum([item.price for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return len(self.items) class Item(object): def __init__(self, item, price): self.item = item self.price = price","text_count":505,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n    def __init__(self):\n        self.items = []\n    def add(self, item, price):\n        self.items.append(Item(item, price))\n        return self\n    def item(self, index):\n        return self.items[index-1].item\n    def price(self, index):\n        return self.items[index-1].price\n    def total(self, sales_tax):\n        sum_price = sum([item.price for item in self.items])\n        return sum_price*(1.0 + sales_tax/100.0)\n    def __len__(self):\n        return len(self.items)\nclass Item(object):\n    def __init__(self, item, price):\n        self.item = item\n        self.price = price"}]}]},{"block_type":"element","block":"k6bfva6o","search_text":"Insert a docstring at the top of the module, before the ShoppingCart class declaration: ","text_count":88,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Insert a docstring at the top of the module, before the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":"class declaration:"}]}]},{"block_type":"element","block":"k6bfva6p","search_text":"\"\"\" This is documentation for the this entire recipe. With it, we can demonstrate usage of the code. >>> cart = ShoppingCart().add(\"tuna sandwich\", 15.0) >>> len(cart) 1 >>> cart.item(1) 'tuna sandwich' >>> cart.price(1) 15.0 >>> print (round(cart.total(9.25), 2)) 16.39 \"\"\" class ShoppingCart(object): ...","text_count":306,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"\"\"\"\nThis is documentation for the this entire recipe.\nWith it, we can demonstrate usage of the code.\n\n&gt;&gt;&gt; cart = ShoppingCart().add(\"tuna sandwich\", 15.0)\n&gt;&gt;&gt; len(cart)\n1\n&gt;&gt;&gt; cart.item(1)\n'tuna sandwich'\n&gt;&gt;&gt; cart.price(1)\n15.0\n&gt;&gt;&gt; print (round(cart.total(9.25), 2))\n16.39\n\"\"\"\nclass ShoppingCart(object):\n..."}]}]},{"block_type":"element","block":"k6bfva6q","search_text":"Run the recipe using -m doctest and -v for verbosity: ","text_count":54,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the recipe using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-m doctest"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"for verbosity:"}]}]},{"block_type":"element","block":"k6bfva6r","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000153.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva6s","search_text":"Copy all the code we just wrote from recipe19.py into a new file called recipe19b.py . Inside recipe19b.py , add another docstring to item , which attempts to reuse the cart variable defined at the top of the module: ","text_count":217,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy all the code we just wrote from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe19.py"}]},{"block_type":"text","content":"into a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe19b.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inside"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe19b.py"}]},{"block_type":"text","content":", add another docstring to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"item"}]},{"block_type":"text","content":", which attempts to reuse the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart"}]},{"block_type":"text","content":"variable defined at the top of the module:"}]}]},{"block_type":"element","block":"k6bfva6t","search_text":"def item(self, index): \"\"\" >>> cart.item(1) 'tuna sandwich' \"\"\" return self.items[index-1].item","text_count":95,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def item(self, index):\n    \"\"\"\n    &gt;&gt;&gt; cart.item(1)\n    'tuna sandwich'\n    \"\"\"\n    return self.items[index-1].item"}]}]},{"block_type":"element","block":"k6bfva6u","search_text":"Run this variant of the recipe. Why does it fail? Wasn't cart declared in the earlier docstring? Look at this screenshot: ","text_count":122,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run this variant of the recipe. Why does it fail? Wasn't"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart"}]},{"block_type":"text","content":"declared in the earlier docstring? Look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfva6v","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000142.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva6w","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva6x","search_text":"The doctest module looks for every docstring. For each docstring it finds, it creates a shallow copy of the module's global variables and then runs the code and checks results. Apart from that, every variable created is locally scoped and then cleaned up when the test is complete. This means that our second docstring that was added later cannot see the cart that was created in our first docstring. That is why the second run failed.","text_count":435,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module looks for every docstring. For each docstring it finds, it creates a shallow copy of the module's global variables and then runs the code and checks results. Apart from that, every variable created is locally scoped and then cleaned up when the test is complete. This means that our second docstring that was added later cannot see the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart"}]},{"block_type":"text","content":"that was created in our first docstring. That is why the second run failed."}]},{"block_type":"element","block":"k6bfva6y","search_text":"There is no equivalent to a setUp method as we used with some of the unittest recipes. If there is no setUp option with doctest , then what value is this recipe? It highlights a key limitation of doctest that all developers must understand before using it.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is no equivalent to a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"method as we used with some of the unittest recipes. If there is no"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":"option with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":", then what value is this recipe? It highlights a key limitation of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"that all developers must understand before using it."}]},{"block_type":"element","block":"k6bfva6z","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva70","search_text":"The doctest module provides an incredibly convenient way to add testability to our documentation. But this is not a substitute for a full-fledged testing framework, such as unittest. As noted earlier, there is no equivalent to a setUp . There is also no syntax checking of the Python code embedded in the docstrings.","text_count":316,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module provides an incredibly convenient way to add testability to our documentation. But this is not a substitute for a full-fledged testing framework, such as unittest. As noted earlier, there is no equivalent to a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setUp"}]},{"block_type":"text","content":". There is also no syntax checking of the Python code embedded in the docstrings."}]},{"block_type":"element","block":"k6bfva71","search_text":"Mixing the right level of a doctest with unittest (or any other testing framework we may pick) is a matter of judgment.","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Mixing the right level of a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"with unittest (or any other testing framework we may pick) is a matter of judgment."}]},{"block_type":"element","block":"k6bfva72","search_text":"Filtering out test noise","text_count":24,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Filtering out test noise"}]},{"block_type":"element","block":"k6bfva73","search_text":"Various options help doctest ignore noise, such as whitespace, in test cases. This can be useful, because it allows us to structure the expected outcome in a better way, to ease reading for the users.","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Various options help"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"ignore noise, such as whitespace, in test cases. This can be useful, because it allows us to structure the expected outcome in a better way, to ease reading for the users."}]},{"block_type":"element","block":"k6bfva74","search_text":"We can also flag some tests that can be skipped. This can be used where we want to document known issues, but haven't yet patched the system.","text_count":141,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We can also flag some tests that can be skipped. This can be used where we want to document known issues, but haven't yet patched the system."}]},{"block_type":"element","block":"k6bfva75","search_text":"Both of these situations can easily be construed as noise when we are trying to run comprehensive testing but are focused on other parts of the system. In this recipe, we will dig in to ease the strict checking done by doctest . We will also look at how to ignore entire tests, whether it's for temporary or permanent needs.","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Both of these situations can easily be construed as noise when we are trying to run comprehensive testing but are focused on other parts of the system. In this recipe, we will dig in to ease the strict checking done by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":". We will also look at how to ignore entire tests, whether it's for temporary or permanent needs."}]},{"block_type":"element","block":"k6bfva76","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva77","search_text":"With the following steps, we will experiment with filtering out test results and easing certain restrictions of doctest :","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will experiment with filtering out test results and easing certain restrictions of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfva78","search_text":"Create a new file called recipe20.py for the code from this recipe. ","text_count":68,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20.py"}]},{"block_type":"text","content":"for the code from this recipe."}]}]},{"block_type":"element","block":"k6bfva79","search_text":"Create a recursive function that converts base-10 numbers into other bases: ","text_count":76,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a recursive function that converts base-10 numbers into other bases:"}]}]},{"block_type":"element","block":"k6bfva7a","search_text":"def convert_to_basen(value, base): import math def _convert(remaining_value, base, exp): def stringify(value): if value > 9: return chr(value + ord('a')-10) else: return str(value) if remaining_value >= 0 and exp >= 0: factor = int(math.pow(base, exp)) if factor <= remaining_value: multiple = remaining_value / factor return stringify(multiple) + \\ _convert(remaining_value-multiple*factor, \\ base, exp-1) else: return \"0\" + \\ _convert(remaining_value, base, exp-1) else: return \"\" return \"%s/%s\" % (_convert(value, base, \\ int(math.log(value, base))), base)","text_count":559,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    import math\n    def _convert(remaining_value, base, exp):\n        def stringify(value):\n            if value &gt; 9:\n                return chr(value + ord('a')-10)\n            else:\n                return str(value)\n\n        if remaining_value &gt;= 0 and exp &gt;= 0:\n            factor = int(math.pow(base, exp))\n            if factor &lt;= remaining_value:\n                multiple = remaining_value / factor\n                return stringify(multiple) + \\\n                  _convert(remaining_value-multiple*factor, \\\n                                base, exp-1)\n            else:\n                return \"0\" + \\\n                       _convert(remaining_value, base, exp-1)\n        else:\n            return \"\"\n    return \"%s/%s\" % (_convert(value, base, \\\n                         int(math.log(value, base))), base)"}]}]},{"block_type":"element","block":"k6bfva7b","search_text":"Add a docstring that includes a test to exercise a range of values as well as document a future feature that is not yet implemented: ","text_count":133,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a docstring that includes a test to exercise a range of values as well as document a future feature that is not yet implemented:"}]}]},{"block_type":"element","block":"k6bfva7c","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. >>> [convert_to_basen(i, 16) for i in range(1,16)] #doctest: +NORMALIZE_WHITESPACE ['1/16', '2/16', '3/16', '4/16', '5/16', '6/16', '7/16', '8/16', '9/16', 'a/16', 'b/16', 'c/16', 'd/16', 'e/16', 'f/16'] FUTURE: Binary may support 2's complement in the future, but not now. >>> convert_to_basen(-10, 2) #doctest: +SKIP '0110/2' \"\"\" import math","text_count":415,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen.\n\n    &gt;&gt;&gt; [convert_to_basen(i, 16) for i in range(1,16)] #doctest:\n+NORMALIZE_WHITESPACE\n    ['1/16', '2/16', '3/16', '4/16', '5/16', '6/16', '7/16', '8/16',\n    '9/16',  'a/16', 'b/16', 'c/16', 'd/16', 'e/16', 'f/16']\n\n    FUTURE: Binary may support 2's complement in the future, but not\nnow.\n    &gt;&gt;&gt; convert_to_basen(-10, 2) #doctest: +SKIP\n    '0110/2'\n    \"\"\"\n    import math"}]}]},{"block_type":"element","block":"k6bfva7d","search_text":"Add a test runner: ","text_count":19,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test runner:"}]}]},{"block_type":"element","block":"k6bfva7e","search_text":"if __name__ == \"__main__\": import doctest doctest.testmod()","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import doctest\n    doctest.testmod()"}]}]},{"block_type":"element","block":"k6bfva7f","search_text":"Run the test case in verbose mode, as shown in this screenshot: ","text_count":64,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test case in verbose mode, as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfva7g","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000096.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva7h","search_text":"Copy the code from recipe20.py into a new file called recipe20b.py . ","text_count":69,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the code from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20.py"}]},{"block_type":"text","content":"into a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20b.py"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfva7i","search_text":"Edit recipe20b.py by updating the docstring to include another test exposing that our function doesn't convert 0 : ","text_count":115,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Edit"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20b.py"}]},{"block_type":"text","content":"by updating the docstring to include another test exposing that our function doesn't convert"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfva7j","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. >>> [convert_to_basen(i, 16) for i in range(1,16)] #doctest: +NORMALIZE_WHITESPACE ['1/16', '2/16', '3/16', '4/16', '5/16', '6/16', '7/16', '8/16', '9/16', 'a/16', 'b/16', 'c/16', 'd/16', 'e/16', 'f/16'] FUTURE: Binary may support 2's complement in the future, but not now. >>> convert_to_basen(-10, 2) #doctest: +SKIP '0110/2' BUG: Discovered that this algorithm doesn't handle 0. Need to patch it. TODO: Renable this when patched. >>> convert_to_basen(0, 2) '0/2' \"\"\" import math","text_count":553,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen.\n    &gt;&gt;&gt; [convert_to_basen(i, 16) for i in range(1,16)] #doctest:\n+NORMALIZE_WHITESPACE\n    ['1/16', '2/16', '3/16', '4/16', '5/16', '6/16', '7/16', '8/16',\n    '9/16',  'a/16', 'b/16', 'c/16', 'd/16', 'e/16', 'f/16']\n    FUTURE: Binary may support 2's complement in the future, but not\nnow.\n    &gt;&gt;&gt; convert_to_basen(-10, 2) #doctest: +SKIP\n    '0110/2'\n    BUG: Discovered that this algorithm doesn't handle 0. Need to patch\nit.\n    TODO: Renable this when patched.\n    &gt;&gt;&gt; convert_to_basen(0, 2)\n    '0/2'\n    \"\"\"\n    import math"}]}]},{"block_type":"element","block":"k6bfva7k","search_text":"Run the test case. Notice what is different about this version of the recipe and why it fails? Take a look at this screenshot: ","text_count":127,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test case. Notice what is different about this version of the recipe and why it fails? Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfva7l","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000123.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva7m","search_text":"Copy the code from recipe20b.py into a new file called recipe20c.py . ","text_count":70,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the code from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20b.py"}]},{"block_type":"text","content":"into a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20c.py"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfva7n","search_text":"Edit recipe20c.py and update the docstring, indicating that we will skip the test for now: ","text_count":91,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Edit"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe20c.py"}]},{"block_type":"text","content":"and update the docstring, indicating that we will skip the test for now:"}]}]},{"block_type":"element","block":"k6bfva7o","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. >>> [convert_to_basen(i, 16) for i in range(1,16)] #doctest: +NORMALIZE_WHITESPACE ['1/16', '2/16', '3/16', '4/16', '5/16', '6/16', '7/16', '8/16', '9/16', 'a/16', 'b/16', 'c/16', 'd/16', 'e/16', 'f/16'] FUTURE: Binary may support 2's complement in the future, but not now. >>> convert_to_basen(-10, 2) #doctest: +SKIP '0110/2' BUG: Discovered that this algorithm doesn't handle 0. Need to patch it. TODO: Renable this when patched. >>> convert_to_basen(0, 2) #doctest: +SKIP '0/2' \"\"\" import math","text_count":569,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base): \n    \"\"\"Convert a base10 number to basen. \n      \n    &gt;&gt;&gt; [convert_to_basen(i, 16) for i in range(1,16)] #doctest: +NORMALIZE_WHITESPACE \n    ['1/16', '2/16', '3/16', '4/16', '5/16', '6/16', '7/16', '8/16', \n    '9/16',  'a/16', 'b/16', 'c/16', 'd/16', 'e/16', 'f/16'] \n \n    FUTURE: Binary may support 2's complement in the future, but not now. \n    &gt;&gt;&gt; convert_to_basen(-10, 2) #doctest: +SKIP \n    '0110/2' \n \n    BUG: Discovered that this algorithm doesn't handle 0. Need to patch it. \n    TODO: Renable this when patched. \n    &gt;&gt;&gt; convert_to_basen(0, 2) #doctest: +SKIP \n    '0/2' \n    \"\"\" \n    import math"}]}]},{"block_type":"element","block":"k6bfva7p","search_text":"Run the test case. Take a look at this screenshot: ","text_count":51,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test case. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfva7q","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000002.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva7r","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva7s","search_text":"In this recipe, we revisit the function for converting from base-10 to any base numbers. The first test shows it being run over a range. Normally, Python would fit this array of results on one line. To make it more readable, we spread the output across two lines. We also put some arbitrary spaces between the values to make the columns line up better.","text_count":352,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we revisit the function for converting from base-10 to any base numbers. The first test shows it being run over a range. Normally, Python would fit this array of results on one line. To make it more readable, we spread the output across two lines. We also put some arbitrary spaces between the values to make the columns line up better."}]},{"block_type":"element","block":"k6bfva7t","search_text":"This is something that doctest definitely would not support, due to its strict pattern matching nature. By using #doctest: +NORMALIZE_WHITESPACE , we are able to ask doctest to ease this restriction. There are still constraints. For example, the first value in the expected array cannot have any whitespace in front of it ( believe me, I tried for maximum readability! ) But wrapping the array to the next line no longer breaks the test.","text_count":437,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is something that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"definitely would"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"support, due to its strict pattern matching nature. By using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#doctest: +NORMALIZE_WHITESPACE"}]},{"block_type":"text","content":", we are able to ask"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"to ease this restriction. There are still constraints. For example, the first value in the expected array cannot have any whitespace in front of it ("},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"believe me, I tried for maximum readability!"}]},{"block_type":"text","content":") But wrapping the array to the next line no longer breaks the test."}]},{"block_type":"element","block":"k6bfva7u","search_text":"We also have a test case that is really meant as documentation only. It indicates a future requirement that shows how our function would handle negative binary values. By adding #doctest: +SKIP , we are able to command doctest to skip this particular instance.","text_count":260,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also have a test case that is really meant as documentation only. It indicates a future requirement that shows how our function would handle negative binary values. By adding"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#doctest: +SKIP"}]},{"block_type":"text","content":", we are able to command"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"to skip this particular instance."}]},{"block_type":"element","block":"k6bfva7v","search_text":"Finally, we see a scenario where we discover that our code doesn't handle 0 . As the algorithm gets the highest exponent by taking a logarithm, there is a math problem. We capture this edge case with a test. We then confirm that the code fails in classic test- driven design ( TDD ) fashion. The final step would be to fix the code to handle this edge case. But we decide, in a somewhat contrived fashion, that we don't have enough time in the current sprint to fix the code. To avoid breaking our continuous integration ( CI ) server, we mark the test with a TO-DO statement and add #doctest: +SKIP .","text_count":601,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we see a scenario where we discover that our code doesn't handle"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":". As the algorithm gets the highest exponent by taking a logarithm, there is a math problem. We capture this edge case with a test. We then confirm that the code fails in classic"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"test-"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"driven&nbsp;"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"design"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"TDD"}]},{"block_type":"text","content":") fashion. The final step would be to fix the code to handle this edge case. But we decide, in a somewhat contrived fashion, that we don't have enough time in the current sprint to fix the code. To avoid breaking our"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"continuous&nbsp;"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"integration"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"CI"}]},{"block_type":"text","content":") server, we mark the test with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TO-DO"}]},{"block_type":"text","content":"statement and add"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#doctest: +SKIP"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva7w","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva7x","search_text":"Both situations that we have marked up with #doctest: +SKIP are cases where eventually we will want to remove the SKIP tag and have them run. There may be other situations where we will never remove SKIP . Demonstrations of code that have big fluctuations may not be readily testable without making them unreadable. For example, functions that return dictionaries are harder to test because the order of results vary. We can bend it to pass a test, but we may lose the value of the documentation in order to present it to the reader.","text_count":533,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Both situations that we have marked up with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#doctest: +SKIP"}]},{"block_type":"text","content":"&nbsp;are cases where eventually we will want to remove the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SKIP"}]},{"block_type":"text","content":"tag and have them run. There may be other situations where we will never remove"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SKIP"}]},{"block_type":"text","content":". Demonstrations of code that have big fluctuations may not be readily testable without making them unreadable. For example, functions that return dictionaries are harder to test because the order of results vary. We can bend it to pass a test, but we may lose the value of the documentation in order to present it to the reader."}]},{"block_type":"element","block":"k6bfva7y","search_text":"Printing out all your documentation including a status report","text_count":61,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Printing out all your documentation including a status report"}]},{"block_type":"element","block":"k6bfva7z","search_text":"Since this chapter has been about both documentation and testing, let's build a script that takes a set of modules and prints out a complete report, showing all documentation as well as running any given tests.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Since this chapter has been about both documentation and testing, let's build a script that takes a set of modules and prints out a complete report, showing all documentation as well as running any given tests."}]},{"block_type":"element","block":"k6bfva80","search_text":"This is a valuable recipe, because it shows us how to use Python's APIs to harvest a code-driven runnable report. This means the documentation is accurate and up to date, reflecting the current state of our code.","text_count":212,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is a valuable recipe, because it shows us how to use Python's APIs to harvest a code-driven runnable report. This means the documentation is accurate and up to date, reflecting the current state of our code."}]},{"block_type":"element","block":"k6bfva81","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva82","search_text":"In the following steps, we will write an application and some doctests . Then we will build a script to harvest a useful report:","text_count":128,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the following steps, we will write an application and some"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctests"}]},{"block_type":"text","content":". Then we will build a script to harvest a useful report:"}]},{"block_type":"element","block":"k6bfva83","search_text":"Create a new file called recipe21_report.py to contain the script that harvests our report. Start creating a script by importing Python's inspect library as the basis for drilling down into a module: from inspect import* . Add a function that focuses on either printing out an item's __doc__ string or prints out that no documentation was found: ","text_count":346,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe21_report.py"}]},{"block_type":"text","content":"to contain the script that harvests our report."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start creating a script by importing Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"inspect"}]},{"block_type":"text","content":"library as the basis for drilling down into a module:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"from inspect import*"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a function that focuses on either printing out an item's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__doc__"}]},{"block_type":"text","content":"string or prints out that no&nbsp;documentation was found:"}]}]},{"block_type":"element","block":"k6bfva84","search_text":"def print_doc(name, item): if item.__doc__: print \"Documentation for %s\" % name print \"-------------------------------\" print item.doc print \"-------------------------------\" else: print \"Documentation for %s - None\" % name","text_count":223,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def print_doc(name, item):\n    if item.__doc__:\n        print \"Documentation for %s\" % name\n        print \"-------------------------------\"\n        print item.doc\n        print \"-------------------------------\"\n    else:\n        print \"Documentation for %s - None\" % name"}]}]},{"block_type":"element","block":"k6bfva85","search_text":"Add a function that prints out the documentation based on a given module. Make sure this function looks for classes, methods, and functions, and prints out their docs: ","text_count":168,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a function that prints out the documentation based on a given module. Make sure this function looks for classes, methods, and functions, and prints out their docs:"}]}]},{"block_type":"element","block":"k6bfva86","search_text":"def print_docstrings(m, prefix=\"\"): print_doc(prefix + \"module %s\" % m.__name__, m) for (name, value) in getmembers(m, isclass): if name == '__class__': continue print_docstrings(value, prefix=name + \".\") for (name, value) in getmembers(m, ismethod): print_doc(\"%s%s()\" % (prefix, name), value) for (name, value) in getmembers(m, isfunction): print_doc(\"%s%s()\" % (prefix, name), value)","text_count":386,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def print_docstrings(m, prefix=\"\"):\n    print_doc(prefix + \"module %s\" % m.__name__, m)\n    \n    for (name, value) in getmembers(m, isclass):\n        if name == '__class__': continue\n        print_docstrings(value, prefix=name + \".\")\n    for (name, value) in getmembers(m, ismethod):\n        print_doc(\"%s%s()\" % (prefix, name), value)\n    for (name, value) in getmembers(m, isfunction):\n        print_doc(\"%s%s()\" % (prefix, name), value)"}]}]},{"block_type":"element","block":"k6bfva87","search_text":"Add a runner that parses the command-line string, and iterates over each provided module: ","text_count":90,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a runner that parses the command-line string, and iterates over each provided module:"}]}]},{"block_type":"element","block":"k6bfva88","search_text":"if __name__ == \"__main__\": import sys import doctest for arg in sys.argv[1:]: if arg.startswith(\"-\"): continue print \"===============================\" print \"== Processing module %s\" % arg print \"===============================\" m = __import__(arg) print_docstrings(m) print \"Running doctests for %s\" % arg print \"-------------------------------\" doctest.testmod(m)","text_count":365,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import sys\n    import doctest\n    \n    for arg in sys.argv[1:]:\n        if arg.startswith(\"-\"): continue\n        print \"===============================\"\n        print \"== Processing module %s\" % arg\n        print \"===============================\"\n        m = __import__(arg)\n        print_docstrings(m)\n        print \"Running doctests for %s\" % arg\n        print \"-------------------------------\"\n        doctest.testmod(m)"}]}]},{"block_type":"element","block":"k6bfva89","search_text":"Create a new file, recipe21.py , to contain an application with tests that we will run the earlier script against. ","text_count":115,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe21.py"}]},{"block_type":"text","content":", to contain an application with tests that we will run the earlier script against."}]}]},{"block_type":"element","block":"k6bfva8a","search_text":"In recipe21.py , create a shopping cart app and fill it with docstrings and doctests . This is documentation for the entire recipe. With it, we can demonstrate usage of the code: ","text_count":179,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe21.py"}]},{"block_type":"text","content":", create a shopping cart app and fill it with docstrings and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctests"}]},{"block_type":"text","content":". This is documentation for the entire recipe. With it, we can demonstrate usage of the code:"}]}]},{"block_type":"element","block":"k6bfva8b","search_text":">>> cart = ShoppingCart().add(\"tuna sandwich\", 15.0) >>> len(cart) 1 >>> cart.item(1) 'tuna sandwich' >>> cart.price(1) 15.0 >>> print round(cart.total(9.25), 2) 16.39 \"\"\" class ShoppingCart(object): \"\"\" This object is used to store the goods. It conveniently calculates total cost including tax. \"\"\" def __init__(self): self.items = [] def add(self, item, price): \"Add an item to the internal list.\" self.items.append(Item(item, price)) return self def item(self, index): \"Look up the item. The cart is a 1-based index.\" return self.items[index-1].item def price(self, index): \"Look up the price. The cart is a 1-based index.\" return self.items[index-1].price def total(self, sales_tax): \"Add up all costs, and then apply a sales tax.\" sum_price = sum([item.price for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): \"Support len(cart) operation.\" return len(self.items) class Item(object): def __init__(self, item, price): self.item = item self.price = price","text_count":992,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; cart = ShoppingCart().add(\"tuna sandwich\", 15.0)\n&gt;&gt;&gt; len(cart)\n1\n&gt;&gt;&gt; cart.item(1)\n'tuna sandwich'\n&gt;&gt;&gt; cart.price(1)\n15.0\n&gt;&gt;&gt; print round(cart.total(9.25), 2)\n16.39\n\"\"\"\n\nclass ShoppingCart(object):\n    \"\"\"\n    This object is used to store the goods.\n    It conveniently calculates total cost including\n    tax.\n    \"\"\"\n    def __init__(self):\n        self.items = []\n    def add(self, item, price):\n        \"Add an item to the internal list.\"\n        self.items.append(Item(item, price))\n        return self\n    def item(self, index):\n        \"Look up the item. The cart is a 1-based index.\"\n        return self.items[index-1].item\n    def price(self, index):\n        \"Look up the price. The cart is a 1-based index.\"\n        return self.items[index-1].price\n    def total(self, sales_tax):\n        \"Add up all costs, and then apply a sales tax.\"\n        sum_price = sum([item.price for item in self.items])\n        return sum_price*(1.0 + sales_tax/100.0)\n    def __len__(self):\n        \"Support len(cart) operation.\"\n        return len(self.items)\n\nclass Item(object):\n    def __init__(self, item, price):\n        self.item = item\n        self.price = price"}]}]},{"block_type":"element","block":"k6bfva8c","search_text":"Run the report script against this module using -v , and look at the screen's output: ","text_count":86,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the report script against this module using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":", and look at the screen's output:"}]}]},{"block_type":"element","block":"k6bfva8d","search_text":"=============================== == Processing module recipe21 =============================== Documentation for module recipe21 ------------------------------- This is documentation for the this entire recipe. With it, we can demonstrate usage of the code. >>> cart = ShoppingCart().add(\"tuna sandwich\", 15.0) >>> len(cart) 1 >>> cart.item(1) 'tuna sandwich' >>> cart.price(1) 15.0 >>> print round(cart.total(9.25), 2) 16.39 ------------------------------- Documentation for Item.module Item - None Documentation for Item.__init__() - None Documentation for ShoppingCart.module ShoppingCart ------------------------------- This object is used to store the goods. It conveniently calculates total cost including tax. … Running doctests for recipe21 ------------------------------- Trying: cart = ShoppingCart().add(\"tuna sandwich\", 15.0) Expecting nothing ok Trying: len(cart) Expecting: 1 ok 5 tests in 10 items. 5 passed and 0 failed. Test passed.","text_count":948,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"===============================\n== Processing module recipe21\n===============================\nDocumentation for module recipe21\n-------------------------------\nThis is documentation for the this entire recipe.\nWith it, we can demonstrate usage of the code.\n&gt;&gt;&gt; cart = ShoppingCart().add(\"tuna sandwich\", 15.0)\n&gt;&gt;&gt; len(cart)\n1\n&gt;&gt;&gt; cart.item(1)\n'tuna sandwich'\n&gt;&gt;&gt; cart.price(1)\n15.0\n&gt;&gt;&gt; print round(cart.total(9.25), 2)\n16.39\n-------------------------------\nDocumentation for Item.module Item - None\nDocumentation for Item.__init__() - None\nDocumentation for ShoppingCart.module ShoppingCart\n-------------------------------\n    This object is used to store the goods.\n    It conveniently calculates total cost including\n    tax.\n&hellip;\nRunning doctests for recipe21\n-------------------------------\nTrying:\n    cart = ShoppingCart().add(\"tuna sandwich\", 15.0)\nExpecting nothing\nok\nTrying:\n    len(cart)\nExpecting:\n    1\nok\n5 tests in 10 items.\n5 passed and 0 failed.\nTest passed."}]}]},{"block_type":"element","block":"k6bfva8e","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva8f","search_text":"This script is tiny, yet it harvests a lot of useful information.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This script is tiny, yet it harvests a lot of useful information."}]},{"block_type":"element","block":"k6bfva8g","search_text":"By using Python's standard inspect module, we are able to drill down starting at the module level. The reflective way to look up a docstring is by accessing the __doc__ property of an object. This is contained in modules, classes, methods, and functions. They exist in other places, but we limited our focus for this recipe.","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By using Python's standard"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"inspect"}]},{"block_type":"text","content":"module, we are able to drill down starting at the module level. The reflective way to look up a docstring is by accessing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__doc__"}]},{"block_type":"text","content":"property of an object. This is contained in modules, classes, methods, and functions. They exist in other places, but we limited our focus for this recipe."}]},{"block_type":"element","block":"k6bfva8h","search_text":"We ran it in verbose mode to show that the tests were actually executed. We hand parsed the command-line options, but doctest automatically looks for -v to decide whether or not to turn on verbose output. To prevent our module processor from catching this and trying to process it as another module, we added a line to skip any -xyz style flags:","text_count":345,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We ran it in verbose mode to show that the tests were actually executed. We hand parsed the command-line options, but"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"automatically looks for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"to decide whether or not to turn on verbose output. To prevent our module processor from catching this and trying to process it as another module, we added a line to skip any"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-xyz"}]},{"block_type":"text","content":"style flags:"}]},{"block_type":"element","block":"k6bfva8i","search_text":"if arg.startswith(\"-\"): continue ","text_count":33,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if arg.startswith(\"-\"): continue"}]}]},{"block_type":"element","block":"k6bfva8j","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva8k","search_text":"We could spend more time enhancing this script. For example, we could dump this out with an HTML markup, making it viewable in a web browser. We could also find third-party libraries to export it in other ways.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We could spend more time enhancing this script. For example, we could dump this out with an HTML markup, making it viewable in a web browser. We could also find third-party libraries to export it in other ways."}]},{"block_type":"element","block":"k6bfva8l","search_text":"We could also work on refining where it looks for docstrings and how it handles them. In our case, we just printed them to the screen. A more reusable approach would be to return some type of structure containing all the information. Then, the caller can decide whether to print to screen, encode it in HTML, or generate a PDF document.","text_count":336,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We could also work on refining where it looks for docstrings and how it handles them. In our case, we just printed them to the screen. A more reusable approach would be to return some type of structure containing all the information. Then, the caller can decide whether to print to screen, encode it in HTML, or generate a PDF document."}]},{"block_type":"element","block":"k6bfva8m","search_text":"This isn't necessary, because this recipe's focus is on seeing how to mix these powerful out-of-the-box options Python provides into a quick and useful tool.","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This isn't necessary, because this recipe's focus is on seeing how to mix these powerful out-of-the-box options Python provides into a quick and useful tool."}]},{"block_type":"element","block":"k6bfva8n","search_text":"Testing the edges","text_count":17,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing the edges"}]},{"block_type":"element","block":"k6bfva8o","search_text":"Tests need to exercise the boundaries of our code up to and beyond the range limits. In this recipe, we will dig into defining and testing edges with doctest .","text_count":159,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Tests need to exercise the boundaries of our code up to and beyond the range limits. In this recipe, we will dig into defining and testing edges with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva8p","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva8q","search_text":"With the following steps, we will see how to write code that tests the edges of our software:","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will see how to write code that tests the edges of our software:"}]},{"block_type":"element","block":"k6bfva8r","search_text":"Create a new file named recipe22.py and use it to place all of our code for this recipe. ","text_count":89,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe22.py"}]},{"block_type":"text","content":"and use it to place all of our code for this recipe."}]}]},{"block_type":"element","block":"k6bfva8s","search_text":"Create a function that converts base-10 numbers to anything between base-2 and base-36: ","text_count":88,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that converts base-10 numbers to anything between base-2 and base-36:"}]}]},{"block_type":"element","block":"k6bfva8t","search_text":"def convert_to_basen(value, base): if base < 2 or base > 36: raise Exception(\"Only support bases 2-36\") import math def _convert(remaining_value, base, exp): def stringify(value): if value > 9: return chr(value + ord('a')-10) else: return str(value) if remaining_value >= 0 and exp >= 0: factor = int(math.pow(base, exp)) if factor <= remaining_value: multiple = remaining_value / factor return stringify(multiple) + \\ _convert(remaining_value-multiple*factor, \\ base, exp-1) else: return \"0\" + \\ _convert(remaining_value, base, exp-1) else: return \"\" return \"%s/%s\" % (_convert(value, base, \\ int(math.log(value, base))), base)","text_count":628,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    if base &lt; 2 or base &gt; 36:\n        raise Exception(\"Only support bases 2-36\")\n    \n    import math\n    def _convert(remaining_value, base, exp):\n        def stringify(value):\n            if value &gt; 9:\n                return chr(value + ord('a')-10)\n            else:\n                return str(value)\n        \n        if remaining_value &gt;= 0 and exp &gt;= 0:\n            factor = int(math.pow(base, exp))\n            if factor &lt;= remaining_value:\n                multiple = remaining_value / factor\n                return stringify(multiple) + \\\n                  _convert(remaining_value-multiple*factor, \\\n                                base, exp-1)\n            else:\n                return \"0\" + \\\n                       _convert(remaining_value, base, exp-1)\n        else:\n            return \"\"\n\n    return \"%s/%s\" % (_convert(value, base, \\\n                         int(math.log(value, base))), base)"}]}]},{"block_type":"element","block":"k6bfva8u","search_text":"Add a docstring just below our function declaration that includes tests showing base-2 edges, base-36 edges, and the invalid base-37: ","text_count":134,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a docstring just below our function declaration that includes tests showing base-2 edges, base-36 edges, and the invalid base-37:"}]}]},{"block_type":"element","block":"k6bfva8v","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. These show the edges for base 2. >>> convert_to_basen(1, 2) '1/2' >>> convert_to_basen(2, 2) '10/2' >>> convert_to_basen(0, 2) Traceback (most recent call last): ... ValueError: math domain error These show the edges for base 36. >>> convert_to_basen(1, 36) '1/36' >>> convert_to_basen(35, 36) 'z/36' >>> convert_to_basen(36, 36) '10/36' >>> convert_to_basen(0, 36) Traceback (most recent call last): ... ValueError: math domain error These show the edges for base 37. >>> convert_to_basen(1, 37) Traceback (most recent call last): ... Exception: Only support bases 2-36 >>> convert_to_basen(36, 37) Traceback (most recent call last): ... Exception: Only support bases 2-36 >>> convert_to_basen(37, 37) Traceback (most recent call last): ... Exception: Only support bases 2-36 >>> convert_to_basen(0, 37) Traceback (most recent call last): ... Exception: Only support bases 2-36 \"\"\" if base < 2 or base > 36:","text_count":980,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen.\n\n    These show the edges for base 2.\n    &gt;&gt;&gt; convert_to_basen(1, 2)\n    '1/2'\n    &gt;&gt;&gt; convert_to_basen(2, 2)\n    '10/2'\n    &gt;&gt;&gt; convert_to_basen(0, 2)\n    Traceback (most recent call last):\n       ...\n    ValueError: math domain error\n\n    These show the edges for base 36.\n    &gt;&gt;&gt; convert_to_basen(1, 36)\n    '1/36'\n    &gt;&gt;&gt; convert_to_basen(35, 36)\n    'z/36'\n    &gt;&gt;&gt; convert_to_basen(36, 36)\n    '10/36'\n    &gt;&gt;&gt; convert_to_basen(0, 36)\n    Traceback (most recent call last):\n       ...\n    ValueError: math domain error\n\n    These show the edges for base 37.\n    &gt;&gt;&gt; convert_to_basen(1, 37)\n    Traceback (most recent call last):\n       ...\n    Exception: Only support bases 2-36\n    &gt;&gt;&gt; convert_to_basen(36, 37)\n    Traceback (most recent call last):\n       ...\n    Exception: Only support bases 2-36\n    &gt;&gt;&gt; convert_to_basen(37, 37)\n    Traceback (most recent call last):\n       ...\n    Exception: Only support bases 2-36\n    &gt;&gt;&gt; convert_to_basen(0, 37)   \n    Traceback (most recent call last):\n       ...\n    Exception: Only support bases 2-36\n    \"\"\"\n    if base &lt; 2 or base &gt; 36:"}]}]},{"block_type":"element","block":"k6bfva8w","search_text":"Add a test runner: ","text_count":19,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test runner:"}]}]},{"block_type":"element","block":"k6bfva8x","search_text":"if __name__ == \"__main__\": import doctest doctest.testmod()","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import doctest\n    doctest.testmod()"}]}]},{"block_type":"element","block":"k6bfva8y","search_text":"Run the recipe, as shown in this screenshot: ","text_count":45,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the recipe, as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfva8z","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000103.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva90","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva91","search_text":"This version has a limit of handling base-2 through base-36.","text_count":60,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This version has a limit of handling base-2 through base-36."}]},{"block_type":"element","block":"k6bfva92","search_text":"For base-36, it uses a to z . This is compared to base-16 that uses a to f . 35 in base-10 is represented as z in base-36.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For base-36, it uses"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"text","content":"to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"z"}]}]},{"block_type":"text","content":". This is compared to base-16 that uses"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"text","content":"to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"f"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"35"}]},{"block_type":"text","content":"in base-10 is represented as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"z"}]},{"block_type":"text","content":"in base-36."}]},{"block_type":"element","block":"k6bfva93","search_text":"We include several tests, including 1 for base-2 and base-36. We also test the maximum value before rolling over, and the next value, to show the rollover. For base-2, this is 1 and 2 . For base-36, this is 35 and 36 .","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We include several tests, including"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"for base-2 and base-36. We also test the maximum value before rolling over, and the next value, to show the rollover. For base-2, this is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"2"}]},{"block_type":"text","content":". For base-36, this is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"35"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"36"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva94","search_text":"As we have also included tests for 0 to show that our function doesn't handle this for any base, we also test base-37, which is invalid as well.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As we have also included tests for 0 to show that our function doesn't handle this for any base, we also test base-37, which is invalid as well."}]},{"block_type":"element","block":"k6bfva95","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfva96","search_text":"It's important that our software works for valid inputs. It's just as important that our software works as expected for invalid inputs. We have documentation that can be viewed by our users when using our software that documents these edges. And, thanks to Python's doctest module, we can test it and make sure that our software performs correctly.","text_count":348,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important that our software works for valid inputs. It's just as important that our software works as expected for invalid inputs. We have documentation that can be viewed by our users when using our software that documents these edges. And, thanks to Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"module, we can test it and make sure that our software performs correctly."}]},{"block_type":"element","block":"k6bfva97","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfva98","search_text":"The Testing the edges section mentioned in Chapter 1, Using Unittest to Develop Basic Tests .","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"the&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"edges"}]},{"block_type":"text","content":"section mentioned in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic Tests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfva99","search_text":"Testing corner cases by iteration","text_count":33,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing corner cases by iteration"}]},{"block_type":"element","block":"k6bfva9a","search_text":"Corner cases will appear as we continue to develop our code. By capturing corner cases in an iterable list, there is less code to write for capturing another test scenario. This can increase our efficiency at testing new scenarios.","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Corner cases will appear as we continue to develop our code. By capturing corner cases in an iterable list, there is less code to write for capturing another test scenario. This can increase our efficiency at testing new scenarios."}]},{"block_type":"element","block":"k6bfva9b","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfva9c","search_text":"Create a new file called recipe23.py , and use it to store all our code for this recipe. Create a function that converts base-10 to any other base: ","text_count":148,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe23.py"}]},{"block_type":"text","content":", and use it to store all our code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that converts base-10 to any other base:"}]}]},{"block_type":"element","block":"k6bfva9d","search_text":"def convert_to_basen(value, base): import math def _convert(remaining_value, base, exp): def stringify(value): if value > 9: return chr(value + ord('a')-10) else: return str(value) if remaining_value >= 0 and exp >= 0: factor = int(math.pow(base, exp)) if factor <= remaining_value: multiple = remaining_value / factor return stringify(multiple) + \\ _convert(remaining_value-multiple*factor, \\ base, exp-1) else: return \"0\" + \\ _convert(remaining_value, base, exp-1) else: return \"\" return \"%s/%s\" % (_convert(value, base, \\ int(math.log(value, base))), base)","text_count":559,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    import math\n\n    def _convert(remaining_value, base, exp):\n        def stringify(value):\n            if value &gt; 9:\n                return chr(value + ord('a')-10)\n            else:\n                return str(value)\n\n        if remaining_value &gt;= 0 and exp &gt;= 0:\n            factor = int(math.pow(base, exp))\n            if factor &lt;= remaining_value:\n                multiple = remaining_value / factor\n                return stringify(multiple) + \\\n                  _convert(remaining_value-multiple*factor, \\\n                                base, exp-1)\n            else:\n                return \"0\" + \\\n                       _convert(remaining_value, base, exp-1)\n        else:\n            return \"\"\n\n    return \"%s/%s\" % (_convert(value, base, \\\n                         int(math.log(value, base))), base)"}]}]},{"block_type":"element","block":"k6bfva9e","search_text":"Add some instances of doctest that include an array of input values to generate an array of expected outputs. Include one failure: ","text_count":131,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some instances of&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"that include an array of input values to generate an array of expected outputs. Include one failure:"}]}]},{"block_type":"element","block":"k6bfva9f","search_text":"def convert_to_basen(value, base): \"\"\"Convert a base10 number to basen. Base 2 >>> inputs = [(1,2,'1/2'), (2,2,'11/2')] >>> for value,base,expected in inputs: ... actual = convert_to_basen(value,base) ... assert actual == expected, 'expected: %s actual: %s' % (expected, actual) >>> convert_to_basen(0, 2) Traceback (most recent call last): ... ValueError: math domain error Base 36. >>> inputs = [(1,36,'1/36'), (35,36,'z/36'), (36,36,'10/36')] >>> for value,base,expected in inputs: ... actual = convert_to_basen(value,base) ... assert actual == expected, 'expected: %s actual: %s' % (expected, value) >>> convert_to_basen(0, 36) Traceback (most recent call last): ... ValueError: math domain error \"\"\" import math","text_count":716,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def convert_to_basen(value, base):\n    \"\"\"Convert a base10 number to basen.\n\n    Base 2\n    &gt;&gt;&gt; inputs = [(1,2,'1/2'), (2,2,'11/2')]\n    &gt;&gt;&gt; for value,base,expected in inputs:\n    ...     actual = convert_to_basen(value,base)\n    ...     assert actual == expected, 'expected: %s actual: %s' %\n(expected, actual)\n\n    &gt;&gt;&gt; convert_to_basen(0, 2)\n    Traceback (most recent call last):\n       ...\n    ValueError: math domain error\n\n    Base 36.\n    &gt;&gt;&gt; inputs = [(1,36,'1/36'), (35,36,'z/36'), (36,36,'10/36')]\n    &gt;&gt;&gt; for value,base,expected in inputs:\n    ...     actual = convert_to_basen(value,base)\n    ...     assert actual == expected, 'expected: %s actual: %s' %\n(expected, value)\n\n    &gt;&gt;&gt; convert_to_basen(0, 36)\n    Traceback (most recent call last):\n       ...\n    ValueError: math domain error\n    \"\"\"\n    import math"}]}]},{"block_type":"element","block":"k6bfva9g","search_text":"Add a test runner: ","text_count":19,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test runner:"}]}]},{"block_type":"element","block":"k6bfva9h","search_text":"if __name__ == \"__main__\": import doctest doctest.testmod()","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n    import doctest\n    doctest.testmod()"}]}]},{"block_type":"element","block":"k6bfva9i","search_text":"Run the recipe: ","text_count":16,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the recipe:"}]}]},{"block_type":"element","block":"k6bfva9j","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000091.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfva9k","search_text":"In the previous screenshot, the key information is on this line: AssertionError: expected: 11/2 actual: 10/2 . Is this test failure a bit contrived? Sure it is. But seeing a test case that shows useful output is not. It's important to verify that our tests give us enough information to fix either the tests or the code.","text_count":320,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous screenshot, the key information is on this line:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"AssertionError: expected: 11/2 actual: 10/2"}]},{"block_type":"text","content":". Is this test failure a bit contrived? Sure it is. But seeing a test case that shows useful output is not. It's important to verify that our tests give us enough information to fix either the tests or the code."}]},{"block_type":"element","block":"k6bfva9l","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfva9m","search_text":"We created an array with each entry containing both the input data as well as the expected output. This provides us an easy way to glance at a set of test cases.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We created an array with each entry containing both the input data as well as the expected output. This provides us an easy way to glance at a set of test cases."}]},{"block_type":"element","block":"k6bfva9n","search_text":"Then, we iterated over each test case, calculated the actual value, and ran it through a Python assert . An important part that is needed is the custom message 'expected: %s actual: %s' . Without it, we would never get the information that tells us which test case failed.","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, we iterated over each test case, calculated the actual value, and ran it through a Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":". An important part that is needed is the custom message"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'expected: %s actual: %s'"}]},{"block_type":"text","content":". Without it, we would never get the information that tells us which test case failed."}]},{"block_type":"element","block":"k6bfva9o","search_text":"Tip What if one test case fails? If one of the tests in the array fails, then that code block exits and skips over the rest of the tests. This is the trade-off for having a more succinct set of tests. ","text_count":201,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"What if one test case fails?"}]},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"If one of the tests in the array fails, then that code block exits and skips over the rest of the tests. This is the trade-off for having a more succinct set of tests."}]}]},{"block_type":"element","block":"k6bfva9p","search_text":"Does this type of test fit better into doctest or unittest?","text_count":59,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Does this type of test fit better into doctest or unittest?"}]},{"block_type":"element","block":"k6bfva9q","search_text":"Here are some criteria to help you decide whether it's worth putting these tests in doctest :","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Here are some criteria to help you decide whether it's worth putting these tests in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfva9r","search_text":"Is the code easy to comprehend at a glance? Is there clear, succinct, useful information when users view the docstrings? ","text_count":121,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Is the code easy to comprehend at a glance?"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Is there clear, succinct, useful information when users view the docstrings?"}]}]},{"block_type":"element","block":"k6bfva9s","search_text":"If there is little value of having this in the documentation, and it clutters the code, then that is a strong hint that this test block belongs to a separate test module.","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If there is little value of having this in the documentation, and it clutters the code, then that is a strong hint that this test block belongs to a separate test module."}]},{"block_type":"element","block":"k6bfva9t","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfva9u","search_text":"The Testing corner cases by iteration section of Chapter 1, Using Unittest to Develop Basic Tests","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"corner&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"cases&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"by&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"iteration"}]},{"block_type":"text","content":"section of Chapter&nbsp;1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic Tests"}]}]},{"block_type":"element","block":"k6bfva9v","search_text":"Getting nosy with doctest","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Getting nosy with doctest"}]},{"block_type":"element","block":"k6bfva9w","search_text":"Up to this point, we have been either appending modules with a test runner, or we have typed python -m doctest <module> on the command line to exercise our tests.","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Up to this point, we have been either appending modules with a test runner, or we have typed"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python -m doctest &lt;module&gt;"}]},{"block_type":"text","content":"on the command line to exercise our tests."}]},{"block_type":"element","block":"k6bfva9x","search_text":"In the previous chapter, we introduced the powerful nose library (refer to http://somethingaboutorange.com/mrl/projects/nose for more details).","text_count":143,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous chapter, we introduced the powerful&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"&nbsp;library (refer to&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://somethingaboutorange.com/mrl/projects/nose"},"children":[{"block_type":"text","content":"http://somethingaboutorange.com/mrl/projects/nose"}]},{"block_type":"text","content":"for more details)."}]},{"block_type":"element","block":"k6bfva9y","search_text":"For a quick recap, nose has the following features:","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For a quick recap, nose has the following features:"}]},{"block_type":"element","block":"k6bfva9z","search_text":"Provides us with the convenient test discovering tool nosetests Is pluggable, with a huge ecosystem of plugins available Includes a built-in plugin targeted at finding doctests and running them ","text_count":194,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Provides us with the convenient test discovering tool"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Is pluggable, with a huge ecosystem of plugins available"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Includes a built-in plugin targeted at finding doctests and running them"}]}]},{"block_type":"element","block":"k6bfvaa0","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvaa1","search_text":"We need to activate our virtual environment ( virtualenv ) and then install nose for this recipe:","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to activate our virtual environment ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":") and then install nose for this recipe:"}]},{"block_type":"element","block":"k6bfvaa2","search_text":"Create a virtual environment, activate it, and verify the tools are working. Take a look at this screenshot: ","text_count":109,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a virtual environment, activate it, and verify the tools are working. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvaa3","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000015.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaa4","search_text":"Using pip , install nose , as shown in the screenshot: ","text_count":55,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":", install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":", as shown in the screenshot:"}]}]},{"block_type":"element","block":"k6bfvaa5","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000124.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaa6","search_text":"Note This recipe assumes you have built all of the previous recipes in this chapter. If you have built only some of them, your results may appear different. ","text_count":157,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe assumes you have built all of the previous recipes in this chapter. If you have built only some of them, your results may appear different."}]}]},{"block_type":"element","block":"k6bfvaa7","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaa8","search_text":"Run nosetests -with-doctest against all the modules in this folder. You may notice that it prints a very short .....F.F...F , indicating that three tests have failed. Run nosetests -with-doctest -v to get a more verbose output. In the following screenshot, notice how the tests that failed are the same ones that failed for the previous recipes in this chapter. It is also valuable to see the <module>.<method> format with either ok or FAIL : ","text_count":443,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests -with-doctest"}]},{"block_type":"text","content":"against all the modules in this folder. You may notice that it prints a very short"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".....F.F...F"}]},{"block_type":"text","content":", indicating that three tests have failed."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests -with-doctest -v"}]},{"block_type":"text","content":"to get a more verbose output. In the following screenshot, notice how the tests that failed are the same ones that failed for the previous recipes in this chapter. It is also valuable to see the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;module&gt;.&lt;method&gt;"}]},{"block_type":"text","content":"format with either"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ok"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FAIL"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaa9","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000066.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaaa","search_text":"Run nosetests -with-doctest against both the recipe19.py file as well as the recipe19 module, in different combinations, as shown in the screenshot: ","text_count":149,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests -with-doctest"}]},{"block_type":"text","content":"against both the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe19.py"}]},{"block_type":"text","content":"file as well as the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe19"}]},{"block_type":"text","content":"module, in different combinations, as shown in the screenshot:"}]}]},{"block_type":"element","block":"k6bfvaab","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000059.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaac","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaad","search_text":"nosetests is targeted at discovering test cases and then running them. With this plugin, when it finds a docstring, it uses the doctest library to programmatically test it.","text_count":172,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"is targeted at discovering test cases and then running them. With this plugin, when it finds a docstring, it uses the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"library to programmatically test it."}]},{"block_type":"element","block":"k6bfvaae","search_text":"The doctest plugin is built around the assumption that doctests are not in the same package as other tests, such as unittest. This means it will only run doctests found from non-test packages.","text_count":192,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"plugin is built around the assumption that doctests are not in the same package as other tests, such as unittest. This means it will only run doctests found from non-test packages."}]},{"block_type":"element","block":"k6bfvaaf","search_text":"There isn't a whole lot of complexity to nosetests nor in using them, nosetests is meant to be an easy-to-use tool that puts testing at your fingertips. In this recipe, we have seen how to use nosetests to get a hold of all the doctest we have built so far in this chapter.","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There isn't a whole lot of complexity to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"nor in using them,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"is meant to be an easy-to-use tool that puts testing at your fingertips. In this recipe, we have seen how to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"to get a hold of all the doctest we have built so far in this chapter."}]},{"block_type":"element","block":"k6bfvaag","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","block":"k6bfvaah","search_text":"Updating the project-level script to run this chapter's doctests","text_count":64,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Updating the project-level script to run this chapter's doctests"}]},{"block_type":"element","block":"k6bfvaai","search_text":"This recipe will help us explore building a project-level script that allows us to run different test suites. We will also focus on how to run it in our doctest .","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe will help us explore building a project-level script that allows us to run different test suites. We will also focus on how to run it in our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaaj","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaak","search_text":"With the following steps, we will craft a command-line script to allow us to manage a project that includes running doctest :","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will craft a command-line script to allow us to manage a project that includes running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfvaal","search_text":"Create a new file called recipe25.py to put all the code for this recipe. ","text_count":74,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe25.py"}]},{"block_type":"text","content":"to put all the code for this recipe."}]}]},{"block_type":"element","block":"k6bfvaam","search_text":"Add code that parses a set of options using Python's getopt library: ","text_count":69,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code that parses a set of options using Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library:"}]}]},{"block_type":"element","block":"k6bfvaan","search_text":"import getopt import glob import logging import nose import os import os.path import re import sys def usage(): print () print (\"Usage: python recipe25.py [command]\") print () print (\"\\t--help\") print (\"\\t--doctest\") print (\"\\t--suite [suite]\") print (\"\\t--debug-level [info|debug]\") print (\"\\t--package\") print (\"\\t--publish\") print (\"\\t--register\") print () try: optlist, args = getopt.getopt(sys.argv[1:], \"h\", [\"help\", \"doctest\", \"suite=\", \\ \"debug-level=\", \"package\", \\ \"publish\", \"register\"]) except getopt.GetoptError: # print help information and exit: print \"Invalid command found in %s\" % sys.argv usage() sys.exit(2)","text_count":627,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import getopt\nimport glob\nimport logging\nimport nose\nimport os\nimport os.path\nimport re\nimport sys\ndef usage():\n    print ()\n    print (\"Usage: python recipe25.py [command]\")\n    print ()\n    print (\"\\t--help\")\n    print (\"\\t--doctest\")\n    print (\"\\t--suite [suite]\")\n    print (\"\\t--debug-level [info|debug]\")\n    print (\"\\t--package\")\n    print (\"\\t--publish\")\n    print (\"\\t--register\")\n    print ()\n\ntry:\n    optlist, args = getopt.getopt(sys.argv[1:],\n            \"h\",\n           [\"help\", \"doctest\", \"suite=\", \\\n            \"debug-level=\", \"package\", \\\n            \"publish\", \"register\"])\nexcept getopt.GetoptError:\n    # print help information and exit:\n    print \"Invalid command found in %s\" % sys.argv\n    usage()\n    sys.exit(2)"}]}]},{"block_type":"element","block":"k6bfvaao","search_text":"Create a function that maps to -test : ","text_count":39,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that maps to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-test"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaap","search_text":"def test(test_suite, debug_level): logger = logging.getLogger(\"recipe25\") loggingLevel = debug_level logger.setLevel(loggingLevel) ch = logging.StreamHandler() ch.setLevel(loggingLevel) formatter = logging.Formatter(\"%(asctime)s - %(name)s - (levelname)s - %(message)s\") ch.setFormatter(formatter) logger.addHandler(ch) nose.run(argv=[\"\", test_suite, \"--verbosity=2\"])","text_count":368,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test(test_suite, debug_level):\n    logger = logging.getLogger(\"recipe25\")\n    loggingLevel = debug_level\n    logger.setLevel(loggingLevel)\n    ch = logging.StreamHandler()\n    ch.setLevel(loggingLevel)\n    formatter = logging.Formatter(\"%(asctime)s - %(name)s - \n(levelname)s - %(message)s\")\n    ch.setFormatter(formatter)\n    logger.addHandler(ch)\n   \n    nose.run(argv=[\"\", test_suite, \"--verbosity=2\"])"}]}]},{"block_type":"element","block":"k6bfvaaq","search_text":"Create a function that maps to -doctest : ","text_count":42,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a function that maps to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-doctest"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaar","search_text":"def doctest(test_suite=None): args = [\"\", \"--with-doctest\"] if test_suite is not None: print (\"Running doctest suite %s\" % test_suite) args.extend(test_suite.split(',')) nose.run(argv=args) else: nose.run(argv=args)","text_count":215,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def doctest(test_suite=None):\n    args = [\"\", \"--with-doctest\"]\n    if test_suite is not None:\n        print (\"Running doctest suite %s\" % test_suite)\n        args.extend(test_suite.split(','))\n        nose.run(argv=args)\n    else:\n        nose.run(argv=args)"}]}]},{"block_type":"element","block":"k6bfvaas","search_text":"Create stub functions that support package , publish , and register : ","text_count":70,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create stub functions that support"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"package"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"publish"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"register"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaat","search_text":"def package(): print (\"This is where we can plug in code to run \" + \\ \"setup.py to generate a bundle.\") def publish(): print (\"This is where we can plug in code to upload \" + \\ \"our tarball to S3 or some other download site.\") def register(): print (\"setup.py has a built in function to \" + \\ \"'register' a release to PyPI. It's \" + \\ \"convenient to put a hook in here.\") # os.system(\"%s setup.py register\" % sys.executable)","text_count":424,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def package(): \n    print (\"This is where we can plug in code to run \" + \\\n          \"setup.py to generate a bundle.\")\n\ndef publish():\n    print (\"This is where we can plug in code to upload \" + \\\n          \"our tarball to S3 or some other download site.\")\n\ndef register():\n    print (\"setup.py has a built in function to \" + \\\n          \"'register' a release to PyPI. It's \" + \\\n          \"convenient to put a hook in here.\")\n    # os.system(\"%s setup.py register\" % sys.executable)"}]}]},{"block_type":"element","block":"k6bfvaau","search_text":"Add some code that detects if the option list is empty. If so, have it print out the help menu and exit the script: ","text_count":116,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that detects if the option list is empty. If so, have it print out the help menu and exit the script:"}]}]},{"block_type":"element","block":"k6bfvaav","search_text":"if len(optlist) == 0: usage() sys.exit(1)","text_count":41,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if len(optlist) == 0:\n    usage()\n    sys.exit(1)"}]}]},{"block_type":"element","block":"k6bfvaaw","search_text":"Add some code that defines debug levels and then parses options to allow the user to override: ","text_count":95,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that defines debug levels and then parses options to allow the user to override:"}]}]},{"block_type":"element","block":"k6bfvaax","search_text":"debug_levels = {\"info\":logging.INFO, \"debug\":logging.DEBUG} # Default debug level is INFO debug_level = debug_levels[\"info\"] for option in optlist: if option[0] in (\"--debug-level\"): # Override with a user-supplied debug level debug_level = debug_levels[option[1]]","text_count":264,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"debug_levels = {\"info\":logging.INFO, \"debug\":logging.DEBUG}\n# Default debug level is INFO\ndebug_level = debug_levels[\"info\"]\n\nfor option in optlist:\n    if option[0] in (\"--debug-level\"):\n        # Override with a user-supplied debug level\n        debug_level = debug_levels[option[1]]"}]}]},{"block_type":"element","block":"k6bfvaay","search_text":"Add some code that scans the command-line options for -help , and, if found, exits the script: ","text_count":95,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that scans the command-line options for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":", and, if found, exits the script:"}]}]},{"block_type":"element","block":"k6bfvaaz","search_text":"# Check for help requests, which cause all other # options to be ignored. for option in optlist: if option[0] in (\"--help\", \"-h\"): usage() sys.exit(1)","text_count":150,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Check for help requests, which cause all other\n# options to be ignored.\nfor option in optlist:\n    if option[0] in (\"--help\", \"-h\"):\n    usage()\n    sys.exit(1)"}]}]},{"block_type":"element","block":"k6bfvab0","search_text":"Add code that checks if --doctest has been picked. If so, have it specifically scan --suite and run it through the doctest() method. Otherwise, run -suite through the test() method: ","text_count":182,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code that checks if"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--doctest"}]},{"block_type":"text","content":"has been picked. If so, have it specifically scan"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--suite"}]},{"block_type":"text","content":"and run it through the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest()"}]},{"block_type":"text","content":"&nbsp;method. Otherwise, run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-suite"}]},{"block_type":"text","content":"through the&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test()"}]},{"block_type":"text","content":"&nbsp;method:"}]}]},{"block_type":"element","block":"k6bfvab1","search_text":"ran_doctests = False for option in optlist: # If --doctest is picked, then --suite is a # suboption. if option[0] in (\"--doctest\"): suite = None for suboption in optlist: if suboption[0] in (\"--suite\"): suite = suboption[1] print \"Running doctests...\" doctest(suite) ran_doctests = True if not ran_doctests: for option in optlist: if option[0] in (\"--suite\"): print \"Running test suite %s...\" % option[1] test(option[1], debug_level)","text_count":433,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"ran_doctests = False\nfor option in optlist:\n    # If --doctest is picked, then --suite is a\n    # suboption.\n    if option[0] in (\"--doctest\"):\n        suite = None\n        for suboption in optlist:\n            if suboption[0] in (\"--suite\"):\n                suite = suboption[1]\n        print \"Running doctests...\"\n        doctest(suite)\n        ran_doctests = True\n\nif not ran_doctests:\n    for option in optlist:\n        if option[0] in (\"--suite\"):\n            print \"Running test suite %s...\" % option[1]\n            test(option[1], debug_level)"}]}]},{"block_type":"element","block":"k6bfvab2","search_text":"Finish it by iterating through each of the command-line options, and invoking the other functions based on the options that are picked: ","text_count":136,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finish it by iterating through each of the command-line options, and invoking the other functions based on the options that are picked:"}]}]},{"block_type":"element","block":"k6bfvab3","search_text":"# Parse the arguments, in order for option in optlist: if option[0] in (\"--package\"): package() if option[0] in (\"--publish\"): publish() if option[0] in (\"--register\"): register()","text_count":179,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Parse the arguments, in order\nfor option in optlist:\n    if option[0] in (\"--package\"):\n        package()\n\n    if option[0] in (\"--publish\"):\n        publish()\n\n    if option[0] in (\"--register\"):\n        register()"}]}]},{"block_type":"element","block":"k6bfvab4","search_text":"Run the script with --help , as shown in the screenshot: ","text_count":57,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--help"}]},{"block_type":"text","content":", as shown in the screenshot:"}]}]},{"block_type":"element","block":"k6bfvab5","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000049.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvab6","search_text":"Run the script with --doctest . Notice the first few lines of output in the following screenshot. It shows how the tests have passed and failed along with detailed output. Take a look at this screenshot: ","text_count":204,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--doctest"}]},{"block_type":"text","content":". Notice the first few lines of output in the following screenshot. It shows how the tests have passed and failed along with detailed output. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvab7","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000086.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvab8","search_text":"Note The output is much longer. It has been trimmed for the sake of brevity. ","text_count":77,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The output is much longer. It has been trimmed for the sake of brevity."}]}]},{"block_type":"element","block":"k6bfvab9","search_text":"Run the script with -doctest -suite=recipe16,recipe17.py , as shown in the screenshot: ","text_count":87,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-doctest -suite=recipe16,recipe17.py"}]},{"block_type":"text","content":", as shown in the screenshot:"}]}]},{"block_type":"element","block":"k6bfvaba","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000028.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvabb","search_text":"Note We deliberately used recipe16.py and recipe17.py to demonstrate that it works with both module names and filenames. ","text_count":121,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We deliberately used"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe16.py"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe17.py"}]},{"block_type":"text","content":"to demonstrate that it works with both module names and filenames."}]}]},{"block_type":"element","block":"k6bfvabc","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvabd","search_text":"This script uses Python's getopt library, which is modeled after the getopt() function (refer to http://docs.python.org/library/getopt.html for more details).","text_count":158,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This script uses Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library, which is modeled after the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt()"}]},{"block_type":"text","content":"function (refer to"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python.org/library/getopt.html"},"children":[{"block_type":"text","content":"http://docs.python.org/library/getopt.html"}]},{"block_type":"text","content":"for more details)."}]},{"block_type":"element","block":"k6bfvabe","search_text":"We have wired the following functions:","text_count":38,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have wired the following functions:"}]},{"block_type":"element","block":"k6bfvabf","search_text":"Usage : A function to provide help to the user. Key : The key option definitions are included in the following block: ","text_count":118,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Usage"}]},{"block_type":"text","content":": A function to provide help to the user."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Key"}]},{"block_type":"text","content":": The key option definitions are included in the following block:"}]}]},{"block_type":"element","block":"k6bfvabg","search_text":"optlist, args = getopt.getopt(sys.argv[1:], \"h\", [\"help\", \"doctest\", \"suite=\", \\ \"debug-level=\", \"package\", \\ \"publish\", \"register\"])","text_count":133,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"optlist, args = getopt.getopt(sys.argv[1:],\n        \"h\",\n       [\"help\", \"doctest\", \"suite=\", \\\n        \"debug-level=\", \"package\", \\\n        \"publish\", \"register\"])"}]}]},{"block_type":"element","block":"k6bfvabh","search_text":"We parse everything in the arguments except the first, it being the executable itself. \"h\" defined the short option: -h . The list defines long options. Those with \"=\" accept an argument. Those without are flags. If an option is received that isn't in the list, an exception is thrown, we print out usage() , and then exit. ","text_count":324,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We parse everything in the arguments except the first, it being the executable itself."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"h\""}]},{"block_type":"text","content":"defined the short option:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The list defines long options. Those with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"=\""}]},{"block_type":"text","content":"accept an argument. Those without are flags."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If an option is received that isn't in the list, an exception is thrown, we print out"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"usage()"}]},{"block_type":"text","content":", and then exit."}]}]}]}]},{"block_type":"element","block":"k6bfvabi","search_text":"doctest : It runs modules through nose using -with-doctest . package , pubilsh , and register : These are just like the functions described in the previous chapter. ","text_count":165,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":": It runs modules through nose using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-with-doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"package"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pubilsh"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"register"}]},{"block_type":"text","content":": These are just like the functions described in the previous chapter."}]}]},{"block_type":"element","block":"k6bfvabj","search_text":"With each of these functions defined, we can now iterate over the options that were parsed. For this script, there is a sequence:","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With each of these functions defined, we can now iterate over the options that were parsed. For this script, there is a sequence:"}]},{"block_type":"element","block":"k6bfvabk","search_text":"Check whether there is a debugging override. We default to logging.INFO , but we provide the ability to switch to logging.DEBUG . Check whether -h or -help was called. If so, print out the usage() information and then exit with no more parsing. Because -suite can be used either by itself to run unittest tests, or as a suboption for -doctest , we have to parse through things and figure out whether -doctest was used. Finally, iterate over the options, and call their corresponding functions. ","text_count":494,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check whether there is a debugging override. We default to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging.INFO"}]},{"block_type":"text","content":", but we provide the ability to switch to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging.DEBUG"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check whether&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":"was called. If so, print out the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"usage()"}]},{"block_type":"text","content":"information and then exit with no more parsing."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Because"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-suite"}]},{"block_type":"text","content":"can be used either by itself to run unittest tests, or as a suboption for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-doctest"}]},{"block_type":"text","content":", we have to parse through things and figure out whether&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-doctest"}]},{"block_type":"text","content":"was used."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, iterate over the options, and call their corresponding functions."}]}]},{"block_type":"element","block":"k6bfvabl","search_text":"To exercise things, we first called this script with the -help option that printed out the command choices we had.","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To exercise things, we first called this script with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-help"}]},{"block_type":"text","content":"option that printed out the command choices we had."}]},{"block_type":"element","block":"k6bfvabm","search_text":"Then we called it with -doctest to see how it handled finding all the doctests in this folder. In our case, we found all the recipes for this chapter including three test failures.","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then we called it with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-doctest"}]},{"block_type":"text","content":"to see how it handled finding all the doctests in this folder. In our case, we found all the recipes for this chapter including three test failures."}]},{"block_type":"element","block":"k6bfvabn","search_text":"Finally, we called the script with -doctest -suite=recipe16,recipe17.py . This shows how we can pick a subset of tests delineated by the comma. With this example, we see that nose can process either by the module name ( recipe16.py ) or by the filename ( recipe17.py ).","text_count":269,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we called the script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-doctest -suite=recipe16,recipe17.py"}]},{"block_type":"text","content":". This shows how we can pick a subset of tests delineated by the comma. With this example, we see that nose can process either by the module name ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe16.py"}]},{"block_type":"text","content":") or by the filename ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe17.py"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfvabo","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvabp","search_text":"The features this script provides could easily be handled by commands that are already built. We looked at nosetests with doctest earlier in this chapter and saw how it can take arguments to pick tests flexibly.","text_count":211,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The features this script provides could easily be handled by commands that are already built. We looked at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"earlier in this chapter and saw how it can take arguments to pick tests flexibly."}]},{"block_type":"element","block":"k6bfvabq","search_text":"Using setup.py to generate tarballs and register releases is also a commonly used feature in the Python community.","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"setup.py"}]},{"block_type":"text","content":"to generate tarballs and register releases is also a commonly used feature in the Python community."}]},{"block_type":"element","block":"k6bfvabr","search_text":"So why write this script? Because, we can exploit all these features with a single command.","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So why write this script? Because, we can exploit all these features with a single command."}]},{"block_type":"element","block":"k6bfvabs","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]}]},{"title":"Testing Customer Stories with Behavior-Driven Development","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3o6","number":4,"contents":[{"block_type":"element","block":"k6bfvabt","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k6bfvabu","search_text":"Naming tests that sound like sentences and stories Testing separate doctest documents Writing a testable story with doctest Writing a testable novel with doctest Writing a testable story with Voidspace Mock and nose Writing a testable story with mockito and nose Writing a testable story with Lettuce Using Should DSL to write succinct assertions with Lettuce Updating the project-level script to run this chapter's BDD tests ","text_count":426,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Naming tests that sound like sentences and stories"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing separate doctest documents"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with doctest"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a testable novel with doctest"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Voidspace Mock and nose"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with mockito and nose"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Lettuce"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using Should DSL to write succinct assertions with Lettuce"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Updating the project-level script to run this chapter's BDD tests"}]}]},{"block_type":"element","block":"k6bfvabv","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfvabw","search_text":"Behavior-driven development ( BDD ) was created as a response to test-driven development ( TDD ) by Dan North. It focuses on writing automated tests in a natural language that non-programmers can read.","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Behavior-driven development"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"BDD"}]},{"block_type":"text","content":") was created as a response to"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"test-driven development"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"TDD"}]},{"block_type":"text","content":") by Dan North. It focuses on writing automated tests in a natural language that non-programmers can read."}]},{"block_type":"element","block":"k6bfvabx","search_text":"\"Programmers wanted to know where to start, what to test and what not to test, how much to test in one go, what to call their tests, and how to understand why a test fails. The deeper I got into TDD, the more I felt that my own journey had been less of a wax-on, wax-off process of gradual mastery than a series of blind alleys. I remember thinking, 'If only someone had told me that!' far more often than I thought, 'Wow, a door has opened.' I decided it must be possible to present TDD in a way that gets straight to the good stuff and avoids all the pitfalls.\" – Dan North ","text_count":576,"tag_name":"blockquote","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"\"Programmers wanted to know where to start, what to test and what not to test, how much to test in one go, what to call their tests, and how to understand why a test fails. The deeper I got into TDD, the more I felt that my own journey had been less of a wax-on, wax-off process of gradual mastery than a series of blind alleys. I remember thinking, 'If only someone had told me that!' far more often than I&nbsp;thought, 'Wow, a door has opened.' I decided it must be possible to present TDD in a way that gets straight to the good stuff and avoids all the pitfalls.\""}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;&ndash;&nbsp;Dan North"}]}]},{"block_type":"element","block":"k6bfvaby","search_text":"Note To discover more about Dan North, please visit: https://dannorth.net/introducing-bdd/ . ","text_count":93,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To discover more about Dan North, please visit:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://dannorth.net/introducing-bdd/"},"children":[{"block_type":"text","content":"https://dannorth.net/introducing-bdd/"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvabz","search_text":"The tests that we have written in prior unit test recipes had a style of testThis and testThat . BDD takes the approach of getting out of speaking programmers and instead shifting to a more customer-oriented perspective.","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The tests that we have written in prior unit test recipes had a style of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"testThis"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"testThat"}]},{"block_type":"text","content":". BDD takes the approach of getting out of speaking programmers and instead shifting to a more customer-oriented perspective."}]},{"block_type":"element","block":"k6bfvac0","search_text":"Dan North goes on to point out how Chris Stevenson wrote a specialized test runner for Java's JUnit that printed test results in a different way. Let's take a look at the following test code:","text_count":191,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Dan North goes on to point out how Chris Stevenson wrote a specialized test runner for Java's JUnit that printed test results in a different way. Let's take a look at the following test code:"}]},{"block_type":"element","block":"k6bfvac1","search_text":"public class FooTest extends TestCase { public void testIsASingleton() {} public void testAReallyLongNameIsAGoodThing() {} }","text_count":124,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"public class FooTest extends TestCase  {\n    public void testIsASingleton() {}\n    public void testAReallyLongNameIsAGoodThing() {}\n}"}]}]},{"block_type":"element","block":"k6bfvac2","search_text":"This code, when run through AgileDox ( http://agiledox.sourceforge.net/ ), will print out in the following format:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This code, when run through AgileDox ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://agiledox.sourceforge.net/"},"children":[{"block_type":"text","content":"http://agiledox.sourceforge.net/"}]},{"block_type":"text","content":"), will print out in the following format:"}]},{"block_type":"element","block":"k6bfvac3","search_text":"Foo -is a singleton -a really long name is a good thing","text_count":55,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Foo\n-is a singleton\n-a really long name is a good thing"}]}]},{"block_type":"element","block":"k6bfvac4","search_text":"AgileDox does several things such as the following:","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"AgileDox does several things such as the following:"}]},{"block_type":"element","block":"k6bfvac5","search_text":"It prints out the test name with the test suffix dropped It strips out the test prefix from each test method It converts the remainder into a sentence ","text_count":151,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It prints out the test name with the test suffix dropped"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It strips out the test prefix from each test method"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It converts the remainder into a sentence"}]}]},{"block_type":"element","block":"k6bfvac6","search_text":"AgileDox is a Java tool, so we won't be exploring it in this chapter. But there are many Python tools available, and we will look at some, including doctest, Voidspace Mock, mockito , and Lettuce. All of these tools give us the means to write tests in a more natural language and empower customers, QA, and test teams to develop story-based tests.","text_count":347,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"AgileDox is a Java tool, so we won't be exploring it in this chapter. But there are many Python tools available, and we will look at some, including doctest, Voidspace Mock,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":", and Lettuce. All of these tools give us the means to write tests in a more natural language and empower customers, QA, and test teams to develop story-based tests."}]},{"block_type":"element","block":"k6bfvac7","search_text":"Note All the tools and styles of BDD could easily fill up an entire book. This chapter intends to introduce the philosophy of BDD along with some strong, stable tools used to effectively test our system's behavior. ","text_count":215,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the tools and styles of BDD could easily fill up an entire book. This chapter intends to introduce the philosophy of BDD along with some strong, stable tools used to effectively test our system's behavior."}]}]},{"block_type":"element","block":"k6bfvac8","search_text":"For this chapter, let's use the same shopping cart application for each recipe. Create a file called cart.py and add the following code:","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this chapter, let's use the same shopping cart application for each recipe. Create a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"and add the following code:"}]},{"block_type":"element","block":"k6bfvac9","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): for cart_item in self.items: # Since we found the item, we increment # instead of append if cart_item.item == item: cart_item.q += 1 return self # If we didn't find, then we append self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price * self.items[index-1].q def total(self, sales_tax): sum_price=sum([item.price*item.q for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return sum([item.q for item in self.items]) class Item(object): def __int__(self,item,price,q=1): self.item=item self.price=price self.q=q","text_count":742,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n    def __init__(self):\n       self.items = []\n    def add(self, item, price):\n       for cart_item in self.items:\n           # Since we found the item, we increment\n           # instead of append\n           if cart_item.item == item: \n              cart_item.q += 1\n              return self\n       # If we didn't find, then we append \n       self.items.append(Item(item, price))\n       return self\n    def item(self, index):\n        return self.items[index-1].item\n    def price(self, index):\n        return self.items[index-1].price * self.items[index-1].q\n    def total(self, sales_tax):\n        sum_price=sum([item.price*item.q for item in self.items])\n        return sum_price*(1.0 + sales_tax/100.0)\n    def __len__(self):\n        return sum([item.q for item in self.items])\nclass Item(object):\n    def __int__(self,item,price,q=1):\n        self.item=item\n        self.price=price\n        self.q=q"}]}]},{"block_type":"element","block":"k6bfvaca","search_text":"Consider the following, regarding this shopping cart:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Consider the following, regarding this shopping cart:"}]},{"block_type":"element","block":"k6bfvacb","search_text":"It is one-based, meaning the first item and price are at [1] , not [0] It includes the ability to have multiples of the same item It will calculate total price and then add taxes ","text_count":179,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It is one-based, meaning the first item and price are at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[1]"}]},{"block_type":"text","content":", not"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[0]"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It includes the ability to have multiples of the same item"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It will calculate total price and then add taxes"}]}]},{"block_type":"element","block":"k6bfvacc","search_text":"This application isn't complex. Instead, it provides us opportunities throughout this chapter to test various customer stories and scenarios that aren't necessarily confined to simple unit testing.","text_count":197,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This application isn't complex. Instead, it provides us opportunities throughout this chapter to test various customer stories and scenarios that aren't necessarily confined to simple unit testing."}]},{"block_type":"element","block":"k6bfvacd","search_text":"Naming tests that sound like sentences and stories","text_count":50,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Naming tests that sound like sentences and stories"}]},{"block_type":"element","block":"k6bfvace","search_text":"Test methods should read like sentences, and test cases should read like titles of chapters. This is part of BDD's philosophy of making tests easy to read for non-programmers.","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Test methods should read like sentences, and test cases should read like titles of chapters. This is part of BDD's philosophy of making tests easy to read for non-programmers."}]},{"block_type":"element","block":"k6bfvacf","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvacg","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter.","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter."}]},{"block_type":"element","block":"k6bfvach","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaci","search_text":"With the following steps, we will explore how to write a custom nose plugin that provides results in a BDD-style report:","text_count":120,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will explore how to write a custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin that provides results in a BDD-style report:"}]},{"block_type":"element","block":"k6bfvacj","search_text":"Create a file called recipe26.py to contain our test cases. Create a unittest test, where the test case represents a cart with one item, and the test methods read like sentences: ","text_count":179,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe26.py"}]},{"block_type":"text","content":"to contain our test cases."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a unittest test, where the test case represents a cart with one item, and the test methods read like sentences:"}]}]},{"block_type":"element","block":"k6bfvack","search_text":"import unittest from cart import * class CartWithOneItem(unittest.TestCase): def setUp(self): self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) def test_when_checking_the_size_should_be_one_based(self): self.assertEquals(1, len(self.cart)) def test_when_looking_into_cart_should_be_one_based(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) self.assertEquals(15.00, self.cart.price(1)) def test_total_should_have_in_sales_tax(self): self.assertAlmostEquals(15.0*1.0925, \\ self.cart.total(9.25), 2)","text_count":514,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nfrom cart import *\nclass CartWithOneItem(unittest.TestCase):\n      def setUp(self):\n          self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00)\n      def test_when_checking_the_size_should_be_one_based(self):\n          self.assertEquals(1, len(self.cart))\n      def test_when_looking_into_cart_should_be_one_based(self):\n          self.assertEquals(\"tuna sandwich\", self.cart.item(1))\n          self.assertEquals(15.00, self.cart.price(1))\n      def test_total_should_have_in_sales_tax(self):\n          self.assertAlmostEquals(15.0*1.0925, \\\n                              self.cart.total(9.25), 2)"}]}]},{"block_type":"element","block":"k6bfvacl","search_text":"Add a unittest test, where the test case represents a cart with two items, and the test methods read like sentences: ","text_count":117,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a unittest test, where the test case represents a cart with two items, and the test methods read like sentences:"}]}]},{"block_type":"element","block":"k6bfvacm","search_text":"class CartWithTwoItems(unittest.TestCase): def setUp(self): self.cart = ShoppingCart()\\ .add(\"tuna sandwich\", 15.00)\\ .add(\"rootbeer\", 3.75) def test_when_checking_size_should_be_two(self): self.assertEquals(2, len(self.cart)) def test_items_should_be_in_same_order_as_entered(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) self.assertAlmostEquals(15.00, self.cart.price(1), 2) self.assertEquals(\"rootbeer\", self.cart.item(2)) self.assertAlmostEquals(3.75, self.cart.price(2), 2) def test_total_price_should_have_in_sales_tax(self): self.assertAlmostEquals((15.0+3.75)*1.0925,self.cart.total(9.25),2)","text_count":614,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class CartWithTwoItems(unittest.TestCase):\n     def setUp(self):\n         self.cart = ShoppingCart()\\\n                       .add(\"tuna sandwich\", 15.00)\\\n                       .add(\"rootbeer\", 3.75) \n    def test_when_checking_size_should_be_two(self):\n        self.assertEquals(2, len(self.cart))\n    def test_items_should_be_in_same_order_as_entered(self):\n       self.assertEquals(\"tuna sandwich\", self.cart.item(1))\n       self.assertAlmostEquals(15.00, self.cart.price(1), 2)\n       self.assertEquals(\"rootbeer\", self.cart.item(2)) \n       self.assertAlmostEquals(3.75, self.cart.price(2), 2)\n   def test_total_price_should_have_in_sales_tax(self):\n       self.assertAlmostEquals((15.0+3.75)*1.0925,self.cart.total(9.25),2)"}]}]},{"block_type":"element","block":"k6bfvacn","search_text":"Add a unittest test, where the test case represents a cart with no items, and the test methods read like sentences: ","text_count":116,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a unittest test, where the test case represents a cart with no items, and the test methods read like sentences:"}]}]},{"block_type":"element","block":"k6bfvaco","search_text":"class CartWithNoItems(unittest.TestCase): def setUp(self): self.cart = ShoppingCart() def test_when_checking_size_should_be_empty(self): self.assertEquals(0, len(self.cart)) def test_finding_item_out_of_range_should_raise_error(self): self.assertRaises(IndexError, self.cart.item, 2) def test_finding_price_out_of_range_should_raise_error(self): self.assertRaises(IndexError, self.cart.price, 2) def test_when_looking_at_total_price_should_be_zero(self): self.assertAlmostEquals(0.0, self.cart.total(9.25), 2) def test_adding_items_returns_back_same_cart(self): empty_cart = self.cart cart_with_one_item=self.cart.add(\"tuna sandwich\",15.00) self.assertEquals(empty_cart, cart_with_one_item) cart_with_two_items = self.cart.add(\"rootbeer\", 3.75) self.assertEquals(empty_cart, cart_with_one_item) self.assertEquals(cart_with_one_item, cart_with_two_items)","text_count":853,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class CartWithNoItems(unittest.TestCase): \n    def setUp(self):\n       self.cart = ShoppingCart()\n   def test_when_checking_size_should_be_empty(self): \n      self.assertEquals(0, len(self.cart))\n   def test_finding_item_out_of_range_should_raise_error(self):\n      self.assertRaises(IndexError, self.cart.item, 2)\n   def test_finding_price_out_of_range_should_raise_error(self): \n      self.assertRaises(IndexError, self.cart.price, 2)\n   def test_when_looking_at_total_price_should_be_zero(self):\n      self.assertAlmostEquals(0.0, self.cart.total(9.25), 2)\n   def test_adding_items_returns_back_same_cart(self): \n      empty_cart = self.cart\n      cart_with_one_item=self.cart.add(\"tuna sandwich\",15.00)\n      self.assertEquals(empty_cart, cart_with_one_item) \n      cart_with_two_items = self.cart.add(\"rootbeer\", 3.75) \n      self.assertEquals(empty_cart, cart_with_one_item)\n      self.assertEquals(cart_with_one_item, cart_with_two_items)"}]}]},{"block_type":"element","block":"k6bfvacp","search_text":"Note BDD encourages using very descriptive sentences for method names. Several of these method names were shortened to fit the format of this book, and yet some were still too long. ","text_count":182,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"BDD encourages using very descriptive sentences for method names. Several of these method names were shortened to fit the format of this book, and yet some were still too long."}]}]},{"block_type":"element","block":"k6bfvacq","search_text":"Create another file called recipe26_plugin.py to contain our customized BDD runner. Create a nose plugin that can be used as –with-bdd to print out results: ","text_count":157,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe26_plugin.py"}]},{"block_type":"text","content":"to contain our customized BDD runner."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin that can be used as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ndash;with-bdd"}]},{"block_type":"text","content":"to print out results:"}]}]},{"block_type":"element","block":"k6bfvacr","search_text":"import sys err = sys.stderr import nose import re from nose.plugins import Plugin class BddPrinter(Plugin): name = \"bdd\" def __init__(self): Plugin.__init__(self) self.current_module = None","text_count":189,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import sys\nerr = sys.stderr\nimport nose\nimport re\nfrom nose.plugins import Plugin\nclass BddPrinter(Plugin): \n     name = \"bdd\"\n     def __init__(self): \n         Plugin.__init__(self) \n         self.current_module = None"}]}]},{"block_type":"element","block":"k6bfvacs","search_text":"Create a handler that prints out either the module or the test method, with extraneous information stripped out: ","text_count":113,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a handler that prints out either the module or the test method, with extraneous information stripped out:"}]}]},{"block_type":"element","block":"k6bfvact","search_text":"def beforeTest(self, test): test_name = test.address()[-1] module, test_method = test_name.split(\".\") if self.current_module != module: self.current_module = module fmt_mod = re.sub(r\"([A-Z])([a-z]+)\", r\"\\1\\2 \", module) err.write(\"\\nGiven %s\" % fmt_mod[:-1].lower()) message = test_method[len(\"test\"):] message = \" \".join(message.split(\"_\")) err.write(\"\\n- %s\" % message)","text_count":371,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def beforeTest(self, test): \n    test_name = test.address()[-1]\n    module, test_method = test_name.split(\".\") \n    if self.current_module != module:\n       self.current_module = module\n    fmt_mod = re.sub(r\"([A-Z])([a-z]+)\", r\"\\1\\2 \", module)\n    err.write(\"\\nGiven %s\" % fmt_mod[:-1].lower()) \n    message = test_method[len(\"test\"):]\n    message = \" \".join(message.split(\"_\")) err.write(\"\\n- %s\" % message)"}]}]},{"block_type":"element","block":"k6bfvacu","search_text":"Create a handler for success, failure, and error messages: ","text_count":59,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a handler for success, failure, and error messages:"}]}]},{"block_type":"element","block":"k6bfvacv","search_text":"def addSuccess(self, *args, **kwargs): test = args[0] err.write(\" : Ok\") def addError(self, *args, **kwargs): test, error = args[0], args[1] err.write(\" : ERROR!\\n\") def addFailure(self, *args, **kwargs): test, error = args[0], args[1] err.write(\" : Failure!\\n\")","text_count":262,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def addSuccess(self, *args, **kwargs): \n    test = args[0]\n    err.write(\" : Ok\")\ndef addError(self, *args, **kwargs): \n    test, error = args[0], args[1] \n    err.write(\" : ERROR!\\n\")\ndef addFailure(self, *args, **kwargs): \n    test, error = args[0], args[1] \n    err.write(\" : Failure!\\n\")"}]}]},{"block_type":"element","block":"k6bfvacw","search_text":"Create a new file called recipe26_plugin.py to contain a test runner for exercising this recipe. Create a test runner that pulls in the test cases and runs them through nose , printing out results in an easy-to-read fashion: ","text_count":225,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe26_plugin.py"}]},{"block_type":"text","content":"to contain a test runner for exercising this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test runner that pulls in the test cases and runs them through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":", printing out results in an easy-to-read fashion:"}]}]},{"block_type":"element","block":"k6bfvacx","search_text":"if __name__ == \"__main__\": import nose from recipe26_plugin import * nose.run(argv=[\"\", \"recipe26\", \"--with-bdd\"], plugins=[BddPrinter()])","text_count":138,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\": \n   import nose\n   from recipe26_plugin import *\n   nose.run(argv=[\"\", \"recipe26\", \"--with-bdd\"], plugins=[BddPrinter()])"}]}]},{"block_type":"element","block":"k6bfvacy","search_text":"Run the test runner. Take a look at this screenshot: ","text_count":53,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test runner. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvacz","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000019.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvad0","search_text":"Introduce a couple of bugs in the test cases, and rerun the test runner to see how this alters the output: ","text_count":107,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Introduce a couple of bugs in the test cases, and rerun the test runner to see how this alters the output:"}]}]},{"block_type":"element","block":"k6bfvad1","search_text":"def test_when_checking_the_size_should_be_one_based(self): self.assertEquals(2, len(self.cart)) ... def test_items_should_be_in_same_order_as_entered(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) self.assertAlmostEquals(14.00, self.cart.price(1), 2) self.assertEquals(\"rootbeer\", self.cart.item(2)) self.assertAlmostEquals(3.75, self.cart.price(2), 2)","text_count":366,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_when_checking_the_size_should_be_one_based(self):\n        self.assertEquals(2, len(self.cart))\n...\n    def test_items_should_be_in_same_order_as_entered(self): \n        self.assertEquals(\"tuna sandwich\", self.cart.item(1)) \n        self.assertAlmostEquals(14.00, self.cart.price(1), 2) \n        self.assertEquals(\"rootbeer\", self.cart.item(2)) \n        self.assertAlmostEquals(3.75, self.cart.price(2), 2)"}]}]},{"block_type":"element","block":"k6bfvad2","search_text":"Run the tests again. Take a look at this screenshot: ","text_count":53,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the tests again. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvad3","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000008.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvad4","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvad5","search_text":"The test cases are written as nouns, describing the object being tested. CartWithTwoItems describes a series of test methods centered on a shopping cart that is prepopulated with two items.","text_count":189,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The test cases are written as nouns, describing the object being tested."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CartWithTwoItems"}]},{"block_type":"text","content":"describes a series of test methods centered on a shopping cart that is prepopulated with two items."}]},{"block_type":"element","block":"k6bfvad6","search_text":"The test methods are written like sentences. They are strung together with underscores instead of spaces. They have to be prefixed with test_ , so that unittest will pick them up. test_items_should_be_in_the_same_order_as_entered should represent items that should be in the same order as entered.","text_count":297,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The test methods are written like sentences. They are strung together with underscores instead of spaces. They have to be prefixed with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test_"}]},{"block_type":"text","content":", so that unittest will pick them up."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test_items_should_be_in_the_same_order_as_entered"}]},{"block_type":"text","content":"&nbsp;should represent items&nbsp;that&nbsp;should be in the same order as entered."}]},{"block_type":"element","block":"k6bfvad7","search_text":"The idea is that we should be able to quickly understand what is being tested by putting these two together: Given a cart with two items, the items should be in the same order as entered.","text_count":187,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The idea is that we should be able to quickly understand what is being tested by putting these two together: Given a cart with two items, the items should be in the same order as entered."}]},{"block_type":"element","block":"k6bfvad8","search_text":"While we could read through the test code with this thought process, mentally subtracting out the cruft of underscores and the test prefix, this can become a real cognitive load for us. To make it easier, we coded a quick nose plugin that split up the camel-case tests and replaced the underscores with spaces. This led to the useful report format.","text_count":348,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While we could read through the test code with this thought process, mentally subtracting out the cruft of underscores and the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"text","content":"prefix, this can become a real cognitive load for us. To make it easier, we coded a quick"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin that split up the camel-case tests and replaced the underscores with spaces. This led to the useful report format."}]},{"block_type":"element","block":"k6bfvad9","search_text":"Using this type of quick tool encourages us to write detailed test methods that will be easy to read on output. The feedback, not just to us but to our test team and customers, can be very effective at fostering communications, confidence in software, and help with generating new test stories.","text_count":294,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using this type of quick tool encourages us to write detailed test methods that will be easy to read on output. The feedback, not just to us but to our test team and customers, can be very effective at fostering communications, confidence in software, and help with generating new test stories."}]},{"block_type":"element","block":"k6bfvada","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvadb","search_text":"The example test methods shown here were deliberately shortened to fit the format of the book. Don't try to make them as short as possible. Instead, try to describe the expected output.","text_count":185,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The example test methods shown here were deliberately shortened to fit the format of the book. Don't try to make them as short as possible. Instead, try to describe the expected output."}]},{"block_type":"element","block":"k6bfvadc","search_text":"The plugin isn't installable. This plugin was coded to quickly generate a report. To make it reusable, especially with nosetests .","text_count":130,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The plugin isn't installable.&nbsp;This plugin was coded to quickly generate a report. To make it reusable, especially with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvadd","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","block":"k6bfvade","search_text":"Testing separate doctest documents","text_count":34,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing separate doctest documents"}]},{"block_type":"element","block":"k6bfvadf","search_text":"BDD doesn't require that we use any particular tool. Instead, it's more focused on the approach to testing. That is why it's possible to use Python doctest to write BDD test scenarios. doctest isn't restricted to the module's code. With this recipe, we will explore creating independent text files to run through Python's doctest library.","text_count":338,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"BDD doesn't require that we use any particular tool. Instead, it's more focused on the approach to testing. That is why it's possible to use Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"&nbsp;to write BDD test scenarios."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"isn't restricted to the module's code. With this recipe, we will explore creating independent text files to run through Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"library."}]},{"block_type":"element","block":"k6bfvadg","search_text":"If this is doctest , why wasn't it included in the previous chapter's recipes? Because the context of writing up a set of tests in a separate test document fits more naturally into the philosophy of BDD than with testable docstrings that are available for introspection when working with a library.","text_count":298,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If this is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":", why wasn't it included in the previous chapter's recipes? Because the context of writing up a set of tests in a separate test document fits more naturally into the philosophy of BDD than with testable docstrings that are available for introspection when working with a library."}]},{"block_type":"element","block":"k6bfvadh","search_text":"Getting ready ","text_count":14,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready&nbsp;"}]},{"block_type":"element","block":"k6bfvadi","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter.","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter."}]},{"block_type":"element","block":"k6bfvadj","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvadk","search_text":"With the following steps, we will explore capturing various test scenarios in doctest files and then running them:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will explore capturing various test scenarios in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"files and then running them:"}]},{"block_type":"element","block":"k6bfvadl","search_text":"Create a file called recipe27_scenario1.doctest that contains doctest -style type tests to exercise the shopping cart: ","text_count":119,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe27_scenario1.doctest"}]},{"block_type":"text","content":"that contains"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"-style type tests to exercise the shopping cart:"}]}]},{"block_type":"element","block":"k6bfvadm","search_text":"This is a way to exercise the shopping cart from a pure text file containing tests. First, we need to import the modules >>> from cart import * Now, we can create an instance of a cart >>> cart = ShoppingCart() Here we use the API to add an object. Because it returns back the cart, we have to deal with the output >>> cart.add(\"tuna sandwich\", 15.00) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> Now we can check some other outputs >>> cart.item(1) 'tuna sandwich' >>> cart.price(1) 15.0 >>> cart.total(0.0) 15.0","text_count":521,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"This is a way to exercise the shopping cart \nfrom a pure text file containing tests.\nFirst, we need to import the modules \n&gt;&gt;&gt; from cart import *\nNow, we can create an instance of a cart \n&gt;&gt;&gt; cart = ShoppingCart()\nHere we use the API to add an object. Because it returns back the cart, we have to deal with the output\n&gt;&gt;&gt; cart.add(\"tuna sandwich\", 15.00) #doctest:+ELLIPSIS \n&lt;cart.ShoppingCart object at ...&gt;\nNow we can check some other outputs\n&gt;&gt;&gt; cart.item(1) \n'tuna sandwich' \n&gt;&gt;&gt; cart.price(1) \n15.0\n&gt;&gt;&gt; cart.total(0.0) \n15.0"}]}]},{"block_type":"element","block":"k6bfvadn","search_text":"Note Notice that there are no quotes surrounding the text. ","text_count":59,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that there are no quotes surrounding the text."}]}]},{"block_type":"element","block":"k6bfvado","search_text":"Create another scenario in the recipe27_scenario2.doctest file that tests the boundaries of the shopping cart, as shown here: ","text_count":126,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another scenario in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe27_scenario2.doctest"}]},{"block_type":"text","content":"&nbsp;file that tests the boundaries of the shopping cart, as shown here:"}]}]},{"block_type":"element","block":"k6bfvadp","search_text":"This is a way to exercise the shopping cart from a pure text file containing tests. First, we need to import the modules >>> from cart import * Now, we can create an instance of a cart >>> cart = ShoppingCart() Now we try to access an item out of range, expecting an exception. >>> cart.item(5) Traceback (most recent call last): ... IndexError: list index out of range We also expect the price method to fail in a similar way. >>> cart.price(-2) Traceback (most recent call last): ... IndexError: list index out of range","text_count":521,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"This is a way to exercise the shopping cart \nfrom a pure text file containing tests.\nFirst, we need to import the modules \n&gt;&gt;&gt; from cart import *\nNow, we can create an instance of a cart \n&gt;&gt;&gt; cart = ShoppingCart()\nNow we try to access an item out of range, expecting an exception.\n&gt;&gt;&gt; cart.item(5)\nTraceback (most recent call last): \n...\nIndexError: list index out of range\nWe also expect the price method to fail in a similar way.\n&gt;&gt;&gt; cart.price(-2)\nTraceback (most recent call last): \n...\nIndexError: list index out of range"}]}]},{"block_type":"element","block":"k6bfvadq","search_text":"Create a file called recipe27.py and put in the test runner code that finds files ending in .doctest and runs them through the testfile method within doctest : ","text_count":160,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe27.py"}]},{"block_type":"text","content":"and put in the test runner code that finds files ending in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".doctest"}]},{"block_type":"text","content":"and runs them through the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"testfile"}]},{"block_type":"text","content":"method within"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvadr","search_text":"if __name__ == \"__main__\": import doctest from glob import glob for file in glob(\"recipe27*.doctest\"): print (\"Running tests found in %s\" % file) doctest.testfile(file)","text_count":168,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n   import doctest\n   from glob import glob\n   for file in glob(\"recipe27*.doctest\"):\n      print (\"Running tests found in %s\" % file) \n      doctest.testfile(file)"}]}]},{"block_type":"element","block":"k6bfvads","search_text":"Run the test suite. Take a look at this code: ","text_count":46,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite. Take a look at this code:"}]}]},{"block_type":"element","block":"k6bfvadt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000056.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvadu","search_text":"Run the test suite with -v , as shown in this screenshot: ","text_count":58,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":", as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfvadv","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000144.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvadw","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvadx","search_text":"doctest provides the convenient testfile function that will exercise a block of pure text as if it were contained inside a docstring. This is why no quotations are needed compared to when we had multiple doctest inside docstrings. The text files aren't docstrings.","text_count":264,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"provides the convenient"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"testfile"}]},{"block_type":"text","content":"function that will exercise a block of pure text as if it were contained inside a docstring. This is why no quotations are needed compared to when we had multiple"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"inside docstrings. The text files aren't docstrings."}]},{"block_type":"element","block":"k6bfvady","search_text":"In fact, if we include triple quotes around the text, the tests won't work correctly. Let's take the first scenario—put \"\"\" at the top and bottom of the file, and save it as recipe27_bad_ scenario.txt . Now, let's create a file called recipe27.py , and create an alternate test runner that runs our bad scenario, as shown here:","text_count":327,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In fact, if we include triple quotes around the text, the tests won't work correctly. Let's take the first scenario&mdash;put"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"\"\""}]},{"block_type":"text","content":"at the top and bottom of the file, and save it as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe27_bad_ scenario.txt"}]},{"block_type":"text","content":". Now, let's create a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe27.py"}]},{"block_type":"text","content":", and create an alternate test runner that runs our bad scenario, as shown here:"}]},{"block_type":"element","block":"k6bfvadz","search_text":"if __name__ == \"__main__\": import doctest doctest.testfile(\"recipe27_bad_scenario.txt\") ","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n   import doctest\n   doctest.testfile(\"recipe27_bad_scenario.txt\")"}]}]},{"block_type":"element","block":"k6bfvae0","search_text":"We get the following error message:","text_count":35,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;We get the following error message:"}]},{"block_type":"element","block":"k6bfvae1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000112.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvae2","search_text":"It has confused the tail-end triple quotes as part of the expected output. It's best to just leave them out.","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It has confused the tail-end triple quotes as part of the expected output. It's best to just leave them out."}]},{"block_type":"element","block":"k6bfvae3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvae4","search_text":"What is so great about moving docstrings into separate files? Isn't this the same thing that we were doing in the Creating testable documentation with doctest recipe discussed in Chapter 2, Running Automated Test Suites with Nose ? Yes and no. Yes, it's technically the same thing: doctest is exercising blocks of code embedded in the test.","text_count":340,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What is so great about moving docstrings into separate files? Isn't this the same thing that we were doing in the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"documentation"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"recipe discussed in Chapter 2,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Running Automated Test Suites with Nose"}]},{"block_type":"text","content":"? Yes and no. Yes, it's technically the same thing:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"is exercising blocks of code embedded in the&nbsp;test."}]},{"block_type":"element","block":"k6bfvae5","search_text":"But BDD is more than simply a technical solution. It is driven by the philosophy of customer-readable scenarios . BDD aims to test the behavior of the system. The behavior is often defined by customer-oriented scenarios. Getting a hold of these scenarios is strongly encouraged when our customer can easily understand the scenarios that we have captured. It is further enhanced when the customer can see what passes and fails and, in turn, sees a realistic status of what has been accomplished.","text_count":494,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But BDD is more than simply a technical solution. It is driven by the philosophy of"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"customer-readable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"scenarios"}]},{"block_type":"text","content":". BDD aims to test the behavior of the system. The behavior is often defined by customer-oriented scenarios. Getting a hold of these scenarios is strongly encouraged when our customer can easily understand the scenarios that we have captured. It is further enhanced when the customer can see what passes and fails and, in turn, sees a realistic status of what has been accomplished."}]},{"block_type":"element","block":"k6bfvae6","search_text":"By decoupling our test scenarios from the code and putting them into separate files, we have the key ingredient to making readable tests for our customers using doctest .","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By decoupling our test scenarios from the code and putting them into separate files, we have the key ingredient to making readable tests for our customers using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvae7","search_text":"Doesn't this defy the usability of docstrings?","text_count":46,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Doesn't this defy the usability of docstrings?"}]},{"block_type":"element","block":"k6bfvae8","search_text":"In Chapter 2, Running Automated Test Suites with Nose, there are several recipes that show how convenient it is to embed examples of code usage in docstrings. They are convenient, because we can read the docstrings from an interactive Python shell. What do you think is different about pulling some of this out of the code into separate scenario files? Do you think there are some doctest that would be useful in docstrings and others that may serve us better in separate scenario files?","text_count":487,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Chapter 2,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Running Automated Test Suites with Nose,"}]},{"block_type":"text","content":"there are several recipes that show how convenient it is to embed examples of code usage in docstrings. They are convenient, because we can read the docstrings from an interactive Python shell. What do you think is different about pulling some of this out of the code into separate scenario files? Do you think there are some"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"that would be useful in docstrings and others that may serve us better in separate scenario files?"}]},{"block_type":"element","block":"k6bfvae9","search_text":"Writing a testable story with doctest","text_count":37,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with doctest"}]},{"block_type":"element","block":"k6bfvaea","search_text":"Capturing a succinct story in a doctest file is the key to BDD. Another aspect of BDD is providing a readable report including the results.","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Capturing a succinct story in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"file is the key to BDD. Another aspect of BDD is providing a readable report including the results."}]},{"block_type":"element","block":"k6bfvaeb","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvaec","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter.","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter."}]},{"block_type":"element","block":"k6bfvaed","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaee","search_text":"With the following steps, we will see how to write a custom doctest runner to make our own report:","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will see how to write a custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"runner to make our own report:"}]},{"block_type":"element","block":"k6bfvaef","search_text":"Create a new file called recipe28_cart_with_no_items.doctest to contain our doctest scenario. Create a doctest scenario that exercises the shopping cart, as shown here: ","text_count":169,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe28_cart_with_no_items.doctest"}]},{"block_type":"text","content":"to contain our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"scenario."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"scenario that exercises the shopping cart, as shown here:"}]}]},{"block_type":"element","block":"k6bfvaeg","search_text":"This scenario demonstrates a testable story. First, we need to import the modules >>> from cart import * >>> cart = ShoppingCart() #when we add an item >>> cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> #the first item is a carton of milk >>> cart.item(1) 'carton of milk' #the first price is $2.50 >>> cart.price(1) 2.5 #there is only one item >>> len(cart) This shopping cart lets us grab more than one of a particular item. #when we add a second carton of milk >>> cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> #the first item is still a carton of milk >>> cart.item(1) 'carton of milk' #but the price is now $5.00 >>> cart.price(1) 5.0 #and the cart now has 2 items >>> len(cart) 2 #for a total (with 10% taxes) of $5.50 >>> cart.total(10.0) 5.5","text_count":828,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"This scenario demonstrates a testable story.\nFirst, we need to import the modules \n&gt;&gt;&gt; from cart import *\n&gt;&gt;&gt; cart = ShoppingCart()\n#when we add an item\n&gt;&gt;&gt; cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS \n&lt;cart.ShoppingCart object at ...&gt;\n#the first item is a carton of milk \n&gt;&gt;&gt; cart.item(1)\n'carton of milk'\n#the first price is $2.50 \n&gt;&gt;&gt; cart.price(1)\n2.5\n#there is only one item \n&gt;&gt;&gt; len(cart)\nThis shopping cart lets us grab more than one of a particular item.\n#when we add a second carton of milk\n&gt;&gt;&gt; cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS \n&lt;cart.ShoppingCart object at ...&gt;\n#the first item is still a carton of milk \n&gt;&gt;&gt; cart.item(1)\n'carton of milk'\n#but the price is now $5.00 \n&gt;&gt;&gt; cart.price(1)\n5.0\n#and the cart now has 2 items \n&gt;&gt;&gt; len(cart)\n2\n#for a total (with 10% taxes) of $5.50 \n&gt;&gt;&gt; cart.total(10.0)\n5.5"}]}]},{"block_type":"element","block":"k6bfvaeh","search_text":"Create a new file called recipe28.py to contain our custom doctest runner. Create a customer doctest runner by sub classing DocTestRunner , as shown here: ","text_count":155,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe28.py"}]},{"block_type":"text","content":"to contain our custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"runner."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a customer"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"runner by sub classing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DocTestRunner"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvaei","search_text":"import doctest class BddDocTestRunner(doctest.DocTestRunner): \"\"\" This is a customized test runner. It is meant to run code examples like DocTestRunner, but if a line preceeds the code example starting with '#', then it prints that comment. If the line starts with '#when', it is printed out like a sentence, but with no outcome. If the line starts with '#', but not '#when' it is printed out indented, and with the outcome. \"\"\"","text_count":428,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import doctest\nclass BddDocTestRunner(doctest.DocTestRunner): \n      \"\"\"\n      This is a customized test runner. It is meant \n      to run code examples like DocTestRunner,\n      but if a line preceeds the code example \n      starting with '#', then it prints that \n      comment.\n      If the line starts with '#when', it is printed \n      out like a sentence, but with no outcome.\n      If the line starts with '#', but not '#when'\n      it is printed out indented, and with the outcome.\n      \"\"\""}]}]},{"block_type":"element","block":"k6bfvaej","search_text":"Add a report_start function that looks for comments starting with # before an example, as shown in this code: ","text_count":110,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report_start"}]},{"block_type":"text","content":"function that looks for comments starting with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#"}]},{"block_type":"text","content":"before an example, as shown in this code:"}]}]},{"block_type":"element","block":"k6bfvaek","search_text":"def report_start(self, out, test, example): prior_line = example.lineno-1 line_before = test.docstring.splitlines()[prior_line] if line_before.startswith(\"#\"): message = line_before[1:] if line_before.startswith(\"#when\"): out(\"* %s\\n\" % message) example.silent = True example.indent = False else: out(\" - %s: \" % message) example.silent = False example.indent = True else: example.silent = True example.indent = False doctest.DocTestRunner(out, test, example)","text_count":459,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def report_start(self, out, test, example):\n    prior_line = example.lineno-1\n    line_before = test.docstring.splitlines()[prior_line] \n    if line_before.startswith(\"#\"):\n       message = line_before[1:]\n       if line_before.startswith(\"#when\"):\n          out(\"* %s\\n\" % message) \n          example.silent = True \n          example.indent = False\n       else:\n         out(\" - %s: \" % message) \n         example.silent = False \n         example.indent = True\n   else:\n     example.silent = True \n     example.indent = False\n\n   doctest.DocTestRunner(out, test, example)"}]}]},{"block_type":"element","block":"k6bfvael","search_text":"Add a report_success function that conditionally prints out ok , as shown here: ","text_count":80,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report_success"}]},{"block_type":"text","content":"function that conditionally prints out"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ok"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvaem","search_text":"def report_success(self, out, test, example, got): if not example.silent: out(\"ok\\n\") if self._verbose: if example.indent: out(\" \") out(\">>> %s\\n\" % example.source[:-1])","text_count":169,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def report_success(self, out, test, example, got):\n    if not example.silent:\n       out(\"ok\\n\")\n    if self._verbose:\n       if example.indent: out(\" \") \n          out(\"&gt;&gt;&gt; %s\\n\" % example.source[:-1])"}]}]},{"block_type":"element","block":"k6bfvaen","search_text":"Add a report_failure function that conditionally prints out FAIL , as shown here: ","text_count":82,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report_failure"}]},{"block_type":"text","content":"function that conditionally prints out"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FAIL"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvaeo","search_text":"def report_failure(self, out, test, example, got): if not example.silent: out(\"FAIL\\n\") if self._verbose: if example.indent: out(\" \") out(\">>> %s\\n\" % example.source[:-1])","text_count":171,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def report_failure(self, out, test, example, got):\n    if not example.silent:\n       out(\"FAIL\\n\")\n    if self._verbose:\n       if example.indent: out(\" \") \n           out(\"&gt;&gt;&gt; %s\\n\" % example.source[:-1])"}]}]},{"block_type":"element","block":"k6bfvaep","search_text":"Add a runner that replaces doctest.DocTestRunner with our customer runner, and then looks for doctest files to run, as shown here: ","text_count":131,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a runner that replaces"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest.DocTestRunner"}]},{"block_type":"text","content":"with our customer runner, and then looks for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"files to run, as shown here:"}]}]},{"block_type":"element","block":"k6bfvaeq","search_text":"if __name__ == \"__main__\": from glob import glob doctest.DocTestRunner = BddDocTestRunner for file in glob(\"recipe28*.doctest\"): given = file[len(\"recipe28_\"):] given = given[:-len(\".doctest\")] given = \" \".join(given.split(\"_\")) print (\"===================================\") print (\"Given a %s...\" % given) print (\"===================================\") doctest.testfile(file)","text_count":375,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n   from glob import glob\n   doctest.DocTestRunner = BddDocTestRunner\n   for file in glob(\"recipe28*.doctest\"):\n       given = file[len(\"recipe28_\"):]\n       given = given[:-len(\".doctest\")]\n       given = \" \".join(given.split(\"_\"))\n       print (\"===================================\")\n       print (\"Given a %s...\" % given)\n       print (\"===================================\")\n       doctest.testfile(file)"}]}]},{"block_type":"element","block":"k6bfvaer","search_text":"Use the runner to exercise our scenario. Take a look at this screenshot: ","text_count":73,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the runner to exercise our scenario. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvaes","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000126.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaet","search_text":"Use the runner to exercise our scenario with -v , as shown in this screenshot: ","text_count":79,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the runner to exercise our scenario with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":", as shown in this screenshot:"}]}]},{"block_type":"element","block":"k6bfvaeu","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000017.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaev","search_text":"Alter the test scenario so that one of the expected outcomes fail by using this code: ","text_count":86,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Alter the test scenario so that one of the expected outcomes fail by using this code:"}]}]},{"block_type":"element","block":"k6bfvaew","search_text":"#there is only one item >>> len(cart) 4668","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"#there is only one item \n&gt;&gt;&gt; len(cart)\n4668"}]}]},{"block_type":"element","block":"k6bfvaex","search_text":"Tip Notice we have changed the expected outcome from 1 to 4668 , to guarantee a failure. ","text_count":89,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice we have changed the expected outcome from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"4668"}]},{"block_type":"text","content":", to guarantee a failure."}]}]},{"block_type":"element","block":"k6bfvaey","search_text":"Use the runner with -v again, and see the results. Take a look at this screenshot: ","text_count":83,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the runner with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"again, and see the results. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvaez","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000105.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaf0","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaf1","search_text":"doctest provides a convenient means to write a testable scenario. For starters, we wrote up a series of behaviors we wanted the shopping cart application to prove. To polish things up, we added lot of detailed comments so that anyone reading this document can clearly understand things.","text_count":286,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"provides a convenient means to write a testable scenario. For starters, we wrote up a series of behaviors we wanted the shopping cart application to prove. To polish things up, we added lot of detailed comments so that anyone reading this document can clearly understand things."}]},{"block_type":"element","block":"k6bfvaf2","search_text":"This provides us with a testable scenario. However, it leaves us short of one key thing: a succinct report .","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This provides us with a testable scenario. However, it leaves us short of one key thing:"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"succinct"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"report"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaf3","search_text":"Unfortunately, doctest won't print out all these detailed comments for us.","text_count":74,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unfortunately,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"won't print out all these detailed comments for us."}]},{"block_type":"element","block":"k6bfvaf4","search_text":"To make this usable from a BDD perspective, we need the ability to embed selective comments that get printed out when the test sequence runs. To do that, we will subclass doctest.DocTestRunner and insert our version of the handling of the docstring.","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To make this usable from a BDD perspective, we need the ability to embed selective comments that get printed out when the test sequence runs. To do that, we will subclass"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest.DocTestRunner"}]},{"block_type":"text","content":"and insert our version of the handling of the docstring."}]},{"block_type":"element","block":"k6bfvaf5","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvaf6","search_text":"DocTestRunner conveniently gives us a handle on the docstring as well as the exact line number where the code example starts. We coded our BddDocTestRunner to look at the line preceding it, and check to see whether it started with # , our custom marker for a piece of text to print out during a test run.","text_count":304,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DocTestRunner"}]},{"block_type":"text","content":"conveniently gives us a handle on the docstring as well as the exact line number where the code example starts. We coded our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BddDocTestRunner"}]},{"block_type":"text","content":"to look at the line preceding it, and check to see whether it started with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#"}]},{"block_type":"text","content":", our custom marker for a piece of text to print out during a test run."}]},{"block_type":"element","block":"k6bfvaf7","search_text":"A #when comment is considered a cause. In other words, a when causes one or more effects . While doctest will still verify the code involved with a when ; for BDD purposes, we don't really care about the outcome, so we silently ignore it.","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#when"}]},{"block_type":"text","content":"comment is considered a cause. In other words, a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"when"}]},{"block_type":"text","content":"causes one or more"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"effects"}]},{"block_type":"text","content":". While"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"will still verify the code involved with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"when"}]},{"block_type":"text","content":"; for BDD purposes, we don't really care about the outcome, so we silently ignore it."}]},{"block_type":"element","block":"k6bfvaf8","search_text":"Any other # comments are considered effects. For each of these, we strip out the # and then print the sentence indented, so we can easily see which when it is tied to. Finally, we print out either ok or FAIL to indicate the results.","text_count":232,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Any other"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#"}]},{"block_type":"text","content":"comments are considered effects. For each of these, we strip out the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#"}]},{"block_type":"text","content":"&nbsp;and then print the sentence indented, so we can easily see which"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"when"}]},{"block_type":"text","content":"it is tied to. Finally, we print out either"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ok"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FAIL"}]},{"block_type":"text","content":"to indicate the results."}]},{"block_type":"element","block":"k6bfvaf9","search_text":"This means we can add all the detail we want to the documentation. But for blocks of tests, we can add statements that will be printed as either causes ( #when ) or effects ( #anything else ).","text_count":192,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This means we can add all the detail we want to the documentation. But for blocks of tests, we can add statements that will be printed as either"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"causes"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#when"}]},{"block_type":"text","content":") or effects ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"#anything else"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfvafa","search_text":"Writing a testable novel with doctest","text_count":37,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a testable novel with doctest"}]},{"block_type":"element","block":"k6bfvafb","search_text":"Running a series of story tests showcases your code's expected behavior. We have previously seen in the Writing a testable story with doctest recipe how to build a testable story and have it generate a useful report.","text_count":216,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Running a series of story tests showcases your code's expected behavior. We have previously seen in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"story"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"recipe how to build a testable story and have it generate a useful report."}]},{"block_type":"element","block":"k6bfvafc","search_text":"With this recipe, we will see how to use this tactic to string together multiple testable stories to form a testable novel.","text_count":123,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With this recipe, we will see how to use this tactic to string together multiple testable stories to form a testable novel."}]},{"block_type":"element","block":"k6bfvafd","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvafe","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter.","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter."}]},{"block_type":"element","block":"k6bfvaff","search_text":"We will also reuse the BddDocTestRunner defined in this chapter's Writing a testable story with doctest recipe. But we will slightly alter it by implementing the following steps.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will also reuse the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BddDocTestRunner"}]},{"block_type":"text","content":"defined in this chapter's"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"story"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"recipe. But we will slightly alter it by implementing the following steps."}]},{"block_type":"element","block":"k6bfvafg","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvafh","search_text":"Create a new file called recipe29.py . Copy the code containing the BddDocTestRunner from the Writing a testable story with doctest recipe into recipe29.py . Alter the __main__ runnable to only search for this recipe's doctest scenarios, as shown in this code: ","text_count":261,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe29.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the code containing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BddDocTestRunner"}]},{"block_type":"text","content":"from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"story"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"recipe into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe29.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Alter the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__main__"}]},{"block_type":"text","content":"runnable to only search for this recipe's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"scenarios, as shown in this code:"}]}]},{"block_type":"element","block":"k6bfvafi","search_text":"if __name__ == \"__main__\": from glob import glob doctest.DocTestRunner = BddDocTestRunner for file in glob(\"recipe29*.doctest\"): given = file[len(\"recipe29_\"):] given = given[:-len(\".doctest\")] given = \" \".join(given.split(\"_\")) print (\"===================================\") print (\"Given a %s...\" % given) print (\"===================================\") doctest.testfile(file)","text_count":375,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if __name__ == \"__main__\":\n   from glob import glob\n   doctest.DocTestRunner = BddDocTestRunner\n   for file in glob(\"recipe29*.doctest\"):\n       given = file[len(\"recipe29_\"):] \n       given = given[:-len(\".doctest\")]\n       given = \" \".join(given.split(\"_\"))\n       print (\"===================================\")\n       print (\"Given a %s...\" % given)\n       print (\"===================================\")\n       doctest.testfile(file)"}]}]},{"block_type":"element","block":"k6bfvafj","search_text":"Create a new file called recipe29_cart_we_will_load_with_identical_items.doctest . Add a scenario to it that tests the cart by adding two instances of the same object: ","text_count":168,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe29_cart_we_will_load_with_identical_items.doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a scenario to it that tests the cart by adding two instances of the same object:"}]}]},{"block_type":"element","block":"k6bfvafk","search_text":">>> from cart import * >>> cart = ShoppingCart() #when we add an item >>> cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> #the first item is a carton of milk >>> cart.item(1) 'carton of milk' #the first price is $2.50 >>> cart.price(1) 2.5 #there is only one item >>> len(cart) 1 This shopping cart let's us grab more than one of a particular item. #when we add a second carton of milk >>> cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> #the first item is still a carton of milk >>> cart.item(1) 'carton of milk' #but the price is now $5.00 >>> cart.price(1) 5.0 #and the cart now has 2 items >>> len(cart) 2 #for a total (with 10% taxes) of $5.50 >>> cart.total(10.0) 5.5 ","text_count":750,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from cart import *\n&gt;&gt;&gt; cart = ShoppingCart()\n#when we add an item\n&gt;&gt;&gt; cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS\n&lt;cart.ShoppingCart object at ...&gt;\n#the first item is a carton of milk\n&gt;&gt;&gt; cart.item(1)\n'carton of milk'\n#the first price is $2.50\n&gt;&gt;&gt; cart.price(1)\n2.5\n#there is only one item\n&gt;&gt;&gt; len(cart)\n1\nThis shopping cart let's us grab more than one of a particular item.\n#when we add a second carton of milk\n&gt;&gt;&gt; cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS\n&lt;cart.ShoppingCart object at ...&gt;\n#the first item is still a carton of milk\n&gt;&gt;&gt; cart.item(1) \n'carton of milk'\n#but the price is now $5.00\n&gt;&gt;&gt; cart.price(1)\n5.0\n#and the cart now has 2 items\n&gt;&gt;&gt; len(cart)\n2\n#for a total (with 10% taxes) of $5.50\n&gt;&gt;&gt; cart.total(10.0)\n5.5"}]}]},{"block_type":"element","block":"k6bfvafl","search_text":"Create another file called recipe29_cart_we_will_load_with_two_different_items.docstest . In that file, create another scenario that tests the cart by adding two different instances, as shown in the following code: ","text_count":215,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe29_cart_we_will_load_with_two_different_items.docstest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In that file, create another scenario that tests the cart by adding two different instances, as shown in the following code:"}]}]},{"block_type":"element","block":"k6bfvafm","search_text":">>> from cart import * >>> cart = ShoppingCart() #when we add a carton of milk... >>> cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> #when we add a frozen pizza... >>> cart.add(\"frozen pizza\", 3.00) #doctest:+ELLIPSIS <cart.ShoppingCart object at ...> #the first item is the carton of milk >>> cart.item(1) 'carton of milk' #the second item is the frozen pizza >>> cart.item(2) 'frozen pizza' #the first price is $2.50 >>> cart.price(1) 2.5 #the second price is $3.00 >>> cart.price(2) 3.0 #the total with no tax is $5.50 >>> cart.total(0.0) 5.5 #the total with 10% tax is $6.05 >>> print (round(cart.total(10.0), 2) ) 6.05","text_count":662,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from cart import *\n&gt;&gt;&gt; cart = ShoppingCart()\n#when we add a carton of milk...\n&gt;&gt;&gt; cart.add(\"carton of milk\", 2.50) #doctest:+ELLIPSIS \n&lt;cart.ShoppingCart object at ...&gt;\n#when we add a frozen pizza...\n&gt;&gt;&gt; cart.add(\"frozen pizza\", 3.00) #doctest:+ELLIPSIS\n &lt;cart.ShoppingCart object at ...&gt;\n#the first item is the carton of milk\n&gt;&gt;&gt; cart.item(1)\n'carton of milk'\n#the second item is the frozen pizza\n&gt;&gt;&gt; cart.item(2)\n'frozen pizza'\n#the first price is $2.50\n&gt;&gt;&gt; cart.price(1)\n2.5\n#the second price is $3.00\n&gt;&gt;&gt; cart.price(2)\n3.0\n#the total with no tax is $5.50\n&gt;&gt;&gt; cart.total(0.0)\n5.5\n#the total with 10% tax is $6.05\n&gt;&gt;&gt; print (round(cart.total(10.0), 2) )\n6.05"}]}]},{"block_type":"element","block":"k6bfvafn","search_text":"Create a new file called recipe29_cart_that_we_intend_to_keep_empty.doctest . In that file, create a third scenario that tests the cart by adding nothing and yet tries to access values outside the range, as shown in this code: ","text_count":227,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe29_cart_that_we_intend_to_keep_empty.doctest"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In that file, create a third scenario that tests the cart by adding nothing and yet tries to access values outside the range, as shown in this code:"}]}]},{"block_type":"element","block":"k6bfvafo","search_text":">>>from cart import * #when we create an empty shopping cart >>> cart = ShoppingCart() #accessing an item out of range generates an exception >>> cart.item(5) Traceback (most recent call last): ... IndexError: list index out of range #accessing a price with a negative index causes an exception >>> cart.price(-2) Traceback (most recent call last): ... IndexError: list index out of range #calculating a price with no tax results in $0.00 >>> cart.total(0.0) 0.0 #calculating a price with a tax results in $0.00 >>> cart.total(10.0) 0.0","text_count":536,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt;from cart import *\n#when we create an empty shopping cart \n&gt;&gt;&gt; cart = ShoppingCart()\n#accessing an item out of range generates an exception\n&gt;&gt;&gt; cart.item(5)\nTraceback (most recent call last):\n...\nIndexError: list index out of range\n#accessing a price with a negative index causes an exception\n&gt;&gt;&gt; cart.price(-2)\nTraceback (most recent call last):\n...\nIndexError: list index out of range\n#calculating a price with no tax results in $0.00\n&gt;&gt;&gt; cart.total(0.0)\n0.0\n#calculating a price with a tax results in $0.00\n&gt;&gt;&gt; cart.total(10.0)\n0.0"}]}]},{"block_type":"element","block":"k6bfvafp","search_text":"Use the runner to execute our scenarios. Take a look at this screenshot: ","text_count":73,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the runner to execute our scenarios. Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvafq","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000075.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvafr","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvafs","search_text":"We reuse the test runner developed in the previous recipe. The key is extending the scenarios to ensure that we have complete coverage of the expected scenarios.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We reuse the test runner developed in the previous recipe. The key is extending the scenarios to ensure that we have complete coverage of the expected scenarios."}]},{"block_type":"element","block":"k6bfvaft","search_text":"We need to be sure that we can handle the following:","text_count":52,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to be sure that we can handle the following:"}]},{"block_type":"element","block":"k6bfvafu","search_text":"A cart with two identical items A cart with two different items The degenerate situation of an empty shopping cart ","text_count":115,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A cart with two identical items"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A cart with two different items"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The degenerate situation of an empty shopping cart"}]}]},{"block_type":"element","block":"k6bfvafv","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvafw","search_text":"A valuable part of writing tests is picking useful names. In our situation, each testable story started with an empty cart. However, if we named each scenario given an empty cart , it would cause an overlap and not result in a very effective report.","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A valuable part of writing tests is picking useful names. In our situation, each testable story started with an empty cart. However, if we named each scenario"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"given an empty cart"}]},{"block_type":"text","content":", it would cause an overlap and not result in a very effective report."}]},{"block_type":"element","block":"k6bfvafx","search_text":"So, instead, we named them based on our story's intention:","text_count":58,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So, instead, we named them based on our story's intention:"}]},{"block_type":"element","block":"k6bfvafy","search_text":"recipe29_cart_we_will_load_with_identical_items.doctest recipe29_cart_we_will_load_with_two_different_items.doctest recipe29_cart_that_we_intend_to_keep_empty.doctest","text_count":166,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"recipe29_cart_we_will_load_with_identical_items.doctest\nrecipe29_cart_we_will_load_with_two_different_items.doctest\nrecipe29_cart_that_we_intend_to_keep_empty.doctest"}]}]},{"block_type":"element","block":"k6bfvafz","search_text":"This leads to:","text_count":14,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This leads to:"}]},{"block_type":"element","block":"k6bfvag0","search_text":"Given a cart we will load with identical items Given a cart we will load with two different items Given a cart that we intend to keep empty ","text_count":140,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Given a cart we will load with identical items"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Given a cart we will load with two different items"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Given a cart that we intend to keep empty"}]}]},{"block_type":"element","block":"k6bfvag1","search_text":"The purpose of these scenarios is much clearer.","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The purpose of these scenarios is much clearer."}]},{"block_type":"element","block":"k6bfvag2","search_text":"Naming scenarios are much like certain aspects of software development that are more a craft than a science. Tuning the performance tends to be more scientific, because it involves an iterative process of measurement and adjustment. But naming scenarios along with their causes and effects tends to be more of a craft. It involves communicating with all the stakeholders including QA and customers, so everyone can read and understand the stories.","text_count":447,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Naming scenarios are much like certain aspects of software development that are more a craft than a science. Tuning the performance tends to be more scientific, because it involves an iterative process of measurement and adjustment. But naming scenarios along with their causes and effects tends to be more of a craft. It involves communicating with all the stakeholders including QA and customers, so everyone can read and understand the stories."}]},{"block_type":"element","block":"k6bfvag3","search_text":"Note Don't be intimidated. Be ready to embrace change Start writing your stories. Make them work. Then share them with your stakeholders. Feedback is important, and that is the purpose of using story-based testing. Be ready for criticism and suggested changes. Be ready for more story requests. In fact, don't be surprised if some of your customers or QA want to write their own stories. That is a positive sign. If you are new to this type of customer interaction, don't worry. You will develop valuable communication skills and build a solid professional relationship with your stakeholders. And at the same time, your code quality will certainly improve. ","text_count":658,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Don't be intimidated. Be ready to embrace change"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Start writing your stories. Make them work. Then share them with your stakeholders. Feedback is important, and that is the purpose of using story-based testing. Be ready for criticism and suggested changes."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Be ready for more story requests. In fact, don't be surprised if some of your customers or QA want to write their own stories. That is a positive sign."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"If you are new to this type of customer interaction, don't worry. You will develop valuable communication skills and build a solid professional relationship with your stakeholders. And at the same time, your code quality will certainly improve."}]}]},{"block_type":"element","block":"k6bfvag4","search_text":"Writing a testable story with Voidspace Mock and nose","text_count":53,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Voidspace Mock and nose"}]},{"block_type":"element","block":"k6bfvag5","search_text":"When our code interacts with other classes through methods and attributes, these are referred to as collaborators. Mocking out collaborators using Voidspace Mock ( http://www.voidspace.org.uk/python/mock/ ), created by Michael Foord, provides a key tool for BDD. Mocks provide canned behavior compared to stubs, which provide canned states. While mocks by themselves don't define BDD, their usage keenly overlaps the ideas of BDD.","text_count":430,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When our code interacts with other classes through methods and attributes, these are referred to as collaborators. Mocking out collaborators using Voidspace Mock ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.voidspace.org.uk/python/mock/"},"children":[{"block_type":"text","content":"http://www.voidspace.org.uk/python/mock/"}]},{"block_type":"text","content":"), created by Michael Foord, provides a key tool for BDD. Mocks provide canned behavior compared to stubs, which provide canned states. While mocks by themselves don't define BDD, their usage keenly overlaps the ideas of BDD."}]},{"block_type":"element","block":"k6bfvag6","search_text":"To further demonstrate the behavioral nature of the tests, we will also use the spec plugin found in the pinocchio project ( http://darcs.idyll.org/~t/projects/pinocchio/doc ).","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To further demonstrate the behavioral nature of the tests, we will also use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":"&nbsp;plugin found in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pinocchio"}]},{"block_type":"text","content":"project ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://darcs.idyll.org/~t/projects/pinocchio/doc"},"children":[{"block_type":"text","content":"http://darcs.idyll.org/~t/projects/pinocchio/doc"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfvag7","search_text":"Note As stated on the project's website, Voidspace Mock is experimental. This book was written using version 0.7.0 beta 3. There is the risk that more API changes will occur before reaching a stable 1.0 version. Given this project's high quality, excellent documentation, and many articles in the blogosphere, I strongly feel it deserves a place in this book. ","text_count":360,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As stated on the project's website, Voidspace Mock is experimental. This book was written using version 0.7.0 beta 3. There is the risk that more API changes will occur before reaching a stable 1.0 version. Given this project's high quality, excellent documentation, and many articles in the blogosphere, I strongly feel it deserves a place in this book."}]}]},{"block_type":"element","block":"k6bfvag8","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvag9","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter with some slight modifications:","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter with some slight modifications:"}]},{"block_type":"element","block":"k6bfvaga","search_text":"Create a new file called recipe30_cart.py , and copy all the code from cart.py created in the introduction of this chapter. Alter __init__ to add an extra storer attribute used for persistence: ","text_count":194,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe30_cart.py"}]},{"block_type":"text","content":", and copy all the code from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"created in the introduction of this chapter."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Alter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__init__"}]},{"block_type":"text","content":"to add an extra"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":"attribute used for persistence:"}]}]},{"block_type":"element","block":"k6bfvagb","search_text":"class ShoppingCart(object): def __init__(self, storer=None): self.items = [] self.storer = storer","text_count":97,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n     def __init__(self, storer=None):\n        self.items = []\n        self.storer = storer"}]}]},{"block_type":"element","block":"k6bfvagc","search_text":"Add a store method that uses the storer to save the cart: ","text_count":58,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store"}]},{"block_type":"text","content":"method that uses the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":"to save the cart:"}]}]},{"block_type":"element","block":"k6bfvagd","search_text":"def store(self): return self.storer.store_cart(self)","text_count":52,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def store(self):\n        return self.storer.store_cart(self)"}]}]},{"block_type":"element","block":"k6bfvage","search_text":"Add a retrieve method that updates the internal items by using the storer : ","text_count":76,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"retrieve"}]},{"block_type":"text","content":"method that updates the internal"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"items"}]},{"block_type":"text","content":"by using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvagf","search_text":"def restore(self, id): self.items = self.storer.retrieve_cart(id).items return self","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def restore(self, id):\n       self.items = self.storer.retrieve_cart(id).items \n       return self"}]}]},{"block_type":"element","block":"k6bfvagg","search_text":"Note The specifics of the API of the storer will be given further down in this recipe. ","text_count":87,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The specifics of the API of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":"will be given further down in this recipe."}]}]},{"block_type":"element","block":"k6bfvagh","search_text":"We need to activate our virtual environment and then install Voidspace Mock for this recipe:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to activate our virtual environment and then install Voidspace Mock for this recipe:"}]},{"block_type":"element","block":"k6bfvagi","search_text":"Create a virtual environment, activate it, and verify the tools are working. Take a look at the following screenshot: ","text_count":118,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a virtual environment, activate it, and verify the tools are working. Take a look at the following screenshot:"}]}]},{"block_type":"element","block":"k6bfvagj","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000013.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvagk","search_text":"Install Voidspace Mock by typing pip install mock . Install the latest version of Pinocchio by typing pip install http://darcs.idyll.org/~t/projects/pinocchio-latest.tar.gz . This version of Pinocchio raises some warnings. To prevent them, we also need to install figleaf by typing pip install figleaf . ","text_count":304,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Voidspace Mock by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install mock"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install the latest version of Pinocchio by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install http://darcs.idyll.org/~t/projects/pinocchio-latest.tar.gz"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"This version of Pinocchio raises some warnings. To prevent them, we also need to install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"figleaf"}]},{"block_type":"text","content":"by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install figleaf"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvagl","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvagm","search_text":"With the following steps, we will explore how to use mock to write a testable story:","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will explore how to use mock to write a testable story:"}]},{"block_type":"element","block":"k6bfvagn","search_text":"In recipe30_cart.py , create a DataAccess class with empty methods for storing and retrieving shopping carts: ","text_count":110,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe30_cart.py"}]},{"block_type":"text","content":", create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DataAccess"}]},{"block_type":"text","content":"class with empty methods for storing and retrieving shopping carts:"}]}]},{"block_type":"element","block":"k6bfvago","search_text":"class DataAccess(object): def store_cart(self,cart): pass def retrieve_cart(self,id): pass","text_count":90,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class DataAccess(object):\n     def store_cart(self,cart):\n         pass\n     def retrieve_cart(self,id):\n         pass"}]}]},{"block_type":"element","block":"k6bfvagp","search_text":"Create a new file called recipe30.py to write the test code. Create an automated unittest that exercises the cart by mocking out the methods of DataAccess : ","text_count":157,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe30.py"}]},{"block_type":"text","content":"to write the test code."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an automated unittest that exercises the cart by mocking out the methods of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DataAccess"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvagq","search_text":"import unittest from copy import deepcopy from recipe30_cart import * from mock import Mock class CartThatWeWillSaveAndRestoreUsingVoidspaceMock(unittest. TestCase): def test_fill_up_a_cart_then_save_it_and_restore_it(self): # Create an empty shopping cart cart = ShoppingCart(DataAccess()) # Add a couple of items cart.add(\"carton of milk\", 2.50) cart.add(\"frozen pizza\", 3.00) self.assertEquals(2, len(cart)) # Create a clone of the cart for mocking # purposes. original_cart = deepcopy(cart) # Save the cart at this point in time into a database # using a mock cart.storer.store_cart = Mock() cart.storer.store_cart.return_value = 1 cart.storer.retrieve_cart = Mock() cart.storer.retrieve_cart.return_value = original_cart id = cart.store() self.assertEquals(1, id) # Add more items to cart cart.add(\"cookie dough\", 1.75) cart.add(\"ginger ale\", 3.25) self.assertEquals(4, len(cart)) # Restore the cart to the last point in time cart.restore(id) self.assertEquals(2, len(cart)) cart.storer.store_cart.assert_called_with(cart) cart.storer.retrieve_cart.assert_called_with(1)","text_count":1075,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nfrom copy import deepcopy \nfrom recipe30_cart import *\nfrom mock import Mock\nclass CartThatWeWillSaveAndRestoreUsingVoidspaceMock(unittest. TestCase):\n      def test_fill_up_a_cart_then_save_it_and_restore_it(self):\n          # Create an empty shopping cart\n          cart = ShoppingCart(DataAccess())\n          # Add a couple of items \n          cart.add(\"carton of milk\", 2.50) \n          cart.add(\"frozen pizza\", 3.00)\n          self.assertEquals(2, len(cart))\n          # Create a clone of the cart for mocking \n          # purposes.\n          original_cart = deepcopy(cart)\n          # Save the cart at this point in time into a database \n          # using a mock\n          cart.storer.store_cart = Mock()\n          cart.storer.store_cart.return_value = 1 \n          cart.storer.retrieve_cart = Mock() \n          cart.storer.retrieve_cart.return_value = original_cart\n          id = cart.store()\n          self.assertEquals(1, id)\n          # Add more items to cart \n          cart.add(\"cookie dough\", 1.75) \n          cart.add(\"ginger ale\", 3.25)\n          self.assertEquals(4, len(cart))\n          # Restore the cart to the last point in time \n          cart.restore(id)\n          self.assertEquals(2, len(cart))\n          cart.storer.store_cart.assert_called_with(cart)\n          cart.storer.retrieve_cart.assert_called_with(1)"}]}]},{"block_type":"element","block":"k6bfvagr","search_text":"Run the test using nosetests with the spec plugin: ","text_count":51,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":"plugin:"}]}]},{"block_type":"element","block":"k6bfvags","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000077.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvagt","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvagu","search_text":"Mocks are test doubles that confirm method calls, which is the behavior . This is different from stubs, which provide canned data, allowing us to confirm states.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Mocks are test doubles that confirm method calls, which is the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"behavior"}]},{"block_type":"text","content":". This is different from stubs, which provide canned data, allowing us to confirm states."}]},{"block_type":"element","block":"k6bfvagv","search_text":"Many mocking libraries are based on the record / replay pattern. They first require the test case to record every behavior the mock will be subjected to when used. Then we plug the mock into our code, allowing our code to invoke calls against it. Finally, we execute replay , and the Mock library compares the method calls we expected with the ones that actually happened.","text_count":372,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Many mocking libraries are based on the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"record"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"replay"}]},{"block_type":"text","content":"pattern. They first require the test case to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"record"}]},{"block_type":"text","content":"every behavior the mock will be subjected to when used. Then we plug the mock into our code, allowing our code to invoke calls against it. Finally, we execute"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"replay"}]},{"block_type":"text","content":", and the Mock library compares the method calls we expected with the ones that actually happened."}]},{"block_type":"element","block":"k6bfvagw","search_text":"A common issue with record/replay mocking is that, if we miss a single method call, our test fails. Capturing all the method calls can become very challenging when trying to mock out third-party systems, or dealing with variable calls that may be tied to complex system states.","text_count":277,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common issue with record/replay mocking is that, if we miss a single method call, our test fails. Capturing all the method calls can become very challenging when trying to mock out third-party systems, or dealing with variable calls that may be tied to complex system states."}]},{"block_type":"element","block":"k6bfvagx","search_text":"The Voidspace Mock library differs by using the action / assert pattern. We first generate a mock and define how we want it to react to certain actions . Then, we plug it into our code, allowing our code to operate against it. Finally, we assert what happened to the mock, only picking the operations we care about. There is no requirement to assert every behavior experienced by the mock.","text_count":389,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The Voidspace Mock library differs by using the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"action"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"pattern. We first generate a mock and define how we want it to react to certain"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"actions"}]},{"block_type":"text","content":". Then, we plug it into our code, allowing our code to operate against it. Finally, we"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"what happened to the mock, only picking the operations we care about. There is no requirement to assert every behavior experienced by the mock."}]},{"block_type":"element","block":"k6bfvagy","search_text":"Why is this important? Record/replay requires that we record the method calls that are made by our code, third-party system, and all the other layers in the call chain. Frankly, we may not need this level of confirmation of behavior. Often, we are primarily interested in the top layer of interaction. Action/assert lets us cut back on the behavior calls we care about. We can set up our mock to generate the necessary top level actions and essentially ignore the lower level calls, which a record/replay mock would force us to record.","text_count":535,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why is this important? Record/replay requires that we record the method calls that are made by our code, third-party system, and all the other layers in the call chain. Frankly, we may not need this level of confirmation of behavior. Often, we are primarily interested in the top layer of interaction. Action/assert lets us cut back on the behavior calls we care about. We can set up our mock to generate the necessary top level actions and essentially ignore the lower level calls, which a record/replay mock would force us to record."}]},{"block_type":"element","block":"k6bfvagz","search_text":"In this recipe, we mocked the DataAccess operations store_cart and retrieve_cart . We defined their return_value , and at the end of the test we asserted that they were called the following:","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we mocked the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DataAccess"}]},{"block_type":"text","content":"operations"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store_cart"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"retrieve_cart"}]},{"block_type":"text","content":". We defined their"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"return_value"}]},{"block_type":"text","content":", and at the end of the test we asserted that they were called the following:"}]},{"block_type":"element","block":"k6bfvah0","search_text":"cart.storer.store_cart.assert_called_with(cart) cart.storer.retrieve_cart.assert_called_with(1)","text_count":95,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"cart.storer.store_cart.assert_called_with(cart)\ncart.storer.retrieve_cart.assert_called_with(1)"}]}]},{"block_type":"element","block":"k6bfvah1","search_text":"cart.storer was the internal attribute that we injected with our mock.","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.storer"}]},{"block_type":"text","content":"was the internal attribute that we injected with our mock."}]},{"block_type":"element","block":"k6bfvah2","search_text":"Note Mocking a method means replacing a call to a real method with one to a mock object. Stubbing a method means replacing a call to a real method with one to a stub. ","text_count":167,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Mocking a method means replacing a call to a real method with one to a mock object."}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Stubbing a method means replacing a call to a real method with one to a stub."}]}]},{"block_type":"element","block":"k6bfvah3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvah4","search_text":"Because this test case focuses on storing and retrieving from the cart's perspective, we didn't have to define the real DataAccess calls. That is why we simply put pass in their method definitions.","text_count":197,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Because this test case focuses on storing and retrieving from the cart's perspective, we didn't have to define the real"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DataAccess"}]},{"block_type":"text","content":"calls. That is why we simply put"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pass"}]},{"block_type":"text","content":"in their method definitions."}]},{"block_type":"element","block":"k6bfvah5","search_text":"This conveniently lets us work on the behavior of persistence without forcing us to choose whether the cart would be stored in a relational database, a NoSQL database, a flat file, or any other file format. This shows that our shopping cart and data persistence are nicely decoupled.","text_count":283,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This conveniently lets us work on the behavior of persistence without forcing us to choose whether the cart would be stored in a relational database, a NoSQL database, a flat file, or any other file format. This shows that our shopping cart and data persistence are nicely decoupled."}]},{"block_type":"element","block":"k6bfvah6","search_text":"Tell me more about the spec nose plugin!","text_count":40,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Tell me more about the spec nose plugin!"}]},{"block_type":"element","block":"k6bfvah7","search_text":"We quickly skimmed over the useful spec plugin for nose . It provides the same essential functionality that we coded by hand in the Naming tests so they sound like sentences and stories section. It converts test case names and test method names into readable results. It gives us a runnable spec . This plugin works with unittest and doesn't care whether or not we were using Voidspace Mock.","text_count":391,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We quickly skimmed over the useful"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":"plugin for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":". It provides the same essential functionality that we coded by hand in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Naming"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"tests"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"so"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"they"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"sound"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"like"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"sentences"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"and"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"stories"}]},{"block_type":"text","content":"section. It converts test case names and test method names into readable results. It gives us a runnable"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":". This plugin works with unittest and doesn't care whether or not we were using Voidspace Mock."}]},{"block_type":"element","block":"k6bfvah8","search_text":"Why didn't we reuse the plugin from the recipe \"Naming tests so they sound like sentences and stories\"?","text_count":103,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Why didn't we reuse the plugin from the recipe \"Naming tests so they sound like sentences and stories\"?"}]},{"block_type":"element","block":"k6bfvah9","search_text":"Another way to phrase this question is Why did we write that recipe's plugin in the first place? An important point of using test tools is to understand how they work, and how to write our own extensions. The Naming tests so they sound like sentences and stories section not only discussed the philosophy of naming tests, but also explored ways to write nose plugins to support this need. In this recipe, our focus was on using Voidspace Mock to verify certain behaviors, and not on coding nose plugins. Producing a nice BDD report was easily served by the existing spec plugin.","text_count":578,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another way to phrase this question is&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Why did we write that recipe's plugin in the first place?"}]},{"block_type":"text","content":"An important point of using test tools is to understand how they work, and how to write our own extensions. The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Naming"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"tests"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"so"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"they"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"sound"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"like"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"sentences"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"and"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"stories"}]},{"block_type":"text","content":"section not only discussed the philosophy of naming tests, but also explored ways to write"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugins to support this need. In this recipe, our focus was on using Voidspace Mock to verify certain behaviors, and not on coding"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugins. Producing a nice BDD report was easily served by the existing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":"plugin."}]},{"block_type":"element","block":"k6bfvaha","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvahb","search_text":"Writing a testable story with mockito and nose.","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with mockito and nose."}]}]},{"block_type":"element","block":"k6bfvahc","search_text":"Writing a testable story with mockito and nose","text_count":46,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with mockito and nose"}]},{"block_type":"element","block":"k6bfvahd","search_text":"When our code interacts with other classes through methods and attributes, these are referred to as collaborators. Mocking out collaborators using mockito ( http://code.google.com/p/mockito and http://code.google.com/p/mockito-python ) provides a key tool for BDD. Mocks provide canned behavior, whereas stubs, provide canned states. While mocks by themselves don't define BDD, their usage keenly overlaps the ideas of BDD.","text_count":423,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When our code interacts with other classes through methods and attributes, these are referred to as collaborators. Mocking out collaborators using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://code.google.com/p/mockito"},"children":[{"block_type":"text","content":"http://code.google.com/p/mockito"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://code.google.com/p/mockito-python"},"children":[{"block_type":"text","content":"http://code.google.com/p/mockito-python"}]},{"block_type":"text","content":") provides a key tool for BDD. Mocks provide canned behavior, whereas stubs,&nbsp; provide canned states. While mocks by themselves don't define BDD, their usage keenly overlaps the ideas of BDD."}]},{"block_type":"element","block":"k6bfvahe","search_text":"To further demonstrate the behavioral nature of the tests, we will also use the spec plugin found in the pinocchio project ( http://darcs.idyll.org/~t/projects/ pinocchio/doc ).","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To further demonstrate the behavioral nature of the tests, we will also use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":"&nbsp;plugin found in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pinocchio"}]},{"block_type":"text","content":"project ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://darcs.idyll.org/~t/projects/"},"children":[{"block_type":"text","content":"http://darcs.idyll.org/~t/projects/ pinocchio/doc"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfvahf","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvahg","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter with some slight modifications:","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter with some slight modifications:"}]},{"block_type":"element","block":"k6bfvahh","search_text":"Create a new file called recipe31_cart.py and copy all the code from cart.py created in the introduction of this chapter. ","text_count":122,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe31_cart.py"}]},{"block_type":"text","content":"and copy all the code from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"created in the introduction of this chapter."}]}]},{"block_type":"element","block":"k6bfvahi","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","block":"k6bfvahj","search_text":"Alter __init__ to add an extra storer attribute used for persistence: ","text_count":70,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Alter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__init__"}]},{"block_type":"text","content":"to add an extra"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":"attribute used for persistence:"}]}]},{"block_type":"element","block":"k6bfvahk","search_text":"class ShoppingCart(object): def __init__(self, storer=None): self.items = [] self.storer = storer","text_count":97,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n    def __init__(self, storer=None):\n    self.items = []\n    self.storer = storer"}]}]},{"block_type":"element","block":"k6bfvahl","search_text":"Add a store method that uses the storer to save the cart: ","text_count":58,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store"}]},{"block_type":"text","content":"method that uses the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":"to save the cart:"}]}]},{"block_type":"element","block":"k6bfvahm","search_text":"def store(self): return self.storer.store_cart(self)","text_count":52,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def store(self):\n       return self.storer.store_cart(self)"}]}]},{"block_type":"element","block":"k6bfvahn","search_text":"Add a retrieve method that updates the internal items by using the storer : ","text_count":76,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"retrieve"}]},{"block_type":"text","content":"method that updates the internal"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"items"}]},{"block_type":"text","content":"by using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaho","search_text":"def restore(self, id): self.items = self.storer.retrieve_cart(id).items return self","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def restore(self, id):\n      self.items = self.storer.retrieve_cart(id).items\n      return self"}]}]},{"block_type":"element","block":"k6bfvahp","search_text":"The specifics of the API of the storer will be given further down in this recipe.","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The specifics of the API of the storer will be given further down in this recipe."}]},{"block_type":"element","block":"k6bfvahq","search_text":"We need to activate our virtual environment and then install mockito for this recipe:","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to activate our virtual environment and then install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"for this recipe:"}]},{"block_type":"element","block":"k6bfvahr","search_text":"Create a virtual environment, activate it, and verify the tools are working: ","text_count":77,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a virtual environment, activate it, and verify the tools are working:"}]}]},{"block_type":"element","block":"k6bfvahs","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000068.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaht","search_text":"Install mockito by typing pip install mockito . ","text_count":48,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install mockito"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvahu","search_text":"Install pinocchio and figleaf using the same steps from the Writing a testable story with Voidspace Mock and nose recipe.","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pinocchio"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"figleaf"}]},{"block_type":"text","content":"using the same steps from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Voidspace Mock and nose"}]},{"block_type":"text","content":"recipe."}]},{"block_type":"element","block":"k6bfvahv","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvahw","search_text":"With the following steps, we will explore how to use mocking to write a testable story:","text_count":87,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will explore how to use mocking to write a testable story:"}]},{"block_type":"element","block":"k6bfvahx","search_text":"In recipe31_cart.py , create a DataAccess class with empty methods for storing and retrieving shopping carts: ","text_count":110,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe31_cart.py"}]},{"block_type":"text","content":", create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DataAccess"}]},{"block_type":"text","content":"class with empty methods for storing and retrieving shopping carts:"}]}]},{"block_type":"element","block":"k6bfvahy","search_text":"class DataAccess(object): def store_cart(self, cart): pass def retrieve_cart(self, id): pass","text_count":92,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class DataAccess(object):\n     def store_cart(self, cart):\n         pass\n     def retrieve_cart(self, id):\n         pass"}]}]},{"block_type":"element","block":"k6bfvahz","search_text":"Create a new file called recipe31.py for writing the test code. Create an automated unit test that exercises the cart by mocking out the methods of DataAccess : ","text_count":161,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe31.py"}]},{"block_type":"text","content":"for writing the test code."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an automated unit test that exercises the cart by mocking out the methods of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DataAccess"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvai0","search_text":"import unittest from copy import deepcopy from recipe31_cart import * from mockito import * class CartThatWeWillSaveAndRestoreUsingMockito(unittest.TestCase): def test_fill_up_a_cart_then_save_it_and_restore_it(self): # Create an empty shopping cart cart = ShoppingCart(DataAccess()) # Add a couple of items cart.add(\"carton of milk\", 2.50) cart.add(\"frozen pizza\", 3.00) self.assertEquals(2, len(cart)) # Create a clone of the cart for mocking # purposes. original_cart = deepcopy(cart) # Save the cart at this point in time into a database # using a mock cart.storer = mock() when(cart.storer).store_cart(cart).thenReturn(1) when(cart.storer).retrieve_cart(1). \\ thenReturn(original_cart) id = cart.store() self.assertEquals(1, id) # Add more items to cart cart.add(\"cookie dough\", 1.75) cart.add(\"ginger ale\", 3.25) self.assertEquals(4, len(cart)) # Restore the cart to the last point in time cart.restore(id) self.assertEquals(2, len(cart)) verify(cart.storer).store_cart(cart) verify(cart.storer).retrieve_cart(1) ","text_count":1019,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nfrom copy import deepcopy\nfrom recipe31_cart import *\nfrom mockito import *\nclass CartThatWeWillSaveAndRestoreUsingMockito(unittest.TestCase):\n      def test_fill_up_a_cart_then_save_it_and_restore_it(self):\n          # Create an empty shopping cart\n          cart = ShoppingCart(DataAccess())\n          # Add a couple of items\n          cart.add(\"carton of milk\", 2.50)\n          cart.add(\"frozen pizza\", 3.00)\n          self.assertEquals(2, len(cart))\n         # Create a clone of the cart for mocking\n         # purposes.\n         original_cart = deepcopy(cart)\n         # Save the cart at this point in time into a database\n         # using a mock\n         cart.storer = mock()\n         when(cart.storer).store_cart(cart).thenReturn(1)\n         when(cart.storer).retrieve_cart(1). \\   \n                             thenReturn(original_cart)\n         id = cart.store()\n         self.assertEquals(1, id)\n         # Add more items to cart\n         cart.add(\"cookie dough\", 1.75)\n         cart.add(\"ginger ale\", 3.25)\n         self.assertEquals(4, len(cart))\n         # Restore the cart to the last point in time\n         cart.restore(id)\n         self.assertEquals(2, len(cart))\n         verify(cart.storer).store_cart(cart)\n         verify(cart.storer).retrieve_cart(1)"}]}]},{"block_type":"element","block":"k6bfvai1","search_text":"Run the test using nosetests with the spec plugin: ","text_count":51,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"spec"}]},{"block_type":"text","content":"plugin:"}]}]},{"block_type":"element","block":"k6bfvai2","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000041.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvai3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvai4","search_text":"This recipe is very similar to the earlier recipe, Writing a testable story with Voidspace M ock and nose . For details about mocking and the benefits with regards to BDD, it is very useful to read that recipe.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe is very similar to the earlier recipe,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"story"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Voidspace"}]},{"block_type":"text","content":"&nbsp;M"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"ock"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"and"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":". For details about mocking and the benefits with regards to BDD, it is very useful to read that recipe."}]},{"block_type":"element","block":"k6bfvai5","search_text":"Let's compare the syntax of Voidspace Mock with mockito to get a feel for the differences. Look at the following Voidspace Mock block of code:","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's compare the syntax of Voidspace Mock with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"to get a feel for the differences. Look at the following Voidspace Mock block of code:"}]},{"block_type":"element","block":"k6bfvai6","search_text":"cart.storer.store_cart = Mock() cart.storer.store_cart.return_value = 1 cart.storer.retrieve_cart = Mock() cart.storer.retrieve_cart.return_value = original_cart","text_count":161,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"cart.storer.store_cart = Mock()\n         cart.storer.store_cart.return_value = 1\n         cart.storer.retrieve_cart = Mock()\n         cart.storer.retrieve_cart.return_value = original_cart"}]}]},{"block_type":"element","block":"k6bfvai7","search_text":"It shows the function store_cart being mocked:","text_count":46,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It shows the function"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store_cart"}]},{"block_type":"text","content":"being mocked:"}]},{"block_type":"element","block":"k6bfvai8","search_text":"cart.storer = mock() when(cart.storer).store_cart(cart).thenReturn(1) when(cart.storer).retrieve_cart(1).thenReturn(original_cart)","text_count":130,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"cart.storer = mock()\n         when(cart.storer).store_cart(cart).thenReturn(1)\n         when(cart.storer).retrieve_cart(1).thenReturn(original_cart)"}]}]},{"block_type":"element","block":"k6bfvai9","search_text":"mockito approaches this by mocking out the entire storer object. mockito originated as a Java mocking tool, which explains its Java-ish APIs like thenReturn , compared to Voidspace Mock's Pythonic style of return_value .","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"approaches this by mocking out the entire"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"storer"}]},{"block_type":"text","content":"object."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"originated as a Java mocking tool, which explains its Java-ish APIs like"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"thenReturn"}]},{"block_type":"text","content":", compared to Voidspace Mock's Pythonic style of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"return_value"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaia","search_text":"Some find this influence from Java on Python's implementation of mockito distasteful. Frankly, I believe that is insufficient reason to discard a library. In the previous example, mockito records the desired behavior in a more succinct fashion, something that would definitely offset the Java-like API.","text_count":302,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some find this influence from Java on Python's implementation of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"distasteful. Frankly, I believe that is insufficient reason to discard a library. In the previous example,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mockito"}]},{"block_type":"text","content":"records the desired behavior in a more succinct fashion, something that would definitely offset the Java-like API."}]},{"block_type":"element","block":"k6bfvaib","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvaic","search_text":"Writing a testable story with Voidspace Mock and nose.","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Voidspace Mock and nose."}]}]},{"block_type":"element","block":"k6bfvaid","search_text":"Writing a testable story with Lettuce","text_count":37,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Lettuce"}]},{"block_type":"element","block":"k6bfvaie","search_text":"Lettuce ( http://lettuce.it ) is a Cucumber-like BDD tool built for Python.","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Lettuce"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://lettuce.it"},"children":[{"block_type":"text","content":"http://lettuce.it"}]},{"block_type":"text","content":") is a Cucumber-like BDD tool built for Python."}]},{"block_type":"element","block":"k6bfvaif","search_text":"Cucumber ( http://cukes.info ) was developed by the Ruby community and provides a way to write scenarios in a textual style. By letting our stakeholders read the stories, they can easily discern what the software is expected to do.","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Cucumber ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://cukes.info"},"children":[{"block_type":"text","content":"http://cukes.info"}]},{"block_type":"text","content":") was developed by the Ruby community and provides a way to write scenarios in a textual style. By letting our stakeholders read the stories, they can easily discern what the software is expected to do."}]},{"block_type":"element","block":"k6bfvaig","search_text":"This recipe shows how to install Lettuce, write a test story, and then wire it into our shopping cart application to exercise our code.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows how to install Lettuce, write a test story, and then wire it into our shopping cart application to exercise our code."}]},{"block_type":"element","block":"k6bfvaih","search_text":"Getting ready...","text_count":16,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready..."}]},{"block_type":"element","block":"k6bfvaii","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter. We also need to install Lettuce and its dependencies.","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter. We also need to install Lettuce and its dependencies."}]},{"block_type":"element","block":"k6bfvaij","search_text":"Install Lettuce by typing pip install lettuce .","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Install Lettuce by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install lettuce"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaik","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvail","search_text":"In the following steps, we will explore creating some testable stories with Lettuce, and wiring them to runnable Python code:","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the following steps, we will explore creating some testable stories with Lettuce, and wiring them to runnable Python code:"}]},{"block_type":"element","block":"k6bfvaim","search_text":"Create a new folder called recipe32 to contain all the files in this recipe. Create a file named recipe32.feature to capture our story. Write the top-level description of our new feature, based on our shopping cart: ","text_count":216,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new folder called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe32"}]},{"block_type":"text","content":"to contain all the files in this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a file named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe32.feature"}]},{"block_type":"text","content":"to capture our story. Write the top-level description of our new feature, based on our shopping cart:"}]}]},{"block_type":"element","block":"k6bfvain","search_text":"Feature: Shopping cart As a shopper I want to load up items in my cart So that I can check out and pay for them","text_count":111,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Feature: Shopping cart As a shopper\n   I want to load up items in my cart\n   So that I can check out and pay for them"}]}]},{"block_type":"element","block":"k6bfvaio","search_text":"Let's first create a scenario that captures the behavior of the cart when it's empty: ","text_count":86,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Let's first create a scenario that captures the behavior of the cart when it's empty:"}]}]},{"block_type":"element","block":"k6bfvaip","search_text":"Scenario: Empty cart Given an empty cart Then looking up the fifth item causes an error And looking up a negative price causes an error And the price with no taxes is $0.00 And the price with taxes is $0.00","text_count":206,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario: Empty cart\n            Given an empty cart\n            Then looking up the fifth item causes an error\n            And looking up a negative price causes an error\n            And the price with no taxes is $0.00\n            And the price with taxes is $0.00"}]}]},{"block_type":"element","block":"k6bfvaiq","search_text":"Add another scenario that shows what happens when we add cartons of milk: ","text_count":74,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add another scenario that shows what happens when we add cartons of milk:"}]}]},{"block_type":"element","block":"k6bfvair","search_text":"Scenario: Cart getting loaded with multiple of the same Given an empty cart When I add a carton of milk for $2.50 And I add another carton of milk for $2.50 Then the first item is a carton of milk And the price is $5.00 And the cart has 2 items And the total cost with 10% taxes is $5.50","text_count":287,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario: Cart getting loaded with multiple of the same \n            Given an empty cart\n            When I add a carton of milk for $2.50\n            And I add another carton of milk for $2.50 \n            Then the first item is a carton of milk\n            And the price is $5.00 And the cart has 2 items\n            And the total cost with 10% taxes is $5.50"}]}]},{"block_type":"element","block":"k6bfvais","search_text":"Add a third scenario that shows what happens when we combine a carton of milk and a frozen pizza: ","text_count":98,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a third scenario that shows what happens when we combine a carton of milk and a frozen pizza:"}]}]},{"block_type":"element","block":"k6bfvait","search_text":"Scenario: Cart getting loaded with different items Given an empty cart When I add a carton of milk And I add a frozen pizza Then the first item is a carton of milk And the second item is a frozen pizza And the first price is $2.50 And the second price is $3.00 And the total cost with no taxes is $5.50 And the total cost with 10% taes is $6.05","text_count":344,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario: Cart getting loaded with different items \n            Given an empty cart\n            When I add a carton of milk\n            And I add a frozen pizza\n            Then the first item is a carton of milk\n            And the second item is a frozen pizza\n            And the first price is $2.50\n            And the second price is $3.00\n            And the total cost with no taxes is $5.50\n            And the total cost with 10% taes is $6.05"}]}]},{"block_type":"element","block":"k6bfvaiu","search_text":"Let's run the story through Lettuce to see what the outcome is, considering we haven't linked this story to any Python code. In the following screenshot, it's impossible to discern the color of the outputs. The feature and scenario declarations are white. Given , When , and Then are undefined and colored yellow. This shows that we haven't tied the steps to any code yet: ","text_count":373,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Let's run the story through Lettuce to see what the outcome is, considering we haven't linked this story to any Python code. In the following screenshot, it's impossible to discern the color of the outputs. The feature and scenario declarations are white."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"are undefined and colored yellow. This shows that we haven't tied the steps to any code yet:"}]}]},{"block_type":"element","block":"k6bfvaiv","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000149.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaiw","search_text":"Create a new file in recipe32 called steps.py to implement the steps needed to support Given . Add some code to steps.py to implement the first Given : ","text_count":152,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe32"}]},{"block_type":"text","content":"called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"steps.py"}]},{"block_type":"text","content":"to implement the steps needed to support"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"steps.py"}]},{"block_type":"text","content":"to implement the first"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaix","search_text":"from lettuce import * from cart import * @step(\"an empty cart\") def an_empty_cart(step): world.cart = ShoppingCart()","text_count":116,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from lettuce import *\nfrom cart import *\n@step(\"an empty cart\")\ndef an_empty_cart(step):\n   world.cart = ShoppingCart()"}]}]},{"block_type":"element","block":"k6bfvaiy","search_text":"To run the steps, we need to make sure the current path that contains the cart.py module is part of our PYTHONPATH . ","text_count":117,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To run the steps, we need to make sure the current path that contains the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"module is part of our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PYTHONPATH"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvaiz","search_text":"Tip For Linux and Mac OSX systems, type export PYTHONPATH=/path/to/ cart.py . For Windows, go to Control Panel | System | Advanced, click Environment Variables, and either edit the existing PYTHONPATH variable or add a new one, pointing to the folder that contains cart.py . ","text_count":275,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For Linux and Mac OSX systems, type"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"export PYTHONPATH=/path/to/ cart.py"}]},{"block_type":"text","content":". For Windows, go to Control Panel | System | Advanced, click Environment Variables, and either edit the existing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PYTHONPATH"}]},{"block_type":"text","content":"variable or add a new one, pointing to the folder that contains"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvaj0","search_text":"Run the stories again. It's hard to see in the following screenshot, but Given an empty cart is now green: ","text_count":107,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the stories again. It's hard to see in the following screenshot, but"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given an empty cart"}]},{"block_type":"text","content":"is now green:"}]}]},{"block_type":"element","block":"k6bfvaj1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000097.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaj2","search_text":"Note While this screenshot only focuses on the first scenario, all three scenarios have the same Given . The code we wrote satisfied all three Given. ","text_count":150,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While this screenshot only focuses on the first scenario, all three scenarios have the same"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":". The code we wrote satisfied all three"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given."}]}]}]},{"block_type":"element","block":"k6bfvaj3","search_text":"Add code to steps.py that implements support for the first scenario's Then : ","text_count":77,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"steps.py"}]},{"block_type":"text","content":"that implements support for the first scenario's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaj4","search_text":"@step(\"looking up the fifth item causes an error\") def looking_up_fifth_item(step): try: world.cart.item(5) raise AssertionError(\"Expected IndexError\") except IndexError, e: pass @step(\"looking up a negative price causes an error\") def looking_up_negative_price(step): try: world.cart.price(-2) raise AssertionError(\"Expected IndexError\") except IndexError, e: pass @step(\"the price with no taxes is (.*)\") def price_with_no_taxes(step, total): assert world.cart.total(0.0) == float(total) @step(\"the price with taxes is (.*)\") def price_with_taxes(step, total): assert world.cart.total(10.0) == float(total) ","text_count":609,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"@step(\"looking up the fifth item causes an error\") \ndef looking_up_fifth_item(step):\n    try:\n      world.cart.item(5)\n      raise AssertionError(\"Expected IndexError\") \n    except IndexError, e:\n      pass\n@step(\"looking up a negative price causes an error\")\n    def looking_up_negative_price(step):\n        try:\n          world.cart.price(-2)\n             raise AssertionError(\"Expected IndexError\")\n        except IndexError, e:\n          pass\n@step(\"the price with no taxes is (.*)\")\n    def price_with_no_taxes(step, total):\n       assert world.cart.total(0.0) == float(total)\n@step(\"the price with taxes is (.*)\")\n    def price_with_taxes(step, total):\n        assert world.cart.total(10.0) == float(total)"}]}]},{"block_type":"element","block":"k6bfvaj5","search_text":"Run the stories again and notice how the first scenario is completely passing, as shown in the following screenshot: ","text_count":117,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the stories again and notice how the first scenario is completely passing, as shown in the following screenshot:"}]}]},{"block_type":"element","block":"k6bfvaj6","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000032.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaj7","search_text":"Now add code to steps.py to implement the steps needed for the second scenario: ","text_count":80,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Now add code to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"steps.py"}]},{"block_type":"text","content":"to implement the steps needed for the second scenario:"}]}]},{"block_type":"element","block":"k6bfvaj8","search_text":"@step(\"I add a carton of milk for (.*)\") def add_a_carton_of_milk(step, price): world.cart.add(\"carton of milk\", float(price)) @step(\"I add another carton of milk for (.*)\") def add_another_carton_of_milk(step, price): world.cart.add(\"carton of milk\", float(price)) @step(\"the first item is a carton of milk\") def check_first_item(step): assert world.cart.item(1) == \"carton of milk\" @step(\"the price is (.*)\") def check_first_price(step, price): assert world.cart.price(1) == float(price) @step(\"the cart has (.*) items\") def check_size_of_cart(step, num_items): assert len(world.cart) == float(num_items) @step(\"the total cost with (.*)% taxes is (.*)\") def check_total_cost(step, tax_rate, total): assert world.cart.total(float(tax_rate))==float(total)","text_count":755,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"@step(\"I add a carton of milk for (.*)\")\ndef add_a_carton_of_milk(step, price):\n    world.cart.add(\"carton of milk\", float(price))\n@step(\"I add another carton of milk for (.*)\")\ndef add_another_carton_of_milk(step, price):\n    world.cart.add(\"carton of milk\", float(price))\n@step(\"the first item is a carton of milk\")\ndef check_first_item(step):\n    assert world.cart.item(1) == \"carton of milk\"\n@step(\"the price is (.*)\")\ndef check_first_price(step, price):\n    assert world.cart.price(1) == float(price)\n@step(\"the cart has (.*) items\")\ndef check_size_of_cart(step, num_items): \n    assert len(world.cart) == float(num_items)\n@step(\"the total cost with (.*)% taxes is (.*)\")\ndef check_total_cost(step, tax_rate, total):\n    assert world.cart.total(float(tax_rate))==float(total)"}]}]},{"block_type":"element","block":"k6bfvaj9","search_text":"Finally, add code to steps.py to implement the steps needed for the last scenario: ","text_count":83,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, add code to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"steps.py"}]},{"block_type":"text","content":"to implement the steps needed for the last scenario:"}]}]},{"block_type":"element","block":"k6bfvaja","search_text":"@step(\"I add a carton of milk\") def add_a_carton_of_milk(step): world.cart.add(\"carton of milk\", 2.50) @step(\"I add a frozen pizza\") def add_a_frozen_pizza(step): world.cart.add(\"frozen pizza\", 3.00) @step(\"the second item is a frozen pizza\") def check_the_second_item(step): assert world.cart.item(2) == \"frozen pizza\" @step(\"the first price is (.*)\") def check_the_first_price(step, price): assert world.cart.price(1) == float(price) @step(\"the second price is (.*)\") def check_the_second_price(step, price): assert world.cart.price(2) == float(price) @step(\"the total cost with no taxes is (.*)\") def check_total_cost_with_no_taxes(step, total): assert world.cart.total(0.0) == float(total) @step(\"the total cost with (.*)% taxes is (.*)\") def check_total_cost_with_taxes(step, tax_rate, total): assert round(world.cart.total(float(tax_rate)),2) == float(total)","text_count":864,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"@step(\"I add a carton of milk\")\ndef add_a_carton_of_milk(step):\n    world.cart.add(\"carton of milk\", 2.50)\n@step(\"I add a frozen pizza\")\ndef add_a_frozen_pizza(step):\n    world.cart.add(\"frozen pizza\", 3.00)\n@step(\"the second item is a frozen pizza\")\ndef check_the_second_item(step):\n    assert world.cart.item(2) == \"frozen pizza\"\n@step(\"the first price is (.*)\")\ndef check_the_first_price(step, price):\n   assert world.cart.price(1) == float(price)\n@step(\"the second price is (.*)\")\ndef check_the_second_price(step, price): \n    assert world.cart.price(2) == float(price)\n@step(\"the total cost with no taxes is (.*)\")\ndef check_total_cost_with_no_taxes(step, total):\n    assert world.cart.total(0.0) == float(total)\n@step(\"the total cost with (.*)% taxes is (.*)\")\ndef check_total_cost_with_taxes(step, tax_rate, total):\n    assert round(world.cart.total(float(tax_rate)),2) == float(total)"}]}]},{"block_type":"element","block":"k6bfvajb","search_text":"Run the story by typing lettuce recipe32 and see how they are all now passing. In the next screenshot, we have all the tests passing and everything is green: ","text_count":158,"tag_name":"ol","attributes":{"start":"15"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the story by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lettuce recipe32"}]},{"block_type":"text","content":"and see how they are all now passing. In the next screenshot, we have all the tests passing and everything is green:"}]}]},{"block_type":"element","block":"k6bfvajc","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000003.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvajd","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaje","search_text":"Lettuce uses the popular Given / When / Then style of BDD story telling.","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Lettuce uses the popular"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"style of BDD story telling."}]},{"block_type":"element","block":"k6bfvajf","search_text":"Givens : This involves setting up a scenario. This often includes creating objects. For each of our scenarios, we created an instance of the ShoppingCart . This is very similar to unittest's setup method. Thens : This acts on Given . These are the operations we want to exercise in a scenario. We can exercise more than one Then . Whens : This involves testing the final results of Then . In our code, we mostly used Python asserts. In a couple of cases, where we needed to detect an exception, we wrapped the call with a try-catch block with a throw if the expected exception didn't occur. ","text_count":591,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Givens"}]},{"block_type":"text","content":": This involves setting up a scenario. This often includes creating objects. For each of our scenarios, we created an instance of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":". This is very similar to unittest's setup method."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Thens"}]},{"block_type":"text","content":": This acts on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":". These are the operations we want to exercise in a scenario. We can exercise more than one"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Whens"}]},{"block_type":"text","content":": This involves testing the final results of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":". In our code, we mostly used Python asserts. In a couple of cases, where we needed to detect an exception, we wrapped the call with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"try-catch"}]},{"block_type":"text","content":"block with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"throw"}]},{"block_type":"text","content":"if the expected exception didn't occur."}]}]},{"block_type":"element","block":"k6bfvajg","search_text":"It doesn't matter in what order we put the Given / Then / When . Lettuce will record everything so that all the Givens are listed first, followed by all the When conditions, and then all the Then conditions. Lettuce puts on the final polish by translating successive Given / When / Then conditions into And for better readability.","text_count":330,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It doesn't matter in what order we put the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":". Lettuce will record everything so that all the Givens are listed first, followed by all the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":"conditions, and then all the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"conditions. Lettuce puts on the final polish by translating successive"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"conditions into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"And"}]},{"block_type":"text","content":"for better readability."}]},{"block_type":"element","block":"k6bfvajh","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvaji","search_text":"If you look closely at some of the steps, you will notice some wildcards:","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you look closely at some of the steps, you will notice some wildcards:"}]},{"block_type":"element","block":"k6bfvajj","search_text":"@step(\"the total cost with (.*)% taxes is (.*)\") def check_total_cost(step, tax_rate, total): assert world.cart.total(float(tax_rate)) == float(total) ","text_count":151,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"@step(\"the total cost with (.*)% taxes is (.*)\")\ndef check_total_cost(step, tax_rate, total):\n   assert world.cart.total(float(tax_rate)) == float(total)"}]}]},{"block_type":"element","block":"k6bfvajk","search_text":"The @step string lets us dynamically grab parts of the string as variables by using pattern matchers:","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"@step"}]},{"block_type":"text","content":"string lets us dynamically grab parts of the string as variables by using pattern matchers:"}]},{"block_type":"element","block":"k6bfvajl","search_text":"The first (.*) is a pattern to capture tax_rate The second (.*) is a pattern to capture total ","text_count":94,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"(.*)"}]},{"block_type":"text","content":"is a pattern to capture&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tax_rate"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The second"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"(.*)"}]},{"block_type":"text","content":"is a pattern to capture&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"total"}]}]}]},{"block_type":"element","block":"k6bfvajm","search_text":"The method definition shows these two extra variables added in. We can name them anything we want. This gives us the ability to actually drive the tests, data and all, from recipe32.feature and only use steps.py to link things together in a generalized way.","text_count":257,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The method definition shows these two extra variables added in. We can name them anything we want. This gives us the ability to actually drive the tests, data and all, from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe32.feature"}]},{"block_type":"text","content":"and only use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"steps.py"}]},{"block_type":"text","content":"to link things together in a generalized way."}]},{"block_type":"element","block":"k6bfvajn","search_text":"Note It's important to point out that actual values stored in tax_rate and total are Unicode strings. Because the test involves floating point numbers, we have to convert the variables or the assert fails. ","text_count":206,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to point out that actual values stored in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tax_rate"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"total"}]},{"block_type":"text","content":"are Unicode strings. Because the test involves floating point numbers, we have to convert the variables or the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"fails."}]}]},{"block_type":"element","block":"k6bfvajo","search_text":"How complex should a story be?","text_count":30,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How complex should a story be?"}]},{"block_type":"element","block":"k6bfvajp","search_text":"In this recipe, we fit everything into a single story. Our story involved all the various shopping cart operations. As we write more scenarios, we may expand this into multiple stories. This goes back to the concept discussed in the Breaking down obscure tests into simple ones section of Chapter 1, Using Unittest to Develop Basic Tests . If we overload a single scenario with too many steps, it may get too complex. It is better if we can visualize a single thread of execution that is easy to verify at the end.","text_count":514,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we fit everything into a single story. Our story involved all the various shopping cart operations. As we write more scenarios, we may expand this into multiple stories. This goes back to the concept discussed in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Breaking"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"down"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"obscure"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"tests"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"into"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"simple"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"ones"}]},{"block_type":"text","content":"section of Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic Tests"}]},{"block_type":"text","content":". If we overload a single scenario with too many steps, it may get too complex. It is better if we can visualize a single thread of execution that is easy to verify at the end."}]},{"block_type":"element","block":"k6bfvajq","search_text":"Don't mix wiring code with application code","text_count":43,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Don't mix wiring code with application code"}]},{"block_type":"element","block":"k6bfvajr","search_text":"The project's website shows a sample building a factorial function. It has both the factorial function as well as the wiring in a single file. For demo purposes this is alright. But for actual production use, it is best to decouple the application from the Lettuce wiring. This encourages a clean interface and demonstrates usability.","text_count":334,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The project's website shows a sample building a factorial function. It has both the factorial function as well as the wiring in a single file. For demo purposes this is alright. But for actual production use, it is best to decouple the application from the Lettuce wiring. This encourages a clean interface and demonstrates usability."}]},{"block_type":"element","block":"k6bfvajs","search_text":"Lettuce works great using folders","text_count":33,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Lettuce works great using folders"}]},{"block_type":"element","block":"k6bfvajt","search_text":"Lettuce, by default, will look for a features folder wherever we run it, and discover any files ending in .feature . That way it can automatically find all of our stories and run them.","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Lettuce, by default, will look for a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"features"}]},{"block_type":"text","content":"folder wherever we run it, and discover any files ending in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".feature"}]},{"block_type":"text","content":". That way it can automatically find all of our stories and run them."}]},{"block_type":"element","block":"k6bfvaju","search_text":"It is possible to override the features directory with -s or –-scenarios .","text_count":74,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is possible to override the features directory with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-s"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ndash;-scenarios"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvajv","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvajw","search_text":"The Breaking down obscure tests into simple ones section from Chapter 1, Using Unittest to Develop Basic Tests .","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Breaking"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"down"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"obscure"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"tests"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"into"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"simple"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"ones"}]},{"block_type":"text","content":"section from Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic Tests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvajx","search_text":"Using Should DSL to write succinct assertions with Lettuce","text_count":58,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Using Should DSL to write succinct assertions with Lettuce"}]},{"block_type":"element","block":"k6bfvajy","search_text":"Lettuce ( http://lettuce.it ) is a BDD tool built for Python.","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Lettuce ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://lettuce.it"},"children":[{"block_type":"text","content":"http://lettuce.it"}]},{"block_type":"text","content":") is a BDD tool built for Python."}]},{"block_type":"element","block":"k6bfvajz","search_text":"Should DSL ( http://www.should-dsl.info ) provides a simpler way to write assertions for Then conditions.","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Should DSL"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.should-dsl.info"},"children":[{"block_type":"text","content":"http://www.should-dsl.info"}]},{"block_type":"text","content":") provides a simpler way to write assertions for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"conditions."}]},{"block_type":"element","block":"k6bfvak0","search_text":"This recipe shows how to install Lettuce and Should DSL. Then, we will write a test story. Finally, we will wire it into our shopping cart application using Should DSL to exercise our code.","text_count":189,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows how to install Lettuce and Should DSL. Then, we will write a test story. Finally, we will wire it into our shopping cart application using Should DSL to exercise our code."}]},{"block_type":"element","block":"k6bfvak1","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvak2","search_text":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter. We also need to install Lettuce and its dependencies by doing the following:","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will be using the shopping cart application shown at the beginning of this chapter. We also need to install Lettuce and its dependencies by doing the following:"}]},{"block_type":"element","block":"k6bfvak3","search_text":"Install Lettuce by typing pip install lettuce Install Should DSL by typing pip install should_dsl ","text_count":98,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Lettuce by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install lettuce"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Should DSL by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install should_dsl"}]}]}]},{"block_type":"element","block":"k6bfvak4","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvak5","search_text":"With the following steps, we will use Should DSL to write more succinct assertions in our test stories:","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will use Should DSL to write more succinct assertions in our test stories:"}]},{"block_type":"element","block":"k6bfvak6","search_text":"Create a new directory called recipe33 to contain all the files for this recipe. Create a new file in recipe33 called recipe33.feature to contain our test scenarios. Create a story in recipe33.feature with several scenarios to exercise our shopping cart, as follows: ","text_count":267,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new directory called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe33"}]},{"block_type":"text","content":"to contain all the files for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file in&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe33"}]},{"block_type":"text","content":"called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe33.feature"}]},{"block_type":"text","content":"to contain our test scenarios."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a story in&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe33.feature"}]},{"block_type":"text","content":"with several scenarios to exercise our shopping cart, as follows:"}]}]},{"block_type":"element","block":"k6bfvak7","search_text":"Feature: Shopping cart As a shopper I want to load up items in my cart So that I can check out and pay for them Scenario: Empty cart Given an empty cart Then looking up the fifth item causes an error And looking up a negative price causes an error And the price with no taxes is 0.0 And the price with taxes is 0.0 Scenario: Cart getting loaded with multiple of the same Given an empty cart When I add a carton of milk for 2.50 And I add another carton of milk for 2.50 Then the first item is a carton of milk And the price is 5.00 And the cart has 2 items And the total cost with 10% taxes is 5.50 Scenario: Cart getting loaded with different items Given an empty cart When I add a carton of milk And I add a frozen pizza Then the first item is a carton of milk And the second item is a frozen pizza And the first price is 2.50 And the second price is 3.00 And the total cost with no taxes is 5.50 And the total cost with 10% taxes is 6.05","text_count":940,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Feature: Shopping cart\n  As a shopper\n  I want to load up items in my cart\n  So that I can check out and pay for them\n     Scenario: Empty cart\n        Given an empty cart\n        Then looking up the fifth item causes an error\n        And looking up a negative price causes an error\n        And the price with no taxes is 0.0\n        And the price with taxes is 0.0\n     Scenario: Cart getting loaded with multiple of the same\n        Given an empty cart\n        When I add a carton of milk for 2.50\n        And I add another carton of milk for 2.50\n        Then the first item is a carton of milk\n        And the price is 5.00\n        And the cart has 2 items\n        And the total cost with 10% taxes is 5.50\n     Scenario: Cart getting loaded with different items\n        Given an empty cart\n        When I add a carton of milk\n        And I add a frozen pizza\n        Then the first item is a carton of milk\n        And the second item is a frozen pizza \n        And the first price is 2.50\n        And the second price is 3.00\n        And the total cost with no taxes is 5.50\n        And the total cost with 10% taxes is 6.05"}]}]},{"block_type":"element","block":"k6bfvak8","search_text":"Write a set of assertions using Should DSL, as follows: ","text_count":56,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a set of assertions using Should DSL, as follows:"}]}]},{"block_type":"element","block":"k6bfvak9","search_text":"from lettuce import * from should_dsl import should, should_not from cart import * @step(\"an empty cart\") def an_empty_cart(step): world.cart = ShoppingCart() @step(\"looking up the fifth item causes an error\") def looking_up_fifth_item(step): (world.cart.item, 5) |should| throw(IndexError) @step(\"looking up a negative price causes an error\") def looking_up_negative_price(step): (world.cart.price, -2) |should| throw(IndexError) @step(\"the price with no taxes is (.*)\") def price_with_no_taxes(step, total): world.cart.total(0.0) |should| equal_to(float(total)) @step(\"the price with taxes is (.*)\") def price_with_taxes(step, total): world.cart.total(10.0) |should| equal_to(float(total)) @step(\"I add a carton of milk for 2.50\") def add_a_carton_of_milk(step): world.cart.add(\"carton of milk\", 2.50) @step(\"I add another carton of milk for 2.50\") def add_another_carton_of_milk(step): world.cart.add(\"carton of milk\", 2.50) @step(\"the first item is a carton of milk\") def check_first_item(step): world.cart.item(1) |should| equal_to(\"carton of milk\") @step(\"the price is 5.00\") def check_first_price(step): world.cart.price(1) |should| equal_to(5.0) @step(\"the cart has 2 items\") def check_size_of_cart(step): len(world.cart) |should| equal_to(2) @step(\"the total cost with 10% taxes is 5.50\") def check_total_cost(step): world.cart.total(10.0) |should| equal_to(5.5) @step(\"I add a carton of milk\") def add_a_carton_of_milk(step): world.cart.add(\"carton of milk\", 2.50) @step(\"I add a frozen pizza\") def add_a_frozen_pizza(step): world.cart.add(\"frozen pizza\", 3.00) @step(\"the second item is a frozen pizza\") def check_the_second_item(step): world.cart.item(2) |should| equal_to(\"frozen pizza\") @step(\"the first price is 2.50\") def check_the_first_price(step): world.cart.price(1) |should| equal_to(2.5) @step(\"the second price is 3.00\") def check_the_second_price(step): world.cart.price(2) |should| equal_to(3.0) @step(\"the total cost with no taxes is 5.50\") def check_total_cost_with_no_taxes(step): world.cart.total(0.0) |should| equal_to(5.5) @step(\"the total cost with 10% taxes is (.*)\") def check_total_cost_with_taxes(step, total): world.cart.total(10.0) |should| close_to(float(total),\\ delta=0.1)","text_count":2213,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from lettuce import *\nfrom should_dsl import should, should_not\nfrom cart import *\n@step(\"an empty cart\")\ndef an_empty_cart(step):\n    world.cart = ShoppingCart()\n@step(\"looking up the fifth item causes an error\")\ndef looking_up_fifth_item(step):\n   (world.cart.item, 5) |should| throw(IndexError)\n@step(\"looking up a negative price causes an error\")\ndef looking_up_negative_price(step):\n   (world.cart.price, -2) |should| throw(IndexError)\n@step(\"the price with no taxes is (.*)\")\ndef price_with_no_taxes(step, total):\n   world.cart.total(0.0) |should| equal_to(float(total))\n@step(\"the price with taxes is (.*)\")\ndef price_with_taxes(step, total):\n   world.cart.total(10.0) |should| equal_to(float(total))\n@step(\"I add a carton of milk for 2.50\")\ndef add_a_carton_of_milk(step):\n   world.cart.add(\"carton of milk\", 2.50)\n@step(\"I add another carton of milk for 2.50\")\ndef add_another_carton_of_milk(step):\n   world.cart.add(\"carton of milk\", 2.50)\n@step(\"the first item is a carton of milk\")\ndef check_first_item(step):\n   world.cart.item(1) |should| equal_to(\"carton of milk\")\n@step(\"the price is 5.00\")\ndef check_first_price(step):\n   world.cart.price(1) |should| equal_to(5.0)\n@step(\"the cart has 2 items\")\ndef check_size_of_cart(step):\n   len(world.cart) |should| equal_to(2)\n@step(\"the total cost with 10% taxes is 5.50\")\ndef check_total_cost(step):\n   world.cart.total(10.0) |should| equal_to(5.5)\n@step(\"I add a carton of milk\")\ndef add_a_carton_of_milk(step):\n   world.cart.add(\"carton of milk\", 2.50)\n@step(\"I add a frozen pizza\")\ndef add_a_frozen_pizza(step):\n   world.cart.add(\"frozen pizza\", 3.00)\n@step(\"the second item is a frozen pizza\")\ndef check_the_second_item(step):\n   world.cart.item(2) |should| equal_to(\"frozen pizza\")\n@step(\"the first price is 2.50\")\ndef check_the_first_price(step):\n   world.cart.price(1) |should| equal_to(2.5)\n@step(\"the second price is 3.00\")\ndef check_the_second_price(step):\n   world.cart.price(2) |should| equal_to(3.0)\n@step(\"the total cost with no taxes is 5.50\")\ndef check_total_cost_with_no_taxes(step):\n   world.cart.total(0.0) |should| equal_to(5.5)\n@step(\"the total cost with 10% taxes is (.*)\")\ndef check_total_cost_with_taxes(step, total):\n   world.cart.total(10.0) |should| close_to(float(total),\\\ndelta=0.1)"}]}]},{"block_type":"element","block":"k6bfvaka","search_text":"Run the story: ","text_count":15,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the story:"}]}]},{"block_type":"element","block":"k6bfvakb","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000011.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvakc","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvakd","search_text":"The previous recipe ( Writing a testable story with Lettuce ) shows more details on how Lettuce works. This recipe demonstrates how to use Should DSL to make useful assertions.","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The previous recipe ("},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testable"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"story"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Lettuce"}]},{"block_type":"text","content":") shows more details on how Lettuce works. This recipe demonstrates how to use Should DSL to make useful assertions."}]},{"block_type":"element","block":"k6bfvake","search_text":"Why do we need Should DSL? The simplest checks we write involve testing values to confirm the behavior of the shopping cart application. In the previous recipe, we mostly used Python assertions such as:","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why do we need Should DSL? The simplest checks we write involve testing values to confirm the behavior of the shopping cart application. In the previous recipe, we mostly used Python assertions such as:"}]},{"block_type":"element","block":"k6bfvakf","search_text":"assert len(context.cart) == 2","text_count":29,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"assert len(context.cart) == 2"}]}]},{"block_type":"element","block":"k6bfvakg","search_text":"This is pretty easy to understand. Should DSL offers a simple alternative, which is this:","text_count":89,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is pretty easy to understand. Should DSL offers a simple alternative, which is this:"}]},{"block_type":"element","block":"k6bfvakh","search_text":"len(context.cart) |should| equal_to(2)","text_count":38,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"len(context.cart) |should| equal_to(2)"}]}]},{"block_type":"element","block":"k6bfvaki","search_text":"Does this look like much of a difference? Some say yes, others say no. It is wordier, and for some this is easier to read. For others, it isn't.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does this look like much of a difference? Some say yes, others say no. It is wordier, and for some this is easier to read. For others, it isn't."}]},{"block_type":"element","block":"k6bfvakj","search_text":"So why are we visiting this? Because Should DSL has more than just equal_to . There are many more commands, such as these:","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So why are we visiting this? Because Should DSL has more than just"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"equal_to"}]},{"block_type":"text","content":". There are many more commands, such as these:"}]},{"block_type":"element","block":"k6bfvakk","search_text":"be : Checks identity contain, include, be_into : Verifies whether an object is contained or contains another be_kind_of : Checks types be_like : Checks using a regular expression be_thrown_by,throws : Checks that an exception is thrown close_to : Checks whether a value is close, given a delta end_with : Checks whether a string ends with a given suffix equal_to : Checks value equality respond_to : Checks whether an object has a given attribute or method start_with : Checks whether a string starts with a given prefix ","text_count":521,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"be"}]},{"block_type":"text","content":": Checks identity"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"contain, include, be_into"}]},{"block_type":"text","content":": Verifies whether an object is contained or contains another"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"be_kind_of"}]},{"block_type":"text","content":": Checks types"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"be_like"}]},{"block_type":"text","content":": Checks using a regular expression"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"be_thrown_by,throws"}]},{"block_type":"text","content":": Checks that an exception is thrown"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"close_to"}]},{"block_type":"text","content":": Checks whether a&nbsp;value is close, given a delta"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"end_with"}]},{"block_type":"text","content":": Checks whether a string ends with a given suffix"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"equal_to"}]},{"block_type":"text","content":": Checks value equality"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"respond_to"}]},{"block_type":"text","content":": Checks whether an object has a given attribute or method"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"start_with"}]},{"block_type":"text","content":": Checks whether a string starts with a given prefix"}]}]},{"block_type":"element","block":"k6bfvakl","search_text":"There are other alternatives as well, but this provides a diverse set of comparisons. If we imagine the code needed to write assertions that check the same things, then things get more complex.","text_count":193,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are other alternatives as well, but this provides a diverse set of comparisons. If we imagine the code needed to write assertions that check the same things, then things get more complex."}]},{"block_type":"element","block":"k6bfvakm","search_text":"For example, let's think about confirming expected exceptions. In the previous recipe, we needed to confirm that an IndexError is thrown when accessing an item outside the boundaries of our cart. A simple Python assert didn't work, so instead we coded this pattern:","text_count":265,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, let's think about confirming expected exceptions. In the previous recipe, we needed to confirm that an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"IndexError"}]},{"block_type":"text","content":"is thrown when accessing an item outside the boundaries of our cart. A simple Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"didn't work, so instead we coded this pattern:"}]},{"block_type":"element","block":"k6bfvakn","search_text":"try: world.cart.price(-2) raise AssertionError(\"Expected an IndexError\") except IndexError, e: pass","text_count":99,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"try:\n  world.cart.price(-2)\n  raise AssertionError(\"Expected an IndexError\") \nexcept IndexError, e:\n   pass"}]}]},{"block_type":"element","block":"k6bfvako","search_text":"This is clunky and ugly. Now, imagine a more complex, more realistic system, and the idea of having to use this pattern for lots of test situations where we want to verify that a proper exception is thrown. This can quickly become an expensive coding task.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is clunky and ugly. Now, imagine a more complex, more realistic system, and the idea of having to use this pattern for lots of test situations where we want to verify that a proper exception is thrown. This can quickly become an expensive coding task."}]},{"block_type":"element","block":"k6bfvakp","search_text":"Thankfully, Should DSL turns this pattern of exception assertion into a one-liner:","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Thankfully, Should DSL turns this pattern of exception assertion into a one-liner:"}]},{"block_type":"element","block":"k6bfvakq","search_text":"(world.cart.price, -2) |should| throw(IndexError)","text_count":49,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(world.cart.price, -2) |should| throw(IndexError)"}]}]},{"block_type":"element","block":"k6bfvakr","search_text":"This is clear and concise. We can instantly understand that invoking this method with these arguments should throw a certain exception. If no exception is raised, or a different one is raised, it will fail and give us clear feedback.","text_count":233,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is clear and concise. We can instantly understand that invoking this method with these arguments should throw a certain exception. If no exception is raised, or a different one is raised, it will fail and give us clear feedback."}]},{"block_type":"element","block":"k6bfvaks","search_text":"Note If you notice, Should DSL requires the method call to be split up into a tuple, with the first element of the tuple being the method handle, and the rest being the arguments for the method. ","text_count":195,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you notice, Should DSL requires the method call to be split up into a tuple, with the first element of the tuple being the method handle, and the rest being the arguments for the method."}]}]},{"block_type":"element","block":"k6bfvakt","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvaku","search_text":"In the sample code listed in this chapter, we used |should| . But Should DSL also comes with |should_not| . Sometimes, the condition we want to express is best captured with a |should_not| . Combined with all the matchers listed earlier, we have a plethora of opportunities to test things, positive or negative.","text_count":311,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the sample code listed in this chapter, we used"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"|should|"}]},{"block_type":"text","content":". But Should DSL also comes with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"|should_not|"}]},{"block_type":"text","content":". Sometimes, the condition we want to express is best captured with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"|should_not|"}]},{"block_type":"text","content":". Combined with all the matchers listed earlier, we have a plethora of opportunities to test things, positive or negative."}]},{"block_type":"element","block":"k6bfvakv","search_text":"But, don't forget, we can still use Python's plain old assert if it is easier to read. The idea is to have plenty of ways to express the same verification of behavior.","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But, don't forget, we can still use Python's plain old"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"if it is easier to read. The idea is to have plenty of ways to express the same verification of behavior."}]},{"block_type":"element","block":"k6bfvakw","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvakx","search_text":"Writing a testable story with Lettuce. ","text_count":39,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Lettuce."}]}]}]},{"block_type":"element","block":"k6bfvaky","search_text":"Updating the project-level script to run this chapter's BDD tests","text_count":65,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Updating the project-level script to run this chapter's BDD tests"}]},{"block_type":"element","block":"k6bfvakz","search_text":"In this chapter, we have developed several tactics to write and exercise BDD tests. This should help us in developing new projects. An invaluable tool for any project is having a top-level script used to manage things such as packaging, bundling, and testing.","text_count":259,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we have developed several tactics to write and exercise BDD tests. This should help us in developing new projects. An invaluable tool for any project is having a top-level script used to manage things such as packaging, bundling, and testing."}]},{"block_type":"element","block":"k6bfval0","search_text":"This recipe shows how to create a command-line project script that will run all the tests we created in this chapter using the various runners.","text_count":143,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows how to create a command-line project script that will run all the tests we created in this chapter using the various runners."}]},{"block_type":"element","block":"k6bfval1","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfval2","search_text":"For this recipe, we need to have coded all the recipes from this chapter.","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we need to have coded all the recipes from this chapter."}]},{"block_type":"element","block":"k6bfval3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfval4","search_text":"With the following steps, we will create a project-level script that will run all the test recipes from this chapter:","text_count":117,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will create a project-level script that will run all the test recipes from this chapter:"}]},{"block_type":"element","block":"k6bfval5","search_text":"Create a new file called recipe34.py . Add code that uses the getopt library for parsing command-line arguments, as shown here: ","text_count":128,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe34.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code that uses the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library for parsing command-line arguments, as shown here:"}]}]},{"block_type":"element","block":"k6bfval6","search_text":"import getopt import logging import nose import os import os.path import re import sys import lettuce import doctest from glob import glob def usage(): print() print(\"Usage: python recipe34.py [command]\" print() print \"\\t--help\" print \"\\t--test\" print \"\\t--package\" print \"\\t--publish\" print \"\\t--register\" print() try: optlist, args = getopt.getopt(sys.argv[1:], \"h\", [\"help\", \"test\", \"package\", \"publish\", \"register\"]) except getopt.GetoptError: # print help information and exit: print \"Invalid command found in %s\" % sys.argv usage() sys.exit(2)","text_count":549,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import getopt\nimport logging \nimport nose \nimport os \nimport os.path \nimport re \nimport sys \nimport lettuce \nimport doctest\nfrom glob import glob\ndef usage(): \n    print()\n    print(\"Usage: python recipe34.py [command]\" \n    print()\n    print \"\\t--help\" \n    print \"\\t--test\" \n    print \"\\t--package\" \n    print \"\\t--publish\" \n    print \"\\t--register\" \n    print()\n    try:\n      optlist, args = getopt.getopt(sys.argv[1:], \n               \"h\",\n              [\"help\", \"test\", \"package\", \"publish\", \"register\"]) \n   except getopt.GetoptError:\n       # print help information and exit:\n       print \"Invalid command found in %s\" % sys.argv \n       usage()\n       sys.exit(2)"}]}]},{"block_type":"element","block":"k6bfval7","search_text":"Add a test function that uses our custom nose plugin, BddPrinter , as shown here: ","text_count":82,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test function that uses our custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BddPrinter"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfval8","search_text":"def test_with_bdd(): from recipe26_plugin import BddPrinter suite = [\"recipe26\", \"recipe30\", \"recipe31\"] print(\"Running suite %s\" % suite) args = [\"\"] args.extend(suite) args.extend([\"--with-bdd\"]) nose.run(argv=args, plugins=[BddPrinter()])","text_count":241,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_with_bdd():\n    from recipe26_plugin import BddPrinter\n    suite = [\"recipe26\", \"recipe30\", \"recipe31\"] \n    print(\"Running suite %s\" % suite)\n    args = [\"\"] \n    args.extend(suite) \n    args.extend([\"--with-bdd\"])\n    nose.run(argv=args, plugins=[BddPrinter()])"}]}]},{"block_type":"element","block":"k6bfval9","search_text":"Add a test function that exercises file-based doctest : ","text_count":56,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test function that exercises file-based"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvala","search_text":"def test_plain_old_doctest(): for extension in [\"doctest\", \"txt\"]: for doc in glob(\"recipe27*.%s\" % extension): print(\"Testing %s\" % doc) doctest.testfile(doc)","text_count":159,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_plain_old_doctest():\n   for extension in [\"doctest\", \"txt\"]:\n       for doc in glob(\"recipe27*.%s\" % extension): \n           print(\"Testing %s\" % doc) \n           doctest.testfile(doc)"}]}]},{"block_type":"element","block":"k6bfvalb","search_text":"Add a test function that exercises multiple doctest using a customized doctest runner: ","text_count":87,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test function that exercises multiple"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"using a customized"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"doctest"}]},{"block_type":"text","content":"runner:"}]}]},{"block_type":"element","block":"k6bfvalc","search_text":"def test_customized_doctests(): def test_customized_doctests(): from recipe28 import BddDocTestRunner old_doctest_runner = doctest.DocTestRunner doctest.DocTestRunner = BddDocTestRunner for recipe in [\"recipe28\", \"recipe29\"]: for file in glob(\"%s*.doctest\" % recipe): given = file[len(\"%s_\" % recipe):] given = given[:-len(\".doctest\")] given = \" \".join(given.split(\"_\")) print(\"===================================\") print(\"%s: Given a %s...\" % (recipe, given)) print( \"===================================\") doctest.testfile(file) print() doctest.DocTestRunner = old_doctest_runner","text_count":580,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_customized_doctests():\n    def test_customized_doctests():\n    from recipe28 import BddDocTestRunner\n    old_doctest_runner = doctest.DocTestRunner \n    doctest.DocTestRunner = BddDocTestRunner\n    for recipe in [\"recipe28\", \"recipe29\"]:\n        for file in glob(\"%s*.doctest\" % recipe): \n            given = file[len(\"%s_\" % recipe):] \n            given = given[:-len(\".doctest\")] \n            given = \" \".join(given.split(\"_\"))\n            print(\"===================================\") \n            print(\"%s: Given a %s...\" % (recipe, given)) \n            print( \"===================================\") \n            doctest.testfile(file)\n            print()\n    doctest.DocTestRunner = old_doctest_runner"}]}]},{"block_type":"element","block":"k6bfvald","search_text":"Add a test function that exercises Lettuce tests: ","text_count":50,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test function that exercises Lettuce tests:"}]}]},{"block_type":"element","block":"k6bfvale","search_text":"def test_lettuce_scenarios(): print(\"Running suite recipe32\") lettuce.Runner(os.path.abspath(\"recipe32\"), verbosity=3).run() print() print(\"Running suite recipe33\") lettuce.Runner(os.path.abspath(\"recipe33\"), verbosity=3).run() print()","text_count":235,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_lettuce_scenarios():\n    print(\"Running suite recipe32\")\n    lettuce.Runner(os.path.abspath(\"recipe32\"), verbosity=3).run()\n    print()\n    print(\"Running suite recipe33\") \n    lettuce.Runner(os.path.abspath(\"recipe33\"), verbosity=3).run() \n    print()"}]}]},{"block_type":"element","block":"k6bfvalf","search_text":"Add a top-level test function that runs all of our test functions and can be wired to the command-line option: ","text_count":111,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a top-level test function that runs all of our test functions and can be wired to the command-line option:"}]}]},{"block_type":"element","block":"k6bfvalg","search_text":"def test(): def test(): test_with_bdd() test_plain_old_doctest() test_customized_doctests() test_lettuce_scenarios()","text_count":116,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test():\n    def test(): \n        test_with_bdd()\n        test_plain_old_doctest() \n        test_customized_doctests() \n        test_lettuce_scenarios()"}]}]},{"block_type":"element","block":"k6bfvalh","search_text":"Add some extra stub functions that represent packaging, publishing, and registration options: ","text_count":94,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some extra stub functions that represent packaging, publishing, and registration options:"}]}]},{"block_type":"element","block":"k6bfvali","search_text":"def package(): print \"This is where we can plug in code to run \" + \\ \"setup.py to generate a bundle.\" def publish(): print \"This is where we can plug in code to upload \" + \\ \"our tarball to S3 or some other download site.\" def register(): print \"setup.py has a built in function to \" + \\ \"'register' a release to PyPI. It's \" + \\ \"convenient to put a hook in here.\" # os.system(\"%s setup.py register\" % sys.executable)","text_count":418,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def package():\n    print \"This is where we can plug in code to run \" + \\ \n          \"setup.py to generate a bundle.\"\ndef publish():\n    print \"This is where we can plug in code to upload \" + \\ \n          \"our tarball to S3 or some other download site.\"\ndef register():\n    print \"setup.py has a built in function to \" + \\ \n          \"'register' a release to PyPI. It's \" + \\ \n          \"convenient to put a hook in here.\"\n    # os.system(\"%s setup.py register\" % sys.executable)"}]}]},{"block_type":"element","block":"k6bfvalj","search_text":"Add code to parse the command-line options: ","text_count":44,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code to parse the command-line options:"}]}]},{"block_type":"element","block":"k6bfvalk","search_text":"if len(optlist) == 0: usage() sys.exit(1) # Check for help requests, which cause all other # options to be ignored. for option in optlist: if option[0] in (\"--help\", \"-h\"): usage() sys.exit(1) # Parse the arguments, in order for option in optlist: if option[0] in (\"--test\"): test() if option[0] in (\"--package\"): package() if option[0] in (\"--publish\"): publish() if option[0] in (\"--register\"): registe","text_count":404,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if len(optlist) == 0:\n   usage()\n   sys.exit(1)\n# Check for help requests, which cause all other\n# options to be ignored.\nfor option in optlist:\n   if option[0] in (\"--help\", \"-h\"):\n      usage()\n      sys.exit(1)\n# Parse the arguments, in order\nfor option in optlist:\n   if option[0] in (\"--test\"):\n      test()\n   if option[0] in (\"--package\"):\n      package()\n   if option[0] in (\"--publish\"):\n      publish()\n   if option[0] in (\"--register\"):\n      registe"}]}]},{"block_type":"element","block":"k6bfvall","search_text":"Run the script with no options: ","text_count":32,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script with no options:"}]}]},{"block_type":"element","block":"k6bfvalm","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000064.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaln","search_text":"Run the script with –test : ","text_count":28,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ndash;test"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvalo","search_text":"(ptc)gturnquist-mbp:04 gturnquist$ python recipe34.py --test Running suite ['recipe26', 'recipe30', 'recipe31'] ... Scenario: Cart getting loaded with different items # recipe33/recipe33.feature:22 Given an empty cart # recipe33/steps.py:6 When I add a carton of milk # recipe33/steps.py:50 And I add a frozen pizza # recipe33/steps.py:54 Then the first item is a carton of milk # recipe33/steps.py:34 And the second item is a frozen pizza # recipe33/steps.py:58 And the first price is 2.50 # recipe32/steps.py:69 And the second price is 3.00 # recipe33/steps.py:66 And the total cost with no taxes is 5.50 # recipe33/steps.py:70 And the total cost with 10% taxes is 6.05 # recipe33/steps.py:74 1 feature (1 passed) 3 scenarios (3 passed) 21 steps (21 passed) ","text_count":760,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(ptc)gturnquist-mbp:04 gturnquist$ python recipe34.py --test Running suite ['recipe26', 'recipe30', 'recipe31']\n...\n  Scenario: Cart getting loaded with different items        #\nrecipe33/recipe33.feature:22\n     Given an empty cart                                    #\nrecipe33/steps.py:6\n     When I add a carton of milk                            #\nrecipe33/steps.py:50\n     And I add a frozen pizza                               #\nrecipe33/steps.py:54\n     Then the first item is a carton of milk                #\nrecipe33/steps.py:34\n     And the second item is a frozen pizza                  #\nrecipe33/steps.py:58\n     And the first price is 2.50                            #\nrecipe32/steps.py:69\n     And the second price is 3.00                           #\nrecipe33/steps.py:66\n     And the total cost with no taxes is 5.50               #\nrecipe33/steps.py:70\n     And the total cost with 10% taxes is 6.05              #\nrecipe33/steps.py:74\n1 feature (1 passed)\n3 scenarios (3 passed)\n21 steps (21 passed)"}]}]},{"block_type":"element","block":"k6bfvalp","search_text":"Run the script using --package --publish --register . Take a look at this screenshot: ","text_count":86,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--package --publish --register"}]},{"block_type":"text","content":". Take a look at this screenshot:"}]}]},{"block_type":"element","block":"k6bfvalq","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000053.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvalr","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvals","search_text":"This script uses Python's getopt library.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This script uses Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"library."}]},{"block_type":"element","block":"k6bfvalt","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvalu","search_text":"For more details about how and why to use getopt , reasons to write a project-level script, and why we are using getopt instead of optparse .","text_count":141,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more details about how and why to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":", reasons to write a project-level script, and why we are using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"instead of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"optparse"}]},{"block_type":"text","content":"."}]}]},{"title":"High-Level Customer Scenarios with Acceptance Testing","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3r6","number":5,"contents":[{"block_type":"element","block":"k6bfvalv","search_text":"In this chapter, we will cover the following:","text_count":45,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following:"}]},{"block_type":"element","block":"k6bfvalw","search_text":"Installing Pyccuracy Testing the basics with Pyccuracy Using Pyccuracy to verify web app security Installing Robot Framework Creating a data-driven test suite with Robot Framework Writing a testable story using Robot Framework Tagging Robot Framework tests and running a subset Testing web basics with Robot Framework Using Robot Framework to verify web app security Creating a project-level script to run this chapter's acceptance tests ","text_count":438,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Installing Pyccuracy"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing the basics with Pyccuracy"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using Pyccuracy to verify web app security"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Installing Robot Framework"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating a data-driven test suite with Robot Framework"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story using Robot Framework"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Tagging Robot Framework tests and running a subset"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Testing web basics with Robot Framework"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using Robot Framework to verify web app security"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating a project-level script to run this chapter's acceptance tests"}]}]},{"block_type":"element","block":"k6bfvalx","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfvaly","search_text":"Acceptance testing involves writing tests to prove that our code is, well, acceptable! However, what does this mean? The context implies acceptable from a customer's perspective. Customers are usually more interested in what the software does, not how it does it. This means that tests are aimed at inputs and outputs and tend to be at a higher level than unit testing. This has sometimes been called black box testing and is usually more system oriented. At the end of the day, it is often associated with testing that asserts whether or not the customer will accept the software.","text_count":581,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Acceptance testing involves writing tests to prove that our code is, well, acceptable! However, what does this mean? The context implies acceptable from a customer's perspective. Customers are usually more interested in what the software does, not how it does it. This means that tests are aimed at inputs and outputs and tend to be at a higher level than unit testing. This has sometimes been called black box testing and is usually more system oriented. At the end of the day, it is often associated with testing that asserts whether or not the customer will accept the software."}]},{"block_type":"element","block":"k6bfvalz","search_text":"There is an assumption among some developers that acceptance testing involves verifying the frontend of web applications. In fact, several testing tools, including Pyccuracy, are built on the sole premise of testing web applications. When viewed from the perspective of whether or not a customer will accept the software, this will quite literally fit into acceptable from a customer's perspective.","text_count":398,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is an assumption among some developers that acceptance testing involves verifying the frontend of web applications. In fact, several testing tools, including Pyccuracy, are built on the sole premise of testing web applications. When viewed from the perspective of whether or not a customer will accept the software, this will quite literally fit into acceptable from a customer's perspective."}]},{"block_type":"element","block":"k6bfvam0","search_text":"However, web testing isn't the only form of acceptance testing. Not all systems are web-based. If a subsystem is to be built by one team and handed off to another team that plans to build another layer on top of it, an acceptance test may be required before the second team will accept it.","text_count":289,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"However, web testing isn't the only form of acceptance testing. Not all systems are web-based. If a subsystem is to be built by one team and handed off to another team that plans to build another layer on top of it, an acceptance test may be required before the second team will accept it."}]},{"block_type":"element","block":"k6bfvam1","search_text":"For this chapter, we will dig into some recipes that involve both web and non-web application acceptance testing.","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this chapter, we will dig into some recipes that involve both web and non-web application acceptance testing."}]},{"block_type":"element","block":"k6bfvam2","search_text":"To create an e-store web application for testing, follow these steps:","text_count":69,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To create an e-store web application for testing, follow these steps:"}]},{"block_type":"element","block":"k6bfvam3","search_text":"Ensure that you have mercurial installed on your system: For macOS, use either MacPorts or Homebrew For Ubuntu/Debian, use sudo apt-get install mercurial For other systems, you will need to do extra research in installing mercurial This also requires having compilable tools installed, such as gcc : For Ubuntu, use sudo apt-get install build-essential For other systems, you will need to do extra research in installing gcc If you have other issues installing Satchmo in the following steps, visit the project site at http://www.satchmoproject.com and possibly their support group at http://groups.google.com/group/satchmo-users . Install Satchmo, an e-commerce website builder, by typing the following commands: ","text_count":714,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Ensure that you have"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mercurial"}]},{"block_type":"text","content":"installed on your system:"},{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For macOS, use either MacPorts or Homebrew"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For Ubuntu/Debian, use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sudo apt-get install mercurial"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For other systems, you will need to do extra research in installing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mercurial"}]}]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"This also requires having compilable tools installed, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"gcc"}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For Ubuntu, use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sudo apt-get install build-essential"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For other systems, you will need to do extra research in installing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"gcc"}]}]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If you have other issues installing Satchmo in the following steps, visit the project site at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.satchmoproject.com"},"children":[{"block_type":"text","content":"http://www.satchmoproject.com"}]},{"block_type":"text","content":"and possibly their support group at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://groups.google.com/group/satchmo-users"},"children":[{"block_type":"text","content":"http://groups.google.com/group/satchmo-users"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Satchmo, an e-commerce website builder, by typing the following commands:"}]}]},{"block_type":"element","block":"k6bfvam4","search_text":"pip install -r http://bitbucket.org/gturnquist/satchmo/raw/tip/scripts/requirements.txt pip install -e hg+http://bitbucket.org/gturnquist/satchmo/#egg=satchmo","text_count":158,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"pip install -r http://bitbucket.org/gturnquist/satchmo/raw/tip/scripts/requirements.txt\npip install -e hg+http://bitbucket.org/gturnquist/satchmo/#egg=satchmo"}]}]},{"block_type":"element","block":"k6bfvam5","search_text":"Install Python's PIL library for image processing with pip install PIL . ","text_count":73,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PIL"}]},{"block_type":"text","content":"library for image processing with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install PIL"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvam6","search_text":"Edit <virtualenv root>/lib/python2.6/site-packages/django/contrib/admin/templates/admin/login.html to add id=\"login\" to the Log in<input> tag. This allows Pyccuracy to grab the Log in button and click it. Run the Satchmo script to create store application: clonesatchmo.py . When prompted about creating a super-user, say yes . When prompted, enter a username . When prompted, enter an e-mail address . When prompted, enter a password . Go into store directory: cd store . Start up the store app: python manage.py runserver . ","text_count":526,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Edit"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;virtualenv root&gt;/lib/python2.6/site-packages/django/contrib/admin/templates/admin/login.html"}]},{"block_type":"text","content":"to add"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"id=\"login\""}]},{"block_type":"text","content":"to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Log in&lt;input&gt;"}]},{"block_type":"text","content":"tag. This allows Pyccuracy to grab the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Log in"}]},{"block_type":"text","content":"button and click it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the Satchmo script to create store application:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"clonesatchmo.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When prompted about creating a super-user, say"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"yes"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When prompted, enter a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"username"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"&nbsp;When prompted, enter an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"e-mail address"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When prompted, enter a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"password"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Go into store directory:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cd store"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start up the store app:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python manage.py runserver"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvam7","search_text":"Note If you have issues installing Satchmo with these steps, visit the project site at http://www.satchmoproject.com and possibly their support group at https://groups.google.com/forum/#!forum/satchmo-users . ","text_count":209,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you have issues installing Satchmo with these steps, visit the project site at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.satchmoproject.com"},"children":[{"block_type":"text","content":"http://www.satchmoproject.com"}]},{"block_type":"text","content":"and possibly their support group at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://groups.google.com/forum/#!forum/satchmo-users"},"children":[{"block_type":"text","content":"https://groups.google.com/forum/#!forum/satchmo-users"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvam8","search_text":"To create a non-web shopping cart application for testing, create cart.py with the following code:","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To create a non-web shopping cart application for testing, create"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"with the following code:"}]},{"block_type":"element","block":"k6bfvam9","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): for cart_item in self.items: # Since we found the item, we increment # instead of append if cart_item.item == item: cart_item.q += 1 return self # If we didn't find, then we append self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price * self.items[index-1].q def total(self, sales_tax): sum_price = sum([item.price*item.q for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return sum([item.q for item in self.items]) class Item(object): def __init__(self, item, price, q=1): self.item = item self.price = price self.q = q ","text_count":755,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object): \n    def __init__(self): \n        self.items = [] \n \n    def add(self, item, price): \n        for cart_item in self.items: \n            # Since we found the item, we increment \n            # instead of append \n            if cart_item.item == item: \n                cart_item.q += 1 \n                return self \n \n        # If we didn't find, then we append \n        self.items.append(Item(item, price)) \n        return self \n \n    def item(self, index): \n        return self.items[index-1].item \n \n    def price(self, index): \n        return self.items[index-1].price * self.items[index-1].q \n \n    def total(self, sales_tax): \n        sum_price = sum([item.price*item.q for item in self.items]) \n        return sum_price*(1.0 + sales_tax/100.0) \n \n    def __len__(self): \n        return sum([item.q for item in self.items]) \n \nclass Item(object): \n    def __init__(self, item, price, q=1): \n        self.item = item \n        self.price = price \n        self.q = q"}]}]},{"block_type":"element","block":"k6bfvama","search_text":"This shopping cart has the following characteristics:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This shopping cart has the following characteristics:"}]},{"block_type":"element","block":"k6bfvamb","search_text":"Is 1-based, meaning that the first item and price are at [1] not [0] Includes the ability to have multiples of the same item Will calculate total price and then add taxes ","text_count":171,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Is 1-based, meaning that the first item and price are at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[1]"}]},{"block_type":"text","content":"not"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[0]"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Includes the ability to have multiples of the same item"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Will calculate total price and then add taxes"}]}]},{"block_type":"element","block":"k6bfvamc","search_text":"This application isn't complex. Maybe it doesn't look exactly at a system level, but it does provide an easy application to write acceptance tests against.","text_count":155,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This application isn't complex. Maybe it doesn't look exactly at a system level, but it does provide an easy application to write acceptance tests against."}]},{"block_type":"element","block":"k6bfvamd","search_text":"Installing Pyccuracy","text_count":20,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Installing Pyccuracy"}]},{"block_type":"element","block":"k6bfvame","search_text":"Pyccuracy is a useful tool for writing web acceptance tests using a BDD-style language. This recipe shows all the steps needed to install it and set it up for later recipes.","text_count":173,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pyccuracy is a useful tool for writing web acceptance tests using a BDD-style language. This recipe shows all the steps needed to install it and set it up for later recipes."}]},{"block_type":"element","block":"k6bfvamf","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvamg","search_text":"With these steps, we will install Pyccuracy and all the tools needed to run the scenarios later in this chapter:","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will install Pyccuracy and all the tools needed to run the scenarios later in this chapter:"}]},{"block_type":"element","block":"k6bfvamh","search_text":"Install Pyccuracy by typing pip install pyccuracy . Download selenium-server.jar from http://github.com/heynemann/pyccuracy/raw/master/lib/selenium-server.jar . Start it up by typing java -jar selenium-server.jar . Note that if you don't have Java installed, you definitely need to download and install it as well. Install lxml by typing pip install lxml . ","text_count":357,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Pyccuracy"}]},{"block_type":"text","content":"by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install pyccuracy"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Download"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"selenium-server.jar"}]},{"block_type":"text","content":"from"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://github.com/heynemann/pyccuracy/raw/master/lib/selenium-server.jar"},"children":[{"block_type":"text","content":"http://github.com/heynemann/pyccuracy/raw/master/lib/selenium-server.jar"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start it up by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"java -jar selenium-server.jar"}]},{"block_type":"text","content":". Note that if you don't have Java installed, you definitely need to download and install it as well."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lxml"}]},{"block_type":"text","content":"by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install lxml"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvami","search_text":"Create a simple test file called recipe35.acc and enter the following code: ","text_count":76,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a simple test file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe35.acc"}]},{"block_type":"text","content":"and enter the following code:"}]}]},{"block_type":"element","block":"k6bfvamj","search_text":"As a Yahoo User I want to search Yahoo So that I can test my installation of Pyccuracy Scenario 1 - Searching for Python Testing Cookbook Given I go to \"http://yahoo.com\" When I fill \"p\" textbox with \"Python Testing Cookbook\" And I click \"search-submit\" button and wait Then I see \"Python Testing Cookbook - Yahoo! Search Results\" title","text_count":336,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"As a Yahoo User\nI want to search Yahoo\nSo that I can test my installation of Pyccuracy\n\nScenario 1 - Searching for Python Testing Cookbook\nGiven\n    I go to \"http://yahoo.com\"\nWhen\n    I fill \"p\" textbox with \"Python Testing Cookbook\"\n    And I click \"search-submit\" button and wait\nThen\n    I see \"Python Testing Cookbook - Yahoo! Search Results\" title"}]}]},{"block_type":"element","block":"k6bfvamk","search_text":"Run it by typing pyccuracy_console -p test.acc . The following screenshot shows it being run with Firefox (default for this system): ","text_count":133,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run it by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console -p test.acc"}]},{"block_type":"text","content":". The following screenshot shows it being run with Firefox (default for this system):"}]}]},{"block_type":"element","block":"k6bfvaml","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000043.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvamm","search_text":"Run it again, using a different web browser such as Safari, by typing pyccuracy_console -p test.acc -b safari : ","text_count":112,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run it again, using a different web browser such as Safari, by typing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console -p test.acc -b safari"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvamn","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000033.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvamo","search_text":"Note At the time of writing, Selenium supports Firefox, Safari, Opera, and IE 7+, but not Chrome. ","text_count":98,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At the time of writing,&nbsp;Selenium&nbsp;supports Firefox, Safari, Opera, and IE 7+, but not Chrome."}]}]},{"block_type":"element","block":"k6bfvamp","search_text":"In the folder where we ran the test, there should now be a report.html file. Open it up using a browser to view the results. Then, click on Expand All: ","text_count":152,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the folder where we ran the test, there should now be a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":"file. Open it up using a browser to view the results. Then, click on Expand All:"}]}]},{"block_type":"element","block":"k6bfvamq","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000022.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvamr","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","block":"k6bfvams","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvamt","search_text":"Pyccuracy uses Selenium, a popular browser-driving application tester to run its scenarios. Pyccuracy provides an out-of-the-box Domain Specific Language ( DSL ) to write tests. The DSL provides the means to send commands to a test browser and also check the results, verifying web application behavior.","text_count":303,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pyccuracy uses Selenium, a popular browser-driving application tester to run its scenarios. Pyccuracy provides an out-of-the-box"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Domain Specific Language"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DSL"}]},{"block_type":"text","content":") to write tests. The DSL provides the means to send commands to a test browser and also check the results, verifying web application behavior."}]},{"block_type":"element","block":"k6bfvamu","search_text":"Later on in this chapter, there are several recipes that show more details of Pyccuracy.","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Later on in this chapter, there are several recipes that show more details of Pyccuracy."}]},{"block_type":"element","block":"k6bfvamv","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvamw","search_text":"Testing the basics with Pyccuracy Using Pyccuracy to verify web app security ","text_count":77,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing the basics with Pyccuracy"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Pyccuracy to verify web app security"}]}]}]},{"block_type":"element","block":"k6bfvamx","search_text":"Testing the basics with Pyccuracy","text_count":33,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing the basics with Pyccuracy"}]},{"block_type":"element","block":"k6bfvamy","search_text":"Pyccuracy provides an easy-to-read set of operations to drive the frontend of a web application. This recipe shows how to use it to drive a shopping cart application and verify application functionality.","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pyccuracy provides an easy-to-read set of operations to drive the frontend of a web application. This recipe shows how to use it to drive a shopping cart application and verify application functionality."}]},{"block_type":"element","block":"k6bfvamz","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvan0","search_text":"If it isn't already running, start up the Selenium server in another shell or window by typing java -jar selenium-server.jar : ","text_count":127,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If it isn't already running, start up the Selenium server in another shell or window by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"java -jar selenium-server.jar"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvan1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000012.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvan2","search_text":"If the Satchmo store application isn't already running, start it up in another shell or window by typing python manage.py runserver. ","text_count":133,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If the Satchmo store application isn't already running, start it up in another shell or window by typing python manage.py runserver."}]}]},{"block_type":"element","block":"k6bfvan3","search_text":"Note This must run inside the virtualenv environment. ","text_count":54,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This must run inside the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"environment."}]}]},{"block_type":"element","block":"k6bfvan4","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvan5","search_text":"With these steps, we will explore the basics of writing a Pyccuracy test:","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore the basics of writing a Pyccuracy test:"}]},{"block_type":"element","block":"k6bfvan6","search_text":"Create a new file called recipe36.acc . Create a story for loading items into the shopping cart: ","text_count":97,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe36.acc"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a story for loading items into the shopping cart:"}]}]},{"block_type":"element","block":"k6bfvan7","search_text":"As a store customer I want to put things into my cart So that I can verify the store's functionality.","text_count":101,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"As a store customer\nI want to put things into my cart\nSo that I can verify the store's functionality."}]}]},{"block_type":"element","block":"k6bfvan8","search_text":"Add a scenario where the empty cart is looked at in detail, with a confirmed balance of $0.00 : ","text_count":96,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a scenario where the empty cart is looked at in detail, with a confirmed balance of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"$0.00"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvan9","search_text":"Scenario 1 - Inspect empty cart in detail Given I go to \"http://localhost:8000\" When I click \"Cart\" link and wait Then I see that current page contains \"Your cart is empty\" And I see that current page contains \"0 - $0.00\"","text_count":221,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario 1 - Inspect empty cart in detail\nGiven\nI go to \"http://localhost:8000\"\nWhen\nI click \"Cart\" link and wait\nThen\nI see that current page contains \"Your cart is empty\"\nAnd I see that current page contains \"0 - $0.00\""}]}]},{"block_type":"element","block":"k6bfvana","search_text":"Add another scenario where a book is selected and two of them are added to the cart: ","text_count":85,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add another scenario where a book is selected and two of them are added to the cart:"}]}]},{"block_type":"element","block":"k6bfvanb","search_text":"Scenario 2 - Load up a cart with 2 of the same Given I go to \"http://localhost:8000\" When I click \"Science Fiction\" link And I click \"Robots Attack!\" link and wait And I fill \"quantity\" textbox with \"2\" And I click \"addcart\" button and wait And I click \"Cart\" link and wait Then I see that current page contains \"Robots Attack!\" And I see \"quantity\" textbox contains \"2\" And I see that current page contains \"<td align=\"center\">$7.99</td>\" And I see that current page contains \"<td align=\"center\">$15.98</td>\" And I see that current page contains \"<td>$15.98</td>\"","text_count":564,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario 2 - Load up a cart with 2 of the same\nGiven\nI go to \"http://localhost:8000\"\nWhen\nI click \"Science Fiction\" link\nAnd I click \"Robots Attack!\" link and wait\nAnd I fill \"quantity\" textbox with \"2\"\nAnd I click \"addcart\" button and wait\nAnd I click \"Cart\" link and wait\nThen\nI see that current page contains \"Robots Attack!\"\nAnd I see \"quantity\" textbox contains \"2\"\nAnd I see that current page contains \"&lt;td align=\"center\"&gt;$7.99&lt;/td&gt;\"\nAnd I see that current page contains \"&lt;td align=\"center\"&gt;$15.98&lt;/td&gt;\"\nAnd I see that current page contains \"&lt;td&gt;$15.98&lt;/td&gt;\""}]}]},{"block_type":"element","block":"k6bfvanc","search_text":"Run the story by typing pyccuracy_console -p recipe36.acc : ","text_count":60,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the story by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console -p recipe36.acc"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvand","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000159.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvane","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvanf","search_text":"Pyccuracy has a lot of built-in actions based on driving the browser or reading the page. These actions are patterns used to parse the story file and generate commands sent to the Selenium server, which in turn drives the browser and then reads the results of the page.","text_count":269,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pyccuracy has a lot of built-in actions based on driving the browser or reading the page. These actions are patterns used to parse the story file and generate commands sent to the Selenium server, which in turn drives the browser and then reads the results of the page."}]},{"block_type":"element","block":"k6bfvang","search_text":"The key is picking the right text to identify the element being actioned or read.","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The key is picking the right text to identify the element being actioned or read."}]},{"block_type":"element","block":"k6bfvanh","search_text":"Note Web apps that are missing ID tags are much hard to read. ","text_count":62,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Web apps that are missing ID tags are much hard to read."}]}]},{"block_type":"element","block":"k6bfvani","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvanj","search_text":"The key is picking the right identifier and element type. With good identifiers, it is easy to do things like— I click on Cart link . Did you note the issue we had with drilling into the shopping cart table? The HTML <table> tag had no identifier, which made it impossible for us to pick. Instead, we had to look at the whole page and do a global search for some markup.","text_count":370,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The key is picking the right identifier and element type. With good identifiers, it is easy to do things like&mdash;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"I&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"click&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"on&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Cart&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"link"}]},{"block_type":"text","content":". Did you note the issue we had with drilling into the shopping cart table? The HTML"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;table&gt;"}]},{"block_type":"text","content":"tag had no identifier, which made it impossible for us to pick. Instead, we had to look at the whole page and do a global search for some markup."}]},{"block_type":"element","block":"k6bfvank","search_text":"This makes it more difficult to read the test. A good solution is to alter the web app to include an ID in the <table> tag. Then, we narrow down our acceptance criteria to just the table. With this application it was okay, but with complex web applications, it will surely be much more difficult to find the exact bit of text we are looking for without good IDs.","text_count":362,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This makes it more difficult to read the test. A good solution is to alter the web app to include an ID in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;table&gt;"}]},{"block_type":"text","content":"tag. Then, we narrow down our acceptance criteria to just the table. With this application it was okay, but with complex web applications, it will surely be much more difficult to find the exact bit of text we are looking for without good IDs."}]},{"block_type":"element","block":"k6bfvanl","search_text":"This raises an interesting question—should an application be amended to support a test? Simply put, yes. It isn't a major upheaval to add some good identifiers to key HTML elements to support testing. It didn't involve major design changes to the application. The net result was easier to read test cases and better-automated testing.","text_count":334,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This raises an interesting question&mdash;should&nbsp;an&nbsp;application&nbsp;be&nbsp;amended&nbsp;to&nbsp;support&nbsp;a&nbsp;test? Simply put, yes. It isn't a major upheaval to add some good identifiers to key HTML elements to support testing. It didn't involve major design changes to the application. The net result was easier to read test cases and better-automated testing."}]},{"block_type":"element","block":"k6bfvanm","search_text":"This begs another question—what if making the application more testable did involve major design changes? This can be viewed as a major interruption in work. Alternatively, maybe it's a strong hint that our design has components that are too tightly coupled or not cohesive enough.","text_count":281,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This begs another question&mdash;what if making the application more testable did involve major design changes?&nbsp;This can be viewed as a major interruption in work. Alternatively, maybe it's a strong hint that our design has components that are too tightly coupled or not cohesive enough."}]},{"block_type":"element","block":"k6bfvann","search_text":"In software development, coupling and cohesiveness are subjective terms that aren't very measurable. What can be said is that applications that don't lend themselves to testing are often monolithic, hard to maintain, and probably have circular dependencies, which implies that it will be much harder for us to make changes (as developers) to meet needs without impacting the entire system.","text_count":389,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In software development,"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"coupling"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"cohesiveness"}]},{"block_type":"text","content":"are subjective terms that aren't very measurable. What can be said is that applications that don't lend themselves to testing are often monolithic, hard to maintain, and probably have circular dependencies, which implies that it will be much harder for us to make changes (as developers) to meet needs without impacting the entire system."}]},{"block_type":"element","block":"k6bfvano","search_text":"Of course, all of this would be a big leap from our recipe's situation, where we simply lack an identifier for an HTML table. However, it's important to ask this question—what if we need more changes than something so small?","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Of course, all of this would be a big leap from our recipe's situation, where we simply lack an identifier for an HTML table. However, it's important to ask this question&mdash;what&nbsp;if&nbsp;we&nbsp;need&nbsp;more&nbsp;changes&nbsp;than&nbsp;something&nbsp;so&nbsp;small?"}]},{"block_type":"element","block":"k6bfvanp","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvanq","search_text":"Installing Pyccuracy","text_count":20,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing Pyccuracy"}]}]},{"block_type":"element","block":"k6bfvanr","search_text":"Using Pyccuracy to verify web app security","text_count":42,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Using Pyccuracy to verify web app security"}]},{"block_type":"element","block":"k6bfvans","search_text":"Applications often have login screens. Testing a secured web application requires us to capture the login process as a custom action. That way, we can reuse it repeatedly for as many scenarios as we need.","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Applications often have login screens. Testing a secured web application requires us to capture the login process as a custom action. That way, we can reuse it repeatedly for as many scenarios as we need."}]},{"block_type":"element","block":"k6bfvant","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvanu","search_text":"If it isn't already running, start up the Selenium server in another shell or window by typing java -jar selenium-server.jar . If the Satchmo store application isn't already running, start it up in another shell or window by typing python manage.py runserver. ","text_count":260,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If it isn't already running, start up the Selenium server in another shell or window by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"java -jar selenium-server.jar"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If the Satchmo store application isn't already running, start it up in another shell or window by typing python manage.py runserver."}]}]},{"block_type":"element","block":"k6bfvanv","search_text":"Note This must run inside the virtualenv environment. ","text_count":54,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This must run inside the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"environment."}]}]},{"block_type":"element","block":"k6bfvanw","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvanx","search_text":"With the following steps, we will exercise a web application's security and then see how to extend Pyccuracy by creating a custom action that does so:","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will exercise a web application's security and then see how to extend Pyccuracy by creating a custom action that does so:"}]},{"block_type":"element","block":"k6bfvany","search_text":"Create a new file called recipe37.acc to put this recipe's scenario into. Create a story for exercising Django's admin application: ","text_count":132,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe37.acc"}]},{"block_type":"text","content":"to put this recipe's scenario into."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a story for exercising Django's admin application:"}]}]},{"block_type":"element","block":"k6bfvanz","search_text":"As a system administrator, I want to log in to Django's admin page so that I can check the product catalog.","text_count":107,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"As a system administrator, \nI want to log in to Django's admin page \nso that I can check the product catalog."}]}]},{"block_type":"element","block":"k6bfvao0","search_text":"Add a scenario that logs in to the admin application: ","text_count":54,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a scenario that logs in to the admin application:"}]}]},{"block_type":"element","block":"k6bfvao1","search_text":"Scenario 1 - Logging in to the admin page Given I go to \"http://localhost:8000/admin\" When I fill \"username\" textbox with \"gturnquist\" And I fill \"password\" textbox with \"password\" And I click \"login\" button and wait Then I see that current page contains \"<ahref=\"product/product/\">Products</a>\"","text_count":295,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario 1 - Logging in to the admin page\nGiven\n    I go to \"http://localhost:8000/admin\"\nWhen\n    I fill \"username\" textbox with \"gturnquist\"\n    And I fill \"password\" textbox with \"password\"\n    And I click \"login\" button and wait\nThen\n    I see that current page contains \n    \"&lt;ahref=\"product/product/\"&gt;Products&lt;/a&gt;\""}]}]},{"block_type":"element","block":"k6bfvao2","search_text":"Add a scenario that inspects the product catalog, using the custom login action: ","text_count":81,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a scenario that inspects the product catalog, using the custom login action:"}]}]},{"block_type":"element","block":"k6bfvao3","search_text":"Scenario 2 - Check product catalog Given I am logged in with username \"gturnquist\" and password \"password\" When I click \"Products\" link and wait Then I see that current page contains \"robot-attack\"","text_count":197,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Scenario 2 - Check product catalog\nGiven\n    I am logged in with username \"gturnquist\" and password \"password\"\nWhen\n    I click \"Products\" link and wait\nThen\n    I see that current page contains \"robot-attack\""}]}]},{"block_type":"element","block":"k6bfvao4","search_text":"Create a matching file called recipe37.py containing a custom-defined action. Code the custom action of logging in to the admin action: ","text_count":136,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a matching file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe37.py"}]},{"block_type":"text","content":"containing a custom-defined action."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Code the custom action of logging in to the admin action:"}]}]},{"block_type":"element","block":"k6bfvao5","search_text":"from pyccuracy.actions import ActionBase from pyccuracy.errors import * class LoggedInAction(ActionBase): regex = r'(And )?I am logged in with username [\"] (?P<username>.+)[\"] and password [\"](?P<password>.+)[\"]$' def execute(self, context, username, password): self.execute_action(u'I go to \"http://localhost:8000/ admin\"', context) logged_in = False try: self.execute_action( u'And I see that current page contains \"id_username\"', context) except ActionFailedError: logged_in = True if not logged_in: self.execute_action(u'And I fill \"username\" textbox with \"%s\"' % username, context) self.execute_action(u'And I fill \"password\" textbox with \"%s\"' % password, context) self.execute_action(u'And I click \"login\" button', context)","text_count":730,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from pyccuracy.actions import ActionBase\nfrom pyccuracy.errors import *\n\nclass LoggedInAction(ActionBase):\n    regex = r'(And )?I am logged in with username [\"] (?P&lt;username&gt;.+)[\"] and password [\"](?P&lt;password&gt;.+)[\"]$'\n    def execute(self, context, username, password):\n        self.execute_action(u'I go to \"http://localhost:8000/\nadmin\"', context)\n    logged_in = False\n    try:\n        self.execute_action(\n          u'And I see that current page contains \"id_username\"', context)\n        except ActionFailedError:\n            logged_in = True\n        if not logged_in:\n            self.execute_action(u'And I fill \"username\" textbox with \"%s\"' % username, context)\n            self.execute_action(u'And I fill \"password\" textbox with \"%s\"' % password, context)\n            self.execute_action(u'And I click \"login\" button', context)"}]}]},{"block_type":"element","block":"k6bfvao6","search_text":"Run the story by typing pyccuracy_console -p recipe37.acc : ","text_count":60,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the story by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console -p recipe37.acc"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvao7","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000150.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvao8","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvao9","search_text":"The first scenario shows the simple steps needed to exercise the login screen. After having proven that the login screen works, it becomes cumbersome to repeat this procedure for more scenarios.","text_count":194,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first scenario shows the simple steps needed to exercise the login screen. After having proven that the login screen works, it becomes cumbersome to repeat this procedure for more scenarios."}]},{"block_type":"element","block":"k6bfvaoa","search_text":"To handle this, we create a custom action in Python by extending ActionBase . Custom actions require a regular expression to define the DSL text. Next, we define an execute method to include a combination of application logic and Pyccuracy steps to execute. Essentially, we can define a set of steps to automatically execute actions and dynamically handle different situations.","text_count":377,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To handle this, we create a custom action in Python by extending"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ActionBase"}]},{"block_type":"text","content":". Custom actions require a regular expression to define the DSL text. Next, we define an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"execute"}]},{"block_type":"text","content":"method to include a combination of application logic and Pyccuracy steps to execute. Essentially, we can define a set of steps to automatically execute actions and dynamically handle different situations."}]},{"block_type":"element","block":"k6bfvaob","search_text":"In our situation, we coded it to handle whether or not the user was already logged in. With this custom action, we built the second scenario and handled logging in with a single statement, allowing us to move on and test the core part of our scenario.","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In our situation, we coded it to handle whether or not the user was already logged in. With this custom action, we built the second scenario and handled logging in with a single statement, allowing us to move on and test the core part of our scenario."}]},{"block_type":"element","block":"k6bfvaoc","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvaod","search_text":"Installing Pyccuracy","text_count":20,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing Pyccuracy"}]}]},{"block_type":"element","block":"k6bfvaoe","search_text":"Installing Robot Framework","text_count":26,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Installing Robot Framework"}]},{"block_type":"element","block":"k6bfvaof","search_text":"Robot Framework is a useful framework for writing acceptance tests using the keyword approach. Keywords are shorthand commands that are provided by various libraries and can also be user defined. This easily supports BDD-style Given - When - Then keywords. It also opens the door to third-party libraries defining custom keywords to integrate with other test tools, such as Selenium. It also means that acceptance tests written using Robot Framework aren't confined to web applications.","text_count":486,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework is a useful framework for writing acceptance tests using the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"keyword"}]},{"block_type":"text","content":"approach. Keywords are shorthand commands that are provided by various libraries and can also be user defined. This easily supports BDD-style"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"keywords. It also opens the door to third-party libraries defining custom keywords to integrate with other test tools, such as Selenium. It also means that acceptance tests written using Robot Framework aren't confined to web applications."}]},{"block_type":"element","block":"k6bfvaog","search_text":"This recipe shows all the steps needed to install Robot Framework as well as the third-party Robot Framework Selenium library for use in later recipes.","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows all the steps needed to install Robot Framework as well as the third-party Robot Framework Selenium library for use in later recipes."}]},{"block_type":"element","block":"k6bfvaoh","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaoi","search_text":"Ensure that you activate your virtualenv sandbox. Install by typing easy_install robotframework . ","text_count":98,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Ensure that you activate your"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"sandbox."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"easy_install robotframework"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvaoj","search_text":"Note At the time of writing, Robot Framework was not able to be installed using pip . ","text_count":86,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At the time of writing, Robot Framework was not able to be installed using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvaok","search_text":"Using any type of window navigator, go to <virtualenvroot>/build/robotframework/doc/quickstart and open quickstart.html with your favorite browser. This is not only a guide but also a runnable test suite. Switch to your virtualenv's build directory for Robot Framework: cd<virtualenvroot>/build/robotframework/doc/quickstart . Run the Quick Start manual through pybot to verify installation with pybot quickstart.html : ","text_count":420,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using any type of window navigator, go to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;virtualenvroot&gt;/build/robotframework/doc/quickstart"}]},{"block_type":"text","content":"and open"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"quickstart.html"}]},{"block_type":"text","content":"with your favorite browser. This is not only a guide but also a runnable test suite."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Switch to your virtualenv's build directory for Robot Framework:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cd&lt;virtualenvroot&gt;/build/robotframework/doc/quickstart"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the Quick Start manual through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":"to verify installation with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot quickstart.html"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaol","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000138.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaom","search_text":"Inspect the report.html , log.html , and output.xml files generated by the test run. Install the Robot Framework Selenium library to allow integration with Selenium by first downloading http://robotframework-seleniumlibrary.googlecode.com/files/robotframework-seleniumlibrary-2.5.tar.gz . ","text_count":289,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inspect the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"log.html"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"output.xml"}]},{"block_type":"text","content":"files generated by the test run."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install the Robot Framework Selenium library to allow integration with Selenium by first downloading"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://robotframework-seleniumlibrary.googlecode.com/files/robotframework-seleniumlibrary-2.5.tar.gz"},"children":[{"block_type":"text","content":"http://robotframework-seleniumlibrary.googlecode.com/files/robotframework-seleniumlibrary-2.5.tar.gz"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvaon","search_text":"Unpack the tarball. Switch to the directory with cd robotframework-seleniumlibrary-2.5 . Install the package with python setup.py install . Switch to the demo directory with cd demo . Start up the demo web app with python run demo.py demoapp start . Start up the Selenium server with python run demo.py selenium start . Run the demo tests with pybot login_tests : ","text_count":364,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Unpack the tarball."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Switch to the directory with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cd robotframework-seleniumlibrary-2.5"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install the package with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python setup.py install"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Switch to the demo directory with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cd demo"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start up the demo web app with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python run demo.py demoapp start"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start up the Selenium server with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python run demo.py selenium start"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the demo tests with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot login_tests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaoo","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000129.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaop","search_text":"Shut down the demo web app with python run demo.py demoapp stop . Shut down the Selenium server with python run demo.py selenium stop . Inspect the report.html , log.html , output.xml , and selenium_log.txt files generated by the test run. ","text_count":240,"tag_name":"ol","attributes":{"start":"15"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Shut down the demo web app with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python run demo.py demoapp stop"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Shut down the Selenium server with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python run demo.py selenium stop"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inspect the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"log.html"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"output.xml"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"selenium_log.txt"}]},{"block_type":"text","content":"files generated by the test run."}]}]},{"block_type":"element","block":"k6bfvaoq","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvaor","search_text":"With this recipe, we have installed Robot Framework and one third-party library that integrates Robot Framework with Selenium.","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With this recipe, we have installed Robot Framework and one third-party library that integrates Robot Framework with Selenium."}]},{"block_type":"element","block":"k6bfvaos","search_text":"There are many more third-party libraries that provide enhanced functionality to Robot Framework. The options have enough potential to fill an entire book. So, we must narrow our focus to some of the core features provided by Robot Framework, including both web and non-web testing.","text_count":282,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are many more third-party libraries that provide enhanced functionality to Robot Framework. The options have enough potential to fill an entire book. So, we must narrow our focus to some of the core features provided by Robot Framework, including both web and non-web testing."}]},{"block_type":"element","block":"k6bfvaot","search_text":"Creating a data-driven test suite with Robot Framework","text_count":54,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating a data-driven test suite with Robot Framework"}]},{"block_type":"element","block":"k6bfvaou","search_text":"Robot Framework uses keywords to define tests, test steps, variables, and other testing components. Keywords are shorthand commands that are provided by various libraries and can also be custom-defined. This allows many different ways of writing and organizing tests.","text_count":267,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework uses"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"keywords"}]},{"block_type":"text","content":"to define tests, test steps, variables, and other testing components. Keywords are shorthand commands that are provided by various libraries and can also be custom-defined. This allows many different ways of writing and organizing tests."}]},{"block_type":"element","block":"k6bfvaov","search_text":"In this recipe, we'll explore how to run the same test procedure with varying inputs and outputs. These can be described as data-driven tests.","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll explore how to run the same test procedure with varying inputs and outputs. These can be described as data-driven tests."}]},{"block_type":"element","block":"k6bfvaow","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvaox","search_text":"We first need to activate our virtualenv setup For this recipe, we will use the shopping cart application Next, we need to install Robot Framework, as shown in the previous recipe ","text_count":180,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to activate our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"setup"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will use the shopping cart application"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, we need to install Robot Framework, as shown in the previous recipe"}]}]},{"block_type":"element","block":"k6bfvaoy","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaoz","search_text":"The following steps will show us how to write a simple acceptance test using HTML tables:","text_count":89,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will show us how to write a simple acceptance test using HTML tables:"}]},{"block_type":"element","block":"k6bfvap0","search_text":"Create a new file called recipe39.html to capture the tests and configurations. Add an HTML paragraph and table that contains a set of data-driven test cases, as shown in the following browser screenshot: ","text_count":205,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe39.html"}]},{"block_type":"text","content":"to capture the tests and configurations."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add an HTML paragraph and table that contains a set of data-driven test cases, as shown in the following browser screenshot:"}]}]},{"block_type":"element","block":"k6bfvap1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000120.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvap2","search_text":"Add another HTML paragraph and table defining the custom keywords Adding items to cart and Add item: ","text_count":101,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add another HTML paragraph and table defining the custom keywords Adding&nbsp;items&nbsp;to&nbsp;cart and Add&nbsp;item:"}]}]},{"block_type":"element","block":"k6bfvap3","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000109.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvap4","search_text":"Create a new file called recipe39.py to contain Python code that is wired into our custom keywords. Create an old-style Python class that implements the custom keywords needed for the scenarios: ","text_count":195,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe39.py"}]},{"block_type":"text","content":"to contain Python code that is wired into our custom keywords."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an old-style Python class that implements the custom keywords needed for the scenarios:"}]}]},{"block_type":"element","block":"k6bfvap5","search_text":"from cart import * class recipe39: def __init__(self): self.cart = ShoppingCart() def add_item_to_cart(self, description, price): self.cart.add(description, float(price)) def get_total(self, tax): return format(self.cart.total(float(tax)), \".2f\")","text_count":246,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from cart import *\n\nclass recipe39:\n    def __init__(self):\n        self.cart = ShoppingCart()\n    def add_item_to_cart(self, description, price):\n        self.cart.add(description, float(price))\n    def get_total(self, tax):\n        return format(self.cart.total(float(tax)), \".2f\")"}]}]},{"block_type":"element","block":"k6bfvap6","search_text":"Note It's important to define the class old- style . If we define it as new- style by subclassing object , Robot Framework's runner, pybot , won't find the methods and associate them with our HTML keywords. ","text_count":207,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to define the class"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"old-"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"style"}]},{"block_type":"text","content":". If we define it as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"new-"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"style"}]},{"block_type":"text","content":"by subclassing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"object"}]},{"block_type":"text","content":", Robot Framework's runner,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":", won't find the methods and associate them with our HTML keywords."}]}]},{"block_type":"element","block":"k6bfvap7","search_text":"Add a third HTML paragraph and table that loads our Python code to implement Add item to cart and Get total: ","text_count":109,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a third HTML paragraph and table that loads our Python code to implement Add&nbsp;item&nbsp;to&nbsp;cart and Get&nbsp;total:"}]}]},{"block_type":"element","block":"k6bfvap8","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000100.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvap9","search_text":"View the HTML file in your favorite browser: ","text_count":45,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"View the HTML file in your favorite browser:"}]}]},{"block_type":"element","block":"k6bfvapa","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000089.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvapb","search_text":"Run the HTML file through pybot to exercise the tests by typing pybot recipe39.html : ","text_count":86,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the HTML file through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":"to exercise the tests by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot recipe39.html"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvapc","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000081.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvapd","search_text":"You can inspect report.html and log.html using your favorite browser for more details about the results. ","text_count":105,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You can inspect"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"log.html"}]},{"block_type":"text","content":"using your favorite browser for more details about the results."}]}]},{"block_type":"element","block":"k6bfvape","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvapf","search_text":"Robot Framework uses HTML tables to define test components. The header row of the table identifies what type of component the table defines.","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework uses HTML tables to define test components. The header row of the table identifies what type of component the table defines."}]},{"block_type":"element","block":"k6bfvapg","search_text":"The first table we created was a set of test cases. Robot Framework spots this by seeing Test Case in the first cell of the header row. The rest of the header cells aren't parsed, which leaves us free to put in descriptive text. In this recipe, each of our test cases is defined with one-line. The second column has Adding items to cart on every row, which is a custom keyword defined in the second table. The rest of the columns are arguments for this custom keywords.","text_count":469,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first table we created was a set of test cases. Robot Framework spots this by seeing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test Case"}]},{"block_type":"text","content":"in the first cell of the header row. The rest of the header cells aren't parsed, which leaves us free to put in descriptive text. In this recipe, each of our test cases is defined with one-line. The second column has"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Adding items to cart"}]},{"block_type":"text","content":"on every row, which is a custom keyword defined in the second table. The rest of the columns are arguments for this custom keywords."}]},{"block_type":"element","block":"k6bfvaph","search_text":"The second table we wrote is used to define custom keywords. Robot Framework figures this out by seeing Keyword in the first cell of the header row. Our table defines two keywords:","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The second table we wrote is used to define custom keywords. Robot Framework figures this out by seeing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Keyword"}]},{"block_type":"text","content":"in the first cell of the header row. Our table defines two keywords:"}]},{"block_type":"element","block":"k6bfvapi","search_text":"Adding items to cart : The first line defines the arguments by starting with [Arguments] and six input variables: ${item1} , ${price1} , ${item2} , ${price2} , ${tax} , and ${total} The next set of lines are actions Lines two and three use another custom keyword: Add item with two arguments Line four defines a new variable, ${calculated total} , which is assigned the results of another keyword, Get total with one argument, ${tax}, that is defined in our Python module The last line uses a built-in keyword, Should Be Equal , to confirm that the output of Get total matches the original ${total} Add item : The first line defines arguments by starting with [Arguments] and two input variables: ${description} and ${price} . The second line uses another keyword, Add item to cart , that is defined in our Python module, with two named arguments: ${description} and ${price} . ","text_count":878,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Adding items to cart"}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first line defines the arguments by starting with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[Arguments]"}]},{"block_type":"text","content":"and six input variables:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${item1}"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${price1}"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${item2}"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${price2}"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${tax}"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${total}"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The next set of lines are actions"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Lines two and three use another custom keyword:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add&nbsp;item"}]},{"block_type":"text","content":"with two arguments"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Line four defines a new variable,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${calculated total}"}]},{"block_type":"text","content":", which is assigned the results of another keyword,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Get total"}]},{"block_type":"text","content":"&nbsp;with one argument,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${tax},"}]},{"block_type":"text","content":"that is defined in our Python module"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The last line uses a built-in keyword,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Should Be Equal"}]},{"block_type":"text","content":", to confirm that the output of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Get total"}]},{"block_type":"text","content":"matches the original"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${total}"}]}]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add item"}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first line defines arguments by starting with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[Arguments]"}]},{"block_type":"text","content":"and two input variables:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${description}"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${price}"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The second line uses another keyword,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add item to cart"}]},{"block_type":"text","content":", that is defined in our Python module, with two named arguments:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${description}"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${price}"}]},{"block_type":"text","content":"."}]}]}]}]},{"block_type":"element","block":"k6bfvapj","search_text":"The third table we made contains settings. This is identified by seeing Setting in the first cell of the header row. This table is used to import Python code that contains the final keywords using the built-in keyword Library .","text_count":227,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The third table we made contains settings. This is identified by seeing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Setting"}]},{"block_type":"text","content":"in the first cell of the header row. This table is used to import Python code that contains the final keywords using the built-in keyword"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Library"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvapk","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvapl","search_text":"Robot Framework maps our keywords to our Python code by a very simple convention:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework maps our keywords to our Python code by a very simple convention:"}]},{"block_type":"element","block":"k6bfvapm","search_text":"Get total ${tax} maps to get_total(self,tax) Add item to cart ${description} ${price} maps to add_item_to_cart(self, description, price) ","text_count":137,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Get total ${tax}"}]},{"block_type":"text","content":"maps to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get_total(self,tax)"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add item to cart ${description} ${price}"}]},{"block_type":"text","content":"maps to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"add_item_to_cart(self, description, price)"}]}]}]},{"block_type":"element","block":"k6bfvapn","search_text":"Note The reason we need add_item_to_cart and couldn't have just written add_item to tie in to the Add item keyword is because Robot Framework uses named arguments when connecting to Python code. Since each usage of Add item in our tables had a different variable name, we needed a separate keyword with distinct arguments. ","text_count":323,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The reason we need"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"add_item_to_cart"}]},{"block_type":"text","content":"&nbsp;and couldn't have just written"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"add_item"}]},{"block_type":"text","content":"to tie in to the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add item"}]},{"block_type":"text","content":"&nbsp;keyword is because Robot Framework uses named arguments when connecting to Python code. Since each usage of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add item"}]},{"block_type":"text","content":"in our tables had a different variable name, we needed a separate keyword with distinct arguments."}]}]},{"block_type":"element","block":"k6bfvapo","search_text":"Do I have to write HTML tables?","text_count":31,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Do I have to write HTML tables?"}]},{"block_type":"element","block":"k6bfvapp","search_text":"Robot Framework is driven by HTML tables, but it doesn't matter how the tables are generated. Many projects use tools like reStructuredText ( http://docutils.sourceforge.net/rst.html ) to write tables in a less verbose way, and then have a parser that converts it into HTML. A useful tool for converting .rst to HTML is docutils ( http://docutils.sourceforge.net/ ). It provides a convenient rst2html.py script that will convert all the .rst tables into HTML.","text_count":459,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework is driven by HTML tables, but it doesn't matter how the tables are generated. Many projects use tools like"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"reStructuredText"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docutils.sourceforge.net/rst.html"},"children":[{"block_type":"text","content":"http://docutils.sourceforge.net/rst.html"}]},{"block_type":"text","content":") to write tables in a less verbose way, and then have a parser that converts it into HTML. A useful tool for converting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"to HTML is"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"docutils"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docutils.sourceforge.net/"},"children":[{"block_type":"text","content":"http://docutils.sourceforge.net/"}]},{"block_type":"text","content":"). It provides a convenient"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"rst2html.py"}]},{"block_type":"text","content":"script that will convert all the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"tables into HTML."}]},{"block_type":"element","block":"k6bfvapq","search_text":"Unfortunately, the format of this book makes it hard to present .rst as either code or with a screenshot.","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unfortunately, the format of this book makes it hard to present"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"as either code or with a screenshot."}]},{"block_type":"element","block":"k6bfvapr","search_text":"What are the best ways to write the code that implements our custom keywords?","text_count":77,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What are the best ways to write the code that implements our custom keywords?"}]},{"block_type":"element","block":"k6bfvaps","search_text":"We wrote a chunk of Python code to tie in our custom keywords with the ShoppingCart application. It is important to make this as light as possible. Why? It's because when we deploy the actual application, this bridge shouldn't be a part of it. It may be tempting to use this bridge as an opportunity to bundle things up or to transform things, but this should be avoided.","text_count":371,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We wrote a chunk of Python code to tie in our custom keywords with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":"application. It is important to make this as light as possible."},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Why?"}]},{"block_type":"text","content":"It's because when we deploy the actual application, this bridge shouldn't be a part of it. It may be tempting to use this bridge as an opportunity to bundle things up or to transform things, but this should be avoided."}]},{"block_type":"element","block":"k6bfvapt","search_text":"Instead, it is better to include these functions in the software application itself. Then, this extra functionality becomes a part of the tested, deployed software functionality.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead, it is better to include these functions in the software application itself. Then, this extra functionality becomes a part of the tested, deployed software functionality."}]},{"block_type":"element","block":"k6bfvapu","search_text":"If we don't invest too heavily in the bridging code, it helps us avoid making the software dependent on the test framework. For some reason, if we ever decided to switch to something other than Robot Framework, we wouldn't be tied into that particular tool due to having too much invested in the bridging code.","text_count":310,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If we don't invest too heavily in the bridging code, it helps us avoid making the software dependent on the test framework. For some reason, if we ever decided to switch to something other than Robot Framework, we wouldn't be tied into that particular tool due to having too much invested in the bridging code."}]},{"block_type":"element","block":"k6bfvapv","search_text":"Robot Framework variables are Unicode","text_count":37,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Robot Framework variables are Unicode"}]},{"block_type":"element","block":"k6bfvapw","search_text":"Another critical factor in making our Python code work is recognizing that the input values are Unicode strings. Since ShoppingCart is based on floating point values, we had to use Python's float(input) function to convert inputs, and format(output, \".2f\") to convert outputs.","text_count":276,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another critical factor in making our Python code work is recognizing that the input values are Unicode strings. Since"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":"is based on floating point values, we had to use Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"float(input)"}]},{"block_type":"text","content":"function to convert inputs, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"format(output, \".2f\")"}]},{"block_type":"text","content":"to convert outputs."}]},{"block_type":"element","block":"k6bfvapx","search_text":"Does this contradict the previous section where we discussed keeping this bridge as light as possible? It doesn't. By using pure, built-in Python functions that have no side effects, we aren't getting in deep, and instead are only messaging the formats to line things up. If we started manipulating containers, or converting strings to lists, and vice versa, or even defining new classes, then that would definitely be getting too heavy for this bridge.","text_count":453,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does&nbsp;this&nbsp;contradict&nbsp;the&nbsp;previous&nbsp;section&nbsp;where&nbsp;we&nbsp;discussed&nbsp;keeping&nbsp;this&nbsp;bridge&nbsp;as&nbsp;light&nbsp;as&nbsp;possible? It doesn't. By using pure, built-in Python functions that have no side effects, we aren't getting in deep, and instead are only messaging the formats to line things up. If we started manipulating containers, or converting strings to lists, and vice versa, or even defining new classes, then that would definitely be getting too heavy for this bridge."}]},{"block_type":"element","block":"k6bfvapy","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvapz","search_text":"Installing Robot Framework","text_count":26,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing Robot Framework"}]}]},{"block_type":"element","block":"k6bfvaq0","search_text":"Writing a testable story with Robot Framework","text_count":45,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story with Robot Framework"}]},{"block_type":"element","block":"k6bfvaq1","search_text":"As discussed earlier in this chapter, Robot Framework lets us use custom-defined keywords.","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As discussed earlier in this chapter, Robot Framework lets us use custom-defined keywords."}]},{"block_type":"element","block":"k6bfvaq2","search_text":"This gives us the ability to structure keywords in any style. In this recipe, we will define custom keywords that implement the BDD- Given - When - Then -style of specification.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This gives us the ability to structure keywords in any style. In this recipe, we will define custom keywords that implement the BDD-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"-style of specification."}]},{"block_type":"element","block":"k6bfvaq3","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvaq4","search_text":"We first need to activate our virtualenv setup. For this recipe, we will use the shopping cart application. Next, we need to install Robot Framework, as shown in the previous sections of this chapter. ","text_count":201,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to activate our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"setup."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will use the shopping cart application."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, we need to install Robot Framework, as shown in the previous sections of this chapter."}]}]},{"block_type":"element","block":"k6bfvaq5","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaq6","search_text":"The following steps will explore how to write a BDD- Given-When-Then -style acceptance test:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will explore how to write a BDD-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given-When-Then"}]},{"block_type":"text","content":"-style acceptance test:"}]},{"block_type":"element","block":"k6bfvaq7","search_text":"Create a new file called recipe40.html to put our HTML tables. Create a story file in HTML with an opening statement: ","text_count":118,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe40.html"}]},{"block_type":"text","content":"to put our HTML tables."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a story file in HTML with an opening statement:"}]}]},{"block_type":"element","block":"k6bfvaq8","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000069.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaq9","search_text":"Add a table with several scenarios used to exercise the shopping cart application with a series of Given - When - Then keywords: ","text_count":129,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a table with several scenarios used to exercise the shopping cart application with a series of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then"}]},{"block_type":"text","content":"keywords:"}]}]},{"block_type":"element","block":"k6bfvaqa","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000088.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaqb","search_text":"Add a second table that defines all of our custom Given-When-Then custom keywords: ","text_count":83,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a second table that defines all of our custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given-When-Then"}]},{"block_type":"text","content":"custom keywords:"}]}]},{"block_type":"element","block":"k6bfvaqc","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000057.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaqd","search_text":"Create a new file called recipe40.py to put Python code that links the custom keywords to the ShoppingCart application: ","text_count":120,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe40.py"}]},{"block_type":"text","content":"to put Python code that links the custom keywords to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":"application:"}]}]},{"block_type":"element","block":"k6bfvaqe","search_text":"from cart import * class recipe40: def __init__(self): self.cart = None def create_empty_cart(self): self.cart = ShoppingCart() def lookup_item(self, index): try: return self.cart.item(int(index)) except IndexError: return \"ERROR\" def lookup_price(self, index): try: return format(self.cart.price(int(index)), \".2f\") except IndexError: return \"ERROR\" def add_item(self, description, price): self.cart.add(description, float(price)) def size_of_cart(self): return len(self.cart) def total(self, tax): return format(self.cart.total(float(tax)), \".2f\")","text_count":549,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from cart import *\nclass recipe40:\ndef __init__(self):\nself.cart = None\ndef create_empty_cart(self):\nself.cart = ShoppingCart()\ndef lookup_item(self, index):\ntry:\nreturn self.cart.item(int(index))\nexcept IndexError:\nreturn \"ERROR\"\ndef lookup_price(self, index):\ntry:\nreturn format(self.cart.price(int(index)), \".2f\")\nexcept IndexError:\nreturn \"ERROR\"\ndef add_item(self, description, price):\nself.cart.add(description, float(price))\ndef size_of_cart(self):\nreturn len(self.cart)\ndef total(self, tax):\nreturn format(self.cart.total(float(tax)), \".2f\")"}]}]},{"block_type":"element","block":"k6bfvaqf","search_text":"Note It is critical that this class is implemented old-style. If implemented new-style by extending object , Robot Framework will not link the keywords. ","text_count":153,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is critical that this class is implemented old-style. If implemented new-style by extending"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"object"}]},{"block_type":"text","content":", Robot Framework will not link the keywords."}]}]},{"block_type":"element","block":"k6bfvaqg","search_text":"Add a third table to our recipe40.html file to import our Python module: ","text_count":73,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a third table to our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe40.html"}]},{"block_type":"text","content":"file to import our Python module:"}]}]},{"block_type":"element","block":"k6bfvaqh","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000046.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaqi","search_text":"Run the story by typing pybot recipe40.html : ","text_count":46,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the story by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot recipe40.html"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvaqj","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000035.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaqk","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaql","search_text":"Robot Framework uses HTML tables to define test components. The header row of the table identifies what type of component the table defines.","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework uses HTML tables to define test components. The header row of the table identifies what type of component the table defines."}]},{"block_type":"element","block":"k6bfvaqm","search_text":"The first table we created was a set of test cases. Robot Framework spots this by seeing Test Case in the first cell of the header row. The rest of the header cells aren't parsed, which leaves us free to put in descriptive text.","text_count":228,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first table we created was a set of test cases. Robot Framework spots this by seeing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test Case"}]},{"block_type":"text","content":"in the first cell of the header row. The rest of the header cells aren't parsed, which leaves us free to put in descriptive text."}]},{"block_type":"element","block":"k6bfvaqn","search_text":"In this recipe, each of our test cases comprised several custom keywords using the Given-When-Then -style familiar to BDD testers. Many of these keywords have one or more arguments.","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, each of our test cases comprised several custom keywords using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given-When-Then"}]},{"block_type":"text","content":"-style familiar to BDD testers. Many of these keywords have one or more arguments."}]},{"block_type":"element","block":"k6bfvaqo","search_text":"The second table we wrote was used to define our custom Given-When-Then -keywords. Robot Framework figures this out by seeing Keyword in the first cell of the header row.","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The second table we wrote was used to define our custom"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given-When-Then"}]},{"block_type":"text","content":"-keywords. Robot Framework figures this out by seeing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Keyword"}]},{"block_type":"text","content":"in the first cell of the header row."}]},{"block_type":"element","block":"k6bfvaqp","search_text":"The third table we made contains settings. This is identified by seeing Setting in the first cell of the header row. This table is used to import Python code that contains the final keywords using the built-in keyword Library .","text_count":227,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The third table we made contains settings. This is identified by seeing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Setting"}]},{"block_type":"text","content":"in the first cell of the header row. This table is used to import Python code that contains the final keywords using the built-in keyword"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Library"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaqq","search_text":"An important aspect of our custom keywords, in this recipe, is that we wrote them in a natural, flowing language:","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An important aspect of our custom keywords, in this recipe, is that we wrote them in a natural, flowing language:"}]},{"block_type":"element","block":"k6bfvaqr","search_text":"When I add a carton of milk for 2.50 ","text_count":37,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"When I add a carton of milk for 2.50"}]}]},{"block_type":"element","block":"k6bfvaqs","search_text":"This is broken up into four HTML cells in order to parameterize the inputs and make the keywords reusable for several test steps:","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is broken up into four HTML cells in order to parameterize the inputs and make the keywords reusable for several test steps:"}]},{"block_type":"element","block":"k6bfvaqt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000025.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaqu","search_text":"Robot Framework sees this as a custom keyword, When I add a , with three arguments: carton of milk , for , and 2.50 .","text_count":117,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework sees this as a custom keyword,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When"}]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"I"}]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"add"}]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"text","content":", with three arguments:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"carton of milk"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"for"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"2.50"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaqv","search_text":"Later on, we fill in the actual steps involved with this keyword. In doing so, we are really only concerned with using carton of milk and 2.50 , but we still have to treat for like an input variable. We do this using a place holder variable, ${noop} , which we will simply not use in any following keyword steps.","text_count":312,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Later on, we fill in the actual steps involved with this keyword. In doing so, we are really only concerned with using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"carton of milk"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"2.50"}]},{"block_type":"text","content":", but we still have to treat"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"for"}]},{"block_type":"text","content":"like an input variable. We do this using a place holder variable,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${noop}"}]},{"block_type":"text","content":", which we will simply not use in any following keyword steps."}]},{"block_type":"element","block":"k6bfvaqw","search_text":"Note In this recipe, we call the throwaway variable, ${noop} . We could have called it anything. We can also reuse it if we have more than one throwaway argument in the same keyword. This is because Robot Framework doesn't engage in strong type checks. ","text_count":253,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we call the throwaway variable,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"${noop}"}]},{"block_type":"text","content":". We could have called it anything. We can also reuse it if we have more than one throwaway argument in the same keyword. This is because Robot Framework doesn't engage in strong type checks."}]}]},{"block_type":"element","block":"k6bfvaqx","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvaqy","search_text":"This entire chunk of HTML that we had to write starts to feel a bit heavy. As mentioned in the Creating a data - driven test suite with Robot Framework recipe, .rst is a great alternative. Unfortunately, writing this recipe using .rst is too wide for the format of this book. Refer to that recipe for more details about writing .rst and getting the tools to convert .rst to HTML.","text_count":379,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This entire chunk of HTML that we had to write starts to feel a bit heavy. As mentioned in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"driven&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"test&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"suite&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Robot Framework"}]},{"block_type":"text","content":"recipe,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"is a great alternative. Unfortunately, writing this recipe using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"is too wide for the format of this book. Refer to that recipe for more details about writing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"and getting the tools to convert"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".rst"}]},{"block_type":"text","content":"to HTML."}]},{"block_type":"element","block":"k6bfvaqz","search_text":"Given-When-Then results in duplicate rules","text_count":42,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Given-When-Then results in duplicate rules"}]},{"block_type":"element","block":"k6bfvar0","search_text":"It's true that we had to define both Then item and Add item , which are basically the same, in order to support two different test scenarios. In other BDD tools, these would have been automatically spotted as the same clause. Robot Framework doesn't directly provide a BDD domain specific language, so we had to fill this in for ourselves.","text_count":339,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's true that we had to define both"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then item"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add item"}]},{"block_type":"text","content":", which are basically the same, in order to support two different test scenarios. In other BDD tools, these would have been automatically spotted as the same clause. Robot Framework doesn't directly provide a BDD domain specific language, so we had to fill this in for ourselves."}]},{"block_type":"element","block":"k6bfvar1","search_text":"The most efficient way to handle this was to define Then item in detail with all the steps needed, and then code And item to just call Then item .","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most efficient way to handle this was to define"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then item"}]},{"block_type":"text","content":"in detail with all the steps needed, and then code"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"And item"}]},{"block_type":"text","content":"to just call"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Then item"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvar2","search_text":"In contrast, When I add a and And I add a were implemented by calling add item . Since this clause was a simpler pass-through to our Python module, it wasn't necessary to chain them together like the previous example.","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In contrast,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When I add a"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"And I add a"}]},{"block_type":"text","content":"were implemented by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"add item"}]},{"block_type":"text","content":". Since this clause was a simpler pass-through to our Python module, it wasn't necessary to chain them together like the previous example."}]},{"block_type":"element","block":"k6bfvar3","search_text":"Another option would be to investigate coding our own BDD plugin library to simplify all of this.","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another option would be to investigate coding our own BDD plugin library to simplify all of this."}]},{"block_type":"element","block":"k6bfvar4","search_text":"Do the try-except blocks violate the idea of keeping things light?","text_count":66,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Do the try-except blocks violate the idea of keeping things light?"}]},{"block_type":"element","block":"k6bfvar5","search_text":"In the Creating a data - driven test suite with Robot Framework recipe, I mentioned that the code that bridges the HTML tables with the ShoppingCart application should be kept as light as possible and avoid transformations and other manipulations.","text_count":247,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":"-"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"driven&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"test&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"suite&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"with&nbsp;Robot"}]},{"block_type":"text","content":"&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Framework"}]},{"block_type":"text","content":"recipe, I mentioned that the code that bridges the HTML tables with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ShoppingCart"}]},{"block_type":"text","content":"application should be kept as light as possible and avoid transformations and other manipulations."}]},{"block_type":"element","block":"k6bfvar6","search_text":"It is quite possible to view trapping of an expected exception and returning a string as crossing this line. In our case, the solution was to define a single clause that could handle errors and legitimate values. The clause takes whatever is returned and verifies it using the built-in Should Be Equal keyword.","text_count":310,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is quite possible to view trapping of an expected exception and returning a string as crossing this line. In our case, the solution was to define a single clause that could handle errors and legitimate values. The clause takes whatever is returned and verifies it using the built-in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Should Be Equal"}]},{"block_type":"text","content":"keyword."}]},{"block_type":"element","block":"k6bfvar7","search_text":"If this wasn't the case, it may have been smoother to not have the try-expect block, and instead use the built-in Run Keyword And Expect Error keyword linked to another custom Python keyword. However, in this situation, I think the goal of keeping things light was satisfied.","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If this wasn't the case, it may have been smoother to not have the try-expect block, and instead use the built-in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Run Keyword And Expect Error"}]},{"block_type":"text","content":"keyword linked to another custom Python keyword. However, in this situation, I think the goal of keeping things light was satisfied."}]},{"block_type":"element","block":"k6bfvar8","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvar9","search_text":"Installing the Robot Framework Creating a data-driven test suite with Robot Framework ","text_count":86,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing the Robot Framework"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a data-driven test suite with Robot Framework"}]}]}]},{"block_type":"element","block":"k6bfvara","search_text":"Tagging Robot Framework tests and running a subset","text_count":50,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Tagging Robot Framework tests and running a subset"}]},{"block_type":"element","block":"k6bfvarb","search_text":"Robot Framework provides a comprehensive way to capture test scenarios using table-driven structures. This includes the ability to add metadata in the form of tagging as well as documentation.","text_count":192,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework provides a comprehensive way to capture test scenarios using table-driven structures. This includes the ability to add metadata in the form of tagging as well as documentation."}]},{"block_type":"element","block":"k6bfvarc","search_text":"Tagging allows including or excluding tags for testing. Documentation appears on the command line and also in the outcome reports. This recipe will demonstrate both of these keen features.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Tagging allows including or excluding tags for testing. Documentation appears on the command line and also in the outcome reports. This recipe will demonstrate both of these keen features."}]},{"block_type":"element","block":"k6bfvard","search_text":"Finally, HTML tables aren't the only way to define data tables with Robot Framework. In this recipe, we will explore using double-space-separated entries. While this isn't the only non-HTML way to write stories, it is the easiest non-HTML way to demonstrate that still fits within the font size limits of this book in printed form.","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, HTML tables aren't the only way to define data tables with Robot Framework. In this recipe, we will explore using double-space-separated entries. While this isn't the only non-HTML way to write stories, it is the easiest non-HTML way to demonstrate that still fits within the font size limits of this book in printed form."}]},{"block_type":"element","block":"k6bfvare","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvarf","search_text":"We first need to activate our virtualenv setup. Create a new file called cart41.py to put an alternate version of the shopping cart application. ","text_count":145,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to activate our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"setup."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart41.py"}]},{"block_type":"text","content":"to put an alternate version of the shopping cart application."}]}]},{"block_type":"element","block":"k6bfvarg","search_text":"Type in the following code that stores the cart to a database: ","text_count":63,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Type in the following code that stores the cart to a database:"}]}]},{"block_type":"element","block":"k6bfvarh","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): for cart_item in self.items: # Since we found the item, we increment # instead of append if cart_item.item == item: cart_item.q += 1 return self # If we didn't find, then we append self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price * self.items[index-1].q def total(self, sales_tax): sum_price = sum([item.price*item.q for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def store(self): # This simulates a DB being created. f = open(\"cart.db\", \"w\") f.close() def retrieve(self, id): # This simulates a DB being read. f = open(\"cart.db\") f.close() def __len__(self): return sum([item.q for item in self.items]) class Item(object): def __init__(self, item, price, q=1): self.item = item self.price = price self.q = q","text_count":931,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object):\n    def __init__(self):\n        self.items = []\n    def add(self, item, price):\n        for cart_item in self.items:\n            # Since we found the item, we increment\n            # instead of append\n            if cart_item.item == item:\n                cart_item.q += 1\n                return self\n        # If we didn't find, then we append\n        self.items.append(Item(item, price))\n        return self\n    def item(self, index):\n        return self.items[index-1].item\n    def price(self, index):\n        return self.items[index-1].price * self.items[index-1].q\n    def total(self, sales_tax):\n        sum_price = sum([item.price*item.q for item in self.items])\n        return sum_price*(1.0 + sales_tax/100.0)\n    def store(self):\n        # This simulates a DB being created.\n        f = open(\"cart.db\", \"w\")\n        f.close()\n    def retrieve(self, id):\n        # This simulates a DB being read.\n        f = open(\"cart.db\")\n        f.close()\n    def __len__(self):\n        return sum([item.q for item in self.items])\nclass Item(object):\n    def __init__(self, item, price, q=1):\n        self.item = item\n        self.price = price\n        self.q = q"}]}]},{"block_type":"element","block":"k6bfvari","search_text":"Note This version of the shopping cart has two extra methods: store and retrieve . They don't actually talk to a database, but instead create an empty cart.db file. Why? The purpose is to simulate interaction with a database. Later in the recipe, we will show how to tag test cases that involve this operation and easily exclude them from test runs. ","text_count":350,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This version of the shopping cart has two extra methods:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"retrieve"}]},{"block_type":"text","content":". They don't actually talk to a database, but instead create an empty&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.db"}]},{"block_type":"text","content":"&nbsp;file.&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Why?"}]},{"block_type":"text","content":"The purpose is to simulate interaction with a database. Later in the recipe, we will show how to tag test cases that involve this operation and easily exclude them from test runs."}]}]},{"block_type":"element","block":"k6bfvarj","search_text":"Next, we need to install Robot Framework, as shown in the earlier sections of this chapter. ","text_count":92,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, we need to install Robot Framework, as shown in the earlier sections of this chapter."}]}]},{"block_type":"element","block":"k6bfvark","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvarl","search_text":"The following steps will show how to write scenarios in a format other than HTML tables and also how to tag tests to allow picking and choosing which tests are run on the command line:","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will show how to write scenarios in a format other than HTML tables and also how to tag tests to allow picking and choosing which tests are run on the command line:"}]},{"block_type":"element","block":"k6bfvarm","search_text":"Create a new file called recipe41.txt using plain text and space-separated entries that has a couple of test cases: a simple one and another a more complex one with documentation and tags: ","text_count":189,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe41.txt"}]},{"block_type":"text","content":"using plain text and space-separated entries that has a couple of test cases: a simple one and another a more complex one with documentation and tags:"}]}]},{"block_type":"element","block":"k6bfvarn","search_text":"***Test Cases*** Simple check of adding one item Given an empty cart When I add a carton of milk for 2.50 Then the total with 0 % tax is 2.50 And the total with 10 % tax is 2.75 More complex by storing cart to database [Documentation] This test case has special tagging, so it can be excluded. This is in case the developer doesn't have the right database system installed to interact properly.cart.db [Tags] database Given an empty cart When I add a carton of milk for 2.50 And I add a frozen pizza for 3.50 And I store the cart And I retrieve the cart Then there are 2 items","text_count":576,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Test Cases***\nSimple check of adding one item\n    Given an empty cart\n    When I add a carton of milk for 2.50\n    Then the total with 0 % tax is 2.50\n    And the total with 10 % tax is 2.75\n\nMore complex by storing cart to database\n    [Documentation] This test case has special tagging, so it can be\nexcluded. This is in case the developer doesn't have the right database\nsystem installed to interact properly.cart.db\n    [Tags] database\n    Given an empty cart\n    When I add a carton of milk for 2.50\n    And I add a frozen pizza for 3.50\n    And I store the cart\n    And I retrieve the cart\n    Then there are 2 items"}]}]},{"block_type":"element","block":"k6bfvaro","search_text":"Note It's important to note that two spaces at the minimum are required to identify breaks between one cell and the next. The line with When I add a carton of milk for 2.50 actually has four cells of information: | When I add a | carton of milk | for | 2.50 | . There is actually a fifth, empty cell that prefixes this row indicated by the two-space indentation. It is necessary to mark this row as a step in test case Simple check of adding one item rather than another test case. ","text_count":482,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to note that two spaces at the minimum are required to identify breaks between one cell and the next. The line with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"When I add a carton of milk for 2.50"}]},{"block_type":"text","content":"actually has four cells of information:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"| When I add a | carton of milk | for | 2.50 |"}]},{"block_type":"text","content":". There is actually a fifth, empty cell that prefixes this row indicated by the two-space indentation. It is necessary to mark this row as a step in test case"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Simple check of adding one item"}]},{"block_type":"text","content":"rather than another test case."}]}]},{"block_type":"element","block":"k6bfvarp","search_text":"Add a table for custom keyword definitions using plain text and space-separated values: ","text_count":88,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a table for custom keyword definitions using plain text and space-separated values:"}]}]},{"block_type":"element","block":"k6bfvarq","search_text":"***Keywords*** Given an empty cart create empty cart When I add a [Arguments] ${description} ${noop} ${price} add item ${description} ${price} And I add a [Arguments] ${description} ${noop} ${price} add item ${description} ${price} Then the total with [Arguments] ${tax} ${noop} ${total} ${calc total}= total ${tax} Should Be Equal ${calc total} ${total} And the total with [Arguments] ${tax} ${noop} ${total} Then the total with ${tax} ${noop} ${total} And I store the cart Set Test Variable ${cart id} store cart And I retrieve the cart retrieve cart ${cart id} Then there are [Arguments] ${size} ${noop} ${calc size}= Size of cart Should Be Equal As Numbers ${calc size} ${size}","text_count":681,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Keywords***\nGiven an empty cart\n    create empty cart\nWhen I add a\n    [Arguments] ${description} ${noop} ${price}\n    add item ${description} ${price}\nAnd I add a\n    [Arguments] ${description} ${noop} ${price}\n    add item ${description} ${price}\nThen the total with\n    [Arguments] ${tax} ${noop} ${total}\n    ${calc total}= total ${tax}\n    Should Be Equal ${calc total} ${total}\nAnd the total with\n    [Arguments] ${tax} ${noop} ${total}\n    Then the total with ${tax} ${noop} ${total}\nAnd I store the cart\n    Set Test Variable ${cart id} store cart\nAnd I retrieve the cart\n    retrieve cart ${cart id}\nThen there are\n    [Arguments] ${size} ${noop}\n    ${calc size}= Size of cart\n    Should Be Equal As Numbers ${calc size} ${size}"}]}]},{"block_type":"element","block":"k6bfvarr","search_text":"Create a new file called recipe41.py that contains Python code that bridges some of the keywords with the shopping cart application: ","text_count":133,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe41.py"}]},{"block_type":"text","content":"that contains Python code that bridges some of the keywords with the shopping cart application:"}]}]},{"block_type":"element","block":"k6bfvars","search_text":"from cart41 import * class recipe41: def __init__(self): self.cart = None def create_empty_cart(self): self.cart = ShoppingCart() def lookup_item(self, index): try: return self.cart.item(int(index)) except IndexError: return \"ERROR\" def lookup_price(self, index): try: return format(self.cart.price(int(index)), \".2f\") except IndexError: return \"ERROR\" def add_item(self, description, price): self.cart.add(description, float(price)) def size_of_cart(self): return len(self.cart) def total(self, tax): return format(self.cart.total(float(tax)), \".2f\") def store_cart(self): return self.cart.store() def retrieve_cart(self, id): self.cart.retrieve(id) def size_of_cart(self): return len(self.cart)","text_count":696,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from cart41 import *\n\nclass recipe41:\n    def __init__(self):\n        self.cart = None\n    def create_empty_cart(self):\n        self.cart = ShoppingCart()\n    def lookup_item(self, index):\n        try:\n            return self.cart.item(int(index))\n        except IndexError:\n            return \"ERROR\"\n    def lookup_price(self, index):\n        try:\n            return format(self.cart.price(int(index)), \".2f\")\n        except IndexError:\n            return \"ERROR\"\n    def add_item(self, description, price):\n        self.cart.add(description, float(price))\n    def size_of_cart(self):\n        return len(self.cart)\n    def total(self, tax):\n        return format(self.cart.total(float(tax)), \".2f\")\n    def store_cart(self):\n        return self.cart.store()\n    def retrieve_cart(self, id):\n        self.cart.retrieve(id)\n    def size_of_cart(self):\n        return len(self.cart)"}]}]},{"block_type":"element","block":"k6bfvart","search_text":"Add a last table to recipe41.txt that imports our Python code as a library to provide the last set of needed keywords: ","text_count":119,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a last table to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe41.txt"}]},{"block_type":"text","content":"that imports our Python code as a library to provide the last set of needed keywords:"}]}]},{"block_type":"element","block":"k6bfvaru","search_text":"***Settings**** Library recipe41.py","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Settings****\nLibrary recipe41.py"}]}]},{"block_type":"element","block":"k6bfvarv","search_text":"Run the test scenario as if we are on a machine that has database support by typing pybot recipe41.txt : ","text_count":105,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test scenario as if we are on a machine that has database support by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot recipe41.txt"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvarw","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000005.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvarx","search_text":"Run the test scenario, excluding tests that were tagged database , by typing pybot -exclude database recipe41.txt : ","text_count":116,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test scenario, excluding tests that were tagged"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"database"}]},{"block_type":"text","content":", by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot -exclude database recipe41.txt"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvary","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000004.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvarz","search_text":"Run the test scenario, including tests that were tagged database , by typing pybot -include database recipe41.txt : ","text_count":116,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test scenario, including tests that were tagged"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"database"}]},{"block_type":"text","content":", by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot -include database recipe41.txt"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvas0","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000152.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvas1","search_text":"Look at report.html , and observe where the extra [Documentation] text appears as well as our database tag: ","text_count":108,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Look at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":", and observe where the extra"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[Documentation]"}]},{"block_type":"text","content":"text appears as well as our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"database"}]},{"block_type":"text","content":"tag:"}]}]},{"block_type":"element","block":"k6bfvas2","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000141.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvas3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvas4","search_text":"In this recipe, we added an extra section to the second test case, including both documentation and a tag:","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we added an extra section to the second test case, including both documentation and a tag:"}]},{"block_type":"element","block":"k6bfvas5","search_text":"More complex by storing cart to database [Documentation] This test case has special tagging, so it can be excluded. This is in case the developer doesn't have the right database system installed to interact properly.cart.db [Tags] database Given an empty cart When I add a carton of milk for 2.50 And I add a frozen pizza for 3.50 And I store the cart And I retrieve the cart Then there are 2 items ","text_count":399,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"More complex by storing cart to database \n  [Documentation]  This test case has special tagging, so it can be excluded. This is in case the developer doesn't have the right database system installed to interact properly.cart.db \n  [Tags]  database \n  Given an empty cart \n  When I add a  carton of milk  for  2.50 \n  And I add a   frozen pizza    for  3.50 \n  And I store the cart \n  And I retrieve the cart \n  Then there are  2  items"}]}]},{"block_type":"element","block":"k6bfvas6","search_text":"Tags are usable on the command line, as shown in the previous example. It provides a useful way to organize test cases. Test cases can have as many tags as needed.","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Tags are usable on the command line, as shown in the previous example. It provides a useful way to organize test cases. Test cases can have as many tags as needed."}]},{"block_type":"element","block":"k6bfvas7","search_text":"We showed earlier that this provides a convenient command-line option to include or exclude based on tags. Tags also provide useful documentation, and the previous screenshot of report.html shows that test results are also subtotaled by tag:","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We showed earlier that this provides a convenient command-line option to include or exclude based on tags. Tags also provide useful documentation, and the previous screenshot of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":"shows that test results are also subtotaled by tag:"}]},{"block_type":"element","block":"k6bfvas8","search_text":"Tags can be used to identify different layers of testing, such as smoke, integration, and customer-facing layers Tags can also be used to mark subsystems such as databases, invoicing, customer-service, and billing ","text_count":214,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Tags can be used to identify different layers of testing, such as smoke, integration, and customer-facing layers"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Tags can also be used to mark subsystems such as databases, invoicing, customer-service, and billing"}]}]},{"block_type":"element","block":"k6bfvas9","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvasa","search_text":"This recipe demonstrates plain text formatting. Triple asterisks are used to surround header cells, and two spaces are used to designate a break between two cells.","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe demonstrates plain text formatting. Triple asterisks are used to surround header cells, and two spaces are used to designate a break between two cells."}]},{"block_type":"element","block":"k6bfvasb","search_text":"Note It is debatable as to whether this is more difficult to read than HTML. It may not be as crisp as reading the HTML markup, but I personally preferred this to angle tax of reading HTML. It's possible to add more spaces so that the table's cells are clearer, but I didn't, because the font sizes of this book don't work very well with it. ","text_count":342,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is debatable as to whether this is more difficult to read than HTML. It may not be as crisp as reading the HTML markup, but I personally preferred this to angle tax of reading HTML. It's possible to add more spaces so that the table's cells are clearer, but I didn't, because the font sizes of this book don't work very well with it."}]}]},{"block_type":"element","block":"k6bfvasc","search_text":"What about documentation?","text_count":25,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What about documentation?"}]},{"block_type":"element","block":"k6bfvasd","search_text":"We also added a little bit of documentation for demonstration purposes. A piece of the text appears when pybot runs, and it also appears in the resulting artifacts.","text_count":164,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also added a little bit of documentation for demonstration purposes. A piece of the text appears when"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":"runs, and it also appears in the resulting artifacts."}]},{"block_type":"element","block":"k6bfvase","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvasf","search_text":"Installing Robot Framework Creating a data-driven test suite with Robot Framework Writing a testable story using Robot Framework ","text_count":129,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing Robot Framework"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a data-driven test suite with Robot Framework"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story using Robot Framework"}]}]}]},{"block_type":"element","block":"k6bfvasg","search_text":"Testing web basics with Robot Framework","text_count":39,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Testing web basics with Robot Framework"}]},{"block_type":"element","block":"k6bfvash","search_text":"Web testing is a common style of acceptance testing, because the customer wants to know whether the system is acceptable, and this is a perfect way to demonstrate it.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Web testing is a common style of acceptance testing, because the customer wants to know whether the system is acceptable, and this is a perfect way to demonstrate it."}]},{"block_type":"element","block":"k6bfvasi","search_text":"In the previous recipes, we have explored writing tests against non-web applications. In this recipe, let's see how to use a third-party Robot Framework plugin to use Selenium to test a shopping cart web application.","text_count":216,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous recipes, we have explored writing tests against non-web applications. In this recipe, let's see how to use a third-party Robot Framework plugin to use Selenium to test a shopping cart web application."}]},{"block_type":"element","block":"k6bfvasj","search_text":"Getting ready...","text_count":16,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready..."}]},{"block_type":"element","block":"k6bfvask","search_text":"We first need to activate our virtualenv setup. For this recipe, we are using the Satchmo shopping cart web application. To start it, switch to the store directory and type python manage.py runserver. You can explore it by visiting http://localhost:8000. Next, install Robot Framework and the third-party Selenium plugin, as shown in the Installing Robot Framework recipe. ","text_count":373,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to activate our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"setup."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we are using the Satchmo shopping cart web application. To start it, switch to the store directory and type python manage.py runserver. You can explore it by visiting http://localhost:8000."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, install Robot Framework and the third-party Selenium plugin, as shown in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Robot&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Framework"}]},{"block_type":"text","content":"recipe."}]}]},{"block_type":"element","block":"k6bfvasl","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvasm","search_text":"With the following steps, we will see how to get going with using some of the basic Robot commands for driving a web application:","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will see how to get going with using some of the basic Robot commands for driving a web application:"}]},{"block_type":"element","block":"k6bfvasn","search_text":"Create a plain text story file called recipe42.txt , with an opening description of the story: ","text_count":95,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a plain text story file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe42.txt"}]},{"block_type":"text","content":", with an opening description of the story:"}]}]},{"block_type":"element","block":"k6bfvaso","search_text":"As a store customer I want to put things into my cart So that I can verify the store's functionality.","text_count":101,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"As a store customer\nI want to put things into my cart\nSo that I can verify the store's functionality."}]}]},{"block_type":"element","block":"k6bfvasp","search_text":"Create a section for test cases, and add a scenario that verifies that there is an empty shopping cart and captures a screenshot: ","text_count":130,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a section for test cases, and add a scenario that verifies that there is an empty shopping cart and captures a screenshot:"}]}]},{"block_type":"element","block":"k6bfvasq","search_text":"***Test Cases*** Inspect empty cart in detail Click link Cart Page Should Contain Your cart is empty Page Should Contain 0 - $0.00 Capture Page Screenshot recipe42-scenario1-1.png","text_count":179,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Test Cases***\nInspect empty cart in detail\n  Click link Cart\n  Page Should Contain Your cart is empty\n  Page Should Contain 0 - $0.00\n  Capture Page Screenshot recipe42-scenario1-1.png"}]}]},{"block_type":"element","block":"k6bfvasr","search_text":"Add another scenario that picks a book, adds two copies of the cart, and confirms the total cart value: ","text_count":104,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add another scenario that picks a book, adds two copies of the cart, and confirms the total cart value:"}]}]},{"block_type":"element","block":"k6bfvass","search_text":"Load up a cart with 2 of the same Click link Science Fiction don't wait Capture Page Screenshot recipe42-scenario2-1.png Click link Robots Attack! Capture Page Screenshot recipe42-scenario2-2.png Input text quantity 2 Capture Page Screenshot recipe42-scenario2-3.png Click button Add to cart Click link Cart Capture Page Screenshot recipe42-scenario2-4.png Textfield Value Should Be quantity 2 Page Should Contain Robots Attack! (Hard cover) Html Should Contain <td align=\"center\">$7.99</td> Html Should Contain <td align=\"center\">$15.98</td> Html Should Contain <td>$15.98</td>","text_count":578,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Load up a cart with 2 of the same\n  Click link Science Fiction don't wait\n  Capture Page Screenshot recipe42-scenario2-1.png\n  Click link Robots Attack!\n  Capture Page Screenshot recipe42-scenario2-2.png\n  Input text quantity 2\n  Capture Page Screenshot recipe42-scenario2-3.png\n  Click button Add to cart\n  Click link Cart\n  Capture Page Screenshot recipe42-scenario2-4.png\n  Textfield Value Should Be quantity 2\n  Page Should Contain Robots Attack! (Hard cover)\n  Html Should Contain &lt;td align=\"center\"&gt;$7.99&lt;/td&gt;\n  Html Should Contain &lt;td align=\"center\"&gt;$15.98&lt;/td&gt;\n  Html Should Contain &lt;td&gt;$15.98&lt;/td&gt;"}]}]},{"block_type":"element","block":"k6bfvast","search_text":"Add a section of keywords and define a keyword for inspecting the raw HTML of the page: ","text_count":88,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a section of keywords and define a keyword for inspecting the raw HTML of the page:"}]}]},{"block_type":"element","block":"k6bfvasu","search_text":"***Keywords*** Html Should Contain [Arguments] ${expected} ${html}= Get Source Should Contain ${html} ${expected} Startup Start Selenium Server Sleep 3s","text_count":152,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Keywords***\nHtml Should Contain\n    [Arguments]     ${expected}\n    ${html}= Get Source\n    Should Contain ${html} ${expected}\nStartup\n    Start Selenium Server\n    Sleep 3s"}]}]},{"block_type":"element","block":"k6bfvasv","search_text":"Note Get Source is a Selenium Library keyword that fetches the raw HTML of the entire page. Start Selenium Server is another keyword to launch the Selenium server. A built-in Sleep call is included to avoid startup/shutdown timing issues, if this test happens before or after another one Selenium-based test suite. ","text_count":315,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Get Source"}]},{"block_type":"text","content":"is a Selenium Library keyword that fetches the raw HTML of the entire page."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Start Selenium Server"}]},{"block_type":"text","content":"is another keyword to launch the Selenium server. A built-in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sleep"}]},{"block_type":"text","content":"call is included to avoid startup/shutdown timing issues, if this test happens before or after another one Selenium-based test suite."}]}]},{"block_type":"element","block":"k6bfvasw","search_text":"Add a section that imports the Selenium library and also defines a setup and teardown process for launching and shutting down the browser for each test case: ","text_count":158,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a section that imports the Selenium library and also defines a setup and teardown process for launching and shutting down the browser for each test case:"}]}]},{"block_type":"element","block":"k6bfvasx","search_text":"***Settings*** Library SeleniumLibrary Test Setup Open Browser http://localhost:8000 Test Teardown Close All Browsers Suite Setup Startup Suite Teardown Stop Selenium Server","text_count":173,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Settings***\nLibrary         SeleniumLibrary\nTest Setup      Open Browser http://localhost:8000\nTest Teardown   Close All Browsers\nSuite Setup     Startup\nSuite Teardown  Stop Selenium Server"}]}]},{"block_type":"element","block":"k6bfvasy","search_text":"Note Test Setup is a built-in keyword that defines steps executed before each test case. In this case, it uses the Selenium library keyword Open Browser to launch a browser pointed at the Satchmo application. Test Teardown is a built-in keyword that executes at the end of each test and closes the browsers launched by this test. Suite Setup is a built-in keyword that is only run before any tests are executed, and Suite Teardown is only run after all the tests in this suite. In this case, we use it to start and stop the Selenium library. ","text_count":542,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Test Setup"}]},{"block_type":"text","content":"is a built-in keyword that defines steps executed before each test case. In this case, it uses the Selenium library keyword"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Open Browser"}]},{"block_type":"text","content":"to launch a browser pointed at the Satchmo application. Test Teardown is a built-in keyword that executes at the end of each test and closes the browsers launched by this test.&nbsp;Suite Setup is a built-in keyword that is only run before any tests are executed, and Suite Teardown is only run after all the tests in this suite. In this case, we use it to start and stop the Selenium library."}]}]},{"block_type":"element","block":"k6bfvasz","search_text":"Run the test suite by typing pybot recipe42.txt : ","text_count":50,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot recipe42.txt"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvat0","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000130.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvat1","search_text":"Open log.html and observe the details, including the captured screenshots in each scenario. The following screenshot is just one of the many captured screenshots. Feel free to inspect the rest of the screenshots as well as the logs: ","text_count":233,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"log.html"}]},{"block_type":"text","content":"and observe the details, including the captured screenshots in each scenario. The following screenshot is just one of the many captured screenshots. Feel free to inspect the rest of the screenshots as well as the logs:"}]}]},{"block_type":"element","block":"k6bfvat2","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000121.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvat3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvat4","search_text":"Robot Framework provides a powerful environment to define tests through keywords. The Selenium plugin interfaces with Selenium and provides a whole set of keywords that are focused on manipulating web applications and reading and confirming their outputs.","text_count":255,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Robot Framework provides a powerful environment to define tests through keywords. The Selenium plugin interfaces with Selenium and provides a whole set of keywords that are focused on manipulating web applications and reading and confirming their outputs."}]},{"block_type":"element","block":"k6bfvat5","search_text":"An important part of web application testing is getting a hold of an element to manipulate it or test values. The most common way of doing this is by checking key attributes of the element, such as id , name , or href . For example, in our scenario, there is a button we need to click on to add the book to the cart. It can be identified by either the ID, addcart , or the displayed text, Add to cart .","text_count":402,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An important part of web application testing is getting a hold of an element to manipulate it or test values. The most common way of doing this is by checking key attributes of the element, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"id"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"name"}]},{"block_type":"text","content":", or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"href"}]},{"block_type":"text","content":". For example, in our scenario, there is a button we need to click on to add the book to the cart. It can be identified by either the ID,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"addcart"}]},{"block_type":"text","content":", or the displayed text,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Add to cart"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvat6","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvat7","search_text":"While Robot Framework is free compared to other commercial frontend test solutions, it is important to realize that the effort in writing automated tests isn't free and effortless. It takes effort to make this an active part of frontend design.","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While Robot Framework is free compared to other commercial frontend test solutions, it is important to realize that the effort in writing automated tests isn't free and effortless. It takes effort to make this an active part of frontend design."}]},{"block_type":"element","block":"k6bfvat8","search_text":"Incorporating tools like Robot and Selenium library early in the process of screen design will encourage good practices like tagging frames and elements so that they'll be testable early on. This is no different from attempting to write automated tests for a backend server system after it's already built. Both situations are much more costly, if they are introduced later. Making automated testing a part of backend systems early on encourages similar coding to support testability.","text_count":484,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Incorporating tools like Robot and Selenium library early in the process of screen design will encourage good practices like tagging frames and elements so that they'll be testable early on. This is no different from attempting to write automated tests for a backend server system after it's already built. Both situations are much more costly, if they are introduced later. Making automated testing a part of backend systems early on encourages similar coding to support testability."}]},{"block_type":"element","block":"k6bfvat9","search_text":"If we are looking at embracing acceptance testing late in our development cycle, or perhaps trying to test a system we inherited from another team, we need to include time to make changes to the web interface in order to add tags and identifiers to support writing the tests.","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If we are looking at embracing acceptance testing late in our development cycle, or perhaps trying to test a system we inherited from another team, we need to include time to make changes to the web interface in order to add tags and identifiers to support writing the tests."}]},{"block_type":"element","block":"k6bfvata","search_text":"Learn about timing configurations – they may be important!","text_count":58,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Learn about timing configurations&nbsp;&ndash; they may be important!"}]},{"block_type":"element","block":"k6bfvatb","search_text":"While the Satchmo shopping cart application didn't have any significant delays in the tests we wrote, it doesn't mean other applications won't. If your web application has certain parts that are noticeably slower, it is valuable to read the online documentation about configuring how long Selenium should wait for a response from your application.","text_count":347,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While the Satchmo shopping cart application didn't have any significant delays in the tests we wrote, it doesn't mean other applications won't. If your web application has certain parts that are noticeably slower, it is valuable to read the online documentation&nbsp;about configuring how long Selenium should wait for a response from your application."}]},{"block_type":"element","block":"k6bfvatc","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvatd","search_text":"Installing Robot Framework Creating a data-driven test suite with Robot Framework Writing a testable story using Robot Framework ","text_count":129,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing Robot Framework"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a data-driven test suite with Robot Framework"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a testable story using Robot Framework"}]}]}]},{"block_type":"element","block":"k6bfvate","search_text":"Using Robot Framework to verify web app security","text_count":48,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Using Robot Framework to verify web app security"}]},{"block_type":"element","block":"k6bfvatf","search_text":"Web applications often have some sort of security in place. This is often in the form of a login page. A well written test case should start a new browser session at the beginning and close it at the end. This results in the user logging in repeatedly for every test case.","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Web applications often have some sort of security in place. This is often in the form of a login page. A well written test case should start a new browser session at the beginning and close it at the end. This results in the user logging in repeatedly for every test case."}]},{"block_type":"element","block":"k6bfvatg","search_text":"In this recipe, we will explore writing code to log in to Satchmo's admin page, as provided by Django. Then, we will show how to capture this entire login procedure into a single keyword, allowing us to smoothly write a test that visits the product catalog without getting encumbered by logging in.","text_count":298,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will explore writing code to log in to Satchmo's admin page, as provided by Django. Then, we will show how to capture this entire login procedure into a single keyword, allowing us to smoothly write a test that visits the product catalog without getting encumbered by logging in."}]},{"block_type":"element","block":"k6bfvath","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvati","search_text":"We first need to activate our virtualenv setup. For this recipe, we are using the Satchmo shopping cart web application. To start it, switch to the store directory and type python manage.py runserver . You can explore it by visiting http://localhost:8000 . Next, install Robot Framework and the third-party Selenium plugin, as shown in the Installing Robot Framework recipe. ","text_count":375,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to activate our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"setup."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we are using the Satchmo shopping cart web application. To start it, switch to the store directory and type"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python manage.py runserver"}]},{"block_type":"text","content":". You can explore it by visiting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"http://localhost:8000"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, install Robot Framework and the third-party Selenium plugin, as shown in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Robot&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Framework"}]},{"block_type":"text","content":"recipe."}]}]},{"block_type":"element","block":"k6bfvatj","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvatk","search_text":"The following steps will highlight how to capture login steps and then encapsulate them in a single custom keyword:","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will highlight how to capture login steps and then encapsulate them in a single custom keyword:"}]},{"block_type":"element","block":"k6bfvatl","search_text":"Create a new file called recipe43.txt , and write a test story for exercising Django's admin interface: ","text_count":104,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe43.txt"}]},{"block_type":"text","content":", and write a test story for exercising Django's admin interface:"}]}]},{"block_type":"element","block":"k6bfvatm","search_text":"As a system administrator I want to login to Django's admin page So that I can check the product catalog.","text_count":105,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"As a system administrator\nI want to login to Django's admin page\nSo that I can check the product catalog."}]}]},{"block_type":"element","block":"k6bfvatn","search_text":"Add a section for test cases, and write a test case that exercises the login page: ","text_count":83,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a section for test cases, and write a test case that exercises the login page:"}]}]},{"block_type":"element","block":"k6bfvato","search_text":"***Test Cases*** Logging in to the admin page Open Browser http://localhost:8000/admin Input text username gturnquist Input text password password Submit form Page Should Contain Link Products Close All Browsers","text_count":211,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Test Cases***\nLogging in to the admin page\n  Open Browser http://localhost:8000/admin\n  Input text username gturnquist\n  Input text password password\n  Submit form\n  Page Should Contain Link Products\n  Close All Browsers"}]}]},{"block_type":"element","block":"k6bfvatp","search_text":"Add another test case that inspects the product catalog and verifies a particular row of the table: ","text_count":100,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add another test case that inspects the product catalog and verifies a particular row of the table:"}]}]},{"block_type":"element","block":"k6bfvatq","search_text":"Check product catalog Given that I am logged in Click link Products Capture Page Screenshot recipe43-scenario2-1.png Table Should Contain result_list Robots Attack! Table Row Should Contain result_list 4 Robots Attack! Table Row Should Contain result_list 4 7.99 Close All Browsers","text_count":281,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Check product catalog\n  Given that I am logged in\n  Click link Products\n  Capture Page Screenshot recipe43-scenario2-1.png\n  Table Should Contain result_list Robots Attack!\n  Table Row Should Contain result_list 4 Robots Attack!\n  Table Row Should Contain result_list 4 7.99\n  Close All Browsers"}]}]},{"block_type":"element","block":"k6bfvatr","search_text":"Create a keyword section that captures the login procedure as a single keyword: ","text_count":80,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a keyword section that captures the login procedure as a single keyword:"}]}]},{"block_type":"element","block":"k6bfvats","search_text":"***Keywords*** Given that I am logged in Open Browser http://localhost:8000/admin/ Input text username gturnquist Input text password password Submit form Startup Start Selenium Server Sleep 3s","text_count":193,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Keywords***\nGiven that I am logged in\n  Open Browser http://localhost:8000/admin/\n  Input text username gturnquist\n  Input text password password\n  Submit form\n\nStartup\n  Start Selenium Server\n  Sleep 3s"}]}]},{"block_type":"element","block":"k6bfvatt","search_text":"Note For your own testing, put in the username and password you used when installing Satchmo. The Start Selenium Server keyword is another keyword to launch the Selenium server. A built-in Sleep call is included to avoid startup/shutdown timing issues if this test happens before or after another one Selenium-based test suite. ","text_count":328,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For your own testing, put in the username and password you used when installing Satchmo. The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Start Selenium Server"}]},{"block_type":"text","content":"&nbsp;keyword is another keyword to launch the Selenium server. A built-in Sleep call is included to avoid startup/shutdown timing issues if this test happens before or after another one Selenium-based test suite."}]}]},{"block_type":"element","block":"k6bfvatu","search_text":"Finally, add a settings section that imports Selenium library and also starts and stops the Selenium server at the beginning and end of the test suite: ","text_count":152,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, add a settings section that imports Selenium library and also starts and stops the Selenium server at the beginning and end of the test suite:"}]}]},{"block_type":"element","block":"k6bfvatv","search_text":"***Settings*** Library SeleniumLibrary Suite Setup Startup Suite Teardown Stop Selenium Server","text_count":94,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"***Settings***\nLibrary SeleniumLibrary\nSuite Setup Startup\nSuite Teardown Stop Selenium Server"}]}]},{"block_type":"element","block":"k6bfvatw","search_text":"Run the test suite by typing pybot recipe43.txt : ","text_count":50,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot recipe43.txt"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvatx","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000114.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaty","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvatz","search_text":"The first test case shows how we input username and password data and then submit the form. SeleniumLibrary allows us to pick a form by name, but in the event we don't identify it, it picks the first HTML form it finds. Since there is only one form on the login page, this works fine for us.","text_count":291,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first test case shows how we input username and password data and then submit the form. SeleniumLibrary allows us to pick a form by name, but in the event we don't identify it, it picks the first HTML form it finds. Since there is only one form on the login page, this works fine for us."}]},{"block_type":"element","block":"k6bfvau0","search_text":"With the second test case, we want to navigate to the product catalog. Since it runs with a clean browser session, we are forced to deal with the login screen again. This means we need to include the same steps to log in again. For more comprehensive testing, we would probably write lots of test cases. Why should we avoid copying and pasting the same login steps for every test case? That's because it violates the Don't Repeat Yourself ( DRY ) principle. If the login page is modified, we might have to alter every instance.","text_count":527,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the second test case, we want to navigate to the product catalog. Since it runs with a clean browser session, we are forced to deal with the login screen again. This means we need to include the same steps to log in again. For more comprehensive testing, we would probably write lots of test cases."},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Why"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"should"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"we"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"avoid"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"copying"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"and"}]},{"block_type":"text","content":"pasting"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"the"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"same"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"login"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"steps"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"for"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"every"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"test"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"case?"}]},{"block_type":"text","content":"That's because it violates the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Don't Repeat Yourself"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DRY"}]},{"block_type":"text","content":") principle. If the login page is modified, we might have to alter every instance."}]},{"block_type":"element","block":"k6bfvau1","search_text":"Instead, we captured the login steps with Given that I am logged in keyword. This gives us a useful clause for many test cases, and lets us focus on the admin page.","text_count":164,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead, we captured the login steps with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given that I am logged in"}]},{"block_type":"text","content":"&nbsp;keyword. This gives us a useful clause for many test cases, and lets us focus on the admin page."}]},{"block_type":"element","block":"k6bfvau2","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvau3","search_text":"In this recipe, we used some of Selenium library's table testing operations. We verified that a particular book exists both at the table level as well as the row level. We also verified the price of the book in that row.","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we used some of Selenium library's table testing operations. We verified that a particular book exists both at the table level as well as the row level. We also verified the price of the book in that row."}]},{"block_type":"element","block":"k6bfvau4","search_text":"Finally, we captured a screenshot of the product catalog. This screenshot gives us a quick, visual glance we can use to either manually confirm the product catalog, or use to plan our next test step.","text_count":199,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we captured a screenshot of the product catalog. This screenshot gives us a quick, visual glance we can use to either manually confirm the product catalog, or use to plan our next test step."}]},{"block_type":"element","block":"k6bfvau5","search_text":"Why not use a \"remember me\" option?","text_count":35,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why not use a \"remember me\" option?"}]},{"block_type":"element","block":"k6bfvau6","search_text":"Lots of websites include a \"remember me\" checkbox in order to save login credentials in a client-side cookie. The Django admin page doesn't have one, so why is this relevant ? It's because many websites do, and we may be tempted to incorporate it into our tests to avoid logging in every time. Even if this option existed for the web app we want to test, it is not a good idea to use it. It creates a persistent state that can propagate from one test to the next. Different user accounts may have different roles, impacting what is visible. We may not know in what order test cases run and therefore have to add extra code to sniff what user we are logged in as.","text_count":662,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Lots of websites include a \"remember me\" checkbox in order to save login credentials in a client-side cookie. The Django admin page doesn't have one, so why is this relevant"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"?"}]},{"block_type":"text","content":"It's because many websites do, and we may be tempted to incorporate it into our tests to avoid logging in every time. Even if this option existed for the web app we want to test, it is not a good idea to use it. It creates a persistent state that can propagate from one test to the next. Different user accounts may have different roles, impacting what is visible. We may not know in what order test cases run and therefore have to add extra code to sniff what user we are logged in as."}]},{"block_type":"element","block":"k6bfvau7","search_text":"Instead, it is much easier and cleaner to not persist this information. Instead, explicitly logging in through a single keyword provides a clearer intent. This doesn't mean we shouldn't test and confirm the remember checkbox of our particular web application. On the contrary, we should actually test both good and bad accounts to ensure that the login screen works as expected. However, beyond that, it is best to not confuse future test cases with persisted results of the current test case.","text_count":493,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead, it is much easier and cleaner to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"persist this information. Instead, explicitly logging in through a single keyword provides a clearer intent. This doesn't mean we shouldn't test and confirm the remember checkbox of our particular web application. On the contrary, we should actually test both good and bad accounts to ensure that the login screen works as expected. However, beyond that, it is best to not confuse future test cases with persisted results of the current test case."}]},{"block_type":"element","block":"k6bfvau8","search_text":"Shouldn't we refactor the first test scenario to use the keyword?","text_count":65,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Shouldn't we refactor the first test scenario to use the keyword?"}]},{"block_type":"element","block":"k6bfvau9","search_text":"To uphold the DRY principle, we should have the login procedure in only one place inside our test story. However, for demonstration purposes, we coded it at the top, and then later copied the same code into a keyword. The best solution would be to encapsulate it into a single keyword that can be reused in either a test case or to define other custom keywords like Given I am logged in .","text_count":388,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To uphold the DRY principle, we should have the login procedure in only one place inside our test story. However, for demonstration purposes, we coded it at the top, and then later copied the same code into a keyword. The best solution would be to encapsulate it into a single keyword that can be reused in either a test case or to define other custom keywords like"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Given I am logged in"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaua","search_text":"Would arguments make the login keyword more flexible?","text_count":53,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Would arguments make the login keyword more flexible?"}]},{"block_type":"element","block":"k6bfvaub","search_text":"Absolutely—in this test story, we hardcoded the username as well as the password. However, good testing of the login page would involve a data-driven table with lots of combinations of good and bad accounts along with valid and invalid passwords. This drives the need for some sort of login keyword that would accept username and password as arguments.","text_count":352,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Absolutely&mdash;in this test story, we hardcoded the username as well as the password. However, good testing of the login page would involve a data-driven table with lots of combinations of good and bad accounts along with valid and invalid passwords. This drives the need for some sort of login keyword that would accept username and password as arguments."}]},{"block_type":"element","block":"k6bfvauc","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvaud","search_text":"Installing Robot Framework Using Pyccuracy to verify web app security Creating a data-driven test suite with Robot Framework ","text_count":125,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing Robot Framework"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Pyccuracy to verify web app security"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a data-driven test suite with Robot Framework"}]}]}]},{"block_type":"element","block":"k6bfvaue","search_text":"Creating a project-level script to verify this chapter's acceptance tests","text_count":73,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating a project-level script to verify this chapter's acceptance tests"}]},{"block_type":"element","block":"k6bfvauf","search_text":"We have used pyccuracy_console and pybot to run various test recipes. However, management of a Python project involves more than just running tests. Things like packaging, registering with the Python Project Index, and pushing to deployment sites are important procedures to manage.","text_count":282,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have used"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":"to run various test recipes. However, management of a Python project involves more than just running tests. Things like packaging, registering with the Python Project Index, and pushing to deployment sites are important procedures to manage."}]},{"block_type":"element","block":"k6bfvaug","search_text":"Building a command-line script to encapsulate all this is very convenient. With this recipe, we will run a script that runs all the tests covered in this chapter.","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Building a command-line script to encapsulate all this is very convenient. With this recipe, we will run a script that runs all the tests covered in this chapter."}]},{"block_type":"element","block":"k6bfvauh","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvaui","search_text":"We first need to activate our virtualenv setup. For this recipe, we are using the Satchmo shopping cart web application. To start it, switch to the store directory and type python manage.py runserver . You can explore it by visiting http://localhost:8000 . Next, install Robot Framework and the third-party Selenium plugin, as shown in the Installing Robot Framework recipe. This recipe assumes that all the various recipes from this chapter have been coded. ","text_count":459,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to activate our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"setup."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we are using the Satchmo shopping cart web application. To start it, switch to the store directory and type"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python manage.py runserver"}]},{"block_type":"text","content":". You can explore it by visiting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"http://localhost:8000"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, install Robot Framework and the third-party Selenium plugin, as shown in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Robot&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Framework"}]},{"block_type":"text","content":"recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"This recipe assumes that all the various recipes from this chapter have been coded."}]}]},{"block_type":"element","block":"k6bfvauj","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvauk","search_text":"With these steps, we will see how to programmatically run all the tests in this chapter:","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will see how to programmatically run all the tests in this chapter:"}]},{"block_type":"element","block":"k6bfvaul","search_text":"Create a new file called recipe44.py to contain the code for this recipe. Create a command-line script that defines several options: ","text_count":133,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe44.py"}]},{"block_type":"text","content":"to contain the code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a command-line script that defines several options:"}]}]},{"block_type":"element","block":"k6bfvaum","search_text":"import getopt import logging import os import os.path import re import sys from glob import glob def usage(): print print \"Usage: python recipe44.py [command]\" print print \"t--help\" print \"t--test\" print \"t--package\" print \"t--publish\" print \"t--register\" print try: optlist, args = getopt.getopt(sys.argv[1:], \"h\", [\"help\", \"test\", \"package\", \"publish\", \"register\"]) except getopt.GetoptError: # print help information and exit: print \"Invalid command found in %s\" % sys.argv usage() sys.exit(2)","text_count":496,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import getopt\nimport logging\nimport os\nimport os.path\nimport re\nimport sys\nfrom glob import glob\n\ndef usage():\n    print\n    print \"Usage: python recipe44.py [command]\"\n    print\n    print \"t--help\"\n    print \"t--test\"\n    print \"t--package\"\n    print \"t--publish\"\n    print \"t--register\"\n    print\ntry:\n    optlist, args = getopt.getopt(sys.argv[1:],\n            \"h\",\n            [\"help\", \"test\", \"package\", \"publish\", \"register\"])\nexcept getopt.GetoptError:\n    # print help information and exit:\n    print \"Invalid command found in %s\" % sys.argv\n    usage()\n    sys.exit(2)"}]}]},{"block_type":"element","block":"k6bfvaun","search_text":"Add a method that starts Selenium, runs the Pyccuracy-based tests, and then shuts down Selenium: ","text_count":97,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a method that starts Selenium, runs the Pyccuracy-based tests, and then shuts down Selenium:"}]}]},{"block_type":"element","block":"k6bfvauo","search_text":"def test_with_pyccuracy(): from SeleniumLibrary import start_selenium_server from SeleniumLibrary import shut_down_selenium_server from time import sleep f = open(\"recipe44_selenium_log.txt\", \"w\") start_selenium_server(logfile=f) sleep(10) import subprocess subprocess.call([\"pyccuracy_console\"]) shut_down_selenium_server() sleep(5) f.close()","text_count":343,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_with_pyccuracy():\n    from SeleniumLibrary import start_selenium_server\n    from SeleniumLibrary import shut_down_selenium_server\n    from time import sleep\n\n    f = open(\"recipe44_selenium_log.txt\", \"w\")\n    start_selenium_server(logfile=f)\n    sleep(10)\n\n    import subprocess\n    subprocess.call([\"pyccuracy_console\"])\n    shut_down_selenium_server()\n    sleep(5)\n    f.close()"}]}]},{"block_type":"element","block":"k6bfvaup","search_text":"Add a method that runs the Robot Framework tests: ","text_count":50,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a method that runs the Robot Framework tests:"}]}]},{"block_type":"element","block":"k6bfvauq","search_text":"def test_with_robot(): from robot import run run(\".\")","text_count":53,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_with_robot():\n    from robot import run\n    run(\".\")"}]}]},{"block_type":"element","block":"k6bfvaur","search_text":"Add a method to run both of these test methods: ","text_count":48,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a method to run both of these test methods:"}]}]},{"block_type":"element","block":"k6bfvaus","search_text":"def test(): test_with_pyccuracy() test_with_robot()","text_count":51,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test():\n    test_with_pyccuracy()\n    test_with_robot()"}]}]},{"block_type":"element","block":"k6bfvaut","search_text":"Add some stubbed out methods for the other project functions: ","text_count":62,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some stubbed out methods for the other project functions:"}]}]},{"block_type":"element","block":"k6bfvauu","search_text":"def package(): print \"This is where we can plug in code to run \" + \"setup.py to generate a bundle.\" def publish(): print \"This is where we can plug in code to upload \" + \"our tarball to S3 or some other download site.\" def register(): print \"setup.py has a built in function to \" + \"'register' a release to PyPI. It's \" + \"convenient to put a hook in here.\" # os.system(\"%s setup.py register\" % sys.executable)","text_count":410,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def package():\n    print \"This is where we can plug in code to run \" +\n        \"setup.py to generate a bundle.\"\ndef publish():\n    print \"This is where we can plug in code to upload \" +\n        \"our tarball to S3 or some other download site.\"\ndef register():\n    print \"setup.py has a built in function to \" +\n        \"'register' a release to PyPI. It's \" +\n        \"convenient to put a hook in here.\"\n    # os.system(\"%s setup.py register\" % sys.executable)"}]}]},{"block_type":"element","block":"k6bfvauv","search_text":"Add some code that parses the options: ","text_count":39,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that parses the options:"}]}]},{"block_type":"element","block":"k6bfvauw","search_text":"if len(optlist) == 0: usage() sys.exit(1) # Check for help requests, which cause all other # options to be ignored. for option in optlist: if option[0] in (\"--help\", \"-h\"): usage() sys.exit(1) # Parse the arguments, in order for option in optlist: if option[0] in (\"--test\"): test() if option[0] in (\"--package\"): package() if option[0] in (\"--publish\"): publish() if option[0] in (\"--register\"): register()","text_count":407,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if len(optlist) == 0:\n    usage()\n    sys.exit(1)\n# Check for help requests, which cause all other\n# options to be ignored.\nfor option in optlist:\n    if option[0] in (\"--help\", \"-h\"):\n        usage()\n        sys.exit(1)\n\n# Parse the arguments, in order\nfor option in optlist:\n    if option[0] in (\"--test\"):\n        test()\n    if option[0] in (\"--package\"):\n        package()\n    if option[0] in (\"--publish\"):\n        publish()\n    if option[0] in (\"--register\"):\n        register()"}]}]},{"block_type":"element","block":"k6bfvaux","search_text":"Run the script with the testing flag by typing python recipe44 -test . In the following screenshot, we can see that all the Pyccuracy tests passed: ","text_count":148,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script with the testing flag by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe44 -test"}]},{"block_type":"text","content":". In the following screenshot, we can see that all the Pyccuracy tests passed:"}]}]},{"block_type":"element","block":"k6bfvauy","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000102.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvauz","search_text":"In the next screenshot, we can see that the Robot Framework tests passed as well:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the next screenshot, we can see that the Robot Framework tests passed as well:"}]},{"block_type":"element","block":"k6bfvav0","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000090.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvav1","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvav2","search_text":"We use Python's getopt module to define command-line options:","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We use Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"module to define command-line options:"}]},{"block_type":"element","block":"k6bfvav3","search_text":"optlist, args = getopt.getopt(sys.argv[1:], \"h\", [\"help\", \"test\", \"package\", \"publish\", \"register\"]) ","text_count":101,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"optlist, args = getopt.getopt(sys.argv[1:], \n            \"h\", \n           [\"help\", \"test\", \"package\", \"publish\", \"register\"])"}]}]},{"block_type":"element","block":"k6bfvav4","search_text":"This maps the following:","text_count":24,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This maps the following:"}]},{"block_type":"element","block":"k6bfvav5","search_text":"\"h\" : -h \"help\" : --help \"test\" : --test \"package\" : --package \"publish\" : --publish \"register\" : --register ","text_count":109,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"h\""}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"help\""}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--help"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"test\""}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--test"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"package\""}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--package"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"publish\""}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--publish"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"register\""}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--register"}]}]}]},{"block_type":"element","block":"k6bfvav6","search_text":"We scan the list of received arguments and call the appropriate functions. For our test functions, we used Python's subprocess module to call pyccuracy_console . We could have done the same to call pybot , but Robot Framework provides a convenient API to call it directly:","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We scan the list of received arguments and call the appropriate functions. For our test functions, we used Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"subprocess"}]},{"block_type":"text","content":"module to call"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console"}]},{"block_type":"text","content":". We could have done the same to call"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":", but Robot Framework provides a convenient API to call it directly:"}]},{"block_type":"element","block":"k6bfvav7","search_text":"from robot import run run(\".\") ","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from robot import run \n    run(\".\")"}]}]},{"block_type":"element","block":"k6bfvav8","search_text":"This lets us use it inside our code.","text_count":36,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This lets us use it inside our code."}]},{"block_type":"element","block":"k6bfvav9","search_text":"There's more","text_count":12,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more"}]},{"block_type":"element","block":"k6bfvava","search_text":"To run these tests, we need Selenium running. Our Robot Framework tests are built to run Selenium on their own. Pyccuracy doesn't have such a feature, so it needed another means. In those recipes, we used java -jar selenium-server.jar . We could try to manage this, but it is easier to use Selenium library's API to start and stop Selenium.","text_count":340,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To run these tests, we need Selenium running. Our Robot Framework tests are built to run Selenium on their own. Pyccuracy doesn't have such a feature, so it needed another means. In those recipes, we used"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"java -jar selenium-server.jar"}]},{"block_type":"text","content":". We could try to manage this, but it is easier to use Selenium library's API to start and stop Selenium."}]},{"block_type":"element","block":"k6bfvavb","search_text":"This is where writing code in pure Python gives us the most options. We are able to empower Pyccuracy with parts of another library that was never intended to work with it.","text_count":172,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is where writing code in pure Python gives us the most options. We are able to empower Pyccuracy with parts of another library that was never intended to work with it."}]},{"block_type":"element","block":"k6bfvavc","search_text":"Can we only use getopt?","text_count":23,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Can we only use getopt?"}]},{"block_type":"element","block":"k6bfvavd","search_text":"Python 2.7 introduces argparse as an alternative. Current documentation has no indication that getopt is deprecated, so it's safe to use it as we have just done. The getopt module is a nice, easy-to-use command-line parser.","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python 2.7 introduces"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"as an alternative. Current documentation has no indication that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"is deprecated, so it's safe to use it as we have just done. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"module is a nice, easy-to-use command-line parser."}]},{"block_type":"element","block":"k6bfvave","search_text":"What's wrong with using the various command-line tools?","text_count":55,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What's wrong with using the various command-line tools?"}]},{"block_type":"element","block":"k6bfvavf","search_text":"There is nothing wrong with using tools like pyccuracy_console , pybot , nosetests , and many other tools that come with the Python libraries. The purpose of this recipe is to offer a convenient, alternative approach that brings all these tools into one central script. By investing a little bit of time in this script, we don't have to remember how to use all these features; instead, we can develop our script to support the development workflow of our project.","text_count":463,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is nothing wrong with using tools like"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyccuracy_console"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pybot"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":", and many other tools that come with the Python libraries. The purpose of this recipe is to offer a convenient, alternative approach that brings all these tools into one central script. By investing a little bit of time in this script, we don't have to remember how to use all these features; instead, we can develop our script to support the development workflow of our project."}]}]},{"title":"Integrating Automated Tests with Continuous Integration","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3v3","number":6,"contents":[{"block_type":"element","block":"k6bfvavg","search_text":"In this chapter, we will cover:","text_count":31,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover:"}]},{"block_type":"element","block":"k6bfvavh","search_text":"Generating a continuous integration report for Jenkins with NoseXUnit Configuring Jenkins to run Python tests upon commit Configuring Jenkins to run Python tests when scheduled Generating a continuous integration report for TeamCity using teamcity-nose Configuring TeamCity to run Python tests upon commit Configuring TeamCity to run Python tests when scheduled ","text_count":362,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating a continuous integration report for Jenkins with NoseXUnit"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests upon commit"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests when scheduled"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating a continuous integration report for TeamCity using teamcity-nose"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Configuring TeamCity to run Python tests upon commit"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Configuring TeamCity to run Python tests when scheduled"}]}]},{"block_type":"element","block":"k6bfvavi","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfvavj","search_text":"The classic software development process known as the waterfall model involves the following stages:","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The classic software development process known as the waterfall model involves the following stages:"}]},{"block_type":"element","block":"k6bfvavk","search_text":"Requirements are collected and defined Designs are drafted to satisfy the requirements An implementation strategy is written to meet the design Coding is done The coded implementation is tested The system is integrated with other systems as well as future versions of that system ","text_count":280,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Requirements are collected and defined"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Designs are drafted to satisfy the requirements"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"An implementation strategy is written to meet the design"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Coding is done"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The coded implementation is tested"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The system is integrated with other systems as well as future versions of that system"}]}]},{"block_type":"element","block":"k6bfvavl","search_text":"In the waterfall model, these steps are often spread across several months of work. What this means is that the final step of integration with external systems is done after several months and often takes a lot of effort. Continuous integration (CI) remedies the deficiencies of the waterfall model by introducing the concept of writing tests that exercise these points of integration and has them run automatically whenever the code is checked into the system. Teams that adopt CI often adopt a corresponding policy of immediately fixing the baseline if the test suite fails. This forces the team to keep their code working and integrated continuously, thus making this final step relatively cost-free. Teams that adopt a more agile approach work in much shorter cycles. Teams may work in coding sprints that may vary anywhere from the weekly to the monthly. Again, by having integrating test suites run with every check-in, the baseline is always kept functional; thus, it is ready for delivery at any time. This prevents the system from being in a nonworking state that is only brought into working state at the end of a sprint or at the end of a waterfall cycle. It opens the door to more code demonstrations for either the customer or management, in which feedback can be garnered and fed more proactively into development. This chapter is more focused on integrating automated tests with CI systems than with writing the tests. For that reason, we will reuse the following Shopping Cart application. Create a new file called cart.py and enter the following code into it:","text_count":1576,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the waterfall model, these steps are often spread across several months of work. What this means is that the final step of integration with external systems is done after several months and often takes a lot of effort.&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Continuous integration (CI)"}]},{"block_type":"text","content":"remedies the deficiencies of the waterfall model by introducing the concept of writing tests that exercise these points of integration and has them run automatically whenever the code is checked into the system. Teams that adopt CI often adopt a corresponding policy of immediately fixing the baseline if the test suite fails. This forces the team to keep their code working and integrated continuously, thus making this final step relatively cost-free. Teams that adopt a more agile approach work in much shorter cycles. Teams may work in coding sprints that may vary anywhere from the weekly to the monthly. Again, by having integrating test suites run with every check-in, the baseline is always kept functional; thus, it is ready for delivery at any time. This prevents the system from being in a nonworking state that is only brought into working state at the end of a sprint or at the end of a waterfall cycle. It opens the door to more code demonstrations for either the customer or management, in which feedback can be garnered and fed more proactively into development. This chapter is more focused on integrating automated tests with CI systems than with writing the tests. For that reason, we will reuse the following Shopping Cart application. Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cart.py"}]},{"block_type":"text","content":"and enter the following code into it:"}]},{"block_type":"element","block":"k6bfvavm","search_text":"class ShoppingCart(object): def __init__(self): self.items = [] def add(self, item, price): for cart_item in self.items: # Since we found the item, we increment # instead of append if cart_item.item == item: cart_item.q += 1 return self # If we didn't find, then we append self.items.append(Item(item, price)) return self def item(self, index): return self.items[index-1].item def price(self, index): return self.items[index-1].price * self.items[index-1].q def total(self, sales_tax): sum_price = sum([item.price*item.q for item in self.items]) return sum_price*(1.0 + sales_tax/100.0) def __len__(self): return sum([item.q for item in self.items]) class Item(object): def __init__(self, item, price, q=1): self.item = item self.price = price self.q = q ","text_count":755,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class ShoppingCart(object): \n    def __init__(self): \n        self.items = [] \n \n    def add(self, item, price): \n        for cart_item in self.items: \n            # Since we found the item, we increment \n            # instead of append \n            if cart_item.item == item: \n                cart_item.q += 1 \n                return self \n \n        # If we didn't find, then we append \n        self.items.append(Item(item, price)) \n        return self \n \n    def item(self, index): \n        return self.items[index-1].item \n \n    def price(self, index): \n        return self.items[index-1].price * self.items[index-1].q \n \n    def total(self, sales_tax): \n        sum_price = sum([item.price*item.q for item in self.items]) \n        return sum_price*(1.0 + sales_tax/100.0) \n \n    def __len__(self): \n        return sum([item.q for item in self.items]) \n \nclass Item(object): \n    def __init__(self, item, price, q=1): \n        self.item = item \n        self.price = price \n        self.q = q"}]}]},{"block_type":"element","block":"k6bfvavn","search_text":"To exercise this simple application, the following simple set of unit tests will be used by various recipes in this chapter to demonstrate CI. Create another file called tests.py and enter the following test code into it:","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To exercise this simple application, the following simple set of unit tests will be used by various recipes in this chapter to demonstrate CI. Create another file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tests.py"}]},{"block_type":"text","content":"and enter the following test code into it:"}]},{"block_type":"element","block":"k6bfvavo","search_text":"from cart import * import unittest class ShoppingCartTest(unittest.TestCase): def setUp(self): self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) def test_length(self): self.assertEquals(1, len(self.cart)) def test_item(self): self.assertEquals(\"tuna sandwich\", self.cart.item(1)) def test_price(self): self.assertEquals(15.00, self.cart.price(1)) def test_total_with_sales_tax(self): self.assertAlmostEquals(16.39, self.cart.total(9.25), 2) ","text_count":446,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from cart import * \nimport unittest \n \nclass ShoppingCartTest(unittest.TestCase): \n    def setUp(self): \n        self.cart = ShoppingCart().add(\"tuna sandwich\", 15.00) \n \n    def test_length(self): \n        self.assertEquals(1, len(self.cart)) \n \n    def test_item(self): \n        self.assertEquals(\"tuna sandwich\", self.cart.item(1)) \n \n    def test_price(self): \n        self.assertEquals(15.00, self.cart.price(1)) \n \n    def test_total_with_sales_tax(self): \n        self.assertAlmostEquals(16.39,  \n                                self.cart.total(9.25), 2)"}]}]},{"block_type":"element","block":"k6bfvavp","search_text":"This simple set of tests doesn't look very impressive, does it? In fact, it isn't really integration testing like we were talking about earlier, but instead it appears to be basic unit testing, right? Absolutely! This chapter isn't focusing on writing test code. So, if this book is about code recipes, why are we focusing on tools? Because there is more to making automated testing work with your team than writing tests. It's important to become aware of the tools that take the concepts of automating tests and leverage them into our development cycles. CI products are a valuable tool, and we need to see how to link them with our test code, in turn allowing the whole team to come on board and make testing a first-class citizen of our development process. This chapter explores two powerful CI products: Jenkins and TeamCity. ","text_count":832,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This simple set of tests doesn't look very impressive, does it? In fact, it isn't really integration testing like we were talking about earlier, but instead it appears to be basic unit testing, right? Absolutely! This chapter isn't focusing on writing test code. So, if this book is about code recipes, why are we focusing on tools? Because there is more to making automated testing work with your team than writing tests. It's important to become aware of the tools that take the concepts of automating tests and leverage them into our development cycles. CI products are a valuable tool, and we need to see how to link them with our test code, in turn allowing the whole team to come on board and make testing a first-class citizen of our development process. This chapter explores two powerful CI products: Jenkins and TeamCity.&nbsp;"}]},{"block_type":"element","block":"k6bfvavq","search_text":"Jenkins ( http://jenkins-ci.org/ ) is an open source product whose creation was led by a developer originally from Sun Microsystems, who left after Sun's acquisition by Oracle. It has a strong developer community with many people providing patches, plugins, and improvements. It was originally called Hudson , but the development community voted to rename it to avoid legal entanglements. There is more history to the entire Hudson/Jenkins naming that can be read online, but it's not relevant to the recipes in this book. TeamCity ( http://www.jetbrains.com/teamcity/ ) is a product created by JetBrains, the same company that produces commercial products such as IntelliJ IDE, ReSharper, and the PyCharm IDE. The Professional Edition is a free version that will be used in this chapter to show another CI system. It has an enterprise version, a commercial upgrade, which you can evaluate for yourself.","text_count":903,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Jenkins"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://jenkins-ci.org/"},"children":[{"block_type":"text","content":"http://jenkins-ci.org/"}]},{"block_type":"text","content":") is an open source product whose creation was led by a developer originally from Sun Microsystems, who left after Sun's acquisition by Oracle. It has a strong developer community with many people providing patches, plugins, and improvements. It was originally called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Hudson"}]},{"block_type":"text","content":", but the development community voted to rename it to avoid legal entanglements. There is more history to the entire Hudson/Jenkins naming that can be read online, but it's not relevant to the recipes in this book.&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"TeamCity"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.jetbrains.com/teamcity/"},"children":[{"block_type":"text","content":"http://www.jetbrains.com/teamcity/"}]},{"block_type":"text","content":") is a product created by JetBrains, the same company that produces commercial products such as IntelliJ IDE, ReSharper, and the PyCharm IDE. The Professional Edition is a free version that will be used in this chapter to show another CI system. It has an enterprise version, a commercial upgrade, which you can evaluate for yourself."}]},{"block_type":"element","block":"k6bfvavr","search_text":"Generating a CI report for Jenkins using NoseXUnit","text_count":50,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Generating a CI report for Jenkins using NoseXUnit"}]},{"block_type":"element","block":"k6bfvavs","search_text":"JUnit ( http://junit.org ) is a software industry leader in automated testing. It provides the ability to generate XML report files that are consumable by many tools. This extends to continuous tools like Jenkins. NoseXUnit ( http://nosexunit.sourceforge.net/ ) is a nose plugin that generates XML reports with Python test results in the same format. It works like JUnit with XML reporting but for PyUnit. Even though we aren't building Java code, there is no requirement that states our CI server can't be a Java-based system. As long as we can generate the right reports, those tools are candidates for usage. Considering that one of the most popular and well-supported CI systems is Jenkins, this type of plugin is very useful. With this recipe, we will explore generating consumable reports from simple Python testing.","text_count":822,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"JUnit"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://junit.org"},"children":[{"block_type":"text","content":"http://junit.org"}]},{"block_type":"text","content":") is a software industry leader in automated testing. It provides the ability to generate XML report files that are consumable by many tools. This extends to continuous tools like Jenkins.&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"NoseXUnit"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://nosexunit.sourceforge.net/"},"children":[{"block_type":"text","content":"http://nosexunit.sourceforge.net/"}]},{"block_type":"text","content":") is a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin that generates XML reports with Python test results in the same format. It works like JUnit with XML reporting but for PyUnit. Even though we aren't building Java code, there is no requirement that states our CI server can't be a Java-based system. As long as we can generate the right reports, those tools are candidates for usage. Considering that one of the most popular and well-supported CI systems is Jenkins, this type of plugin is very useful. With this recipe, we will explore generating consumable reports from simple Python testing."}]},{"block_type":"element","block":"k6bfvavt","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvavu","search_text":"The following steps are needed to have all the components installed for this chapter:","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps are needed to have all the components installed for this chapter:"}]},{"block_type":"element","block":"k6bfvavv","search_text":"Install nose . Install NoseXUnit ( http://nosexunit.sourceforge.net/ ) by typing pip install nosexunit ","text_count":103,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install NoseXUnit ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://nosexunit.sourceforge.net/"},"children":[{"block_type":"text","content":"http://nosexunit.sourceforge.net/"}]},{"block_type":"text","content":") by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install nosexunit"}]}]}]},{"block_type":"element","block":"k6bfvavw","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvavx","search_text":"The following steps will show how to use the NoseXUnit plugin to generate an XML report in a Jenkins-compatible format:","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will show how to use the NoseXUnit plugin to generate an XML report in a Jenkins-compatible format:"}]},{"block_type":"element","block":"k6bfvavy","search_text":"Test the shopping cart application using nosetests and the NoseXUnit plugin by typing nosetests tests.py --with-nosexunit : ","text_count":124,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Test the shopping cart application using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"and the NoseXUnit plugin by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests tests.py --with-nosexunit"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvavz","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000083.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaw0","search_text":"Open the report found in target/NoseXUnit/core/TEST-tests.xml using an XML or text editor. The following screenshot shows the report displayed in Spring Tool Suite ( http://www.springsource.com/developer/sts ), an Eclipse derivative (this is by no means a recommendation). Many modern IDEs have built-in XML support as do other editors like Emacs, TextPad, and so on: ","text_count":368,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the report found in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"target/NoseXUnit/core/TEST-tests.xml"}]},{"block_type":"text","content":"using an XML or text editor. The following screenshot shows the report displayed in Spring Tool Suite ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.springsource.com/developer/sts"},"children":[{"block_type":"text","content":"http://www.springsource.com/developer/sts"}]},{"block_type":"text","content":"), an Eclipse derivative (this is by no means a recommendation). Many modern IDEs have built-in XML support as do other editors like Emacs, TextPad, and so on:"}]}]},{"block_type":"element","block":"k6bfvaw1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000071.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaw2","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaw3","search_text":"NoseXUnit collects the outcome of each test and generates an XML report that has the same format as JUnit. The XML file isn't designed to be human-consumable, but it's not too hard to discern the results. When we ran nosetests earlier, how many test cases passed? What were the test method names? In this XML file, we can see the names of the four test cases. In fact, if this file is opened inside certain tools such as STS, it displays itself as a test outcome:","text_count":463,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"NoseXUnit collects the outcome of each test and generates an XML report that has the same format as JUnit. The XML file isn't designed to be human-consumable, but it's not too hard to discern the results. When we ran"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"earlier, how many test cases passed? What were the test method names? In this XML file, we can see the names of the four test cases. In fact, if this file is opened inside certain tools such as STS, it displays itself as a test outcome:"}]},{"block_type":"element","block":"k6bfvaw4","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000065.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaw5","search_text":"We don't have to use STS to do any of this. In fact, STS is a bit heavyweight for this simple task. Your favorite XML or text editor is fine to inspect the report. I just wanted to demonstrate how the output of this plugin works neatly with existing tools. By typing nosetests help , we can see all the options that nose has from all the installed plugins. This includes:","text_count":371,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We don't have to use STS to do any of this. In fact, STS is a bit heavyweight for this simple task. Your favorite XML or text editor is fine to inspect the report. I just wanted to demonstrate how the output of this plugin works neatly with existing tools. By typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests help"}]},{"block_type":"text","content":", we can see all the options that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"has from all the installed plugins. This includes:"}]},{"block_type":"element","block":"k6bfvaw6","search_text":"--core-target=CORE_TARGET : Output folder for test reports (defaults to target/NoseXUnit/core) --with-nosexunit : Runs it through the plugin ","text_count":141,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--core-target=CORE_TARGET"}]},{"block_type":"text","content":": Output folder for test reports (defaults to target/NoseXUnit/core)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--with-nosexunit"}]},{"block_type":"text","content":": Runs it through the plugin"}]}]},{"block_type":"element","block":"k6bfvaw7","search_text":"Configuring Jenkins to run Python tests upon commit","text_count":51,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests upon commit"}]},{"block_type":"element","block":"k6bfvaw8","search_text":"Jenkins can be configured to invoke our test suite upon commit. This is very useful, because we can gear it to track our changes. Teams that use CI systems usually adopt an attitude of addressing CI failures immediately in order to keep the baseline functional. Jenkins offers an almost unlimited number of features, such as retrieving the latest source from version control, packaging a release, running tests, and even analyzing source code. This recipe shows how to configure Jenkins to run our test suite against our Shopping Cart application.","text_count":547,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jenkins can be configured to invoke our test suite upon commit. This is very useful, because we can gear it to track our changes. Teams that use CI systems usually adopt an attitude of addressing CI failures immediately in order to keep the baseline functional. Jenkins offers an almost unlimited number of features, such as retrieving the latest source from version control, packaging a release, running tests, and even analyzing source code. This recipe shows how to configure Jenkins to run our test suite against our Shopping Cart application."}]},{"block_type":"element","block":"k6bfvaw9","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvawa","search_text":"Download Jenkins from http://mirrors.jenkins-ci.org/war/latest/jenkins.war : ","text_count":77,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Download Jenkins from"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://mirrors.jenkins-ci.org/war/latest/jenkins.war"},"children":[{"block_type":"text","content":"http://mirrors.jenkins-ci.org/war/latest/jenkins.war"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvawb","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000058.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvawc","search_text":"Start it up by running java -jar jenkins.war . It's important that no other applications are listening on port 8080 : ","text_count":118,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start it up by running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"java -jar jenkins.war"}]},{"block_type":"text","content":". It's important that no other applications are listening on port"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"8080"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvawd","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000048.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvawe","search_text":"Open the console to confirm Jenkins is working: ","text_count":48,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the console to confirm Jenkins is working:"}]}]},{"block_type":"element","block":"k6bfvawf","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000036.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvawg","search_text":"Click on Manage Jenkins. Click on Manage Plugins. Click on the Available tab. Find the Git Plugin and click the checkbox next to it. At the bottom of the page, click on the Install button. Verify that the plugin has successfully installed. Navigate back to the dashboard screen. Shut down Jenkins and start it back up again. Install Git source code control on your machine. You can visit http://git-scm.com/ to find downloadable packages. It is also possible that your system may include package installation options like MacPorts or Homebrew for Macs, yum for Red Hat-based Linux distributions, and apt-get for Debian/Ubuntu systems. ","text_count":635,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Manage Jenkins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Manage Plugins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on the Available tab."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Find the Git Plugin and click the checkbox next to it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"At the bottom of the page, click on the Install button. Verify that the plugin has successfully installed."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate back to the dashboard screen."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Shut down Jenkins and start it back up again."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Git source code control on your machine. You can visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://git-scm.com/"},"children":[{"block_type":"text","content":"http://git-scm.com/"}]},{"block_type":"text","content":"to find downloadable packages. It is also possible that your system may include package installation options like MacPorts or Homebrew for Macs,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"yum"}]},{"block_type":"text","content":"for Red Hat-based Linux distributions, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"apt-get"}]},{"block_type":"text","content":"for Debian/Ubuntu systems."}]}]},{"block_type":"element","block":"k6bfvawh","search_text":"Create an empty folder for this recipe: ","text_count":40,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an empty folder for this recipe:"}]}]},{"block_type":"element","block":"k6bfvawi","search_text":"gturnquist$ mkdir /tmp/recipe46 ","text_count":32,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ mkdir /tmp/recipe46"}]}]},{"block_type":"element","block":"k6bfvawj","search_text":"Initialize the folder for source code maintenance: ","text_count":51,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Initialize the folder for source code maintenance:"}]}]},{"block_type":"element","block":"k6bfvawk","search_text":"gturnquist$ git init /tmp/recipe46 Initialized empty Git repository in /private/tmp/recipe46/.git/ ","text_count":99,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ git init /tmp/recipe46\n    Initialized empty Git repository in /private/tmp/recipe46/.git/"}]}]},{"block_type":"element","block":"k6bfvawl","search_text":"Copy the Shopping Cart application into the folder, add it, and commit the changes: ","text_count":84,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the Shopping Cart application into the folder, add it, and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvawm","search_text":"gturnquist$ cp cart.py /tmp/recipe46/ gturnquist$ cd /tmp/recipe46/ gturnquist$ git add cart.py gturnquist$ git commit -m \"Added shopping cart application to setup this recipe.\" [master (root-commit) 057d936] Added shopping cart application to setup this recipe. 1 files changed, 35 insertions(+), 0 deletions(-) create mode 100644 cart.py ","text_count":340,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp cart.py /tmp/recipe46/\n    gturnquist$ cd /tmp/recipe46/\n    gturnquist$ git add cart.py\n    gturnquist$ git commit -m \"Added shopping cart application to setup this recipe.\"\n    [master (root-commit) 057d936] Added shopping cart application to setup this recipe.\n     1 files changed, 35 insertions(+), 0 deletions(-)\n     create mode 100644 cart.py"}]}]},{"block_type":"element","block":"k6bfvawn","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvawo","search_text":"The following steps will show how to put our code under control and then run the test suite when we make any changes and commit them:","text_count":133,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will show how to put our code under control and then run the test suite when we make any changes and commit them:"}]},{"block_type":"element","block":"k6bfvawp","search_text":"Open the Jenkins console. Click on New Job. Enter recipe46 as the Job name and pick build a free-style software project. Click on a. In the Source Code Management section, pick Git. For the URL, enter /tmp/recipe46/ . In the Build Triggers section, pick Poll SCM and enter * * * * * into the schedule box, to trigger a poll once per minute. In the Build section, select Execute shell and enter the following ad hoc script, which loads the virtualenv and runs the test suite: ","text_count":475,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the Jenkins console."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on New Job."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe46"}]},{"block_type":"text","content":"as the Job name and pick build a free-style software project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on a."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Source Code Management section, pick Git. For the&nbsp;URL, enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/tmp/recipe46/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Build Triggers section, pick Poll SCM and enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"* * * * *"}]},{"block_type":"text","content":"into the schedule box, to trigger a poll once per minute."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Build section, select Execute shell and enter the following ad hoc script, which loads the virtualenv and runs the test suite:"}]}]},{"block_type":"element","block":"k6bfvawq","search_text":". /Users/gturnquist/ptc/bin/activate nosetests tests.py -with-nosexunit ","text_count":72,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":". /Users/gturnquist/ptc/bin/activate \nnosetests tests.py -with-nosexunit"}]}]},{"block_type":"element","block":"k6bfvawr","search_text":"You need to substitute the command to activate your own virtualenv, whether this is on Windows, Linux, or macOS, and then follow it with the command used to run the tests just like we did earlier in this chapter.","text_count":212,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need to substitute the command to activate your own virtualenv, whether this is on Windows, Linux, or macOS, and then follow it with the command used to run the tests just like we did earlier in this chapter."}]},{"block_type":"element","block":"k6bfvaws","search_text":"In the Post-build Actions section, pick Publish JUnit test result report and enter target/NoseXUnit/core/*.xml , so that the test results are collected by Jenkins. Click on Save to store all the job settings. Click on Enable Auto Refresh. We should expect the first run to fail, because we haven't added any tests yet: ","text_count":319,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Post-build Actions section, pick Publish JUnit test result report and enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"target/NoseXUnit/core/*.xml"}]},{"block_type":"text","content":", so that the test results are collected by Jenkins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Save to store all the job settings."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Enable Auto Refresh. We should expect the first run to fail, because we haven't added any tests yet:"}]}]},{"block_type":"element","block":"k6bfvawt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000027.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvawu","search_text":"Copy the test suite into the controlled source folder, add it, and commit it: ","text_count":78,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the test suite into the controlled source folder, add it, and commit it:"}]}]},{"block_type":"element","block":"k6bfvawv","search_text":"gturnquist$ cp tests.py /tmp/recipe46/ gturnquist$ cd /tmp/recipe46/ gturnquist$ git add tests.py gturnquist$ git commit -m \"Added tests for the recipe.\" [master 0f6ef56] Added tests for the recipe. 1 files changed, 20 insertions(+), 0 deletions(-) create mode 100644 tests.py ","text_count":277,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp tests.py /tmp/recipe46/\n    gturnquist$ cd /tmp/recipe46/\n    gturnquist$ git add tests.py\n    gturnquist$ git commit -m \"Added tests for the recipe.\"\n    [master 0f6ef56] Added tests for the recipe.\n     1 files changed, 20 insertions(+), 0 deletions(-)\n     create mode 100644 tests.py"}]}]},{"block_type":"element","block":"k6bfvaww","search_text":"Watch to verify whether Jenkins launches a successful test run: ","text_count":64,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Watch to verify whether Jenkins launches a successful test run:"}]}]},{"block_type":"element","block":"k6bfvawx","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000018.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvawy","search_text":"Navigate to the test results page, where we can see that four of our tests were run. ","text_count":85,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate to the test results page, where we can see that four of our tests were run."}]}]},{"block_type":"element","block":"k6bfvawz","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvax0","search_text":"Jenkins provides a powerful, flexible way to configure CI jobs. In this recipe, we configured it to poll our software confirmation management system once a minute. When it detects a change, it pulls a fresh copy of the software and runs our test script. By using the NoseXUnit plugin, we generated an artifact that was easy to harvest with Jenkins. With a handful of steps, we were able to configure a web page that monitors our source code.","text_count":441,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jenkins provides a powerful, flexible way to configure CI jobs. In this recipe, we configured it to poll our software confirmation management system once a minute. When it detects a change, it pulls a fresh copy of the software and runs our test script. By using the NoseXUnit plugin, we generated an artifact that was easy to harvest with Jenkins. With a handful of steps, we were able to configure a web page that monitors our source code."}]},{"block_type":"element","block":"k6bfvax1","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvax2","search_text":"Jenkins has lots of options. If you examine the web interface, you can drill into output logs to see what actually happened. It also collects trends showing how long we have had success, when the last build failed, and more.","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jenkins has lots of options. If you examine the web interface, you can drill into output logs to see what actually happened. It also collects trends showing how long we have had success, when the last build failed, and more."}]},{"block_type":"element","block":"k6bfvax3","search_text":"Do I have to use git for source code management?","text_count":48,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Do I have to use git for source code management?"}]},{"block_type":"element","block":"k6bfvax4","search_text":"The answer is no. We used it in this recipe to show quickly how to install a Jenkins plugin from inside the web interface. To apply the plugin, we had to restart Jenkins. Subversion and CVS are supported out of the box. Jenkins also has plugins that support every major source code control system out there, so it should be easy to meet your needs. In fact, there is support for social coding sites like GitHub and BitKeeper. Instead of using the Git plugin, we could configure our Jenkins installation to watch a certain GitHub account for updates.","text_count":549,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The answer is no. We used it in this recipe to show quickly how to install a Jenkins plugin from inside the web interface. To apply the plugin, we had to restart Jenkins. Subversion and CVS are supported out of the box. Jenkins also has plugins that support every major source code control system out there, so it should be easy to meet your needs. In fact, there is support for social coding sites like GitHub and BitKeeper. Instead of using the Git plugin, we could configure our Jenkins installation to watch a certain GitHub account for updates."}]},{"block_type":"element","block":"k6bfvax5","search_text":"What is the format of polling?","text_count":30,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What is the format of polling?"}]},{"block_type":"element","block":"k6bfvax6","search_text":"We configured the polling with * * * * * , which means once a minute. This is based on the format used to configure crontab files. The columns from left to right are:","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We configured the polling with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"* * * * *"}]},{"block_type":"text","content":", which means once a minute. This is based on the format used to configure crontab files. The columns from left to right are:"}]},{"block_type":"element","block":"k6bfvax7","search_text":"MINUTE : Minutes within the hour (0-59) HOUR : The hour of the day (0-23) DOM : The day of the month (1-31) MONTH : The month (1-12) DOW: The day of the week (0-7) where 0 and 7 are Sunday ","text_count":189,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"MINUTE"}]},{"block_type":"text","content":":&nbsp;Minutes within the hour (0-59)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"HOUR"}]},{"block_type":"text","content":":&nbsp;The hour of the day (0-23)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DOM"}]},{"block_type":"text","content":":&nbsp;The day of the month (1-31)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"MONTH"}]},{"block_type":"text","content":":&nbsp;The month (1-12)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DOW:"}]},{"block_type":"text","content":"&nbsp;The day of the week (0-7) where 0 and 7 are Sunday"}]}]},{"block_type":"element","block":"k6bfvax8","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvax9","search_text":"Generating a CI report for Jenkins using NoseXUnit","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Generating a CI report for Jenkins using NoseXUnit"}]},{"block_type":"element","block":"k6bfvaxa","search_text":"Configuring Jenkins to run Python tests when scheduled","text_count":54,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests when scheduled"}]},{"block_type":"element","block":"k6bfvaxb","search_text":"We just explored how to configure Jenkins to run our test suite when we commit the code changes. Jenkins can also be configured to invoke our test suite at scheduled intervals. This is very useful, because we can gear it to make scheduled releases. Daily or weekly releases can provide potential customers with a nice release cadence. CI releases are usually understood to not necessarily be final, but instead provide bleeding-edge support in case new features need to be investigated early and integrated by the customer.","text_count":523,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We just explored how to configure Jenkins to run our test suite when we commit the code changes. Jenkins can also be configured to invoke our test suite at scheduled intervals. This is very useful, because we can gear it to make scheduled releases. Daily or weekly releases can provide potential customers with a nice release cadence. CI releases are usually understood to not necessarily be final, but instead provide bleeding-edge support in case new features need to be investigated early and integrated by the customer."}]},{"block_type":"element","block":"k6bfvaxc","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvaxd","search_text":"The following steps are used to set up Jenkins as well as a copy of our tests, so we can poll it at a scheduled interval:","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps are used to set up Jenkins as well as a copy of our tests, so we can poll it at a scheduled interval:"}]},{"block_type":"element","block":"k6bfvaxe","search_text":"Set up Jenkins as shown in the earlier recipe, Configuring Jenkins to run Python tests upon commit . This should include having set up the Git plugin. Create an empty folder for this recipe: ","text_count":191,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up Jenkins as shown in the earlier recipe,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests upon commit"}]},{"block_type":"text","content":". This should include having set up the Git plugin."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an empty folder for this recipe:"}]}]},{"block_type":"element","block":"k6bfvaxf","search_text":"gturnquist$ mkdir /tmp/recipe47 ","text_count":32,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ mkdir /tmp/recipe47"}]}]},{"block_type":"element","block":"k6bfvaxg","search_text":"Initialize the folder for source code maintenance: ","text_count":51,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Initialize the folder for source code maintenance:"}]}]},{"block_type":"element","block":"k6bfvaxh","search_text":"gturnquist$ git init /tmp/recipe47 Initialized empty Git repository in /private/tmp/recipe47/.git/ ","text_count":99,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ git init /tmp/recipe47\n    Initialized empty Git repository in /private/tmp/recipe47/.git/"}]}]},{"block_type":"element","block":"k6bfvaxi","search_text":"Copy the Shopping Cart application into the folder, add it, and commit the changes: ","text_count":84,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the Shopping Cart application into the folder, add it, and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvaxj","search_text":"gturnquist$ cp cart.py /tmp/recipe47/ gturnquist$ cd /tmp/recipe47/ gturnquist$ git add cart.py gturnquist$ git commit -m \"Added shopping cart application to setup this recipe.\" [master (root-commit) 057d936] Added shopping cart application to setup this recipe. 1 files changed, 35 insertions(+), 0 deletions(-) create mode 100644 cart.py ","text_count":340,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp cart.py /tmp/recipe47/\n    gturnquist$ cd /tmp/recipe47/\n    gturnquist$ git add cart.py\n    gturnquist$ git commit -m \"Added shopping cart application to setup this recipe.\"\n    [master (root-commit) 057d936] Added shopping cart application to setup this recipe.\n     1 files changed, 35 insertions(+), 0 deletions(-)\n     create mode 100644 cart.py"}]}]},{"block_type":"element","block":"k6bfvaxk","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaxl","search_text":"The following steps will let us explore creating a Jenkins job to run our automated test suite periodically:","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will let us explore creating a Jenkins job to run our automated test suite periodically:"}]},{"block_type":"element","block":"k6bfvaxm","search_text":"Open the Jenkins console. Click on New Job. Enter recipe47 as the Job name and pick Build a free-style software project. Click on Ok. In the Source Code Management section, pick Git. For the URL, enter /tmp/recipe47/ . In the Build Triggers section, pick Build periodically and enter some time in the future. While writing this recipe for the book, the job was created around 6:10 P.M., so entering 15 18 * * * into the schedule box schedules the job five minutes into the future at 6:15 P.M. In the Build section, select Execute shell and enter the following ad hoc script, which loads the virtualenv and runs the test suite: ","text_count":627,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the Jenkins console."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on New Job."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe47"}]},{"block_type":"text","content":"as the Job name and pick Build a free-style software project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Ok."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Source Code Management section, pick Git. For the&nbsp;URL, enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/tmp/recipe47/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Build Triggers section, pick Build periodically and enter some time in the future. While writing this recipe for the book, the job was created around 6:10 P.M., so entering"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"15 18 * * *"}]},{"block_type":"text","content":"into the schedule box schedules the job five minutes into the future at 6:15 P.M."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Build section, select Execute shell and enter the following ad hoc script, which loads the virtualenv and runs the test suite:"}]}]},{"block_type":"element","block":"k6bfvaxn","search_text":". /Users/gturnquist/ptc/bin/activatenosetests tests.py -with-nosexunit","text_count":70,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":". /Users/gturnquist/ptc/bin/activatenosetests tests.py -with-nosexunit"}]}]},{"block_type":"element","block":"k6bfvaxo","search_text":"You need to replace this with the command used to activate your virtualenv, followed by the step to run the tests.","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need to replace this with the command used to activate your virtualenv, followed by the step to run the tests."}]},{"block_type":"element","block":"k6bfvaxp","search_text":"In the Post-build Actions section, pick Publish JUnit test result report and enter target/NoseXUnit/core/*.xml , so that test results are collected by Jenkins. Click on Save to store all the job settings. Click on Enable Auto Refresh. Copy the test suite into the controlled source folder, add it, and commit it: ","text_count":313,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Post-build Actions section, pick Publish JUnit test result report and enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"target/NoseXUnit/core/*.xml"}]},{"block_type":"text","content":", so that test results are collected by Jenkins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Save to store all the job settings."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Enable Auto Refresh."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the test suite into the controlled source folder, add it, and commit it:"}]}]},{"block_type":"element","block":"k6bfvaxq","search_text":"gturnquist$ cp tests.py /tmp/recipe47/ gturnquist$ cd /tmp/recipe47/ gturnquist$ git add tests.py gturnquist$ git commit -m \"Added tests for the recipe.\" [master 0f6ef56] Added tests for the recipe. 1 files changed, 20 insertions(+), 0 deletions(-) create mode 100644 tests.py ","text_count":277,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp tests.py /tmp/recipe47/\n    gturnquist$ cd /tmp/recipe47/\n    gturnquist$ git add tests.py\n    gturnquist$ git commit -m \"Added tests for the recipe.\"\n    [master 0f6ef56] Added tests for the recipe.\n     1 files changed, 20 insertions(+), 0 deletions(-)\n     create mode 100644 tests.py"}]}]},{"block_type":"element","block":"k6bfvaxr","search_text":"Watch to verify whether Jenkins launches a successful test run: ","text_count":64,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Watch to verify whether Jenkins launches a successful test run:"}]}]},{"block_type":"element","block":"k6bfvaxs","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000007.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvaxt","search_text":"Navigate to the test results, and we can see that four of our tests were run. ","text_count":78,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate to the test results, and we can see that four of our tests were run."}]}]},{"block_type":"element","block":"k6bfvaxu","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaxv","search_text":"This is very similar to the previous recipe, only this time we configured a polling interval for running our test suite instead of polling the version control system. It is useful to run a build once a day to make sure things are stable and working.","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is very similar to the previous recipe, only this time we configured a polling interval for running our test suite instead of polling the version control system. It is useful to run a build once a day to make sure things are stable and working."}]},{"block_type":"element","block":"k6bfvaxw","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvaxx","search_text":"Jenkins has lots of options. If you examine the web interface, you can drill into output logs to see what actually happened. It also collects trends showing how long we have had success, when the last build failed, and more. To be honest, Jenkins has so many plugins and options that an entire book could be devoted to exploring its features. This half of the chapter is merely an introduction to using it with some common jobs that are test-oriented.","text_count":451,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jenkins has lots of options. If you examine the web interface, you can drill into output logs to see what actually happened. It also collects trends showing how long we have had success, when the last build failed, and more. To be honest, Jenkins has so many plugins and options that an entire book could be devoted to exploring its features. This half of the chapter is merely an introduction to using it with some common jobs that are test-oriented."}]},{"block_type":"element","block":"k6bfvaxy","search_text":"Jenkins versus TeamCity","text_count":23,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Jenkins versus TeamCity"}]},{"block_type":"element","block":"k6bfvaxz","search_text":"So far, we have explored using Jenkins. Later in this chapter, we will visit TeamCity. What are the differences? Why should we pick one or the other? Feature-wise, they both offer powerful choices. That is why they are both covered in this book. The key thing both provide is setting up jobs to run tests, as well as other things like packaging. A key difference is that Jenkins is an open source product and TeamCity is commercial. You or your company may prefer to have a paid company associated with the product ( http://www.jetbrains.com/ ), which is what TeamCity offers. This doesn't make the decision crystal clear because the principal developer of Jenkins currently works for CloudBees ( http://www.cloudbees.com/ ), which invests effort in Jenkins as well as products surrounding it. If commercial support isn't imperative, you may find the pace of development of Jenkins is faster and the number of plugins more diverse. The bottom line is that choosing the product that meets your CI needs requires a detailed analysis and simply can't be answered here.","text_count":1065,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So far, we have explored using Jenkins. Later in this chapter, we will visit TeamCity. What are the differences? Why should we pick one or the other? Feature-wise, they both offer powerful choices. That is why they are both covered in this book. The key thing both provide is setting up jobs to run tests, as well as other things like packaging. A key difference is that Jenkins is an open source product and TeamCity is commercial. You or your company may prefer to have a paid company associated with the product ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.jetbrains.com/"},"children":[{"block_type":"text","content":"http://www.jetbrains.com/"}]},{"block_type":"text","content":"), which is what TeamCity offers. This doesn't make the decision crystal clear because the principal developer of Jenkins currently works for CloudBees ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.cloudbees.com/"},"children":[{"block_type":"text","content":"http://www.cloudbees.com/"}]},{"block_type":"text","content":"), which invests effort in Jenkins as well as products surrounding it. If commercial support isn't imperative, you may find the pace of development of Jenkins is faster and the number of plugins more diverse. The bottom line is that choosing the product that meets your CI needs requires a detailed analysis and simply can't be answered here."}]},{"block_type":"element","block":"k6bfvay0","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvay1","search_text":"Generating a CI report for Jenkins using NoseXUnit","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Generating a CI report for Jenkins using NoseXUnit"}]},{"block_type":"element","block":"k6bfvay2","search_text":"Generating a CI report for TeamCity using teamcity-nose","text_count":55,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Generating a CI report for TeamCity using teamcity-nose"}]},{"block_type":"element","block":"k6bfvay3","search_text":"There is a nose plugin that automatically detects when tests are being run from inside TeamCity. This conveniently captures test results and communicates them with TeamCity. With this recipe, we will explore how to setup a CI job inside TeamCity that runs our tests and then manually invokes that job.","text_count":301,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin that automatically detects when tests are being run from inside TeamCity. This conveniently captures test results and communicates them with TeamCity. With this recipe, we will explore how to setup a CI job inside TeamCity that runs our tests and then manually invokes that job."}]},{"block_type":"element","block":"k6bfvay4","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvay5","search_text":"The following steps are needed to get us prepared to run a TeamCity CI job:","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps are needed to get us prepared to run a TeamCity CI job:"}]},{"block_type":"element","block":"k6bfvay6","search_text":"Install nosetests . Install teamcity-nose by typing pip install teamcity-nose . ","text_count":80,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"teamcity-nose"}]},{"block_type":"text","content":"by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install teamcity-nose"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvay7","search_text":"Download TeamCity using Wget ( http://download.jetbrains.com/teamcity/TeamCity-6.0.tar.gz ). Unpack the download. Switch to the TeamCity/bin directory. Start it up: ./runAll.sh start . Open a browser to http://localhost:8111 . If this is the first time you are starting TeamCity, accept the license agreement. Create an administrator account by picking a username and password. Install Git source code control on your machine. Create an empty folder for this recipe: ","text_count":467,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Download TeamCity using Wget ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://download.jetbrains.com/teamcity/TeamCity-6.0.tar.gz"},"children":[{"block_type":"text","content":"http://download.jetbrains.com/teamcity/TeamCity-6.0.tar.gz"}]},{"block_type":"text","content":")."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Unpack the download."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Switch to the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TeamCity/bin"}]},{"block_type":"text","content":"directory."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start it up:"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"./runAll.sh start"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open a browser to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"http://localhost:8111"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If this is the first time you are starting TeamCity, accept the license agreement."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an administrator account by picking a username and password."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Git source code control on your machine."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an empty folder for this recipe:"}]}]},{"block_type":"element","block":"k6bfvay8","search_text":"gturnquist$ mkdir /tmp/recipe48 ","text_count":32,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ mkdir /tmp/recipe48"}]}]},{"block_type":"element","block":"k6bfvay9","search_text":"Initialize the folder for source code maintenance: ","text_count":51,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Initialize the folder for source code maintenance:"}]}]},{"block_type":"element","block":"k6bfvaya","search_text":"gturnquist$ git init /tmp/recipe48 Initialized empty Git repository in /private/tmp/recipe48/.git/ ","text_count":99,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ git init /tmp/recipe48\n    Initialized empty Git repository in /private/tmp/recipe48/.git/"}]}]},{"block_type":"element","block":"k6bfvayb","search_text":"Copy the shopping cart application and tests into the folder, add it, and commit the changes: ","text_count":94,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the shopping cart application and tests into the folder, add it, and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvayc","search_text":"gturnquist$ cp cart.py /tmp/recipe48/ gturnquist$ cp tests.py /tmp/recipe48/ gturnquist$ cd /tmp/recipe48/ gturnquist$ git add cart.py tests.py gturnquist$ git commit -m \"Added shopping cart and tests to setup this recipe.\" [master (root-commit) ccc7155] Added shopping cart and tests to setup this recipe. 2 files changed, 55 insertions(+), 0 deletions(-) create mode 100644 cart.py create mode 100644 tests.py ","text_count":412,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp cart.py /tmp/recipe48/\n    gturnquist$ cp tests.py /tmp/recipe48/\n    gturnquist$ cd /tmp/recipe48/\n    gturnquist$ git add cart.py tests.py\n    gturnquist$ git commit -m \"Added shopping cart and tests to setup this recipe.\"\n    [master (root-commit) ccc7155] Added shopping cart and tests to setup this recipe.\n     2 files changed, 55 insertions(+), 0 deletions(-)\n     create mode 100644 cart.py\n     create mode 100644 tests.py"}]}]},{"block_type":"element","block":"k6bfvayd","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaye","search_text":"The following steps show how to configure a CI job in TeamCity:","text_count":63,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps show how to configure a CI job in TeamCity:"}]},{"block_type":"element","block":"k6bfvayf","search_text":"Log in to the TeamCity console. Underneath the Projects tab, click Create project. Type in recipe48 , and then click Create. ","text_count":125,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Log in to the TeamCity console."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Underneath the&nbsp;Projects tab, click Create project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Type in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe48"}]},{"block_type":"text","content":", and then click Create."}]}]},{"block_type":"element","block":"k6bfvayg","search_text":"Click Add a build configuration for this project. Enter nose testing for the name and then click VCS settings. Click on Create and attach new VCS root. Enter recipe48 in VCS root name. Select Git as the Type of VCS. Enter /tmp/recipe48 as the Fetch URL. Click on Test Connection to confirm the settings and then click Save. Click on Add Build Step. Select Command Line for Runner type. Select Custom script for Run type and enter the following script: ","text_count":452,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click Add a build configuration for this project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose testing"}]},{"block_type":"text","content":"for the name and then click VCS settings."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Create and attach new VCS root."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe48"}]},{"block_type":"text","content":"in VCS root name."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Git as the Type of VCS."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/tmp/recipe48"}]},{"block_type":"text","content":"as the Fetch URL."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Test Connection to confirm the settings and then click Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Add Build Step."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Command Line for Runner type."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Custom script for Run type and enter the following script:"}]}]},{"block_type":"element","block":"k6bfvayh","search_text":". /Users/gturnquist/ptc/bin/activatenosetests tests.py","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":". /Users/gturnquist/ptc/bin/activatenosetests tests.py"}]}]},{"block_type":"element","block":"k6bfvayi","search_text":"You need to customize this with the command needed to activate your virtualenv.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need to customize this with the command needed to activate your virtualenv."}]},{"block_type":"element","block":"k6bfvayj","search_text":"Click on Save. Go back to the project, and run it manually: ","text_count":60,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Go back to the project, and run it manually:"}]}]},{"block_type":"element","block":"k6bfvayk","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000154.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvayl","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvaym","search_text":"This plugin is designed not to be used in the classic style of being invoked by a command-line argument. Instead, it is manually run automatically whenever nosetests is executed, and it checks if there is a TeamCity-specific environment variable set. If so, it kicks in by printing out viewable results as well as sending back useful information to TeamCity:","text_count":358,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This plugin is designed not to be used in the classic style of being invoked by a command-line argument. Instead, it is manually run automatically whenever"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"is executed, and it checks if there is a TeamCity-specific environment variable set. If so, it kicks in by printing out viewable results as well as sending back useful information to TeamCity:"}]},{"block_type":"element","block":"k6bfvayn","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000143.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvayo","search_text":"Otherwise, the plugin lets itself be bypassed and does nothing. If the plugin was NOT installed, the following screenshot would be the output:","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Otherwise, the plugin lets itself be bypassed and does nothing. If the plugin was NOT installed, the following screenshot would be the output:"}]},{"block_type":"element","block":"k6bfvayp","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000131.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvayq","search_text":"In turn, drilling into the details shows the following output with little detail. There are four periods, one for each test method, but we don't know much more than that:","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In turn, drilling into the details shows the following output with little detail. There are four periods, one for each test method, but we don't know much more than that:"}]},{"block_type":"element","block":"k6bfvayr","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000125.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvays","search_text":"This means no extra arguments are needed to use the TeamCity plugin, but running it from the command line, outside of TeamCity, causes no changes.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This means no extra arguments are needed to use the TeamCity plugin, but running it from the command line, outside of TeamCity, causes no changes."}]},{"block_type":"element","block":"k6bfvayt","search_text":"Configuring TeamCity to run Python tests upon commit","text_count":52,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Configuring TeamCity to run Python tests upon commit"}]},{"block_type":"element","block":"k6bfvayu","search_text":"TeamCity can be configured to invoke your test suite upon commit.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"TeamCity can be configured to invoke your test suite upon commit."}]},{"block_type":"element","block":"k6bfvayv","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvayw","search_text":"The following steps will help us prep TeamCity to run our test suite when the code changes are committed:","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following steps will help us prep TeamCity to run our test suite when the code changes are committed:"}]},{"block_type":"element","block":"k6bfvayx","search_text":"Set up TeamCity like in the previous recipe, and have it started up. You also need to have git installed, as mentioned earlier in this chapter. Create an empty folder for this recipe: ","text_count":184,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up TeamCity like in the previous recipe, and have it started up. You also need to have"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"git"}]},{"block_type":"text","content":"installed, as mentioned earlier in this chapter."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an empty folder for this recipe:"}]}]},{"block_type":"element","block":"k6bfvayy","search_text":"gturnquist$ mkdir /tmp/recipe49 ","text_count":32,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ mkdir /tmp/recipe49"}]}]},{"block_type":"element","block":"k6bfvayz","search_text":"Initialize the folder for source code maintenance: ","text_count":51,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Initialize the folder for source code maintenance:"}]}]},{"block_type":"element","block":"k6bfvaz0","search_text":"gturnquist$ git init /tmp/recipe49 Initialized empty Git repository in /private/tmp/recipe49/.git/ ","text_count":99,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ git init /tmp/recipe49\n    Initialized empty Git repository in /private/tmp/recipe49/.git/"}]}]},{"block_type":"element","block":"k6bfvaz1","search_text":"Copy the Shopping Cart application into the folder, add it, and commit the changes: ","text_count":84,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the Shopping Cart application into the folder, add it, and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvaz2","search_text":"gturnquist$ cp cart.py /tmp/recipe49/ gturnquist$ cd /tmp/recipe49/ gturnquist$ git add cart.py gturnquist$ git commit -m \"Added shopping cart application to setup this recipe.\" [master (root-commit) 057d936] Added shopping cart application to setup this recipe. 1 files changed, 35 insertions(+), 0 deletions(-) create mode 100644 cart.py ","text_count":340,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp cart.py /tmp/recipe49/\n    gturnquist$ cd /tmp/recipe49/\n    gturnquist$ git add cart.py\n    gturnquist$ git commit -m \"Added shopping cart application to setup this recipe.\"\n    [master (root-commit) 057d936] Added shopping cart application to setup this recipe.\n     1 files changed, 35 insertions(+), 0 deletions(-)\n     create mode 100644 cart.py"}]}]},{"block_type":"element","block":"k6bfvaz3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvaz4","search_text":"These steps will show us how to create a TeamCity job that polls version control to detect a change and then run a test suite:","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These steps will show us how to create a TeamCity job that polls version control to detect a change and then run a test suite:"}]},{"block_type":"element","block":"k6bfvaz5","search_text":"Log in to the TeamCity console. Underneath the Projects tab, click Create project. Type in recipe49 , and then click Create. Click Add a build configuration for this project. Enter nose testing for the name and then click VCS settings. Click on Create and attach new VCS root. Enter recipe49 in VCS root name. Select Git as the Type of VCS. Enter / tmp/recipe49 as the Fetch URL. Click on Test Connection to confirm settings and then click Save. Click on Add Build Step. Select Command Line for Runner type. Select Custom script for Run type and enter the following script: ","text_count":574,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Log in to the TeamCity console."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Underneath the&nbsp;Projects tab, click Create project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Type in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe49"}]},{"block_type":"text","content":", and then click Create."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click Add a build configuration for this project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose testing"}]},{"block_type":"text","content":"for the name and then click VCS settings."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Create and attach new VCS root."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe49"}]},{"block_type":"text","content":"in VCS root name."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Git as the Type of VCS."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"/"}]},{"block_type":"text","content":"tmp/recipe49"}]},{"block_type":"text","content":"as the Fetch URL."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Test Connection to confirm settings and then click Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Add Build Step."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Command Line for Runner type."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Custom script for Run type and enter the following script:"}]}]},{"block_type":"element","block":"k6bfvaz6","search_text":". /Users/gturnquist/ptc/bin/activatenosetests tests.py","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":". /Users/gturnquist/ptc/bin/activatenosetests tests.py"}]}]},{"block_type":"element","block":"k6bfvaz7","search_text":"You must replace this with the command to activate your own virtualenv and invoke nosetests .","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You must replace this with the command to activate your own virtualenv and invoke"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvaz8","search_text":"Click on Save. Click on Build Triggering. Click on Add new Trigger. Pick VCS Trigger from Trigger Type. At the top, it should display VCS Trigger will add build to the queue if VCS check-in is detected. Click Save. Navigate back to Projects. There should be no jobs scheduled or results displayed. ","text_count":298,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Build Triggering."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Add new Trigger."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick VCS Trigger from Trigger Type."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"At the top, it should display VCS Trigger will add build to the queue if VCS check-in is detected. Click Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate back to Projects. There should be no jobs scheduled or results displayed."}]}]},{"block_type":"element","block":"k6bfvaz9","search_text":"Click on Run. It should fail, because we haven't added the tests to the repository: ","text_count":84,"tag_name":"ol","attributes":{"start":"20"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Run. It should fail, because we haven't added the tests to the repository:"}]}]},{"block_type":"element","block":"k6bfvaza","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000115.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvazb","search_text":"From the command line, copy the test file into the repository. Then add it and commit it: ","text_count":90,"tag_name":"ol","attributes":{"start":"21"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"From the command line, copy the test file into the repository. Then add it and commit it:"}]}]},{"block_type":"element","block":"k6bfvazc","search_text":"gturnquist$ cp tests.py /tmp/recipe49/ gturnquist$ cd /tmp/recipe49/ gturnquist$ git add tests.py gturnquist$ git commit -m \"Adding tests.\" [master 4c3c418] Adding tests. 1 files changed, 20 insertions(+), 0 deletions(-) create mode 100644 tests.py ","text_count":249,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp tests.py /tmp/recipe49/\n    gturnquist$ cd /tmp/recipe49/\n    gturnquist$ git add tests.py\n    gturnquist$ git commit -m \"Adding tests.\"\n    [master 4c3c418] Adding tests.\n     1 files changed, 20 insertions(+), 0 deletions(-)\n     create mode 100644 tests.py"}]}]},{"block_type":"element","block":"k6bfvazd","search_text":"Go back to the browser. It may take a minute for TeamCity to detect the change in the code and start another build job. It should automatically update the screen: ","text_count":163,"tag_name":"ol","attributes":{"start":"22"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Go back to the browser. It may take a minute for TeamCity to detect the change in the code and start another build job. It should automatically update the screen:"}]}]},{"block_type":"element","block":"k6bfvaze","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000104.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvazf","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvazg","search_text":"In this recipe, we configured TeamCity to do a job for us tied to a specific trigger. The trigger is activated whenever a check-in is done to the software baseline. We had to take several steps to configure this, but it demonstrates the flexible power TeamCity offers. We also installed the teamcity-nose plugin, which gave us more details about the results.","text_count":358,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we configured TeamCity to do a job for us tied to a specific trigger. The trigger is activated whenever a check-in is done to the software baseline. We had to take several steps to configure this, but it demonstrates the flexible power TeamCity offers. We also installed the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"teamcity-nose"}]},{"block_type":"text","content":"plugin, which gave us more details about the results."}]},{"block_type":"element","block":"k6bfvazh","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvazi","search_text":"TeamCity calls our nose testing job a build job. That is because running tests isn't the only thing TeamCity is used for. Instead, it's geared to build packages, deploy to sites, and any other action we may want it to do anytime a commit happens. This is why CI servers are sometimes called build servers . But if we start with simple jobs like testing the baseline, we are well on our way to discovering the other useful features TeamCity has to offer.","text_count":453,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"TeamCity calls our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose testing"}]},{"block_type":"text","content":"job a build job. That is because running tests isn't the only thing TeamCity is used for. Instead, it's geared to build packages, deploy to sites, and any other action we may want it to do anytime a commit happens. This is why CI servers are sometimes called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"build servers"}]},{"block_type":"text","content":". But if we start with simple jobs like testing the baseline, we are well on our way to discovering the other useful features TeamCity has to offer."}]},{"block_type":"element","block":"k6bfvazj","search_text":"What did teamcity-nose give us?","text_count":31,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What did teamcity-nose give us?"}]},{"block_type":"element","block":"k6bfvazk","search_text":"This is a nose plugin that provided us with a more detailed output. We didn't go into much detail in this recipe.","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose"}]},{"block_type":"text","content":"plugin that provided us with a more detailed output. We didn't go into much detail in this recipe."}]},{"block_type":"element","block":"k6bfvazl","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvazm","search_text":"Generating a CI report for TeamCity using teamcity-nose Configuring Jenkins to run Python tests upon commit ","text_count":108,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating a CI report for TeamCity using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"teamcity-nose"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests upon commit"}]}]},{"block_type":"element","block":"k6bfvazn","search_text":"Configuring TeamCity to run Python tests when scheduled","text_count":55,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Configuring TeamCity to run Python tests when scheduled"}]},{"block_type":"element","block":"k6bfvazo","search_text":"TeamCity can be configured to invoke our test suite and collect results at a scheduled interval.","text_count":96,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"TeamCity can be configured to invoke our test suite and collect results at a scheduled interval."}]},{"block_type":"element","block":"k6bfvazp","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvazq","search_text":"These steps will prepare us for this recipe by starting up TeamCity and having some code ready for testing:","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These steps will prepare us for this recipe by starting up TeamCity and having some code ready for testing:"}]},{"block_type":"element","block":"k6bfvazr","search_text":"Set up TeamCity like we did earlier in this chapter and have it up and running. Create an empty folder for this recipe: ","text_count":120,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up TeamCity like we did earlier in this chapter and have it up and running."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an empty folder for this recipe:"}]}]},{"block_type":"element","block":"k6bfvazs","search_text":"gturnquist$ mkdir /tmp/recipe50","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ mkdir /tmp/recipe50"}]}]},{"block_type":"element","block":"k6bfvazt","search_text":"Initialize the folder for source code maintenance: ","text_count":51,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Initialize the folder for source code maintenance:"}]}]},{"block_type":"element","block":"k6bfvazu","search_text":"gturnquist$ git init /tmp/recipe50 Initialized empty Git repository in /private/tmp/recipe50/.git/","text_count":98,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ git init /tmp/recipe50\n    Initialized empty Git repository in /private/tmp/recipe50/.git/"}]}]},{"block_type":"element","block":"k6bfvazv","search_text":"Copy the shopping cart application into the folder, add it, and commit the changes: ","text_count":84,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the shopping cart application into the folder, add it, and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvazw","search_text":"gturnquist$ cp cart.py /tmp/recipe50/ gturnquist$ cp tests.py /tmp/recipe50/ gturnquist$ cd /tmp/recipe50/ gturnquist$ git add cart.py tests.py gturnquist$ git commit -m \"Adding shopping cart and tests for this recipe.\" [master (root-commit) 01cd72a] Adding shopping cart and tests for this recipe. 2 files changed, 55 insertions(+), 0 deletions(-) create mode 100644 cart.py create mode 100644 tests.py ","text_count":404,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp cart.py /tmp/recipe50/\n    gturnquist$ cp tests.py /tmp/recipe50/\n    gturnquist$ cd /tmp/recipe50/\n    gturnquist$ git add cart.py tests.py\n    gturnquist$ git commit -m \"Adding shopping cart and tests for this recipe.\"\n    [master (root-commit) 01cd72a] Adding shopping cart and tests for this recipe.\n     2 files changed, 55 insertions(+), 0 deletions(-)\n     create mode 100644 cart.py\n     create mode 100644 tests.py"}]}]},{"block_type":"element","block":"k6bfvazx","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvazy","search_text":"These steps show the details for configuring TeamCity to run our test suite on a scheduled basis:","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These steps show the details for configuring TeamCity to run our test suite on a scheduled basis:"}]},{"block_type":"element","block":"k6bfvazz","search_text":"Log in to the TeamCity console. Underneath the Projects tab, click Create project. Type in recipe50 , and then click Create. Click Add a build configuration for this project. Enter nose testing for the name and then click VCS settings. Click on Create and attach new VCS root. Enter recipe50 in VCS root name. Select Git as the Type of VCS. Enter /tmp/recipe50 as the Fetch URL. Click on Test Connection to confirm settings and then click Save. Click on Add Build Step. Select Command Line for Runner type. ","text_count":507,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Log in to the TeamCity console."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Underneath the&nbsp;Projects tab, click Create project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Type in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe50"}]},{"block_type":"text","content":", and then click Create."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click Add a build configuration for this project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nose testing"}]},{"block_type":"text","content":"for the name and then click VCS settings."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Create and attach new VCS root."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe50"}]},{"block_type":"text","content":"in VCS root name."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Git as the Type of VCS."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/tmp/recipe50"}]},{"block_type":"text","content":"as the Fetch URL."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Test Connection to confirm settings and then click Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Add Build Step."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Command Line for Runner type."}]}]},{"block_type":"element","block":"k6bfvb00","search_text":"Select Custom script for Run type and enter the following script: ","text_count":66,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Custom script for Run type and enter the following script:"}]}]},{"block_type":"element","block":"k6bfvb01","search_text":". /Users/gturnquist/ptc/bin/activatenosetests tests.py","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":". /Users/gturnquist/ptc/bin/activatenosetests tests.py"}]}]},{"block_type":"element","block":"k6bfvb02","search_text":"Replace this with your own steps to activate your virtualenv and then run the tests using nosetests .","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Replace this with your own steps to activate your virtualenv and then run the tests using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb03","search_text":"Click on Save. Click on Build Triggering. Click on Add new Trigger. Select Schedule Trigger from Trigger Type. Pick daily for frequency, and pick a time of about five minutes into the future. Deselect the option to Trigger build only if there are pending changes. Click Save. Navigate back to Projects. There should be no jobs scheduled or results displayed. Wait for the scheduled time to occur. The following screenshot shows the job when it is activated: ","text_count":458,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Build Triggering."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Add new Trigger."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select Schedule Trigger from Trigger Type."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pick daily for frequency, and pick a time of about five minutes into the future."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Deselect the option to Trigger build only if there are pending changes."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click Save."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate back to Projects. There should be no jobs scheduled or results displayed."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Wait for the scheduled time to occur. The following screenshot shows the job when it is activated:"}]}]},{"block_type":"element","block":"k6bfvb04","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000092.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb05","search_text":"The following screenshot shows the results summarized with our tests having passed:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following screenshot shows the results summarized with our tests having passed:"}]},{"block_type":"element","block":"k6bfvb06","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000084.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb07","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb08","search_text":"Doesn't this look suspiciously similar to the previous recipe? Of course! We varied it a bit by creating a time-based trigger instead of a source-based trigger. The time trigger we picked is a daily, scheduled build at a set time. The point is to show a commonly used trigger rule. By seeing what is the same and what's different, we can start to see how to bend TeamCity to serve our needs. TeamCity has other triggers that are very useful, like triggering one job when another one completes. This lets us build lots of small, simple jobs, and chaining them together. We also installed the teamcity-nose plugin, which gave us more details in the results.","text_count":655,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Doesn't this look suspiciously similar to the previous recipe? Of course! We varied it a bit by creating a time-based trigger instead of a source-based trigger. The time trigger we picked is a daily, scheduled build at a set time. The point is to show a commonly used trigger rule. By seeing what is the same and what's different, we can start to see how to bend TeamCity to serve our needs. TeamCity has other triggers that are very useful, like triggering one job when another one completes. This lets us build lots of small, simple jobs, and chaining them together. We also installed the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"teamcity-nose"}]},{"block_type":"text","content":"plugin, which gave us more details in the results."}]},{"block_type":"element","block":"k6bfvb09","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvb0a","search_text":"Generating a CI report for TeamCity using teamcity-nose Configuring Jenkins to run Python tests when scheduled ","text_count":111,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating a CI report for TeamCity using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"teamcity-nose"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Configuring Jenkins to run Python tests when scheduled"}]}]}]},{"title":"Measuring Your Success with Test Coverage","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3ww","number":7,"contents":[{"block_type":"element","block":"k6bfvb0b","search_text":"In this chapter, we will cover:","text_count":31,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover:"}]},{"block_type":"element","block":"k6bfvb0c","search_text":"Building a network management application Installing and running coverage on your test suite Generating an HTML report using coverage Generating an XML report using coverage Getting nosy with coverage Filtering out test noise from coverage Letting Jenkins get nosy with coverage Updating the project-level script to provide coverage reports ","text_count":341,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Building a network management application"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Installing and running coverage on your test suite"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating an HTML report using coverage"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating an XML report using coverage"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Getting nosy with coverage"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Filtering out test noise from coverage"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Letting Jenkins get nosy with coverage"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Updating the project-level script to provide coverage reports"}]}]},{"block_type":"element","block":"k6bfvb0d","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfvb0e","search_text":"Coverage analysis is measuring which lines in a program are run and which lines aren't. This type of analysis is also known as code coverage , or more simply coverage .","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Coverage"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"analysis"}]},{"block_type":"text","content":"is measuring which lines in a program are run and which lines aren't. This type of analysis is also known as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"code coverage"}]},{"block_type":"text","content":", or more simply"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"coverage"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb0f","search_text":"A coverage analyzer can be used while running a system in production, but what are the pros and cons of this? What about using a coverage analyzer when running test suites? What benefits would this approach provide compared to checking systems in production?","text_count":258,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A coverage analyzer can be used while running a system in production, but what are the pros and cons of this? What about using a coverage analyzer when running test suites? What benefits would this approach provide compared to checking systems in production?"}]},{"block_type":"element","block":"k6bfvb0g","search_text":"Coverage helps us to see whether we are adequately testing our system. But it must be performed with a certain amount of skepticism. This is because, even if we achieve 100% coverage, meaning every line of our system was run, in no way does this guarantee us having no bugs. Testing can only uncover the presence of bugs. A quick example involves code we have written, and what it processes is the return value from a system call. What if there are three possible values, but we only handle two of them? We may write two test cases covering our handling of it, and this could certainly achieve 100% statement coverage. However, it doesn't mean we have handled the third possible return value, thus leaving us with a potentially undiscovered bug. 100% code coverage can also be obtained by condition coverage, but may not be achieved with statement coverage. The kind of coverage we are planning to target should be clear.","text_count":921,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Coverage helps us to see whether we are adequately testing our system. But it must be performed with a certain amount of skepticism. This is because, even if we achieve 100% coverage, meaning every line of our system was run, in no way does this guarantee us having no bugs. Testing can only uncover the presence of bugs. A quick example involves code we have written, and what it processes is the return value from a system call. What if there are three possible values, but we only handle two of them? We may write two test cases covering our handling of it, and this could certainly achieve 100% statement coverage. However, it doesn't mean we have handled the third possible return value, thus leaving us with a potentially undiscovered bug. 100% code coverage can also be obtained by condition coverage, but may not be achieved with statement coverage. The kind of coverage we are planning to target should be clear."}]},{"block_type":"element","block":"k6bfvb0h","search_text":"Another key point is that not all testing is aimed at fixing bugs. Another key purpose is to make sure that the application meets our customer's needs. This means that, even if we have 100% code coverage, we can't guarantee that we are covering all the scenarios expected by our users. This is the difference between building it right and building the right thing .","text_count":365,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another key point is that not all testing is aimed at&nbsp;fixing&nbsp;bugs. Another key purpose is to make sure that the application meets our customer's needs. This means that, even if we have 100% code coverage, we can't guarantee that we are covering all the scenarios expected by our users. This is the difference between"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"building it right"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"building the right thing"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb0i","search_text":"In this chapter, we will explore various recipes to build a network management application, run coverage tools, and harvest the results. We will discuss how coverage can introduce noise and show us more than we need to know, and we'll introduce performance issues when it implements our code. We will also see how to trim out information we don't need to get a concise, targeted view of things.","text_count":394,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will explore various recipes to build a network management application, run coverage tools, and harvest the results. We will discuss how coverage can introduce noise and show us more than we need to know, and we'll&nbsp;introduce performance issues when it implements our code. We will also see how to trim out information we don't need to get a concise, targeted view of things."}]},{"block_type":"element","block":"k6bfvb0j","search_text":"This chapter uses several third-party tools in many recipes:","text_count":60,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This chapter uses several third-party tools in many recipes:"}]},{"block_type":"element","block":"k6bfvb0k","search_text":"Spring Python ( http://springpython.webfactional.com ) contains many useful abstractions. The one used in this chapter is its DatabaseTemplate , which provides easy ways to write SQL queries and updates without having to deal with Python's verbose API. Install it by typing pip install springpython . Install the coverage tool by typing pip install coverage . This may fail because other plugins may install an older version of coverage. If so, uninstall coverage by typing pip uninstall coverage , and then install it again with pip install coverage . Nose, a useful test runner, is covered in Chapter 2, Running Automated Test Suites with Nose . Refer to that chapter to see how to install nose. ","text_count":698,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Spring Python"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://springpython.webfactional.com"},"children":[{"block_type":"text","content":"http://springpython.webfactional.com"}]},{"block_type":"text","content":") contains many useful abstractions. The one used in this chapter is its"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DatabaseTemplate"}]},{"block_type":"text","content":", which provides easy ways to write SQL queries and updates without having to deal with Python's verbose API. Install it by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install springpython"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install the coverage tool by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install coverage"}]},{"block_type":"text","content":". This may fail because other plugins may install an older version of coverage. If so, uninstall coverage by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip uninstall coverage"}]},{"block_type":"text","content":", and then install it again with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install coverage"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Nose, a useful test runner, is covered in Chapter 2,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Running Automated Test Suites with Nose"}]},{"block_type":"text","content":". Refer to that chapter to see how to install nose."}]}]},{"block_type":"element","block":"k6bfvb0l","search_text":"Building a network management application","text_count":41,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Building a network management application"}]},{"block_type":"element","block":"k6bfvb0m","search_text":"For this chapter, we will build a very simple network management application, write different types of test, and check their coverage. This network management application is focused on digesting alarms, also referred to as network events . This is different from certain other network management tools that focus on gathering SNMP alarms from devices.","text_count":351,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this chapter, we will build a very simple network management application, write different types of test, and check their coverage. This network management application is focused on digesting alarms, also referred to as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"network"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"events"}]},{"block_type":"text","content":". This is different from certain other network management tools that focus on gathering SNMP alarms from devices."}]},{"block_type":"element","block":"k6bfvb0n","search_text":"For reasons of simplicity, this correlation engine doesn't contain complex rules, but instead contains a simple mapping of network events onto equipment and customer service inventory. We'll explore this in the next few paragraphs as we dig through the code.","text_count":258,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For reasons of simplicity, this correlation engine doesn't contain complex rules, but instead contains a simple mapping of network events onto equipment and customer service inventory. We'll explore this in the next few paragraphs as we dig through the code."}]},{"block_type":"element","block":"k6bfvb0o","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb0p","search_text":"With the following steps, we will build a simple network management application:","text_count":80,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will build a simple network management application:"}]},{"block_type":"element","block":"k6bfvb0q","search_text":"Create a file called network.py to store the network application. Create a class definition to represent a network event: ","text_count":122,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.py"}]},{"block_type":"text","content":"to store the network application."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a class definition to represent a network event:"}]}]},{"block_type":"element","block":"k6bfvb0r","search_text":"class Event(object): def init (self, hostname, condition, severity, event_time): self.hostname = hostname self.condition = condition self.severity = severity self.id = -1 def str(self): return \"(ID:%s) %s:%s - %s\" % (self.id, self.hostname,\\ self.condition,self.severity)","text_count":271,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class Event(object):\n   def init  (self, hostname, condition, severity, event_time):\n       self.hostname = hostname\n       self.condition = condition\n       self.severity = severity\n       self.id = -1\n   def str(self):\n       return \"(ID:%s) %s:%s - %s\" % (self.id, self.hostname,\\ \n               self.condition,self.severity)"}]}]},{"block_type":"element","block":"k6bfvb0s","search_text":"Let's have a look at few properties of self :","text_count":45,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's have a look at few properties of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k6bfvb0t","search_text":"hostname : It is assumed that all network alarms originate from pieces of equipment that have a hostname. condition : This indicates the type of alarm being generated. Two different alarm conditions can come from the same device. severity : 1 indicates a clear, green status, and 5 indicates a faulty, red status. id : This is the primary key value used when the event is stored in a database. ","text_count":394,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"hostname"}]},{"block_type":"text","content":": It is assumed that all network alarms originate from pieces of equipment that have a hostname."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"condition"}]},{"block_type":"text","content":": This indicates the type of alarm being generated. Two different alarm conditions can come from the same device."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"severity"}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"indicates a clear, green status, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"5"}]},{"block_type":"text","content":"indicates a faulty, red status."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"id"}]},{"block_type":"text","content":": This is the primary key value used when the event is stored in a database."}]}]},{"block_type":"element","block":"k6bfvb0u","search_text":"Create a new file called network.sql to contain the SQL code. ","text_count":62,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.sql"}]},{"block_type":"text","content":"to contain the SQL code."}]}]},{"block_type":"element","block":"k6bfvb0v","search_text":"Create a SQL script that sets up the database and adds the definition for storing network events: ","text_count":98,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a SQL script that sets up the database and adds the definition for storing network events:"}]}]},{"block_type":"element","block":"k6bfvb0w","search_text":"CREATE TABLE EVENTS( ID INTEGER PRIMARY KEY, HOST_NAME TEXT, SEVERITY INTEGER, EVENT_CONDITION TEXT ); ","text_count":103,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"CREATE TABLE EVENTS(\n       ID INTEGER PRIMARY KEY,\n       HOST_NAME TEXT,\n       SEVERITY INTEGER,\n       EVENT_CONDITION TEXT\n       );"}]}]},{"block_type":"element","block":"k6bfvb0x","search_text":"Code a high-level algorithm where events are assessed for their impact on equipment and customer services, and add it to network.py : ","text_count":134,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Code a high-level algorithm where events are assessed for their impact on equipment and customer services, and add it to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvb0y","search_text":"from springpython.database.core import* class EventCorrelator(object): def init(self, factory): self.dt = DatabaseTemplate(factory) def del(self): del(self.dt) def process(self, event): stored_event, is_active = self.store_event(event) affected_services, affected_equip = self.impact(event) updated_services = [ self.update_service(service, event) for service in affected_services] updated_equipment = [ self.update_equipment(equip, event) for equip in affected_equip] return (stored_event, is_active, updated_services,updated_equipment)","text_count":537,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from springpython.database.core import*\n\nclass EventCorrelator(object):\n   def init(self, factory):\n      self.dt = DatabaseTemplate(factory)\n   def del(self):\n      del(self.dt)\n   def process(self, event):\n     stored_event, is_active = self.store_event(event)\n     affected_services, affected_equip = self.impact(event)\n     updated_services = [\n          self.update_service(service, event) \n          for service in affected_services]\n     updated_equipment = [\n          self.update_equipment(equip, event)\n          for equip in affected_equip]\n     return (stored_event, is_active,\n         updated_services,updated_equipment)"}]}]},{"block_type":"element","block":"k6bfvb0z","search_text":"Note The init method contains some setup code for creating a DatabaseTemplate . This is a Spring Python utility class used for database operations. See https://docs.spring.io/spring-python/1.2.x/sphinx/html/dao.html for more details. We are also using SQLite3 as our database engine, since it is a standard part of Python. ","text_count":323,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"init"}]},{"block_type":"text","content":"method contains some setup code for creating a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DatabaseTemplate"}]},{"block_type":"text","content":". This is a Spring Python utility class used for database operations. See&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.spring.io/spring-python/1.2.x/sphinx/html/dao.html"},"children":[{"block_type":"text","content":"https://docs.spring.io/spring-python/1.2.x/sphinx/html/dao.html"}]},{"block_type":"text","content":"for more details. We are also using"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"SQLite3"}]},{"block_type":"text","content":"as our database engine, since it is a standard part of Python.&nbsp;"}]}]},{"block_type":"element","block":"k6bfvb10","search_text":"The process method contains some simple steps to process an incoming event:","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The process method contains some simple steps to process an incoming event:"}]},{"block_type":"element","block":"k6bfvb11","search_text":"We first need to store the event in the EVENTS table. This includes evaluating whether or not it is an active event, meaning that it is actively impacting a piece of equipment. Then we determine what equipment and what services the event impacts. Next, we update the affected service by determining whether it causes any service outages or restorations. Then we update the affected equipment by determining whether it fails or clears a device. Finally, we return a tuple containing all the affected assets to support any screen interfaces that could be developed on top of this. ","text_count":579,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first need to store the event in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EVENTS"}]},{"block_type":"text","content":"table. This includes evaluating whether or not it is an active event, meaning that it is actively impacting a piece of equipment."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Then we determine what equipment and what services the event impacts."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, we update the affected service by determining whether it causes any service outages or restorations."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Then we update the affected equipment by determining whether it fails or clears a device."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, we return a tuple containing all the affected assets to support any screen interfaces that could be developed on top of this."}]}]}]}]},{"block_type":"element","block":"k6bfvb12","search_text":"Implement the store_event algorithm: ","text_count":37,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Implement the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store_event"}]},{"block_type":"text","content":"algorithm:"}]}]},{"block_type":"element","block":"k6bfvb13","search_text":"def store_event(self,event): try: max_id = self.dt.query_for_init(\"\"\"select max(ID) from EVENTS\"\"\") except DataAccessException, e: max_id=0 event.id = max_id+1 self.dt.update(\"\"\"insert into EVENTS (ID, HOST_NAME, SEVERITY, EVENT_CONDITION) values(?,?,?,?)\"\"\", (event.id, event.hostname, event.severity, event.condition)) is active = self.add_or_remove_from_active_events(event) ","text_count":378,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def store_event(self,event):\n   try:\n     max_id = self.dt.query_for_init(\"\"\"select max(ID) \n        from EVENTS\"\"\")\n   except DataAccessException, e:\n     max_id=0\n   event.id = max_id+1\n   self.dt.update(\"\"\"insert into EVENTS\n                     (ID, HOST_NAME, SEVERITY, EVENT_CONDITION)\n                        values(?,?,?,?)\"\"\",\n                     (event.id, event.hostname, event.severity,\n                        event.condition))\n   is active = self.add_or_remove_from_active_events(event)"}]}]},{"block_type":"element","block":"k6bfvb14","search_text":"This method stores every event that is processed. This supports many things, including data mining and the post-mortem analysis of outages. It is also the authoritative place where other event-related data can point back using a foreign key:","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This method stores every event that is processed. This supports many things, including data mining and the post-mortem analysis of outages. It is also the authoritative place where other event-related data can point back using a foreign key:"}]},{"block_type":"element","block":"k6bfvb15","search_text":"The store_event method looks up the maximum primary key value from the EVENTS table. It increments it by 1 . It assigns it to event.id . It then inserts it into the EVENTS table. Next, it calls a method to evaluate whether or not the event should be added to the list of active events, or if it clears out existing active events. Active events are events that are actively causing a piece of equipment to be unclear. Finally, it returns a tuple containing the event and whether or not it was classified as an active event. ","text_count":523,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store_event"}]},{"block_type":"text","content":"method looks up the maximum primary key value from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EVENTS"}]},{"block_type":"text","content":"table."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It increments it by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It assigns it to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"event.id"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It then inserts it into the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EVENTS"}]},{"block_type":"text","content":"table."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, it calls a method to evaluate whether or not the event should be added to the list of active events, or if it clears out existing active events. Active events are events that are actively causing a piece of equipment to be unclear."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, it returns a tuple containing the event and whether or not it was classified as an active event."}]}]}]}]},{"block_type":"element","block":"k6bfvb16","search_text":"Note For a more sophisticated system, some sort of partitioning solution needs to be implemented. Querying against a table containing millions of rows is very inefficient. However, this is for demonstration purposes only, so we will skip scaling as well as performance and security. ","text_count":283,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For a more sophisticated system, some sort of partitioning solution needs to be implemented. Querying against a table containing millions of rows is very inefficient. However, this is for demonstration purposes only, so we will skip scaling as well as performance and security."}]}]},{"block_type":"element","block":"k6bfvb17","search_text":"Implement a method to evaluate whether to add or remove active events: ","text_count":71,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Implement a method to evaluate whether to add or remove active events:"}]}]},{"block_type":"element","block":"k6bfvb18","search_text":"def add_or_remove_from_active_events(self,event): \"\"\"Active events are current ones that cause equipment and\\or services to be down.\"\"\" if event.severity == 1: self.dt.update (\"\"\"DELETE FROM ACTIVE_EVENTS WHERE EVENT_FK in ( SELECT ID FROM EVENTS WHERE HOST_NAME=? AND EVENT_CONDITION=?)\"\"\", (event.hostname,event.condition)) return False else: self.dt.execute (\"\"\"INSERT INTO ACTIVE_EVENTS (EVENT_FK) values (?) \"\"\", event.id,)) return True","text_count":441,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def add_or_remove_from_active_events(self,event):\n    \"\"\"Active events are current ones that cause equipment\n       and\\or services to be down.\"\"\"\n    if event.severity == 1:\n       self.dt.update (\"\"\"DELETE FROM ACTIVE_EVENTS\n                          WHERE EVENT_FK in (\n                          SELECT ID FROM EVENTS\n                          WHERE HOST_NAME=?\n                          AND EVENT_CONDITION=?)\"\"\",\n                       (event.hostname,event.condition))\n      return False\n    else:\n      self.dt.execute (\"\"\"INSERT INTO ACTIVE_EVENTS (EVENT_FK) values (?) \"\"\", event.id,))\n      return True"}]}]},{"block_type":"element","block":"k6bfvb19","search_text":"When a device fails, it sends a severity 5 event. This is an active event, and in this method a row is inserted into the ACTIVE_EVENTS table with a foreign key pointing back to the EVENTS table. Then we return True , indicating that this is an active event.","text_count":257,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When a device fails, it sends a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"severity 5"}]},{"block_type":"text","content":"event. This is an active event, and in this method a row is inserted into the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ACTIVE_EVENTS"}]},{"block_type":"text","content":"table with a foreign key pointing back to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EVENTS"}]},{"block_type":"text","content":"table. Then we return&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":", indicating that this is an active event."}]},{"block_type":"element","block":"k6bfvb1a","search_text":"Add the table definition for ACTIVE_EVENTS to the SQL script: ","text_count":62,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the table definition for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ACTIVE_EVENTS"}]},{"block_type":"text","content":"to the SQL script:"}]}]},{"block_type":"element","block":"k6bfvb1b","search_text":"CREATE TABLE ACTIVE_EVENTS(ID INTEGER PRIMARY KEY, EVENT_FK, FOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID) );","text_count":107,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"CREATE TABLE ACTIVE_EVENTS(ID INTEGER PRIMARY KEY, EVENT_FK,\n    FOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID)\n    );"}]}]},{"block_type":"element","block":"k6bfvb1c","search_text":"This table makes it easy to query what events are currently causing equipment failures.","text_count":87,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This table makes it easy to query what events are currently causing equipment failures."}]},{"block_type":"element","block":"k6bfvb1d","search_text":"Later, when the failing condition on the device clears, it sends a severity 1 event. This means that severity 1 events are never active, since they aren't contributing to a piece of equipment being down. In our previous method, we search for any active events that have the same hostname and condition, and delete them. Then we return False , indicating this is not an active event.","text_count":382,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Later, when the failing condition on the device clears, it sends a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"severity 1"}]},{"block_type":"text","content":"event. This means that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"severity 1"}]},{"block_type":"text","content":"events are never active, since they aren't contributing &nbsp;to a piece of equipment being down. In our previous method, we search for any active events that have the same hostname and condition, and delete them. Then we return"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"False"}]},{"block_type":"text","content":", indicating this is not an active event."}]},{"block_type":"element","block":"k6bfvb1e","search_text":"Write a method that evaluates the services and pieces of equipment that are affected by the network event: ","text_count":107,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Write a method that evaluates the services and pieces of equipment that are affected by the network event:"}]}]}]},{"block_type":"element","block":"k6bfvb1f","search_text":"def impact(self, event): \"\"\"Look up this event has impact on either equipment or services.\"\"\" affected_equipment = self.dt.query(\\ \"\"\"select * from EQUIPMENT where HOST_NAME = ?\"\"\", (event.hostname,), rowhandler=DictionaryRowMapper()) affected_services = self.dt.query(\\ \"\"\"select SERVICE.* from SERVICE join SERVICE_MAPPING SM on (SERVICE.ID = SM.SERVICE_FK) join EQUIPMENT on (SM.EQUIPMENT_FK = EQUIPMENT.ID) where EQUIPMENT.HOST_NAME = ?\"\"\", (event.hostname,), rowhandler=DictionaryRowMapper()) return (affected_services, affected_equipment)","text_count":544,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def impact(self, event):\n   \"\"\"Look up this event has impact on either equipment \n      or services.\"\"\"\n   affected_equipment = self.dt.query(\\\n               \"\"\"select * from EQUIPMENT \n                  where HOST_NAME = ?\"\"\",\n               (event.hostname,), \n               rowhandler=DictionaryRowMapper())\n   affected_services = self.dt.query(\\\n               \"\"\"select SERVICE.* from   SERVICE\n                  join SERVICE_MAPPING SM\n                  on (SERVICE.ID = SM.SERVICE_FK)\n                  join EQUIPMENT\n                  on (SM.EQUIPMENT_FK = EQUIPMENT.ID) where\n                  EQUIPMENT.HOST_NAME = ?\"\"\",\n                  (event.hostname,),                   \n                  rowhandler=DictionaryRowMapper())\n   return (affected_services, affected_equipment)"}]}]},{"block_type":"element","block":"k6bfvb1g","search_text":"We first query the EQUIPMENT table to see if event.hostname matches anything. Next, we join the SERVICE table to the EQUIPMENT table through a many-to-many relationship tracked by the SERVICE_MAPPING table. Any service that is related to the equipment that the event was reported on is captured. Finally, we return a tuple containing both the list of equipment and list of services that are potentially impacted. ","text_count":413,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We first query the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EQUIPMENT"}]},{"block_type":"text","content":"table to see if"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"event.hostname"}]},{"block_type":"text","content":"matches anything."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, we join the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE"}]},{"block_type":"text","content":"table to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EQUIPMENT"}]},{"block_type":"text","content":"table through a many-to-many relationship tracked by the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE_MAPPING"}]},{"block_type":"text","content":"table. Any service that is related to the equipment that the event was reported on is captured."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, we return a tuple containing both the list of equipment and list of services that are potentially impacted."}]}]}]}]},{"block_type":"element","block":"k6bfvb1h","search_text":"Note Spring Python provides a convenient query operation that returns a list of objects mapped to every row of the query. It also provides an out-of-the-box DictionaryRowMapper that converts each row into a Python dictionary, with the keys matching the column names. ","text_count":267,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Spring Python provides a convenient query operation that returns a list of objects mapped to every row of the query. It also provides an out-of-the-box"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictionaryRowMapper"}]},{"block_type":"text","content":"that converts each row into a Python dictionary, with the keys matching the column names."}]}]},{"block_type":"element","block":"k6bfvb1i","search_text":"Add the table definitions to the SQL script for EQUIPMENT , SERVICE , and SERVICE_MAPPING : ","text_count":92,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Add the table definitions to the SQL script for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EQUIPMENT"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE"}]},{"block_type":"text","content":", and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE_MAPPING"}]},{"block_type":"text","content":":"}]}]}]},{"block_type":"element","block":"k6bfvb1j","search_text":"CREATE TABLE EQUIPMENT( ID INTEGER PRIMARY KEY, HOST_NAME TEXT UNIQUE, STATUS INTEGER ); CREATE TABLE SERVICE ( ID INTEGER PRIMARY KEY, NAME TEXT UNIQUE, STATUS TEXT ); CREATE TABLE SERVICE_MAPPING ( ID INTEGER PRIMARY KEY, SERVICE_FK,EQUIPMENT_FK, FOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID), FOREIGN KEY(EQUIPMENT_FK) REFERENCES EQUIPMENT(ID));","text_count":349,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"CREATE TABLE EQUIPMENT(\n      ID INTEGER PRIMARY KEY, \n      HOST_NAME TEXT UNIQUE,\n      STATUS INTEGER );\nCREATE TABLE SERVICE (\n      ID INTEGER PRIMARY KEY, \n      NAME TEXT UNIQUE, \n      STATUS TEXT );\nCREATE TABLE SERVICE_MAPPING (\n      ID INTEGER PRIMARY KEY, \n      SERVICE_FK,EQUIPMENT_FK,\n      FOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID),\n      FOREIGN KEY(EQUIPMENT_FK) REFERENCES EQUIPMENT(ID));"}]}]},{"block_type":"element","block":"k6bfvb1k","search_text":"Write the update_service method, which stores or clears service-related events and then updates the service's status based on the remaining active events: ","text_count":155,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"update_service"}]},{"block_type":"text","content":"method, which stores or clears service-related events and then updates the service's status based on the remaining active events:"}]}]},{"block_type":"element","block":"k6bfvb1l","search_text":"def update_service(self, service, event): if event.severity == 1: self.dt.update(\"\"\"delete from SERVICE_EVENTS where EVENT_FK in (select ID from EVENTS where HOST_NAME = ? and EVENT_CONDITION = ?)\"\"\", (event.hostname,event.condition)) else: self.dt.execute(\"\"\"insert into SERVICE_EVENTS (EVENT_FK, SERVICE_FK) values (?,?)\"\"\", (event.id,service[\"ID\"])) try: max = self.dt.query_for_int(\\ \"\"\"select max(EVENTS.SEVERITY) from SERVICE_EVENTS SE join EVENTS on (EVENTS.ID = SE.EVENT_FK) join SERVICE on (SERVICE.ID = SE.SERVICE_FK) where SERVICE.NAME = ?\"\"\", (service[\"NAME\"],)) except DataAccessException, e: max=1 if max > 1 and service[\"STATUS\"] == \"Operational\": service[\"STATUS\"] = \"Outage\" self.dt.update(\"\"\"update SERVICE set STATUS = ? where ID = ?\"\"\", (service[\"STATUS\"], service[\"ID\"])) if max == 1 and service[\"STATUS\"] == \"Outage\": service[\"STATUS\"] = \"Operational\" self.dt.update(\"\"\"update SERVICE set STATUS = ? where ID = ?\"\"\", (service[\"STATUS\"], service[\"ID\"])) if event.severity == 1: return {\"service\":service, \"is_active\":False} else: return {\"service\":service, \"is_active\":True}","text_count":1095,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def update_service(self, service, event):\n    if event.severity == 1:\n        self.dt.update(\"\"\"delete from SERVICE_EVENTS\n                          where EVENT_FK in (select ID from EVENTS\n                          where HOST_NAME = ?\n                          and EVENT_CONDITION = ?)\"\"\",\n                          (event.hostname,event.condition))\n    else:\n      self.dt.execute(\"\"\"insert into SERVICE_EVENTS \n                         (EVENT_FK, SERVICE_FK) values (?,?)\"\"\",\n                         (event.id,service[\"ID\"]))\n    try:\n      max = self.dt.query_for_int(\\\n                      \"\"\"select max(EVENTS.SEVERITY)   \n                         from SERVICE_EVENTS SE join EVENTS\n                         on (EVENTS.ID = SE.EVENT_FK) join SERVICE\n                         on (SERVICE.ID = SE.SERVICE_FK)\n                         where SERVICE.NAME = ?\"\"\", \n                         (service[\"NAME\"],))\n    except DataAccessException, e:\n           max=1\n    if max &gt; 1 and service[\"STATUS\"] == \"Operational\":\n       service[\"STATUS\"] = \"Outage\"\n       self.dt.update(\"\"\"update SERVICE\n                         set STATUS = ? \n                         where ID = ?\"\"\",\n                     (service[\"STATUS\"], service[\"ID\"]))\n\n    if max == 1 and service[\"STATUS\"] == \"Outage\":\n       service[\"STATUS\"] = \"Operational\"\n       self.dt.update(\"\"\"update SERVICE set STATUS = ?\n                         where ID = ?\"\"\",\n                     (service[\"STATUS\"], service[\"ID\"]))\n    if event.severity == 1:\n       return {\"service\":service, \"is_active\":False}\n    else:\n       return {\"service\":service, \"is_active\":True}"}]}]},{"block_type":"element","block":"k6bfvb1m","search_text":"Service-related events are active events related to a service. A single event can be related to many services. For example, what if we were monitoring a wireless router that provided internet service to a lot of users, and it reported a critical error? This one event would be mapped as an impact to all the end users. When a new active event is processed, it is stored in SERVICE_EVENTS for each related service.","text_count":413,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Service-related events are active events related to a service. A single event can be related to many services. For example, what if we were monitoring a wireless router that provided internet service to a lot of users, and it reported a critical error? This one event would be mapped as an impact to all the end users. When a new active event is processed, it is stored in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE_EVENTS"}]},{"block_type":"text","content":"for each related service."}]},{"block_type":"element","block":"k6bfvb1n","search_text":"Then, when a clearing event is processed, the previous service event must be deleted from the SERVICE_EVENTS table.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, when a clearing event is processed, the previous service event must be deleted from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE_EVENTS"}]},{"block_type":"text","content":"table."}]},{"block_type":"element","block":"k6bfvb1o","search_text":"Add the table definition for SERVICE_EVENTS to the SQL script: ","text_count":63,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the table definition for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE_EVENTS"}]},{"block_type":"text","content":"to the SQL script:"}]}]},{"block_type":"element","block":"k6bfvb1p","search_text":"CREATE TABLE SERVICE_EVENTS ( ID INTEGER PRIMARY KEY, SERVICE_FK, EVENT_FK,FOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID), FOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID));","text_count":168,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"CREATE TABLE SERVICE_EVENTS ( \n    ID INTEGER PRIMARY KEY, \n    SERVICE_FK,\n    EVENT_FK,FOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID),\n    FOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID));"}]}]},{"block_type":"element","block":"k6bfvb1q","search_text":"Note It is important to recognize that deleting an entry from SERVICE_EVENTS doesn't mean that we delete the original event from the EVENTS table. Instead, we are merely indicating that the original active event is no longer active and it does not impact the related service. ","text_count":276,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is important to recognize that deleting an entry from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SERVICE_EVENTS"}]},{"block_type":"text","content":"doesn't mean that we delete the original event from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EVENTS"}]},{"block_type":"text","content":"table. Instead, we are merely indicating that the original active event is no longer active and it does not impact the related service."}]}]},{"block_type":"element","block":"k6bfvb1r","search_text":"Prepend the entire SQL script with DROP statements, making it possible to run the script for several recipes: ","text_count":110,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepend the entire SQL script with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DROP"}]},{"block_type":"text","content":"statements, making it possible to run the script for several recipes:"}]}]},{"block_type":"element","block":"k6bfvb1s","search_text":"DROP TABLE IF EXISTS SERVICE_MAPPING; DROP TABLE IF EXISTS SERVICE_EVENTS; DROP TABLE IF EXISTS ACTIVE_EVENTS; DROP TABLE IF EXISTS EQUIPMENT; DROP TABLE IF EXISTS SERVICE; DROP TABLE IF EXISTS EVENTS;","text_count":201,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"DROP TABLE IF EXISTS SERVICE_MAPPING;\nDROP TABLE IF EXISTS SERVICE_EVENTS;\nDROP TABLE IF EXISTS ACTIVE_EVENTS;\nDROP TABLE IF EXISTS EQUIPMENT;\nDROP TABLE IF EXISTS SERVICE;\nDROP TABLE IF EXISTS EVENTS;"}]}]},{"block_type":"element","block":"k6bfvb1t","search_text":"Append the SQL script used to set up the database with inserts to pre-load some equipment and services: ","text_count":104,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Append the SQL script used to set up the database with inserts to pre-load some equipment and services:"}]}]},{"block_type":"element","block":"k6bfvb1u","search_text":"INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1,'pyhost1', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2,'pyhost2', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3,'pyhost3', 1); INSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', 'Operational'); INSERT into SERVICE (ID, NAME, STATUS) values (2, 'service-xyz', 'Outage'); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (2,1); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (2,3);","text_count":645,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1,'pyhost1', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2,'pyhost2', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3,'pyhost3', 1);\nINSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', 'Operational');\nINSERT into SERVICE (ID, NAME, STATUS) values (2, 'service-xyz', 'Outage');\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1);\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2);\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (2,1);\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (2,3);"}]}]},{"block_type":"element","block":"k6bfvb1v","search_text":"Finally, write a method that updates the equipment status based on the currently active events: ","text_count":96,"tag_name":"ol","attributes":{"start":"15"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, write a method that updates the equipment status based on the currently active events:"}]}]},{"block_type":"element","block":"k6bfvb1w","search_text":"def update_equipment(self,equip,event): try: max = self.dt.query_for_int(\\ \"\"\"select max(EVENTS.SEVERITY) from ACTIVE_EVENTS AE join EVENTS on (EVENTS.ID = AE.EVENT_FK) where EVENTS.HOST_NAME = ?\"\"\", (event.hostname,)) except DataAccessException: max = 1 if max != equip[\"STATUS\"]: equip[\"STATUS\"] = max self.dt.update(\"\"\"update EQUIPMENT set STATUS = ?\"\"\", (equip[\"STATUS\"],)) return equip","text_count":390,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def update_equipment(self,equip,event):\n    try:\n      max = self.dt.query_for_int(\\\n                  \"\"\"select max(EVENTS.SEVERITY) \n                     from ACTIVE_EVENTS AE\n                     join EVENTS on (EVENTS.ID = AE.EVENT_FK) \n                     where EVENTS.HOST_NAME = ?\"\"\",\n                  (event.hostname,))\n    except DataAccessException:\n        max = 1\n    if max != equip[\"STATUS\"]:\n         equip[\"STATUS\"] = max \n         self.dt.update(\"\"\"update EQUIPMENT\n                           set STATUS = ?\"\"\",\n                        (equip[\"STATUS\"],))\n    return equip"}]}]},{"block_type":"element","block":"k6bfvb1x","search_text":"Here, we need to find the maximum severity from the list of active events for a given host name. If there are no active events, then Spring Python raises a DataAccessException and we translate that to a severity of 1.","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Here, we need to find the maximum severity from the list of active events for a given host name. If there are no active events, then Spring Python raises a DataAccessException and we translate that to a severity of 1."}]},{"block_type":"element","block":"k6bfvb1y","search_text":"We check whether this is different from the existing device's status. If so, we issue a SQL update. Finally, we return the record for the device, with its status updated appropriately.","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We check whether this is different from the existing device's status. If so, we issue a SQL update. Finally, we return the record for the device, with its status updated appropriately."}]},{"block_type":"element","block":"k6bfvb1z","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb20","search_text":"This application uses a database-backed mechanism to process incoming network events, and checks them against the inventory of equipment and services to evaluate failures and restorations. Our application doesn't handle specialized devices or unusual types of service. This real-world complexity has been traded in for a relatively simple application that can be used to write various test recipes.","text_count":398,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This application uses a database-backed mechanism to process incoming network events, and checks them against the inventory of equipment and services to evaluate failures and restorations. Our application doesn't handle specialized devices or unusual types of service. This real-world complexity has been traded in for a relatively simple application that can be used to write various test recipes."}]},{"block_type":"element","block":"k6bfvb21","search_text":"Note Events typically map to a single piece of equipment and to zero or more services. A service can be thought of as a string of equipment used to provide a type of service to the customer. New failing events are considered active until a clearing event arrives. Active events, when aggregated against a piece of equipment, define its current status. Active events, when aggregated against a service, define the service's current status. ","text_count":439,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Events typically map to a single piece of equipment and to zero or more services. A service can be thought of as a string of equipment used to provide a type of service to the customer. New failing events are considered active until a clearing event arrives. Active events, when aggregated against a piece of equipment, define its current status. Active events, when aggregated against a service, define the service's current status."}]}]},{"block_type":"element","block":"k6bfvb22","search_text":"Installing and running coverage on your test suite","text_count":50,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Installing and running coverage on your test suite"}]},{"block_type":"element","block":"k6bfvb23","search_text":"Install the coverage tool and run it against your test suite. Then you can view a report showing what lines were covered by the test suite.","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Install the coverage tool and run it against your test suite. Then you can view a report showing what lines were covered by the test suite."}]},{"block_type":"element","block":"k6bfvb24","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb25","search_text":"With the following steps, we will build some unittests and then run them through the coverage tool:","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the following steps, we will build some unittests and then run them through the coverage tool:"}]},{"block_type":"element","block":"k6bfvb26","search_text":"Create a new file called recipe52.py to contain our test code for this recipe. Write a simple unit test that injects a single, alarming event into the system: ","text_count":159,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe52.py"}]},{"block_type":"text","content":"to contain our test code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a simple unit test that injects a single, alarming event into the system:"}]}]},{"block_type":"element","block":"k6bfvb27","search_text":"from network import * import unittest from springpython.database.factory import * from springpython.database.core import * class EventCorrelationTest(unittest.TestCase): def setUp(self): db_name = \"recipe52.db\" factory = Sqlite3ConnectionFactory(db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, \\ updated_services, updated_equipment = \\ self.correlator.process(evt1) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\" if __name__ == \"main\": unittest.main() ","text_count":868,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from network import * \nimport unittest\nfrom springpython.database.factory import *\nfrom springpython.database.core import *\nclass EventCorrelationTest(unittest.TestCase):\n      def setUp(self):\n          db_name = \"recipe52.db\"\n          factory = Sqlite3ConnectionFactory(db_name)\n          self.correlator = EventCorrelator(factory)\n          dt = DatabaseTemplate(factory)\n          sql = open(\"network.sql\").read().split(\";\")\n          for statement in sql:\n              dt.execute(statement + \";\")\n      def test_process_events(self):\n          evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n          stored_event, is_active, \\\n                updated_services, updated_equipment = \\\n                self.correlator.process(evt1)\n          print \"Stored event: %s\" % stored_event\n          if is_active:\n             print \"This event was an active event.\"\n             print \"Updated services: %s\" % updated_services\n             print \"Updated equipment: %s\" % updated_equipment\n             print \"---------------------------------\"\nif __name__ == \"main\":\n     unittest.main()"}]}]},{"block_type":"element","block":"k6bfvb28","search_text":"Clear out any existing coverage report data using coverage -e . Run the test suite using the coverage tool: ","text_count":108,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Clear out any existing coverage report data using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -e"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite using the coverage tool:"}]}]},{"block_type":"element","block":"k6bfvb29","search_text":"gturnquist$ coverage -x recipe52.py Stored event: (ID:1) pyhost1:serverRestart - 5 This event was an active event. Updated services: [{'is_active': True, 'service': {'STATUS': 'Outage', 'ID': 1, 'NAME': u'service-abc'}}, {'is_active': True, 'service': {'STATUS': u'Outage', 'ID': 2, 'NAME': u'service- xyz'}}] Updated equipment: [{'STATUS': 5, 'ID': 1, 'HOST_NAME': u'pyhost1'}] --------------------------------- . ------------------------------------------------------------------ ---- Ran 1 test in 0.211s OK ","text_count":511,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ coverage -x recipe52.py\nStored event: (ID:1) pyhost1:serverRestart - 5 This event was an active event.\nUpdated services: [{'is_active': True, 'service': {'STATUS': 'Outage', 'ID': 1, 'NAME': u'service-abc'}}, {'is_active': True, 'service': {'STATUS': u'Outage', 'ID': 2, 'NAME': u'service- xyz'}}] \nUpdated equipment: [{'STATUS': 5, 'ID': 1, 'HOST_NAME': u'pyhost1'}]\n---------------------------------\n\n.\n\n------------------------------------------------------------------\n----\nRan 1 test in 0.211s OK"}]}]},{"block_type":"element","block":"k6bfvb2a","search_text":"Print out the report captured by the previous command by typing coverage -r . If the report shows several other modules listed from Python's standard libraries, it's a hint that you have an older version of the coverage tool installed. If so, uninstall the old version by typing pip uninstall coverage followed by reinstalling with pip install coverage : ","text_count":355,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print out the report captured by the previous command by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -r"}]},{"block_type":"text","content":". If the report shows several other modules listed from Python's standard libraries, it's a hint that you have an older version of the coverage tool installed. If so, uninstall the old version by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip uninstall coverage"}]},{"block_type":"text","content":"followed by reinstalling with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install coverage"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvb2b","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000076.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb2c","search_text":"Create another file called recipe52b.py to contain a different test suite. Write another test suite that generates two faults and then clears them out: ","text_count":152,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Create another file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe52b.py"}]},{"block_type":"text","content":"to contain a different test suite."}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Write another test suite that generates two faults and then clears them out:"}]}]}]},{"block_type":"element","block":"k6bfvb2d","search_text":"from network import* import unittest from springpython.database.factory import* from springpython.database.core import* class EventCorrelationTest(unittest.TestCase): def setUp(self): db_name = \"recipe52b.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) evt2 = Event(\"pyhost2\", \"lineStatus\", 5) evt3 = Event(\"pyhost2\", \"lineStatus\", 1) evt4 = Event(\"pyhost1\", \"serverRestart\", 1) for event in [evt1, evt2, evt3, evt4]: stored_event, is_active, \\ updated_services, updated_equipment = \\ self.correlator.process(event) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\" if __name__ == \"__main__\": unittest.main()","text_count":1038,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from network import*\nimport unittest\nfrom springpython.database.factory import*\nfrom springpython.database.core import*\nclass EventCorrelationTest(unittest.TestCase):\n      def setUp(self):\n          db_name = \"recipe52b.db\"\n          factory = Sqlite3ConnectionFactory(db=db_name)\n          self.correlator = EventCorrelator(factory)\n          dt = DatabaseTemplate(factory)\n          sql = open(\"network.sql\").read().split(\";\")\n          for statement in sql:\n             dt.execute(statement + \";\")\n      def test_process_events(self):\n          evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n          evt2 = Event(\"pyhost2\", \"lineStatus\", 5)\n          evt3 = Event(\"pyhost2\", \"lineStatus\", 1)\n          evt4 = Event(\"pyhost1\", \"serverRestart\", 1)\n          for event in [evt1, evt2, evt3, evt4]:\n              stored_event, is_active, \\ \n                 updated_services, updated_equipment = \\\n                  self.correlator.process(event)\n              print \"Stored event: %s\" % stored_event\n              if is_active:\n                print \"This event was an active event.\"\n                print \"Updated services: %s\" % updated_services\n                print \"Updated equipment: %s\" % updated_equipment\n                print \"---------------------------------\"\n  if __name__ == \"__main__\": \n     unittest.main()"}]}]},{"block_type":"element","block":"k6bfvb2e","search_text":"Run this test suite through the coverage tool using coverage -x recipe52b.py . Print out the report by typing coverage -r : ","text_count":124,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run this test suite through the coverage tool using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -x recipe52b.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print out the report by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -r"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvb2f","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000067.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb2g","search_text":"The first test suite only injects a single alarm. We expect it to cause a service outage and take its related piece of equipment down. Since this would not exercise any event clearing logic, we certainly don't expect 100% code coverage.","text_count":236,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first test suite only injects a single alarm. We expect it to cause a service outage and take its related piece of equipment down. Since this would"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"exercise any event clearing logic, we certainly don't expect 100% code coverage."}]},{"block_type":"element","block":"k6bfvb2h","search_text":"In the report, we can see that it says network.py had 65 statements, and has executed 55 of them, resulting in 85% coverage. We also see that recipe52.py had 23 statements and executed all of them. This means all of our test code ran.","text_count":234,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the report, we can see that it says&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.py"}]},{"block_type":"text","content":"&nbsp;had 65 statements, and has executed 55 of them, resulting in 85% coverage. We also see that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe52.py"}]},{"block_type":"text","content":"had 23 statements and executed all of them. This means all of our test code ran."}]},{"block_type":"element","block":"k6bfvb2i","search_text":"At this point, we realize that we are only testing the alarming part of the event correlator. To make this more effective, we should inject another alarm, followed by a couple of clears to make sure that everything clears out and the services return to operational status. This should result in 100% coverage in our simple application.","text_count":335,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At this point, we realize that we are only testing the alarming part of the event correlator. To make this more effective, we should inject another alarm, followed by a couple of clears to make sure that everything clears out and the services return to operational status. This should result in 100% coverage in our simple application."}]},{"block_type":"element","block":"k6bfvb2j","search_text":"The second screenshot indeed shows that we have reached full coverage of network.py .","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The second screenshot indeed shows that we have reached full coverage of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb2k","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb2l","search_text":"We also see Spring Python reported as well. If we had used any other third-party libraries, then they would also appear. Is this right? It depends. The previous comments seem to indicate that we don't really care about coverage of Spring Python, but in other situations, we might be very interested. And how can the coverage tool know where to draw the line?","text_count":358,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also see Spring Python reported as well. If we had used any other third-party libraries, then they would also appear. Is this right? It depends. The previous comments seem to indicate that we don't really care about coverage of Spring Python, but in other situations, we might be very interested. And how can the coverage tool know where to draw the line?"}]},{"block_type":"element","block":"k6bfvb2m","search_text":"In later recipes, we will look into how to be more selective of what to measure so we can filter out the noise.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In later recipes, we will look into how to be more selective of what to measure so we can filter out the noise."}]},{"block_type":"element","block":"k6bfvb2n","search_text":"Why are there no asserts in unittest?","text_count":37,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why are there no asserts in unittest?"}]},{"block_type":"element","block":"k6bfvb2o","search_text":"It is true that unittest isn't adequate with regard to testing outcomes. To draw up this recipe, I visually inspected the output to see whether the network management application was performing as expected. But this is incomplete. A real production grade unit test needs to finish this with a set of assertions so that visual scanning is not needed.","text_count":349,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is true that unittest isn't adequate with regard to testing outcomes. To draw up this recipe, I visually inspected the output to see whether the network management application was performing as expected. But this is incomplete. A real production grade unit test needs to finish this with a set of assertions so that visual scanning is not needed."}]},{"block_type":"element","block":"k6bfvb2p","search_text":"So why didn't we code any? Because the focus of this recipe was on how to generate a coverage report and then use that information to enhance the testing. We covered both of these things. By thinking about what was and wasn't tested, we wrote a comprehensive test that shows services going into outage and back to operational status. We just didn't just confirm this automatically.","text_count":381,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So why didn't we code any? Because the focus of this recipe was on how to generate a coverage report and then use that information to enhance the testing. We covered both of these things. By thinking about what was and wasn't tested, we wrote a comprehensive test that shows services going into outage and back to operational status. We just didn't just confirm this automatically."}]},{"block_type":"element","block":"k6bfvb2q","search_text":"Generating an HTML report using coverage","text_count":40,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Generating an HTML report using coverage"}]},{"block_type":"element","block":"k6bfvb2r","search_text":"Using the coverage tool, generate an HTML visual coverage report. This is useful because we can drill into the source code and see what lines did not run in the test procedures.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using the coverage tool, generate an HTML visual coverage report. This is useful because we can drill into the source code and see what lines did not run in the test procedures."}]},{"block_type":"element","block":"k6bfvb2s","search_text":"Reading a coverage report without reading the source code is not very useful. It may be tempting to compare two different projects based on the coverage percentages. But unless the actual code is analyzed, this type of comparison can lead to faulty conclusions about the quality of the software.","text_count":295,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Reading a coverage report without reading the source code is not very useful. It may be tempting to compare two different projects based on the coverage percentages. But unless the actual code is analyzed, this type of comparison can lead to faulty conclusions about the quality of the software."}]},{"block_type":"element","block":"k6bfvb2t","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb2u","search_text":"With these steps, we will explore creating a nicely viewable HTML coverage report:","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore creating a nicely viewable HTML coverage report:"}]},{"block_type":"element","block":"k6bfvb2v","search_text":"Generate coverage metrics by following the steps in the Installing and running coverage on your test suite recipe and only running the first test suite (which resulted in less than 100% coverage). Generate an HTML report by typing coverage.html . ","text_count":247,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate coverage metrics by following the steps in the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing and running coverage"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"on your test suite"}]},{"block_type":"text","content":"recipe and only running the first test suite (which resulted in less than 100% coverage)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate an HTML report by typing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvb2w","search_text":"Open htmlcov/index.html using your favorite browser and inspect the overall report: ","text_count":84,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"htmlcov/index.html"}]},{"block_type":"text","content":"using your favorite browser and inspect the overall report:"}]}]},{"block_type":"element","block":"k6bfvb2x","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000060.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb2y","search_text":"Click on network, and scroll down to see where the event clearing logic didn't run due to no clearing events being processed: ","text_count":126,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on&nbsp;network, and scroll down to see where the event clearing logic didn't run due to no clearing events being processed:"}]}]},{"block_type":"element","block":"k6bfvb2z","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000050.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb30","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb31","search_text":"The coverage tool has a built-in feature to generate an HTML report. This provides a powerful way to visually inspect the source code and see which lines were not executed.","text_count":172,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool has a built-in feature to generate an HTML report. This provides a powerful way to visually inspect the source code and see which lines were not executed."}]},{"block_type":"element","block":"k6bfvb32","search_text":"By looking at this report, we can clearly see that the lines that were not executed relate to the lack of clearing network events that are being processed. This tips us off about another test case, which involves clearing events that need to be drafted.","text_count":253,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By looking at this report, we can clearly see that the lines that were not executed relate to the lack of clearing network events that are being processed. This tips us off about another test case, which involves clearing events that need to be drafted."}]},{"block_type":"element","block":"k6bfvb33","search_text":"Generating an XML report using coverage","text_count":39,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Generating an XML report using coverage"}]},{"block_type":"element","block":"k6bfvb34","search_text":"The coverage tool can generate an XML coverage report in Cobertura format ( http://cobertura.sourceforge.net/ ). This is useful if we want to process the coverage information in another tool. In this recipe, we will see how to use the coverage command-line tool, and then view the XML report by hand.","text_count":300,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool can generate an XML coverage report in Cobertura format ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://cobertura.sourceforge.net/"},"children":[{"block_type":"text","content":"http://cobertura.sourceforge.net/"}]},{"block_type":"text","content":"). This is useful if we want to process the coverage information in another tool. In this recipe, we will see how to use the coverage command-line tool, and then view the XML report by hand."}]},{"block_type":"element","block":"k6bfvb35","search_text":"It's important to understand that reading a coverage report without reading the source code is not very useful. It may be tempting to compare two different projects based on the coverage percentages. But unless the actual code is analyzed, this type of comparison can lead to faulty conclusions about the quality of the software.","text_count":329,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to understand that reading a coverage report without reading the source code &nbsp;&nbsp;is not very useful. It may be tempting to compare two different projects based on the coverage percentages. But unless the actual code is analyzed, this type of comparison can lead to &nbsp;faulty conclusions about the quality of the software."}]},{"block_type":"element","block":"k6bfvb36","search_text":"For example, a project with 85% coverage may appear, on the surface, to be better tested than one with 60%. However, if the 60% application has much more thoroughly exhaustive scenarios—as they are only covering the core parts of the system that are in heavy use—then it may be much more stable than the 85% application.","text_count":320,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, a project with 85% coverage may appear, on the surface, to be better tested than one with 60%. However, if the 60% application has much more thoroughly exhaustive scenarios&mdash;as they are only covering the core parts of the system that are in heavy use&mdash;then it may be much more stable than the 85% application."}]},{"block_type":"element","block":"k6bfvb37","search_text":"Note Coverage analysis serves a useful purpose when comparing test results between iterations, and when we use it to decide which scenarios need to be added to our testing repertoire. ","text_count":184,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Coverage analysis serves a useful purpose when comparing test results between iterations, and when we use it to decide which scenarios need to be added to our testing repertoire."}]}]},{"block_type":"element","block":"k6bfvb38","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb39","search_text":"With these steps, we will discover how to create an XML report that is consumable by other tools, using the coverage tool:","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will discover how to create an XML report that is consumable by other tools,&nbsp;using the coverage tool:"}]},{"block_type":"element","block":"k6bfvb3a","search_text":"Generate coverage metrics by following the steps in Installing and running coverage on your test suite recipe (mentioned in Chapter 1, Using Unittest to Develop Basic Tests ) and only running the first test suite (which resulted in less than 100% coverage). Generate an XML report by typing coverage xml . Open coverage.xml using your favorite text or XML editor. The format of the XML is the same as Cobertura—a Java code coverage analyzer. This means that many tools, such as Jenkins, can parse the results: ","text_count":510,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate coverage metrics by following the steps in"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing and running coverage"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"on your test suite"}]},{"block_type":"text","content":"recipe (mentioned in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Unittest to Develop Basic"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Tests"}]},{"block_type":"text","content":") and only running the first test suite (which resulted in less than 100% coverage)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate an XML report by typing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage xml"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage.xml"}]},{"block_type":"text","content":"using your favorite text or XML editor. The format of the XML is the same as Cobertura&mdash;a Java code coverage analyzer. This means that many tools, such as Jenkins, can parse the results:"},{"block_type":"element","tag_name":"p","attributes":{},"children":[]}]}]},{"block_type":"element","block":"k6bfvb3b","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000038.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb3c","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb3d","search_text":"The coverage tool has a built-in feature that generates an XML report. This provides a powerful way to parse the output using some type of external tool.","text_count":153,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool has a built-in feature that generates an XML report. This provides a powerful way to parse the output using some type of external tool."}]},{"block_type":"element","block":"k6bfvb3e","search_text":"Note In the previous screenshot, I opened it using Spring Tool Suite (you can download it from http://www.springsource.com/developer/sts) , partly because I happen to use STS every day, but you can use any text or XML editor you like. ","text_count":235,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the previous screenshot, I opened it using Spring Tool Suite (you can download it from"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.springsource.com/developer/sts)"},"children":[{"block_type":"text","content":"http://www.springsource.com/developer/sts)"}]},{"block_type":"text","content":", partly because I happen to use STS every day, but you can use any text or XML editor you like."}]}]},{"block_type":"element","block":"k6bfvb3f","search_text":"What use is an XML report?","text_count":26,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What use is an XML report?"}]},{"block_type":"element","block":"k6bfvb3g","search_text":"XML is not the best way to communicate coverage information to users. Generating an HTML report with coverage is a more practical recipe when it comes to human users.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"XML is not the best way to communicate coverage information to users."},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating an HTML"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"report with coverage"}]},{"block_type":"text","content":"is a more practical recipe when it comes to human users."}]},{"block_type":"element","block":"k6bfvb3h","search_text":"What if we want to capture a coverage report and publish it inside a continuous integration system such as Jenkins? All we need to do is install the Cobertura plugin (refer to https://wiki.jenkins-ci.org/display/JENKINS/Cobertura+Plugin ), and this report becomes traceable. Jenkins can nicely monitor trends in coverage and give us more feedback as we develop our system.","text_count":372,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What if we want to capture a coverage report and publish it inside a continuous integration system such as Jenkins? All we need to do is install the Cobertura plugin (refer to&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://wiki.jenkins-ci.org/display/JENKINS/Cobertura+Plugin"},"children":[{"block_type":"text","content":"https://wiki.jenkins-ci.org/display/JENKINS/Cobertura+Plugin"}]},{"block_type":"text","content":"), and this report becomes traceable. Jenkins can nicely monitor trends in coverage and give us more feedback as we develop our system."}]},{"block_type":"element","block":"k6bfvb3i","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvb3j","search_text":"Letting Jenkins get nosy with coverage Generating an HTML report using coverage ","text_count":80,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Letting Jenkins get nosy with coverage"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating an HTML report using coverage"}]}]}]},{"block_type":"element","block":"k6bfvb3k","search_text":"Getting nosy with coverage","text_count":26,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Getting nosy with coverage"}]},{"block_type":"element","block":"k6bfvb3l","search_text":"Install the coverage nose plugin, and run your test suite using nose. This provides a quick and convenient report using the ubiquitous nosetests tool. This recipe assumes you have already created the network management application as described in the Building a network management application section.","text_count":301,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Install the coverage nose plugin, and run your test suite using nose. This provides a quick and convenient report using the ubiquitous nosetests tool. This recipe assumes you have already created the network management application as described in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building a network"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"management application"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k6bfvb3m","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb3n","search_text":"With these steps, we will see how to combine the coverage tool with nose:","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will see how to combine the coverage tool with nose:"}]},{"block_type":"element","block":"k6bfvb3o","search_text":"Create a new file called recipe55.py to store our test code. Create a test case that injects a faulty alarm: ","text_count":109,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe55.py"}]},{"block_type":"text","content":"to store our test code."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that injects a faulty alarm:"}]}]},{"block_type":"element","block":"k6bfvb3p","search_text":"from network import* import unittest from springpython.database.factory import* from springpython.database.core import* class EventCorrelationTest(unittest.TestCase): def setUp(self): db_name = \"recipe55.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, \\ updated_services, updated_equipment = \\ self.correlator.process(evt1) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\"","text_count":828,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from network import*\nimport unittest\nfrom springpython.database.factory import*\nfrom springpython.database.core import*\nclass EventCorrelationTest(unittest.TestCase):\n      def setUp(self):\n         db_name = \"recipe55.db\"\n         factory = Sqlite3ConnectionFactory(db=db_name)\n         self.correlator = EventCorrelator(factory)\n         dt = DatabaseTemplate(factory)\n         sql = open(\"network.sql\").read().split(\";\")\n         for statement in sql:\n            dt.execute(statement + \";\")\n      def test_process_events(self):\n         evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n         stored_event, is_active, \\ \n              updated_services, updated_equipment = \\\n         self.correlator.process(evt1)\n         print \"Stored event: %s\" % stored_event\n         if is_active:\n            print \"This event was an active event.\"\n            print \"Updated services: %s\" % updated_services\n            print \"Updated equipment: %s\" % updated_equipment\n            print \"---------------------------------\""}]}]},{"block_type":"element","block":"k6bfvb3q","search_text":"Run the test module using the coverage plugin by typing nosetests recipe55 – with-coverage : ","text_count":93,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test module using the coverage plugin by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests recipe55 &ndash; with-coverage"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvb3r","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000029.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb3s","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb3t","search_text":"The nose plugin for coverage invokes the coverage tool and provides a formatted report. For each module, it displays the following:","text_count":131,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The nose plugin for coverage invokes the coverage tool and provides a formatted report. For each module, it displays the following:"}]},{"block_type":"element","block":"k6bfvb3u","search_text":"Total number of statements Number of missed statements Percentage of covered statements Line numbers for the missed statements ","text_count":127,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Total number of statements"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Number of missed statements"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Percentage of covered statements"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Line numbers for the missed statements"}]}]},{"block_type":"element","block":"k6bfvb3v","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb3w","search_text":"A common behavior of nose is to alter stdout , disabling the print statements embedded in the test case.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common behavior of nose is to alter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"stdout"}]},{"block_type":"text","content":", disabling the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"print"}]},{"block_type":"text","content":"statements embedded in the test case."}]},{"block_type":"element","block":"k6bfvb3x","search_text":"Why use the nose plugin instead of the coverage tool directly?","text_count":62,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why use the nose plugin instead of the coverage tool directly?"}]},{"block_type":"element","block":"k6bfvb3y","search_text":"The coverage tool works fine by itself, as was demonstrated in other recipes in this chapter. However, nose is a ubiquitous testing tool used by many developers. Providing a plugin makes it easy to support this vast community by empowering users to run the exact set of test plugins they want, with coverage being part of that test complement.","text_count":343,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool works fine by itself, as was demonstrated in other recipes in this chapter. However, nose is a ubiquitous testing tool used by many developers. Providing a plugin makes it easy to support this vast community by empowering users to run the exact set of test plugins they want, with coverage being part of that test complement."}]},{"block_type":"element","block":"k6bfvb3z","search_text":"Why are SQLite3 and Spring Python included?","text_count":43,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why are SQLite3 and Spring Python included?"}]},{"block_type":"element","block":"k6bfvb40","search_text":"SQLite3 is a relational database library that is included with Python. It is file-based, which means that no separate processes are required to create and use a database. Details about Spring Python can be found in the earlier sections of this chapter.","text_count":252,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"SQLite3 is a relational database library that is included with Python. It is file-based, which means that no separate processes are required to create and use a database. Details about Spring Python can be found in the earlier sections of this chapter."}]},{"block_type":"element","block":"k6bfvb41","search_text":"The purpose of this recipe was to measure the coverage of our network management application and the corresponding test case. So why are these third-party libraries included? The coverage tool has no way of automatically knowing what we want and the things we don't want to see from a coverage perspective. To delve into this, refer to the next section, Filtering out test noise from coverage .","text_count":394,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The purpose of this recipe was to measure the coverage of our network management application and the corresponding test case. So why are these third-party libraries included? The coverage tool has no way of automatically knowing what we want and the things we don't want to see from a coverage perspective. To delve into this, refer to the next section,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Filtering out"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"test noise from coverage"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb42","search_text":"Filtering out test noise from coverage","text_count":38,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Filtering out test noise from coverage"}]},{"block_type":"element","block":"k6bfvb43","search_text":"Using command-line options, you can filter out counted lines. This recipe assumes you have already created the network management application as described in the Building a network management application section.","text_count":212,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using command-line options, you can filter out counted lines. This recipe assumes you have already created the network management application as described in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building a network"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"management application"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k6bfvb44","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb45","search_text":"With these steps, we will see how to filter out certain modules from being counted in our coverage report:","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will see how to filter out certain modules from being counted in our coverage report:"}]},{"block_type":"element","block":"k6bfvb46","search_text":"Create a test suite that exercises all the code functionality: ","text_count":63,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test suite that exercises all the code functionality:"}]}]},{"block_type":"element","block":"k6bfvb47","search_text":"from network import* import unittest from springpython.database.factory import* from springpython.database.core import * class EventCorrelationTest(unittest.TestCase): def setUp(self): db_name = \"recipe56.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) evt2 = Event(\"pyhost2\", \"lineStatus\", 5) evt3 = Event(\"pyhost2\", \"lineStatus\", 1) evt4 = Event(\"pyhost1\", \"serverRestart\", 1) for event in [evt1, evt2, evt3, evt4]: stored_event, is_active,\\ updated_services, updated_equipment=\\ self.correlator.process(event) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\" if __name__==\"__main__\": unittest.main()","text_count":1033,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from network import*\nimport unittest\nfrom springpython.database.factory import*\nfrom springpython.database.core import *\nclass EventCorrelationTest(unittest.TestCase):\n   def setUp(self):\n      db_name = \"recipe56.db\"\n      factory = Sqlite3ConnectionFactory(db=db_name)\n      self.correlator = EventCorrelator(factory)\n      dt = DatabaseTemplate(factory)\n      sql = open(\"network.sql\").read().split(\";\")\n      for statement in sql:\n        dt.execute(statement + \";\")\n   def test_process_events(self):\n       evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n       evt2 = Event(\"pyhost2\", \"lineStatus\", 5)\n       evt3 = Event(\"pyhost2\", \"lineStatus\", 1)\n       evt4 = Event(\"pyhost1\", \"serverRestart\", 1)\n       for event in [evt1, evt2, evt3, evt4]:\n           stored_event, is_active,\\\n              updated_services, updated_equipment=\\\n                  self.correlator.process(event)\n           print \"Stored event: %s\" % stored_event\n       if is_active:\n          print \"This event was an active event.\"\n          print \"Updated services: %s\" % updated_services\n          print \"Updated equipment: %s\" % updated_equipment\n          print \"---------------------------------\"\nif __name__==\"__main__\":\n   unittest.main()"}]}]},{"block_type":"element","block":"k6bfvb48","search_text":"Clear out any previous coverage data by running coverage -e . Run it using coverage -x recipe56.py . Generate a console report using coverage -r . In the following screenshot, observe how Spring Python is included in the report and reduces the total metric to 73%: ","text_count":265,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Clear out any previous coverage data by running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -e"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run it using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -x recipe56.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate a console report using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -r"}]},{"block_type":"text","content":". In the following screenshot, observe how Spring Python is included in the report and reduces the total metric to 73%:"}]}]},{"block_type":"element","block":"k6bfvb49","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000031.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb4a","search_text":"Clean out coverage data by running coverage -e . Run the test again using coverage run –source network.py,recipe56.py,recipe56.py . ","text_count":132,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Clean out coverage data by running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -e"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test again using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage run &ndash;source network.py,recipe56.py,recipe56.py"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvb4b","search_text":"Generate another console report using coverage -r . Notice in the next screenshot how Spring Python is no longer listed, bringing our total coverage back up to 100%: ","text_count":166,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate another console report using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -r"}]},{"block_type":"text","content":". Notice in the next screenshot how Spring Python is no longer listed, bringing our total coverage back up to 100%:"}]}]},{"block_type":"element","block":"k6bfvb4c","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000009.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb4d","search_text":"Clean out coverage data by running coverage -e . Run the test using coverage -x recipe56.py . Generate a console report using coverage -r recipe56.py network.py : ","text_count":163,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Clean out coverage data by running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -e"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -x recipe56.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate a console report using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage -r recipe56.py network.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvb4e","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000155.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb4f","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb4g","search_text":"Coverage provides the ability to decide which files will be analyzed and what files will be reported. The steps in the previous section gather metrics several times, either by running coverage with a restricted set of source files (in order to filter out Spring Python), or by requesting an explicit set of modules in the report.","text_count":329,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Coverage provides the ability to decide which files will be analyzed and what files will be reported. The steps in the previous section gather metrics several times, either by running coverage with a restricted set of source files (in order to filter out Spring Python), or by requesting an explicit set of modules in the report."}]},{"block_type":"element","block":"k6bfvb4h","search_text":"One question that arises from all this is, What's the best choice? For our test scenario, the two choices were equivalent. With approximately the same amount of typing, we filtered out Spring Python and got a report showing network.py and recipe56.py with 100% coverage either way. However, a real project with a lot of modules and possibly different teams working in different areas would probably do better by gathering all the metric data available and filtering at the report level.","text_count":486,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One question that arises from all this is,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"What's the best choice?"}]},{"block_type":"text","content":"For our test scenario, the two choices were equivalent. With approximately the same amount of typing, we filtered out Spring Python and got a report showing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.py"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe56.py"}]},{"block_type":"text","content":"with 100% coverage either way. However, a real project with a lot of modules and possibly different teams working in different areas would probably do better by gathering all the metric data available and filtering at the report level."}]},{"block_type":"element","block":"k6bfvb4i","search_text":"This way, different reports on subsystems can be run as needed without having to keep recapturing metric data, and an overall report can still be run for the whole system coverage, all from the same gathered data.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This way, different reports on subsystems can be run as needed without having to keep recapturing metric data, and an overall report can still be run for the whole system coverage, all from the same gathered data."}]},{"block_type":"element","block":"k6bfvb4j","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb4k","search_text":"The options used in the previous section were inclusive. We picked what was to be included. The coverage tool also comes with an –omit option. The challenge is that it's a file-based option, not module-based. It doesn't work to use –omit springpython . Instead, every file must be specified, and in this case that would have required four complete files to exclude it all.","text_count":372,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The options used in the previous section were inclusive. We picked what was to be included. The coverage tool also comes with an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ndash;omit"}]},{"block_type":"text","content":"option. The challenge is that it's a file-based option, not module-based. It doesn't work to use&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ndash;omit springpython"}]},{"block_type":"text","content":". Instead, every file must be specified, and in this case that would have required four complete files to exclude it all."}]},{"block_type":"element","block":"k6bfvb4l","search_text":"To further complicate this, the full paths for the Spring Python files need to be included. This results in a very lengthy command, not providing much of a benefit over the ways we demonstrated.","text_count":194,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To further complicate this, the full paths for the Spring Python files need to be included. This results in a very lengthy command, not providing much of a benefit over the ways we demonstrated."}]},{"block_type":"element","block":"k6bfvb4m","search_text":"In other situations, if the file to be excluded is local to where coverage is being run, then it might be more practical.","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In other situations, if the file to be excluded is local to where coverage is being run, then it might be more practical."}]},{"block_type":"element","block":"k6bfvb4n","search_text":"The coverage tool has other options not covered in this chapter, such as measuring branch coverage instead of statement coverage, excluding lines, and the ability to run in parallel to manage collecting metrics from multiple processes.","text_count":235,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool has other options not covered in this chapter, such as measuring branch coverage instead of statement coverage, excluding lines, and the ability to run in parallel to manage collecting metrics from multiple processes."}]},{"block_type":"element","block":"k6bfvb4o","search_text":"As mentioned previously, the coverage tool has the ability to filter out individual lines. In my opinion, this sounds very much like trying to get the coverage report to meet some mandated percentage. The coverage tool is best used to work towards writing more comprehensive tests, fixing bugs, and improving development, and not towards building a better report.","text_count":363,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As mentioned previously, the coverage tool has the ability to filter out individual lines. In my opinion, this sounds very much like trying to get the coverage report to meet some mandated percentage. The coverage tool is best used to work towards writing more comprehensive tests, fixing bugs, and improving development, and not towards building a better report."}]},{"block_type":"element","block":"k6bfvb4p","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvb4q","search_text":"The Building a network management application recipe earlier in the chapter","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building a network management application"}]},{"block_type":"text","content":"recipe earlier in the chapter"}]},{"block_type":"element","block":"k6bfvb4r","search_text":"Letting Jenkins get nosy with coverage","text_count":38,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Letting Jenkins get nosy with coverage"}]},{"block_type":"element","block":"k6bfvb4s","search_text":"Configure Jenkins to run a test suite using nose, generating a coverage report. This recipe assumes you have already created the network management application as described in the Building a network management application section.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Configure Jenkins to run a test suite using nose, generating a coverage report. This recipe assumes you have already created the network management application as described in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building a network management application"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k6bfvb4t","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvb4u","search_text":"Let's look at the following steps:","text_count":34,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's look at the following steps:"}]},{"block_type":"element","block":"k6bfvb4v","search_text":"If you have already downloaded Jenkins and used it for previous recipes, look for a .jenkins folder in your home directory and delete it, to avoid unexpected variances caused by this recipe. Install Jenkins. Open the console to confirm that Jenkins is working: ","text_count":261,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If you have already downloaded Jenkins and used it for previous recipes, look for a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".jenkins"}]},{"block_type":"text","content":"folder in your home directory and delete it, to avoid unexpected variances caused by this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Jenkins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the console to confirm that Jenkins is working:"},{"block_type":"element","tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000145.png","class":"lazyload"},"children":[]}]}]}]},{"block_type":"element","block":"k6bfvb4w","search_text":"Click on Manage Jenkins. Click on Manage Plugins. Click on the Available tab. Find the Cobertura Plugin and click the checkbox next to it. Find the Git Plugin and click the checkbox next to it. At the bottom of the page, click on the Install button. Navigate back to the dashboard screen. Shut down Jenkins and start it again. Install Git source code control on your machine. Create an empty folder for this recipe: ","text_count":416,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Manage Jenkins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Manage Plugins."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on the Available tab."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Find the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Cobertura Plugin"}]},{"block_type":"text","content":"and click the checkbox next to it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Find the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Git Plugin"}]},{"block_type":"text","content":"and click the checkbox next to it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"At the bottom of the page, click on the Install button."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate back to the dashboard screen."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Shut down Jenkins and start it again."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install Git source code control on your machine."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an empty folder for this recipe:"}]}]},{"block_type":"element","block":"k6bfvb4x","search_text":"gturnquist$ mkdir /tmp/recipe57","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ mkdir /tmp/recipe57"}]}]},{"block_type":"element","block":"k6bfvb4y","search_text":"Initialize the folder for source code maintenance: ","text_count":51,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Initialize the folder for source code maintenance:"}]}]},{"block_type":"element","block":"k6bfvb4z","search_text":"gturnquist$ git init /tmp/recipe57","text_count":34,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ git init /tmp/recipe57"}]}]},{"block_type":"element","block":"k6bfvb50","search_text":"Copy the network application and SQL script into the folder, add it, and commit the changes: ","text_count":93,"tag_name":"ol","attributes":{"start":"15"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the network application and SQL script into the folder, add it, and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvb51","search_text":"gturnquist$ cp network.py /tmp/recipe57/ gturnquist$ cp network.sql /tmp/recipe57/ gturnquist$ cd /tmp/recipe57/ gturnquist$ git add network.py network.sql gturnquist$ git commit -m \"Add network app\" [master (root-commit) 7f78d46] Add network app 2 files changed, 221 insertions(+), 0 deletions(-) create mode 100644 network.py create mode 100644 network.sql ","text_count":359,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp network.py /tmp/recipe57/ \ngturnquist$ cp network.sql /tmp/recipe57/ \ngturnquist$ cd /tmp/recipe57/\ngturnquist$ git add network.py network.sql\ngturnquist$ git commit -m \"Add network app\"\n[master (root-commit) 7f78d46] Add network app\n2 files changed, 221 insertions(+), 0 deletions(-)\ncreate mode 100644 network.py\ncreate mode 100644 network.sql"}]}]},{"block_type":"element","block":"k6bfvb52","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb53","search_text":"With these steps, we will explore how to configure Jenkins to build a coverage report and serve it through Jenkins' interface.","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore how to configure Jenkins to build a coverage report and&nbsp;serve it through Jenkins' interface."}]},{"block_type":"element","block":"k6bfvb54","search_text":"Create a new file called recipe57.py to contain our test code for this recipe. Write a test case that partially exercises the network management application: ","text_count":158,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe57.py"}]},{"block_type":"text","content":"to contain our test code for this recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test case that partially exercises the network management application:"}]}]},{"block_type":"element","block":"k6bfvb55","search_text":"from network import* import unittest from springpython.database.factory import* from springpython.database.core import* class EventCorrelationTest(unittest.TestCase): def setUp(self): db_name = \"recipe57.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = \\ self.correlator.process(evt1) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\"","text_count":826,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from network import*\nimport unittest\nfrom springpython.database.factory import*\nfrom springpython.database.core import*\nclass EventCorrelationTest(unittest.TestCase):\n    def setUp(self):\n        db_name = \"recipe57.db\"\n        factory = Sqlite3ConnectionFactory(db=db_name)\n        self.correlator = EventCorrelator(factory)\n        dt = DatabaseTemplate(factory)\n        sql = open(\"network.sql\").read().split(\";\")\n        for statement in sql:\n           dt.execute(statement + \";\")\n    def test_process_events(self):\n        evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n        stored_event, is_active, updated_services, updated_equipment = \\\n            self.correlator.process(evt1)\n        print \"Stored event: %s\" % stored_event\n        if is_active:\n        print \"This event was an active event.\"\n        print \"Updated services: %s\" % updated_services\n        print \"Updated equipment: %s\" % updated_equipment\n        print \"---------------------------------\""}]}]},{"block_type":"element","block":"k6bfvb56","search_text":"Copy it into the source code repository. Add it and commit the changes: ","text_count":72,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy it into the source code repository. Add it and commit the changes:"}]}]},{"block_type":"element","block":"k6bfvb57","search_text":"gturnquist$ cp recipe57.py /tmp/recipe57/ gturnquist$ cd /tmp/recipe57/ gturnquist$ git add recipe57.py gturnquist$ git commit -m \"Added tests.\" [master 0bf1761] Added tests. 1 files changed, 37 insertions(+), 0 deletions(-) create mode 100644 recipe57.py","text_count":255,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"gturnquist$ cp recipe57.py /tmp/recipe57/\ngturnquist$ cd /tmp/recipe57/\ngturnquist$ git add recipe57.py\ngturnquist$ git commit -m \"Added tests.\"\n[master 0bf1761] Added tests.\n1 files changed, 37 insertions(+), 0 deletions(-)\ncreate mode 100644 recipe57.py"}]}]},{"block_type":"element","block":"k6bfvb58","search_text":"Open the Jenkins console. Click on New Job. Enter recipe57 as the Job Name and pick Build a free-style software project. Click on Ok . In the Source Code Management section, select Git . For URL , enter /tmp/ recipe57/ . In the Build Triggers section, pick Poll SCM and enter * * * * * into the schedule box in order to trigger a poll once a minute. In the Build section, select Execute Shell and enter the following script, which loads virtualenv and runs the test suite: ","text_count":473,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the Jenkins console."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on New Job."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe57"}]},{"block_type":"text","content":"as the Job Name and pick Build a free-style software project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Ok"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Source Code Management"}]},{"block_type":"text","content":"section, select&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Git"}]},{"block_type":"text","content":". For"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"URL"}]},{"block_type":"text","content":", enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/tmp/ recipe57/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Build Triggers section, pick"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Poll"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"SCM"}]},{"block_type":"text","content":"and enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"* * * * *"}]},{"block_type":"text","content":"into the schedule box in order to trigger a poll once a minute."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Build section, select"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Execute"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Shell"}]},{"block_type":"text","content":"and enter the following script, which loads virtualenv and runs the test suite:"}]}]},{"block_type":"element","block":"k6bfvb59","search_text":". /Users/gturnquist/ptc/bin/activate coverage -e coverage run /Users/gturnquist/ptc/bin/nosetests recipe57.py coverage xml --include=network.py,recipe57.py","text_count":155,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":". /Users/gturnquist/ptc/bin/activate\ncoverage -e\ncoverage run /Users/gturnquist/ptc/bin/nosetests\nrecipe57.py coverage xml --include=network.py,recipe57.py"}]}]},{"block_type":"element","block":"k6bfvb5a","search_text":"Tip You need to include the step to activate your virtualenv and then run the coverage tool, as shown in the following steps. ","text_count":126,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need to include the step to activate your virtualenv and then run the coverage tool, as shown in the following steps."}]}]},{"block_type":"element","block":"k6bfvb5b","search_text":"In the Post-build Actions section, pick Publish Cobertura Coverage Report . Enter coverage.xml for Cobertura xml report pattern . Click on Save to store all job settings. Navigate back to the dashboard. Click on Enable Auto Refresh . Wait about a minute for the build job to run: ","text_count":280,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Post-build Actions section, pick"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Publish Cobertura Coverage Report"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage.xml"}]},{"block_type":"text","content":"for"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Cobertura xml report pattern"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Save"}]},{"block_type":"text","content":"to store all job settings."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Navigate back to the dashboard."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Enable Auto Refresh"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Wait about a minute for the build job to run:"}]}]},{"block_type":"element","block":"k6bfvb5c","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000135.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb5d","search_text":"Click on results ( #1 in the previous screenshot). ","text_count":51,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on results ("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"#1"}]},{"block_type":"text","content":"in the previous screenshot)."}]}]},{"block_type":"element","block":"k6bfvb5e","search_text":"Click on Coverage Report . Observe the next screenshot where it reports 89% coverage: ","text_count":86,"tag_name":"ol","attributes":{"start":"18"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Coverage"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Report"}]},{"block_type":"text","content":". Observe the next screenshot where it reports 89% coverage:"}]}]},{"block_type":"element","block":"k6bfvb5f","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000127.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb5g","search_text":"Click on module . (dot) to see network.py and recipe57.py . Click on recipe57.py to see which lines were covered and which ones were missed. ","text_count":141,"tag_name":"ol","attributes":{"start":"18"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on module"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"."}]},{"block_type":"text","content":"(dot) to see"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network.py"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe57.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe57.py"}]},{"block_type":"text","content":"to see which lines were covered and which ones were missed."}]}]},{"block_type":"element","block":"k6bfvb5h","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb5i","search_text":"The coverage tool generates a useful XML file that the Jenkins Cobertura plugin can harvest. It's possible to just generate the HTML report and serve it up through Jenkins, but the XML file allows Jenkins to nicely chart the coverage trend. It also provides the means to drill-down and view the source code along with lines covered and missed.","text_count":343,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool generates a useful XML file that the Jenkins Cobertura plugin can harvest. It's possible to just generate the HTML report and serve it up through Jenkins, but the XML file allows Jenkins to nicely chart the coverage trend. It also provides the means to drill-down and view the source code along with lines covered and missed."}]},{"block_type":"element","block":"k6bfvb5j","search_text":"We also integrated it with source control so that, as changes are committed to the repository, new jobs will be run.","text_count":116,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also integrated it with source control so that, as changes are committed to the repository, new jobs will be run."}]},{"block_type":"element","block":"k6bfvb5k","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb5l","search_text":"It's important not to get too wrapped up in coverage reports. The coverage tool is useful to track testing, but working purely to increase coverage doesn't guarantee building better code. It should be used as a tool to illuminate what test scenarios are missing instead of thinking about testing a missing line of code.","text_count":319,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important not to get too wrapped up in coverage reports. The coverage tool is useful to track testing, but working purely to increase coverage doesn't guarantee building better code. It should be used as a tool to illuminate what test scenarios are missing instead of thinking about testing a missing line of code."}]},{"block_type":"element","block":"k6bfvb5m","search_text":"Nose doesn't directly support coverage's XML option","text_count":51,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Nose doesn't directly support coverage's XML option"}]},{"block_type":"element","block":"k6bfvb5n","search_text":"The nose plugin for the coverage tool doesn't include the ability to generate XML files. This is because the coverage plugin is part of nose and not part of the coverage project. It is not up to date with the latest features, including XML reports.","text_count":248,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The nose plugin for the coverage tool doesn't include the ability to generate XML files. This is because the coverage plugin is part of nose and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"part of the coverage project. It is not up to date with the latest features, including XML reports."}]},{"block_type":"element","block":"k6bfvb5o","search_text":"Note I asked Ned Batchelder, the creator of the coverage project, about this lack of XML support from nose. He recommended that I run nosetests inside coverage , as shown previously in the Jenkins job. It generates the same .coverage trace data file. It is easy to then execute coverage xml with the required arguments in order to get our desired report. In fact, we can use any of coverage's reporting features at this stage. Unfortunately, the coverage tool needs the explicit path to nosetests , and running inside Jenkins requires the path to be spelled out. ","text_count":563,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I asked Ned Batchelder, the creator of the coverage project, about this lack of XML support from nose. He recommended that I run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":"inside"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage"}]},{"block_type":"text","content":", as shown previously in the Jenkins job. It generates the same&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".coverage"}]},{"block_type":"text","content":"trace data file. It is easy to then execute"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage"}]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xml"}]},{"block_type":"text","content":"with the required arguments in order to get our desired report. In fact, we can use any&nbsp;of coverage's&nbsp;reporting features at this stage. Unfortunately, the coverage tool needs the explicit path to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"nosetests"}]},{"block_type":"text","content":", and running inside Jenkins requires the path to be spelled out."}]}]},{"block_type":"element","block":"k6bfvb5p","search_text":"Updating the project-level script to provide coverage reports","text_count":61,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Updating the project-level script to provide coverage reports"}]},{"block_type":"element","block":"k6bfvb5q","search_text":"Update the project-level script to generate HTML, XML, and console coverage reports as runnable options.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Update the project-level script to generate HTML, XML, and console coverage reports as runnable options."}]},{"block_type":"element","block":"k6bfvb5r","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvb5s","search_text":"Install coverage by typing pip install coverage Create the network management application described in the Building a network management application recipe ","text_count":156,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install coverage by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install coverage"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the network management application described in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building a network"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"management application"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k6bfvb5t","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb5u","search_text":"With these steps, we will explore how to use coverage programmatically in a project management script:","text_count":102,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore how to use coverage programmatically in a project management script:"}]},{"block_type":"element","block":"k6bfvb5v","search_text":"Create a new file called recipe58.py to store this command-line script. Create a script that uses getopt to parse command-line arguments: ","text_count":138,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe58.py"}]},{"block_type":"text","content":"to store this command-line script."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a script that uses"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"to parse command-line arguments:"}]}]},{"block_type":"element","block":"k6bfvb5w","search_text":"import getopt import logging import nose import os import os.path import re import sys from glob import glob def usage(): print print \"Usage: python recipe58.py [command]\" print \"\\t--help\" print \"\\t--test\" print \"\\t--package\" print \"\\t--publish\" print \"\\t--register\" print try: optlist, args = getopt.getopt(sys.argv[1:], \"h\", [\"help\", \"test\", \"package\", \"publish\", \"register\"]) except getopt.GetoptError: # print help information and exit: print \"Invalid command found in %s\" % sys.argv usage() sys.exit(2)","text_count":507,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import getopt\nimport logging\nimport nose \nimport os\nimport os.path\nimport re\nimport sys\nfrom glob import glob\ndef usage():\nprint\nprint \"Usage: python recipe58.py [command]\"\nprint \"\\t--help\"\nprint \"\\t--test\"\nprint \"\\t--package\"\nprint \"\\t--publish\"\nprint \"\\t--register\"\nprint\ntry:\n optlist, args = getopt.getopt(sys.argv[1:],\n \"h\",\n [\"help\", \"test\", \"package\", \"publish\", \"register\"])\nexcept getopt.GetoptError:\n# print help information and exit:\n print \"Invalid command found in %s\" % sys.argv\n usage()\n sys.exit(2)"}]}]},{"block_type":"element","block":"k6bfvb5x","search_text":"Add a test function that uses coverage's API to gather metrics and then generate a console report, an HTML report, and an XML report, while also using nose's API to run the tests: ","text_count":180,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a test function that uses coverage's API to gather metrics and then generate a console report, an HTML report, and an XML report, while also using nose's API to run the tests:"}]}]},{"block_type":"element","block":"k6bfvb5y","search_text":"def test(): from coverage import coverage cov = coverage() cov.start() suite = [\"recipe52\", \"recipe52b\", \"recipe55\", \"recipe56\", \"recipe57\"] print(\"Running suite %s\" % suite) args = [\"\"] args.extend(suite) nose.run(argv=args) cov.stop() modules_to_report = [module + \".py\" for module in suite] modules_to_report.append(\"network.py\") cov.report(morfs=modules_to_report) cov.html_report(morfs=modules_to_report, \\ directory=\"recipe58\") cov.xml_report(morfs=modules_to_report, \\ outfile=\"recipe58.xml\") ","text_count":500,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test():\n   from coverage import coverage\n   cov = coverage() cov.start()\n   suite = [\"recipe52\", \"recipe52b\", \"recipe55\", \"recipe56\", \"recipe57\"]\n   print(\"Running suite %s\" % suite)\n   args = [\"\"]\n   args.extend(suite)\n   nose.run(argv=args)\n   cov.stop()\n   modules_to_report = [module + \".py\" for module in suite]\n   modules_to_report.append(\"network.py\")\n   cov.report(morfs=modules_to_report)\n   cov.html_report(morfs=modules_to_report, \\\n                         directory=\"recipe58\")\n   cov.xml_report(morfs=modules_to_report, \\\n                        outfile=\"recipe58.xml\")"}]}]},{"block_type":"element","block":"k6bfvb5z","search_text":"Add some other stubbed out functions to simulate packaging, publishing, and registering this project: ","text_count":102,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some other stubbed out functions to simulate packaging, publishing, and registering this project:"}]}]},{"block_type":"element","block":"k6bfvb60","search_text":"def package(): print \"This is where we can plug in code to run \" + \\ \"setup.py to generate a bundle.\" def publish(): print \"This is where we can plug in code to upload \" +\\ \"our tarball to S3 or some other download site.\" def publish(): print \"This is where we can plug in code to upload \" +\\ \"our tarball to S3 or some other download site.\" def register(): print \"setup.py has a built in function to \" + \\ \"'register' a release to PyPI. It's \" + \\ \"convenient to put a hook in here.\" # os.system(\"%s setup.py register\" % sys.executable)","text_count":537,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def package():\n  print \"This is where we can plug in code to run \" + \\ \n        \"setup.py to generate a bundle.\"\ndef publish():\n  print \"This is where we can plug in code to upload \" +\\\n        \"our tarball to S3 or some other download site.\"\ndef publish():\n  print \"This is where we can plug in code to upload \" +\\\n        \"our tarball to S3 or some other download site.\"\ndef register():\n  print \"setup.py has a built in function to \" + \\\n        \"'register' a release to PyPI. It's \" + \\\n        \"convenient to put a hook in here.\"\n# os.system(\"%s setup.py register\" % sys.executable)"}]}]},{"block_type":"element","block":"k6bfvb61","search_text":"Add code that processes command-line arguments and calls the functions defined earlier: ","text_count":88,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code that processes command-line arguments and calls the functions defined earlier:"}]}]},{"block_type":"element","block":"k6bfvb62","search_text":"if len(optlist) == 0: usage() sys.exit(1) # Check for help requests, which cause all other # options to be ignored. for option in optlist: if option[0] in (\"--help\", \"-h\"): usage() sys.exit(1) # Parse the arguments, in order for option in optlist: if option[0] in (\"--test\"): test() if option[0] in (\"--package\"): package() if option[0] in (\"--publish\"): publish() if option[0] in (\"--register\"): ","text_count":397,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if len(optlist) == 0:\n   usage()\n   sys.exit(1)\n# Check for help requests, which cause all other\n# options to be ignored. for option in optlist:\nif option[0] in (\"--help\", \"-h\"):\n    usage()\n    sys.exit(1)\n# Parse the arguments, in order for option in optlist:\nif option[0] in (\"--test\"):\n   test()\nif option[0] in (\"--package\"):\n   package()\nif option[0] in (\"--publish\"):\n   publish()\nif option[0] in (\"--register\"):"}]}]},{"block_type":"element","block":"k6bfvb63","search_text":"Run the script using the --test option: ","text_count":40,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--test"}]},{"block_type":"text","content":"option:"}]}]},{"block_type":"element","block":"k6bfvb64","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000116.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb65","search_text":"Open the HTML report using your favorite browser: ","text_count":50,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the HTML report using your favorite browser:"}]}]},{"block_type":"element","block":"k6bfvb66","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000107.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb67","search_text":"Inspect recipe58.xml . ","text_count":23,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inspect"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe58.xml"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k6bfvb68","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb69","search_text":"The coverage API is easy to use as shown in the following steps:","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage API is easy to use as shown in the following steps:"}]},{"block_type":"element","block":"k6bfvb6a","search_text":"In the test method, we create a coverage() instance: ","text_count":53,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the test method, we create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"coverage()"}]},{"block_type":"text","content":"instance:"}]}]},{"block_type":"element","block":"k6bfvb6b","search_text":"from coverage import coverage cov = coverage()","text_count":46,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from coverage import coverage\ncov = coverage()"}]}]},{"block_type":"element","block":"k6bfvb6c","search_text":"We need to call the start method to begin tracing: ","text_count":51,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We need to call the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"start"}]},{"block_type":"text","content":"method to begin tracing:"}]}]},{"block_type":"element","block":"k6bfvb6d","search_text":"cov.start()","text_count":11,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"cov.start()"}]}]},{"block_type":"element","block":"k6bfvb6e","search_text":"Next, we need to exercise the main code. In this case, we are using the nose API. We will use it to run the various recipes coded in this chapter: ","text_count":147,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Next, we need to exercise the main code. In this case, we are using the nose API. We will use it to run the various recipes coded in this chapter:"}]}]},{"block_type":"element","block":"k6bfvb6f","search_text":"suite = [\"recipe52\", \"recipe52b\", \"recipe55\", \"recipe56\", \"recipe57\"] print(\"Running suite %s\" % suite) args = [\"\"] args.extend(suite) nose.run(argv=args)","text_count":154,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"suite = [\"recipe52\", \"recipe52b\", \"recipe55\", \"recipe56\", \"recipe57\"]\nprint(\"Running suite %s\" % suite) \nargs = [\"\"]\nargs.extend(suite)\nnose.run(argv=args)"}]}]},{"block_type":"element","block":"k6bfvb6g","search_text":"Then we need to stop coverage from tracing: ","text_count":44,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Then we need to stop coverage from tracing:"}]}]},{"block_type":"element","block":"k6bfvb6h","search_text":"cov.stop()","text_count":10,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"cov.stop()"}]}]},{"block_type":"element","block":"k6bfvb6i","search_text":"Now that we have gathered metrics, we can generate a console report, an HTML report, and an XML report: ","text_count":104,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Now that we have gathered metrics, we can generate a console report, an HTML report, and an XML report:"}]}]},{"block_type":"element","block":"k6bfvb6j","search_text":"modules_to_report = [module + \".py\" for module in suite] modules_to_report.append(\"network.py\") cov.report(morfs=modules_to_report) cov.html_report(morfs=modules_to_report, directory=\"recipe58\") cov.xml_report(morfs=modules_to_report, outfile=\"recipe58.xml\")","text_count":258,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"modules_to_report = [module + \".py\" for module in suite] \nmodules_to_report.append(\"network.py\")\ncov.report(morfs=modules_to_report)\ncov.html_report(morfs=modules_to_report, directory=\"recipe58\")\ncov.xml_report(morfs=modules_to_report, outfile=\"recipe58.xml\")"}]}]},{"block_type":"element","block":"k6bfvb6k","search_text":"The first report is a console report. The second report is an HTML report written into the recipe58 subdirectory. The third report is an XML report in Cobertura format written to recipe58.xml .","text_count":193,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first report is a console report. The second report is an HTML report written into the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe58"}]},{"block_type":"text","content":"&nbsp;subdirectory. The third report is an XML report in Cobertura format written to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe58.xml"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb6l","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb6m","search_text":"There are many more options to fine-tune gathering as well as reporting. Just visit the online documentation at http://nedbatchelder.com/code/coverage/api.html for more details.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are many more options to fine-tune gathering as well as reporting. Just visit the online documentation at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://nedbatchelder.com/code/coverage/api.html"},"children":[{"block_type":"text","content":"http://nedbatchelder.com/code/coverage/api.html"}]},{"block_type":"text","content":"for more details."}]},{"block_type":"element","block":"k6bfvb6n","search_text":"Can we only use getopt?","text_count":23,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Can we only use getopt?"}]},{"block_type":"element","block":"k6bfvb6o","search_text":"Python 2.7 introduced argparse as an alternative to getopt . The current documentation gives no indication that getopt is deprecated, so it's safe to use as we have just done. The getopt module is a nice, easy-to-use command-line parser.","text_count":237,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python 2.7 introduced&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"as an alternative to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":". The current documentation gives no indication that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"is deprecated, so it's safe to use as we have just done. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"getopt"}]},{"block_type":"text","content":"module is a nice, easy-to-use command-line parser."}]}]},{"title":"Smoke/Load Testing &ndash; Testing Major Parts","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv3z0","number":8,"contents":[{"block_type":"element","block":"k6bfvb6p","search_text":"In this chapter, we will cover the following topics:","text_count":52,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following topics:"}]},{"block_type":"element","block":"k6bfvb6q","search_text":"Defining a subset of test cases using import statements Leaving out integration tests Targeting end to end scenarios Targeting the test server Coding a data simulator Recording and playing back live data in real time Recording and playing back live data as fast as possible Automating your management demo ","text_count":306,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Defining a subset of test cases using import statements"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Leaving out integration tests"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Targeting end to end scenarios"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Targeting the test server"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Coding a data simulator"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Recording and playing back live data in real time"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Recording and playing back live data as fast as possible"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Automating your management demo"}]}]},{"block_type":"element","block":"k6bfvb6r","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfvb6s","search_text":"Smoke testing is not very widely embraced by teams that write automated tests. Writing tests to verify things are working or to expose bugs is a commonly adopted practice, and many teams pick up the idea of using acceptance testing to verify whether their applications are meeting customer demands.","text_count":298,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Smoke testing is not very widely embraced by teams that write automated tests. Writing tests to verify things are working or to expose bugs is a commonly adopted practice, and many teams pick up the idea of using acceptance testing to verify whether their applications are meeting customer demands."}]},{"block_type":"element","block":"k6bfvb6t","search_text":"But smoke testing is a little different. One of the key ideas with smoke testing is to see whether the system has a pulse. What does this mean? It's similar to when a doctor first sees a patient. The first thing they do is check the patient's pulse, along with other vital signs. No pulse; critical pulse! So, what exactly in software constitutes a pulse? That is what we'll explore in the recipes in this chapter.","text_count":414,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But smoke testing is a little different. One of the key ideas with smoke testing is to see whether the system has a pulse. What does this mean? It's similar to when a doctor first sees a patient. The first thing they do is check the patient's pulse, along with other vital signs. No pulse; critical pulse! So, what exactly in software constitutes a pulse? That is what we'll explore in the recipes in this chapter."}]},{"block_type":"element","block":"k6bfvb6u","search_text":"Instead of thinking about comprehensive test suites that make sure every corner of the system has been checked, smoke testing takes a much broader perspective. A set of smoke tests is meant to make sure the system is up and alive. It's almost like a ping check. Compare it to sanity tests. Sanity tests are used to prove a small set of situations actually work. Smoke testing, which is similar in the sense that it is quick and shallow, is meant to see whether the system is in an adequate state to proceed with more extensive testing.","text_count":535,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead of thinking about comprehensive test suites that make sure every corner of the system has been checked, smoke testing takes a much broader perspective. A set of smoke tests is meant to make sure the system is up and alive. It's almost like a ping check. Compare it to sanity tests. Sanity tests are used to prove a small set of situations actually work. Smoke testing, which is similar in the sense that it is quick and shallow, is meant to see whether the system is in an adequate state to proceed with more extensive testing."}]},{"block_type":"element","block":"k6bfvb6v","search_text":"If you imagine an application built to ingest invoices, a set of smoke tests could include the following:","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you imagine an application built to ingest invoices, a set of smoke tests could include the following:"}]},{"block_type":"element","block":"k6bfvb6w","search_text":"Verify the test file has been consumed Verify the number of lines parsed Verify the grand total of the bill ","text_count":108,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Verify the test file has been consumed"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Verify the number of lines parsed"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Verify the grand total of the bill"}]}]},{"block_type":"element","block":"k6bfvb6x","search_text":"Does this sound like a small set of tests? Is it incomplete? Yes it is. And that's the idea. Instead of verifying our software parsed everything correctly, we are verifying just a few key areas that must be working. If it fails to read one file, then there is a major issue that needs to be addressed. If the grand total of the bill is incorrect, again, something big must be taken care of.","text_count":390,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does this sound like a small set of tests? Is it incomplete? Yes it is. And that's the idea. Instead of verifying our software parsed everything correctly, we are verifying just a few key areas that"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"must"}]},{"block_type":"text","content":"be working. If it fails to read one file, then there is a major issue that needs to be addressed. If the grand total of the bill is incorrect, again, something big must be taken care of."}]},{"block_type":"element","block":"k6bfvb6y","search_text":"Note A key side effect of smoke testing is that these tests should be quick to run. What if we altered the function that handles files? If our test suite involves parsing lots of different file types, it could take a long time to verify we didn't break anything. Instead of spending 30 minutes to run a comprehensive test suite, wouldn't it be better to run a one minute quick test and then spend the other 29 minutes working on the software? ","text_count":443,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A key side effect of smoke testing is that these tests should be quick to run. What if we altered the function that handles files? If our test suite involves parsing lots of different file types, it could take a long time to verify we didn't break anything. Instead of spending 30 minutes to run a comprehensive test suite, wouldn't it be better to run a one minute quick test and then spend the other 29 minutes working on the software?"}]}]},{"block_type":"element","block":"k6bfvb6z","search_text":"Smoke tests are also good to use when preparing for a customer demo. With the tension turned up, it's good to run tests more often to make sure we haven't broken anything. Before launching a demo, one last pulse check to know the system is alive may be needed.","text_count":260,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Smoke tests are also good to use when preparing for a customer demo. With the tension turned up, it's good to run tests more often to make sure we haven't broken anything. Before launching a demo, one last pulse check to know the system is alive may be needed."}]},{"block_type":"element","block":"k6bfvb70","search_text":"This chapter also dives into load testing. Load testing is crucial to verify whether our applications can handle the strain of real-world situations. This often involves collecting real-world data and playing it back through our software for a reproducible environment. While we need to know our system can handle today's load, how likely is it that tomorrow's load will be the same? Not very likely.","text_count":400,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This chapter also dives into load testing. Load testing is crucial to verify whether our applications can handle the strain of real-world situations. This often involves collecting real-world data and playing it back through our software for a reproducible environment. While we need to know our system can handle today's load, how likely is it that tomorrow's load will be the same? Not very likely."}]},{"block_type":"element","block":"k6bfvb71","search_text":"It is very useful to seek out the next bottleneck in our application. That way, we can work towards eliminating it before we hit that load in production. One way to stress the system is to play back real-world data as quickly as possible.","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is very useful to seek out the next bottleneck in our application. That way, we can work towards eliminating it before we hit that load in production. One way to stress the system is to play back real-world data as quickly as possible."}]},{"block_type":"element","block":"k6bfvb72","search_text":"In this chapter, we will look at some recipes in which we both smoke test and load test the network management application. The types of load we will be placing on the application could also be described as soak testing and stress testing . Soak testing is described as putting a significant load on the system over a significant period of time. Stress testing is described as loading down a system until it breaks.","text_count":415,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will look at some recipes in which we both smoke test and load test the network management application. The types of load we will be placing on the application could also be described as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"soak testing"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"stress testing"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Soak testing"}]},{"block_type":"text","content":"is described as putting a significant load on the system over a significant period of time."},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Stress testing"}]},{"block_type":"text","content":"is described as loading down a system until it breaks."}]},{"block_type":"element","block":"k6bfvb73","search_text":"Note In my opinion, soak testing and stress testing are different sides of the same coin of load testing. That is why this chapter simply uses the term load testing when the various recipes can easily extend to these types of testing. ","text_count":235,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In my opinion, soak testing and stress testing are different sides of the same coin of load testing. That is why this chapter simply uses the term load testing when the various recipes can easily extend to these types of testing."}]}]},{"block_type":"element","block":"k6bfvb74","search_text":"The code in this chapter also uses several utilities provided by Spring Python ( http://springpython.webfactional.com ).","text_count":120,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code in this chapter also uses several utilities provided by Spring Python ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://springpython.webfactional.com"},"children":[{"block_type":"text","content":"http://springpython.webfactional.com"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfvb75","search_text":"Many of the recipes in this chapter interact with a MySQL database. Install the Python MySQLdb library by typing pip install mysql-python .","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Many of the recipes in this chapter interact with a MySQL database. Install the Python MySQLdb library by typing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install mysql-python"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb76","search_text":"Several of the recipes in this chapter use Python Remote Objects ( Pyro ) ( http://www.xs4all.nl/~irmen/pyro3/ ). It is a Remote Procedure Call ( RPC ) library that supports communicating between threads and processes. Install Pyro by typing pip install pyro .","text_count":260,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Several of the recipes in this chapter use"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Python Remote Objects"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Pyro"}]},{"block_type":"text","content":") ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.xs4all.nl/~irmen/pyro3/"},"children":[{"block_type":"text","content":"http://www.xs4all.nl/~irmen/pyro3/"}]},{"block_type":"text","content":"). It is a"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Remote"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Procedure"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Call"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"RPC"}]},{"block_type":"text","content":") library that supports communicating between threads and processes. Install Pyro by typing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install pyro"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvb77","search_text":"Defining a subset of test cases using import statements","text_count":55,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Defining a subset of test cases using import statements"}]},{"block_type":"element","block":"k6bfvb78","search_text":"Create a Python module that selectively imports which test cases to run.","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Create a Python module that selectively imports which test cases to run."}]},{"block_type":"element","block":"k6bfvb79","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb7a","search_text":"With these steps, we will explore selectively picking a smaller set of tests to facilitate a faster test run:","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore selectively picking a smaller set of tests to facilitate a faster test run:"}]},{"block_type":"element","block":"k6bfvb7b","search_text":"Create a test module called recipe59_test.py , which will be used to write some tests against our network application, as shown here: ","text_count":134,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe59_test.py"}]},{"block_type":"text","content":", which will be used to write some tests against our network application, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb7c","search_text":"import logging from network import * import unittest from springpython.database.factory import * from springpython.database.core import *","text_count":137,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import logging\nfrom network import *\nimport unittest\nfrom springpython.database.factory import *\nfrom springpython.database.core import *"}]}]},{"block_type":"element","block":"k6bfvb7d","search_text":"Create a test case that removes the database connection and stubs out the data access functions, as shown here: ","text_count":112,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that removes the database connection and stubs out the data access functions, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb7e","search_text":"class EventCorrelatorUnitTests(unittest.TestCase): def setUp(self): db_name = \"recipe59.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) # We \"unplug\" the DatabaseTemplate so that # we don't talk to a real database. self.correlator.dt = None # Instead, we create a dictionary of # canned data to return back self.return_values = {} # For each sub-function of the network app, # we replace them with stubs which return our # canned data. def stub_store_event(event): event.id = self.return_values[\"id\"] return event, self.return_values[\"active\"] self.correlator.store_event = stub_store_event def stub_impact(event): return (self.return_values[\"services\"], self.return_values[\"equipment\"]) self.correlator.impact = stub_impact def stub_update_service(service, event): return service + \" updated\"self.correlator.update_service = tub_update_service def stub_update_equip(equip, event): return equip + \" updated\" self.correlator.update_equipment = stub_update_equip","text_count":1006,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class EventCorrelatorUnitTests(unittest.TestCase):\ndef setUp(self):\n  db_name = \"recipe59.db\"\n  factory = Sqlite3ConnectionFactory(db=db_name)\n  self.correlator = EventCorrelator(factory)\n  # We \"unplug\" the DatabaseTemplate so that\n  # we don't talk to a real database.\n  self.correlator.dt = None\n  # Instead, we create a dictionary of\n  # canned data to return back\n  self.return_values = {}\n  # For each sub-function of the network app,\n  # we replace them with stubs which return our\n  # canned data.\ndef stub_store_event(event):\n  event.id = self.return_values[\"id\"]\n  return event, self.return_values[\"active\"]\n  self.correlator.store_event = stub_store_event\ndef stub_impact(event):\n  return (self.return_values[\"services\"],\n  self.return_values[\"equipment\"])\n  self.correlator.impact = stub_impact\ndef stub_update_service(service, event):\n  return service + \" updated\"self.correlator.update_service = \n  tub_update_service\n\ndef stub_update_equip(equip, event):\n  return equip + \" updated\"\n  self.correlator.update_equipment = stub_update_equip"}]}]},{"block_type":"element","block":"k6bfvb7f","search_text":"Create a test method that creates a set of canned data values, invokes the application's process method, and then verifies the values, as shown here: ","text_count":150,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test method that creates a set of canned data values, invokes the application's process method, and then verifies the values, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb7g","search_text":"def test_process_events(self): # For this test case, we can preload the canned data, # and verify that our process function is working # as expected without touching the database. self.return_values[\"id\"] = 4668 self.return_values[\"active\"] = True self.return_values[\"services\"] = [\"service1\", \"service2\"] self.return_values[\"equipment\"] = [\"device1\"] evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) self.assertEquals(4668, stored_event.id) self.assertTrue(is_active) self.assertEquals(2, len(updated_services)) self.assertEquals(1, len(updated_equipment))","text_count":645,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_process_events(self):\n  # For this test case, we can preload the canned data,\n  # and verify that our process function is working\n  # as expected without touching the database.\n  self.return_values[\"id\"] = 4668\n  self.return_values[\"active\"] = True\n  self.return_values[\"services\"] = [\"service1\",\n                                    \"service2\"]\n  self.return_values[\"equipment\"] = [\"device1\"]\n  evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n  stored_event, is_active,\n  updated_services, updated_equipment =\n  self.correlator.process(evt1)\n  self.assertEquals(4668, stored_event.id)\n  self.assertTrue(is_active)\nself.assertEquals(2, len(updated_services))\nself.assertEquals(1, len(updated_equipment))"}]}]},{"block_type":"element","block":"k6bfvb7h","search_text":"Create another test case that preloads the database using a SQL script, as shown: ","text_count":82,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another test case that preloads the database using a SQL script, as shown:"}]}]},{"block_type":"element","block":"k6bfvb7i","search_text":"class EventCorrelatorIntegrationTests(unittest.TestCase): def setUp(self): db_name = \"recipe59.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\")","text_count":313,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class EventCorrelatorIntegrationTests(unittest.TestCase):\n  def setUp(self):\n      db_name = \"recipe59.db\"\n      factory = Sqlite3ConnectionFactory(db=db_name)\n      self.correlator = EventCorrelator(factory)\n      dt = DatabaseTemplate(factory)\n      sql = open(\"network.sql\").read().split(\";\")\nfor statement in sql:\n   dt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvb7j","search_text":"Write a test method that calls the network application's process method and then prints out the results, as shown here: ","text_count":120,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test method that calls the network application's process method and then prints out the results, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb7k","search_text":"def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\"","text_count":401,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_process_events(self):\n    evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n    stored_event, is_active,\n       updated_services, updated_equipment =\n                 self.correlator.process(evt1)\n    print \"Stored event: %s\" % stored_event\n    if is_active:\n         print \"This event was an active event.\"\n    print \"Updated services: %s\" % updated_services\n    print \"Updated equipment: %s\" % updated_equipment\n    print \"---------------------------------\""}]}]},{"block_type":"element","block":"k6bfvb7l","search_text":"Create a new file called recipe59.py that only imports the SQL-based test case, as shown here: ","text_count":95,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe59.py"}]},{"block_type":"text","content":"that only imports the SQL-based test case, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb7m","search_text":"from recipe59_test import EventCorrelatorIntegrationTests if __name__ == \"__main__\": import unittest unittest.main()","text_count":116,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe59_test import EventCorrelatorIntegrationTests\nif __name__ == \"__main__\":\n     import unittest\n     unittest.main()"}]}]},{"block_type":"element","block":"k6bfvb7n","search_text":"Run the test module. Take a look at the following screenshot: ","text_count":62,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test module. Take a look at the following screenshot:"}]}]},{"block_type":"element","block":"k6bfvb7o","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000093.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb7p","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb7q","search_text":"We need to write various test cases to cover the different levels of testing we need. By separating the test runner from the test case, we are able to decide to only run the test that integrated with the database.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to write various test cases to cover the different levels of testing we need. By separating the test runner from the test case, we are able to decide to only run the test that integrated with the database."}]},{"block_type":"element","block":"k6bfvb7r","search_text":"Why would we do this? In our situation, we have only one unit test, and it runs pretty quickly. Do you think that a real-world application with months or years of development and a corresponding test suite will run as quickly? Of course not!","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why would we do this? In our situation, we have only one unit test, and it runs pretty quickly. Do you think that a real-world application with months or years of development and a corresponding test suite will run as quickly? Of course not!"}]},{"block_type":"element","block":"k6bfvb7s","search_text":"Some of the tests may be complex. They may involve talking to real systems, parsing huge sample data files, and other time-consuming tasks. This could realistically take minutes or hours to run.","text_count":194,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some of the tests may be complex. They may involve talking to real systems, parsing huge sample data files, and other time-consuming tasks. This could realistically take minutes or hours to run."}]},{"block_type":"element","block":"k6bfvb7t","search_text":"When we are about to make a presentation to a customer, we don't need a long-running test suite. Instead, we need to be able to run a quick subset of these tests that gives us the confidence that things are working. Using Python's import statements makes this easy to define.","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we are about to make a presentation to a customer, we don't need a long-running test suite. Instead, we need to be able to run a quick subset of these tests that gives us the confidence that things are working. Using Python's import statements makes this easy to define."}]},{"block_type":"element","block":"k6bfvb7u","search_text":"Some suites we may want to think about include the following:","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some suites we may want to think about include the following:"}]},{"block_type":"element","block":"k6bfvb7v","search_text":"pulse.py : Import a set of test cases that provide broad, yet shallow testing of the application, to verify the system has a pulse checkin.py : Import a set of test cases that are currently functioning, and provide enough confidence that code is ready to be committed integration.py : Import a set of test cases that start up, interact, and then shut down external systems such as LDAP, databases, or other subsystems security.py : Import a set of test cases that are focused on various security scenarios, confirming both good and bad credential handling all.py : Import all test cases to make sure everything is working ","text_count":622,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pulse.py"}]},{"block_type":"text","content":": Import a set of test cases that provide broad, yet shallow testing of the application, to verify the system has a pulse"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"checkin.py"}]},{"block_type":"text","content":": Import a set of test cases that are currently functioning, and provide enough confidence that code is ready to be committed"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"integration.py"}]},{"block_type":"text","content":": Import a set of test cases that start up, interact, and then shut down external systems such as LDAP, databases, or other subsystems"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"security.py"}]},{"block_type":"text","content":": Import a set of test cases that are focused on various security scenarios, confirming both good and bad credential handling"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"all.py"}]},{"block_type":"text","content":": Import all test cases to make sure everything is working"}]}]},{"block_type":"element","block":"k6bfvb7w","search_text":"This is just a sample of the types of test module we could define. It's possible to define a module for each subsystem we handle. But since we are talking about smoke testing, we may want to think more broadly, and instead pick some key tests from each subsystem and tie them together to give us a sense that the application is working.","text_count":336,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is just a sample of the types of test module we could define. It's possible to define a module for each subsystem we handle. But since we are talking about smoke testing, we may want to think more broadly, and instead pick some key tests from each subsystem and tie them together to give us a sense that the application is working."}]},{"block_type":"element","block":"k6bfvb7x","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb7y","search_text":"Let's have a look at these too.","text_count":31,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's have a look at these too."}]},{"block_type":"element","block":"k6bfvb7z","search_text":"Security, checking, and integration aren't smoke tests!","text_count":55,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Security, checking, and integration aren't smoke tests!"}]},{"block_type":"element","block":"k6bfvb80","search_text":"That is absolutely right. The previous list shows that using Python import statements isn't confined to defining smoke test suites. It can be used to bundle together test cases that serve a variety of needs. So why bring this up, since we are talking about smoke tests? Well, because I wanted to convey how useful this mechanism is for organizing tests, and that it extends beyond smoke testing.","text_count":395,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That is absolutely right. The previous list shows that using Python import statements isn't confined to defining smoke test suites. It can be used to bundle together test cases that serve a variety of needs. So why bring this up, since we are talking about smoke tests? Well, because I wanted to convey how useful this mechanism is for organizing tests, and that it extends beyond smoke testing."}]},{"block_type":"element","block":"k6bfvb81","search_text":"What provides good flexibility?","text_count":31,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What provides good flexibility?"}]},{"block_type":"element","block":"k6bfvb82","search_text":"To have good flexibility in being able to pick test classes, we should avoid making the test classes too big. But putting each test method inside a different class is probably too much.","text_count":185,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To have good flexibility in being able to pick test classes, we should avoid making the test classes too big. But putting each test method inside a different class is probably too much."}]},{"block_type":"element","block":"k6bfvb83","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvb84","search_text":"The Leaving out integration tests recipe in this chapter","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Leaving out integration tests"}]},{"block_type":"text","content":"recipe in this chapter"}]},{"block_type":"element","block":"k6bfvb85","search_text":"Leaving out integration tests","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Leaving out integration tests"}]},{"block_type":"element","block":"k6bfvb86","search_text":"A fast test suite avoids connecting to remote systems, such as databases and LDAP. Just verifying the core units and avoiding external systems can result in a faster-running test suite with more coverage. This can lead to a useful smoke test that gives developers confidence in the system without running all the tests.","text_count":319,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A fast test suite avoids connecting to remote systems, such as databases and LDAP. Just verifying the core units and avoiding external systems can result in a faster-running test suite with more coverage. This can lead to a useful smoke test that gives developers confidence in the system without running all the tests."}]},{"block_type":"element","block":"k6bfvb87","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb88","search_text":"With these steps, we will see how to cut out test cases that interact with external systems:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will see how to cut out test cases that interact with external systems:"}]},{"block_type":"element","block":"k6bfvb89","search_text":"Create a test module called recipe60_test.py , which will be used for writing some tests for our network application, as shown here: ","text_count":133,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe60_test.py"}]},{"block_type":"text","content":", which will be used for writing some tests for our network application, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb8a","search_text":"import logging from network import * import unittest from springpython.database.factory import * from springpython.database.core import *","text_count":137,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import logging\nfrom network import *\nimport unittest\nfrom springpython.database.factory import *\nfrom springpython.database.core import *"}]}]},{"block_type":"element","block":"k6bfvb8b","search_text":"Create a test case that removes the database connection and stubs out the data access functions: ","text_count":97,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case that removes the database connection and stubs out the data access functions:"}]}]},{"block_type":"element","block":"k6bfvb8c","search_text":"class EventCorrelatorUnitTests(unittest.TestCase): def setUp(self): db_name = \"recipe60.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) # We \"unplug\" the DatabaseTemplate so that # we don't talk to a real database. self.correlator.dt = None # Instead, we create a dictionary of # canned data to return back self.return_values = {} # For each sub-function of the network app, # we replace them with stubs which return our # canned data. def stub_store_event(event): event.id = self.return_values[\"id\"] return event, self.return_values[\"active\"] self.correlator.store_event = stub_store_event def stub_impact(event): return (self.return_values[\"services\"],self.return_values[\"equipment\"]) self.correlator.impact = stub_impact def stub_update_service(service, event): return service + \" updated\" self.correlator.update_service = stub_update_service def stub_update_equip(equip, event): return equip + \" updated\" self.correlator.update_equipment = stub_update_equip","text_count":1007,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class EventCorrelatorUnitTests(unittest.TestCase):\ndef setUp(self):\ndb_name = \"recipe60.db\"\nfactory = Sqlite3ConnectionFactory(db=db_name)\nself.correlator = EventCorrelator(factory)\n# We \"unplug\" the DatabaseTemplate so that\n# we don't talk to a real database.\nself.correlator.dt = None\n# Instead, we create a dictionary of\n# canned data to return back\nself.return_values = {}\n# For each sub-function of the network app,\n# we replace them with stubs which return our\n# canned data.\ndef stub_store_event(event):\nevent.id = self.return_values[\"id\"]\nreturn event, self.return_values[\"active\"]\nself.correlator.store_event = stub_store_event\ndef stub_impact(event):\nreturn (self.return_values[\"services\"],self.return_values[\"equipment\"])\nself.correlator.impact = stub_impact\ndef stub_update_service(service, event):\nreturn service + \" updated\"\nself.correlator.update_service = stub_update_service\ndef stub_update_equip(equip, event):\nreturn equip + \" updated\"\nself.correlator.update_equipment = stub_update_equip"}]}]},{"block_type":"element","block":"k6bfvb8d","search_text":"Create a test method that creates a set of canned data values, invokes the applications process method, and then verifies the values, as shown here: ","text_count":149,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test method that creates a set of canned data values, invokes the applications process method, and then verifies the values, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb8e","search_text":"def test_process_events(self): # For this test case, we can preload the canned data, # and verify that our process function is working # as expected without touching the database. self.return_values[\"id\"] = 4668 self.return_values[\"active\"] = True self.return_values[\"services\"] = [\"service1\", \"service2\"] self.return_values[\"equipment\"] = [\"device1\"] evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) self.assertEquals(4668, stored_event.id) self.assertTrue(is_active) self.assertEquals(2, len(updated_services)) self.assertEquals(1, len(updated_equipment))","text_count":645,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_process_events(self):\n# For this test case, we can preload the canned data,\n# and verify that our process function is working\n# as expected without touching the database.\nself.return_values[\"id\"] = 4668\nself.return_values[\"active\"] = True\nself.return_values[\"services\"] = [\"service1\",\n\"service2\"]\nself.return_values[\"equipment\"] = [\"device1\"]\nevt1 = Event(\"pyhost1\", \"serverRestart\", 5)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt1)\nself.assertEquals(4668, stored_event.id)\nself.assertTrue(is_active)\nself.assertEquals(2, len(updated_services))\nself.assertEquals(1, len(updated_equipment))"}]}]},{"block_type":"element","block":"k6bfvb8f","search_text":"Create another test case that preloads the database using a SQL script: ","text_count":72,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another test case that preloads the database using a SQL script:"}]}]},{"block_type":"element","block":"k6bfvb8g","search_text":"class EventCorrelatorIntegrationTests(unittest.TestCase): def setUp(self): db_name = \"recipe60.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\")","text_count":313,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class EventCorrelatorIntegrationTests(unittest.TestCase):\ndef setUp(self):\ndb_name = \"recipe60.db\"\nfactory = Sqlite3ConnectionFactory(db=db_name)\nself.correlator = EventCorrelator(factory)\ndt = DatabaseTemplate(factory)\nsql = open(\"network.sql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvb8h","search_text":"Write a test method that calls the network application's process method and then prints out the results: ","text_count":105,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test method that calls the network application's process method and then prints out the results:"}]}]},{"block_type":"element","block":"k6bfvb8i","search_text":"def test_process_events(self): evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) print \"Stored event: %s\" % stored_event if is_active: print \"This event was an active event.\" print \"Updated services: %s\" % updated_services print \"Updated equipment: %s\" % updated_equipment print \"---------------------------------\"","text_count":401,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_process_events(self):\nevt1 = Event(\"pyhost1\", \"serverRestart\", 5)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt1)\nprint \"Stored event: %s\" % stored_event\nif is_active:\nprint \"This event was an active event.\"\nprint \"Updated services: %s\" % updated_services\nprint \"Updated equipment: %s\" % updated_equipment\nprint \"---------------------------------\""}]}]},{"block_type":"element","block":"k6bfvb8j","search_text":"Create a module called recipe60.py that only imports the unit test that avoids making SQL calls. Take a look at this code: ","text_count":123,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe60.py"}]},{"block_type":"text","content":"that only imports the unit test that avoids making SQL calls. Take a look at this code:"}]}]},{"block_type":"element","block":"k6bfvb8k","search_text":"from recipe60_test import EventCorrelatorUnitTests if __name__ == \"__main__\": import unittest unittest.main()","text_count":109,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe60_test import EventCorrelatorUnitTests\nif __name__ == \"__main__\":\nimport unittest\nunittest.main()"}]}]},{"block_type":"element","block":"k6bfvb8l","search_text":"Run the test module. Take a look at the following screenshot: ","text_count":62,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test module. Take a look at the following screenshot:"}]}]},{"block_type":"element","block":"k6bfvb8m","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000087.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb8n","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb8o","search_text":"This test suite runs the unit tests and avoids running test cases that integrate with a live database. It uses Python import statements to decide which test cases to include.","text_count":174,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This test suite runs the unit tests and avoids running test cases that integrate with a live database. It uses Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"import"}]},{"block_type":"text","content":"statements to decide which test cases to include."}]},{"block_type":"element","block":"k6bfvb8p","search_text":"In our contrived scenario, there is little gained performance. But with a real project, there are probably a lot more computer cycles spent on integration testing, due to the extra costs of talking to external systems.","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In our contrived scenario, there is little gained performance. But with a real project, there are probably a lot more computer cycles spent on integration testing, due to the extra costs of talking to external systems."}]},{"block_type":"element","block":"k6bfvb8q","search_text":"The idea is to create a subset of tests that verify to some degree that our application works by covering a big chunk of it in a small amount of time.","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The idea is to create a subset of tests that verify to some degree that our application works by covering a big chunk of it in a small amount of time."}]},{"block_type":"element","block":"k6bfvb8r","search_text":"The trick with smoke testing is deciding what constitutes a good enough test. Automated testing cannot completely confirm that our application has no bugs. We are foiled by the fact that either a particular bug doesn't exist, or we haven't written a test case that exposes such a bug. To engage in smoke testing, we are deciding to use a subset of these tests for a quick pulse read. Again, deciding which subset gives us a good enough pulse may be more art than science.","text_count":471,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The trick with smoke testing is deciding what constitutes a good enough test. Automated testing cannot completely confirm that our application has no bugs. We are foiled by the fact that either a particular bug doesn't exist, or we haven't written a test case that exposes such a bug. To engage in smoke testing, we are deciding to use a subset of these tests for a quick pulse read. Again, deciding which subset gives us a good enough pulse may be more art than science."}]},{"block_type":"element","block":"k6bfvb8s","search_text":"This recipe focuses on the idea that unit tests will probably run more quickly, and that cutting out the integration tests will remove the slower test cases. If all the unit tests pass, then we have some confidence that our application is in good shape.","text_count":253,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe focuses on the idea that unit tests will probably run more quickly, and that cutting out the integration tests will remove the slower test cases. If all the unit tests pass, then we have some confidence that our application is in good shape."}]},{"block_type":"element","block":"k6bfvb8t","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvb8u","search_text":"I must point out that test cases don't just easily fall into the category of unit test or integration test . It is more of a continuum. In this recipe's sample code, we wrote one unit test and one integration test, and then we picked the unit test for our smoke test suite.","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I must point out that test cases don't just easily fall into the category of"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"unit test"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"integration test"}]},{"block_type":"text","content":". It is more of a continuum. In this recipe's sample code, we wrote one unit test and one integration test, and then we picked the unit test for our smoke test suite."}]},{"block_type":"element","block":"k6bfvb8v","search_text":"Does this appear arbitrary and perhaps contrived? Sure it does. That is why smoke testing isn't cut and dried but instead requires some analysis and judgment about what to pick. And as development proceeds, there is room for fine-tuning.","text_count":237,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does this appear arbitrary and perhaps contrived? Sure it does. That is why smoke testing isn't cut and dried but instead requires some analysis and judgment about what to pick. And as development proceeds, there is room for fine-tuning."}]},{"block_type":"element","block":"k6bfvb8w","search_text":"I once developed a system that ingested invoices from different suppliers. I wrote unit tests that set up empty database tables, ingested files of many formats, and then examined the contents of the database to verify processing. The test suite took over 45 minutes to run. This pressured me to not run the test suite as often as desired. I crafted a smoke test suite that involved running only the unit tests that did not talk to the database (since they were quick), combined with ingesting one supplier invoice. It ran in fewer than five minutes, and provided a quicker means to assure myself that fundamental changes to the code did not break the entire system. I could run this many times during the day, and only run the comprehensive suite about once a day.","text_count":764,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I once developed a system that ingested invoices from different suppliers. I wrote unit tests that set up empty database tables, ingested files of many formats, and then examined the contents of the database to verify processing. The test suite took over 45 minutes to run. This pressured me to not run the test suite as often as desired. I crafted a smoke test suite that involved running only the unit tests that did"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"talk to the database (since they were quick), combined with ingesting one supplier invoice. It ran in fewer than five minutes, and provided a quicker means to assure myself that fundamental changes to the code did not break the entire system. I could run this many times during the day, and only run the comprehensive suite about once a day."}]},{"block_type":"element","block":"k6bfvb8x","search_text":"Should a smoke test include integration or unit tests?","text_count":54,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Should a smoke test include integration or unit tests?"}]},{"block_type":"element","block":"k6bfvb8y","search_text":"Does this code appear to be similar to that shown in the Defining a subset of test cases using import statements recipe? Yes, it does. So, why include it in this recipe? Because what is picked for the smoke test suite is just as critical as the tactics used to make it happen. The other recipe decided to pick up an integration test while cutting out the unit tests to create a smaller, faster-running test suite.","text_count":413,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does this code appear to be similar to that shown in the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Defining a subset of test cases using import statements&nbsp;"}]},{"block_type":"text","content":"recipe? Yes, it does. So, why include it in this recipe? Because what is picked for the smoke test suite is just as critical as the tactics used to make it happen. The other recipe decided to pick up an integration test while cutting out the unit tests to create a smaller, faster-running test suite."}]},{"block_type":"element","block":"k6bfvb8z","search_text":"This recipe shows that another possibility is to cut out the lengthier integration tests and instead run as many unit tests as possible, considering they are probably faster.","text_count":174,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows that another possibility is to cut out the lengthier integration tests and instead run as many unit tests as possible, considering they are probably faster."}]},{"block_type":"element","block":"k6bfvb90","search_text":"As stated earlier, smoke testing isn't cut and dried. It involves picking the best representation of tests without taking up too much time running them. It is quite possible that none the tests written up to this point precisely target the idea of capturing a pulse of the system. A good smoke test suite may involve mixing together a subset of unit and integration tests.","text_count":372,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As stated earlier, smoke testing isn't cut and dried. It involves picking the best representation of tests without taking up too much time running them. It is quite possible that none the tests written up to this point precisely target the idea of capturing a pulse of the system. A good smoke test suite may involve mixing together a subset of unit and integration tests."}]},{"block_type":"element","block":"k6bfvb91","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvb92","search_text":"The Defining a subset of test cases using import statements recipe","text_count":66,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Defining a subset of test cases using import statements"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","block":"k6bfvb93","search_text":"Targeting end-to-end scenarios","text_count":30,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Targeting end-to-end scenarios"}]},{"block_type":"element","block":"k6bfvb94","search_text":"Pick a complement of tests that runs enough parts to define a thread of execution. This is sometimes referred to as thread testing. Not because we are using software threading, but instead because we are focusing on a story thread. Many times, our threads either come from customer scenarios, or they are at least inspired by them. Other threads can involve other groups, such as operations.","text_count":391,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pick a complement of tests that runs enough parts to define a thread of execution. This is sometimes referred to as thread testing. Not because we are using software threading, but instead because we are focusing on a story thread. Many times, our threads either come from customer scenarios, or they are at least inspired by them. Other threads can involve other groups, such as operations."}]},{"block_type":"element","block":"k6bfvb95","search_text":"For example, a network management system may push out customer-affecting alarms, but the internal operations team that has to solve the network problems may have a totally different perspective. Both of these situations demonstrate valid end-to-end threads that are good places to invest in automated testing.","text_count":309,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, a network management system may push out customer-affecting alarms, but the internal operations team that has to solve the network problems may have a totally different perspective. Both of these situations demonstrate valid end-to-end threads that are good places to invest in automated testing."}]},{"block_type":"element","block":"k6bfvb96","search_text":"Note If the different teams are viewed as different types of customers, then the concepts of acceptance testing certainly apply. And it's also possible to overlap this with the concepts of BDD. ","text_count":194,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the different teams are viewed as different types of customers, then the concepts of acceptance testing certainly apply. And it's also possible to overlap this with the concepts of BDD."}]}]},{"block_type":"element","block":"k6bfvb97","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvb98","search_text":"Copy the SQL script into a new file called recipe61_network.sql and replace the insert statements at the bottom with the following: ","text_count":132,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Copy the SQL script into a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe61_network.sql"}]},{"block_type":"text","content":"and replace the insert statements at the bottom with the following:"}]}]},{"block_type":"element","block":"k6bfvb99","search_text":"INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1, 'pyhost1', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2, 'pyhost2', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3, 'pyhost3', 1); INSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', 'Operational'); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2);","text_count":434,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1, 'pyhost1', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2, 'pyhost2', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3, 'pyhost3', 1);\nINSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', \n'Operational');\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1);\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2);"}]}]},{"block_type":"element","block":"k6bfvb9a","search_text":"In this set of test data, pyhost1 and pyhost2 map into service-abc . pyhost3 doesn't map into any service.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this set of test data,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyhost1"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyhost2"}]},{"block_type":"text","content":"map into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"service-abc"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyhost3"}]},{"block_type":"text","content":"doesn't map into any service."}]},{"block_type":"element","block":"k6bfvb9b","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvb9c","search_text":"With these steps, we will build up an end-to-end test scenario.","text_count":63,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will build up an end-to-end test scenario."}]},{"block_type":"element","block":"k6bfvb9d","search_text":"Create a test module called recipe61_test.py . Create a test case where each test method captures a different thread of execution, as shown here: ","text_count":146,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe61_test.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test case where each test method captures a different thread of execution, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9e","search_text":"import logging from network import * import unittest from springpython.database.factory import * from springpython.database.core import * class EventCorrelatorEquipmentThreadTests(unittest.TestCase): def setUp(self): db_name = \"recipe61.db\" factory = Sqlite3ConnectionFactory(db=db_name) self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"recipe61_network.sql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def tearDown(self): self.correlator = None","text_count":507,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import logging\nfrom network import *\nimport unittest\nfrom springpython.database.factory import *\nfrom springpython.database.core import *\nclass EventCorrelatorEquipmentThreadTests(unittest.TestCase):\ndef setUp(self):\ndb_name = \"recipe61.db\"\nfactory = Sqlite3ConnectionFactory(db=db_name)\nself.correlator = EventCorrelator(factory)\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe61_network.sql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")\ndef tearDown(self):\nself.correlator = None"}]}]},{"block_type":"element","block":"k6bfvb9f","search_text":"Create a test method that captures the thread of failing and recovering a piece of equipment, as shown here: ","text_count":109,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test method that captures the thread of failing and recovering a piece of equipment, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9g","search_text":"def test_equipment_failing(self): # This alarm maps to a device # but doesn't map to any service.","text_count":97,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_equipment_failing(self):\n# This alarm maps to a device\n# but doesn't map to any service."}]}]},{"block_type":"element","block":"k6bfvb9h","search_text":"Have the test method inject a single, faulting alarm and then confirm that a related piece of equipment has failed, as shown here: ","text_count":131,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Have the test method inject a single, faulting alarm and then confirm that a related piece of equipment has failed, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9i","search_text":"evt1 = Event(\"pyhost3\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) self.assertTrue(is_active) self.assertEquals(len(updated_services), 0) self.assertEquals(len(updated_equipment), 1) self.assertEquals(updated_equipment[0][\"HOST_NAME\"], \"pyhost3\") # 5 is the value for a failed piece of equipment self.assertEquals(updated_equipment[0][\"STATUS\"], 5)","text_count":418,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"evt1 = Event(\"pyhost3\", \"serverRestart\", 5)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt1)\nself.assertTrue(is_active)\nself.assertEquals(len(updated_services), 0)\nself.assertEquals(len(updated_equipment), 1)\nself.assertEquals(updated_equipment[0][\"HOST_NAME\"],\n\"pyhost3\")\n# 5 is the value for a failed piece of equipment\nself.assertEquals(updated_equipment[0][\"STATUS\"], 5)"}]}]},{"block_type":"element","block":"k6bfvb9j","search_text":"In the same test method, add code that injects a single, clearing alarm and confirms that the equipment has recovered, as shown here: ","text_count":134,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the same test method, add code that injects a single, clearing alarm and confirms that the equipment has recovered, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9k","search_text":"evt2 = Event(\"pyhost3\", \"serverRestart\", 1) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt2) self.assertFalse(is_active) self.assertEquals(len(updated_services), 0) self.assertEquals(len(updated_equipment), 1) self.assertEquals(updated_equipment[0][\"HOST_NAME\"], \"pyhost3\") # 1 is the value for a clear piece of equipment self.assertEquals(updated_equipment[0][\"STATUS\"], 1)","text_count":418,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"evt2 = Event(\"pyhost3\", \"serverRestart\", 1)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt2)\nself.assertFalse(is_active)\nself.assertEquals(len(updated_services), 0)\nself.assertEquals(len(updated_equipment), 1)\nself.assertEquals(updated_equipment[0][\"HOST_NAME\"],\n\"pyhost3\")\n# 1 is the value for a clear piece of equipment\nself.assertEquals(updated_equipment[0][\"STATUS\"], 1)"}]}]},{"block_type":"element","block":"k6bfvb9l","search_text":"Create another test method that captures the thread of failing and clearing a service, as shown here: ","text_count":102,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another test method that captures the thread of failing and clearing a service, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9m","search_text":"def test_service_failing(self): # This alarm maps to a service.","text_count":63,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def test_service_failing(self):\n# This alarm maps to a service."}]}]},{"block_type":"element","block":"k6bfvb9n","search_text":"Write a test method that injects a single, faulting alarm and confirms that both a piece of equipment and a related service fails, as shown here: ","text_count":146,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test method that injects a single, faulting alarm and confirms that both a piece of equipment and a related service fails, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9o","search_text":"evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) self.assertEquals(len(updated_services), 1) self.assertEquals(\"service-abc\", updated_services[0][\"service\"][\"NAME\"]) self.assertEquals(\"Outage\", updated_services[0][\"service\"][\"STATUS\"])","text_count":323,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"evt1 = Event(\"pyhost1\", \"serverRestart\", 5)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt1)\nself.assertEquals(len(updated_services), 1)\nself.assertEquals(\"service-abc\",\nupdated_services[0][\"service\"][\"NAME\"])\nself.assertEquals(\"Outage\",\nupdated_services[0][\"service\"][\"STATUS\"])"}]}]},{"block_type":"element","block":"k6bfvb9p","search_text":"In the same test method, add code that injects a single, clearing alarm and confirms that both the equipment and the service have recovered, as shown here: ","text_count":156,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the same test method, add code that injects a single, clearing alarm and confirms that both the equipment and the service have recovered, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9q","search_text":"evt2 = Event(\"pyhost1\", \"serverRestart\", 1) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt2) self.assertEquals(len(updated_services), 1) self.assertEquals(\"service-abc\", updated_services[0][\"service\"][\"NAME\"]) self.assertEquals(\"Operational\", updated_services[0][\"service\"][\"STATUS\"])","text_count":328,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"evt2 = Event(\"pyhost1\", \"serverRestart\", 1)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt2)\nself.assertEquals(len(updated_services), 1)\nself.assertEquals(\"service-abc\",\nupdated_services[0][\"service\"][\"NAME\"])\nself.assertEquals(\"Operational\",\nupdated_services[0][\"service\"][\"STATUS\"])"}]}]},{"block_type":"element","block":"k6bfvb9r","search_text":"Create a test runner called recipe61.py that imports both of these thread tests, as shown here: ","text_count":96,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test runner called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe61.py"}]},{"block_type":"text","content":"that imports both of these thread tests, as shown here:"}]}]},{"block_type":"element","block":"k6bfvb9s","search_text":"from recipe61_test import * if __name__ == \"__main__\": import unittest unittest.main()","text_count":86,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe61_test import *\nif __name__ == \"__main__\":\nimport unittest\nunittest.main()"}]}]},{"block_type":"element","block":"k6bfvb9t","search_text":"Run the test suite. Look at the following screenshot: ","text_count":54,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite. Look at the following screenshot:"}]}]},{"block_type":"element","block":"k6bfvb9u","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000078.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvb9v","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvb9w","search_text":"In this recipe we coded two end to end test scenarios. Now consider the following:","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe we coded two end to end test scenarios. Now consider the following:"}]},{"block_type":"element","block":"k6bfvb9x","search_text":"The first scenario tested how our application processes a fault, followed by a clear that only impacts a piece of the equipment. The second scenario tested how our application processes a fault, followed by a clear that impacts a service. ","text_count":239,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first scenario tested how our application processes a fault, followed by a clear that only impacts a piece of the equipment."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The second scenario tested how our application processes a fault, followed by a clear that impacts a service."}]}]},{"block_type":"element","block":"k6bfvb9y","search_text":"We injected a fault and then checked the results to confirm that the proper piece of inventory failed. Then we injected a clear, and again we confirmed that the proper piece of inventory recovered.","text_count":197,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We injected a fault and then checked the results to confirm that the proper piece of inventory failed. Then we injected a clear, and again we confirmed that the proper piece of inventory recovered."}]},{"block_type":"element","block":"k6bfvb9z","search_text":"Both of these scenarios show how our application processes different types of events from the beginning to the end.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Both of these scenarios show how our application processes different types of events from the beginning to the end."}]},{"block_type":"element","block":"k6bfvba0","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvba1","search_text":"In a more complex, realistic version of this application, what other systems do you think would be involved in an end to end thread? What about security? Transactions? Publishing results to an external interface?","text_count":212,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In a more complex, realistic version of this application, what other systems do you think would be involved in an end to end thread? What about security? Transactions? Publishing results to an external interface?"}]},{"block_type":"element","block":"k6bfvba2","search_text":"This is where we need to define where the ends are. Imagine that our application was grown to the point where incoming events are received by a web request and equipment and service updates are pushed out as JSON data to be received by a web page.","text_count":247,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is where we need to define where the ends are. Imagine that our application was grown to the point where incoming events are received by a web request and equipment and service updates are pushed out as JSON data to be received by a web page."}]},{"block_type":"element","block":"k6bfvba3","search_text":"A good end-to-end test would include these parts as well. For the JSON output, we can use Python's JSON library to decode the output and then confirm the results. For the incoming web request, we can use many different techniques, including acceptance testing tools such as the Robot Framework.","text_count":294,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A good end-to-end test would include these parts as well. For the JSON output, we can use Python's JSON library to decode the output and then confirm the results. For the incoming web request, we can use many different techniques, including&nbsp; acceptance testing tools such as the Robot Framework."}]},{"block_type":"element","block":"k6bfvba4","search_text":"How does this define smoke tests?","text_count":33,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"How does this define smoke tests?"}]},{"block_type":"element","block":"k6bfvba5","search_text":"If it takes too long run all the end-to-end tests, we should pick a subset of them that covers some key parts. For example, we could skip the equipment-based thread but keep the service-based one.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If it takes too long run all the end-to-end tests, we should pick a subset of them that covers some key parts. For example, we could skip the equipment-based thread but keep the service-based one."}]},{"block_type":"element","block":"k6bfvba6","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvba7","search_text":"Testing Web Basics with the Robot Framework recipe in Chapter 10 , Web UI Testing Using Selenium Using Robot to Verify Web Application Security recipe in Chapter 10 , Web UI Testing Using Selenium ","text_count":197,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Testing Web Basics with the Robot Framework"}]},{"block_type":"text","content":"recipe in"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.packtpub.com/sites/default/files/downloads/Web_UI_Testing_Using_Selenium.pdf"},"children":[{"block_type":"text","content":"Chapter 10"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Web UI Testing Using Selenium"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using Robot to Verify Web Application Security&nbsp;"}]},{"block_type":"text","content":"recipe in"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.packtpub.com/sites/default/files/downloads/Web_UI_Testing_Using_Selenium.pdf"},"children":[{"block_type":"text","content":"Chapter 10"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Web UI Testing Using Selenium"}]}]}]},{"block_type":"element","block":"k6bfvba8","search_text":"Targeting the test server","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Targeting the test server"}]},{"block_type":"element","block":"k6bfvba9","search_text":"Does your test server have all the parts? If not, then define an alternative set of tests.","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does your test server have all the parts? If not, then define an alternative set of tests."}]},{"block_type":"element","block":"k6bfvbaa","search_text":"This recipe assumes that the production server has an enterprise grade MySQL database system, while the developer's workstation does not. We will explore writing some tests that use the MySQL database. But when we need to run them in the development lab, we will make adjustments so they run on SQLite, which comes bundled with Python.","text_count":335,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe assumes that the production server has an enterprise grade MySQL database system, while the developer's workstation does not. We will explore writing some tests that use the MySQL database. But when we need to run them in the development lab, we will make adjustments so they run on SQLite, which comes bundled with Python."}]},{"block_type":"element","block":"k6bfvbab","search_text":"Are you wondering why MySQL isn't on the developer's workstation? It is true that MySQL is easy to install and not a huge performance load. But this scenario applies just the same if the production server is Oracle and management deems it too costly for our developers to be granted an individual license. Due to the cost of setting up a commercial database, this recipe is uses MySQL and SQLite rather than Oracle and SQLite.","text_count":426,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Are you wondering why MySQL isn't on the developer's workstation? It is true that MySQL is easy to install and not a huge performance load. But this scenario applies just the same if the production server is Oracle and management deems it too costly for our developers to be granted an individual license. Due to the cost of setting up a commercial database, this recipe is uses MySQL and SQLite rather than Oracle and SQLite."}]},{"block_type":"element","block":"k6bfvbac","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvbad","search_text":"Let's look at the following steps:","text_count":34,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's look at the following steps:"}]},{"block_type":"element","block":"k6bfvbae","search_text":"Make sure the MySQL production database server is up and running: ","text_count":66,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make sure the MySQL production database server is up and running:"}]}]},{"block_type":"element","block":"k6bfvbaf","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000042.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbag","search_text":"Open a command-line MySQL client shell as the root user. Create a database for this recipe called recipe62 and a user with permission to access it. Exit the shell. Contrary to what is shown in the following screenshot, never, ever, ever create a live production database with passwords stored in the clear. This database is for demonstration purposes only: ","text_count":357,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open a command-line MySQL client shell as the root user."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a database for this recipe called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62"}]},{"block_type":"text","content":"and a user with permission to access it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Exit the shell. Contrary to what is shown in the following screenshot, never, ever, ever create a live production database with passwords stored in the clear. This database is for demonstration purposes only:"}]}]},{"block_type":"element","block":"k6bfvbah","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000157.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbai","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbaj","search_text":"In these steps, we will see how to build tests that are aimed at different servers:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In these steps, we will see how to build tests that are aimed at different servers:"}]},{"block_type":"element","block":"k6bfvbak","search_text":"Create an alternate version of the SQL script called recipe62_network.mysql used in earlier recipes that uses MySQL conventions, as shown here: ","text_count":144,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an alternate version of the SQL script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_network.mysql"}]},{"block_type":"text","content":"used in earlier recipes that uses MySQL conventions, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbal","search_text":"DROP TABLE IF EXISTS SERVICE_MAPPING; DROP TABLE IF EXISTS SERVICE_EVENTS; DROP TABLE IF EXISTS ACTIVE_EVENTS; DROP TABLE IF EXISTS EQUIPMENT; DROP TABLE IF EXISTS SERVICE; DROP TABLE IF EXISTS EVENTS; CREATE TABLE EQUIPMENT ( ID SMALLINT PRIMARY KEY AUTO_INCREMENT, HOST_NAME TEXT, STATUS SMALLINT ); CREATE TABLE SERVICE ( ID SMALLINT PRIMARY KEY AUTO_INCREMENT, NAME TEXT, STATUS TEXT ); CREATE TABLE SERVICE_MAPPING ( ID SMALLINT PRIMARY KEY AUTO_INCREMENT, SERVICE_FK SMALLINT, EQUIPMENT_FK SMALLINT ); CREATE TABLE EVENTS ( ID SMALLINT PRIMARY KEY AUTO_INCREMENT, HOST_NAME TEXT, SEVERITY SMALLINT, EVENT_CONDITION TEXT ); CREATE TABLE SERVICE_EVENTS ( ID SMALLINT PRIMARY KEY AUTO_INCREMENT, SERVICE_FK SMALLINT, EVENT_FK SMALLINT ); CREATE TABLE ACTIVE_EVENTS ( ID SMALLINT PRIMARY KEY AUTO_INCREMENT, EVENT_FK SMALLINT ); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1, 'pyhost1', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2, 'pyhost2', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3, 'pyhost3', 1); INSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', 'Operational'); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2)","text_count":1264,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"DROP TABLE IF EXISTS SERVICE_MAPPING;\nDROP TABLE IF EXISTS SERVICE_EVENTS;\nDROP TABLE IF EXISTS ACTIVE_EVENTS;\nDROP TABLE IF EXISTS EQUIPMENT;\nDROP TABLE IF EXISTS SERVICE;\nDROP TABLE IF EXISTS EVENTS;\nCREATE TABLE EQUIPMENT (\nID SMALLINT PRIMARY KEY AUTO_INCREMENT,\nHOST_NAME TEXT,\nSTATUS SMALLINT\n);\nCREATE TABLE SERVICE (\nID SMALLINT PRIMARY KEY AUTO_INCREMENT,\nNAME TEXT,\nSTATUS TEXT\n);\nCREATE TABLE SERVICE_MAPPING (\nID SMALLINT PRIMARY KEY AUTO_INCREMENT,\nSERVICE_FK SMALLINT,\nEQUIPMENT_FK SMALLINT\n);\nCREATE TABLE EVENTS (\nID SMALLINT PRIMARY KEY AUTO_INCREMENT,\nHOST_NAME TEXT,\nSEVERITY SMALLINT,\nEVENT_CONDITION TEXT\n);\nCREATE TABLE SERVICE_EVENTS (\nID SMALLINT PRIMARY KEY AUTO_INCREMENT,\nSERVICE_FK SMALLINT,\nEVENT_FK SMALLINT\n);\nCREATE TABLE ACTIVE_EVENTS (\nID SMALLINT PRIMARY KEY AUTO_INCREMENT,\nEVENT_FK SMALLINT\n);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1, 'pyhost1', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2, 'pyhost2', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3, 'pyhost3', 1);\nINSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', \n'Operational');\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1);\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2)"}]}]},{"block_type":"element","block":"k6bfvbam","search_text":"You might not have noticed, but this schema definition has no foreign key constraints. In a real-world SQL script, they should definitely be included. They were left out in this case to reduce complexity.","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You might not have noticed, but this schema definition has no foreign key constraints. In a real-world SQL script, they should definitely be included. They were left out in this case to reduce complexity."}]},{"block_type":"element","block":"k6bfvban","search_text":"Create a new module called recipe62_test.py to put our test code. Create an abstract test case that has one test method verifying event-to-service correlation, as shown here: ","text_count":175,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_test.py"}]},{"block_type":"text","content":"to put our test code."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an abstract test case that has one test method verifying event-to-service correlation, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbao","search_text":"import logging from network import * import unittest from springpython.database.factory import * from springpython.database.core import * class AbstractEventCorrelatorTests(unittest.TestCase): def tearDown(self): self.correlator = None def test_service_failing(self): # This alarm maps to a service. evt1 = Event(\"pyhost1\", \"serverRestart\", 5) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) self.assertEquals(len(updated_services), 1) self.assertEquals(\"service-abc\", updated_services[0][\"service\"][\"NAME\"]) self.assertEquals(\"Outage\", updated_services[0][\"service\"][\"STATUS\"]) evt2 = Event(\"pyhost1\", \"serverRestart\", 1) stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt2) self.assertEquals(len(updated_services), 1) self.assertEquals(\"service-abc\", updated_services[0][\"service\"][\"NAME\"]) self.assertEquals(\"Operational\", updated_services[0][\"service\"][\"STATUS\"])","text_count":952,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import logging\nfrom network import *\nimport unittest\nfrom springpython.database.factory import *\nfrom springpython.database.core import *\nclass AbstractEventCorrelatorTests(unittest.TestCase):\ndef tearDown(self):\nself.correlator = None\ndef test_service_failing(self):\n# This alarm maps to a service.\nevt1 = Event(\"pyhost1\", \"serverRestart\", 5)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt1)\nself.assertEquals(len(updated_services), 1)\nself.assertEquals(\"service-abc\",\nupdated_services[0][\"service\"][\"NAME\"])\nself.assertEquals(\"Outage\",\nupdated_services[0][\"service\"][\"STATUS\"])\nevt2 = Event(\"pyhost1\", \"serverRestart\", 1)\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt2)\nself.assertEquals(len(updated_services), 1)\nself.assertEquals(\"service-abc\",\nupdated_services[0][\"service\"][\"NAME\"])\nself.assertEquals(\"Operational\",\nupdated_services[0][\"service\"][\"STATUS\"])"}]}]},{"block_type":"element","block":"k6bfvbap","search_text":"Create a concrete subclass that connects to the MySQL database and uses the MySQL script, as shown here: ","text_count":105,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a concrete subclass that connects to the MySQL database and uses the MySQL script, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbaq","search_text":"class MySQLEventCorrelatorTests(AbstractEventCorrelatorTests): def setUp(self): factory = MySQLConnectionFactory(\"user\", \"password\", \"localhost\", \"recipe62\") self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"recipe62_network.mysql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\")","text_count":336,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class MySQLEventCorrelatorTests(AbstractEventCorrelatorTests):\ndef setUp(self):\nfactory = MySQLConnectionFactory(\"user\", \"password\",\n\"localhost\", \"recipe62\")\nself.correlator = EventCorrelator(factory)\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe62_network.mysql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvbar","search_text":"Create a corresponding production test runner called recipe62_production.py , as shown here: ","text_count":93,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a corresponding production test runner called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_production.py"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvbas","search_text":"from recipe62_test import MySQLEventCorrelatorTests if __name__ == \"__main__\": import unittest unittest.main()","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe62_test import MySQLEventCorrelatorTests\nif __name__ == \"__main__\":\nimport unittest\nunittest.main()"}]}]},{"block_type":"element","block":"k6bfvbat","search_text":"Run it and verify that it connects with the production database:","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Run it and verify that it connects with the production database:"}]},{"block_type":"element","block":"k6bfvbau","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000021.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbav","search_text":"Now create a SQLite version of the SQL script called recipe62_network.sql , as shown here: ","text_count":91,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Now create a SQLite version of the SQL script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_network.sql"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvbaw","search_text":"DROP TABLE IF EXISTS SERVICE_MAPPING; DROP TABLE IF EXISTS SERVICE_EVENTS; DROP TABLE IF EXISTS ACTIVE_EVENTS; DROP TABLE IF EXISTS EQUIPMENT; DROP TABLE IF EXISTS SERVICE; DROP TABLE IF EXISTS EVENTS; CREATE TABLE EQUIPMENT ( ID INTEGER PRIMARY KEY, HOST_NAME TEXT UNIQUE, STATUS INTEGER ); CREATE TABLE SERVICE ( ID INTEGER PRIMARY KEY, NAME TEXT UNIQUE, STATUS TEXT ); CREATE TABLE SERVICE_MAPPING ( ID INTEGER PRIMARY KEY, SERVICE_FK, EQUIPMENT_FK, FOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID), FOREIGN KEY(EQUIPMENT_FK) REFERENCES EQUIPMENT(ID) ); CREATE TABLE EVENTS ( ID INTEGER PRIMARY KEY, HOST_NAME TEXT, SEVERITY INTEGER, EVENT_CONDITION TEXT ); CREATE TABLE SERVICE_EVENTS ( ID INTEGER PRIMARY KEY, SERVICE_FK, EVENT_FK, FOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID), FOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID) ); CREATE TABLE ACTIVE_EVENTS ( ID INTEGER PRIMARY KEY, EVENT_FK, FOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID) ); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1, 'pyhost1', 1); INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2, 'pyhost2', 1);INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3, 'pyhost3', 1); INSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', 'Op erational'); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1); INSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2);","text_count":1374,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"DROP TABLE IF EXISTS SERVICE_MAPPING;\nDROP TABLE IF EXISTS SERVICE_EVENTS;\nDROP TABLE IF EXISTS ACTIVE_EVENTS;\nDROP TABLE IF EXISTS EQUIPMENT;\nDROP TABLE IF EXISTS SERVICE;\nDROP TABLE IF EXISTS EVENTS;\nCREATE TABLE EQUIPMENT (\nID INTEGER PRIMARY KEY,\nHOST_NAME TEXT UNIQUE,\nSTATUS INTEGER\n);\nCREATE TABLE SERVICE (\nID INTEGER PRIMARY KEY,\nNAME TEXT UNIQUE,\nSTATUS TEXT\n);\nCREATE TABLE SERVICE_MAPPING (\nID INTEGER PRIMARY KEY,\nSERVICE_FK,\nEQUIPMENT_FK,\nFOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID),\nFOREIGN KEY(EQUIPMENT_FK) REFERENCES EQUIPMENT(ID)\n);\nCREATE TABLE EVENTS (\nID INTEGER PRIMARY KEY,\nHOST_NAME TEXT,\nSEVERITY INTEGER,\nEVENT_CONDITION TEXT\n);\nCREATE TABLE SERVICE_EVENTS (\nID INTEGER PRIMARY KEY,\nSERVICE_FK,\nEVENT_FK,\nFOREIGN KEY(SERVICE_FK) REFERENCES SERVICE(ID),\nFOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID)\n);\nCREATE TABLE ACTIVE_EVENTS (\nID INTEGER PRIMARY KEY,\nEVENT_FK,\nFOREIGN KEY(EVENT_FK) REFERENCES EVENTS(ID)\n);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (1, 'pyhost1', 1);\nINSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (2, 'pyhost2', 1);INSERT into EQUIPMENT (ID, HOST_NAME, STATUS) values (3, 'pyhost3', 1);\nINSERT into SERVICE (ID, NAME, STATUS) values (1, 'service-abc', 'Op\nerational');\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,1);\nINSERT into SERVICE_MAPPING (SERVICE_FK, EQUIPMENT_FK) values (1,2);"}]}]},{"block_type":"element","block":"k6bfvbax","search_text":"Create another concrete subclass of the abstract test case, have it connect as SQLite using the SQLite script, and add it to recipe62_test.py , as shown here: ","text_count":159,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another concrete subclass of the abstract test case, have it connect as SQLite using the SQLite script, and add it to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_test.py"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvbay","search_text":"class Sqlite3EventCorrelatorTests(AbstractEventCorrelatorTests): def setUp(self): factory = Sqlite3ConnectionFactory(\"recipe62.db\") self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"recipe62_network.sql\").read().split(\";\")for statement in sql: dt.execute(statement + \";\")","text_count":307,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class Sqlite3EventCorrelatorTests(AbstractEventCorrelatorTests):\ndef setUp(self):\nfactory = Sqlite3ConnectionFactory(\"recipe62.db\")\nself.correlator = EventCorrelator(factory)\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe62_network.sql\").read().split(\";\")for statement in sql:\ndt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvbaz","search_text":"Create a corresponding development workstation test runner called recipe62_dev.py , as shown here: ","text_count":99,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a corresponding development workstation test runner called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_dev.py"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvbb0","search_text":"from recipe62_test import Sqlite3EventCorrelatorTests if __name__ == \"__main__\": import unittest unittest.main()","text_count":112,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from recipe62_test import Sqlite3EventCorrelatorTests\nif __name__ == \"__main__\":\nimport unittest\nunittest.main()"}]}]},{"block_type":"element","block":"k6bfvbb1","search_text":"Run it and verify that it connects with the development database: ","text_count":66,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run it and verify that it connects with the development database:"}]}]},{"block_type":"element","block":"k6bfvbb2","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000148.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbb3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbb4","search_text":"It is not uncommon to have a production environment with full-fledged servers and software installed while at the same time having a smaller development environment. Some shops even have a test bed that is somewhere in between these configurations.","text_count":248,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is not uncommon to have a production environment with full-fledged servers and software installed while at the same time having a smaller development environment. Some shops even have a test bed that is somewhere in between these configurations."}]},{"block_type":"element","block":"k6bfvbb5","search_text":"Our network application handles this situation by allowing database connection information to get injected into it. In each test case, we used the exact same application, but with different database systems.","text_count":207,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Our network application handles this situation by allowing database connection information to get injected into it. In each test case, we used the exact same application, but with different database systems."}]},{"block_type":"element","block":"k6bfvbb6","search_text":"We wrote a test case that used the production MySQL database, and we wrote a test case that used the development SQLite database. Of course, MySQL, even though it is used in many production environments, doesn't sound like something that's not available to developers. But it provides an easy-to-see example of having to switch database systems.","text_count":345,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We wrote a test case that used the production MySQL database, and we wrote a test case that used the development SQLite database. Of course, MySQL, even though it is used in many production environments, doesn't sound like something that's not available to developers. But it provides an easy-to-see example of having to switch database systems."}]},{"block_type":"element","block":"k6bfvbb7","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbb8","search_text":"In this recipe, we showed the need to switch database systems. This isn't the only type of external system that may require alternate configurations for test purposes. Other things, such as LDAP servers, third-party web services, and separate subsystems, may have totally different configurations.","text_count":297,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we showed the need to switch database systems. This isn't the only type of external system that may require alternate configurations for test purposes. Other things, such as LDAP servers, third-party web services, and separate subsystems, may have totally different configurations."}]},{"block_type":"element","block":"k6bfvbb9","search_text":"I have worked on several contracts and have often seen members of management cut development lab resources to save costs. They seem to conclude that the cost of maintaining multiple configurations and handling non-reproducible bugs is less than the cost of having the exact same complement of equipment and software. I feel that this conclusion is faulty, because, at some time in the future, they end up buying more hardware and upgrade things due to increasing issues involving platform variance.","text_count":498,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I have worked on several contracts and have often seen members of management cut development lab resources to save costs. They seem to conclude that the cost of maintaining multiple configurations and handling non-reproducible bugs is less than the cost of having the exact same complement of equipment and software. I feel that this conclusion is faulty, because, at some time in the future, they end up buying more hardware and upgrade things due to increasing issues involving platform variance."}]},{"block_type":"element","block":"k6bfvbba","search_text":"This means we can't always write tests that target the production environment. Writing our software so that it has maximum flexibility, such as injecting database configuration, as we did earlier, is a minimum requirement.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This means we can't always write tests that target the production environment. Writing our software so that it has maximum flexibility, such as injecting database configuration, as we did earlier, is a minimum requirement."}]},{"block_type":"element","block":"k6bfvbbb","search_text":"It's important that we write as many tests as possible that work on the developer's platform. When developers have to start sharing server-side resources, then we run into resource collisions. For example, two developers sharing a single database server will have to do one of these things:","text_count":290,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important that we write as many tests as possible that work on the developer's platform. When developers have to start sharing server-side resources, then we run into resource collisions. For example, two developers sharing a single database server will have to do one of these things:"}]},{"block_type":"element","block":"k6bfvbbc","search_text":"Have separate schemas so they can empty and load test data Coordinate times when they each have access to the same schema Have different servers set up for each developer ","text_count":171,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Have separate schemas so they can empty and load test data"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Coordinate times when they each have access to the same schema"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Have different servers set up for each developer"}]}]},{"block_type":"element","block":"k6bfvbbd","search_text":"The third option is highly unlikely, given that we are talking about a development lab with a smaller footprint than the production one.","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The third option is highly unlikely, given that we are talking about a development lab with a smaller footprint than the production one."}]},{"block_type":"element","block":"k6bfvbbe","search_text":"A positive note is that developers are getting faster and more powerful machines. Compared to 10 years ago, a commonly seen workstation far exceeds old server machines. But, even though we may each be able to run the entire software stack on our machine, it doesn't mean management will pay for all the necessary licensing.","text_count":323,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A positive note is that developers are getting faster and more powerful machines. Compared to 10 years ago, a commonly seen workstation far exceeds old server machines. But, even though we may each be able to run the entire software stack on our machine, it doesn't mean management will pay for all the necessary licensing."}]},{"block_type":"element","block":"k6bfvbbf","search_text":"Unfortunately, this limitation may never change. Hence, we have to be ready to write tests for alternate configurations and manage the discrepancies with the production environment.","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unfortunately, this limitation may never change. Hence, we have to be ready to write tests for alternate configurations and manage the discrepancies with the production environment."}]},{"block_type":"element","block":"k6bfvbbg","search_text":"How likely is it that a development and production environment would use two different database systems?","text_count":104,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"How likely is it that a development and production environment would use two different database systems?"}]},{"block_type":"element","block":"k6bfvbbh","search_text":"Admittedly, it is unlikely to have something as big as switching between SQLite and MySQL. That alone requires slightly different dialects of SQL to define the schema. Some would immediately consider this too difficult to manage. But there are smaller differences in environment that can still yield the same need for reduced testing.","text_count":334,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Admittedly, it is unlikely to have something as big as switching between SQLite and MySQL. That alone requires slightly different dialects of SQL to define the schema. Some would immediately consider this too difficult to manage. But there are smaller differences in environment that can still yield the same need for reduced testing."}]},{"block_type":"element","block":"k6bfvbbi","search_text":"I worked on a system for many years where the production system used Oracle 9i RAC, while the development lab just had Oracle 9i. RAC required extra hardware, and we were never allocated the resources for it. To top it off, Oracle 9i was too big to install on the relatively lightweight PCs we developed with. While everything spoke Oracle's dialect of SQL, the uptime differences between RAC and non-RAC generated a fair number of bugs that we couldn't reproduce in the development lab. It really did qualify as two different database systems. Given that we couldn't work in the production environment, we tested as much as we could in the development lab and then scheduled time in the test lab where an RAC instance existed. Since many people needed access to that lab, we confined our usage to RAC-specific issues to avoid schedule delays.","text_count":843,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I worked on a system for many years where the production system used Oracle 9i RAC, while the development lab just had Oracle 9i. RAC required extra hardware, and we were never allocated the resources for it. To top it off, Oracle 9i was too big to install on the relatively lightweight PCs we developed with. While everything spoke Oracle's dialect of SQL, the uptime differences between RAC and non-RAC generated a fair number of bugs that we couldn't reproduce in the development lab. It really did qualify as two different database systems. Given that we couldn't work in the production environment, we tested as much as we could in the development lab and then scheduled time in the test lab where an RAC instance existed. Since many people needed access to that lab, we confined our usage to RAC-specific issues to avoid schedule delays."}]},{"block_type":"element","block":"k6bfvbbj","search_text":"This isn't just confined to database systems","text_count":44,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"This isn't just confined to database systems"}]},{"block_type":"element","block":"k6bfvbbk","search_text":"As stated earlier, this isn't just about database systems. We have discussed MySQL, SQLite, and Oracle, but this also involves any sort of system we work with or depend on that varies between production and development environments.","text_count":232,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As stated earlier, this isn't just about database systems. We have discussed MySQL, SQLite, and Oracle, but this also involves any sort of system we work with or depend on that varies between production and development environments."}]},{"block_type":"element","block":"k6bfvbbl","search_text":"Being able to code subsets of tests to achieve confidence can help cut down on the actual issues we will inevitably have to deal with.","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Being able to code subsets of tests to achieve confidence can help cut down on the actual issues we will inevitably have to deal with."}]},{"block_type":"element","block":"k6bfvbbm","search_text":"Coding a data simulator","text_count":23,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Coding a data simulator"}]},{"block_type":"element","block":"k6bfvbbn","search_text":"Coding a simulator that spits out data at a defined rate can help simulate real load.","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Coding a simulator that spits out data at a defined rate can help simulate real load."}]},{"block_type":"element","block":"k6bfvbbo","search_text":"This recipe assumes that the reader's machine is installed with MySQL.","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe assumes that the reader's machine is installed with MySQL."}]},{"block_type":"element","block":"k6bfvbbp","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvbbq","search_text":"Make sure the MySQL production database server is up and running. Open a command-line MySQL client shell as the root user. Create a database for this recipe called recipe63 as well as a user with permission to access it. Exit the shell as shown here: ","text_count":251,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make sure the MySQL production database server is up and running."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open a command-line MySQL client shell as the root user."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a database for this recipe called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe63"}]},{"block_type":"text","content":"as well as a user with permission to access it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Exit the shell as shown here:"}]}]},{"block_type":"element","block":"k6bfvbbr","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000158.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbbs","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbbt","search_text":"With these steps, we will explore coding a test simulator:","text_count":58,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will explore coding a test simulator:"}]},{"block_type":"element","block":"k6bfvbbu","search_text":"Create a test generator script called recipe63.py that uses various Python libraries, as shown here: ","text_count":101,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a test generator script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe63.py"}]},{"block_type":"text","content":"that uses various Python libraries, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbbv","search_text":"import getopt import random import sys import time from network import * from springpython.remoting.pyro import *","text_count":113,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import getopt\nimport random\nimport sys\nimport time\nfrom network import *\nfrom springpython.remoting.pyro import *"}]}]},{"block_type":"element","block":"k6bfvbbw","search_text":"Create a usage method that prints out command-line options, as shown here: ","text_count":75,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a usage method that prints out command-line options, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbbx","search_text":"def usage(): print \"Usage\" print \"=====\" print \"-h, --help read this help\" print \"-r, --rate [arg] number of events per second\" print \"-d, --demo demo by printing events\"","text_count":170,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def usage():\nprint \"Usage\"\nprint \"=====\"\nprint \"-h, --help read this help\"\nprint \"-r, --rate [arg] number of events per second\"\nprint \"-d, --demo demo by printing events\""}]}]},{"block_type":"element","block":"k6bfvbby","search_text":"Use Python's getopt library to parse command-line arguments, as shown here: ","text_count":76,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use Python's getopt library to parse command-line arguments, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbbz","search_text":"try: opts, args = getopt.getopt(sys.argv[1:], \"hr:d\", [\"help\", \"rate=\", \"demo\"]) except getopt.GetoptError, err: print str(err) usage() sys.exit(1) rate = 10 demo_mode = False for o, a in opts: if o in (\"-h\", \"--help\"): usage() sys.exit(1) elif o in (\"-r\", \"--rate\"): rate = a elif o in (\"-d\", \"--demo\"): demo_mode = True","text_count":321,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"try:\nopts, args = getopt.getopt(sys.argv[1:], \"hr:d\", [\"help\", \"rate=\",\n\"demo\"])\nexcept getopt.GetoptError, err:\nprint str(err)\nusage()\nsys.exit(1)\nrate = 10\ndemo_mode = False\nfor o, a in opts:\nif o in (\"-h\", \"--help\"):\nusage()\nsys.exit(1)\nelif o in (\"-r\", \"--rate\"):\nrate = a\nelif o in (\"-d\", \"--demo\"):\ndemo_mode = True"}]}]},{"block_type":"element","block":"k6bfvbc0","search_text":"Add a switch so when it's not in demo mode, it uses Spring Python's PyroProxyFactory to connect to a server instance of the network management application : ","text_count":157,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a switch so when it's not in demo mode, it uses Spring Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyroProxyFactory"}]},{"block_type":"text","content":"to connect to a server instance of the network management application"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":":"}]}]}]},{"block_type":"element","block":"k6bfvbc1","search_text":"if not demo_mode: print \"Sending events to live network app. Ctrl+C to exit...\" proxy = PyroProxyFactory() proxy.service_url = \"PYROLOC://127.0.0.1:7766/network\"","text_count":161,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if not demo_mode:\nprint \"Sending events to live network app. Ctrl+C to exit...\"\nproxy = PyroProxyFactory()\nproxy.service_url = \"PYROLOC://127.0.0.1:7766/network\""}]}]},{"block_type":"element","block":"k6bfvbc2","search_text":"Code an infinite loop that creates a random event, as shown here: ","text_count":66,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Code an infinite loop that creates a random event, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbc3","search_text":"while True: hostname = random.choice([\"pyhost1\",\"pyhost2\",\"pyhost3\"]) condition = random.choice([\"serverRestart\", \"lineStatus\"]) severity = random.choice([1,5]) evt = Event(hostname, condition, severity)","text_count":203,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"while True:\nhostname = random.choice([\"pyhost1\",\"pyhost2\",\"pyhost3\"])\ncondition = random.choice([\"serverRestart\", \"lineStatus\"])\nseverity = random.choice([1,5])\nevt = Event(hostname, condition, severity)"}]}]},{"block_type":"element","block":"k6bfvbc4","search_text":"If in demo mode, print out the event, as shown here: ","text_count":53,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If in demo mode, print out the event, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbc5","search_text":"if demo_mode: now = time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", time.localtime()) print \"%s: Sending out %s\" % (now, evt)","text_count":122,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if demo_mode:\nnow = time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\",\ntime.localtime())\nprint \"%s: Sending out %s\" % (now, evt)"}]}]},{"block_type":"element","block":"k6bfvbc6","search_text":"If not in demo mode, make a remote call through the proxy to the network app's process method, as shown here: ","text_count":110,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If not in demo mode, make a remote call through the proxy to the network app's process method, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbc7","search_text":"else: stored_event, is_active, updated_services, updated_equipment = proxy.process(evt) print \"Stored event: %s\" % stored_event print \"Active? %s\" % is_active print \"Services updated: %s\" % updated_services print \"Equipment updated; %s\" % updated_equipment print \"================\"","text_count":281,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"else:\nstored_event, is_active, updated_services,\nupdated_equipment = proxy.process(evt)\nprint \"Stored event: %s\" % stored_event\nprint \"Active? %s\" % is_active\nprint \"Services updated: %s\" % updated_services\nprint \"Equipment updated; %s\" % updated_equipment\nprint \"================\""}]}]},{"block_type":"element","block":"k6bfvbc8","search_text":"Sleep for a certain amount of time before repeating the loop, by using this code line: ","text_count":87,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Sleep for a certain amount of time before repeating the loop, by using this code line:"}]}]},{"block_type":"element","block":"k6bfvbc9","search_text":"time.sleep(1.0/float(rate))","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"time.sleep(1.0/float(rate))"}]}]},{"block_type":"element","block":"k6bfvbca","search_text":"Run the generator script. In the following screenshot, notice there is an error because we haven't started the server process yet. This can also happen if the client and server have mismatched URLs: ","text_count":199,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the generator script. In the following screenshot, notice there is an error because we haven't started the server process yet. This can also happen if the client and server have mismatched URLs:"}]}]},{"block_type":"element","block":"k6bfvbcb","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000106.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbcc","search_text":"Create a server script called recipe63_server.py that will run our network management app connected to MySQL using the recipe62_network.sql SQL script from the Targeting the test server recipe, as shown here: ","text_count":209,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a server script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe63_server.py"}]},{"block_type":"text","content":"that will run our network management app connected to MySQL using the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_network.sql"}]},{"block_type":"text","content":"&nbsp;SQL script&nbsp;from the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Targeting the test server"}]},{"block_type":"text","content":"recipe, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbcd","search_text":"from springpython.database.factory import * from springpython.database.core import * from springpython.remoting.pyro import * from network import * import logging logger = logging.getLogger(\"springpython\") loggingLevel = logging.DEBUG logger.setLevel(loggingLevel) ch = logging.StreamHandler() ch.setLevel(loggingLevel) formatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\") ch.setFormatter(formatter) logger.addHandler(ch) # Initialize the database factory = MySQLConnectionFactory(\"user\", \"password\", \"localhost\", \"recipe63\") dt = DatabaseTemplate(factory) sql = open(\"recipe62_network.mysql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\")","text_count":694,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from springpython.database.factory import *\nfrom springpython.database.core import *\nfrom springpython.remoting.pyro import *\nfrom network import *\nimport logging\nlogger = logging.getLogger(\"springpython\")\nloggingLevel = logging.DEBUG\nlogger.setLevel(loggingLevel)\nch = logging.StreamHandler()\nch.setLevel(loggingLevel)\nformatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s -\n%(message)s\")\nch.setFormatter(formatter)\nlogger.addHandler(ch)\n# Initialize the database\nfactory = MySQLConnectionFactory(\"user\", \"password\",\n\"localhost\", \"recipe63\")\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe62_network.mysql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvbce","search_text":"Add code to expose the app using Pyro, as shown here: ","text_count":54,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code to expose the app using Pyro, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbcf","search_text":"# Create an instance of the network management app target_service = EventCorrelator(factory) # Expose the network app as a Pyro service exporter = PyroServiceExporter() exporter.service_name = \"network\" exporter.service = target_service exporter.after_properties_set()","text_count":268,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Create an instance of the network management app\ntarget_service = EventCorrelator(factory)\n# Expose the network app as a Pyro service\nexporter = PyroServiceExporter()\nexporter.service_name = \"network\"\nexporter.service = target_service\nexporter.after_properties_set()"}]}]},{"block_type":"element","block":"k6bfvbcg","search_text":"Run the server script in a different shell: ","text_count":44,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the server script in a different shell:"}]}]},{"block_type":"element","block":"k6bfvbch","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000137.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbci","search_text":"The default rate is 10 events/second. Run the generator script with a rate of one event/second. In the following screenshot, notice how the script generated a clear, fault, and then another fault. The service started at Operational, moved to Outage, and stayed there: ","text_count":268,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The default rate is 10 events/second. Run the generator script with a rate of one event/second. In the following screenshot, notice how the script generated a clear, fault, and then another fault. The service started at Operational, moved to Outage, and stayed there:"}]}]},{"block_type":"element","block":"k6bfvbcj","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000111.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbck","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbcl","search_text":"Python's random.choice method makes it easy to create a range of random events. By using the time.sleep method, we can control the rate at which the events are created.","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"random.choice"}]},{"block_type":"text","content":"method makes it easy to create a range of random events. By using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"time.sleep"}]},{"block_type":"text","content":"method, we can control the rate at which the events are created."}]},{"block_type":"element","block":"k6bfvbcm","search_text":"We used Pyro to connect the test generator to the network management application. This isn't the only way to connect things together. We could have exposed the application through other means, such as REST, JSON, or perhaps by communicating through a database table. That's not important. What is important is that we built an independent tool that fed data into our application as if it came from a live network.","text_count":413,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We used Pyro to connect the test generator to the network management application. This isn't the only way to connect things together. We could have exposed the application through other means, such as REST, JSON, or perhaps by communicating through a database table. That's not important. What is important is that we built an independent tool that fed data into our application as if it came from a live network."}]},{"block_type":"element","block":"k6bfvbcn","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbco","search_text":"We built a test generator. It's easy to run multiple copies of it in different shells, at different rates. We have an easy way to simulate different subnets producing different volumes of traffic.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We built a test generator. It's easy to run multiple copies of it in different shells, at different rates. We have an easy way to simulate different subnets producing different volumes of traffic."}]},{"block_type":"element","block":"k6bfvbcp","search_text":"We could also add more command-line options to fine-tune the events. For example, we could make the event condition a parameter, and emulate different rates for different types of events.","text_count":187,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We could also add more command-line options to fine-tune the events. For example, we could make the event condition a parameter, and emulate different rates for different types of events."}]},{"block_type":"element","block":"k6bfvbcq","search_text":"Why does the server script initialize the database?","text_count":51,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why does the server script initialize the database?"}]},{"block_type":"element","block":"k6bfvbcr","search_text":"A production version of the server wouldn't do this. For the demonstration purposes of this recipe, it is convenient to put it there. Every time we stop and start the server script, it relaunches the database.","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A production version of the server wouldn't do this. For the demonstration purposes of this recipe, it is convenient to put it there. Every time we stop and start the server script, it relaunches the database."}]},{"block_type":"element","block":"k6bfvbcs","search_text":"Why MySQL instead of SQLite?","text_count":28,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Why MySQL instead of SQLite?"}]},{"block_type":"element","block":"k6bfvbct","search_text":"SQLite has some limitations when it comes to multithreading. Pyro uses multithreading, and SQLite can't pass objects across threads. SQLite is also relatively lightweight and probably not well-suited for a real network management application.","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"SQLite has some limitations when it comes to multithreading. Pyro uses multithreading, and SQLite can't pass objects across threads. SQLite is also relatively lightweight and probably not well-suited for a real network management application."}]},{"block_type":"element","block":"k6bfvbcu","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvbcv","search_text":"The Targeting the test server recipe","text_count":36,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Targeting the test server"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","block":"k6bfvbcw","search_text":"Recording and playing back live data in real time","text_count":49,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Recording and playing back live data in real time"}]},{"block_type":"element","block":"k6bfvbcx","search_text":"Nothing beats live production data. With this recipe, we will write some code to record live data. Then we will play it back with delays added to simulate playing back the live data stream.","text_count":189,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Nothing beats live production data. With this recipe, we will write some code to record live data. Then we will play it back with delays added to simulate playing back the live data stream."}]},{"block_type":"element","block":"k6bfvbcy","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvbcz","search_text":"Let's look at the following steps:","text_count":34,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's look at the following steps:"}]},{"block_type":"element","block":"k6bfvbd0","search_text":"Make sure the MySQL production database server is up and running. Open a command line MySQL client shell as the root user. Create a database for this recipe called recipe64 as well as a user with permission to access it. ","text_count":221,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make sure the MySQL production database server is up and running."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open a command line MySQL client shell as the root user."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a database for this recipe called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe64"}]},{"block_type":"text","content":"as well as a user with permission to access it."}]}]},{"block_type":"element","block":"k6bfvbd1","search_text":"Exit the shell, as shown here: ","text_count":31,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Exit the shell, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbd2","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000119.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbd3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbd4","search_text":"With these steps, we will see how to record and play back data in real-time pace:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will see how to record and play back data in real-time pace:"}]},{"block_type":"element","block":"k6bfvbd5","search_text":"Write a script called recipe64_livedata.py that simulates live data being sent every one to ten seconds, as shown here: ","text_count":120,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe64_livedata.py"}]},{"block_type":"text","content":"that simulates live data being sent every one to ten seconds, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbd6","search_text":"import random import sys import time from network import * from springpython.remoting.pyro import *print \"Sending events to live network app. Ctrl+C to exit...\" proxy = PyroProxyFactory() proxy.service_url = \"PYROLOC://127.0.0.1:7766/network_advised\" while True: hostname = random.choice([\"pyhost1\",\"pyhost2\",\"pyhost3\"]) condition = random.choice([\"serverRestart\", \"lineStatus\"]) severity = random.choice([1,5]) evt = Event(hostname, condition, severity) stored_event, is_active, updated_services, updated_equipment = proxy.process(evt) print \"Stored event: %s\" % stored_event print \"Active? %s\" % is_active print \"Services updated: %s\" % updated_services print \"Equipment updated; %s\" % updated_equipment print \"================\" time.sleep(random.choice(range(1,10)))","text_count":769,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import random\nimport sys\nimport time\nfrom network import *\nfrom springpython.remoting.pyro import *print \"Sending events to live network app. Ctrl+C to exit...\"\nproxy = PyroProxyFactory()\nproxy.service_url = \"PYROLOC://127.0.0.1:7766/network_advised\"\nwhile True:\nhostname = random.choice([\"pyhost1\",\"pyhost2\",\"pyhost3\"])\ncondition = random.choice([\"serverRestart\", \"lineStatus\"])\nseverity = random.choice([1,5])\nevt = Event(hostname, condition, severity)\nstored_event, is_active, updated_services,\nupdated_equipment = proxy.process(evt)\nprint \"Stored event: %s\" % stored_event\nprint \"Active? %s\" % is_active\nprint \"Services updated: %s\" % updated_services\nprint \"Equipment updated; %s\" % updated_equipment\nprint \"================\"\ntime.sleep(random.choice(range(1,10)))"}]}]},{"block_type":"element","block":"k6bfvbd7","search_text":"Write a server script called recipe64_server.py that initializes the database using the SQL script recipe62_network.mysql from Targeting the test server , as shown here: ","text_count":170,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a server script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe64_server.py"}]},{"block_type":"text","content":"that initializes the database using the SQL script"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_network.mysql"}]},{"block_type":"text","content":"from"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Targeting the test server"}]},{"block_type":"text","content":", as shown here:"}]}]},{"block_type":"element","block":"k6bfvbd8","search_text":"from springpython.database.factory import * from springpython.database.core import * from springpython.remoting.pyro import * from springpython.aop import * from network import * from datetime import datetime import os import os.path import pickle import logging logger = logging.getLogger(\"springpython.remoting\") loggingLevel = logging.DEBUG logger.setLevel(loggingLevel) ch = logging.StreamHandler() ch.setLevel(loggingLevel) formatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s - %(message)s\") ch.setFormatter(formatter) logger.addHandler(ch) # Initialize the database factory = MySQLConnectionFactory(\"user\", \"password\", \"localhost\", \"recipe64\") dt = DatabaseTemplate(factory) sql = open(\"recipe62_network.mysql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\")","text_count":803,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from springpython.database.factory import *\nfrom springpython.database.core import *\nfrom springpython.remoting.pyro import *\nfrom springpython.aop import *\nfrom network import *\nfrom datetime import datetime\nimport os\nimport os.path\nimport pickle\nimport logging\nlogger = logging.getLogger(\"springpython.remoting\")\nloggingLevel = logging.DEBUG\nlogger.setLevel(loggingLevel)\nch = logging.StreamHandler()\nch.setLevel(loggingLevel)\nformatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s -\n%(message)s\")\nch.setFormatter(formatter)\nlogger.addHandler(ch)\n# Initialize the database\nfactory = MySQLConnectionFactory(\"user\", \"password\",\n\"localhost\", \"recipe64\")\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe62_network.mysql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvbd9","search_text":"Add some code that creates an instance of the network management application and advertises it using Pyro and Spring Python, as shown here: ","text_count":140,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that creates an instance of the network management application and advertises it using Pyro and Spring Python, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbda","search_text":"# Create an instance of the network management app target_service = EventCorrelator(factory) # Expose the original network app as a Pyro service unadvised_service = PyroServiceExporter() unadvised_service.service_name = \"network\" unadvised_service.service = target_service unadvised_service.after_properties_set()","text_count":313,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Create an instance of the network management app\ntarget_service = EventCorrelator(factory)\n# Expose the original network app as a Pyro service\nunadvised_service = PyroServiceExporter()\nunadvised_service.service_name = \"network\"\nunadvised_service.service = target_service\nunadvised_service.after_properties_set()"}]}]},{"block_type":"element","block":"k6bfvbdb","search_text":"Add some more code that defines an interceptor that captures incoming event data along with a time stamp to disk, as shown here: ","text_count":129,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some more code that defines an interceptor that captures incoming event data along with a time stamp to disk, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbdc","search_text":"class Recorder(MethodInterceptor): \"\"\" An interceptor that catches each event, write it to disk, then proceeds to the network management app. \"\"\" def __init__(self): self.filename = \"recipe64_data.txt\" self.special_char = \"&&&\" if os.path.exists(self.filename): os.remove(self.filename) def invoke(self, invocation): # Write data to disk with open(self.filename, \"a\") as f: evt = invocation.args[0] now = datetime.now() output = (evt, now) print \"Recording %s\" % evt f.write(pickle.dumps(output).replace(\"n\", \"&&&\") + \"n\") # Now call the advised service return invocation.proceed()","text_count":581,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class Recorder(MethodInterceptor):\n\"\"\"\nAn interceptor that catches each event,\nwrite it to disk, then proceeds to the\nnetwork management app.\n\"\"\"\ndef __init__(self):\nself.filename = \"recipe64_data.txt\"\nself.special_char = \"&amp;&amp;&amp;\"\nif os.path.exists(self.filename):\nos.remove(self.filename)\ndef invoke(self, invocation):\n# Write data to disk\nwith open(self.filename, \"a\") as f:\nevt = invocation.args[0]\nnow = datetime.now()\noutput = (evt, now)\nprint \"Recording %s\" % evt\nf.write(pickle.dumps(output).replace(\"n\", \"&amp;&amp;&amp;\") + \"n\")\n# Now call the advised service\nreturn invocation.proceed()"}]}]},{"block_type":"element","block":"k6bfvbdd","search_text":"Add some code that wraps the network management application with the interceptor and advertises it using Pyro, as shown here: ","text_count":126,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that wraps the network management application with the interceptor and advertises it using Pyro, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbde","search_text":"# Wrap the network app with an interceptor advisor = ProxyFactoryObject() advisor.target = target_service advisor.interceptors = [Recorder()] # Expose the advised network app as a Pyro service advised_service = PyroServiceExporter() advised_service.service_name = \"network_advised\" advised_service.service = advisor advised_service.after_properties_set()","text_count":354,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Wrap the network app with an interceptor\nadvisor = ProxyFactoryObject()\nadvisor.target = target_service\nadvisor.interceptors = [Recorder()]\n# Expose the advised network app as a Pyro service\nadvised_service = PyroServiceExporter()\nadvised_service.service_name = \"network_advised\"\nadvised_service.service = advisor\nadvised_service.after_properties_set()"}]}]},{"block_type":"element","block":"k6bfvbdf","search_text":"Start up the server app by typing python recipe64_server.py . Notice in the following screenshot that there is both a network service and a network_advised service registered with Pyro: ","text_count":186,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start up the server app by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe64_server.py"}]},{"block_type":"text","content":". Notice in the following screenshot that there is both a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network"}]},{"block_type":"text","content":"service and a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network_advised"}]},{"block_type":"text","content":"service registered with Pyro:"}]}]},{"block_type":"element","block":"k6bfvbdg","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000016.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbdh","search_text":"Run the live data simulator by typing python recipe64_livedata.py until it generates a few events, and then hit Ctrl+C to break out of it:","text_count":138,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Run the live data simulator by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe64_livedata.py"}]},{"block_type":"text","content":"until it generates a few events, and then hit Ctrl+C to break out of it:"}]},{"block_type":"element","block":"k6bfvbdi","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000099.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbdj","search_text":"Look at the server-side of things, and notice how it recorded several events: ","text_count":78,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Look at the server-side of things, and notice how it recorded several events:"}]}]},{"block_type":"element","block":"k6bfvbdk","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000074.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbdl","search_text":"Inspect the recipe64_data.txt data file, noting how each line represents a separate event and time stamp. While it's hard to decipher the data stored in a pickled format, it's possible to spot bits and pieces. Create a script called recipe64_playback.py that de-pickles each line of the data file, as shown here: ","text_count":313,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inspect the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe64_data.txt"}]},{"block_type":"text","content":"data file, noting how each line represents a separate event and time stamp. While it's hard to decipher the data stored in a pickled format, it's possible to spot bits and pieces."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe64_playback.py"}]},{"block_type":"text","content":"that de-pickles each line of the data file, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbdm","search_text":"from springpython.remoting.pyro import * from datetime import datetime import pickle import time with open(\"recipe64_data.txt\") as f: lines = f.readlines() events = [pickle.loads(line.replace(\"&&&\", \"n\")) for line in lines]","text_count":223,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from springpython.remoting.pyro import *\nfrom datetime import datetime\nimport pickle\nimport time\nwith open(\"recipe64_data.txt\") as f:\nlines = f.readlines()\nevents = [pickle.loads(line.replace(\"&amp;&amp;&amp;\", \"n\"))\nfor line in lines]"}]}]},{"block_type":"element","block":"k6bfvbdn","search_text":"Add a function that finds the time interval between the current event and the previous one, as shown here: ","text_count":107,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a function that finds the time interval between the current event and the previous one, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbdo","search_text":"def calc_offset(evt, time_it_happened, previous_time): if previous_time is None: return time_it_happened - time_it_happened else: return time_it_happened - previous_time","text_count":169,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def calc_offset(evt, time_it_happened, previous_time):\nif previous_time is None:\nreturn time_it_happened - time_it_happened\nelse:\nreturn time_it_happened - previous_time"}]}]},{"block_type":"element","block":"k6bfvbdp","search_text":"Define a client proxy to connect to the unadvised interface to our network management application, as shown here: ","text_count":114,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define a client proxy to connect to the unadvised interface to our network management application, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbdq","search_text":"print \"Sending events to live network app. Ctrl+C to exit...\" proxy = PyroProxyFactory() proxy.service_url = \"PYROLOC://127.0.0.1:7766/network\"","text_count":143,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"print \"Sending events to live network app. Ctrl+C to exit...\"\nproxy = PyroProxyFactory()\nproxy.service_url = \"PYROLOC://127.0.0.1:7766/network\""}]}]},{"block_type":"element","block":"k6bfvbdr","search_text":"Add code that iterates over each event, calculating the difference, and then delaying the next event by that many seconds, as shown here: ","text_count":138,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code that iterates over each event, calculating the difference, and then delaying the next event by that many seconds, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbds","search_text":"previous_time = None for (e, time_it_happened) in events: diff = calc_offset(e, time_it_happened, previous_time) print \"Original: %s Now: %s\" % (time_it_happened, datetime.now()) stored_event, is_active, updated_services, updated_equipment = proxy.process(e) print \"Stored event: %s\" % stored_event print \"Active? %s\" % is_active print \"Services updated: %s\" % updated_services print \"Equipment updated; %s\" % updated_equipment print \"Next event in %s seconds\" % diff.seconds print \"================\" time.sleep(diff.seconds) previous_time = time_it_happened","text_count":558,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"previous_time = None\nfor (e, time_it_happened) in events:\ndiff = calc_offset(e, time_it_happened, previous_time)\nprint \"Original: %s Now: %s\" % (time_it_happened, datetime.now())\nstored_event, is_active, updated_services,\nupdated_equipment = proxy.process(e)\nprint \"Stored event: %s\" % stored_event\nprint \"Active? %s\" % is_active\nprint \"Services updated: %s\" % updated_services\nprint \"Equipment updated; %s\" % updated_equipment\nprint \"Next event in %s seconds\" % diff.seconds\nprint \"================\"\ntime.sleep(diff.seconds)\nprevious_time = time_it_happened"}]}]},{"block_type":"element","block":"k6bfvbdt","search_text":"Run the playback script by typing python recipe64_playback.py and observe how it has the same delays as the original live data simulator did: ","text_count":142,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the playback script by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe64_playback.py"}]},{"block_type":"text","content":"and observe how it has the same delays as the original live data simulator did:"}]}]},{"block_type":"element","block":"k6bfvbdu","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000080.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbdv","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbdw","search_text":"Normally, we would be recording data coming in from the live network. In this situation, we need a simulator that generates random data. The simulator we coded in this recipe is very similar to the one shown in the Coding a data simulator recipe.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Normally, we would be recording data coming in from the live network. In this situation, we need a simulator that generates random data. The simulator we coded in this recipe is very similar to the one shown in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Coding a data simulator"}]},{"block_type":"text","content":"recipe."}]},{"block_type":"element","block":"k6bfvbdx","search_text":"To capture the data, we coded an interceptor that is embedded between Pyro and the network management application. Every event published to the network_advised Pyro service name seamlessly passes through this interceptor. Consider the following:","text_count":245,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To capture the data, we coded an interceptor that is embedded between Pyro and the network management application. Every event published to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network_advised"}]},{"block_type":"text","content":"Pyro service name seamlessly passes through this interceptor. Consider the following:"}]},{"block_type":"element","block":"k6bfvbdy","search_text":"Each event that comes in is appended to the data file that was initialized when the interceptor was first created. The event is also stored with a copy of datetime.now() to capture a time stamp. The event and time stamp are combined into a tuple and pickled, making it easy to write and later read back from disk. The data is pickled to make it easy to transfer to and from disk. After writing it on to the disk, the interceptor calls the target service and passes the results back to the original caller. ","text_count":506,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Each event that comes in is appended to the data file that was initialized when the interceptor was first created."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The event is also stored with a copy of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime.now()"}]},{"block_type":"text","content":"&nbsp;to capture a time stamp."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The event and time stamp are combined into a tuple and pickled, making it easy to write and later read back from disk."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The data is pickled to make it easy to transfer to and from disk."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"After writing it on to the disk, the interceptor calls the target service and passes the results back to the original caller."}]}]},{"block_type":"element","block":"k6bfvbdz","search_text":"Finally, we have a playback script that reads in the data file, one event per line. It de-pickles each line into the tuple format it was originally stored in and builds a list of events.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we have a playback script that reads in the data file, one event per line. It de-pickles each line into the tuple format it was originally stored in and builds a list of events."}]},{"block_type":"element","block":"k6bfvbe0","search_text":"The list of events is then scanned, one at a time. By comparing the current event's time stamp with the previous one, a difference in seconds is calculated to use Python's time.sleep() method to play the events back at the same rate they were recorded.","text_count":252,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The list of events is then scanned, one at a time. By comparing the current event's time stamp with the previous one, a difference in seconds is calculated to use Python's"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"time.sleep()"}]},{"block_type":"text","content":"method to play the events back at the same rate they were recorded."}]},{"block_type":"element","block":"k6bfvbe1","search_text":"The playback script uses Pyro to send the events into the network management application. But it talks to a different exposure point. This is to avoid re-recording the same event.","text_count":179,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The playback script uses Pyro to send the events into the network management application. But it talks to a different exposure point. This is to avoid re-recording the same event."}]},{"block_type":"element","block":"k6bfvbe2","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbe3","search_text":"The code in this recipe uses Pyro as the mechanism connecting clients and servers communicate in a publish/subscribe paradigm. This isn't the only way to build such a service. Python has XML-RPC built in as well. It just isn't as flexible as Pyro. A more thorough analysis of real traffic is needed to determine whether this interface is good enough. Alternatives include pushing events through a database EVENT table where the client inserts rows and the server polls the table for new rows, and then removes them as they are consumed.","text_count":536,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code in this recipe uses Pyro as the mechanism connecting clients and servers communicate in a publish/subscribe paradigm. This isn't the only way to build such a service. Python has XML-RPC built in as well. It just isn't as flexible as Pyro. A more thorough analysis of real traffic is needed to determine whether this interface is good enough. Alternatives include pushing events through a database EVENT table where the client inserts rows and the server polls the table for new rows, and then removes them as they are consumed."}]},{"block_type":"element","block":"k6bfvbe4","search_text":"This recipe also makes heavy use of Spring Python for its aspect-oriented programming features to insert the data recording code ( http://static.springsource.org/spring-python/1.1.x/reference/html/aop.html ). This provides a clean way to add the extra layer of functionality we need to sniff and record network traffic without having to touch the already-built network management code.","text_count":385,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe also makes heavy use of Spring Python for its"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"aspect-oriented programming"}]},{"block_type":"text","content":"features to insert the data recording code ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://static.springsource.org/spring-python/1.1.x/reference/html/aop.html"},"children":[{"block_type":"text","content":"http://static.springsource.org/spring-python/1.1.x/reference/html/aop.html"}]},{"block_type":"text","content":"). This provides a clean way to add the extra layer of functionality we need to sniff and record network traffic without having to touch the already-built network management code."}]},{"block_type":"element","block":"k6bfvbe5","search_text":"I thought this recipe was about live data!","text_count":42,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"I thought this recipe was about live data!"}]},{"block_type":"element","block":"k6bfvbe6","search_text":"Well, the recipe is more about recording the live data and controlling the speed of playback. To capture this concept in a reusable recipe requires that we simulate the live system. But the fundamental concept of inserting a tap point in front of the network management processor, as we have done, is just as valid.","text_count":315,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Well, the recipe is more about"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"recording"}]},{"block_type":"text","content":"the live data and controlling the speed of playback. To capture this concept in a reusable recipe requires that we simulate the live system. But the fundamental concept of inserting a tap point in front of the network management processor, as we have done, is just as valid."}]},{"block_type":"element","block":"k6bfvbe7","search_text":"Is opening and closing a file for every event a good idea?","text_count":58,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Is opening and closing a file for every event a good idea?"}]},{"block_type":"element","block":"k6bfvbe8","search_text":"The recipe was coded to ensure that stopping the recording would incur a minimal risk of losing captured data not yet written to disk. Analysis of production data is required to determine the most efficient way of storing data. For example, it may take less I/O intense to write data in batches of 10, or perhaps 100 events. But the risk is that data can be lost in similar bundles.","text_count":382,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The recipe was coded to ensure that stopping the recording would incur a minimal risk of losing captured data not yet written to disk. Analysis of production data is required to determine the most efficient way of storing data. For example, it may take less I/O intense to write data in batches of 10, or perhaps 100 events. But the risk is that data can be lost in similar bundles."}]},{"block_type":"element","block":"k6bfvbe9","search_text":"If the volume of traffic is low enough, writing each event one by one, as shown in this recipe, may not be a problem at all.","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the volume of traffic is low enough, writing each event one by one, as shown in this recipe, may not be a problem at all."}]},{"block_type":"element","block":"k6bfvbea","search_text":"What about offloading the storage of data?","text_count":42,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What about offloading the storage of data?"}]},{"block_type":"element","block":"k6bfvbeb","search_text":"It is not uncommon to have the actual logic of opening the file, appending the data, and then closing the file contained in a separate class. This utility could then be injected into the interceptor we built. This may become important if some more elaborate means to storing or piping the data is needed. For example, another Pyro service may exist in another location that wants a copy of the live data feed.","text_count":409,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is not uncommon to have the actual logic of opening the file, appending the data, and then closing the file contained in a separate class. This utility could then be injected into the interceptor we built. This may become important if some more elaborate means to storing or piping the data is needed. For example, another Pyro service may exist in another location that wants a copy of the live data feed."}]},{"block_type":"element","block":"k6bfvbec","search_text":"Injecting the data consumer into the aspect we coded would give us more flexibility. In this recipe, we don't have such requirements, but it's not hard to imagine making such adjustments as new requirements arrive.","text_count":214,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Injecting the data consumer into the aspect we coded would give us more flexibility. In this recipe, we don't have such requirements, but it's not hard to imagine making such adjustments as new requirements arrive."}]},{"block_type":"element","block":"k6bfvbed","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvbee","search_text":"The Writing a data simulator recipe The Recording and playing back live data as fast as possible recipe ","text_count":104,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a data simulator"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Recording and playing back live data as fast as possible"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k6bfvbef","search_text":"Recording and playing back live data as fast as possible","text_count":56,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Recording and playing back live data as fast as possible"}]},{"block_type":"element","block":"k6bfvbeg","search_text":"Replaying production data as fast as possible (instead of in real time) can give you insight into where your bottlenecks are.","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Replaying production data as fast as possible (instead of in real time) can give you insight into where your bottlenecks are."}]},{"block_type":"element","block":"k6bfvbeh","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k6bfvbei","search_text":"Make sure the MySQL production database server is up and running. Open a command-line MySQL client shell as the root user. Create a database for this recipe called recipe65 as well as a user with permission to access it. Exit the shell, as shown here: ","text_count":252,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make sure the MySQL production database server is up and running."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open a command-line MySQL client shell as the root user."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a database for this recipe called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe65"}]},{"block_type":"text","content":"as well as a user with permission to access it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Exit the shell, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbej","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000134.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbek","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbel","search_text":"In these steps, we will write some code that lets us put a big load on our system:","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In these steps, we will write some code that lets us put a big load on our system:"}]},{"block_type":"element","block":"k6bfvbem","search_text":"Write a script called recipe65_livedata.py that simulates live data being sent every one to ten seconds, as shown here: ","text_count":120,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe65_livedata.py"}]},{"block_type":"text","content":"that simulates live data being sent every one to ten seconds, as shown here:"}]}]},{"block_type":"element","block":"k6bfvben","search_text":"import random import sys import time from network import * from springpython.remoting.pyro import * print \"Sending events to live network app. Ctrl+C to exit...\" proxy = PyroProxyFactory() proxy.service_url = \"PYROLOC://127.0.0.1:7766/network_advised\" while True: hostname = random.choice([\"pyhost1\",\"pyhost2\",\"pyhost3\"]) condition = random.choice([\"serverRestart\", \"lineStatus\"]) severity = random.choice([1,5]) evt = Event(hostname, condition, severity) stored_event, is_active, updated_services, updated_equipment = proxy.process(evt) print \"Stored event: %s\" % stored_event print \"Active? %s\" % is_active print \"Services updated: %s\" % updated_services print \"Equipment updated; %s\" % updated_equipment print \"================\" time.sleep(random.choice(range(1,10)))","text_count":770,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import random\nimport sys\nimport time\nfrom network import *\nfrom springpython.remoting.pyro import *\nprint \"Sending events to live network app. Ctrl+C to exit...\"\nproxy = PyroProxyFactory()\nproxy.service_url = \"PYROLOC://127.0.0.1:7766/network_advised\"\nwhile True:\nhostname = random.choice([\"pyhost1\",\"pyhost2\",\"pyhost3\"])\ncondition = random.choice([\"serverRestart\", \"lineStatus\"])\nseverity = random.choice([1,5])\nevt = Event(hostname, condition, severity)\nstored_event, is_active, updated_services,\nupdated_equipment = proxy.process(evt)\nprint \"Stored event: %s\" % stored_event\nprint \"Active? %s\" % is_active\nprint \"Services updated: %s\" % updated_services\nprint \"Equipment updated; %s\" % updated_equipment\nprint \"================\"\ntime.sleep(random.choice(range(1,10)))"}]}]},{"block_type":"element","block":"k6bfvbeo","search_text":"Write a server script called recipe65_server.py that initializes the database using the SQL script recipe62_network.mysql from the Targeting the test server recipe, as shown here: ","text_count":180,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a server script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe65_server.py"}]},{"block_type":"text","content":"that initializes the database using the SQL script"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe62_network.mysql"}]},{"block_type":"text","content":"from the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Targeting the test server&nbsp;"}]},{"block_type":"text","content":"recipe, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbep","search_text":"from springpython.database.factory import * from springpython.database.core import * from springpython.remoting.pyro import * from springpython.aop import * from network import * from datetime import datetime import os import os.path import pickle import logging logger = logging.getLogger(\"springpython.remoting\") loggingLevel = logging.DEBUG logger.setLevel(loggingLevel) ch = logging.StreamHandler() ch.setLevel(loggingLevel) formatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s -%(message)s\") ch.setFormatter(formatter) logger.addHandler(ch) # Initialize the database factory = MySQLConnectionFactory(\"user\", \"password\", \"localhost\", \"recipe65\") dt = DatabaseTemplate(factory) sql = open(\"recipe62_network.mysql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\")","text_count":802,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from springpython.database.factory import *\nfrom springpython.database.core import *\nfrom springpython.remoting.pyro import *\nfrom springpython.aop import *\nfrom network import *\nfrom datetime import datetime\nimport os\nimport os.path\nimport pickle\nimport logging\nlogger = logging.getLogger(\"springpython.remoting\")\nloggingLevel = logging.DEBUG\nlogger.setLevel(loggingLevel)\nch = logging.StreamHandler()\nch.setLevel(loggingLevel)\nformatter = logging.Formatter(\"%(asctime)s - %(name)s - %(levelname)s -%(message)s\")\nch.setFormatter(formatter)\nlogger.addHandler(ch)\n# Initialize the database\nfactory = MySQLConnectionFactory(\"user\", \"password\",\n\"localhost\", \"recipe65\")\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe62_network.mysql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")"}]}]},{"block_type":"element","block":"k6bfvbeq","search_text":"Add some code that creates an instance of the network management application and advertises it using Pyro and Spring Python, as shown here: ","text_count":140,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that creates an instance of the network management application and advertises it using Pyro and Spring Python, as shown here:"}]}]},{"block_type":"element","block":"k6bfvber","search_text":"# Create an instance of the network management app target_service = EventCorrelator(factory) # Expose the original network app as a Pyro service unadvised_service = PyroServiceExporter() unadvised_service.service_name = \"network\" unadvised_service.service = target_service unadvised_service.after_properties_set()","text_count":313,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Create an instance of the network management app\ntarget_service = EventCorrelator(factory)\n# Expose the original network app as a Pyro service\nunadvised_service = PyroServiceExporter()\nunadvised_service.service_name = \"network\"\nunadvised_service.service = target_service\nunadvised_service.after_properties_set()"}]}]},{"block_type":"element","block":"k6bfvbes","search_text":"Add some more code that defines an interceptor that captures incoming event data along with a time stamp on disk, as shown here: ","text_count":129,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some more code that defines an interceptor that captures incoming event data along with a time stamp on disk, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbet","search_text":"class Recorder(MethodInterceptor): \"\"\" An interceptor that catches each event, write it to disk, then proceeds to the network management app. \"\"\" def __init__(self): self.filename = \"recipe65_data.txt\" self.special_char = \"&&&\" if os.path.exists(self.filename): os.remove(self.filename) def invoke(self, invocation): # Write data to disk with open(self.filename, \"a\") as f: evt = invocation.args[0] now = datetime.now() output = (evt, now) print \"Recording %s\" % evt f.write(pickle.dumps(output).replace( \"n\", \"&&&\") + \"n\") # Now call the advised service return invocation.proceed()","text_count":582,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class Recorder(MethodInterceptor):\n\"\"\"\nAn interceptor that catches each event,\nwrite it to disk, then proceeds to the\nnetwork management app.\n\"\"\"\ndef __init__(self):\nself.filename = \"recipe65_data.txt\"\nself.special_char = \"&amp;&amp;&amp;\"\nif os.path.exists(self.filename):\nos.remove(self.filename)\ndef invoke(self, invocation):\n# Write data to disk\nwith open(self.filename, \"a\") as f:\nevt = invocation.args[0]\nnow = datetime.now()\noutput = (evt, now)\nprint \"Recording %s\" % evt\nf.write(pickle.dumps(output).replace(\n\"n\", \"&amp;&amp;&amp;\") + \"n\")\n# Now call the advised service\nreturn invocation.proceed()"}]}]},{"block_type":"element","block":"k6bfvbeu","search_text":"Add some code that wraps the network management application with the interceptor and advertises it using Pyro, as shown here: ","text_count":126,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some code that wraps the network management application with the interceptor and advertises it using Pyro, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbev","search_text":"# Wrap the network app with an interceptor advisor = ProxyFactoryObject() advisor.target = target_service advisor.interceptors = [Recorder()] # Expose the advised network app as a Pyro service advised_service = PyroServiceExporter() advised_service.service_name = \"network_advised\" advised_service.service = advisor advised_service.after_properties_set()","text_count":354,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Wrap the network app with an interceptor\nadvisor = ProxyFactoryObject()\nadvisor.target = target_service\nadvisor.interceptors = [Recorder()]\n# Expose the advised network app as a Pyro service\nadvised_service = PyroServiceExporter()\nadvised_service.service_name = \"network_advised\"\nadvised_service.service = advisor\nadvised_service.after_properties_set()"}]}]},{"block_type":"element","block":"k6bfvbew","search_text":"Start up the server app by typing python recipe65_server.py . In the following screenshot, notice that there is both a network service and a network_advised service registered with Pyro: ","text_count":187,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start up the server app by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe65_server.py"}]},{"block_type":"text","content":". In the following screenshot, notice that there is both a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network"}]},{"block_type":"text","content":"service and a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network_advised"}]},{"block_type":"text","content":"service registered with Pyro:"}]}]},{"block_type":"element","block":"k6bfvbex","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000062.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbey","search_text":"Run the live data simulator by typing python recipe65_livedata.py and watch it run until it generates a few events, and then hit Ctrl + C to break out of it: ","text_count":158,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the live data simulator by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe65_livedata.py"}]},{"block_type":"text","content":"and watch it run until it generates a few events, and then hit"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Ctrl"}]},{"block_type":"text","content":"+"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"C"}]},{"block_type":"text","content":"to break out of it:"}]}]},{"block_type":"element","block":"k6bfvbez","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000070.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbf0","search_text":"Look at the server side of things, and notice how it recorded several events: ","text_count":78,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Look at the server side of things, and notice how it recorded several events:"}]}]},{"block_type":"element","block":"k6bfvbf1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000045.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbf2","search_text":"Inspect the recipe65_data.txt data file, noting how each line represents a separate event and time stamp. While it's hard to decipher the data stored in a pickled format, it's possible to spot bits and pieces. Create a playback script called recipe65_playback.py that de-pickles each line of the data file, as shown here: ","text_count":322,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inspect the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe65_data.txt"}]},{"block_type":"text","content":"data file, noting how each line represents a separate event and time stamp. While it's hard to decipher the data stored in a pickled format, it's possible to spot bits and pieces."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a playback script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe65_playback.py"}]},{"block_type":"text","content":"that de-pickles each line of the data file, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbf3","search_text":"from springpython.remoting.pyro import * from datetime import datetime import pickle import time with open(\"recipe65_data.txt\") as f: lines = f.readlines() events = [pickle.loads(line.replace(\"&&&\", \"n\")) for line in lines]","text_count":223,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from springpython.remoting.pyro import *\nfrom datetime import datetime\nimport pickle\nimport time\nwith open(\"recipe65_data.txt\") as f:\nlines = f.readlines()\nevents = [pickle.loads(line.replace(\"&amp;&amp;&amp;\", \"n\"))\nfor line in lines]"}]}]},{"block_type":"element","block":"k6bfvbf4","search_text":"Define a client proxy to connect to the unadvised interface to our network management application, as shown here: ","text_count":114,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define a client proxy to connect to the unadvised interface to our network management application, as shown here:"}]}]},{"block_type":"element","block":"k6bfvbf5","search_text":"print \"Sending events to live network app. Ctrl+C to exit...\" proxy = PyroProxyFactory() proxy.service_url = \"PYROLOC://127.0.0.1:7766/network\"","text_count":143,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"print \"Sending events to live network app. Ctrl+C to exit...\"\nproxy = PyroProxyFactory()\nproxy.service_url = \"PYROLOC://127.0.0.1:7766/network\""}]}]},{"block_type":"element","block":"k6bfvbf6","search_text":"Add code that iterates over each event, playing back the events as quickly as possible, as shown here:","text_count":102,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Add code that iterates over each event, playing back the events as quickly as possible, as shown here:"}]},{"block_type":"element","block":"k6bfvbf7","search_text":"for (e, time_it_happened) in events: stored_event, is_active, updated_services, updated_equipment = proxy.process(e)) print \"Stored event: %s\" % stored_event print \"Active? %s\" % is_active print \"Services updated: %s\" % updated_services print \"Equipment updated; %s\" % updated_equipment print \"================\"","text_count":311,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"for (e, time_it_happened) in events:\nstored_event, is_active, updated_services,\nupdated_equipment = proxy.process(e))\nprint \"Stored event: %s\" % stored_event\nprint \"Active? %s\" % is_active\nprint \"Services updated: %s\" % updated_services\nprint \"Equipment updated; %s\" % updated_equipment\nprint \"================\""}]}]},{"block_type":"element","block":"k6bfvbf8","search_text":"Run the playback script by typing python recipe65_playback.py , observing how it doesn't delay events but instead plays them back as quickly as possible: ","text_count":154,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the playback script by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe65_playback.py"}]},{"block_type":"text","content":", observing how it doesn't delay events but instead plays them back as quickly as possible:"}]}]},{"block_type":"element","block":"k6bfvbf9","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000061.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbfa","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbfb","search_text":"Normally, we would be recording data coming in from the live network. In this situation, we need a simulator that generates random data. The simulator we coded in this recipe is very similar to the one shown in the Coding a data simulator recipe.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Normally, we would be recording data coming in from the live network. In this situation, we need a simulator that generates random data. The simulator we coded in this recipe is very similar to the one shown in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Coding a data simulator"}]},{"block_type":"text","content":"recipe."}]},{"block_type":"element","block":"k6bfvbfc","search_text":"To capture the data, we coded an interceptor that is embedded between Pyro and the network management application. Every event published to the network_advised Pyro service name seamlessly passes through this interceptor. Consider the following:","text_count":245,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To capture the data, we coded an interceptor that is embedded between Pyro and the network management application. Every event published to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"network_advised"}]},{"block_type":"text","content":"Pyro service name seamlessly passes through this interceptor. Consider the following:"}]},{"block_type":"element","block":"k6bfvbfd","search_text":"Each event that comes in is appended to the data file that was initialized when the interceptor was first created. The event is also stored with a copy of datetime.now() to capture a time stamp. The event and time stamp are combined into a tuple, and pickled, making it easy to write and later read back from disk. ","text_count":315,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Each event that comes in is appended to the data file that was initialized when the interceptor was first created."},{"block_type":"element","tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The event is also stored with a copy of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime.now()"}]},{"block_type":"text","content":"&nbsp;to capture a time stamp."}]}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The event and time stamp are combined into a tuple, and pickled, making it easy to write and later read back from disk."}]}]},{"block_type":"element","block":"k6bfvbfe","search_text":"The data is pickled to make it easy to transfer to and from disk. After writing it to disk, the interceptor calls the target service and passes the results back to the original caller. ","text_count":185,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The data is pickled to make it easy to transfer to and from disk."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"After writing it to disk, the interceptor calls the target service and passes the results back to the original caller."}]}]},{"block_type":"element","block":"k6bfvbff","search_text":"Finally, we have a playback script that reads in the data file, one event per line. It de-pickles each line into the tuple format it was originally stored in, and builds a list of events.","text_count":187,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we have a playback script that reads in the data file, one event per line. It de-pickles each line into the tuple format it was originally stored in, and builds a list of events."}]},{"block_type":"element","block":"k6bfvbfg","search_text":"The list of events is then scanned, one at a time. Instead of evaluating the time stamps to figure out how long to delay playing back the events, they are injected immediately into the network management application.","text_count":216,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The list of events is then scanned, one at a time. Instead of evaluating the time stamps to figure out how long to delay playing back the events, they are injected immediately into the network management application."}]},{"block_type":"element","block":"k6bfvbfh","search_text":"The playback script uses Pyro to send the events in to the network management application, but it talks to a different exposure point. This is to avoid re-recording the same event.","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The playback script uses Pyro to send the events in to the network management application, but it talks to a different exposure point. This is to avoid re-recording the same event."}]},{"block_type":"element","block":"k6bfvbfi","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbfj","search_text":"The code in this recipe uses Pyro as the mechanism connecting clients and servers communicates in a publish/subscribe paradigm. This isn't the only way to build such a service. Python has XML-RPC built in as well. It just isn't as flexible as Pyro. A more thorough analysis of real traffic is needed to determine whether this interface is good enough. Alternatives include pushing events through a database EVENT table where the client inserts rows and the server polls the table for new rows, and then removes them as they are consumed.","text_count":537,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code in this recipe uses Pyro as the mechanism connecting clients and servers communicates in a publish/subscribe paradigm. This isn't the only way to build such a service. Python has XML-RPC built in as well. It just isn't as flexible as Pyro. A more thorough analysis of real traffic is needed to determine whether this interface is good enough. Alternatives include pushing events through a database EVENT table where the client inserts rows and the server polls the table for new rows, and then removes them as they are consumed."}]},{"block_type":"element","block":"k6bfvbfk","search_text":"This recipe also makes heavy use of Spring Python for its aspect-oriented programming features to insert the data recording code ( http://static.springsource.org/spring-python/1.1.x/reference/html/aop.html ). This provides a clean way to add the extra layer of functionality we need to sniff and record network traffic without having to touch the existing network management code.","text_count":380,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe also makes heavy use of Spring Python for its"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"aspect-oriented programming"}]},{"block_type":"text","content":"features to insert the data recording code ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://static.springsource.org/spring-python/1.1.x/reference/html/aop.html"},"children":[{"block_type":"text","content":"http://static.springsource.org/spring-python/1.1.x/reference/html/aop.html"}]},{"block_type":"text","content":"). This provides a clean way to add the extra layer of functionality we need to sniff and record network traffic without having to touch the existing network management code."}]},{"block_type":"element","block":"k6bfvbfl","search_text":"What is the difference between this and playing back in real time?","text_count":66,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What is the difference between this and playing back in real time?"}]},{"block_type":"element","block":"k6bfvbfm","search_text":"Real-time playback is useful to see how the system handles production load. But this doesn't answer the question of where the system is expected to break. Traffic flow is never steady. Instead, it often has bursts that are not expected. That is when playing back live data at an accelerated rate will help expose the system's next breakpoints.","text_count":343,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Real-time playback is useful to see how the system handles production load. But this doesn't answer the question of where the system is expected to break. Traffic flow is never steady. Instead, it often has bursts that are not expected. That is when playing back live data at an accelerated rate will help expose the system's next breakpoints."}]},{"block_type":"element","block":"k6bfvbfn","search_text":"Preemptively addressing some of these concerns will make our system more resilient.","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Preemptively addressing some of these concerns will make our system more resilient."}]},{"block_type":"element","block":"k6bfvbfo","search_text":"Where are the breaking points of this application?","text_count":50,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Where are the breaking points of this application?"}]},{"block_type":"element","block":"k6bfvbfp","search_text":"Admittedly, this recipe didn't break when we played back four events as fast as possible. Would this be the same result in production? Things break in different ways. We may not get a real exception or error message but instead discover that certain parts of the system become backlogged.","text_count":288,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Admittedly, this recipe didn't break when we played back four events as fast as possible. Would this be the same result in production? Things break in different ways. We may not get a real exception or error message but instead discover that certain parts of the system become backlogged."}]},{"block_type":"element","block":"k6bfvbfq","search_text":"That is where this recipe reaches its limit. While we have demonstrated how to overload the system with a large volume of traffic, we are not showing how to monitor where the bottlenecks are.","text_count":191,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That is where this recipe reaches its limit. While we have demonstrated how to overload the system with a large volume of traffic, we are not showing how to monitor where the bottlenecks are."}]},{"block_type":"element","block":"k6bfvbfr","search_text":"If the application under load uses database tables to queue up work, then we would need to write the code that monitors them all and report the following:","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the application under load uses database tables to queue up work, then we would need to write the code that monitors them all and report the following:"}]},{"block_type":"element","block":"k6bfvbfs","search_text":"Which one is the longest Which one is getting longer, and showing no sign of catching up Which one is the earliest in the pipeline of activity ","text_count":143,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Which one is the longest"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Which one is getting longer, and showing no sign of catching up"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Which one is the earliest in the pipeline of activity"}]}]},{"block_type":"element","block":"k6bfvbft","search_text":"In systems with stages of processing, there is often one bottleneck that makes itself known. When that bottleneck is fixed, it is rarely the only bottleneck. It was simply either the most critical one or the first one in a chain.","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In systems with stages of processing, there is often one bottleneck that makes itself known. When that bottleneck is fixed, it is rarely the only bottleneck. It was simply either the most critical one or the first one in a chain."}]},{"block_type":"element","block":"k6bfvbfu","search_text":"Also, this recipe cannot solve your bottleneck. The purpose of this recipe is to find it.","text_count":89,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Also, this recipe cannot solve your bottleneck. The purpose of this recipe is to find it."}]},{"block_type":"element","block":"k6bfvbfv","search_text":"I once built a network load tester very much like this one. The code could handle processing lots of traffic in parallel, but events from the same device had to be processed in order. Replaying a days worth of events all at once exposed the fact that too many events from the same device caused the entire queue system to become overloaded and starve out handling other devices. After improving the service update algorithm, we were able to replay the same load test and verify it could keep up. This helped avoid non-reproducible outages that happened after hours or on weekends.","text_count":580,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I once built a network load tester very much like this one. The code could handle processing lots of traffic in parallel, but events from the same device had to be processed in order. Replaying a days worth of events all at once exposed the fact that too many events from the same device caused the entire queue system to become overloaded and starve out handling other devices. After improving the service update algorithm, we were able to replay the same load test and verify it could keep up. This helped avoid non-reproducible outages that happened after hours or on weekends."}]},{"block_type":"element","block":"k6bfvbfw","search_text":"What amount of live data should be collected?","text_count":45,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What amount of live data should be collected?"}]},{"block_type":"element","block":"k6bfvbfx","search_text":"It is useful for capturing things such as a 24-hour block of traffic to allow an entire day of events to be played back. Another possibility is an entire week. Live systems may be apt to have different loads on weekends rather than weekdays, and a week of data will allow better investigation.","text_count":293,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is useful for capturing things such as a 24-hour block of traffic to allow&nbsp;an entire day of events to be&nbsp;played back. Another possibility is an entire week. Live systems may be apt to have different loads on weekends rather than weekdays, and a week of data will allow better investigation."}]},{"block_type":"element","block":"k6bfvbfy","search_text":"The problem with this much data is that it is hard to pick out a window to investigate. This is why 24 hours of data from the weekend and 24 hours of data during the week may be more practical.","text_count":193,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The problem with this much data is that it is hard to pick out a window to investigate. This is why 24 hours of data from the weekend and 24 hours of data during the week may be more practical."}]},{"block_type":"element","block":"k6bfvbfz","search_text":"If there is some sort of network instability where huge outages are occurring and causing a huge flow of traffic, it may be useful to turn on the collector and wait for another similar outage to occur. After such an outage occurs, it may be useful to shift through the data file and trim it down to where the uptick in traffic occurred.","text_count":336,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If there is some sort of network instability where huge outages are occurring and causing a huge flow of traffic, it may be useful to turn on the collector and wait for another similar outage to occur. After such an outage occurs, it may be useful to shift through the data file and trim it down to where the uptick in traffic occurred."}]},{"block_type":"element","block":"k6bfvbg0","search_text":"These types of captured scenarios are invaluable in load testing new releases, because they confirm that new patches either improve performance as expected, or at least don't reduce performance when fixing non-performance issues.","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These types of captured scenarios are invaluable in load testing new releases, because they confirm that new patches either improve performance as expected, or at least don't reduce performance when fixing non-performance issues."}]},{"block_type":"element","block":"k6bfvbg1","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvbg2","search_text":"The Writing a data simulator recipe The Recording and playing back live data in real-time recipe ","text_count":97,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a data simulator"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Recording and playing back live data in real-time"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k6bfvbg3","search_text":"Automating your management demo","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Automating your management demo"}]},{"block_type":"element","block":"k6bfvbg4","search_text":"Got a demo coming? Write automated tests that simulate the steps you'll be taking. Then print out your test suite, and use it like a script.","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Got a demo coming? Write automated tests that simulate the steps you'll be taking. Then print out your test suite, and use it like a script."}]},{"block_type":"element","block":"k6bfvbg5","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbg6","search_text":"With these steps, we will see how to write our management demo script in a runnable fashion:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With these steps, we will see how to write our management demo script in a runnable fashion:"}]},{"block_type":"element","block":"k6bfvbg7","search_text":"Create a new file called recipe66.py for the test code for our management demo. Create a unittest test scenario to capture your demo. Write a series of operations as if you were driving the application from this automated test. Include asserts at every point where you will vocally point out something during the demo. Take a look at this code: ","text_count":345,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe66.py"}]},{"block_type":"text","content":"&nbsp;for the test code for our management demo."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"unittest"}]},{"block_type":"text","content":"test scenario to capture your demo."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a series of operations as if you were driving the application from this automated test."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Include asserts at every point where you will vocally point out something during the demo. Take a look at this code:"}]}]},{"block_type":"element","block":"k6bfvbg8","search_text":"import unittest from network import * from springpython.database.factory import * class ManagementDemo(unittest.TestCase): def setUp(self): factory = MySQLConnectionFactory(\"user\", \"password\", \"localhost\", \"recipe62\") self.correlator = EventCorrelator(factory) dt = DatabaseTemplate(factory) sql = open(\"recipe62_network.mysql\").read().split(\";\") for statement in sql: dt.execute(statement + \";\") def test_processing_a_service_affecting_event(self): # Define a service-affecting event evt1 = Event(\"pyhost1\", \"serverRestart\", 5) # Inject it into the system stored_event, is_active, updated_services, updated_equipment = self.correlator.process(evt1) # These are the values I plan to call # attention to during my demo self.assertEquals(len(updated_services), 1) self.assertEquals(\"service-abc\", updated_services[0][\"service\"][\"NAME\"]) self.assertEquals(\"Outage\", updated_services[0][\"service\"][\"STATUS\"]) if __name__ == \"__main__\": unittest.main()","text_count":947,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import unittest\nfrom network import *\nfrom springpython.database.factory import *\nclass ManagementDemo(unittest.TestCase):\ndef setUp(self):\nfactory = MySQLConnectionFactory(\"user\", \"password\",\n\"localhost\", \"recipe62\")\nself.correlator = EventCorrelator(factory)\ndt = DatabaseTemplate(factory)\nsql = open(\"recipe62_network.mysql\").read().split(\";\")\nfor statement in sql:\ndt.execute(statement + \";\")\ndef test_processing_a_service_affecting_event(self):\n# Define a service-affecting event\nevt1 = Event(\"pyhost1\", \"serverRestart\", 5)\n# Inject it into the system\nstored_event, is_active,\nupdated_services, updated_equipment =\nself.correlator.process(evt1)\n# These are the values I plan to call\n# attention to during my demo\nself.assertEquals(len(updated_services), 1)\nself.assertEquals(\"service-abc\",\nupdated_services[0][\"service\"][\"NAME\"])\nself.assertEquals(\"Outage\",\nupdated_services[0][\"service\"][\"STATUS\"])\nif __name__ == \"__main__\":\nunittest.main()"}]}]},{"block_type":"element","block":"k6bfvbg9","search_text":"Run the test suite by typing python recipe66.py : ","text_count":50,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the test suite by typing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python recipe66.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k6bfvbga","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-testing-cookbook/images/000024.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k6bfvbgb","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbgc","search_text":"This recipe is more philosophical and less code-based. While the concept of this recipe is valuable, it is hard to capture in a single nugget of reusable code.","text_count":159,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe is more philosophical and less code-based. While the concept of this recipe is valuable, it is hard to capture in a single nugget of reusable code."}]},{"block_type":"element","block":"k6bfvbgd","search_text":"In this test case, I inject an event, process it, and then confirm what it impacts. This test case is headless, but our demo probably won't be. So far in this chapter, we haven't built any user screens. As we develop user screens, we need to ensure they call the same APIs this automated test calls.","text_count":299,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this test case, I inject an event, process it, and then confirm what it impacts. This test case is headless, but our demo probably won't be. So far in this chapter, we haven't built any user screens. As we develop user screens, we need to ensure they call the same APIs this automated test calls."}]},{"block_type":"element","block":"k6bfvbge","search_text":"Given this, we are set up to use the screens to define the same event shown in the test. After the event is digested, another screen will probably exist that shows current service status. We would expect it to reflect the update to Outage.","text_count":239,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Given this, we are set up to use the screens to define the same event shown in the test. After the event is digested, another screen will probably exist that shows current service status. We would expect it to reflect the update to Outage."}]},{"block_type":"element","block":"k6bfvbgf","search_text":"During our management demo, we will then point out/zoom in to this part of the screen and show how service-abc switched from Operational to Outage.","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"During our management demo, we will then point out/zoom in to this part of the screen and show how"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"service-abc"}]},{"block_type":"text","content":"switched from"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Operational"}]},{"block_type":"text","content":"to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Outage."}]}]},{"block_type":"element","block":"k6bfvbgg","search_text":"If the screens are built to delegate to this underlying logic, then the screen logic is little more than components put together to display information. The core logic being tested maintains its headless and easy-to-test nature.","text_count":228,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the screens are built to delegate to this underlying logic, then the screen logic is little more than components put together to display information. The core logic being tested maintains its headless and easy-to-test nature."}]},{"block_type":"element","block":"k6bfvbgh","search_text":"Our code sample isn't complete, and wouldn't amount to more than a one minute demo. But the concept is sound. By capturing the steps we plan to execute in our demo in a runnable form, our management demo should go off without a hitch.","text_count":234,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Our code sample isn't complete, and wouldn't amount to more than a one minute demo. But the concept is sound. By capturing the steps we plan to execute in our demo in a runnable form, our management demo should go off without a hitch."}]},{"block_type":"element","block":"k6bfvbgi","search_text":"Did I say without a hitch? Well, demos rarely work that well. Doesn't something about management appearances cause things to break? At one time, I began prepping for a senior management demo a month in advance using this recipe. I uncovered and subsequently fixed several bugs, such that my demo worked flawlessly. Management was impressed. I'm not making any promises here, but sincerely making your demo 100% runnable will greatly increase your odds.","text_count":452,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Did I say without a hitch? Well, demos rarely work that well. Doesn't something about management appearances cause things to break? At one time, I began prepping for a senior management demo a month in advance using this recipe. I uncovered and subsequently fixed several bugs, such that my demo worked flawlessly. Management was impressed. I'm not making any promises here, but sincerely making your demo 100% runnable will greatly increase your odds."}]},{"block_type":"element","block":"k6bfvbgj","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbgk","search_text":"What is the secret to this recipe? It seems to be a bit short on code. While it's important to make the demo 100 percent runnable, the key is then printing out the test and using it like a script. That way, the only steps you are taking have already been proven to work.","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What is the secret to this recipe? It seems to be a bit short on code. While it's important to make the demo 100 percent runnable, the key is then printing out the test and using it like a script. That way, the only steps you are taking have already been proven to work."}]},{"block_type":"element","block":"k6bfvbgl","search_text":"What if my manager likes to take detours?","text_count":41,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"What if my manager likes to take detours?"}]},{"block_type":"element","block":"k6bfvbgm","search_text":"If your manager likes to ask lots of what-if questions that pull you off-script, then you are sailing into uncharted territory. Your odds for a successful demo may drop quickly.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If your manager likes to ask lots of what-if questions that pull you off-script, then you are sailing into uncharted territory. Your odds for a successful demo may drop quickly."}]},{"block_type":"element","block":"k6bfvbgn","search_text":"You can politely dodge this by capturing their what-ifs for a future demo and try to keep the current one on track. If you take the plunge to try other things out, realize the risk you are taking.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can politely dodge this by capturing their what-ifs for a future demo and try to keep the current one on track. If you take the plunge to try other things out, realize the risk you are taking."}]},{"block_type":"element","block":"k6bfvbgo","search_text":"Don't be afraid to promise a future demo where you will travel down the path requested instead of risking it in this demo. Managers are actually pretty open to accepting a response such as: I haven't tested that yet. How about another demo next month where we cover that? Failed demos leave a bad taste in the mouth of management and put your reputation in jeopardy. Successful ones have an equally positive effect on your reputation as a developer. Management tends to have a more optimistic view of seeing 70% of the system succeed 100% rather than 100% of the system succeed 70%.","text_count":582,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Don't be afraid to promise a future demo where you will travel down the path requested instead of risking it in this demo. Managers are actually pretty open to accepting a response such as:"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"I haven't tested that yet. How about another demo next month where we cover that?"}]},{"block_type":"text","content":"&nbsp;Failed demos leave a bad taste in the mouth of management and put your reputation in jeopardy. Successful ones have an equally positive effect on your reputation as a developer. Management tends to have a more optimistic view of seeing 70% of the system succeed 100% rather than 100% of the system succeed 70%."}]},{"block_type":"element","block":"k6bfvbgp","search_text":"This is where the line between engineer and manager needs to be observed. While managers want to see what's available, it is our job to show them what is currently working and give an accurate status on what is and isn't available. Asking to see something we haven't tested yet definitely warrants pushing back and telling them such a demo isn't ready yet.","text_count":356,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is where the line between engineer and manager needs to be observed. While managers want to see what's available, it is our job to show them what is currently working and give an accurate status on what is and isn't available. Asking to see something we haven't tested yet definitely warrants pushing back and telling them such a demo isn't ready yet."}]}]},{"title":"Good Test Habits for New and Legacy Systems","author":"Greg L. Turnquist & Bhaskar N. Das","block":"k6bfv40i","number":9,"contents":[{"block_type":"element","block":"k6bfvbgq","search_text":"In this chapter, we will cover the following topics:","text_count":52,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following topics:"}]},{"block_type":"element","block":"k6bfvbgr","search_text":"Something is better than nothing Coverage isn't everything Be willing to invest in text fixtures If you aren't convinced about the value of testing, your team won't be either Harvesting metrics Capturing a bug in an automated test Separating algorithms from concurrency Pausing to refactor when a test suite takes too long to run Cashing in on your confidence Be willing to throw away an entire day's changes Instead of shooting for 100 percent coverage, try to have steady growth Randomly breaking up your application can lead to better code ","text_count":543,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Something is better than nothing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Coverage isn't everything"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Be willing to invest in text fixtures"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If you aren't convinced about the value of testing, your team won't be either"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Harvesting metrics"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Capturing a bug in an automated test"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Separating algorithms from concurrency"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pausing to refactor when a test suite takes too long to run"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Cashing in on your confidence"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Be willing to throw away an entire day's changes"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Instead of shooting for 100 percent coverage, try to have steady growth"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Randomly breaking&nbsp;up your application can lead to better code"}]}]},{"block_type":"element","block":"k6bfvbgs","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k6bfvbgt","search_text":"I hope you have enjoyed the previous chapters of this book. Up to this point, we have explored a lot of areas of automated testing, such as:","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I hope you have enjoyed the previous chapters of this book. Up to this point, we have explored a lot of areas of automated testing, such as:"}]},{"block_type":"element","block":"k6bfvbgu","search_text":"Unit testing Nose testing Doctest testing Behavior-driven development Acceptance testing Continuous integration Smoke and load testing ","text_count":135,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Unit testing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Nose testing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Doctest testing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Behavior-driven development"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Acceptance testing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Continuous integration"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Smoke and load testing"}]}]},{"block_type":"element","block":"k6bfvbgv","search_text":"In this chapter, we will do something different. Instead of providing lots of code samples for various tips and tricks, I want to share some ideas I have picked up in my career as a software engineer.","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will do something different. Instead of providing lots of code samples for various&nbsp;tips and tricks, I want to share some ideas I have picked up in my career as a software engineer."}]},{"block_type":"element","block":"k6bfvbgw","search_text":"All of the previous recipes in this book had very detailed steps on how to write the code, run it, and review its results. Hopefully, you have taken those ideas, expanded on them, improvised them, and, ultimately, applied them to help solve your own software problems.","text_count":268,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All of the previous recipes in this book had very detailed steps on how to write the code, run it, and review its results. Hopefully, you have taken those ideas, expanded on them, improvised them, and, ultimately, applied them to help solve your own software problems."}]},{"block_type":"element","block":"k6bfvbgx","search_text":"In this chapter, let's explore some of the bigger ideas behind testing and how they can empower our development of quality systems.","text_count":131,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, let's explore some of the bigger ideas behind testing and how they can empower our development of quality systems."}]},{"block_type":"element","block":"k6bfvbgy","search_text":"Something is better than nothing","text_count":32,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Something is better than nothing"}]},{"block_type":"element","block":"k6bfvbgz","search_text":"Don't get caught up in the purity of total isolation or worry about obscure test methods. The first thing to do is to start testing.","text_count":132,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Don't get caught up in the purity of total isolation or worry about obscure test methods. The first thing to do is to start testing."}]},{"block_type":"element","block":"k6bfvbh0","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbh1","search_text":"You have just been handed an application that was developed by others who are no longer with your company. Been there before? We all have, and probably on several occasions. Can we predict some of the common symptoms? Well, they could be similar to these:","text_count":255,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You have just been handed an application that was developed by others who are no longer with your company. Been there before? We all have, and probably on several occasions. Can we predict some of the common symptoms? Well, they could be similar to these:"}]},{"block_type":"element","block":"k6bfvbh2","search_text":"There are few (if any) automated tests. There is little documentation. There are chunks of code that have been commented out. There are either no comments in the code, or there are comments that were written ages ago and are no longer correct. ","text_count":244,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There are few (if any) automated tests."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There is little documentation."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There are chunks of code that have been commented out."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There are either no comments in the code, or there are comments that were written ages ago and are no longer correct."}]}]},{"block_type":"element","block":"k6bfvbh3","search_text":"And here is the fun part—we don't know about all of these issues up front. We are basically told where to check the source tree, and to get cracking. For example, it's only when we run into an issue and seek documentation that we discover what does (or does not) exist.","text_count":269,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"And here is the fun part&mdash;we don't know about all of these issues up front. We are basically told where to check the source tree, and to get cracking. For example, it's only when we run into an issue and seek&nbsp; documentation that we discover what does (or does not) exist."}]},{"block_type":"element","block":"k6bfvbh4","search_text":"Maybe I didn't catch everything you have encountered in that list, but I bet you've experienced a lot of those things. I don't want to sound like an embittered software developer, because I'm not. Not every project is like this. But I'm sure we have all had to deal with this at one time or another. So, what do we do? We start testing.","text_count":336,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Maybe I didn't catch everything you have encountered in that list, but I bet you've experienced a lot of those things. I don't want to sound like an embittered software developer, because I'm not. Not every project is like this. But I'm sure we have all had to deal with this at one time or another. So, what do we do? We start testing."}]},{"block_type":"element","block":"k6bfvbh5","search_text":"But the devil is in the details. Do we write a unit test? What about a thread test or an integration test? You know what? It doesn't matter what type of test we write. In fact, it doesn't even matter whether we use the right name.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But the devil is in the details. Do we write a unit test? What about a thread test or an integration test? You know what? It doesn't matter what type of test we write. In fact, it doesn't even matter whether we use the right name."}]},{"block_type":"element","block":"k6bfvbh6","search_text":"When it's just you and the code sitting in a cubicle, terminology doesn't matter. Writing a test is what matters. If you can pick out one small unit of code and write a test, then go for it! But what if you picked up a jumbled piece of spaghetti code that doesn't come with nicely isolated units?","text_count":296,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When it's just you and the code sitting in a cubicle, terminology doesn't matter. Writing a test is what matters. If you can pick out one small unit of code and write a test, then go for it! But what if you picked up a jumbled piece of spaghetti code that doesn't come with nicely isolated units?"}]},{"block_type":"element","block":"k6bfvbh7","search_text":"Consider a system where the smallest unit you can get hold of is a module that parses an electronic file and then stores the parsed results in a database. The parsed results aren't handed back through the API. They just silently, mysteriously end up in the database. How do we automate that? Well, we can do the following things:","text_count":329,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Consider a system where the smallest unit you can get hold of is a module that parses an electronic file and then stores the parsed results in a database. The parsed results aren't handed back through the API. They just silently, mysteriously end up in the database. How do we automate that? Well, we can do the following things:"}]},{"block_type":"element","block":"k6bfvbh8","search_text":"Write a test that starts by emptying all the tables relevant to the application. Find one of your users who has one of these files and get a copy of it. Add code to the test that invokes the top-level API to ingest the file. Add some more code that pulls data out of the database and checks the results. (You may have to grab that user to make sure the code is working correctly.) ","text_count":381,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a test that starts by emptying all the tables relevant to the application."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Find one of your users who has one of these files and get a copy of it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add code to the test that invokes the top-level API to ingest the file."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some more code that pulls data out of the database and checks the results. (You may have to grab that user to make sure the code is working correctly.)"}]}]},{"block_type":"element","block":"k6bfvbh9","search_text":"Congratulations! You just wrote an automated test! It probably didn't qualify as a unit test. In fact, it may look kind of ugly to you, but so what? Maybe it took five minutes to run, but isn't that better than no test at all?","text_count":226,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Congratulations! You just wrote an automated test! It probably didn't qualify as a unit test. In fact, it may look kind of ugly to you, but so what? Maybe it took five minutes to run, but isn't that better than no test at all?"}]},{"block_type":"element","block":"k6bfvbha","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbhb","search_text":"Since the database is the place where we can assert results, we need to have a cleaned-out version before every run of our test. This will definitely require coordination if other developers are using some of the same tables. We may need our own schema allocated to us so that we can empty tables at will.","text_count":305,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Since the database is the place where we can assert results, we need to have a cleaned-out version before every run of our test. This will definitely require coordination if other developers are using some of the same tables. We may need our own schema allocated to us so that we can empty tables at will."}]},{"block_type":"element","block":"k6bfvbhc","search_text":"The modules probably suffer from a lack of cohesion and too much tight coupling. While we can try to identify why the code is bad, it doesn't advance our cause of building automated tests.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The modules probably suffer from a lack of cohesion and too much tight coupling. While we can try to identify why the code is bad, it doesn't advance our cause of building automated tests."}]},{"block_type":"element","block":"k6bfvbhd","search_text":"Instead, we must recognize that if we try to jump immediately into the unit level test, we will have to refactor the modules to support us. With little or no safety net, the risk is incredibly high, and we can feel it! If we tried to stick to a textbook unit test, then we would probably give up and consider automated testing an impossibility.","text_count":344,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead, we must recognize that if we try to jump immediately into the unit level test, we will have to refactor the modules to support us. With little or no safety net, the risk is incredibly high, and we can feel it! If we tried to stick to a textbook unit test, then we would probably give up and consider automated testing an impossibility."}]},{"block_type":"element","block":"k6bfvbhe","search_text":"So, we have to take the first step and write an expensive, end-to-end, automated test to build the first link of the chain. That test may take a long time to run and may not be very comprehensive in what we can assert, but it's a start, and that is what's important. Hopefully, after making steady progress writing more tests like this, we will build up a safety net that will prevent us from having to go back and refactor this code.","text_count":434,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So, we have to take the first step and write an expensive, end-to-end, automated test to build the first link of the chain. That test may take a long time to run and may not be very comprehensive in what we can assert, but it's a start, and that is what's important. Hopefully, after making steady progress writing more tests like this, we will build up a safety net that will prevent us from having to go back and refactor this code."}]},{"block_type":"element","block":"k6bfvbhf","search_text":"That can't be everything!","text_count":25,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"That can't be everything!"}]},{"block_type":"element","block":"k6bfvbhg","search_text":"Does just write the test sound a little too simple? Well, the concept is simple, but the work is going to be hard—very hard.","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Does"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"just write the test"}]},{"block_type":"text","content":"sound a little too simple? Well, the concept is simple, but the work is going to be hard&mdash;very hard."}]},{"block_type":"element","block":"k6bfvbhh","search_text":"You will be forced to crawl through lots of APIs and find out exactly how they work. And, guess what? You probably won't be handed lots of intermediate results to assert. Understanding the API is just so that you can track down where the data travels to.","text_count":254,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You will be forced to crawl through lots of APIs and find out exactly how they work. And, guess what? You probably won't be handed lots of intermediate results to assert. Understanding the API is just so that you can track down where the data travels to."}]},{"block_type":"element","block":"k6bfvbhi","search_text":"When I described the data of our situation as mysteriously ending up in the database , I was referring to the likelihood that the APIs you have probably weren't designed with lots of return values aimed at testability.","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When I described the data of our situation as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"mysteriously ending up in the database"}]},{"block_type":"text","content":", I was referring to the likelihood that the APIs you have probably weren't designed with lots of return values aimed at testability."}]},{"block_type":"element","block":"k6bfvbhj","search_text":"Just don't let anyone tell you that you are wasting your time building a long-running test case. An automated test suite that takes an hour to run and is exercised at least once a day probably instills more confidence than clicking through the screens manually. Something is better than nothing.","text_count":295,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Just don't let anyone tell you that you are wasting your time building a long-running test case. An automated test suite that takes an hour to run and is exercised at least once a day probably instills more confidence than clicking through the screens manually. Something is better than nothing."}]},{"block_type":"element","block":"k6bfvbhk","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvbhl","search_text":"The Cash in on your confidence recipe ","text_count":38,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Cash in on your confidence"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k6bfvbhm","search_text":"Coverage isn't everything","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Coverage isn't everything"}]},{"block_type":"element","block":"k6bfvbhn","search_text":"You've figured out how to run coverage reports. However, don't assume that more coverage is automatically better. Sacrificing test quality in the name of coverage is a recipe for failure.","text_count":187,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You've figured out how to run coverage reports. However, don't assume that more coverage is automatically better. Sacrificing test quality in the name of coverage is a recipe for failure."}]},{"block_type":"element","block":"k6bfvbho","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbhp","search_text":"Coverage reports provide good feedback. They tell us what is getting exercised and what is not. But, just because a line of code is exercised, that doesn't mean it is doing everything it is meant to do.","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Coverage reports"}]},{"block_type":"text","content":"provide good feedback. They tell us what is getting exercised and what is not. But, just because a line of code is exercised, that doesn't mean it is doing everything it is meant to do."}]},{"block_type":"element","block":"k6bfvbhq","search_text":"Are you ever tempted to brag about coverage percentage scores in the break room? Taking pride in good coverage isn't unwarranted, but when it leads to comparing different projects using these statistics, we are wandering into risky territory.","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Are you ever tempted to brag about coverage percentage scores in the break room? Taking pride in good coverage isn't unwarranted, but when it leads to comparing different projects using these statistics, we are wandering into risky territory."}]},{"block_type":"element","block":"k6bfvbhr","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbhs","search_text":"Coverage reports are meant to be read in the context of the code they were run against. The reports show us what was covered and what was not, but this isn't where things stop. Instead, it's where they begin. We need to look at what was covered and analyze how well the tests exercised the system.","text_count":297,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Coverage reports are meant to be read in the context of the code they were run against. The reports show us what was covered and what was not, but this isn't where things stop. Instead, it's where they begin. We need to look at what was covered and analyze how well the tests exercised the system."}]},{"block_type":"element","block":"k6bfvbht","search_text":"It's obvious that 0% coverage of a module indicates we have work to do. But what does it mean when we have 70% coverage? Do we need to code tests that go after the other 30%? Sure we do! But there are two different schools of thought on how to approach this. One is right, and one is wrong.","text_count":290,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's obvious that 0% coverage of a module indicates we have work to do. But what does it mean when we have 70% coverage? Do we need to code tests that go after the other 30%? Sure we do! But there are two different schools of thought on how to approach this. One is right, and one is wrong."}]},{"block_type":"element","block":"k6bfvbhu","search_text":"The first approach is to write the new tests specifically targeting the uncovered parts while trying to avoid overlapping the original 70%. Redundantly testing code already covered in another test is an inefficient use of resources. The second approach is to write the new tests so that they target scenarios the code is expected to handle, but that we haven't tackled yet. What was not covered should give us a hint about which scenarios haven't been tested yet. ","text_count":464,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first approach is to write the new tests specifically targeting the uncovered parts while trying to avoid overlapping the original 70%. Redundantly testing code already covered in another test is an inefficient use of resources."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The second approach is to write the new tests so that they target scenarios the code is expected to handle, but that we haven't tackled yet. What was not covered should give us a hint about which scenarios haven't been tested yet."}]}]},{"block_type":"element","block":"k6bfvbhv","search_text":"The right approach is the second one. OK, I admit I wrote that in a leading fashion. But the point is that it's very easy to look at what wasn't hit and write a test that aims to close the gap as fast as possible.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The right approach is the second one. OK, I admit I wrote that in a leading fashion. But the point is that it's very easy to look at what wasn't hit and write a test that aims to close the gap as fast as possible."}]},{"block_type":"element","block":"k6bfvbhw","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbhx","search_text":"Python gives us incredible power to monkey patch, inject alternate methods, and do other tricks to exercise the uncovered code. But doesn't this sound a little suspicious? Here are some of the risks we are setting ourselves up for:","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python gives us incredible power to monkey patch, inject alternate methods, and do other tricks to exercise the uncovered code. But doesn't this sound a little suspicious? Here are some of the risks we are setting ourselves up for:"}]},{"block_type":"element","block":"k6bfvbhy","search_text":"The new tests may be more brittle when they aren't based on sound scenarios. A major change to our algorithms may require us to totally rewrite these tests. Ever written mock-based tests? It's possible to mock the target system out of existence and end up just testing the mocks. Even though some (or even most) of our tests may have good quality, the low-quality ones will cast our entire test suite as low quality. ","text_count":417,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The new tests may be more brittle when they aren't based on sound scenarios."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A major change to our algorithms may require us to totally rewrite these tests."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Ever written mock-based tests? It's possible to mock the target system out of existence and end up just testing the mocks."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Even though some (or even most) of our tests may have good quality, the low-quality ones will cast our entire test suite as low quality."}]}]},{"block_type":"element","block":"k6bfvbhz","search_text":"The coverage tool may not let us get away with some of these tactics if we do things that interfere with line counting mechanisms. But whether or not the coverage tool counts the code should not be the gauge by which we determine the quality of tests.","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coverage tool may not let us"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"get away"}]},{"block_type":"text","content":"with some of these tactics if we do things that interfere with line counting mechanisms. But whether or not the coverage tool counts the code should not be the gauge by which we determine the quality of tests."}]},{"block_type":"element","block":"k6bfvbi0","search_text":"Instead, we need to look at our tests and see whether they are trying to exercise real-use cases we should be handling. When we are merely looking for ways to get more coverage percentage, we stop thinking about how our code is meant to operate, and that is not good.","text_count":267,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead, we need to look at our tests and see whether they are trying to exercise real-use cases we should be handling. When we are merely looking for ways to get more coverage percentage, we stop thinking about how our code is meant to operate, and that is not good."}]},{"block_type":"element","block":"k6bfvbi1","search_text":"Are we not supposed to increase coverage?","text_count":41,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Are we not supposed to increase coverage?"}]},{"block_type":"element","block":"k6bfvbi2","search_text":"We are supposed to increase coverage by improving our tests, covering more scenarios, and removing code that's no longer supported. These things all lead us toward overall better quality. Increasing coverage for the sake of coverage doesn't lend itself to improving the quality of our system.","text_count":292,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We are supposed to increase coverage by improving our tests, covering more scenarios, and removing code that's no longer supported. These things all lead us toward overall better quality. Increasing coverage for the sake of coverage doesn't lend itself to improving the quality of our system."}]},{"block_type":"element","block":"k6bfvbi3","search_text":"But I want to brag about the coverage of my system!","text_count":51,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"But I want to brag about the coverage of my system!"}]},{"block_type":"element","block":"k6bfvbi4","search_text":"I think it's all right to celebrate good coverage. Sharing a coverage report with your manager is all right. But don't let it consume you.","text_count":138,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I think it's all right to celebrate good coverage. Sharing a coverage report with your manager is all right. But don't let it consume you."}]},{"block_type":"element","block":"k6bfvbi5","search_text":"If you start to post weekly coverage reports, double check your motives. The same goes if your manager requests postings as well.","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you start to post weekly coverage reports, double check your motives. The same goes if your manager requests postings as well."}]},{"block_type":"element","block":"k6bfvbi6","search_text":"If you find yourself comparing the coverage of your system to another system, then watch out! Unless you are familiar with the code of both systems, and really know more than the bottom line of the reports, you will probably wander into risky territory. You may be headed into the faulty competition that could drive your team to write brittle tests.","text_count":350,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you find yourself comparing the coverage of your system to another system, then watch out! Unless you are familiar with the code of both systems, and really know more than the bottom line of the reports, you will probably wander into risky territory. You may be headed into the faulty competition that could drive your team to write brittle tests."}]},{"block_type":"element","block":"k6bfvbi7","search_text":"Be willing to invest in test fixtures","text_count":37,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Be willing to invest in test fixtures"}]},{"block_type":"element","block":"k6bfvbi8","search_text":"Spend time working on some test fixtures. You may not get a lot of tests written at first, but this investment will pay off.","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Spend time working on some test fixtures. You may not get a lot of tests written at first, but this investment will pay off."}]},{"block_type":"element","block":"k6bfvbi9","search_text":"How to do it....","text_count":16,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it...."}]},{"block_type":"element","block":"k6bfvbia","search_text":"When we start building a new greenfield project, it's a lot easier to write test-oriented modules, but when dealing with legacy systems, it may take more time to build a working test fixture. This may be tough to go through, but it's a valuable investment.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When we start building a new greenfield project, it's a lot easier to write test-oriented modules, but when dealing with legacy systems, it may take more time to build a working test fixture. This may be tough to go through, but it's a valuable investment."}]},{"block_type":"element","block":"k6bfvbib","search_text":"As an example, in the section Something is better than nothing , we talked about a system that scanned electronic files and put the parsed results into database tables. What steps would our test fixture require? Perhaps we should consider the following issues:","text_count":260,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As an example, in the section"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Something is better than nothing"}]},{"block_type":"text","content":", we talked about a system that scanned electronic files and put the parsed results into database tables. What steps would our test fixture require? Perhaps we should consider the following issues:"}]},{"block_type":"element","block":"k6bfvbic","search_text":"Set up steps to clean out the appropriate tables. Quite possibly, we may need to use code or a script to create a new database schema to avoid collisions with other developers. It may be necessary to place the file in a certain location so the parser can find it. ","text_count":264,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up steps to clean out the appropriate tables."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Quite possibly, we may need to use code or a script to create a new database schema to avoid collisions with other developers."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It may be necessary to place&nbsp;the file in a certain location so the parser can find it."}]}]},{"block_type":"element","block":"k6bfvbid","search_text":"These are all steps that take time to build a working test case. More complex legacy systems may require even more steps to gear up for a test run.","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These are all steps that take time to build a working test case. More complex legacy systems may require even more steps to gear up for a test run."}]},{"block_type":"element","block":"k6bfvbie","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbif","search_text":"All of this can become intimidating and may push us to drop automated testing and just continue with clicking through the screens to verify things. But taking the time to invest in coding this fixture will begin to pay off as we write more test cases that use our fixture.","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All of this can become intimidating and may push us to drop automated testing and just continue with clicking through the screens to verify things. But taking the time to invest in coding this fixture will begin to pay off as we write more test cases that use our fixture."}]},{"block_type":"element","block":"k6bfvbig","search_text":"Have you ever built a test fixture and had to alter it for certain scenarios? After having developed enough test cases using our fixture, we will probably encounter another use case we need to test that exceeds the limits of our fixture. Since we are now familiar with it, it is probably easier to create another fixture.","text_count":321,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Have you ever built a test fixture and had to alter it for certain scenarios? After having developed enough test cases using our fixture, we will probably encounter another use case we need to test that exceeds the limits of our fixture. Since we are now familiar with it, it is probably easier to create another fixture."}]},{"block_type":"element","block":"k6bfvbih","search_text":"Note This is another way that coding the first fixture pays off. Future fixtures have a good chance of being easier to code. However, this isn't a cut-and-dried guarantee of improvement. Often, the first variation of our test fixture is a simple one. ","text_count":251,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is another way that coding the first fixture pays off. Future fixtures have a good chance of being easier to code. However, this isn't a cut-and-dried guarantee of improvement. Often, the first variation of our test fixture is a simple one."}]}]},{"block_type":"element","block":"k6bfvbii","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbij","search_text":"We will probably run into a situation where we need another test fixture that is totally different than what we've built. At this point, investing in the first test fixture doesn't have the same payoff. But, by this time, we will have become more seasoned test writers and have a better handle on what works and what doesn't when it comes to testing the system.","text_count":361,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will probably run into a situation where we need another test fixture that is totally different than what we've built. At this point, investing in the first test fixture doesn't have the same payoff. But, by this time, we will have become more seasoned test writers and have a better handle on what works and what doesn't when it comes to testing the system."}]},{"block_type":"element","block":"k6bfvbik","search_text":"All the work done up to this point will have sharpened our skill set and that, in and of itself, is a great payoff for investing in the test fixture.","text_count":149,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the work done up to this point will have sharpened our skill set and that, in and of itself, is a great payoff for investing in the test fixture."}]},{"block_type":"element","block":"k6bfvbil","search_text":"Is this just about setting up a database?","text_count":41,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Is this just about setting up a database?"}]},{"block_type":"element","block":"k6bfvbim","search_text":"This is not just about setting up a database. If our system interacts extensively with an LDAP server, we may need to code a fixture that cleans out the directory structure and loads it up with test data.","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is not just about setting up a database. If our system interacts extensively with an LDAP server, we may need to code a fixture that cleans out the directory structure and loads it up with test data."}]},{"block_type":"element","block":"k6bfvbin","search_text":"If the legacy system is flexible enough, we can put this whole test structure into a sub node in the hierarchy. But it's just as likely that it expects the data to exist at a certain location. In that situation, we may have to develop a script that spins up a separate, empty LDAP server, and then shuts it down after the test is complete.","text_count":339,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the legacy system is flexible enough, we can put this whole test structure into a sub node in the hierarchy. But it's just as likely that it expects the data to exist at a certain location. In that situation, we may have to develop a script that spins up a separate, empty LDAP server, and then shuts it down after the test is complete."}]},{"block_type":"element","block":"k6bfvbio","search_text":"Setting up and tearing down an LDAP server may not be the fastest, nor the most efficient test fixture. But if we invest time into building this fixture to empower ourselves to write automated tests, we will eventually be able to refactor the original system to decouple it from a live LDAP server. And this whole process will sharpen our skill set. That is why creating the original test fixture truly is an investment.","text_count":420,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Setting up and tearing down an LDAP server may not be the fastest, nor the most efficient test fixture. But if we invest time into building this fixture to empower ourselves to write automated tests, we will eventually be able to refactor the original system to decouple it from a live LDAP server. And this whole process will sharpen our skill set. That is why creating the original test fixture truly is an investment."}]},{"block_type":"element","block":"k6bfvbip","search_text":"If you aren't convinced about the value of testing, your team won't be either","text_count":77,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"If you aren't convinced about the value of testing, your team won't be either"}]},{"block_type":"element","block":"k6bfvbiq","search_text":"Test-bitten developers exhibit zeal; they are excited to run their test suite and see things complete with 100% success. This sort of emotion and pride tends to rub off on their fellow developers.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Test-bitten developers exhibit zeal; they are excited to run their test suite and see things"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"complete with 100% success. This sort of emotion and pride tends to rub off on their fellow developers."}]},{"block_type":"element","block":"k6bfvbir","search_text":"But the reverse is also true. If you aren't excited by all this and don't spread the word, none of your teammates will either. The idea of adding automated tests to your system will die a sad death.","text_count":198,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But the reverse is also true. If you aren't excited by all this and don't spread the word, none of your teammates will either. The idea of adding automated tests to your system will die a sad death."}]},{"block_type":"element","block":"k6bfvbis","search_text":"This isn't just confined to my own personal experience. At the 2010 DevLink conference, I attended an open-space discussion about testing, and saw this sort of reaction among a dozen other developers I don't work with ( pythontestingcookbook.posterous.com / greetings-programs ). The testers showed a certain type of excitement as they relayed their experiences with testing. The ones that were on the fence about embracing automated testing were listening with glee, drinking it in. Those not interested simply weren't there for the discussion.","text_count":545,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This isn't just confined to my own personal experience. At the 2010 DevLink conference,&nbsp;I attended an open-space discussion about testing, and saw this sort of reaction among a&nbsp;dozen other developers I don't work with ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pythontestingcookbook.posterous.com"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"greetings-programs"}]},{"block_type":"text","content":"). The testers showed a certain type of excitement as they relayed"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"their experiences with testing. The ones that were on the fence about embracing automated testing were listening with glee, drinking it in. Those not interested simply weren't there for the discussion."}]},{"block_type":"element","block":"k6bfvbit","search_text":"If you are reading this book (which of course you are), there is a fair chance you are the only person on your team seriously interested in automated testing. Your teammates may have heard of it, but aren't as bitten by the idea as you. To add it to your system will require a lot of investment by you, but don't confine yourself to just sharing the code; consider the following:","text_count":379,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are reading this book (which of course you are), there is a fair chance you are the only person on your team seriously interested in automated testing. Your teammates may have heard of it, but aren't as bitten by the idea as you. To add it to your system will require a lot of investment by you, but don't confine yourself to just sharing the code; consider the following:"}]},{"block_type":"element","block":"k6bfvbiu","search_text":"Demonstrate the excitement you feel as you make progress, and tackle thorny issues. Share your test results by posting them on your walls, where others can see them. Talk about your accomplishments while chatting with co-workers in the break room. ","text_count":248,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Demonstrate the excitement you feel as you make progress, and tackle thorny issues."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Share your test results by posting them on your walls, where others can see them."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Talk about your accomplishments while chatting with co-workers in the break room."}]}]},{"block_type":"element","block":"k6bfvbiv","search_text":"Testing isn't a cold, mechanical process; it's an exciting, fiery area of development. Test-bitten developers can't wait to share it with others. If you look for ways to spread the fire of automated testing, eventually others will warm up to it, and you will find yourself talking about new testing techniques with them.","text_count":320,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Testing isn't a cold, mechanical process; it's an exciting, fiery area of development. Test-bitten developers can't wait to share it with others. If you look for ways to spread the fire of automated testing, eventually others will warm up to it, and you will find yourself talking about new testing techniques with them."}]},{"block_type":"element","block":"k6bfvbiw","search_text":"Harvesting metrics","text_count":18,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Harvesting metrics"}]},{"block_type":"element","block":"k6bfvbix","search_text":"Start a spreadsheet that shows lines, code, a number of tests, the total test execution time, and the number of bugs, and track this with every release. The numbers will defend your investment.","text_count":193,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Start a spreadsheet that shows lines, code, a&nbsp;number of tests, the total test execution time, and the number of bugs, and track this with every release. The numbers will defend your investment."}]},{"block_type":"element","block":"k6bfvbiy","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbiz","search_text":"These high-level steps show how to capture metrics over time:","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These high-level steps show how to capture metrics over time:"}]},{"block_type":"element","block":"k6bfvbj0","search_text":"Create a spreadsheet to track the number of test cases, the time taken to run the test suite, the date of the test run, any bugs, and the average time per test. Check the spreadsheet into your code base as another controlled artifact. Add some graphs to show the curve of the test time versus the test quantity. Add a new row of data at least each time you do a release. If you can capture data more often, such as once a week or even once a day, that is better. ","text_count":463,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a spreadsheet to track the number of test cases, the time&nbsp;taken to run the test suite, the date of the test run, any bugs, and the average time per test."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the spreadsheet into your code base as another controlled artifact."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add some graphs to show the curve of the test time versus the test quantity."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a new row of data at least each time you do a release. If you can capture data more often, such as once a week or even once a day, that is better."}]}]},{"block_type":"element","block":"k6bfvbj1","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbj2","search_text":"As you write more tests, the test suite will take longer to run. But you will also find that the number of bugs tends to decrease. The more testing you do, and the more often you do it, the better your code will be. Capturing the metrics of your testing can act as hard evidence that the time spent writing and running tests is a well-placed investment.","text_count":353,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As you write more tests, the test suite will take longer to run. But you will also find that the number of bugs tends to decrease. The more testing you do, and the more often you do it, the better your code will be. Capturing the metrics of your testing can act as hard evidence that the time spent writing and running tests is a well-placed investment."}]},{"block_type":"element","block":"k6bfvbj3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbj4","search_text":"Why do I need this document? Don't I already know that testing works? Think of it as a backup for your assertion of quality. Months down the road, you may be challenged by management to speed things up. Maybe they need something faster, and they think you are simply spending too much time on this testing stuff .","text_count":313,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why do I need this document? Don't I already know that testing works? Think of it as a&nbsp;backup for your assertion of quality. Months down the road, you may be challenged by management to speed things up. Maybe they need something faster, and they think you are simply spending too much time on this"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testing stuff"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k6bfvbj5","search_text":"If you can pull out your spreadsheet and show how bugs decreased with testing effort, they will have little to argue with. But if you don't have this, and simply argue that testing makes things better , you may lose the argument.","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you can pull out your spreadsheet and show how bugs decreased with testing effort, they will have little to argue with. But if you don't have this, and simply argue that"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"testing makes things better"}]},{"block_type":"text","content":", you may lose the argument."}]},{"block_type":"element","block":"k6bfvbj6","search_text":"Metrics aren't just for defending yourself to management","text_count":56,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Metrics aren't just for defending yourself to management"}]},{"block_type":"element","block":"k6bfvbj7","search_text":"I personally enjoyed seeing the tests grow and the bugs decline. It was a personal way to track myself and keep a handle on how much progress was made. And, to be honest, my last manager gave me full support for automated testing. He had his own metrics of success, so I never had to pull out mine.","text_count":298,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I personally enjoyed seeing the tests grow and the bugs decline. It was a personal way to&nbsp;track myself and keep a handle on how much progress was made. And, to be honest, my last manager gave me full support for automated testing. He had his own metrics of success, so I never had to pull out mine."}]},{"block_type":"element","block":"k6bfvbj8","search_text":"Capturing a bug in an automated test","text_count":36,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Capturing a bug in an automated test"}]},{"block_type":"element","block":"k6bfvbj9","search_text":"Before you fix that one-line bug you spotted, write an automated test instead, and make sure it's repeatable. This helps to build up insulation from our system, regressing back into failures we fixed in the past.","text_count":212,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Before you fix that one-line bug you spotted, write an automated test instead, and make sure it's repeatable. This helps to build up insulation from our system, regressing back into failures we fixed in the past."}]},{"block_type":"element","block":"k6bfvbja","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbjb","search_text":"These high-level steps capture the workflow of capturing bugs in automated tests before we fix them:","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These high-level steps capture the workflow of capturing bugs in automated tests before"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"we fix them:"}]},{"block_type":"element","block":"k6bfvbjc","search_text":"When a new bug is discovered, write a test case that recreates it. It doesn't matter if the test case is long-running, complex, or integrates with lots of components. The critical thing is to reproduce the bug. Add the bug to your suite of tests. Fix the bug. Verify that the test suite passes before checking your changes. ","text_count":324,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When a new bug is discovered, write a test case that recreates it. It doesn't matter if the test case is long-running, complex, or integrates with lots of components. The&nbsp;critical thing is to reproduce the bug."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the bug to your suite of tests."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Fix the bug."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Verify that the test suite passes before checking your changes."}]}]},{"block_type":"element","block":"k6bfvbjd","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbje","search_text":"The simplest way to introduce automated testing to an application that never had it before is to test one bug at a time. This method ensures that newly discovered bugs won't sneak back into the system later on.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The simplest way to introduce automated testing to an application that never had it before is to test one bug at a time. This method ensures that newly discovered bugs won't sneak back into the system later on."}]},{"block_type":"element","block":"k6bfvbjf","search_text":"The tests may have a loose-knit feel instead of a comprehensive one, but that doesn't matter. What does matter is that, over time, you will slowly develop a solid safety net of test cases that verify that the system performs as expected.","text_count":237,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The tests may have a loose-knit feel instead of a comprehensive one, but that doesn't matter. What does matter is that, over time, you will slowly develop a solid safety net of test cases that verify that the system performs as expected."}]},{"block_type":"element","block":"k6bfvbjg","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbjh","search_text":"I didn't say this would be easy. Writing an automated test for software that wasn't built with testability in mind is hard work. As mentioned in the recipe Something is better than nothing , the first test case is probably the hardest. But, over time, as you develop more tests, you will gain the confidence to go back and refactor things. You will definitely feel empowered by knowing that you can't break things without realizing.","text_count":432,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I didn't say this would be easy. Writing an automated test for software that wasn't built with testability in mind is hard work. As mentioned in the recipe"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Something is better than nothing"}]},{"block_type":"text","content":", the first test case is probably the hardest. But, over time, as you develop more tests, you will gain the confidence to go back and refactor things. You will definitely feel empowered by knowing that you can't break things without realizing."}]},{"block_type":"element","block":"k6bfvbji","search_text":"When the time comes to add a completely new module, you will be ready for it","text_count":76,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"When the time comes to add a completely new module, you will&nbsp;be ready for it"}]},{"block_type":"element","block":"k6bfvbjj","search_text":"This approach of capturing a bug with a test case is useful, but slow. But that's OK, because slowly adding testing will give you time to grow your testing skills at a comfortable pace.","text_count":185,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This approach of capturing a bug with a test case is useful, but slow. But that's OK, because slowly adding testing will give you time to grow your testing skills at a comfortable pace."}]},{"block_type":"element","block":"k6bfvbjk","search_text":"Where does this pay off? Well, eventually, you will need to add a new module to your system. Doesn't this always happen? By that time, your investment in testing and test fixtures should already be paying dividends in the improvement of the quality of existing code, but you will also have a head start on testing the new module. Consider the following:","text_count":353,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Where does this pay off? Well, eventually, you will need to add a new module to your&nbsp;system. Doesn't this always happen? By that time, your investment in testing and test fixtures should already be paying dividends in the improvement of the quality of existing code, but you will also have a head start on testing the new module. Consider the following:"}]},{"block_type":"element","block":"k6bfvbjl","search_text":"You will not just know, but really understand , the meaning of test-oriented code. You will be able to write both the code and its tests at the same time in a very effective way. The new module will have a head start of higher quality and will not require as much effort to catch up as the legacy parts of your system did. ","text_count":323,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You will not just know, but"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"really understand"}]},{"block_type":"text","content":", the meaning of"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"test-oriented code."}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You will be able to write both the code and its tests at the same time in a very effective way."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The new module will have a head start of higher quality and will not require as much effort to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"catch up"}]},{"block_type":"text","content":"as the legacy parts of your system did."}]}]},{"block_type":"element","block":"k6bfvbjm","search_text":"Don't give into the temptation to skip testing","text_count":46,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Don't give into the temptation to skip testing"}]},{"block_type":"element","block":"k6bfvbjn","search_text":"As I stated earlier, the first test case will be very hard to write. And the next few after that won't be much easier. This makes it very tempting to throw up your hands and skip automated testing. But, if you stick with it and write something that works, you can continue building on that successful bit of effort.","text_count":315,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As I stated earlier, the first test case will be very hard to write. And the next few after that&nbsp;won't be much easier. This makes it very tempting to throw up your hands and skip automated testing. But, if you stick with it and write something that works, you can continue building on that successful bit of effort."}]},{"block_type":"element","block":"k6bfvbjo","search_text":"This may sound like a cliché, but if you stick with it for about a month, you will start to see some results from your work. This is also a great time to start harvesting metrics . Capturing your progress and being able to reflect on it can provide positive encouragement.","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This may sound like a clich&eacute;, but if you stick with it for about a month, you will start to see some results from your work. This is also a great time to start"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"harvesting metrics"}]},{"block_type":"text","content":". Capturing your progress and being able to reflect on it can provide positive encouragement."}]},{"block_type":"element","block":"k6bfvbjp","search_text":"Separating algorithms from concurrency","text_count":38,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Separating algorithms from concurrency"}]},{"block_type":"element","block":"k6bfvbjq","search_text":"Concurrency is very hard to test, but most algorithms are not when decoupled.","text_count":77,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Concurrency is very hard to test, but most algorithms are not when decoupled."}]},{"block_type":"element","block":"k6bfvbjr","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbjs","search_text":"Herb Sutter wrote an article in 2005 entitled The Free Lunch Is Over , where he pointed out how microprocessors are approaching a physical limitation in serial processing, which will be forcing developers to turn towards concurrent solutions ( http://www.gotw.ca/publications/concurrency-ddj.htm ).","text_count":298,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Herb Sutter wrote an article in 2005 entitled"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"The Free Lunch Is Over"}]},{"block_type":"text","content":", where he pointed out how microprocessors are approaching a physical limitation in serial processing, which will be forcing&nbsp;developers to turn towards concurrent solutions ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.gotw.ca/publications/concurrency-ddj.htm"},"children":[{"block_type":"text","content":"http://www.gotw.ca/publications/concurrency-ddj.htm"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k6bfvbjt","search_text":"Newer processors come with multiple cores. To build scalable applications, we can no longer just wait for a faster chip. Instead, we must use alternate, concurrent techniques. This issue is being played out in a whole host of languages. Erlang was one of the first languages on the scene that allowed a telecommunications system to be built with nine 9's of availability, which means about one second of downtime every 30 years.","text_count":428,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Newer processors come with multiple cores. To build scalable applications, we can no longer just wait for a faster chip. Instead, we must use alternate, concurrent techniques. This issue is being played out in a whole host of languages. Erlang was one of the first languages on the&nbsp;scene that allowed a telecommunications system to be built with nine 9's of availability, which&nbsp;means about one second of downtime every 30 years."}]},{"block_type":"element","block":"k6bfvbju","search_text":"One of its key features is the use of immutable data sent between actors. This provides nice isolation and allows multiple units to run across the CPU cores. Python has libraries that provide a similar style of decoupled, asynchronous message passing. The two most common ones are Twisted and Kamaelia.","text_count":302,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One of its key features is the use of immutable data sent between actors. This provides nice isolation and allows multiple units to run across the CPU cores. Python has libraries that&nbsp;provide a similar style of decoupled, asynchronous message passing. The two most common&nbsp;ones are Twisted and Kamaelia."}]},{"block_type":"element","block":"k6bfvbjv","search_text":"But, before you dive into using either of these frameworks, there is something important to keep in mind: it's very hard to test concurrency while also testing algorithms. To use these libraries, you will register code that issues messages and also registers handlers to process messages.","text_count":288,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But, before you dive into using either of these frameworks, there is something important to&nbsp;keep in mind: it's very hard to test concurrency while also testing algorithms. To use these&nbsp;libraries, you will register code that issues messages and also registers handlers to process&nbsp;messages."}]},{"block_type":"element","block":"k6bfvbjw","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbjx","search_text":"It's important to decouple the algorithms from the machinery of whatever concurrency library you pick. This will make it much easier to test the algorithms, but it doesn't mean that you shouldn't conduct load tests or try to overload your system with live data playback scenarios.","text_count":280,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's important to decouple the algorithms from the machinery of whatever concurrency&nbsp;library you pick. This will make it much easier to test the algorithms, but it doesn't mean that you&nbsp;shouldn't conduct load tests or try to overload your system with live data playback scenarios."}]},{"block_type":"element","block":"k6bfvbjy","search_text":"What it does mean is that starting with large volume test scenarios is the wrong priority. Your system needs to correctly handle one event in an automated test case before it can handle a thousand events.","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What it does mean is that starting with large volume test scenarios is the wrong priority. Your&nbsp;system needs to correctly handle one event in an automated test case before it can handle&nbsp;a thousand events."}]},{"block_type":"element","block":"k6bfvbjz","search_text":"Research test options provided by your concurrency frameworks","text_count":61,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Research test options provided by your concurrency frameworks"}]},{"block_type":"element","block":"k6bfvbk0","search_text":"A good concurrency library should provide sound testing options. Seek them out and try to use them to their fullest. But don't forget to verify that your custom algorithms work in simple, serial fashion as well. Testing both sides will give you great confidence that the system is performing as expected under light and heavy loads.","text_count":332,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A good concurrency library should provide sound testing options. Seek them out and try to use&nbsp;them to their fullest. But don't forget to verify that your custom algorithms work in simple,&nbsp;serial fashion as well. Testing both sides will give you great confidence that the system is&nbsp;performing as expected under light and heavy loads."}]},{"block_type":"element","block":"k6bfvbk1","search_text":"Pause to refactor when a test suite takes too long to run","text_count":57,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Pause to refactor when a test suite takes too long to run"}]},{"block_type":"element","block":"k6bfvbk2","search_text":"As you start to build a test suite, you may notice the runtime getting quite long. If it's so long that you aren't willing to run it at least once a day, you need to stop coding and focus on speeding up the tests, whether it involves the tests themselves or the code being tested.","text_count":280,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As you start to build a test suite, you may notice the runtime getting quite long. If it's so long that you aren't willing to run it at least once a day, you need to stop coding and focus on&nbsp;speeding up the tests, whether it involves the tests themselves or the code being tested."}]},{"block_type":"element","block":"k6bfvbk3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbk4","search_text":"This assumes you have started to build a test suite using some of the following practices:","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This assumes you have started to build a test suite using some of the following practices:"}]},{"block_type":"element","block":"k6bfvbk5","search_text":"Something is better than nothing Be willing to invest in test fixtures Capturing a bug in an automated test ","text_count":108,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Something is better than nothing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Be willing to invest in test fixtures"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Capturing a bug in an automated test"}]}]},{"block_type":"element","block":"k6bfvbk6","search_text":"These are slow-starting steps to start adding tests to a system that was originally built without any automated testing. One of the trade-offs to get moving on automated testing involves writing relatively expensive tests. For instance, if one of your key algorithms is not adequately decoupled from the database, you will be forced to write a test case that involves setting up some tables, processing the input data, and then making queries against the state of the database afterward.","text_count":487,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These are slow-starting steps to start adding tests to a system that was originally built without&nbsp;any automated testing. One of the trade-offs to get moving on automated testing involves&nbsp;writing relatively expensive tests. For instance, if one of your key algorithms is not adequately&nbsp;decoupled from the database, you will be forced to write a test case that involves setting up&nbsp;some tables, processing the input data, and then making queries against the state of the&nbsp;database afterward."}]},{"block_type":"element","block":"k6bfvbk7","search_text":"As you write more tests, the time to run the test suite will certainly grow. At some point, you will feel less inclined to spend the time waiting for your test suite to run. Since a test suite is only good when used, you must pause development and pursue refactoring either the code or the test cases themselves to speed things up.","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As you write more tests, the time to run the test suite will certainly grow. At some point, you will feel less inclined to spend the time waiting for your test suite to run. Since a test suite is only&nbsp;good when used, you must pause development and pursue refactoring either the code or the&nbsp;test cases themselves to speed things up."}]},{"block_type":"element","block":"k6bfvbk8","search_text":"Here is a problem I ran into: my test suite initially took about 15 minutes to run. It eventually grew to take one-and-a-half hours to run all the tests. I reached a point where I would only run it once a day, and even skipped some days. One day, I tried to do a massive code edit. When most of the test cases failed, I realized that I had not run the test suite often enough to detect which step broke things. I was forced to throw away all the code edits and start over. Before proceeding further, I spent a few days refactoring the code as well as the tests, bringing the run time of the test suite back down to a tolerable 30 minutes.","text_count":638,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Here is a problem I ran into: my test suite initially took about 15 minutes to run. It eventually&nbsp;grew to take one-and-a-half hours to run all the tests. I reached a point where I would only run&nbsp;it once a day, and even skipped some days. One day, I tried to do a massive code edit. When&nbsp;most of the test cases failed, I realized that I had not run the test suite often enough to detect&nbsp;which step broke things. I was forced to throw away all the code edits and start over. Before&nbsp;proceeding further, I spent a few days refactoring the code as well as the tests, bringing the&nbsp;run time of the test suite back down to a tolerable 30 minutes."}]},{"block_type":"element","block":"k6bfvbk9","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbka","search_text":"That is the key measurement: when you feel hesitant to run the test suite more than once a day , this may be a sign that things need to be cleaned up. Test suites are meant to be run multiple times a day.","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That is the key measurement: when you feel hesitant to run the test suite more than"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"once&nbsp;"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a day"}]},{"block_type":"text","content":", this may be a sign that things need to be cleaned up. Test suites are meant to be run&nbsp;multiple times a day."}]},{"block_type":"element","block":"k6bfvbkb","search_text":"This is because we have competing interests: writing code and running tests . It's important to recognize these things:","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is because we have competing interests:"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"writing code"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"running tests"}]},{"block_type":"text","content":". It's important to recognize these things:"}]},{"block_type":"element","block":"k6bfvbkc","search_text":"To run tests, we must suspend our coding efforts To write more code, we must suspend testing efforts ","text_count":101,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To run tests, we must suspend our coding efforts"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To write more code, we must suspend testing efforts"}]}]},{"block_type":"element","block":"k6bfvbkd","search_text":"When testing takes a big chunk of our daily schedule, we must start choosing which is more important. We tend to migrate toward writing more code, and this is probably the key reason people abandon automated testing and consider it unsuitable for their situation.","text_count":263,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When testing takes a big chunk of our daily schedule, we must start choosing which is more important. We tend to migrate toward writing more code, and this is probably the key reason people abandon automated testing and consider it unsuitable for their situation."}]},{"block_type":"element","block":"k6bfvbke","search_text":"It's tough, but if we can resist taking the easy way out, and instead do some refactoring of either the code or our tests, we will be encouraged to run the tests more often.","text_count":173,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's tough, but if we can resist taking the easy way out, and instead do some refactoring of&nbsp;either the code or our tests, we will be encouraged to run the tests more often."}]},{"block_type":"element","block":"k6bfvbkf","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbkg","search_text":"It's less science and more voodoo when it comes to what to refactor. It's important to seek out opportunities that give us a good yield. It's important to understand that this can be either our test code, our production code, or a combination of both that needs to be refactored. Consider the following points:","text_count":310,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's less science and more voodoo when it comes to what to refactor. It's important to seek out opportunities that give us a good yield. It's important to understand that this can be either&nbsp;our test code, our production code, or a combination of both that needs to be refactored. Consider the following points:"}]},{"block_type":"element","block":"k6bfvbkh","search_text":"Performance analysis can show us where the hotspots are. Refactoring or rewriting these chunks can improve tests. Tight coupling often forces us to put in more parts of the system than we want, such as database usage. If we can look for ways to decouple the code from the database and replace it with mocks or stubs, that sets us up to update the relevant tests to come up with a faster running test suite. ","text_count":407,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Performance analysis can show us where the hotspots are. Refactoring or rewriting these chunks can improve tests."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Tight coupling often forces us to put&nbsp;in more parts of the system than we want, such&nbsp;as database usage. If we can look for ways to decouple the code from the database and replace it with mocks or stubs, that sets us up to update the relevant tests to come up with a faster running test suite."}]}]},{"block_type":"element","block":"k6bfvbki","search_text":"Coverage obtained from tests can help. All of these approaches have positive consequences for our code's quality. More efficient algorithms lead to better performance, and looser coupling helps to keep our long-term maintenance costs down.","text_count":239,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Coverage obtained from tests can help. All of these approaches have positive consequences&nbsp;for our code's quality. More efficient algorithms lead to better performance, and looser&nbsp;coupling helps to keep our long-term maintenance costs down."}]},{"block_type":"element","block":"k6bfvbkj","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvbkk","search_text":"Be willing to throw away an entire day's changes ","text_count":49,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Be willing to throw away an entire day's changes"}]}]}]},{"block_type":"element","block":"k6bfvbkl","search_text":"Cash in on your confidence","text_count":26,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Cash in on your confidence"}]},{"block_type":"element","block":"k6bfvbkm","search_text":"After building up enough tests, you will feel confident enough to rewrite a big chunk of code or conduct shotgun surgery that touches almost every file. Go for it!","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After building up enough tests, you will feel confident enough to rewrite a big chunk of code or conduct shotgun surgery that touches almost every file. Go for it!"}]},{"block_type":"element","block":"k6bfvbkn","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbko","search_text":"As you build more tests and run them several times a day, you will start to get a feel for what you know and don't know about the system. Even more so, when you've written enough expensive, long-running tests about a particular part of the system, you will feel a strong desire to rewrite that module.","text_count":301,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As you build more tests and run them several times a day, you will start to get a feel for what you know and don't know about the system. Even more so, when you've written enough expensive, long-running tests about a particular part of the system, you will feel a strong&nbsp;desire to rewrite that module."}]},{"block_type":"element","block":"k6bfvbkp","search_text":"What are you waiting for? This is the point of building a runnable safety net of tests. Understanding the ins and outs of a module gives you the knowledge to attack it. You may rewrite it, be able to better decouple its parts, or whatever else is needed to make it work better, as well as being able to better support tests.","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"What are you waiting for? This is the point of building a runnable safety net of tests.&nbsp;Understanding the ins and outs of a module gives you the knowledge to attack it. You may rewrite it, be able to better decouple its parts, or whatever else is needed to make it work better, as well as being able to better support tests."}]},{"block_type":"element","block":"k6bfvbkq","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbkr","search_text":"While you may feel a strong desire to attack the code, there may be an equal and opposing feeling to resist making such changes. This is risk aversion, and we all have to deal with it. We want to avoid diving in head first to a situation that could have drastic consequences.","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While you may feel a strong desire to attack the code, there may be an equal and opposing&nbsp;feeling to resist making such changes. This is risk aversion, and we all have to deal with it. We want to avoid diving in head first to a situation that could have drastic consequences."}]},{"block_type":"element","block":"k6bfvbks","search_text":"Assuming we have built an adequate safety net, it's time to engage the code and start cleaning it up. If we run the test suite frequently while making these changes, we can safely move through the changes we need to make. This will improve the quality of the code and will possibly speed up the runtime of the test suite.","text_count":321,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Assuming we have built an adequate safety net, it's time to engage the code and start&nbsp;cleaning it up. If we run the test suite frequently while making these changes, we can safely move through the changes we need to make. This will improve the quality of the code and will possibly speed up the runtime of the test suite."}]},{"block_type":"element","block":"k6bfvbkt","search_text":"Tip While making changes, we don't have to go all in Cashing in on our confidence means we move in and make changes to the code base, but it doesn't mean we go into areas of code where the tests are shallow and inadequate. There may be several areas we want to clean up, but we should only go after the parts we are most confident about. There will be future opportunities to get the other parts as we add more tests in the future. ","text_count":432,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"While making changes, we don't have to go all in"}]},{"block_type":"text","content":"Cashing in on our confidence means we move in and make changes&nbsp;to the code base, but it doesn't mean we go into areas of code where&nbsp;the tests are shallow and inadequate. There may be several areas we&nbsp;want to clean up, but we should only go after the parts we are most&nbsp;confident about. There will be future opportunities to get the other&nbsp;parts as we add more tests in the future."}]}]},{"block_type":"element","block":"k6bfvbku","search_text":"Be willing to throw away an entire day's changes","text_count":48,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Be willing to throw away an entire day's&nbsp;changes"}]},{"block_type":"element","block":"k6bfvbkv","search_text":"Have you ever worked for a whole day making changes, only to discover that half the tests failed because you forgot to run the test suite more often? Be ready to throw away the changes. This is what automated testing lets us do… back up to when everything ran perfectly. It will hurt, but next time you will remember to run the test suite more often.","text_count":350,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Have you ever worked for a whole day making changes, only to discover that half the tests failed because you forgot to run the test suite more often? Be ready to throw away the changes. This is what automated testing lets us do&hellip; back up to when everything ran perfectly. It will hurt, but next time you will remember to run the test suite more often."}]},{"block_type":"element","block":"k6bfvbkw","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvbkx","search_text":"This recipe assumes you are using version control and are making regular commits. This idea is no good if you haven't made a commit for two weeks.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe assumes you are using version control and are making regular commits. This idea&nbsp;is no good if you haven't made a commit for two weeks."}]},{"block_type":"element","block":"k6bfvbky","search_text":"If you run your test suite at least once a day, and when it passes, you commit the changes you have made, then it becomes easy to back up to some previous point, such as the beginning of the day.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you run your test suite at least once a day, and when it passes, you commit the changes you have made, then it becomes easy to back up to some previous point, such as the beginning of the day."}]},{"block_type":"element","block":"k6bfvbkz","search_text":"I have done this many times. The first time was the hardest. It was a new idea to me, but I realized the real value of software was now resting on my automated test suite. In the middle of the afternoon, I ran the test suite for the first time that day after having edited half the system. Over half of the tests failed.","text_count":320,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I have done this many times. The first time was the hardest. It was a new idea to me, but I&nbsp;realized the real value of software was now resting on my automated test suite. In the middle of the afternoon, I ran the test suite for the first time that day after having edited half the system. Over half of the tests failed."}]},{"block_type":"element","block":"k6bfvbl0","search_text":"I tried to dig in and fix the issue. The trouble was, I couldn't figure out where the issue stemmed from. I spent a couple of hours trying to track it down. It began to dawn on me that I wasn't going to figure it out without wasting loads of time.","text_count":247,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"I tried to dig in and fix the issue. The trouble was, I couldn't figure out where the issue&nbsp;stemmed from. I spent a couple of hours trying to track it down. It began to dawn on me&nbsp;that I wasn't going to figure it out without wasting loads of time."}]},{"block_type":"element","block":"k6bfvbl1","search_text":"But I remembered that everything had passed with flying colors the previous day. I finally decided to throw away my changes, run the test suite, verifying everything passed, and then grudgingly go home for the day.","text_count":214,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But I remembered that everything had passed with flying colors the previous day. I finally&nbsp;decided to throw away my changes, run the test suite, verifying everything passed, and then grudgingly go home for the day."}]},{"block_type":"element","block":"k6bfvbl2","search_text":"The next day, I attacked the problem again. Only, this time, I ran the tests more often. I was able to get it coded successfully. Looking back at the situation, I realize that this issue only cost me one lost day. If I had tried to ride it out, I could have spent a week and still probably ended up throwing things away.","text_count":320,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The next day, I attacked the problem again. Only, this time, I ran the tests more often. I was able to get it coded successfully. Looking back at the situation, I realize that this issue only cost me one lost day. If I had tried to ride it out, I could have spent a week and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"still"}]},{"block_type":"text","content":"probably ended up throwing things away."}]},{"block_type":"element","block":"k6bfvbl3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvbl4","search_text":"Depending on how your organization manages source control, you may have to do the following things:","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Depending on how your organization manages source control, you may have to do the following things:"}]},{"block_type":"element","block":"k6bfvbl5","search_text":"Simply do it yourself by deleting a branch or canceling your checkouts Contact your CM team to delete the branch or the commits you made for the day ","text_count":149,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Simply do it yourself by deleting a branch or canceling your checkouts"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Contact your CM team to delete the branch or the commits you made for the day"}]}]},{"block_type":"element","block":"k6bfvbl6","search_text":"This isn't really a technical issue. The source control system makes it easy to do this regardless of who is in charge of branch management. The hard part is making the decision to throw away the changes. We often feel the desire to fix what is broken. The more our efforts cause it to break further, the more we want to fix it. At some point, we must realize that it is more costly to move forward rather than to back up and start again.","text_count":438,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This isn't really a technical issue. The source control system makes it easy to do this&nbsp;regardless of who is in charge of branch management. The hard part is making the decision to throw away the changes. We often feel the desire to fix what is broken. The more our efforts cause it to break further, the more we want to fix it. At some point, we must realize that it is more costly to move forward rather than to back up and start again."}]},{"block_type":"element","block":"k6bfvbl7","search_text":"There is an axis of agility that stretches from classic waterfall software production to heavily agile processes. Agile teams tend to work in smaller sprints and commit in smaller chunks. This makes it more palatable to throw away a day of work. The bigger the task and the longer the release cycle, the greater the odds are that your changes haven't been checked since you started a task two weeks ago.","text_count":403,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is an axis of agility that stretches from classic waterfall software production to heavily agile processes. Agile teams tend to work in smaller sprints and commit in smaller chunks. This makes it more palatable to throw away a day of work. The bigger the task and the longer the release cycle, the greater the odds are that your changes haven't been checked since you started a task two weeks ago."}]},{"block_type":"element","block":"k6bfvbl8","search_text":"Believe me, throwing away two weeks' work is totally different than throwing away one day's worth. I would never advocate throwing out two weeks' work.","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Believe me, throwing away two weeks' work is totally different than throwing away one day's worth. I would never advocate throwing out two weeks' work."}]},{"block_type":"element","block":"k6bfvbl9","search_text":"The core idea is to not go home without your test suite passing. If that means you have to throw things away to make it happen, then that is what you must do. It really drives the point home of code a little/test a little until a new feature is ready for release.","text_count":263,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The core idea is to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"not"}]},{"block_type":"text","content":"go home without your test suite passing. If that means you have to throw things away to make it happen, then that is what you must do. It really drives the point home of"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"code a little/test a little"}]},{"block_type":"text","content":"until a new feature is ready for release."}]},{"block_type":"element","block":"k6bfvbla","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvblb","search_text":"We also need to reflect on why didn't we run the test suite often enough. It may be because the test suite is taking too long to run, and you are hesitating to use up that time. It may be time to pause to refactor when the test suite takes too long to run . The time I really learned this lesson was when my test suite took one-and-a-half hours to run. After I got through this whole issue, I realized that I needed to speed things up and spent probably a week or two cutting it down to a tolerable 30 minutes.","text_count":510,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also need to reflect on why didn't we run the test suite often enough. It may be because the test suite is taking too long to run, and you are hesitating to use up that time. It may be time to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"pause to refactor when the test suite takes too long to run"}]},{"block_type":"text","content":". The time I really learned this lesson was when my test suite took one-and-a-half hours to run. After I got through this whole issue, I realized that I needed to speed things up and spent probably a week or two cutting it down to a tolerable 30 minutes."}]},{"block_type":"element","block":"k6bfvblc","search_text":"How does this mesh with \"Something is better than nothing\"","text_count":58,"tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"How does this mesh with \"Something is better than nothing\""}]},{"block_type":"element","block":"k6bfvbld","search_text":"Earlier in this chapter, we talked about writing a test case that may be quite expensive to run to get automated testing in action. What if our testing becomes so expensive that it is time prohibitive? After all, couldn't what we just said lead to the situation we are dealing with?","text_count":282,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Earlier in this chapter, we talked about writing a test case that may be quite expensive to run to get automated testing in action. What if our testing becomes so expensive that it is time prohibitive? After all, couldn't what we just said lead to the situation we are dealing with?"}]},{"block_type":"element","block":"k6bfvble","search_text":"Code a little/test a little may seem to be a very slow way to proceed. This is probably the reason many legacy systems never embrace automated testing. The hill we must climb is steep. But if we can hang in there, start building the tests, make sure they run at the end of the day, and then eventually pause to refactor our code and tests, we can eventually reach a happy balance of better code quality and system confidence.","text_count":425,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Code a little/test a little"}]},{"block_type":"text","content":"may seem to be a very slow way to proceed. This is probably the reason many legacy systems never embrace automated testing. The hill we must climb is steep. But if we can hang in there, start building the tests, make sure they run at the end of the day, and then eventually pause to refactor our code and tests, we can eventually reach a happy balance of better code quality and system confidence."}]},{"block_type":"element","block":"k6bfvblf","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k6bfvblg","search_text":"Something is better than nothing Pause to refactor when a test suite takes too long ","text_count":84,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Something is better than nothing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Pause to refactor when a test suite takes too long"}]}]},{"block_type":"element","block":"k6bfvblh","search_text":"Instead of shooting for 100 percent coverage, try to have a steady growth","text_count":73,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Instead of shooting for 100 percent&nbsp;coverage, try to have a steady growth"}]},{"block_type":"element","block":"k6bfvbli","search_text":"You won't know how you're doing without coverage analysis. However, don't aim too high. Instead, focus on a gradual increase. You will find that your code gets better over time—maybe even drops in volume—while the quality and coverage steadily improve.","text_count":252,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You won't know how you're doing without coverage analysis. However, don't aim too high. Instead, focus on a gradual increase. You will find that your code gets better over time&mdash;maybe even drops in volume&mdash;while the quality and coverage steadily improve."}]},{"block_type":"element","block":"k6bfvblj","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvblk","search_text":"If you start with a system that has no tests, don't get focused on a ridiculously high number. I worked on a system that had 16% coverage when I picked it up. A year later, I had worked it up to 65%. This was nowhere near 100%, but the quality of the system had grown in leaps and bounds due to capturing a bug in an automated test and harvesting metrics.","text_count":355,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you start with a system that has no tests, don't get focused on a ridiculously high number. I worked on a system that had 16% coverage when I picked it up. A year later, I had worked it up to 65%. This was nowhere near 100%, but the quality of the system had grown in leaps and bounds due to capturing a bug in an automated test and harvesting metrics."}]},{"block_type":"element","block":"k6bfvbll","search_text":"At one time, I was discussing the quality of my code with my manager, and he showed me a report he had developed. He had run a code-counting tool on every release of every application he was overseeing. He said my code counts had a unique shape. All the other tools had a constant increase in lines of code. Mine had grown, peaked, and then started to decrease and were still on the decline.","text_count":391,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At one time, I was discussing the quality of my code with my manager, and he showed me a report he had developed. He had run a code-counting tool on every release of&nbsp;every application he was overseeing. He said my code counts had a unique shape. All the"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"other tools had a constant increase in lines of code. Mine had grown, peaked, and then&nbsp;started to decrease and were still on the decline."}]},{"block_type":"element","block":"k6bfvblm","search_text":"This happened despite the fact that my software did more than ever. It's because I started throwing away unused features, bad code, and clearing out cruft during refactorings.","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This happened despite the fact that my software did more than ever. It's because I started&nbsp;throwing away unused features, bad code, and clearing out cruft during refactorings."}]},{"block_type":"element","block":"k6bfvbln","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvblo","search_text":"By slowly building an automated test suite, you will gradually cover more of your code. By keeping a focus on building quality code with corresponding tests, the coverage will grow naturally. When we shift to focusing on coverage reports, the numbers may grow more quickly, but it will tend to be more artificial.","text_count":313,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By slowly building an automated test suite, you will gradually cover more of your code. By&nbsp;keeping a focus on building quality code with corresponding tests, the coverage will grow&nbsp;naturally. When we shift to focusing on coverage reports, the numbers&nbsp;may grow more quickly, but it will tend to be more artificial."}]},{"block_type":"element","block":"k6bfvblp","search_text":"From time to time, as you cash in on your confidence and rewrite chunks, you should feel empowered to throw away old junk. This will also grow your coverage metrics in a healthy way.","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"From time to time, as you cash in on your confidence and rewrite chunks, you should feel&nbsp;empowered to throw away old junk. This will also grow your coverage metrics in a healthy way."}]},{"block_type":"element","block":"k6bfvblq","search_text":"All of these factors will lead to increased quality and efficiency. While your code may eventually peak and then decrease, it isn't unrealistic for it to eventually grow again due to new features.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All of these factors will lead to increased quality and efficiency. While your code may eventually peak and then decrease, it isn't unrealistic for it to eventually grow again due to new features."}]},{"block_type":"element","block":"k6bfvblr","search_text":"By that time, the coverage will probably be much higher, because you will be building completely new features, hand in hand with tests, instead of just maintaining legacy parts.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By that time, the coverage will probably be much higher, because you will be building&nbsp;completely new features, hand in hand with tests, instead of just maintaining legacy parts."}]},{"block_type":"element","block":"k6bfvbls","search_text":"Randomly breaking up your app can lead to better code","text_count":53,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Randomly breaking&nbsp;up your app can lead to&nbsp;better code"}]},{"block_type":"element","block":"k6bfvblt","search_text":"\" The best way to avoid failure is to fail constantly. \" – Netflix ","text_count":67,"tag_name":"blockquote","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"\""},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"The best way to avoid failure is to fail constantly."}]},{"block_type":"text","content":"\""}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"&ndash; Netflix"}]}]},{"block_type":"element","block":"k6bfvblu","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k6bfvblv","search_text":"Netflix has built a tool they call Chaos Monkey . Its job is to randomly kill instances and services. This forces developers to make sure their system can fail smoothly and safely. To build our own version of this, some of the things we would need it to do are the following:","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Netflix has built a tool they call&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Chaos Monkey"}]},{"block_type":"text","content":". Its job is to randomly kill instances and&nbsp;services. This forces developers to make sure their system can fail smoothly and safely. To build our own version of this, some of the things we would need it to do are the following:"}]},{"block_type":"element","block":"k6bfvblw","search_text":"Randomly kill processes Inject faulty data at interface points Shut down network interfaces between distributed systems Issue shutdown commands to subsystems Create denial-of-service attacks by overloading interface points with too much data ","text_count":242,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Randomly kill processes"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Inject faulty data at interface points"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Shut down network interfaces between distributed systems"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Issue shutdown commands to subsystems"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create denial-of-service attacks by overloading interface points with too much data"}]}]},{"block_type":"element","block":"k6bfvblx","search_text":"This is a starting point. The idea is to inject errors wherever you can imagine them happening. This may require writing scripts, Cron jobs, or any means necessary to cause these errors to happen.","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is a starting point. The idea is to inject errors wherever you can imagine them happening. This may require writing scripts, Cron jobs, or any means necessary to cause these errors to happen."}]},{"block_type":"element","block":"k6bfvbly","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k6bfvblz","search_text":"Given that there is a chance of a remote system being unavailable in production, we should introduce ways for this to happen in our development environment. This will encourage us to code higher fault tolerance into our system.","text_count":227,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Given that there is a chance of a remote system being unavailable in production, we should&nbsp;introduce ways for this to happen in our development environment. This will encourage&nbsp;us to code higher fault tolerance into our system."}]},{"block_type":"element","block":"k6bfvbm0","search_text":"Before we introduce a random-running Chaos Monkey such as Netflix has, we need to ensure that our system can handle these situations manually. For example, if our system includes communication between two servers, a fair test is unplugging the network cable to one box, simulating network failure. When we verify that our system can continue working with acceptable means, then we can add scripts to do this automatically and, eventually, randomly.","text_count":448,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Before we introduce a random-running Chaos Monkey such as Netflix has, we need to ensure that our system can handle these situations manually. For example, if our system includes&nbsp;communication between two servers, a fair test is unplugging the network cable to one box, simulating network failure. When we verify that our system can continue working with acceptable means, then we can add scripts to do this automatically and, eventually, randomly."}]},{"block_type":"element","block":"k6bfvbm1","search_text":"Audit logs are valuable tools to verify that our system is handling these random events. If we can read a log entry showing a forced network shutdown and then see log entries of similar timestamps, we can easily evaluate whether the system handled the situation.","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Audit logs are valuable tools to verify that our system is handling these random events. If we can read a log entry showing a forced network shutdown and then see log entries of similar timestamps, we can easily evaluate whether the system handled the situation."}]},{"block_type":"element","block":"k6bfvbm2","search_text":"After building that in, we can work on the next error to randomly introduce into the system. By following this cycle, we can build up the robustness of our system.","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After building that in, we can work on the next error to randomly introduce into the system. By following this cycle, we can build up the robustness of our system."}]},{"block_type":"element","block":"k6bfvbm3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k6bfvbm4","search_text":"This doesn't exactly fit into the realm of automated testing. This is also very high level. It's hard to go into much more detail, because the type of faulty data to inject requires an intimate understanding of the actual system.","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This doesn't exactly fit into the realm of automated testing. This is also very high level. It's hard to go into much more detail, because the type of faulty data to inject requires an intimate understanding of the actual system."}]},{"block_type":"element","block":"k6bfvbm5","search_text":"How does this compare to fuzz testing?","text_count":38,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How does this compare to fuzz testing?"}]},{"block_type":"element","block":"k6bfvbm6","search_text":"Fuzz testing is a style of testing where invalid, unexpected, and random data is injected into input points of our software ( http://en.wikipedia.org/wiki/Fuzz_testing ). If the application fails, this is considered a failure. If it doesn't, then it has passed. This type of testing goes in a similar direction, but the blog article written by Netflix appears to go much further than simply injecting different data. It talks about killing instances and interrupting distributed communications. Basically, anything you can think of that could happen in production, we should try to replicate in a test bed. Fusil ( https://bitbucket.org/haypo/fusil ) is a Python tool that aims to provide fuzz testing. You may want to investigate whether it is useful for your project needs.","text_count":775,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Fuzz testing"}]},{"block_type":"text","content":"is a style of testing where invalid, unexpected, and random data is injected into input points of our software ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://en.wikipedia.org/wiki/Fuzz_testing"},"children":[{"block_type":"text","content":"http://en.wikipedia.org/wiki/Fuzz_testing"}]},{"block_type":"text","content":"). If the application fails, this is considered a failure. If it doesn't, then it has passed. This type of testing goes in a similar direction, but the blog article written by Netflix appears to go much further than simply injecting different data. It talks about killing instances and interrupting distributed communications. Basically, anything you can think of that could happen in production, we should try to replicate in a test bed."},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Fusil"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://bitbucket.org/haypo/fusil"},"children":[{"block_type":"text","content":"https://bitbucket.org/haypo/fusil"}]},{"block_type":"text","content":") is a Python tool that aims to provide fuzz testing. You may want to investigate whether it is useful for your project needs."}]},{"block_type":"element","block":"k6bfvbm7","search_text":"Are there any tools to help with this?","text_count":38,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Are there any tools to help with this?"}]},{"block_type":"element","block":"k6bfvbm8","search_text":"Jester (for Java), Pester (for Python), and Nester (for C#) are used to conduct mutation testing ( http://jester.sourceforge.net/ ). These tools find out what code is not covered by test cases, alter the source code, and rerun the test suites. Finally, they give a report on what was changed, what passed, and what didn't pass. It can illuminate what is and is not covered by our test suites in ways coverage tools can't.","text_count":421,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Jester"}]},{"block_type":"text","content":"(for Java),"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Pester"}]},{"block_type":"text","content":"(for Python), and"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Nester"}]},{"block_type":"text","content":"(for C#) are used to conduct mutation testing ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://jester.sourceforge.net/"},"children":[{"block_type":"text","content":"http://jester.sourceforge.net/"}]},{"block_type":"text","content":"). These tools find out what code is not covered by&nbsp;test cases, alter the source code, and rerun the test suites. Finally, they give a report on what was changed, what passed, and what didn't pass. It can illuminate what is and is not covered by our test suites in ways coverage tools can't."}]},{"block_type":"element","block":"k6bfvbm9","search_text":"This isn't a complete Chaos Monkey, but it provides one area of assistance by trying to break the system and force us to improve our test regime. To really build a full-blown system probably wouldn't fit inside a test project, because it requires writing custom scripts based on the environment it's meant to run in.","text_count":316,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This isn't a complete Chaos Monkey, but it provides one area of assistance by trying to&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"break the system"}]},{"block_type":"text","content":"and force us to improve our test regime. To really build a full-blown system probably wouldn't fit inside a test project, because it requires writing custom scripts based on the environment it's meant to run in."}]},{"block_type":"element","block":"k6bfvbma","search_text":"Leave a review - let other readers know what you think","text_count":54,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Leave a review - let other readers know what you think"}]},{"block_type":"element","block":"k6bfvbmb","search_text":"Please share your thoughts on this book with others by leaving a review on the site that you bought it from. If you purchased the book from Amazon, please leave us an honest review on this book's Amazon page. This is vital so that other potential readers can see and use your unbiased opinion to make purchasing decisions, we can understand what our customers think about our products, and our authors can see your feedback on the title that they have worked with Packt to create. It will only take a few minutes of your time, but is valuable to other potential customers, our authors, and Packt. Thank you!","text_count":607,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please share your thoughts on this book with others by leaving a review on the site that you bought it from. If you purchased the book from Amazon, please leave us an honest review on this book's Amazon page. This is vital so that other potential readers can see and use your unbiased opinion to make purchasing decisions, we can understand what our customers think about our products, and our authors can see your feedback on the title that they have worked with Packt to create. It will only take a few minutes of your time, but is valuable to other potential customers, our authors, and Packt. Thank you!"}]}]}]}