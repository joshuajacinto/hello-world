{"title":"Python Automation Cookbook","authors":["Jaime Buelta"],"publisher":"packt","version":1,"chapters":[{"title":"Preface","author":"","block":"k67eune3","number":0,"contents":[{"block_type":"element","block":"k67ev62d","search_text":"Python Automation Cookbook","text_count":26,"tag_name":"h2","attributes":{"id":"maintitle"},"children":[{"block_type":"text","content":"Python Automation Cookbook"}]},{"block_type":"element","block":"k67ev62e","search_text":"Explore the world of automation using Python recipes that will enhance your skills","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Explore the world of automation using Python recipes that will enhance your skills"}]},{"block_type":"element","block":"k67ev62f","search_text":"Jaime Buelta","text_count":12,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jaime Buelta"}]},{"block_type":"element","block":"k67ev62g","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000065.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev62h","search_text":"BIRMINGHAM - MUMBAI","text_count":19,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"BIRMINGHAM - MUMBAI"}]}]}]},{"block_type":"element","block":"k67ev62i","search_text":"Copyright © 2018 Packt Publishing","text_count":33,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Copyright &copy; 2018 Packt Publishing"}]},{"block_type":"element","block":"k67ev62j","search_text":"All rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews.","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All rights reserved. No part of this book may be reproduced, stored in a retrieval system, or transmitted in any form or by any means, without the prior written permission of the publisher, except in the case of brief quotations embedded in critical articles or reviews."}]},{"block_type":"element","block":"k67ev62k","search_text":"Every effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the author, nor Packt Publishing or its dealers and distributors, will be held liable for any damages caused or alleged to have been caused directly or indirectly by this book.","text_count":397,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Every effort has been made in the preparation of this book to ensure the accuracy of the information presented. However, the information contained in this book is sold without warranty, either express or implied. Neither the author, nor Packt Publishing or its dealers and distributors, will be held liable for any damages caused or alleged to have been caused directly or indirectly by this book."}]},{"block_type":"element","block":"k67ev62l","search_text":"Packt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information.","text_count":240,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Packt Publishing has endeavored to provide trademark information about all of the companies and products mentioned in this book by the appropriate use of capitals. However, Packt Publishing cannot guarantee the accuracy of this information."}]},{"block_type":"element","block":"k67ev62m","search_text":"Commissioning Editor: Aaron Lazar Acquisition Editor: Shriram Shekhar Content Development Editor: Manjusha Mantri Technical Editor: Adhithya Haridas Copy Editor: Safis Editing Project Coordinator: Prajakta Naik Proofreader: Safis Editing Indexer: Mariammal Chettiyar Graphics: Jisha Chirayil Production Coordinator: Shantanu Zagade","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Commissioning Editor:"}]},{"block_type":"text","content":"&nbsp;Aaron Lazar"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Acquisition Editor:"}]},{"block_type":"text","content":"Shriram Shekhar"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Content Development Editor:"}]},{"block_type":"text","content":"Manjusha Mantri"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Technical Editor:"}]},{"block_type":"text","content":"Adhithya Haridas"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Copy Editor:"}]},{"block_type":"text","content":"Safis Editing"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Project Coordinator:"}]},{"block_type":"text","content":"Prajakta Naik"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Proofreader:"}]},{"block_type":"text","content":"Safis Editing"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Indexer:&nbsp;"}]},{"block_type":"text","content":"Mariammal Chettiyar"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Graphics:"}]},{"block_type":"text","content":"Jisha Chirayil"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Production Coordinator:"}]},{"block_type":"text","content":"Shantanu Zagade"}]},{"block_type":"element","block":"k67ev62n","search_text":"First published: September 2018","text_count":31,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"First published: September 2018"}]},{"block_type":"element","block":"k67ev62o","search_text":"Production reference: 1260918","text_count":29,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Production reference: 1260918"}]},{"block_type":"element","block":"k67ev62p","search_text":"Published by Packt Publishing Ltd. Livery Place 35 Livery Street Birmingham B3 2PB, UK.","text_count":87,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Published by Packt Publishing Ltd."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Livery Place"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"35 Livery Street"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"Birmingham"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"B3 2PB, UK."}]},{"block_type":"element","block":"k67ev62q","search_text":"ISBN 978-1-78913-380-6","text_count":22,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"ISBN 978-1-78913-380-6"}]},{"block_type":"element","block":"k67ev62r","search_text":"www.packtpub.com","text_count":16,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packtpub.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packtpub.com"}]}]},{"block_type":"element","block":"k67ev62s","search_text":"","text_count":0,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]}]},{"block_type":"element","block":"k67ev62t","search_text":"In loving memory of Banjo","text_count":25,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In loving memory of Banjo"}]},{"block_type":"element","block":"k67ev62u","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000071.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev62v","search_text":"mapt.io","text_count":7,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://mapt.io/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"mapt.io"}]}]},{"block_type":"element","block":"k67ev62w","search_text":"Mapt is an online digital library that gives you full access to over 5,000 books and videos, as well as industry leading tools to help you plan your personal development and advance your career. For more information, please visit our website.","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Mapt is an online digital library that gives you full access to over 5,000 books and videos, as well as industry leading tools to help you plan your personal development and advance your career. For more information, please visit our website."}]},{"block_type":"element","block":"k67ev62x","search_text":"PacktPub.com","text_count":12,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"PacktPub.com"}]},{"block_type":"element","block":"k67ev62y","search_text":"Did you know that Packt offers eBook versions of every book published, with PDF and ePub files available? You can upgrade to the eBook version at www.packt.com and as a print book customer, you are entitled to a discount on the eBook copy. Get in touch with us at customercare@packtpub.com for more details.","text_count":307,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Did you know that Packt offers eBook versions of every book published, with PDF and ePub files available? You can upgrade to the eBook version at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packt.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packt.com"}]},{"block_type":"text","content":"and as a print book customer, you are entitled to a discount on the eBook copy. Get in touch with us at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"customercare@packtpub.com"}]},{"block_type":"text","content":"for more details."}]},{"block_type":"element","block":"k67ev62z","search_text":"At www.packt.com , you can also read a collection of free technical articles, sign up for a range of free newsletters, and receive exclusive discounts and offers on Packt books and eBooks.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packt.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packt.com"}]},{"block_type":"text","content":", you can also read a collection of free technical articles, sign up for a range of free newsletters, and receive exclusive discounts and offers on Packt books and eBooks."}]},{"block_type":"element","block":"k67ev630","search_text":"Contributors","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Contributors"}]},{"block_type":"element","block":"k67ev631","search_text":"About the author","text_count":16,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"About the author"}]},{"block_type":"element","block":"k67ev632","search_text":"Jaime Buelta has been a professional programmer and a full-time Python developer and has been exposed to a lot of different technologies over his career. He has developed software for a variety of fields and industries, including aerospace, networking and communications, industrial SCADA systems, video game online services, and finance services. As part of these companies, he worked closely with various areas, such as marketing, management, sales, and game design, helping the companies achieve to their goals. He is a strong proponent of automating everything and making computers do most of the heavy lifting so users can focus on the important stuff. He is currently living in Dublin, Ireland, and has been a regular speaker at PyCon Ireland.","text_count":749,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Jaime Buelta"}]},{"block_type":"text","content":"has been a professional programmer and a full-time Python developer and has been exposed to a lot of different technologies over his career. He has developed software for a variety of fields and industries, including aerospace, networking and communications, industrial SCADA systems, video game online services, and finance services. As part of these companies, he worked closely with various areas, such as marketing, management, sales, and game design, helping the companies achieve to their goals. He is a strong proponent of automating everything and making computers do most of the heavy lifting so users can focus on the important stuff. He is currently living in Dublin, Ireland, and has been a regular speaker at PyCon Ireland."}]},{"block_type":"element","block":"k67ev633","search_text":"This book could not have happened without the support and encouragement of my amazing wife, Dana. I also want to thank the team at Packt, especially Manjusha for her huge help in the process, and Shriram for encouraging me to write the book. Also, great thanks to Mario for reviewing the book and improving it. Finally, I'd like to thank the whole Python community. I can't overstate what a joy it is to work as a developer in the Python world. ","text_count":445,"tag_name":"blockquote","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This book could not have happened without the support and encouragement of my amazing wife, Dana. I also want to thank the team at Packt, especially Manjusha for her huge help in the process, and Shriram for encouraging me to write the book. Also, great thanks to Mario for reviewing the book and improving it. Finally, I'd like to thank the whole Python community. I can't overstate what a joy it is to work as a developer in the Python world."}]}]},{"block_type":"element","block":"k67ev634","search_text":"About the reviewer","text_count":18,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"About the reviewer"}]},{"block_type":"element","block":"k67ev635","search_text":"Mario Corchero is a senior software developer at Bloomberg. He leads the Python infrastructure team in London, enabling the company to work effectively in Python and building company-wide libraries and tools. His professional experience is mainly in C++ and Python, and he has contributed some patches to multiple Python open source projects. He is a PSF fellow, having received the Q3 2018 PSF Community Award, is vice president of Python España (the Python Spain association), and has served as Chair of PyLondinium, PyConES17, and PyCon Charlas at PyCon 2018. Mario is passionate about the Python community, open source, and inner source.","text_count":641,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Mario Corchero"}]},{"block_type":"text","content":"is a senior software developer at Bloomberg. He leads the Python infrastructure team in London, enabling the company to work effectively in Python and building company-wide libraries and tools. His professional experience is mainly in C++ and Python, and he has contributed some patches to multiple Python open source projects. He is a PSF fellow, having received the Q3 2018 PSF Community Award, is vice president of Python Espa&ntilde;a (the Python Spain association), and has served as Chair of PyLondinium, PyConES17, and PyCon Charlas at PyCon 2018. Mario is passionate about the Python community, open source, and inner source."}]},{"block_type":"element","block":"k67ev636","search_text":"Packt is searching for authors like you","text_count":39,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Packt is searching for authors like you"}]},{"block_type":"element","block":"k67ev637","search_text":"If you're interested in becoming an author for Packt, please visit authors.packtpub.com and apply today. We have worked with thousands of developers and tech professionals, just like you, to help them share their insight with the global tech community. You can make a general application, apply for a specific hot topic that we are recruiting an author for, or submit your own idea.","text_count":382,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you're interested in becoming an author for Packt, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://authors.packtpub.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"authors.packtpub.com"}]},{"block_type":"text","content":"and apply today. We have worked with thousands of developers and tech professionals, just like you, to help them share their insight with the global tech community. You can make a general application, apply for a specific hot topic that we are recruiting an author for, or submit your own idea."}]},{"block_type":"element","block":"k67ev638","search_text":"Preface","text_count":7,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Preface"}]},{"block_type":"element","block":"k67ev639","search_text":"We are all probably spending time doing small manual tasks that don't add much value. It may be scanning through information sources in search of the small bits of relevant information, working with spreadsheets to generate the same graph over and over, or searching files one by one until find the data we're looking for. Some—probably most—of those tasks are, in fact, automatable. There's an investment upfront, but for the tasks that get repeated over and over, we can use computers to do these kinds of menial tasks and focus our own efforts instead on what humans are good for—high-level analysis and decision making based on the result. This book will explain how to use the Python language to automatize common business tasks that can be greatly sped up if a computer is doing them.","text_count":790,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We are all probably spending time doing small manual tasks that don't add much value. It may be scanning through information sources in search of the small bits of relevant information, working with spreadsheets to generate the same graph over and over, or searching files one by one until find the data we're looking for. Some&mdash;probably most&mdash;of those tasks are, in fact, automatable. There's an investment upfront, but for the tasks that get repeated over and over, we can use computers to do these kinds of menial tasks and focus our own efforts instead on what humans are good for&mdash;high-level analysis and decision making based on the result. This book will explain how to use the Python language to automatize common business tasks that can be greatly sped up if a computer is doing them."}]},{"block_type":"element","block":"k67ev63a","search_text":"Given the expressiveness and ease of use of Python, it's surprisingly simple to start making small programs to perform these actions and combine them into more integrated systems. Throughout the book, we will show small, easy-to-follow recipes that can be adapted to your specific needs, and we will combine them to perform more complex actions. We will perform common actions, such as detecting opportunities by scraping the web, analyzing information to generate automatic spreadsheet reports with graphs, communicating with automatically generated emails, getting notifications via text messages, and learning how to run tasks while your mind is focused on other more important stuff.","text_count":687,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Given the expressiveness and ease of use of Python, it's surprisingly simple to start making small programs to perform these actions and combine them into more integrated systems. Throughout the book, we will show small, easy-to-follow recipes that can be adapted to your specific needs, and we will combine them to perform more complex actions. We will perform common actions, such as detecting opportunities by scraping the web, analyzing information to generate automatic spreadsheet reports with graphs, communicating with automatically generated emails, getting notifications via text messages, and learning how to run tasks while your mind is focused on other more important stuff."}]},{"block_type":"element","block":"k67ev63b","search_text":"Though some Python knowledge is required, the book is written with non-programmers in mind, giving clear and instructive recipes that will further the reader's proficiency while being oriented to specific day-to-day goals.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Though some Python knowledge is required, the book is written with non-programmers in mind, giving clear and instructive recipes that will further the reader's proficiency while being oriented to specific day-to-day goals."}]},{"block_type":"element","block":"k67ev63c","search_text":"Who this book is for","text_count":20,"tag_name":"h1","attributes":{},"children":[{"block_type":"text","content":"Who this book is for"}]},{"block_type":"element","block":"k67ev63d","search_text":"This book is for Python beginners, not necessarily developers, that want to use and expand their knowledge to automate tasks. Most of the examples in the book are aimed at marketing, sales, and other non-tech areas. The reader needs to know a little of the Python language, including its basic concepts.","text_count":303,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This book is for Python beginners, not necessarily developers, that want to use and expand their knowledge to automate tasks. Most of the examples in the book are aimed at marketing, sales, and other non-tech areas. The reader needs to know a little of the Python language, including its basic concepts."}]},{"block_type":"element","block":"k67ev63e","search_text":"What this book covers","text_count":21,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"What this book covers"}]},{"block_type":"element","block":"k67ev63f","search_text":"Chapter 1, Let Us Begin Our Automation Journey, presents some basic content that will be used all through the book. It describes how to install and manage third-party tools through virtual environments, how to do effective string manipulation, how to use command-line arguments, and introduces you to regular expressions and other methods of text processing.","text_count":358,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey,&nbsp;"}]},{"block_type":"text","content":"&nbsp;presents some basic content that will be used all through the book. It describes how to install and manage third-party tools through virtual environments, how to do effective string manipulation, how to use command-line arguments, and introduces you to regular expressions and other methods of text processing."}]},{"block_type":"element","block":"k67ev63g","search_text":"Chapter 2, Automating Tasks Made Easy , shows how to prepare and automatically run tasks. It covers how to program tasks to be executed when they should, instead of running them manually; how to be notified with the result of a task that's run automatically; and how to be notified if there has been an error in an automated process.","text_count":333,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 2,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]},{"block_type":"text","content":", shows how to prepare and automatically run tasks. It covers how to program tasks to be executed when they should, instead of running them manually; how to be notified with the result of a task that's run automatically;&nbsp;and how to be notified if there has been an error in an automated process."}]},{"block_type":"element","block":"k67ev63h","search_text":"Chapter 3, Building Your First Web Scraping Application , explores sending web requests to communicate with external websites in different formats, such as raw HTML content; structured feeds; RESTful APIs; and even automating a browser to execute steps without manual intervention. It also covers how to process results to extract relevant information. ","text_count":353,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 3,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application"}]},{"block_type":"text","content":",&nbsp;explores sending web requests to communicate with external websites in different formats, such as raw HTML content; structured feeds; RESTful APIs; and even automating a browser to execute steps without manual intervention. It also covers how to process results to extract relevant information.&nbsp;"}]},{"block_type":"element","block":"k67ev63i","search_text":"Chapter 4, Searching and Reading Local Files , explains how to search through local files and directories and analyze the information stored there. You will learn how to filter through relevant files in different encodings and read files in several common formats, such as CSVs, PDFs, Word documents, and even images.","text_count":317,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 4,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]},{"block_type":"text","content":", explains how to search through local files and directories and analyze the information stored there. You will learn how to filter through relevant files in different encodings and read files in several common formats, such as CSVs, PDFs, Word documents, and even images."}]},{"block_type":"element","block":"k67ev63j","search_text":"Chapter 5, Generating Fantastic Reports , looks at how to display information given in text format in multiple formats. This includes creating templates to produce text files, as well as creating richly formatted and properly styled Word and PDF documents.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 5,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports"}]},{"block_type":"text","content":", looks at how to display information given in text format in multiple formats. This includes creating templates to produce text files, as well as creating richly formatted and properly styled Word and PDF documents."}]},{"block_type":"element","block":"k67ev63k","search_text":"Chapter 6, Fun with Spreadsheets , explores how to read and write spreadsheets in the CSV format; in rich Microsoft Excel, including with formatting and charts; and in LibreOffice, a free alternative to Microsoft Excel. ","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 6,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Fun with Spreadsheets"}]},{"block_type":"text","content":",&nbsp;explores how to read and write spreadsheets in the CSV format; in rich Microsoft Excel, including with formatting and charts; and in LibreOffice, a free alternative to Microsoft Excel.&nbsp;"}]},{"block_type":"element","block":"k67ev63l","search_text":"Chapter 7, Developing Stunning Graphs , explain how to produce beautiful charts, including common examples such as pie, line, and bar charts, as well as other advanced cases, such as stacked bars and even maps. It also explains how multiple graphs can be combined and styled to generate rich graphics and show relevant information in an understandable format.","text_count":359,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 7,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":", explain how to produce beautiful charts, including common examples such as pie, line, and bar charts, as well as other advanced cases, such as stacked bars and even maps. It also explains how multiple graphs can be combined and styled to generate rich graphics and show relevant information in an understandable format."}]},{"block_type":"element","block":"k67ev63m","search_text":"Chapter 8, Dealing with Communication Channels , explains how to send messages in multiple channels, using external tools to do the most of the heavy lifting. This chapter goes into sending and receiving emails individually as well as en masse , communicating through SMS messages, and creating a bot in Telegram.","text_count":313,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 8,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]},{"block_type":"text","content":", explains how to send messages in multiple channels, using external tools to do the most of the heavy lifting. This chapter goes into sending and receiving emails individually&nbsp;as well as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"en masse"}]},{"block_type":"text","content":", communicating through SMS messages, and creating a bot in Telegram."}]},{"block_type":"element","block":"k67ev63n","search_text":"Chapter 9, Why Not Automate Your Marketing Campaign? , combines the different recipes included in the book to generate a full marketing campaign, including steps such as detection of opportunity, generation of promotion, communication to potential customers, and analyzing and reporting sales produced by promotion. This chapter shows how to combine different elements to create powerful systems.","text_count":396,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 9,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Why Not Automate Your Marketing Campaign?"}]},{"block_type":"text","content":",&nbsp;combines the different recipes included in the book to generate a full marketing campaign, including steps such as detection of opportunity, generation of promotion, communication to potential customers, and analyzing and reporting sales produced by promotion. This chapter shows how to combine different elements to create powerful systems."}]},{"block_type":"element","block":"k67ev63o","search_text":"Chapter 10, Debugging Techniques , features different methods and tips to help in the debugging process and ensure the quality of your software. It leverages the great introspection capabilities of Python and its out-of-the-box debugging tools for fixing problems and producing solid automated software.","text_count":303,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Chapter 10,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Debugging Techniques"}]},{"block_type":"text","content":",&nbsp;features different methods and tips to help in the debugging process and ensure the quality of your software. It leverages the great introspection capabilities of Python and its out-of-the-box debugging tools for fixing problems and producing solid automated software."}]},{"block_type":"element","block":"k67ev63p","search_text":"To get the most out of this book","text_count":32,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"To get the most out of this book"}]},{"block_type":"element","block":"k67ev63q","search_text":"Before reading this book, readers need to know the basics of the Python language. We do not assume that the reader is an expert in the language.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Before reading this book, readers need to know the basics of the Python language. We do not assume that the reader is an expert in the language."}]},{"block_type":"element","block":"k67ev63r","search_text":"The reader needs to know how to input commands in the command line (Terminal, Bash, or equivalent).","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The reader needs to know how to input commands in the command line (Terminal, Bash, or equivalent)."}]},{"block_type":"element","block":"k67ev63s","search_text":"To understand the code in this book, you need a text editor, which will enable you to read and edit the code. You can use an IDE that supports the Python language, such as PyCharm and PyDev—which you choose is up to you. Check out this link for ideas about IDEs: https://realpython.com/python-ides-code-editors-guide/ .","text_count":319,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To understand the code in this book, you need a text editor, which will enable you to read and edit the code. You can use an IDE that supports the Python language, such as PyCharm and PyDev&mdash;which you choose is up to you. Check out this link for ideas about IDEs:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://realpython.com/python-ides-code-editors-guide/"},"children":[{"block_type":"text","content":"https://realpython.com/python-ides-code-editors-guide/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev63t","search_text":"Download the example code files","text_count":31,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Download the example code files"}]},{"block_type":"element","block":"k67ev63u","search_text":"You can download the example code files for this book from your account at www.packt.com . If you purchased this book elsewhere, you can visit www.packt.com/support and register to have the files emailed directly to you.","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can download the example code files for this book from your account at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packt.com","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packt.com"}]},{"block_type":"text","content":". If you purchased this book elsewhere, you can visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packt.com/support","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packt.com/support"}]},{"block_type":"text","content":"and register to have the files emailed directly to you."}]},{"block_type":"element","block":"k67ev63v","search_text":"You can download the code files by following these steps:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can download the code files by following these steps:"}]},{"block_type":"element","block":"k67ev63w","search_text":"Log in or register at www.packt.com . Select the SUPPORT tab. Click on Code Downloads & Errata. Enter the name of the book in the Search box and follow the onscreen instructions. ","text_count":179,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Log in or register at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packt.com/support","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packt.com"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select the SUPPORT tab."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Click on Code Downloads &amp; Errata."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter the name of the book in the Search box and follow the onscreen instructions."}]}]},{"block_type":"element","block":"k67ev63x","search_text":"Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:"}]},{"block_type":"element","block":"k67ev63y","search_text":"WinRAR/7-Zip for Windows Zipeg/iZip/UnRarX for Mac 7-Zip/PeaZip for Linux ","text_count":74,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"WinRAR/7-Zip for Windows"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Zipeg/iZip/UnRarX for Mac"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"7-Zip/PeaZip for Linux"}]}]},{"block_type":"element","block":"k67ev63z","search_text":"The code bundle for the book is also hosted on GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook . In case there's an update to the code, it will be updated on the existing GitHub repository.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code bundle for the book is also hosted on GitHub at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook"}]},{"block_type":"text","content":".&nbsp;In case there's an update to the code, it will be updated on the existing GitHub repository."}]},{"block_type":"element","block":"k67ev640","search_text":"We also have other code bundles from our rich catalog of books and videos available at https://github.com/PacktPublishing/ . Check them out!","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also have other code bundles from our rich catalog of books and videos available at&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/"}]}]},{"block_type":"text","content":". Check them out!"}]},{"block_type":"element","block":"k67ev641","search_text":"Download the color images","text_count":25,"tag_name":"h1","attributes":{},"children":[{"block_type":"text","content":"Download the color images"}]},{"block_type":"element","block":"k67ev642","search_text":"We also provide a PDF file that has color images of the screenshots/diagrams used in this book. You can download it https://www.packtpub.com/sites/default/files/downloads/9781789133806_ColorImages.pdf .","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also provide a PDF file that has color images of the screenshots/diagrams used in this book. You can download it"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.packtpub.com/sites/default/files/downloads/9781789133806_ColorImages.pdf"},"children":[{"block_type":"text","content":"https://www.packtpub.com/sites/default/files/downloads/9781789133806_ColorImages.pdf"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev643","search_text":"Conventions used","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Conventions used"}]},{"block_type":"element","block":"k67ev644","search_text":"There are a number of text conventions used throughout this book.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are a number of text conventions used throughout this book."}]},{"block_type":"element","block":"k67ev645","search_text":"CodeInText : Indicates code words in text, object names, module names, folder names, filenames, file extensions, pathnames, dummy URLs and user input. Here is an example: \"For this recipe, we need to import the requests module.\"","text_count":228,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CodeInText"}]},{"block_type":"text","content":": Indicates code words in text, object names, module names, folder names, filenames, file extensions, pathnames, dummy URLs and user input. Here is an example: \"For this recipe, we need to import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"module.\""}]},{"block_type":"element","block":"k67ev646","search_text":"A block of code is set as follows:","text_count":34,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A block of code is set as follows:"}]},{"block_type":"element","block":"k67ev647","search_text":"# IMPORTS from sale_log import SaleLog def get_logs_from_file(shop, log_filename): def main(log_dir, output_filename): ... if __name__ == '__main__': # PARSE COMMAND LINE ARGUMENTS AND CALL main()","text_count":196,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# IMPORTS\nfrom sale_log import SaleLog\n\ndef get_logs_from_file(shop, log_filename):\ndef main(log_dir, output_filename):\n    ...\n\nif __name__ == '__main__':\n  # PARSE COMMAND LINE ARGUMENTS AND CALL main()"}]}]},{"block_type":"element","block":"k67ev648","search_text":"Note that code may be edited for concision and clarity. Refer to the full code when necessary, which is available at GitHub.","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that code may be edited for concision and clarity. Refer to the full code when necessary, which is available at GitHub."}]},{"block_type":"element","block":"k67ev649","search_text":"Any command-line input or output is written as follows (notice the $ symbol):","text_count":77,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Any command-line input or output is written as follows (notice the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"$"}]},{"block_type":"text","content":"symbol):"}]},{"block_type":"element","block":"k67ev64a","search_text":"$ python execute_script.py parameters","text_count":37,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python execute_script.py parameters"}]}]},{"block_type":"element","block":"k67ev64b","search_text":"Any input in the Python interpreter is written as follows (notice the >>> symbol):","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Any input in the Python interpreter is written as follows (notice the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&gt;&gt;&gt;"}]},{"block_type":"text","content":"symbol):"}]},{"block_type":"element","block":"k67ev64c","search_text":">>> import delorean >>> timestamp = delorean.utcnow().datetime.isoformat()","text_count":74,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import delorean\n&gt;&gt;&gt; timestamp = delorean.utcnow().datetime.isoformat()"}]}]},{"block_type":"element","block":"k67ev64d","search_text":"To enter inside the Python interpreter, call the python3 command with no parameters:","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To enter inside the Python interpreter, call the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python3"}]},{"block_type":"text","content":"&nbsp;command with no parameters:"}]},{"block_type":"element","block":"k67ev64e","search_text":"$ python3 Python 3.7.0 (default, Aug 22 2018, 15:22:33) [Clang 9.1.0 (clang-902.0.39.2)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>>","text_count":173,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 \nPython 3.7.0 (default, Aug 22 2018, 15:22:33)\n[Clang 9.1.0 (clang-902.0.39.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev64f","search_text":"Verify that the Python interpreter is Python 3.7 or higher . It may be necessary to call python or python3.7 , depending on your operating system and installation options. See Chapter 1, Let Us Begin Our Automation Journey, specifically the Creating a virtual environment recipe—for further details about the use of different Python interpreters.","text_count":346,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Verify that the Python interpreter is Python 3.7 or higher"}]},{"block_type":"text","content":". It may be necessary to call"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"text","content":"&nbsp;or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python3.7"}]},{"block_type":"text","content":", depending on your operating system and installation options. See Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey,"}]},{"block_type":"text","content":"specifically the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"text","content":"&nbsp;recipe&mdash;for further details about the use of different Python interpreters."}]},{"block_type":"element","block":"k67ev64g","search_text":"Bold : Indicates a new term, an important word, or words that you see onscreen. For example, words in menus or dialog boxes appear in the text like this. Here is an example: \"Go to Account | Extras | API keys and create a new one:\"","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Bold"}]},{"block_type":"text","content":": Indicates a new term, an important word, or words that you see onscreen. For example, words in menus or dialog boxes appear in the text like this. Here is an example: \"Go to&nbsp;Account&nbsp;|&nbsp;Extras&nbsp;|&nbsp;API keys&nbsp;and create a new one:\""}]},{"block_type":"element","block":"k67ev64h","search_text":"Note Warnings or important notes appear like this. ","text_count":51,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Warnings or important notes appear like this."}]}]},{"block_type":"element","block":"k67ev64i","search_text":"Tip Tips and tricks appear like this. ","text_count":38,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Tips and tricks appear like this."}]}]},{"block_type":"element","block":"k67ev64j","search_text":"Sections","text_count":8,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Sections"}]},{"block_type":"element","block":"k67ev64k","search_text":"In this book, you will find several headings that appear frequently ( Getting ready , How to do it... , How it works... , There's more... , and See also ).","text_count":155,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this book, you will find several headings that appear frequently ("},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"text","content":", and&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev64l","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev64m","search_text":"This section tells you what to expect in the recipe and describes how to set up any software or any preliminary settings required for the recipe.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section tells you what to expect in the recipe and describes how to set up any software or any preliminary settings required for the recipe."}]},{"block_type":"element","block":"k67ev64n","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev64o","search_text":"This section contains the steps required to follow the recipe.","text_count":62,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section contains the steps required to follow the recipe."}]},{"block_type":"element","block":"k67ev64p","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev64q","search_text":"This section usually consists of a detailed explanation of what happened in the previous section.","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section usually consists of a detailed explanation of what happened in the previous section."}]},{"block_type":"element","block":"k67ev64r","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev64s","search_text":"This section consists of additional information about the recipe in order to make you more knowledgeable about the recipe.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section consists of additional information about the recipe in order to make you more knowledgeable about the recipe."}]},{"block_type":"element","block":"k67ev64t","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev64u","search_text":"This section provides helpful links to other useful information for the recipe.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This section provides helpful links to other useful information for the recipe."}]},{"block_type":"element","block":"k67ev64v","search_text":"Get in touch","text_count":12,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Get in touch"}]},{"block_type":"element","block":"k67ev64w","search_text":"Feedback from our readers is always welcome.","text_count":44,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Feedback from our readers is always welcome."}]},{"block_type":"element","block":"k67ev64x","search_text":"General feedback : If you have questions about any aspect of this book, please email us at customercare@packtpub.com .","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"General feedback"}]},{"block_type":"text","content":": If you have questions about any aspect of this book, please email us at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"customercare@packtpub.com"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev64y","search_text":"Errata : Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit www.packt.com/submit-errata , selecting your book, clicking on the Errata Submission Form link, and entering the details.","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Errata"}]},{"block_type":"text","content":": Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.packt.com/submit-errata","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"www.packt.com/submit-errata"}]},{"block_type":"text","content":", selecting your book, clicking on the Errata Submission Form link, and entering the details."}]},{"block_type":"element","block":"k67ev64z","search_text":"Piracy : If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at copyright@packt.com with a link to the material.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Piracy"}]},{"block_type":"text","content":": If you come across any illegal copies of our works in any form on the Internet, we would be grateful if you would provide us with the location address or website name. Please contact us at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"copyright@packt.com"}]},{"block_type":"text","content":"with a link to the material."}]},{"block_type":"element","block":"k67ev650","search_text":"If you are interested in becoming an author : If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit authors.packtpub.com .","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"If you are interested in becoming an author"}]},{"block_type":"text","content":": If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://authors.packtpub.com/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"authors.packtpub.com"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev651","search_text":"Reviews","text_count":7,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reviews"}]},{"block_type":"element","block":"k67ev652","search_text":"Please leave a review. Once you have read and used this book, why not leave a review on the site that you purchased it from? Potential readers can then see and use your unbiased opinion to make purchase decisions, we at Packt can understand what you think about our products, and our authors can see your feedback on their book. Thank you!","text_count":339,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please leave a review. Once you have read and used this book, why not leave a review on the site that you purchased it from? Potential readers can then see and use your unbiased opinion to make purchase decisions, we at Packt can understand what you think about our products, and our authors can see your feedback on their book. Thank you!"}]},{"block_type":"element","block":"k67ev653","search_text":"For more information about Packt, please visit packt.com .","text_count":58,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more information about Packt, please visit&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.packt.com/","target":"_blank","rel":"noopener"},"children":[{"block_type":"text","content":"packt.com"}]},{"block_type":"text","content":"."}]}]},{"title":"Let Us Begin Our Automation Journey","author":"Jaime Buelta","block":"k67eunhe","number":1,"contents":[{"block_type":"element","block":"k67ev654","search_text":"In this chapter, we'll cover the following recipes:","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we'll cover the following recipes:"}]},{"block_type":"element","block":"k67ev655","search_text":"Creating a virtual environment Installing third-party packages Creating strings with formatted values Manipulating strings Extracting data from structured strings Using a third-party tool—parse Introducing regular expressions Going deeper into regular expressions Adding command-line arguments ","text_count":294,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating strings with formatted values"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Manipulating strings"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Extracting data from structured strings"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Going deeper into regular expressions"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Adding command-line arguments"}]}]},{"block_type":"element","block":"k67ev656","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev657","search_text":"The objective of this chapter is to lay down some of the basic techniques that will be useful through this book. The main idea is to be able to create a good Python environment to run the automation tasks that will follow, and be able to parse text inputs into structured data.","text_count":277,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The objective of this chapter is to lay down some of the basic techniques that will be useful through this book. The main idea is to be able to create a good Python environment to run the automation tasks that will follow, and be able to parse text inputs into structured data."}]},{"block_type":"element","block":"k67ev658","search_text":"Python has a good amount of tools installed by default, but it also makes it easy to install third-party tools that can simplify common operations when processing texts. In this chapter, we'll see how to import modules from external sources and use them to leverage the full potential of Python.","text_count":295,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python has a good amount of tools installed by default, but it also makes it easy to install third-party tools that can simplify common operations when processing texts. In this chapter, we'll see how to import modules from external sources and use them to leverage the full potential of Python."}]},{"block_type":"element","block":"k67ev659","search_text":"The ability to structure input data is critical in any automation task. Most of the data that we will process in this book will come from unformatted sources such as web pages or text files. As the old computer adage says, garbage in, garbage out , making the sanitizing of inputs a very important task.","text_count":303,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The ability to structure input data is critical in any automation task. Most of the data that we will process in this book will come from unformatted sources such as web pages or text files. As the old computer adage says,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"garbage in, garbage out"}]},{"block_type":"text","content":",&nbsp;making the sanitizing of inputs a very important task."}]},{"block_type":"element","block":"k67ev65a","search_text":"Creating a virtual environment","text_count":30,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"element","block":"k67ev65b","search_text":"As a first step when working with Python, it is a good practice to explicitly define the working environment. This helps with detaching from the operative system interpreter and environment, and properly defining the dependencies that will be used. Not doing so tends to generate chaotic scenarios. Remember, explicit is better than implicit!","text_count":342,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As a first step when working with Python, it is a good practice to explicitly&nbsp;define&nbsp;the working environment. This helps with detaching from the operative system interpreter and environment, and properly defining the dependencies that will be used. Not doing so tends to generate chaotic scenarios. Remember,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"explicit is better than implicit!"}]}]},{"block_type":"element","block":"k67ev65c","search_text":"This is especially important in two scenarios:","text_count":46,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is especially important in two scenarios:"}]},{"block_type":"element","block":"k67ev65d","search_text":"When dealing with multiple projects on the same computer, as they can have different dependencies that clash at some point. For example, two versions of the same module cannot be installed in the same environment. When working on a project that will be used on a different computer, for example, developing some code in a personal laptop that will ultimately run in a remote server. ","text_count":383,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When dealing with multiple projects on the same computer, as they can have different dependencies that clash at some point. For example, two versions of the same module cannot be installed in the same environment."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When working on a project that will be used on a different computer, for example, developing some code in a personal laptop that will ultimately run in a remote server."}]}]},{"block_type":"element","block":"k67ev65e","search_text":"Tip A common joke among developers is responding to a bug with it runs on my machine , meaning that it appears to work on their laptop, but not on the production servers. Although a huge number of factors can produce this error, a good practice is to produce an automatically replicable environment, reducing uncertainty over what dependencies are really being used. ","text_count":367,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common joke among developers is responding to a bug with"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"it runs on my machine"}]},{"block_type":"text","content":",&nbsp;meaning that it appears to work on their laptop, but not on the production servers. Although a huge number of factors can produce this error, a good practice is to produce an automatically replicable environment, reducing uncertainty over what dependencies are really being used."}]}]},{"block_type":"element","block":"k67ev65f","search_text":"This is easy to achieve using the virtualenv module, which sets up a virtual environment, so none of the installed dependencies will be shared with the Python version installed on the machine.","text_count":192,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is easy to achieve using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"module, which&nbsp;sets up a virtual environment, so none of the installed dependencies will be shared with the Python version installed on the machine."}]},{"block_type":"element","block":"k67ev65g","search_text":"Note In Python3, the virtualenv tool is installed automatically, which was not the case in previous versions. ","text_count":110,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Python3, the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":"&nbsp;tool&nbsp;is installed automatically, which was not the case in previous versions."}]}]},{"block_type":"element","block":"k67ev65h","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev65i","search_text":"To create a new virtual environment, do the following:","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To create a new virtual environment, do the following:"}]},{"block_type":"element","block":"k67ev65j","search_text":"Go to the main directory that contains the project. Type the following command: ","text_count":80,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Go to the main directory that contains the project."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Type the following command:"}]}]},{"block_type":"element","block":"k67ev65k","search_text":"$ python3 -m venv .venv","text_count":23,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 -m venv .venv"}]}]},{"block_type":"element","block":"k67ev65l","search_text":"This creates a subdirectory called .venv that contains the virtual environment.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This creates a subdirectory called&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".venv"}]},{"block_type":"text","content":"&nbsp;that contains the virtual environment."}]},{"block_type":"element","block":"k67ev65m","search_text":"Tip The directory containing the virtual environment can be located anywhere. Keeping it on the same root keeps it handy, and adding a dot in front of it avoids it being displayed when running ls or other commands. ","text_count":215,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The directory containing the virtual environment can be located anywhere. Keeping it on the same root keeps it handy, and adding a dot in front of it avoids it being displayed when running"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ls"}]},{"block_type":"text","content":"or other commands."}]}]},{"block_type":"element","block":"k67ev65n","search_text":"Before activating the virtual environment, check the version installed in pip . This is different depending on your operative system, for example, 9.0.3 for MacOS High Sierra 10.13.4. It will be upgraded later. Also check the referenced Python interpreter, which will be the main operating system one: ","text_count":302,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Before activating the virtual environment, check the version installed in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":". This is different depending on your operative system, for example, 9.0.3 for MacOS High Sierra 10.13.4. It will be upgraded later. Also check the referenced Python interpreter, which will be the main operating system one:"}]}]},{"block_type":"element","block":"k67ev65o","search_text":"$ pip --version pip 9.0.3 from /usr/local/lib/python3.6/site-packages/pip (python 3.6) $ which python3 /usr/local/bin/python3","text_count":125,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip --version\npip 9.0.3 from /usr/local/lib/python3.6/site-packages/pip (python 3.6)\n$ which python3\n/usr/local/bin/python3"}]}]},{"block_type":"element","block":"k67ev65p","search_text":"Now, your virtual environment is ready to go.","text_count":45,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Now, your virtual environment is ready to go."}]},{"block_type":"element","block":"k67ev65q","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev65r","search_text":"Activate the virtual environment by running this: ","text_count":50,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Activate the virtual environment by running this:"}]}]},{"block_type":"element","block":"k67ev65s","search_text":"$ source .venv/bin/activate","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ source .venv/bin/activate"}]}]},{"block_type":"element","block":"k67ev65t","search_text":"You'll notice that the prompt will display (.venv) , showing that the virtual environment is active.","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You'll notice that the prompt will display"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"(.venv)"}]},{"block_type":"text","content":", showing that the virtual environment is active."}]},{"block_type":"element","block":"k67ev65u","search_text":"Notice that the Python interpreter used is the one inside the virtual environment, and not the general operative system one from step 3 of Getting ready . Checking the location within a virtual environment: ","text_count":207,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Notice that the Python interpreter used&nbsp;is the one inside the virtual environment, and not the general operative system one from step 3 of"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"text","content":". Checking the location within a virtual environment:"}]}]},{"block_type":"element","block":"k67ev65v","search_text":"(.venv) $ which python /root_dir/.venv/bin/python (.venv) $ which pip /root_dir/.venv/bin/pip","text_count":93,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(.venv) $ which python\n/root_dir/.venv/bin/python\n(.venv) $ which pip\n/root_dir/.venv/bin/pip"}]}]},{"block_type":"element","block":"k67ev65w","search_text":"Upgrade the version of pip and check the version: ","text_count":50,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Upgrade the version of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"and check the version:"}]}]},{"block_type":"element","block":"k67ev65x","search_text":"(.venv) $ pip install --upgrade pip ... Successfully installed pip-10.0.1 (.venv) $ pip --version pip 10.0.1 from /root_dir/.venv/lib/python3.6/site-packages/pip (python 3.6)","text_count":174,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(.venv) $ pip install --upgrade pip\n...\nSuccessfully installed pip-10.0.1\n(.venv) $ pip --version\npip 10.0.1 from /root_dir/.venv/lib/python3.6/site-packages/pip (python 3.6)"}]}]},{"block_type":"element","block":"k67ev65y","search_text":"Get out of the environment and run pip to check the version, which will return the previous environment. Check the pip version and the Python interpreter to show the ones before activating the virtual environment ones, as shown in step 3 of the Getting ready section. Note that they are different pip versions! ","text_count":311,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get out of the environment and run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"to check the version, which will return the previous environment. Check the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"version and the Python interpreter to show the ones before activating the virtual environment ones, as shown in step 3 of the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"text","content":"section. Note that they are different pip versions!"}]}]},{"block_type":"element","block":"k67ev65z","search_text":"(.venv) $ deactivate $ which python3 /usr/local/bin/python3 $ pip --version pip 9.0.3 from /usr/local/lib/python3.6/site-packages/pip (python 3.6)","text_count":146,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(.venv) $ deactivate \n$ which python3\n/usr/local/bin/python3\n$ pip --version\npip 9.0.3 from /usr/local/lib/python3.6/site-packages/pip (python 3.6)"}]}]},{"block_type":"element","block":"k67ev660","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev661","search_text":"Notice that inside the virtual environment you can use python instead of python3 , although python3 is available as well. This will use the Python interpreter defined in the environment.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that inside the virtual environment you can use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"text","content":"instead of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python3"}]},{"block_type":"text","content":", although"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python3"}]},{"block_type":"text","content":"is available as well. This will use the Python interpreter defined in the environment."}]},{"block_type":"element","block":"k67ev662","search_text":"Tip In some systems like Linux, it's possible that you need to use python3.7 instead of python3 . Verify that the Python interpreter you're using is 3.7 or higher. ","text_count":164,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In some systems like Linux, it's possible that you need to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python3.7"}]},{"block_type":"text","content":"instead of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python3"}]},{"block_type":"text","content":". Verify that the Python interpreter you're using is 3.7 or higher."}]}]},{"block_type":"element","block":"k67ev663","search_text":"Inside the virtual environment, step 3 of the How to do it... section installs the most recent version of pip , without affecting the external installation.","text_count":156,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Inside the virtual environment, step 3 of the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":"&nbsp;section installs the most recent version of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":", without affecting the external installation."}]},{"block_type":"element","block":"k67ev664","search_text":"The virtual environment contains all the Python data in the .venv directory, and the activate script points all the environment variables there. The best thing about it is that it can be deleted and recreated very easily, removing the fear of experimenting in a self-contained sandbox.","text_count":285,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The virtual environment contains all the Python data in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".venv"}]},{"block_type":"text","content":"directory, and the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"activate"}]},{"block_type":"text","content":"script points all the environment variables there. The best thing about it is that it can be deleted and recreated very easily, removing the fear of experimenting in a self-contained sandbox."}]},{"block_type":"element","block":"k67ev665","search_text":"Tip Remember that the directory name is displayed in the prompt. If you need to differentiate the environment, use a descriptive directory name, such as .my_automate_recipe , or use the --prompt option. ","text_count":203,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember that the directory name is displayed in the prompt. If you need to differentiate the environment, use a descriptive directory name, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".my_automate_recipe"}]},{"block_type":"text","content":",&nbsp;or use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--prompt"}]},{"block_type":"text","content":"option."}]}]},{"block_type":"element","block":"k67ev666","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev667","search_text":"To remove a virtual environment, deactivate it and remove the directory:","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To remove a virtual environment, deactivate it and remove the directory:"}]},{"block_type":"element","block":"k67ev668","search_text":"(.venv) $ deactivate $ rm -rf .venv","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(.venv) $ deactivate\n$ rm -rf .venv"}]}]},{"block_type":"element","block":"k67ev669","search_text":"The venv module has more options, which can be shown with the -h flag:","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"venv"}]},{"block_type":"text","content":"module has more options, which can be shown with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"flag:"}]},{"block_type":"element","block":"k67ev66a","search_text":"$ python3 -m venv -h usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear] [--upgrade] [--without-pip] [--prompt PROMPT] ENV_DIR [ENV_DIR ...] Creates virtual Python environments in one or more target directories. positional arguments: ENV_DIR A directory to create the environment in. optional arguments: -h, --help show this help message and exit --system-site-packages Give the virtual environment access to the system site-packages dir. --symlinks Try to use symlinks rather than copies, when symlinks are not the default for the platform. --copies Try to use copies rather than symlinks, even when symlinks are the default for the platform. --clear Delete the contents of the environment directory if it already exists, before environment creation. --upgrade Upgrade the environment directory to use this version of Python, assuming Python has been upgraded in-place. --without-pip Skips installing or upgrading pip in the virtual environment (pip is bootstrapped by default) --prompt PROMPT Provides an alternative prompt prefix for this environment. Once an environment has been created, you may wish to activate it, for example, by sourcing an activate script in its bin directory.","text_count":1211,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 -m venv -h\nusage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]\n [--upgrade] [--without-pip] [--prompt PROMPT]\n ENV_DIR [ENV_DIR ...]\nCreates virtual Python environments in one or more target directories.\npositional arguments:\n ENV_DIR A directory to create the environment in.\n\noptional arguments:\n -h, --help show this help message and exit\n --system-site-packages\n Give the virtual environment access to the system\n site-packages dir.\n --symlinks Try to use symlinks rather than copies, when symlinks\n are not the default for the platform.\n --copies Try to use copies rather than symlinks, even when\n symlinks are the default for the platform.\n --clear Delete the contents of the environment directory if it\n already exists, before environment creation.\n --upgrade Upgrade the environment directory to use this version\n of Python, assuming Python has been upgraded in-place.\n --without-pip Skips installing or upgrading pip in the virtual\n environment (pip is bootstrapped by default)\n --prompt PROMPT Provides an alternative prompt prefix for this\n environment.\nOnce an environment has been created, you may wish to activate it, for example, by\nsourcing an activate script in its bin directory."}]}]},{"block_type":"element","block":"k67ev66b","search_text":"A convenient way of dealing with virtual environments, especially if you often have to swap between them, is using the virtualenvwrapper module:","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A convenient way of dealing with virtual environments, especially if you&nbsp;often&nbsp;have to swap between them, is using the &nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenvwrapper"}]},{"block_type":"text","content":"module:"}]},{"block_type":"element","block":"k67ev66c","search_text":"To install it, run this: ","text_count":25,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To install it, run this:"}]}]},{"block_type":"element","block":"k67ev66d","search_text":"$ pip install virtualenvwrapper","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip install virtualenvwrapper"}]}]},{"block_type":"element","block":"k67ev66e","search_text":"Then, add the following variables to your sheet startup script, these normally being .bashrc or .bash_profile . The virtual environments will be installed under the WORKON_HOME directory instead of the same directory as the project, as shown previously: ","text_count":254,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Then, add the following variables to your sheet startup script, these normally being&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".bashrc"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".bash_profile"}]},{"block_type":"text","content":". The virtual environments will be installed under the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"WORKON_HOME"}]},{"block_type":"text","content":"directory instead of the same directory as the project, as shown previously:"}]}]},{"block_type":"element","block":"k67ev66f","search_text":"export WORKON_HOME=~/.virtualenvs source /usr/local/bin/virtualenvwrapper.sh","text_count":76,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"export WORKON_HOME=~/.virtualenvs\nsource /usr/local/bin/virtualenvwrapper.sh"}]}]},{"block_type":"element","block":"k67ev66g","search_text":"Sourcing the startup script or opening a new Terminal will allow you to create new virtual environments:","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sourcing the startup script or opening a new Terminal will allow you to create new virtual environments:"}]},{"block_type":"element","block":"k67ev66h","search_text":"$ mkvirtualenv automation_cookbook ... Installing setuptools, pip, wheel...done. (automation_cookbook) $ deactivate $ workon automation_cookbook (automation_cookbook) $","text_count":168,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ mkvirtualenv automation_cookbook\n...\nInstalling setuptools, pip, wheel...done.\n(automation_cookbook) $ deactivate\n$ workon automation_cookbook\n(automation_cookbook) $"}]}]},{"block_type":"element","block":"k67ev66i","search_text":"For more information, check the documentation of virtualenvwrapper at: https://virtualenvwrapper.readthedocs.io/en/latest/index.html .","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For more information, check the documentation of&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenvwrapper"}]},{"block_type":"text","content":"&nbsp;at:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://virtualenvwrapper.readthedocs.io/en/latest/index.html"},"children":[{"block_type":"text","content":"https://virtualenvwrapper.readthedocs.io/en/latest/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev66j","search_text":"Note Hitting the Tab key after workon autocompletes with the available environments. ","text_count":85,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Hitting the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Tab"}]},{"block_type":"text","content":"key after"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"workon"}]},{"block_type":"text","content":"autocompletes with the available environments.&nbsp;"}]}]},{"block_type":"element","block":"k67ev66k","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev66l","search_text":"The Installing third-party packages recipe The Using a third-party tool—parse recipe ","text_count":85,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev66m","search_text":"Installing third-party packages","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"element","block":"k67ev66n","search_text":"One of the strongest capabilities of Python is the ability to use an impressive catalog of third-party packages that cover an amazing amount of ground in different areas, from modules specialized in performing numerical operations, machine learning, and network communications, to command-line convenience tools, database access, image processing, and much more!","text_count":362,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One of the strongest capabilities of Python is the ability to use an impressive catalog of third-party packages that cover an amazing amount of ground in different areas, from modules specialized in performing numerical operations, machine learning, and network communications, to command-line convenience tools, database access, image processing, and much more!"}]},{"block_type":"element","block":"k67ev66o","search_text":"Most of them are available on the official Python Package Index ( https://pypi.org/ ), which has more than 130,000 packages ready to use. In this book, we'll install some of them, and in general spending a little time researching external tools when trying to solve a problem is time well spent. It's very likely that someone else has created a tool that solves all, or at least part, of the problem.","text_count":400,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most of them are available on the official Python Package Index&nbsp;("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pypi.org/"},"children":[{"block_type":"text","content":"https://pypi.org/"}]},{"block_type":"text","content":"), which has more than 130,000 packages ready to use. In this book, we'll install some of them, and in general spending a little time researching external tools when trying to solve a problem is time well spent. It's very likely that someone else has created a tool that solves all, or at least part, of the problem."}]},{"block_type":"element","block":"k67ev66p","search_text":"As important as finding and installing a package is keeping track of which packages are being used. This greatly helps with replicability , meaning the ability to start the whole environment from scratch in any situation.","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As important as finding and installing a package is keeping track of which packages are being used. This greatly helps with"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"replicability"}]},{"block_type":"text","content":", meaning the ability to start the whole environment from scratch in any situation."}]},{"block_type":"element","block":"k67ev66q","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev66r","search_text":"The starting point is to find a package that will be of use in our project.","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The starting point is to find a package that will be of use in our project."}]},{"block_type":"element","block":"k67ev66s","search_text":"A great one is requests , a module that deals with HTTP requests and is known for its easy and intuitive interface, as well as its great documentation. Take a look at the documentation, which can be found here: http://docs.python-requests.org/en/master/ .","text_count":255,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A great one is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":", a module that deals with HTTP requests and is known for its easy and intuitive interface, as well as its great documentation. Take a look at the documentation, which can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python-requests.org/en/master/"},"children":[{"block_type":"text","content":"http://docs.python-requests.org/en/master/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev66t","search_text":"We'll use requests throughout this book when dealing with HTTP connections.","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"throughout this book when dealing with HTTP connections."}]},{"block_type":"element","block":"k67ev66u","search_text":"The next step will be to choose the version to use. In this case, the latest (2.18.4, at the time of writing) will be perfect. If the version of the module is not specified, by default, it will install the latest version, which can lead to inconsistencies in different environments. ","text_count":283,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The next step will be to choose the version to use. In this case, the latest (2.18.4, at the time of&nbsp;writing)&nbsp;will be perfect. If the version of the module is not specified, by default, it will install the latest version, which can lead to inconsistencies in different environments.&nbsp;"}]},{"block_type":"element","block":"k67ev66v","search_text":"We'll also use the great delorean module for time handling (version 1.0.0 http://delorean.readthedocs.io/en/latest/ ).","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll also use the great"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"module for time handling (version 1.0.0&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://delorean.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"http://delorean.readthedocs.io/en/latest/"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev66w","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev66x","search_text":"Create a requirements.txt file in our main directory, which will specify all the requirements for our project. Let's start with delorean and requests : ","text_count":152,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file in our main directory, which will specify all the requirements for our project. Let's start with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev66y","search_text":"delorean==1.0.0 requests==2.18.4","text_count":32,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"delorean==1.0.0\nrequests==2.18.4"}]}]},{"block_type":"element","block":"k67ev66z","search_text":"Install all the requirements with the pip command: ","text_count":51,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Install all the requirements with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"command:"}]}]},{"block_type":"element","block":"k67ev670","search_text":"$ pip install -r requirements.txt ... Successfully installed babel-2.5.3 certifi-2018.4.16 chardet-3.0.4 delorean-1.0.0 humanize-0.5.1 idna-2.6 python-dateutil-2.7.2 pytz-2018.4 requests-2.18.4 six-1.11.0 tzlocal-1.5.1 urllib3-1.22","text_count":231,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip install -r requirements.txt\n...\nSuccessfully installed babel-2.5.3 certifi-2018.4.16 chardet-3.0.4 delorean-1.0.0 humanize-0.5.1 idna-2.6 python-dateutil-2.7.2 pytz-2018.4 requests-2.18.4 six-1.11.0 tzlocal-1.5.1 urllib3-1.22"}]}]},{"block_type":"element","block":"k67ev671","search_text":"You can now use both modules when using the virtual environment: ","text_count":65,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You can now use both modules when using the virtual environment:"}]}]},{"block_type":"element","block":"k67ev672","search_text":"$ python Python 3.6.5 (default, Mar 30 2018, 06:41:53) [GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.39.2)] on darwin Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import delorean >>> import requests","text_count":234,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python\nPython 3.6.5 (default, Mar 30 2018, 06:41:53)\n[GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.39.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import delorean\n&gt;&gt;&gt; import requests"}]}]},{"block_type":"element","block":"k67ev673","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev674","search_text":"The requirements.txt file specifies the module and version, and pip performs a search on pypi.org .","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file specifies the module and version, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip"}]},{"block_type":"text","content":"performs a search on"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pypi.org"},"children":[{"block_type":"text","content":"pypi.org"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev675","search_text":"Note that creating a new virtual environment from scratch and running the following will completely recreate your environment, which makes replicability very straightforward:","text_count":174,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that creating a new virtual environment from scratch and running the following&nbsp;will completely recreate your environment, which makes replicability very straightforward:"}]},{"block_type":"element","block":"k67ev676","search_text":"$ pip install -r requirements.txt","text_count":33,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev677","search_text":"Note that step 2 of the How to do it... section automatically installs other modules that are dependencies, such as urllib3 .","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that step 2 of the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":"section&nbsp;automatically&nbsp;installs other modules that are dependencies, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"urllib3"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev678","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev679","search_text":"If any of the modules need to be changed to a different version because a new version is available, change it using requirements and run the install command again:","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If any of the modules need to be changed to a different version because a new version is available, change it using requirements and run the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"install"}]},{"block_type":"text","content":"command again:"}]},{"block_type":"element","block":"k67ev67a","search_text":"$ pip install -r requirements.txt","text_count":33,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev67b","search_text":"This is also applicable when a new module needs to be included.","text_count":63,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is also applicable when a new module needs to be included."}]},{"block_type":"element","block":"k67ev67c","search_text":"At any point, the freeze command can be used to display all installed modules. freeze returns the modules in a format compatible with requirements.txt , making it possible to do this to generate a file with our current environment:","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At any point, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"freeze"}]},{"block_type":"text","content":"&nbsp;command&nbsp;can be used to display all installed modules."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"freeze"}]},{"block_type":"text","content":"returns the modules in a format compatible with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":", making it possible to do this&nbsp;to generate a file with our current environment:"}]},{"block_type":"element","block":"k67ev67d","search_text":"$ pip freeze > requirements.txt","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip freeze &gt; requirements.txt"}]}]},{"block_type":"element","block":"k67ev67e","search_text":"This will include dependencies, so expect a lot more modules in the file.","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This will include dependencies, so expect a lot more modules in the file."}]},{"block_type":"element","block":"k67ev67f","search_text":"Note Finding great third-party modules is not easy sometimes. Searching for specific functionality can work well, but sometimes there are great modules that are a surprise because they do things you never thought of. A great curated list is Awesome Python ( https://awesome-python.com/ ), which covers a lot of great tools for common Python use cases, such as cryptography, database access, date and time handling, and so on. ","text_count":426,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finding great third-party modules is not easy sometimes. Searching for specific functionality can work well, but sometimes there are great modules that are a surprise because they do things you never thought of. A great curated list is"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Awesome Python"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://awesome-python.com/"},"children":[{"block_type":"text","content":"https://awesome-python.com/"}]},{"block_type":"text","content":"), which covers a lot of great tools for common Python use cases, such as cryptography, database access, date and time handling, and&nbsp; so on."}]}]},{"block_type":"element","block":"k67ev67g","search_text":"In some cases, installing packages may require additional tools, such as compilers or a specific library that supports some functionality (for example, a particular database driver). If that's the case, the documentation will normally explain the dependencies.","text_count":260,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In some cases, installing packages may require additional tools, such as compilers or a specific library that supports some functionality (for example, a particular database driver). If that's the case, the documentation will normally explain the dependencies."}]},{"block_type":"element","block":"k67ev67h","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev67i","search_text":"The Creating a virtual environment recipe The Using a third-party tool—parse recipe ","text_count":84,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev67j","search_text":"Creating strings with formatted values","text_count":38,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating strings with formatted values"}]},{"block_type":"element","block":"k67ev67k","search_text":"One of the basic abilities when dealing with creating text and documents is to be able to properly format the values into structured strings. Python is quite smart in presenting good defaults, such as properly rendering a number, but there are a lot of options and possibilities.","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One of the basic abilities when dealing with creating text and documents is to be able to properly format the values into structured strings. Python is quite smart in presenting good defaults, such as properly rendering a number, but there are a lot of options and possibilities."}]},{"block_type":"element","block":"k67ev67l","search_text":"We'll discuss some of the common options when creating formatted text with the example of a table.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll discuss some of the common options when creating formatted text with the example of a table."}]},{"block_type":"element","block":"k67ev67m","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev67n","search_text":"The main tool to format strings in Python is the format method. It works with a defined mini-language to render variables this way:","text_count":131,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main tool to format strings in Python is the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"format"}]},{"block_type":"text","content":"method. It works with a defined mini-language to render variables this way:"}]},{"block_type":"element","block":"k67ev67o","search_text":"result = template.format(*parameters)","text_count":37,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"result = template.format(*parameters)"}]}]},{"block_type":"element","block":"k67ev67p","search_text":"The template is a string that gets interpreted based on the mini-language. At its easiest, it replaces the values between curly brackets with the parameters. Here are a couple of examples:","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"template"}]},{"block_type":"text","content":"is a string that gets interpreted based on the mini-language. At its easiest, it replaces the values between curly brackets with the parameters. Here are a couple of examples:"}]},{"block_type":"element","block":"k67ev67q","search_text":">>> 'Put the value of the string here: {}'.format('STRING') \"Put the value of the string here: STRING\" >>> 'It can be any type ({}) and more than one ({})'.format(1.23, str) \"It can be any type (1.23) and more than one (<class 'str'>)\" >> 'Specify the order: {1}, {0}'.format('first', 'second') 'Specify the order: second, first' >>> 'Or name parameters: {first}, {second}'.format(second='SECOND', first='FIRST') 'Or name parameters: FIRST, SECOND'","text_count":448,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; 'Put the value of the string here: {}'.format('STRING')\n\"Put the value of the string here: STRING\"\n&gt;&gt;&gt; 'It can be any type ({}) and more than one ({})'.format(1.23, str)\n\"It can be any type (1.23) and more than one (&lt;class 'str'&gt;)\"\n&gt;&gt; 'Specify the order: {1}, {0}'.format('first', 'second')\n'Specify the order: second, first'\n&gt;&gt;&gt; 'Or name parameters: {first}, {second}'.format(second='SECOND', first='FIRST')\n'Or name parameters: FIRST, SECOND'"}]}]},{"block_type":"element","block":"k67ev67r","search_text":"In 95% of cases, this formatting will be all that's required; keeping things simple is great! But for complicated times, such as when aligning the strings automatically and creating good looking text tables, the mini-language format has more options.","text_count":250,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In 95% of cases, this formatting will be all that's required; keeping things simple is great! But for complicated times, such as when aligning the strings automatically and creating good looking text tables, the mini-language&nbsp;format&nbsp;has more options."}]},{"block_type":"element","block":"k67ev67s","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev67t","search_text":"Write the following script, recipe_format_strings_step1.py , to print an aligned table: ","text_count":88,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write the following script,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe_format_strings_step1.py"}]},{"block_type":"text","content":", to &nbsp;print an aligned table:"}]}]},{"block_type":"element","block":"k67ev67u","search_text":"# INPUT DATA data = [ (1000, 10), (2000, 17), (2500, 170), (2500, -170), ] # Print the header for reference print('REVENUE | PROFIT | PERCENT') # This template aligns and displays the data in the proper format TEMPLATE = '{revenue:>7,} | {profit:>+7} | {percent:>7.2%}' # Print the data rows for revenue, profit in data: row = TEMPLATE.format(revenue=revenue, profit=profit, percent=profit / revenue) print(row)","text_count":411,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# INPUT DATA\ndata = [\n    (1000, 10),\n    (2000, 17),\n    (2500, 170),\n    (2500, -170),\n]\n# Print the header for reference\nprint('REVENUE | PROFIT | PERCENT')\n\n# This template aligns and displays the data in the proper format\nTEMPLATE = '{revenue:&gt;7,} | {profit:&gt;+7} | {percent:&gt;7.2%}'\n\n# Print the data rows\nfor revenue, profit in data:\n    row = TEMPLATE.format(revenue=revenue, profit=profit, percent=profit / revenue)\n    print(row)"}]}]},{"block_type":"element","block":"k67ev67v","search_text":"Run it to display the following aligned table. Note that PERCENT is correctly displayed as a percentage: ","text_count":105,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run it to display the following aligned table. Note that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PERCENT"}]},{"block_type":"text","content":"is correctly displayed as a percentage:"}]}]},{"block_type":"element","block":"k67ev67w","search_text":"REVENUE | PROFIT | PERCENT 1,000 | +10 | 1.00% 2,000 | +17 | 0.85% 2,500 | +170 | 6.80% 2,500 | -170 | -6.80%","text_count":109,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"REVENUE | PROFIT | PERCENT\n  1,000 |    +10 |   1.00%\n  2,000 |    +17 |   0.85%\n  2,500 |   +170 |   6.80%\n  2,500 |   -170 |  -6.80%"}]}]},{"block_type":"element","block":"k67ev67x","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev67y","search_text":"The TEMPLATE constant contains three columns, each one properly named ( REVENUE , PROFIT , PERCENT ). This makes it more explicit and straightforward to apply the template on the format call.","text_count":191,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TEMPLATE"}]},{"block_type":"text","content":"constant contains three columns, each one properly named ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"REVENUE"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PROFIT"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PERCENT"}]},{"block_type":"text","content":"). This makes it more explicit and straightforward to apply the template on the format call."}]},{"block_type":"element","block":"k67ev67z","search_text":"After the name of the parameter, there's a colon that separates the format definition. Note that all inside the curly brackets. In all columns, the format specification sets the width to seven characters and aligns the values to the right with the > symbol:","text_count":257,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After the name of the parameter, there's a colon that separates the format definition. Note that all inside the curly brackets. In all columns, the format specification sets the width to seven characters and aligns the values to the right with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&gt;"}]},{"block_type":"text","content":"&nbsp;symbol:"}]},{"block_type":"element","block":"k67ev680","search_text":"Revenue adds a thousands separator with the , symbol— [{revenue:>7,}] . Profit adds a + sign for positive values. A - for negatives is added automatically— [{profit:>+7}] . Percent displays a percent value, with a precision of two decimal places— [{percent:>7.2%}] . This is done through 0.2 (precision) and adding a % symbol for the percentage. ","text_count":346,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Revenue adds a thousands separator with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":","}]},{"block_type":"text","content":"&nbsp;symbol&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[{revenue:&gt;7,}]"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Profit adds a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"+"}]},{"block_type":"text","content":"&nbsp;sign for positive values. A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-"}]},{"block_type":"text","content":"&nbsp;for negatives is added automatically&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[{profit:&gt;+7}]"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Percent displays a percent value, with a precision of two decimal places&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[{percent:&gt;7.2%}]"}]},{"block_type":"text","content":". This is done through 0.2 (precision) and adding a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"%"}]},{"block_type":"text","content":"&nbsp;symbol for the percentage."}]}]},{"block_type":"element","block":"k67ev681","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev682","search_text":"You may have also seen the available Python formatting with the % operator. While it works for simple formatting, it is less flexible than the formated mini-language, and it is not recommended for use.","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You may have&nbsp;also&nbsp;seen the available Python formatting with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"%"}]},{"block_type":"text","content":"operator. While it works for simple formatting, it is less flexible than the formated mini-language, and it is not recommended for use."}]},{"block_type":"element","block":"k67ev683","search_text":"A great new feature since Python 3.6 is to use f-strings, which perform a format action using defined variables this way:","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A great new feature since Python 3.6 is to use f-strings, which perform a format action using defined variables this way:"}]},{"block_type":"element","block":"k67ev684","search_text":">>> param1 = 'first' >>> param2 = 'second' >>> f'Parameters {param1}:{param2}' 'Parameters first:second'","text_count":104,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; param1 = 'first'\n&gt;&gt;&gt; param2 = 'second'\n&gt;&gt;&gt; f'Parameters {param1}:{param2}'\n'Parameters first:second'"}]}]},{"block_type":"element","block":"k67ev685","search_text":"This simplifies a lot of the code and allows us to create very descriptive and readable code.","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This simplifies a lot of the code and allows us to create very descriptive and readable code."}]},{"block_type":"element","block":"k67ev686","search_text":"Tip Be careful when using f-strings to ensure that the string is replaced at the proper time. A common problem is that the variable defined to be rendered is not yet defined. For example, TEMPLATE , defined previously, won't be defined as an f-string, as revenue and the rest of the parameters are not available at that point. ","text_count":327,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be careful when using f-strings to ensure that the string is replaced at the proper time. A common problem is that the variable defined to be rendered is not yet defined. For example,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TEMPLATE"}]},{"block_type":"text","content":", defined previously, won't be defined as an f-string, as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"revenue"}]},{"block_type":"text","content":"&nbsp;and the rest of the parameters are not available at that point.&nbsp;"}]}]},{"block_type":"element","block":"k67ev687","search_text":"If you need to write a curly bracket, you'll need to repeat it twice. Note that each duplication will be displayed as a single curly bracket, plus a curly bracket for the value replacement, making a total of three brackets:","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to write a curly bracket, you'll need to repeat it twice. Note that each duplication will be displayed as a single curly bracket, plus a curly bracket for the value replacement, making a total of three brackets:"}]},{"block_type":"element","block":"k67ev688","search_text":"value = 'VALUE' >>> f'This is the value, in curly brackets {{{value}}}' 'This is the value, in curly brackets {VALUE}'","text_count":118,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"value = 'VALUE'\n&gt;&gt;&gt; f'This is the value, in curly brackets {{{value}}}'\n'This is the value, in curly brackets {VALUE}'"}]}]},{"block_type":"element","block":"k67ev689","search_text":"This allows us to create meta templates—templates that produce templates. In some cases, that will be useful, but try to limit their use, as they'll get complicated very quickly, producing code that will be difficult to read.","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This allows us to create meta templates&mdash;templates that produce templates. In some cases, that will be useful, but try to limit their use, as they'll get complicated very quickly, producing code that will be difficult to read."}]},{"block_type":"element","block":"k67ev68a","search_text":"The Python Format Specification mini-language has more options than the ones shown here. ","text_count":89,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The Python Format Specification mini-language has more options than the ones shown here.&nbsp;"}]},{"block_type":"element","block":"k67ev68b","search_text":"Tip As the language tries to be quite concise, sometimes it can be difficult to determine the position of the symbols. You may sometimes ask yourself questions like— Is the + symbol before or after than the width parameters.? Read the documentation with care and remember to always include a colon before the format specification. ","text_count":331,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As the language tries to be quite concise, sometimes it can be difficult to determine the position of the symbols. You may sometimes ask yourself questions like&mdash;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Is the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"+"}]},{"block_type":"text","content":"symbol before or after than the width parameters.?"}]},{"block_type":"text","content":"&nbsp;Read the documentation with care and remember to always include a colon before the format specification."}]}]},{"block_type":"element","block":"k67ev68c","search_text":"Please check the full documentation and examples on the Python website ( https://docs.python.org/3/library/string.html#formatspec ).","text_count":132,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please check the full documentation and examples on the Python website ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/string.html#formatspec"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/string.html#formatspec"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev68d","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev68e","search_text":"The Template Reports recipe in Chapter 5, Generating Fantastic Reports The Manipulating strings recipe ","text_count":103,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Template Reports"}]},{"block_type":"text","content":"&nbsp;recipe in&nbsp;Chapter 5,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Manipulating strings"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev68f","search_text":"Manipulating strings","text_count":20,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Manipulating strings"}]},{"block_type":"element","block":"k67ev68g","search_text":"A basic ability when dealing with text is to be able to properly manipulate that text. That means to be able to join it, split it into regular chunks, or change it to be uppercase or lowercase. We'll discuss more advanced methods for parsing text and separating it later, but in lots of cases it is useful to divide a paragraph into lines, sentences, or even words. Other times, words will have to have some characters removed or replaced with a canonical version to be able to compare it with a determined value.","text_count":513,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A basic ability when dealing with text is to be able to properly manipulate that text. That means to be able to join it, split it into regular chunks, or change it to be uppercase or lowercase. We'll discuss more advanced methods for parsing text and separating it later, but in lots of cases it is useful to divide a paragraph into lines, sentences, or even words. Other times, words will have to have some characters removed or replaced with a canonical version to be able to compare it with a determined value."}]},{"block_type":"element","block":"k67ev68h","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev68i","search_text":"We'll define a basic text to transform it into its main components, and then we'll reconstruct it. As an example, a report needs to be transformed into a new format to be sent via email.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll define a basic text to transform it into its main components, and then we'll reconstruct it. As an example, a report needs to be transformed into a new format to be sent via email."}]},{"block_type":"element","block":"k67ev68j","search_text":"The input format we'll use in this example will be this:","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The input format we'll use in this example will be this:"}]},{"block_type":"element","block":"k67ev68k","search_text":"AFTER THE CLOSE OF THE SECOND QUARTER, OUR COMPANY, CASTAÑACORP HAS ACHIEVED A GROWTH IN THE REVENUE OF 7.47%. THIS IS IN LINE WITH THE OBJECTIVES FOR THE YEAR. THE MAIN DRIVER OF THE SALES HAS BEEN THE NEW PACKAGE DESIGNED UNDER THE SUPERVISION OF OUR MARKETING DEPARTMENT. OUR EXPENSES HAS BEEN CONTAINED, INCREASING ONLY BY 0.7%, THOUGH THE BOARD CONSIDERS IT NEEDS TO BE FURTHER REDUCED. THE EVALUATION IS SATISFACTORY AND THE FORECAST FOR THE NEXT QUARTER IS OPTIMISTIC. THE BOARD EXPECTS AN INCREASE IN PROFIT OF AT LEAST 2 MILLION DOLLARS.","text_count":546,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"AFTER THE CLOSE OF THE SECOND QUARTER, OUR COMPANY, CASTA&Ntilde;ACORP\n    HAS ACHIEVED A GROWTH IN THE REVENUE OF 7.47%. THIS IS IN LINE\n    WITH THE OBJECTIVES FOR THE YEAR. THE MAIN DRIVER OF THE SALES HAS BEEN\n    THE NEW PACKAGE DESIGNED UNDER THE SUPERVISION OF OUR MARKETING DEPARTMENT.\n    OUR EXPENSES HAS BEEN CONTAINED, INCREASING ONLY BY 0.7%, THOUGH THE BOARD\n    CONSIDERS IT NEEDS TO BE FURTHER REDUCED. THE EVALUATION IS SATISFACTORY\n    AND THE FORECAST FOR THE NEXT QUARTER IS OPTIMISTIC. THE BOARD EXPECTS\n    AN INCREASE IN PROFIT OF AT LEAST 2 MILLION DOLLARS."}]}]},{"block_type":"element","block":"k67ev68l","search_text":"We need to redact the text to eliminate any references to numbers. It needs to be properly formatted by adding a new line after each period, justified with 80 characters, and transformed into ASCII for compatibility reasons.","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to redact the text to eliminate any references to numbers. It needs to be properly formatted by adding a new line after each period, justified with 80 characters, and transformed into ASCII for compatibility reasons."}]},{"block_type":"element","block":"k67ev68m","search_text":"The text will be stored in the INPUT_TEXT variable in the interpreter.","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The text will be stored in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INPUT_TEXT"}]},{"block_type":"text","content":"variable in the interpreter."}]},{"block_type":"element","block":"k67ev68n","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev68o","search_text":"After entering the text, split it into individual words: ","text_count":57,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"After entering the text, split it into individual words:"}]}]},{"block_type":"element","block":"k67ev68p","search_text":">>> INPUT_TEXT = ''' ... AFTER THE CLOSE OF THE SECOND QUARTER, OUR COMPANY, CASTAÑACORP ... HAS ACHIEVED A GROWTH IN THE REVENUE OF 7.47%. THIS IS IN LINE ... ''' >>> words = INPUT_TEXT.split()","text_count":194,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; INPUT_TEXT = '''\n...     AFTER THE CLOSE OF THE SECOND QUARTER, OUR COMPANY, CASTA&Ntilde;ACORP\n...     HAS ACHIEVED A GROWTH IN THE REVENUE OF 7.47%. THIS IS IN LINE\n...\n'''\n&gt;&gt;&gt; words = INPUT_TEXT.split()"}]}]},{"block_type":"element","block":"k67ev68q","search_text":"Replace any numerical digits with an 'X' character: ","text_count":52,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Replace any numerical digits with an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'X'"}]},{"block_type":"text","content":"&nbsp;character:"}]}]},{"block_type":"element","block":"k67ev68r","search_text":">>> redacted = [''.join('X' if w.isdigit() else w for w in word) for word in words]","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; redacted = [''.join('X' if w.isdigit() else w for w in word) for word in words]"}]}]},{"block_type":"element","block":"k67ev68s","search_text":"Transform the text into pure ASCII (note that the name of the company contains a letter, ñ , which is not ASCII): ","text_count":114,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Transform the text into pure ASCII (note that the name of the company contains a letter,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ntilde;"}]},{"block_type":"text","content":", which is not ASCII):"}]}]},{"block_type":"element","block":"k67ev68t","search_text":">>> ascii_text = [word.encode('ascii', errors='replace').decode('ascii') ... for word in redacted]","text_count":98,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; ascii_text = [word.encode('ascii', errors='replace').decode('ascii')\n...               for word in redacted]"}]}]},{"block_type":"element","block":"k67ev68u","search_text":"Group the words into 80-character lines: ","text_count":41,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Group the words into 80-character lines:"}]}]},{"block_type":"element","block":"k67ev68v","search_text":">>> newlines = [word + '\\n' if word.endswith('.') else word for word in ascii_text] >>> LINE_SIZE = 80 >>> lines = [] >>> line = '' >>> for word in newlines: ... if line.endswith('\\n') or len(line) + len(word) + 1 > LINE_SIZE: ... lines.append(line) ... line = '' ... line = line + ' ' + word","text_count":292,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; newlines = [word + '\\n' if word.endswith('.') else word for word in ascii_text]\n&gt;&gt;&gt; LINE_SIZE = 80\n&gt;&gt;&gt; lines = []\n&gt;&gt;&gt; line = ''\n&gt;&gt;&gt; for word in newlines:\n...     if line.endswith('\\n') or len(line) + len(word) + 1 &gt; LINE_SIZE:\n...         lines.append(line)\n...         line = ''\n...     line = line + ' ' + word"}]}]},{"block_type":"element","block":"k67ev68w","search_text":"Format all lines as titles and join them as a single piece of text: ","text_count":68,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Format all lines as titles and join them as a single piece of text:"}]}]},{"block_type":"element","block":"k67ev68x","search_text":">>> lines = [line.title() for line in lines] >>> result = '\\n'.join(lines)","text_count":74,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; lines = [line.title() for line in lines]\n&gt;&gt;&gt; result = '\\n'.join(lines)"}]}]},{"block_type":"element","block":"k67ev68y","search_text":"Print the result: ","text_count":18,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print the result:"}]}]},{"block_type":"element","block":"k67ev68z","search_text":">>> print(result) After The Close Of The Second Quarter, Our Company, Casta?Acorp Has Achieved A Growth In The Revenue Of X.Xx%. This Is In Line With The Objectives For The Year. The Main Driver Of The Sales Has Been The New Package Designed Under The Supervision Of Our Marketing Department. Our Expenses Has Been Contained, Increasing Only By X.X%, Though The Board Considers It Needs To Be Further Reduced. The Evaluation Is Satisfactory And The Forecast For The Next Quarter Is Optimistic.","text_count":493,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; print(result)\n After The Close Of The Second Quarter, Our Company, Casta?Acorp Has Achieved A\n Growth In The Revenue Of X.Xx%.\n\n This Is In Line With The Objectives For The Year.\n\n The Main Driver Of The Sales Has Been The New Package Designed Under The\n Supervision Of Our Marketing Department.\n\n Our Expenses Has Been Contained, Increasing Only By X.X%, Though The Board\n Considers It Needs To Be Further Reduced.\n\n The Evaluation Is Satisfactory And The Forecast For The Next Quarter Is\n Optimistic."}]}]},{"block_type":"element","block":"k67ev690","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev691","search_text":"Each of the steps performs a specific transformation of the text:","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the steps performs a specific transformation of the text:"}]},{"block_type":"element","block":"k67ev692","search_text":"The first one splits the text on the default separators, whitespaces, and new lines. This splits it into individual words with no lines or multiple spaces for separation. To replace the digits, we go through every character of each word. For each one, if it's a digit, an 'X' is returned instead. This is done with two list comprehensions, one to run on the list, and another on each word, replacing only if there's a digit— ['X' if w.isdigit() else w for w in word] . Note that the words are joined together again. Each of the words is encoded into an ASCII byte sequence and decoded back again into the Python string type. Note the use of the errors parameter to force the replacement of unknown characters such as ñ . ","text_count":721,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The first one splits the text on the default separators, whitespaces, and new lines. This splits it into individual words with no lines or multiple spaces for separation.&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To replace the digits, we go through every character of each word. For each one, if it's a digit, an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'X'"}]},{"block_type":"text","content":"is returned instead. This is done with two list comprehensions, one to run on the list, and another on each word, replacing only if there's a digit&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"['X' if w.isdigit() else w for w in word]"}]},{"block_type":"text","content":". Note that the words are joined together again."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Each of the words is encoded into an ASCII byte sequence and decoded back again into the Python string type. Note the use of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"errors"}]},{"block_type":"text","content":"&nbsp;parameter to force the replacement of unknown characters such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&ntilde;"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev693","search_text":"Tip The difference between strings and bytes is not very intuitive at first, especially if you never have to worry about multiple languages or encoding transformation. In Python 3, there's a strong separation between strings (internal Python representation) and bytes, so most of the tools applicable to strings won't be available in byte objects. Unless you have a good idea of why you need a byte object, always work with Python strings. If you need to perform transformations like the one in this task, encode and decode in the same line so that you keep your objects in the comfortable realm of Python strings. If you are interested in learning more about encodings, you can check out this brief article ( https://eli.thegreenplace.net/2012/01/30/the-bytesstr-dichotomy-in-python-3 ) and this other longer and more detailed one ( http://www.diveintopython3.net/strings.html ). ","text_count":881,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The difference between strings and bytes is not very intuitive at first, especially if you never have to worry about multiple languages or encoding transformation.&nbsp;In Python 3, there's a strong separation between strings (internal Python representation) and bytes, so most of the tools applicable to strings won't be available in byte objects. Unless you have a good idea of why you need a byte object, always&nbsp;work&nbsp;with Python strings. If you need to perform transformations like the one in this task, encode and decode in the same line so that you keep your objects in the comfortable&nbsp;realm of Python strings. If you are interested in learning more about encodings, you can check out this brief article ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://eli.thegreenplace.net/2012/01/30/the-bytesstr-dichotomy-in-python-3"},"children":[{"block_type":"text","content":"https://eli.thegreenplace.net/2012/01/30/the-bytesstr-dichotomy-in-python-3"}]},{"block_type":"text","content":") and this other longer and more detailed one ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.diveintopython3.net/strings.html"},"children":[{"block_type":"text","content":"http://www.diveintopython3.net/strings.html"}]},{"block_type":"text","content":")."}]}]},{"block_type":"element","block":"k67ev694","search_text":"This step first adds an extra newline character (the \\n character) for all words ending with a period. This marks the different paragraphs. After that, it creates a line and adds the words one by one. If an extra word will make it go over 80 characters, it finishes the line and starts a new one. If the line already ends with a new line, it finishes it and starts another one as well. Note that there's an extra space added to separate the words. Finally, each of the lines is capitalized as a Title (the first letter of each word is upper cased) and all the lines are joined through new lines. ","text_count":596,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"This step first adds an extra newline character (the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\n"}]},{"block_type":"text","content":"&nbsp;character) for all words ending with a period. This marks the different paragraphs. After that, it creates a line and adds the words one by one. If an extra word will make it go over 80 characters, it finishes the line and starts a new one. If the line already ends with a new line, it finishes it and starts another one as well. Note that there's an extra space added to separate the words."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, each of the lines is capitalized as a Title (the first letter of each word is upper cased) and all the lines are joined through new lines."}]}]},{"block_type":"element","block":"k67ev695","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev696","search_text":"Some other useful operations that can be performed on strings are as follows:","text_count":77,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some other useful operations that can be performed on strings are as follows:"}]},{"block_type":"element","block":"k67ev697","search_text":"Strings can be sliced like any other list. This means that 'word'[0:2] will return 'wo' . Use .splitlines() to separate lines by newline character. There are .upper() and .lower() methods, which return a copy with all the characters set to uppercase or lowercase. Their use is very similar to .title() : ","text_count":304,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Strings can be sliced like any other list. This means that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'word'[0:2]"}]},{"block_type":"text","content":"will return"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'wo'"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".splitlines()"}]},{"block_type":"text","content":"to separate lines by newline character."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There are"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".upper()"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".lower()"}]},{"block_type":"text","content":"methods, which return a copy with all the characters set to uppercase or lowercase. Their use is very similar to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".title()"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev698","search_text":">>> 'UPPERCASE'.lower() 'uppercase'","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; 'UPPERCASE'.lower()\n'uppercase'"}]}]},{"block_type":"element","block":"k67ev699","search_text":"For easy replacements (for example, change all A to B or change mine to ours ), use .replace() . This method is useful for very simple cases, but replacements can get tricky easily. Be careful with the order of replacements to avoid collisions and case sensitivity issues. Note the wrong replacement in the following example: ","text_count":326,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"For easy replacements (for example, change all"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A"}]},{"block_type":"text","content":"&nbsp;to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B"}]},{"block_type":"text","content":"&nbsp;or change"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mine"}]},{"block_type":"text","content":"&nbsp;to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ours"}]},{"block_type":"text","content":"), use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".replace()"}]},{"block_type":"text","content":". This method is useful for very simple cases, but replacements can get tricky easily. Be careful with the order of replacements to avoid collisions and case sensitivity issues. Note the wrong replacement in the following example:"}]}]},{"block_type":"element","block":"k67ev69a","search_text":">>> 'One ring to rule them all, one ring to find them, One ring to bring them all and in the darkness bind them.'.replace('ring', 'necklace') 'One necklace to rule them all, one necklace to find them, One necklace to bnecklace them all and in the darkness bind them.'","text_count":267,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; 'One ring to rule them all, one ring to find them, One ring to bring them all and in the darkness bind them.'.replace('ring', 'necklace')\n'One necklace to rule them all, one necklace to find them, One necklace to bnecklace them all and in the darkness bind them.'"}]}]},{"block_type":"element","block":"k67ev69b","search_text":"This is similar to the issues we'll see with regular expressions matching unexpected parts of your code.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This&nbsp;is similar to the issues we'll see with regular expressions matching unexpected parts of your code."}]},{"block_type":"element","block":"k67ev69c","search_text":"Note There are more examples to follow later. Refer to the regular expressions recipes for more information. ","text_count":109,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are more examples to follow later. Refer to the regular expressions recipes for more information."}]}]},{"block_type":"element","block":"k67ev69d","search_text":"If you work with multiple languages, or with any kind of non-English input, it is very useful to learn the basics of Unicode and encodings. In a nutshell, given the vast amount of characters in all the different languages in the world, including alphabets not related to the Latin one, such as Chinese or Arabic, there's a standard to try and cover all of them so that computers can properly understand them. Python 3 greatly improved this situation, making the strings internal objects to deal with all of those characters. The encoding that Python uses, and the most common and compatible one, is currently UTF-8.","text_count":615,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you work with multiple languages, or with any kind of non-English input, it is very useful to learn the basics of Unicode and encodings. In a nutshell, given the vast amount of characters in all the different languages in the world, including alphabets not related to the Latin one, such as Chinese or Arabic, there's a standard to try and cover all of them so that computers can properly understand them.&nbsp;Python 3 greatly improved this situation, making the strings internal objects to deal with all of those characters.&nbsp;The encoding that Python uses, and the most common and compatible one, is currently UTF-8."}]},{"block_type":"element","block":"k67ev69e","search_text":"Note A good article to learn about the basics of UTF-8 is this blog post: ( https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/ ). ","text_count":244,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A good article to learn about the basics of UTF-8 is this blog post: ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/"},"children":[{"block_type":"text","content":"https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/"}]},{"block_type":"text","content":")."}]}]},{"block_type":"element","block":"k67ev69f","search_text":"Dealing with encodings is still relevant when reading from external files that can be encoded in different encodings (for example, CP-1252 or windows-1252, which is a common encoding produced by legacy Microsoft systems, or ISO 8859-15, which is the industry standard). ","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Dealing with encodings is still relevant when reading from external files that can be encoded in different encodings (for example,&nbsp;CP-1252 or windows-1252, which is a common encoding produced by legacy Microsoft systems, or ISO 8859-15, which is the industry standard).&nbsp;"}]},{"block_type":"element","block":"k67ev69g","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev69h","search_text":"The Creating strings with formatted values recipe The Introducing regular expressions recipe The Going deeper into regular expressions recipe The Dealing with Encodings recipe in Chapter 4, Searching and Reading Local Files ","text_count":224,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating strings with formatted values"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Going deeper into regular expressions"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Encodings"}]},{"block_type":"text","content":"recipe in Chapter 4,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]}]}]},{"block_type":"element","block":"k67ev69i","search_text":"Extracting data from structured strings","text_count":39,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Extracting data from structured strings"}]},{"block_type":"element","block":"k67ev69j","search_text":"In a lot of automated tasks, we'll need to treat input text that's in a particular format and extract the relevant information. For example, a spreadsheet may define a percentage in text (such as 37.4%) that we want to retrieve in numerical format to apply it later (0.374, as a float).","text_count":286,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In a lot of automated tasks, we'll need to treat input text that's in a particular format and extract the relevant information. For example, a spreadsheet may define a percentage in text (such as 37.4%) that we want to retrieve in numerical format to apply it later (0.374, as a float)."}]},{"block_type":"element","block":"k67ev69k","search_text":"In this recipe, we'll see how to process sale logs that contain inline information about a product, such as sold, price, profit, and some other information.","text_count":156,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to process sale logs that contain inline information about a product, such as sold, price, profit, and some other information."}]},{"block_type":"element","block":"k67ev69l","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev69m","search_text":"Imagine that we need to parse information stored in sales logs. We'll use a sales log with the following structure:","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Imagine that we need to parse information stored in sales logs. We'll use a sales log with the following structure:"}]},{"block_type":"element","block":"k67ev69n","search_text":"[<Timestamp in iso format>] - SALE - PRODUCT: <product id> - PRICE: $<price of the sale>","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[&lt;Timestamp in iso format&gt;] - SALE - PRODUCT: &lt;product id&gt; - PRICE: $&lt;price of the sale&gt;"}]}]},{"block_type":"element","block":"k67ev69o","search_text":"For example, a specific log may look like this:","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, a specific log may look like this:"}]},{"block_type":"element","block":"k67ev69p","search_text":"[2018-05-05T10:58:41.504054] - SALE - PRODUCT: 1345 - PRICE: $09.99","text_count":67,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[2018-05-05T10:58:41.504054] - SALE - PRODUCT: 1345 - PRICE: $09.99"}]}]},{"block_type":"element","block":"k67ev69q","search_text":"Note that the price has a leading zero. All prices will have two digits for the dollars, and two for the cents.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the price has a leading zero. All prices will have two digits for the dollars, and two for&nbsp;the cents."}]},{"block_type":"element","block":"k67ev69r","search_text":"We need to activate our virtual environment before we start:","text_count":60,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to activate our virtual environment before we start:"}]},{"block_type":"element","block":"k67ev69s","search_text":"$ source .venv/bin/activate","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ source .venv/bin/activate"}]}]},{"block_type":"element","block":"k67ev69t","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev69u","search_text":"In the Python interpreter, make the following imports. Remember to activate your virtualenv , as described in the Creating a virtual environment recipe: ","text_count":153,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the Python interpreter, make the following imports. Remember to activate your"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"virtualenv"}]},{"block_type":"text","content":",&nbsp; as described in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"text","content":"&nbsp;recipe:"}]}]},{"block_type":"element","block":"k67ev69v","search_text":">>> import delorean >>> from decimal import Decimal","text_count":51,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import delorean\n&gt;&gt;&gt; from decimal import Decimal"}]}]},{"block_type":"element","block":"k67ev69w","search_text":"Enter the log to parse: ","text_count":24,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enter the log to parse:"}]}]},{"block_type":"element","block":"k67ev69x","search_text":">>> log = '[2018-05-05T11:07:12.267897] - SALE - PRODUCT: 1345 - PRICE: $09.99'","text_count":79,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; log = '[2018-05-05T11:07:12.267897] - SALE - PRODUCT: 1345 - PRICE: $09.99'"}]}]},{"block_type":"element","block":"k67ev69y","search_text":"Split the log into its parts, which are divided by - (note the space before and after the dash). We ignore the SALE part as it doesn't add any relevant information: ","text_count":165,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Split the log into its parts, which are divided by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&nbsp;-"}]},{"block_type":"text","content":"&nbsp;(note the space before and after the dash). We ignore the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SALE"}]},{"block_type":"text","content":"&nbsp;part&nbsp;as it doesn't add any relevant information:"}]}]},{"block_type":"element","block":"k67ev69z","search_text":">>> divide_it = log.split(' - ') >>> timestamp_string, _, product_string, price_string = divide_it","text_count":98,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; divide_it = log.split(' - ')\n&gt;&gt;&gt; timestamp_string, _, product_string, price_string = divide_it"}]}]},{"block_type":"element","block":"k67ev6a0","search_text":"Parse the timestamp into a datetime object: ","text_count":44,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"timestamp"}]},{"block_type":"text","content":"into a datetime object:"}]}]},{"block_type":"element","block":"k67ev6a1","search_text":">>> timestamp = delorean.parse(tmp_string.strip('[]'))","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; timestamp = delorean.parse(tmp_string.strip('[]'))"}]}]},{"block_type":"element","block":"k67ev6a2","search_text":"Parse the product_id into a integer: ","text_count":37,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"product_id"}]},{"block_type":"text","content":"&nbsp;into a integer:"}]}]},{"block_type":"element","block":"k67ev6a3","search_text":">>> product_id = int(product_string.split(':')[-1])","text_count":51,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; product_id = int(product_string.split(':')[-1])"}]}]},{"block_type":"element","block":"k67ev6a4","search_text":"Parse the price into a Decimal type: ","text_count":37,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse the price into a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"type:"}]}]},{"block_type":"element","block":"k67ev6a5","search_text":">>> price = Decimal(price_string.split('$')[-1])","text_count":48,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; price = Decimal(price_string.split('$')[-1])"}]}]},{"block_type":"element","block":"k67ev6a6","search_text":"Now, you have all the values in native Python formats: ","text_count":55,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Now, you have all the values in native Python formats:"}]}]},{"block_type":"element","block":"k67ev6a7","search_text":"timestamp, product_id, price (Delorean(datetime=datetime.datetime(2018, 5, 5, 11, 7, 12, 267897), timezone='UTC'), 1345, Decimal('9.99'))","text_count":137,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"timestamp, product_id, price\n(Delorean(datetime=datetime.datetime(2018, 5, 5, 11, 7, 12, 267897), timezone='UTC'), 1345, Decimal('9.99'))"}]}]},{"block_type":"element","block":"k67ev6a8","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6a9","search_text":"The basic working of this is to isolate each of the elements and then parse them in to the proper type. The first step is to split the full log into smaller parts. The - string is a good divider, as it splits it into four parts—a timestamp one, one with just the word SALE , the product, and the price.","text_count":302,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic working of this is to isolate each of the elements and then parse them in to the proper type. The first step is to split the full log into smaller parts. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-"}]},{"block_type":"text","content":"&nbsp;string&nbsp;is a good divider, as it splits it into four parts&mdash;a timestamp one, one with just the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SALE"}]},{"block_type":"text","content":", the product, and the price."}]},{"block_type":"element","block":"k67ev6aa","search_text":"In the case of the timestamp, we need to isolate the ISO format, which is in brackets in the log. That's why it's stripped off the brackets. We use the delorean module (introduced earlier) to parse it in to a datetime object.","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the case of the timestamp, we need to isolate the ISO format, which is in brackets in the log. That's why it's stripped off the brackets. We use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"&nbsp;module&nbsp;(introduced earlier) to parse it in to a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":"object."}]},{"block_type":"element","block":"k67ev6ab","search_text":"The word SALE is ignored. There's no relevant information there.","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SALE"}]},{"block_type":"text","content":"&nbsp;is ignored. There's no relevant information there."}]},{"block_type":"element","block":"k67ev6ac","search_text":"To isolate the product ID, we split the product part at the colon. Then, we parse the last element as an integer:","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To isolate the product ID, we split the product part at the colon. Then, we parse the last element as an integer:"}]},{"block_type":"element","block":"k67ev6ad","search_text":">>> product_string.split(':') ['PRODUCT', ' 1345'] >>> int(' 1345') 1345","text_count":72,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; product_string.split(':')\n['PRODUCT', ' 1345']\n&gt;&gt;&gt; int(' 1345')\n1345"}]}]},{"block_type":"element","block":"k67ev6ae","search_text":"To divide the price, we use the dollar sign as a separator, and parse it as a Decimal character:","text_count":96,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To divide the price, we use the dollar sign as a separator, and parse it as a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"character:"}]},{"block_type":"element","block":"k67ev6af","search_text":">>> price_string.split('$') ['PRICE: ', '09.99'] >>> Decimal('09.99') Decimal('9.99')","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; price_string.split('$')\n['PRICE: ', '09.99']\n&gt;&gt;&gt; Decimal('09.99')\nDecimal('9.99')"}]}]},{"block_type":"element","block":"k67ev6ag","search_text":"As described in the next section, do not parse this value into a float type.","text_count":76,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As described in the next section, do not parse this value into a float type."}]},{"block_type":"element","block":"k67ev6ah","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6ai","search_text":"These log elements can be combined together into a single object, helping with parsing and aggregating them. For example, we could define a class in Python code in the following way:","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These log elements can be combined together into a single object, helping with parsing and aggregating them. For example, we could define a class in Python code in the following way:"}]},{"block_type":"element","block":"k67ev6aj","search_text":"class PriceLog(object): def __init__(self, timestamp, product_id, price): self.timestamp = timestamp self.product_id = product_id self.price = price def __repr__(self): return '<PriceLog ({}, {}, {})>'.format(self.timestamp, self.product_id, self.price) @classmethod def parse(cls, text_log): ''' Parse from a text log with the format [<Timestamp>] - SALE - PRODUCT: <product id> - PRICE: $<price> to a PriceLog object ''' divide_it = text_log.split(' - ') tmp_string, _, product_string, price_string = divide_it timestamp = delorean.parse(tmp_string.strip('[]')) product_id = int(product_string.split(':')[-1]) price = Decimal(price_string.split('$')[-1]) return cls(timestamp=timestamp, product_id=product_id, price=price)","text_count":724,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class PriceLog(object):\n  def __init__(self, timestamp, product_id, price):\n    self.timestamp = timestamp\n    self.product_id = product_id\n    self.price = price\n  def __repr__(self):\n    return '&lt;PriceLog ({}, {}, {})&gt;'.format(self.timestamp,\n                                            self.product_id,\n                                            self.price)\n  @classmethod\n  def parse(cls, text_log):\n    '''\n    Parse from a text log with the format\n    [&lt;Timestamp&gt;] - SALE - PRODUCT: &lt;product id&gt; - PRICE: $&lt;price&gt;\n    to a PriceLog object\n    '''\n    divide_it = text_log.split(' - ')\n    tmp_string, _, product_string, price_string = divide_it\n    timestamp = delorean.parse(tmp_string.strip('[]'))\n    product_id = int(product_string.split(':')[-1])\n    price = Decimal(price_string.split('$')[-1])\n    return cls(timestamp=timestamp, product_id=product_id, price=price)"}]}]},{"block_type":"element","block":"k67ev6ak","search_text":"So, the parsing can be done as follows:","text_count":39,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So, the parsing can be done as follows:"}]},{"block_type":"element","block":"k67ev6al","search_text":">>> log = '[2018-05-05T12:58:59.998903] - SALE - PRODUCT: 897 - PRICE: $17.99' >>> PriceLog.parse(log) <PriceLog (Delorean(datetime=datetime.datetime(2018, 5, 5, 12, 58, 59, 998903), timezone='UTC'), 897, 17.99)>","text_count":212,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; log = '[2018-05-05T12:58:59.998903] - SALE - PRODUCT: 897 - PRICE: $17.99'\n&gt;&gt;&gt; PriceLog.parse(log)\n&lt;PriceLog (Delorean(datetime=datetime.datetime(2018, 5, 5, 12, 58, 59, 998903), timezone='UTC'), 897, 17.99)&gt;"}]}]},{"block_type":"element","block":"k67ev6am","search_text":"Avoid using float types for prices. Floats numbers have precision problems that may produce strange errors when aggregating multiple prices, for example:","text_count":153,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Avoid using float types for prices. Floats numbers have precision problems that may produce strange errors when aggregating multiple prices, for example:"}]},{"block_type":"element","block":"k67ev6an","search_text":">>> 0.1 + 0.1 + 0.1 0.30000000000000004","text_count":39,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; 0.1 + 0.1 + 0.1 \n0.30000000000000004"}]}]},{"block_type":"element","block":"k67ev6ao","search_text":"Try these two options to avoid problems:","text_count":40,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Try these two options to avoid problems:"}]},{"block_type":"element","block":"k67ev6ap","search_text":"Use integer cents as the base unit : This means multiplying currency inputs by 100 and transforming them into integers (or whatever fractional unit is correct for the currency used). You may still want to change the base when displaying them. Parse into the Decimal type : The Decimal type keeps the fixed precision and works as you'd expect. You can find further information about the Decimal type in the Python docs at https://docs.python.org/3.6/library/decimal.html . ","text_count":472,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Use integer cents as the base unit"}]},{"block_type":"text","content":": This&nbsp;means multiplying currency inputs by 100 and transforming them into integers (or whatever fractional unit is correct for the currency&nbsp;used). You may still want to change the base when displaying them."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Parse into the Decimal type"}]},{"block_type":"text","content":": The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"type keeps the fixed&nbsp;precision and works as you'd expect. You can find further information about the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"type in the Python docs at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.6/library/decimal.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3.6/library/decimal.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6aq","search_text":"Tip If you use the Decimal type, parse the results directly into Decimal from the string. If transforming it first into a float, you can carry the precision errors to the new type. ","text_count":181,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"type, parse the results directly into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"from the string. If transforming it first into a float, you can carry the precision errors to the new type."}]}]},{"block_type":"element","block":"k67ev6ar","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6as","search_text":"The Creating a virtual environment recipe The Using a third-party tool—parse recipe The Introducing regular expressions recipe The Going deeper into regular expressions recipe ","text_count":176,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Going deeper into regular expressions"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6at","search_text":"Using a third-party tool—parse","text_count":30,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"element","block":"k67ev6au","search_text":"While manually parsing data, as seen in the previous recipe, works very well for small strings, it can be very laborious to tweak the exact formula to work with a variety of input. What if the input has an extra dash sometimes? Or it has a variable length header depending on the size of one of the fields?","text_count":306,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While manually parsing data, as seen in the previous recipe, works very well for small strings, it can be very laborious to tweak the&nbsp;exact&nbsp;formula to work with a variety of input. What if the input has an extra dash sometimes? Or it has a variable length header depending on the size of one of the fields?"}]},{"block_type":"element","block":"k67ev6av","search_text":"A more advanced option is to use regular expressions, as we'll see in the next recipe. But there's a great module in Python called parse ( https://github.com/r1chardj0n3s/parse ) that allows us to reverse format strings. It is a fantastic tool, that's powerful, easy to use, and greatly improves the readability of the code.","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A more advanced option is to use regular expressions, as we'll see in the next recipe. But there's a great module in Python called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"&nbsp;("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/r1chardj0n3s/parse"},"children":[{"block_type":"text","content":"https://github.com/r1chardj0n3s/parse"}]},{"block_type":"text","content":") that allows us to reverse format strings. It is a fantastic tool, that's powerful, easy to use, and&nbsp;greatly&nbsp;improves the readability of the code."}]},{"block_type":"element","block":"k67ev6aw","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ax","search_text":"Add the parse module to the requirements.txt file in our virtual environment and reinstall the dependencies, as shown in the Creating a virtual environment recipe.","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Add the parse module to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file in our virtual environment and reinstall the dependencies, as shown in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"text","content":"&nbsp;recipe."}]},{"block_type":"element","block":"k67ev6ay","search_text":"The requirements.txt file should look like this:","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file should look like this:"}]},{"block_type":"element","block":"k67ev6az","search_text":"delorean==1.0.0 requests==2.18.3 parse==1.8.2","text_count":45,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"delorean==1.0.0\nrequests==2.18.3\nparse==1.8.2"}]}]},{"block_type":"element","block":"k67ev6b0","search_text":"Then, reinstall the modules in the virtual environment:","text_count":55,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then,&nbsp;reinstall&nbsp;the modules in the virtual environment:"}]},{"block_type":"element","block":"k67ev6b1","search_text":"$ pip install -r requirements.txt ... Collecting parse==1.8.2 (from -r requirements.txt (line 3)) Using cached https://files.pythonhosted.org/packages/13/71/e0b5c968c552f75a938db18e88a4e64d97dc212907b4aca0ff71293b4c80/parse-1.8.2.tar.gz ... Installing collected packages: parse Running setup.py install for parse ... done Successfully installed parse-1.8.2","text_count":356,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ pip install -r requirements.txt\n...\nCollecting parse==1.8.2 (from -r requirements.txt (line 3))\n  Using cached https://files.pythonhosted.org/packages/13/71/e0b5c968c552f75a938db18e88a4e64d97dc212907b4aca0ff71293b4c80/parse-1.8.2.tar.gz\n...\nInstalling collected packages: parse\n  Running setup.py install for parse ... done\nSuccessfully installed parse-1.8.2"}]}]},{"block_type":"element","block":"k67ev6b2","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6b3","search_text":"Import the parse function: ","text_count":27,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"function:"}]}]},{"block_type":"element","block":"k67ev6b4","search_text":">>> from parse import parse","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from parse import parse"}]}]},{"block_type":"element","block":"k67ev6b5","search_text":"Define the log to parse, in the same format as in the Extracting data from structured strings recipe: ","text_count":102,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the log to parse, in the same format as in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Extracting data from structured strings"}]},{"block_type":"text","content":"recipe:"}]}]},{"block_type":"element","block":"k67ev6b6","search_text":">>> LOG = '[2018-05-06T12:58:00.714611] - SALE - PRODUCT: 1345 - PRICE: $09.99'","text_count":79,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; LOG = '[2018-05-06T12:58:00.714611] - SALE - PRODUCT: 1345 - PRICE: $09.99'"}]}]},{"block_type":"element","block":"k67ev6b7","search_text":"Analyze it and describe it as you'll do when trying to print it, like this: ","text_count":76,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Analyze it and describe it as you'll do when trying to print it, like this:"}]}]},{"block_type":"element","block":"k67ev6b8","search_text":">>> FORMAT = '[{date}] - SALE - PRODUCT: {product} - PRICE: ${price}'","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; FORMAT = '[{date}] - SALE - PRODUCT: {product} - PRICE: ${price}'"}]}]},{"block_type":"element","block":"k67ev6b9","search_text":"Run parse and check the results: ","text_count":33,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"and check the results:"}]}]},{"block_type":"element","block":"k67ev6ba","search_text":">>> result = parse(FORMAT, LOG) >>> result <Result () {'date': '2018-05-06T12:58:00.714611', 'product': '1345', 'price': '09.99'}> >>> result['date'] '2018-05-06T12:58:00.714611' >>> result['product'] '1345' >>> result['price'] '09.99'","text_count":235,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; result = parse(FORMAT, LOG)\n&gt;&gt;&gt; result\n&lt;Result () {'date': '2018-05-06T12:58:00.714611', 'product': '1345', 'price': '09.99'}&gt;\n&gt;&gt;&gt; result['date']\n'2018-05-06T12:58:00.714611'\n&gt;&gt;&gt; result['product']\n'1345'\n&gt;&gt;&gt; result['price']\n'09.99'"}]}]},{"block_type":"element","block":"k67ev6bb","search_text":"Note the results are all strings. Define the types to be parsed: ","text_count":65,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Note the results are all strings. Define the types to be parsed:"}]}]},{"block_type":"element","block":"k67ev6bc","search_text":">>> FORMAT = '[{date:ti}] - SALE - PRODUCT: {product:d} - PRICE: ${price:05.2f}'","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; FORMAT = '[{date:ti}] - SALE - PRODUCT: {product:d} - PRICE: ${price:05.2f}'"}]}]},{"block_type":"element","block":"k67ev6bd","search_text":"Parse once again: ","text_count":18,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse once again:"}]}]},{"block_type":"element","block":"k67ev6be","search_text":"result = parse(FORMAT, LOG) >>> result <Result () {'date': datetime.datetime(2018, 5, 6, 12, 58, 0, 714611), 'product': 1345, 'price': 9.99}> >>> result['date'] datetime.datetime(2018, 5, 6, 12, 58, 0, 714611) >>> result['product'] 1345 >>> result['price'] 9.99","text_count":261,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"result = parse(FORMAT, LOG)\n&gt;&gt;&gt; result\n&lt;Result () {'date': datetime.datetime(2018, 5, 6, 12, 58, 0, 714611), 'product': 1345, 'price': 9.99}&gt;\n&gt;&gt;&gt; result['date']\ndatetime.datetime(2018, 5, 6, 12, 58, 0, 714611)\n&gt;&gt;&gt; result['product']\n1345\n&gt;&gt;&gt; result['price']\n9.99"}]}]},{"block_type":"element","block":"k67ev6bf","search_text":"Define a custom type for the price to avoid issues with the float type: ","text_count":72,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define a custom type for the price to avoid issues with the float type:"}]}]},{"block_type":"element","block":"k67ev6bg","search_text":">>> from decimal import Decimal >>> def price(string): ... return Decimal(string) ... >>> FORMAT = '[{date:ti}] - SALE - PRODUCT: {product:d} - PRICE: ${price:price}' >>> parse(FORMAT, LOG, {'price': price}) <Result () {'date': datetime.datetime(2018, 5, 6, 12, 58, 0, 714611), 'product': 1345, 'price': Decimal('9.99')}>","text_count":321,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from decimal import Decimal\n&gt;&gt;&gt; def price(string):\n...   return Decimal(string)\n...\n&gt;&gt;&gt; FORMAT = '[{date:ti}] - SALE - PRODUCT: {product:d} - PRICE: ${price:price}'\n&gt;&gt;&gt; parse(FORMAT, LOG, {'price': price})\n&lt;Result () {'date': datetime.datetime(2018, 5, 6, 12, 58, 0, 714611), 'product': 1345, 'price': Decimal('9.99')}&gt;"}]}]},{"block_type":"element","block":"k67ev6bh","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6bi","search_text":"The parse module allows us to define a format, such as string, that reverses the format method when parsing values. A lot of the concepts that we discussed when creating strings applies here—put values in brackets, define the type after a colon, and so on.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"module allows us to define a format, such as string, that reverses the format method when parsing values. A lot of the concepts that we discussed when creating strings applies here&mdash;put values in brackets, define the type after a colon, and so on."}]},{"block_type":"element","block":"k67ev6bj","search_text":"By default, as seen in step 4, the values are parsed as strings. This is a good starting point when analyzing text. The values can be parsed into more useful native types, as shown in steps 5 and 6 in the How to do it... section. Please note that while most of the parsing types are the same as the ones in the Python Format Specification mini-language, there are some others available, such as ti for timestamps in ISO format. ","text_count":428,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By default, as seen in step 4, the values are parsed as strings. This is a good starting point when analyzing text. The values can be parsed into more useful native types, as shown in steps 5 and 6 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":"section. Please note that while most of the parsing types are the same as the ones in the Python Format Specification mini-language, there are some others available, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ti"}]},{"block_type":"text","content":"for timestamps in ISO format.&nbsp;"}]},{"block_type":"element","block":"k67ev6bk","search_text":"If native types are not enough, our own parsing can be defined, as demonstrated in step 7 in the How to do it... section. Note that the definition of the price function gets a string and returns the proper format, in this case a Decimal type.","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If native types are not enough, our own parsing can be defined, as demonstrated in step 7 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":"section. Note that the definition of the price function gets a string and returns the proper format, in this case a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"type."}]},{"block_type":"element","block":"k67ev6bl","search_text":"Note All the issues about floats and price information described in the There's more section of the Extracting data from structured strings recipe apply here as well. ","text_count":167,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the issues about floats and price information described in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"There's more"}]},{"block_type":"text","content":"section of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Extracting data from structured strings"}]},{"block_type":"text","content":"&nbsp;recipe&nbsp;apply here as well."}]}]},{"block_type":"element","block":"k67ev6bm","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6bn","search_text":"The timestamp can also be translated into a delorean object for consistency. Also, delorean objects carry over timezone information. Adding the same structure as in the previous recipe gives the following object, which is capable of parsing logs:","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The timestamp can also be translated into a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"object for consistency. Also,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"objects carry over timezone information. Adding the same structure as in the previous recipe gives the following object, which is capable of parsing logs:"}]},{"block_type":"element","block":"k67ev6bo","search_text":"class PriceLog(object): def __init__(self, timestamp, product_id, price): self.timestamp = timestamp self.product_id = product_id self.price = price def __repr__(self): return '<PriceLog ({}, {}, {})>'.format(self.timestamp, self.product_id, self.price) @classmethod def parse(cls, text_log): ''' Parse from a text log with the format [<Timestamp>] - SALE - PRODUCT: <product id> - PRICE: $<price> to a PriceLog object ''' def price(string): return Decimal(string) def isodate(string): return delorean.parse(string) FORMAT = ('[{timestamp:isodate}] - SALE - PRODUCT: {product:d} - ' 'PRICE: ${price:price}') formats = {'price': price, 'isodate': isodate} result = parse.parse(FORMAT, text_log, formats) return cls(timestamp=result['timestamp'], product_id=result['product'], price=result['price'])","text_count":797,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"class PriceLog(object):\n  def __init__(self, timestamp, product_id, price):\n    self.timestamp = timestamp\n    self.product_id = product_id\n    self.price = price\n  def __repr__(self):\n    return '&lt;PriceLog ({}, {}, {})&gt;'.format(self.timestamp,\n                                            self.product_id,\n                                            self.price)\n  @classmethod\n  def parse(cls, text_log):\n    '''\n    Parse from a text log with the format\n    [&lt;Timestamp&gt;] - SALE - PRODUCT: &lt;product id&gt; - PRICE: $&lt;price&gt;\n    to a PriceLog object\n    '''\n    def price(string):\n      return Decimal(string)\n    def isodate(string):\n      return delorean.parse(string)\n    FORMAT = ('[{timestamp:isodate}] - SALE - PRODUCT: {product:d} - '\n              'PRICE: ${price:price}')\n    formats = {'price': price, 'isodate': isodate}\n    result = parse.parse(FORMAT, text_log, formats)\n    return cls(timestamp=result['timestamp'],\n               product_id=result['product'],\n               price=result['price'])"}]}]},{"block_type":"element","block":"k67ev6bp","search_text":"So, parsing it returns similar results:","text_count":39,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"So, parsing it returns similar results:"}]},{"block_type":"element","block":"k67ev6bq","search_text":">>> log = '[2018-05-06T14:58:59.051545] - SALE - PRODUCT: 827 - PRICE: $22.25' >>> PriceLog.parse(log) <PriceLog (Delorean(datetime=datetime.datetime(2018, 6, 5, 14, 58, 59, 51545), timezone='UTC'), 827, 22.25)>","text_count":211,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; log = '[2018-05-06T14:58:59.051545] - SALE - PRODUCT: 827 - PRICE: $22.25'\n&gt;&gt;&gt; PriceLog.parse(log)\n&lt;PriceLog (Delorean(datetime=datetime.datetime(2018, 6, 5, 14, 58, 59, 51545), timezone='UTC'), 827, 22.25)&gt;"}]}]},{"block_type":"element","block":"k67ev6br","search_text":"This code is contained in the GitHub file Chapter01/price_log.py .","text_count":66,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This code is contained in the GitHub file"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter01/price_log.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6bs","search_text":"All parse supported types can be found in the documentation at https://github.com/r1chardj0n3s/parse#format-specification . ","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"&nbsp;supported types can be found in the documentation at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/r1chardj0n3s/parse#format-specification"},"children":[{"block_type":"text","content":"https://github.com/r1chardj0n3s/parse#format-specification"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev6bt","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6bu","search_text":"The Extracting data from structured strings recipe The Introducing regular expressions recipe The Going deeper into regular expressions recipe ","text_count":143,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Extracting data from structured strings"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Going deeper into regular expressions"}]},{"block_type":"text","content":"&nbsp;recipe"}]}]},{"block_type":"element","block":"k67ev6bv","search_text":"Introducing regular expressions","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"element","block":"k67ev6bw","search_text":"A regular expression , or regex , is a pattern to match text. In other words, it allows us to define an abstract string (typically the definition of a structured kind of text) to check with other strings to see if they match or not.","text_count":232,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"regular expression"}]},{"block_type":"text","content":", or"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"regex"}]},{"block_type":"text","content":", is a pattern to"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"match"}]},{"block_type":"text","content":"text. In&nbsp;other words, it allows us to define an"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"abstract string"}]},{"block_type":"text","content":"(typically the definition of a structured kind of text) to check with other strings to see if they match or not."}]},{"block_type":"element","block":"k67ev6bx","search_text":"It is better to describe them with an example. Think of defining a pattern of text as a word that starts with an uppercase A and contains only lowercase Ns and As after that . The word Anna matches it, but Bob , Alice , and James does not. The words Aaan , Ana , Annnn , and Aaaan will also be matches, but ANNA won't.","text_count":318,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is better to describe them with an example. Think of defining a pattern of text as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a word that starts with an uppercase A and contains only lowercase Ns and As after that"}]},{"block_type":"text","content":". The word"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Anna"}]},{"block_type":"text","content":"&nbsp;matches it, but"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Bob"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Alice"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"James&nbsp;"}]},{"block_type":"text","content":"does not. The words"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aaan"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Ana"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Annnn"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aaaan"}]},{"block_type":"text","content":"will also be matches, but"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"ANNA"}]},{"block_type":"text","content":"&nbsp;won't."}]},{"block_type":"element","block":"k67ev6by","search_text":"If this sounds complicated, that's because it is. Regexes can be notoriously complicated because they may be incredibly intricate and difficult to follow. But they are very useful, because they allow us to perform incredibly powerful pattern matching.","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If this sounds complicated, that's because it is. Regexes can be notoriously complicated because they may be incredibly intricate and difficult to follow. But they are very useful, because they allow us to perform incredibly powerful pattern matching."}]},{"block_type":"element","block":"k67ev6bz","search_text":"Some common uses of regexes are as follow:","text_count":42,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some common uses of regexes are as follow:"}]},{"block_type":"element","block":"k67ev6c0","search_text":"Validating input data : For example, that a phone number is only numbers, dashes, and brackets. String parsing : Retrieve data from structured strings, such as logs or URLs. This is similar to what's described in the previous recipe. Scrapping : Find the occurrences of something in a long text. For example, find all emails in a web page. Replacement : Find and replace a word or words with others. For example, replace the owner with John Smith . ","text_count":449,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Validating input data"}]},{"block_type":"text","content":": For example, that a phone number is only numbers, dashes, and brackets."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"String parsing"}]},{"block_type":"text","content":": Retrieve data from structured strings, such as logs or URLs. This is similar to what's described in the previous recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Scrapping"}]},{"block_type":"text","content":": Find the occurrences of something in a long text. For example, find all emails in a web page."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Replacement"}]},{"block_type":"text","content":": Find and replace a word or words with others. For example, replace"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"the owner"}]},{"block_type":"text","content":"&nbsp;with"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"John Smith"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6c1","search_text":"\"Some people, when confronted with a problem, think \"I know, I'll use regular expressions.\" Now they have two problems.\" – Jamie Zawinski ","text_count":138,"tag_name":"blockquote","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"\"Some people, when confronted with a problem, think \"I know, I'll use regular expressions.\" Now they have two problems.\""},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&ndash; Jamie Zawinski"}]}]},{"block_type":"element","block":"k67ev6c2","search_text":"Regular expressions are at their best when they are kept very simple. In general, if there is a specific tool to do it, prefer it over regexes. A very clear example of this is HTML parsing; check Chapter 3, Building Your First Web Scraping Application, for better tools to achieve this.","text_count":286,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Regular expressions are at their best when they are kept very simple.&nbsp;In general, if there is a specific tool to do it, prefer it over regexes. A very clear example of this is HTML parsing; check Chapter 3,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application,"}]},{"block_type":"text","content":"&nbsp;for better tools to achieve this."}]},{"block_type":"element","block":"k67ev6c3","search_text":"Note Some text editors allow us to search using regexes as well. While most are editors aimed at writing code, such as Vim, BBEdit, or Notepad++, they're also present in more general tools, such as MS Office, Open Office, or Google Documents. But be careful, as the particular syntax may be slightly different. ","text_count":311,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some text editors allow us to search using regexes as well. While most are editors aimed at writing code, such as Vim, BBEdit, or Notepad++, they're also present in more general tools, such as MS Office, Open Office, or Google Documents. But be careful, as the particular syntax may be slightly different."}]}]},{"block_type":"element","block":"k67ev6c4","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6c5","search_text":"The python module to deal with regexes is called re . The main function we'll cover is re.search() , which returns a match object with information about what matched the pattern.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"text","content":"module to deal with regexes is called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re"}]},{"block_type":"text","content":". The main function we'll cover is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re.search()"}]},{"block_type":"text","content":", which returns a"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"match&nbsp;"}]},{"block_type":"text","content":"object with information about what matched the pattern."}]},{"block_type":"element","block":"k67ev6c6","search_text":"Note As regex patterns are also defined as strings, we'll differentiate them by prefixing them with an r , such as r'pattern' . This is the Python way of labeling a text as raw string literals, meaning that the string within is taken literally, without any escaping. This means that a \\ is used as a backslash instead of a sequence. For example, without the r prefix, \\n means newline character. ","text_count":396,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As regex patterns are also defined as strings, we'll differentiate them by prefixing them with an"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"r"}]},{"block_type":"text","content":", such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r'pattern'"}]},{"block_type":"text","content":". This is the Python way of labeling a text as raw string literals, meaning that the string within is taken literally, without any escaping. This means that a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\"}]},{"block_type":"text","content":"is used as a backslash instead of a sequence. For example, without the r prefix,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\n"}]},{"block_type":"text","content":"means newline character."}]}]},{"block_type":"element","block":"k67ev6c7","search_text":"Some characters are special, and refer to concepts such as the end of the string , any digit , any character , any whitespace character , and so on.","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some characters are special, and refer to concepts such as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"the end of the string"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"any digit"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"any character"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"any whitespace character"}]},{"block_type":"text","content":", and so on."}]},{"block_type":"element","block":"k67ev6c8","search_text":"The simplest form is just a literal string. For example, the regex pattern r'LOG' matches the string 'LOGS' , but not the string 'NOT A MATCH' . If there's not a match, search returns None :","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;simplest form&nbsp;is just a literal string. For example, the regex pattern"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r'LOG'"}]},{"block_type":"text","content":"matches the string"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'LOGS'"}]},{"block_type":"text","content":", but not the string"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'NOT A MATCH'"}]},{"block_type":"text","content":". If there's not a match, search returns&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6c9","search_text":">>> import re >>> re.search(r'LOG', 'LOGS') <_sre.SRE_Match object; span=(0, 3), match='LOG'> >>> re.search(r'LOG', 'NOT A MATCH') >>>","text_count":134,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import re\n&gt;&gt;&gt; re.search(r'LOG', 'LOGS')\n&lt;_sre.SRE_Match object; span=(0, 3), match='LOG'&gt;\n&gt;&gt;&gt; re.search(r'LOG', 'NOT A MATCH')\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev6ca","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6cb","search_text":"Import the re module: ","text_count":22,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev6cc","search_text":">>> import re","text_count":13,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import re"}]}]},{"block_type":"element","block":"k67ev6cd","search_text":"Then, match a pattern that is not at the start of the string: ","text_count":62,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Then, match a pattern that is not at the start of the string:"}]}]},{"block_type":"element","block":"k67ev6ce","search_text":">>> re.search(r'LOG', 'SOME LOGS') <_sre.SRE_Match object; span=(5, 8), match='LOG'>","text_count":84,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'LOG', 'SOME LOGS')\n&lt;_sre.SRE_Match object; span=(5, 8), match='LOG'&gt;"}]}]},{"block_type":"element","block":"k67ev6cf","search_text":"Match a pattern that is only at the start of the string. Note the ^ character: ","text_count":79,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match a pattern that is only at the start of the string. Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"^"}]},{"block_type":"text","content":"character:"}]}]},{"block_type":"element","block":"k67ev6cg","search_text":">>> re.search(r'^LOG', 'LOGS') <_sre.SRE_Match object; span=(0, 3), match='LOG'> >>> re.search(r'^LOG', 'SOME LOGS') >>>","text_count":120,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'^LOG', 'LOGS')\n&lt;_sre.SRE_Match object; span=(0, 3), match='LOG'&gt;\n&gt;&gt;&gt; re.search(r'^LOG', 'SOME LOGS')\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev6ch","search_text":"Match a pattern only at the end of the string. Note the $ character: ","text_count":69,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match a pattern only at the end of the string. Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"$"}]},{"block_type":"text","content":"character:"}]}]},{"block_type":"element","block":"k67ev6ci","search_text":">>> re.search(r'LOG$', 'SOME LOG') <_sre.SRE_Match object; span=(5, 8), match='LOG'> >>> re.search(r'LOG$', 'SOME LOGS') >>>","text_count":124,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'LOG$', 'SOME LOG')\n&lt;_sre.SRE_Match object; span=(5, 8), match='LOG'&gt;\n&gt;&gt;&gt; re.search(r'LOG$', 'SOME LOGS')\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev6cj","search_text":"Match the word 'thing' (not excluding things ), but not something or anything . Note the \\b at the start of the second pattern: ","text_count":128,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'thing'"}]},{"block_type":"text","content":"(not excluding"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"things"}]},{"block_type":"text","content":"), but not"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"something"}]},{"block_type":"text","content":"&nbsp;or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"anything"}]},{"block_type":"text","content":". Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\b"}]},{"block_type":"text","content":"at the start of the&nbsp;second&nbsp;pattern:"}]}]},{"block_type":"element","block":"k67ev6ck","search_text":">>> STRING = 'something in the things she shows me' >>> match = re.search(r'thing', STRING) >>> STRING[:match.start()], STRING[match.start():match.end()], STRING[match.end():] ('some', 'thing', ' in the things she shows me') >>> match = re.search(r'\\bthing', STRING) >>> STRING[:match.start()], STRING[match.start():match.end()], STRING[match.end():] ('something in the ', 'thing', 's she shows me') ","text_count":400,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; STRING = 'something in the things she shows me'\n&gt;&gt;&gt; match = re.search(r'thing', STRING)\n&gt;&gt;&gt; STRING[:match.start()], STRING[match.start():match.end()], STRING[match.end():]\n('some', 'thing', ' in the things she shows me')\n&gt;&gt;&gt; match = re.search(r'\\bthing', STRING)\n&gt;&gt;&gt; STRING[:match.start()], STRING[match.start():match.end()], STRING[match.end():]\n('something in the ', 'thing', 's she shows me')"}]}]},{"block_type":"element","block":"k67ev6cl","search_text":"Match a pattern that's only numbers and dashes (for example, a phone number). Retrieve the matched string: ","text_count":107,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match a pattern that's only numbers and dashes (for example, a phone number). Retrieve the matched string:"}]}]},{"block_type":"element","block":"k67ev6cm","search_text":">>> re.search(r'[0123456789-]+', 'the phone number is 1234-567-890') <_sre.SRE_Match object; span=(20, 32), match='1234-567-890'> >>> re.search(r'[0123456789-]+', 'the phone number is 1234-567-890').group() '1234-567-890'","text_count":221,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'[0123456789-]+', 'the phone number is 1234-567-890')\n&lt;_sre.SRE_Match object; span=(20, 32), match='1234-567-890'&gt;\n&gt;&gt;&gt; re.search(r'[0123456789-]+', 'the phone number is 1234-567-890').group()\n'1234-567-890'"}]}]},{"block_type":"element","block":"k67ev6cn","search_text":"Match an email address naively: ","text_count":32,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match an email address naively:"}]}]},{"block_type":"element","block":"k67ev6co","search_text":">>> re.search(r'\\S+@\\S+', 'my email is email.123@test.com').group() 'email.123@test.com'","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'\\S+@\\S+', 'my email is email.123@test.com').group()\n'email.123@test.com'"}]}]},{"block_type":"element","block":"k67ev6cp","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6cq","search_text":"The re.search function matches a pattern, no matter its position in the string. As explained previously, this will return None if the pattern is not found, or a match object.","text_count":174,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re.search"}]},{"block_type":"text","content":"&nbsp;function&nbsp;matches a pattern, no matter its position in the string. As explained previously, this will return&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"if the pattern is not found, or a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"match"}]},{"block_type":"text","content":"object."}]},{"block_type":"element","block":"k67ev6cr","search_text":"The following special characters are used:","text_count":42,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following special characters are used:"}]},{"block_type":"element","block":"k67ev6cs","search_text":"^ : Marks the start of the string $ : Marks the end of the string ","text_count":66,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"^"}]},{"block_type":"text","content":": Marks the start of the string"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"$"}]},{"block_type":"text","content":": Marks the end of the string"}]}]},{"block_type":"element","block":"k67ev6ct","search_text":"\\b : Marks the start or end of a word \\S : Marks any character that's not a whitespace, including special characters ","text_count":117,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\b"}]},{"block_type":"text","content":": Marks the start or end of a word"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\S"}]},{"block_type":"text","content":": Marks any character that's not a whitespace, including special characters"}]}]},{"block_type":"element","block":"k67ev6cu","search_text":"More special characters are shown in the next recipe.","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"More special characters are shown in the next recipe."}]},{"block_type":"element","block":"k67ev6cv","search_text":"In step 6 in the How to do it... section, the r'[0123456789-]+' pattern is composed of two parts. The first one is between square brackets, and matches any single character between 0 and 9 (any number) and the dash ( - ) character. The + sign after that means that this character can be present one or more times. This is called a quantifier in regexes. This makes a match on any combination of numbers and dashes, no matter how long it is.","text_count":440,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 6 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"text","content":"section, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r'[0123456789-]+'"}]},{"block_type":"text","content":"&nbsp;pattern&nbsp;is composed of two parts. The first one is between square brackets, and matches any single character between"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"9"}]},{"block_type":"text","content":"(any number) and the dash ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-"}]},{"block_type":"text","content":") character. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"+"}]},{"block_type":"text","content":"sign after that means that this character can be present one or more times. This is called a"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"quantifier"}]},{"block_type":"text","content":"in regexes. This makes a match on any combination of numbers and dashes, no matter how long it is."}]},{"block_type":"element","block":"k67ev6cw","search_text":"Step 7 again uses the + sign to match as many characters as necessary before the @ and again after it. In this case, the character match is \\S , which matches any non-whitespace character.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 7 again uses the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"+"}]},{"block_type":"text","content":"sign to match as many characters as necessary before the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"@"}]},{"block_type":"text","content":"and again after it. In this case, the character match is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\S"}]},{"block_type":"text","content":", which matches any non-whitespace character."}]},{"block_type":"element","block":"k67ev6cx","search_text":"Please note that the naive pattern for emails described here is very naive, as it will match invalid emails such as john@smith@test.com . A better regex for most uses is r\"(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$)\" . You can go to http://emailregex.com/ for find it and links to more information. ","text_count":306,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please note that the naive pattern for emails described here is"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"very"}]},{"block_type":"text","content":"naive, as it will match invalid emails such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"john@smith@test.com"}]},{"block_type":"text","content":". A better regex for most uses is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r\"(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$)\""}]},{"block_type":"text","content":". You can go to&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://emailregex.com/"},"children":[{"block_type":"text","content":"http://emailregex.com/"}]},{"block_type":"text","content":"&nbsp;for find it and links to more information.&nbsp;"}]},{"block_type":"element","block":"k67ev6cy","search_text":"Note Note that parsing a valid email including corner cases is actually a difficult and challenging problem. The previous regex should be fine for most uses covered in this book, but in a general framework project such as Django, email validation is a very long and very unreadable regex. ","text_count":289,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that parsing a valid email including corner cases is actually a difficult and challenging problem. The previous regex should be fine for most uses covered in this book, but in a general framework project such as Django, email validation is a very long and very unreadable regex."}]}]},{"block_type":"element","block":"k67ev6cz","search_text":"The resulting matching object returns the position where the matched pattern starts and ends (using the start and end methods), as shown in step 5, which splits the string into matched parts, showing the distinction between the two matching patterns. ","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The resulting matching object returns the position where the matched pattern starts and ends (using the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"start"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"end"}]},{"block_type":"text","content":"&nbsp;methods), as shown in step 5, which splits the string into matched parts, showing the distinction between the two matching patterns.&nbsp;"}]},{"block_type":"element","block":"k67ev6d0","search_text":"Tip The difference displayed in step 5 is a very common one. Trying to capture GP can end up capturing eg gp lant and ba gp ipe! Similarly, things\\b won't capture things. Be sure to test and make the proper adjustments, such as capturing \\bGP\\b for just the word GP. ","text_count":267,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The difference displayed in step 5 is a very common one. Trying to capture GP can end up capturing eg"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"gp"}]},{"block_type":"text","content":"lant and ba"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"gp"}]},{"block_type":"text","content":"ipe! Similarly,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"things\\b"}]},{"block_type":"text","content":"won't capture things. Be sure to test and make the proper adjustments, such as capturing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\bGP\\b"}]},{"block_type":"text","content":"for just the word GP."}]}]},{"block_type":"element","block":"k67ev6d1","search_text":"The specific matched pattern can be retrieved by calling group() , as shown in step 6. Note that the result will always be a string. It can be further processed using any of the methods that we've previously seen, such as by splitting the phone number into groups by dashes, for example:","text_count":287,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The specific matched pattern can be retrieved by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"group()"}]},{"block_type":"text","content":", as shown in step 6. Note that the result will always be a string. It can be further processed using any of the methods that we've previously seen, such as by splitting the phone number into groups by dashes, for example:"}]},{"block_type":"element","block":"k67ev6d2","search_text":">>> match = re.search(r'[0123456789-]+', 'the phone number is 1234-567-890') >>> [int(n) for n in match.group().split('-')] [1234, 567, 890]","text_count":140,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; match = re.search(r'[0123456789-]+', 'the phone number is 1234-567-890')\n&gt;&gt;&gt; [int(n) for n in match.group().split('-')]\n[1234, 567, 890]"}]}]},{"block_type":"element","block":"k67ev6d3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6d4","search_text":"Dealing with regexes can be difficult and complex. Please allow time to test your matches and be sure that they work as you expect in order to avoid nasty surprises.","text_count":165,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Dealing with regexes can be difficult and complex. Please allow time to test your matches and be sure that they work as you expect in order to avoid nasty surprises."}]},{"block_type":"element","block":"k67ev6d5","search_text":"You can check your regexes interactively with some tools. A good one that's freely available online is https://regex101.com/ , which displays each of the elements and explains the regex. Double-check that you're using the Python flavor:","text_count":236,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can check your regexes interactively with some tools. A good one that's freely available online is&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://regex101.com/"},"children":[{"block_type":"text","content":"https://regex101.com/"}]},{"block_type":"text","content":", which displays each of the elements and explains the regex. Double-check that you're using the Python flavor:"}]},{"block_type":"element","block":"k67ev6d6","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000054.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6d7","search_text":"See that the EXPLANATION describes that \\b matches a word boundary (start or end of a word), and that thing matches literally these characters.","text_count":143,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"See that the EXPLANATION describes that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\b"}]},{"block_type":"text","content":"matches a word boundary (start or end of a word), and that"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"thing"}]},{"block_type":"text","content":"matches literally these characters."}]},{"block_type":"element","block":"k67ev6d8","search_text":"Tip Regexes, in some cases, can be very slow, or even produce what's called regex denial-of-service , a string created to confuse a particular regex so that it takes an enormous amount of time, even in the worst case blocking the computer. While automating tasks probably won't get you into those problems, keep an eye out in case a regex takes too long. ","text_count":355,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Regexes, in some cases, can be very slow, or even produce what's called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"regex denial-of-service"}]},{"block_type":"text","content":", a string created to confuse a particular regex so that it takes an enormous amount of time, even in the worst case blocking the computer. While automating tasks probably won't get you into those problems, keep an eye out in case a regex takes too long."}]}]},{"block_type":"element","block":"k67ev6d9","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6da","search_text":"The Extracting data from structured strings recipe The Using a third-party tool—parse recipe The Going deeper into regular expressions recipe ","text_count":142,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Extracting data from structured strings"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Going deeper into regular expressions"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6db","search_text":"Going deeper into regular expressions","text_count":37,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Going deeper into regular expressions"}]},{"block_type":"element","block":"k67ev6dc","search_text":"In this recipe, we'll see more about how to deal with regular expressions. After introducing the basics, we will dig a little deeper into pattern elements, introduce groups as a better way to retrieve and parse strings, see how to search for multiple occurrences of the same string, and deal with longer texts.","text_count":310,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see more about how to deal with regular expressions. After introducing the basics, we will dig a little deeper into pattern elements, introduce groups as a better way to retrieve and parse strings, see&nbsp;how to search for multiple occurrences of the same string, and deal with longer texts."}]},{"block_type":"element","block":"k67ev6dd","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6de","search_text":"Import re : ","text_count":12,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6df","search_text":">>> import re","text_count":13,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import re"}]}]},{"block_type":"element","block":"k67ev6dg","search_text":"Match a phone pattern as part of a group (in brackets). Note the use of \\d as a special character for any digit : ","text_count":114,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match a phone pattern as part of a group (in brackets). Note the use of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\d"}]},{"block_type":"text","content":"as a special character for"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"any digit"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6dh","search_text":">>> match = re.search(r'the phone number is ([\\d-]+)', '37: the phone number is 1234-567-890') >>> match.group() 'the phone number is 1234-567-890' >>> match.group(1) '1234-567-890'","text_count":181,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; match = re.search(r'the phone number is ([\\d-]+)', '37: the phone number is 1234-567-890')\n&gt;&gt;&gt; match.group()\n'the phone number is 1234-567-890'\n&gt;&gt;&gt; match.group(1)\n'1234-567-890'"}]}]},{"block_type":"element","block":"k67ev6di","search_text":"Compile a pattern and capture a case insensitive pattern with a yes|no option: ","text_count":79,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Compile a pattern and capture a case insensitive pattern with a&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"yes|no"}]},{"block_type":"text","content":"&nbsp;option:"}]}]},{"block_type":"element","block":"k67ev6dj","search_text":">>> pattern = re.compile(r'The answer to question (\\w+) is (yes|no)', re.IGNORECASE) >>> pattern.search('Naturaly, the answer to question 3b is YES') <_sre.SRE_Match object; span=(10, 42), match='the answer to question 3b is YES'> >>> _.groups() ('3b', 'YES')","text_count":259,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; pattern = re.compile(r'The answer to question (\\w+) is (yes|no)', re.IGNORECASE)\n&gt;&gt;&gt; pattern.search('Naturaly, the answer to question 3b is YES')\n&lt;_sre.SRE_Match object; span=(10, 42), match='the answer to question 3b is YES'&gt;\n&gt;&gt;&gt; _.groups()\n('3b', 'YES')"}]}]},{"block_type":"element","block":"k67ev6dk","search_text":"Match all the occurrences of cities and state abbreviations in the text. Note that they are separated by a single character and the name of the city always starts with an uppercase letter. Only four states are matched for simplicity: ","text_count":234,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Match all the occurrences of cities and state abbreviations in the text. Note that they are separated by a single character and the name of the city always starts with an uppercase letter. Only four states are matched for simplicity:"}]}]},{"block_type":"element","block":"k67ev6dl","search_text":">>> PATTERN = re.compile(r'([A-Z][\\w\\s]+).(TX|OR|OH|MI)') >>> TEXT ='the jackalopes are the team of Odessa,TX while the knights are native of Corvallis OR and the mud hens come from Toledo.OH; the whitecaps have their base in Grand Rapids,MI' >>> list(PATTERN.finditer(TEXT)) [<_sre.SRE_Match object; span=(31, 40), match='Odessa,TX'>, <_sre.SRE_Match object; span=(73, 85), match='Corvallis OR'>, <_sre.SRE_Match object; span=(113, 122), match='Toledo.OH'>, <_sre.SRE_Match object; span=(157, 172), match='Grand Rapids,MI'>] >>> _[0].groups() ('Odessa', 'TX')","text_count":560,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; PATTERN = re.compile(r'([A-Z][\\w\\s]+).(TX|OR|OH|MI)')\n&gt;&gt;&gt; TEXT ='the jackalopes are the team of Odessa,TX while the knights are native of Corvallis OR and the mud hens come from Toledo.OH; the whitecaps have their base in Grand Rapids,MI'\n&gt;&gt;&gt; list(PATTERN.finditer(TEXT))\n[&lt;_sre.SRE_Match object; span=(31, 40), match='Odessa,TX'&gt;, &lt;_sre.SRE_Match object; span=(73, 85), match='Corvallis OR'&gt;, &lt;_sre.SRE_Match object; span=(113, 122), match='Toledo.OH'&gt;, &lt;_sre.SRE_Match object; span=(157, 172), match='Grand Rapids,MI'&gt;]\n&gt;&gt;&gt; _[0].groups()\n('Odessa', 'TX')"}]}]},{"block_type":"element","block":"k67ev6dm","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6dn","search_text":"The new special characters that were introduced are as follows. Note that the same letter in uppercase or lowercase means the opposite match, for example \\d matches a digit, while \\D matches a non digit.:","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The new special characters that were introduced are as follows. Note that the same letter in uppercase or lowercase means the opposite match, for example&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\d"}]},{"block_type":"text","content":"matches a digit, while"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\D"}]},{"block_type":"text","content":"matches a non digit.:"}]},{"block_type":"element","block":"k67ev6do","search_text":"\\d : Marks any digit (0 to 9). \\s : Marks any character that's a whitespace, including tabs and other whitespace special characters. Note that this is the reverse of \\S , introduced in the previous recipe . \\w : Marks any letter (includes digits, but excludes characters such as periods). . : Marks any character. ","text_count":314,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\d"}]},{"block_type":"text","content":": Marks any digit (0 to 9)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\s"}]},{"block_type":"text","content":": Marks any character that's a whitespace, including tabs and other whitespace special characters. Note that this is the reverse of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\S"}]},{"block_type":"text","content":", introduced in the previous recipe"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"."}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\w"}]},{"block_type":"text","content":": Marks any letter (includes digits, but excludes characters such as periods)."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"."}]},{"block_type":"text","content":": Marks any character."}]}]},{"block_type":"element","block":"k67ev6dp","search_text":"To define groups, put the defined groups in brackets. Groups can be retrieved individually, making them perfect for matching a bigger pattern that contains a variable part that we'll treat later, as demonstrated in step 2. Note the difference with the step 6 pattern in the previous recipe. In this case, the pattern is not only the number, but includes the prefix, even if we then extract the number. Check out this difference, where there's a number that's not the number we want to capture:","text_count":493,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To define groups, put the defined groups in brackets. Groups can be retrieved individually, making them perfect for matching a bigger pattern that contains a variable part that we'll treat later, as demonstrated in step 2. Note the difference with the step 6 pattern in the previous recipe. In this case, the pattern is not only the number, but includes the prefix, even if we then extract the number. Check out this difference, where there's a number that's not the number we want to capture:"}]},{"block_type":"element","block":"k67ev6dq","search_text":">>> re.search(r'the phone number is ([\\d-]+)', '37: the phone number is 1234-567-890') <_sre.SRE_Match object; span=(4, 36), match='the phone number is 1234-567-890'> >>> _.group(1) '1234-567-890' >>> re.search(r'[0123456789-]+', '37: the phone number is 1234-567-890') <_sre.SRE_Match object; span=(0, 2), match='37'> >>> _.group() '37'","text_count":337,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'the phone number is ([\\d-]+)', '37: the phone number is 1234-567-890')\n&lt;_sre.SRE_Match object; span=(4, 36), match='the phone number is 1234-567-890'&gt;\n&gt;&gt;&gt; _.group(1)\n'1234-567-890'\n&gt;&gt;&gt; re.search(r'[0123456789-]+', '37: the phone number is 1234-567-890')\n&lt;_sre.SRE_Match object; span=(0, 2), match='37'&gt;\n&gt;&gt;&gt; _.group()\n'37'"}]}]},{"block_type":"element","block":"k67ev6dr","search_text":"Remember that group 0 ( .group() or .group(0) ) is always the whole match. The rest of the groups are ordered as they appear.","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember that group 0 ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".group()"}]},{"block_type":"text","content":"or &nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".group(0)"}]},{"block_type":"text","content":") is always the whole match. The rest of the groups are ordered as they appear."}]},{"block_type":"element","block":"k67ev6ds","search_text":"Patterns can be compiled as well. This saves some time if the pattern needs to be matched over and over. To use it that way, compile the pattern and then use that object to perform searches, as shown in steps 3 and 4. Some extra flags can be added, such as making the pattern case insensitive.","text_count":293,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Patterns can be compiled as well. This saves some time if the pattern needs to be matched over and over. To use it that way, compile the pattern and then use that object to perform searches, as shown in steps 3 and 4. Some extra flags can be added, such as making the pattern case insensitive."}]},{"block_type":"element","block":"k67ev6dt","search_text":"Step 4's pattern requires a little bit of information. It's composed of two groups, separated by a single character. The special character . means it matches everything, in our example a period, a whitespace, and a comma. The second group is a straightforward selection of defined options, in this case US state abbreviations.","text_count":326,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4's pattern requires a little bit of information. It's composed of two groups, separated by a single character. The special character"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"."}]},{"block_type":"text","content":"&nbsp;means it matches everything, in our example a period, a whitespace, and a comma. The second group is a straightforward selection of defined options, in this case US state abbreviations."}]},{"block_type":"element","block":"k67ev6du","search_text":"The first group starts with an uppercase letter ( [A-Z] ), and accepts any combination of letters or spaces ( [\\w\\s]+ ), but not punctuation marks such as periods or commas. This matches the cities, including when composed of more than one word.","text_count":245,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first group starts with an uppercase letter ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[A-Z]"}]},{"block_type":"text","content":"), and accepts any combination of letters or spaces ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"[\\w\\s]+"}]},{"block_type":"text","content":"), but not punctuation marks such as periods or commas. This matches the cities, including when composed of more than one word."}]},{"block_type":"element","block":"k67ev6dv","search_text":"Note that this pattern starts on any uppercase letter and keeps matching until finding a state, unless separated by a punctuation mark, which may not be what's expected, for example:","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that this pattern starts on any uppercase letter and keeps matching until finding a state, unless separated by a punctuation mark, which may not be what's expected, for example:"}]},{"block_type":"element","block":"k67ev6dw","search_text":">>> re.search(r'([A-Z][\\w\\s]+).(TX|OR|OH|MI)', 'This is a test, Escanaba MI') <_sre.SRE_Match object; span=(16, 27), match='Escanaba MI'> >>> re.search(r'([A-Z][\\w\\s]+).(TX|OR|OH|MI)', 'This is a test with Escanaba MI') <_sre.SRE_Match object; span=(0, 31), match='This is a test with Escanaba MI'>","text_count":298,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; re.search(r'([A-Z][\\w\\s]+).(TX|OR|OH|MI)', 'This is a test, Escanaba MI')\n&lt;_sre.SRE_Match object; span=(16, 27), match='Escanaba MI'&gt;\n&gt;&gt;&gt; re.search(r'([A-Z][\\w\\s]+).(TX|OR|OH|MI)', 'This is a test with Escanaba MI')\n&lt;_sre.SRE_Match object; span=(0, 31), match='This is a test with Escanaba MI'&gt;"}]}]},{"block_type":"element","block":"k67ev6dx","search_text":"Step 4 also shows how to find more than one occurrence in a long text. While the .findall() method exists, it doesn't return the full match object, while .findalliter() does. Commonplace now in Python 3, .findalliter() returns an iterator that can be used in a for loop or list comprehension. Note that .search() returns only the first occurrence of the pattern, even if more matches appear:","text_count":391,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 also shows how to find more than one occurrence in a long text. While the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".findall()"}]},{"block_type":"text","content":"&nbsp;method&nbsp;exists, it doesn't return the full match object, while"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".findalliter()"}]},{"block_type":"text","content":"&nbsp;does. Commonplace now in Python 3,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".findalliter()"}]},{"block_type":"text","content":"returns an iterator that can be used in a for loop or list comprehension. Note that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".search()"}]},{"block_type":"text","content":"&nbsp;returns only the first occurrence of the pattern, even if more matches appear:"}]},{"block_type":"element","block":"k67ev6dy","search_text":">>> PATTERN.search(TEXT) <_sre.SRE_Match object; span=(31, 40), match='Odessa,TX'> >>> PATTERN.findall(TEXT) [('Odessa', 'TX'), ('Corvallis', 'OR'), ('Toledo', 'OH')]","text_count":166,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; PATTERN.search(TEXT)\n&lt;_sre.SRE_Match object; span=(31, 40), match='Odessa,TX'&gt;\n&gt;&gt;&gt; PATTERN.findall(TEXT)\n[('Odessa', 'TX'), ('Corvallis', 'OR'), ('Toledo', 'OH')]"}]}]},{"block_type":"element","block":"k67ev6dz","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6e0","search_text":"The special characters can be reversed if they are case swapped. For example, the reverse of the ones we used are as follows:","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The special characters can be reversed if they are case swapped. For example, the reverse of the ones we used are as follows:"}]},{"block_type":"element","block":"k67ev6e1","search_text":"\\D : Marks any non-digit \\W : Marks any non-letter \\B : Marks any character that's not at the start or end of a word ","text_count":117,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\D"}]},{"block_type":"text","content":": Marks any non-digit"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\W"}]},{"block_type":"text","content":": Marks any non-letter"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\B"}]},{"block_type":"text","content":": Marks any character that's not at the start or end of a word"}]}]},{"block_type":"element","block":"k67ev6e2","search_text":"Note The most commonly used special characters are typically \\d (digits) and \\w (letters and digits), as they mark common patterns to search for, and the plus sign for one or more. ","text_count":181,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most commonly used special characters are typically"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\d"}]},{"block_type":"text","content":"(digits) and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\\w"}]},{"block_type":"text","content":"(letters and digits), as they mark common patterns to search for, and the plus sign for one or more."}]}]},{"block_type":"element","block":"k67ev6e3","search_text":"Groups can be assigned names as well. This makes them more explicit at the expense of making the group more verbose in the following shape— (?P<groupname>PATTERN) . Groups can be referred to by name with .group(groupname) or by calling .groupdict() while maintaining its numeric position.","text_count":288,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Groups can be assigned names as well. This makes them more explicit at the expense of making the group more verbose in the following shape&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"(?P&lt;groupname&gt;PATTERN)"}]},{"block_type":"text","content":". Groups can be referred to by name with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".group(groupname)"}]},{"block_type":"text","content":"or by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".groupdict()"}]},{"block_type":"text","content":"&nbsp;while maintaining its numeric position."}]},{"block_type":"element","block":"k67ev6e4","search_text":"For example, the step 4 pattern can be described as follows:","text_count":60,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, the step 4 pattern can be described as follows:"}]},{"block_type":"element","block":"k67ev6e5","search_text":">>> PATTERN = re.compile(r'(?P<city>[A-Z][\\w\\s]+?).(?P<state>TX|OR|OH|MN)') >>> match = PATTERN.search(TEXT) >>> match.groupdict() {'city': 'Odessa', 'state': 'TX'} >>> match.group('city') 'Odessa' >>> match.group('state') 'TX' >>> match.group(1), match.group(2) ('Odessa', 'TX')","text_count":279,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; PATTERN = re.compile(r'(?P&lt;city&gt;[A-Z][\\w\\s]+?).(?P&lt;state&gt;TX|OR|OH|MN)')\n&gt;&gt;&gt; match = PATTERN.search(TEXT)\n&gt;&gt;&gt; match.groupdict()\n{'city': 'Odessa', 'state': 'TX'}\n&gt;&gt;&gt; match.group('city')\n'Odessa'\n&gt;&gt;&gt; match.group('state')\n'TX'\n&gt;&gt;&gt; match.group(1), match.group(2)\n('Odessa', 'TX')"}]}]},{"block_type":"element","block":"k67ev6e6","search_text":"Regular expressions are a very extensive topic. There are whole technical books devoted to them and they can be notoriously deep. The Python documentation is good to be used as reference ( https://docs.python.org/3/library/re.html ) and to learn more.","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Regular expressions are a very extensive topic. There are whole technical books devoted to them and they can be notoriously deep. The Python documentation is good to be used as reference ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/re.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/re.html"}]},{"block_type":"text","content":") and to learn more."}]},{"block_type":"element","block":"k67ev6e7","search_text":"If you feel a little intimidated at the start, it's a perfectly natural feeling. Analyze each of the patterns with care, dividing it into different parts, and they will start to make sense. Don't be afraid to run a regex interactive analyzer!","text_count":242,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you feel a little intimidated at the start, it's a perfectly natural feeling.&nbsp;Analyze each of the patterns with care, dividing it into different parts, and they will start to make sense. Don't be afraid to run a regex interactive analyzer!"}]},{"block_type":"element","block":"k67ev6e8","search_text":"Regexes can be really powerful and generic, but they may not be the proper tool for what you are trying to achieve. We've seen some caveats and patterns that have subtleties. As a rule of thumb, if a pattern starts to feel complicated, it's time to search for a different tool. Remember the previous recipes as well and the options they presented, such as parse .","text_count":363,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Regexes can be really powerful and generic, but they may not be the proper tool for what you are trying to achieve. We've seen some caveats and patterns that have subtleties. As a rule of thumb, if a pattern starts to feel complicated, it's time to search for a different tool. Remember the previous recipes as well and the options they presented, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6e9","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6ea","search_text":"The Introducing regular expressions recipe The Using a third-party tool—parse recipe ","text_count":85,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6eb","search_text":"Adding command-line arguments","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Adding command-line arguments"}]},{"block_type":"element","block":"k67ev6ec","search_text":"A lot of tasks can be best structured as a command-line interface that accepts different parameters to change the way it works, for example, scrapping one web page or another. Python includes a powerful argparse module in the standard library to create rich command-line argument parsing with minimal effort.","text_count":308,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A lot of tasks can be best structured as a command-line interface that accepts different parameters to change the way it works, for example, scrapping one web page or another. Python includes a powerful"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"module in the standard library to create rich command-line argument parsing with minimal effort."}]},{"block_type":"element","block":"k67ev6ed","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ee","search_text":"The basic use of argparse in a script can be shown in three steps:","text_count":66,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic use of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"in a script can be shown in three steps:"}]},{"block_type":"element","block":"k67ev6ef","search_text":"Define the arguments that your script is going to accept, generating a new parser. Call the defined parser, returning an object with all the resulting arguments. Use the arguments to call the entry point of your script, which will apply the defined behavior. ","text_count":259,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the arguments that your script is going to accept, generating a new parser."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Call the defined parser, returning an object with all the resulting arguments."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the arguments to call the entry point of your script, which will apply the defined behavior."}]}]},{"block_type":"element","block":"k67ev6eg","search_text":"Try to use the following general structure for your scripts:","text_count":60,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Try to use the following general structure for your scripts:"}]},{"block_type":"element","block":"k67ev6eh","search_text":"IMPORTS def main(main parameters): DO THINGS if __name__ == '__main__': DEFINE ARGUMENT PARSER PARSE ARGS VALIDATE OR MANIPULATE ARGS, IF NEEDED main(arguments)","text_count":160,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"IMPORTS\n\ndef main(main parameters):\n  DO THINGS\n\nif __name__ == '__main__':\n    DEFINE ARGUMENT PARSER\n    PARSE ARGS\n    VALIDATE OR MANIPULATE ARGS, IF NEEDED\n    main(arguments)"}]}]},{"block_type":"element","block":"k67ev6ei","search_text":"The main function makes it easy to know what the entry point for the code is. The section under the if statement is only executed if the file is called directly, but not if it's imported. We'll follow this for all the steps.","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function makes it easy to know what the entry point for the code is. The section under the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"if"}]},{"block_type":"text","content":"statement is only executed if the file is called directly, but not if it's imported. We'll follow this for all the steps."}]},{"block_type":"element","block":"k67ev6ej","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6ek","search_text":"Create a script that will accept a single integer as a positional argument, and will print a hash symbol that amount of times. The recipe_cli_step1.py script is as follows, but note we are following the structure presented previously, and the main function is just printing the argument: ","text_count":288,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a script that will accept a single integer as a positional argument, and will print a hash symbol&nbsp;that amount of times. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe_cli_step1.py"}]},{"block_type":"text","content":"&nbsp;script is as follows, but note we are following the structure presented previously, and the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function is just printing the argument:"}]}]},{"block_type":"element","block":"k67ev6el","search_text":"import argparse def main(number): print('#' * number) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('number', type=int, help='A number') args = parser.parse_args() main(args.number)","text_count":217,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\n\ndef main(number):\n    print('#' * number)\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('number', type=int, help='A number')\n    args = parser.parse_args()\n    \n    main(args.number)"}]}]},{"block_type":"element","block":"k67ev6em","search_text":"Call the script and see how the parameter is presented. Calling the script with no arguments displays the automatic help. Use the automatic argument -h to display the extended help: ","text_count":182,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Call the script and see how the parameter is presented. Calling the script with no arguments displays the automatic help. Use the automatic argument"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"to display the extended help:"}]}]},{"block_type":"element","block":"k67ev6en","search_text":"$ python3 recipe_cli_step1.py usage: recipe_cli_step1.py [-h] number recipe_cli_step1.py: error: the following arguments are required: number $ python3 recipe_cli_step1.py -h usage: recipe_cli_step1.py [-h] number positional arguments: number A number optional arguments: -h, --help show this help message and exit","text_count":314,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 recipe_cli_step1.py\nusage: recipe_cli_step1.py [-h] number\nrecipe_cli_step1.py: error: the following arguments are required: number\n$ python3 recipe_cli_step1.py -h\nusage: recipe_cli_step1.py [-h] number\npositional arguments:\n number A number\noptional arguments:\n -h, --help show this help message and exit"}]}]},{"block_type":"element","block":"k67ev6eo","search_text":"Calling the script with the extra parameters works as expected: ","text_count":64,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Calling the script with the extra parameters works as expected:"}]}]},{"block_type":"element","block":"k67ev6ep","search_text":"$ python3 recipe_cli_step1.py 4 #### $ python3 recipe_cli_step1.py not_a_number usage: recipe_cli_step1.py [-h] number recipe_cli_step1.py: error: argument number: invalid int value: 'not_a_number'","text_count":197,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 recipe_cli_step1.py 4\n####\n$ python3 recipe_cli_step1.py not_a_number\nusage: recipe_cli_step1.py [-h] number\nrecipe_cli_step1.py: error: argument number: invalid int value: 'not_a_number'"}]}]},{"block_type":"element","block":"k67ev6eq","search_text":"Change the script to accept an optional argument for the character to print. The default will be '#' . The recipe_cli_step2.py script will look like this: ","text_count":155,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Change the script to accept an optional argument for the character to print. The default will be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'#'"}]},{"block_type":"text","content":".&nbsp;The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe_cli_step2.py&nbsp;"}]},{"block_type":"text","content":"&nbsp;script will look like this:"}]}]},{"block_type":"element","block":"k67ev6er","search_text":"import argparse def main(character, number): print(character * number) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('number', type=int, help='A number') parser.add_argument('-c', type=str, help='Character to print', default='#') args = parser.parse_args() main(args.c, args.number)","text_count":318,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\n\ndef main(character, number):\n    print(character * number)\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('number', type=int, help='A number')\n    parser.add_argument('-c', type=str, help='Character to print',\n                        default='#')\n\nargs = parser.parse_args()\nmain(args.c, args.number)"}]}]},{"block_type":"element","block":"k67ev6es","search_text":"The help is updated, and using the -c flag allows us to print different characters: ","text_count":84,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The help is&nbsp;updated, and using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-c"}]},{"block_type":"text","content":"flag allows us to print different characters:"}]}]},{"block_type":"element","block":"k67ev6et","search_text":"$ python3 recipe_cli_step2.py -h usage: recipe_cli_step2.py [-h] [-c C] number positional arguments: number A number optional arguments: -h, --help show this help message and exit -c C Character to print $ python3 recipe_cli_step2.py 4 #### $ python3 recipe_cli_step2.py 5 -c m mmmmm","text_count":283,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 recipe_cli_step2.py -h\nusage: recipe_cli_step2.py [-h] [-c C] number\n\npositional arguments:\n number A number\n\noptional arguments:\n -h, --help show this help message and exit\n -c C Character to print\n$ python3 recipe_cli_step2.py 4\n####\n$ python3 recipe_cli_step2.py 5 -c m\nmmmmm"}]}]},{"block_type":"element","block":"k67ev6eu","search_text":"Add a flag that changes the behavior when present. The recipe_cli_step3.py script is as follows: ","text_count":97,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a flag that changes the behavior when present.&nbsp;The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"recipe_cli_step3.py"}]},{"block_type":"text","content":"script is as follows:"}]}]},{"block_type":"element","block":"k67ev6ev","search_text":"import argparse def main(character, number): print(character * number) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('number', type=int, help='A number') parser.add_argument('-c', type=str, help='Character to print', default='#') parser.add_argument('-U', action='store_true', default=False, dest='uppercase', help='Uppercase the character') args = parser.parse_args() if args.uppercase: args.c = args.c.upper() main(args.c, args.number)","text_count":473,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\n\ndef main(character, number):\n    print(character * number)\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('number', type=int, help='A number')\n    parser.add_argument('-c', type=str, help='Character to print',\n                        default='#')\n    parser.add_argument('-U', action='store_true', default=False,\n                        dest='uppercase',\n                        help='Uppercase the character')\n    args = parser.parse_args()\n\n    if args.uppercase:\n        args.c = args.c.upper()\n\n    main(args.c, args.number)"}]}]},{"block_type":"element","block":"k67ev6ew","search_text":"Calling it uppercases the character if the -U flag is added: ","text_count":61,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Calling it uppercases the character if the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-U"}]},{"block_type":"text","content":"&nbsp;flag&nbsp;is added:"}]}]},{"block_type":"element","block":"k67ev6ex","search_text":"$ python3 recipe_cli_step3.py 4 -c f ffff $ python3 recipe_cli_step3.py 4 -c f -U FFFF","text_count":86,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 recipe_cli_step3.py 4 -c f\nffff\n$ python3 recipe_cli_step3.py 4 -c f -U\nFFFF"}]}]},{"block_type":"element","block":"k67ev6ey","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6ez","search_text":"As described in step 1 in the How to do it… section, the arguments are added to the parser through .add_arguments . Once all arguments are defined, calling parse_args() returns an object that contains the results (or exits if there's an error).","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As described in step 1 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, the arguments are added to the parser through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".add_arguments"}]},{"block_type":"text","content":". Once all arguments are defined, calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse_args()"}]},{"block_type":"text","content":"returns an object that contains the results (or exits if there's an error)."}]},{"block_type":"element","block":"k67ev6f0","search_text":"Each argument should add a help description, but their behavior can change greatly:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each argument should add a help description, but their behavior can change greatly:"}]},{"block_type":"element","block":"k67ev6f1","search_text":"If an argument starts with a - , it is considered an optional parameter, like the -c argument in step 4. If not, it's a positional argument, like the number argument in step 1. ","text_count":177,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If an argument starts with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-"}]},{"block_type":"text","content":", it is considered an optional parameter, like the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-c"}]},{"block_type":"text","content":"&nbsp;argument in step 4. If not, it's a positional argument, like the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"number"}]},{"block_type":"text","content":"&nbsp;argument in step 1."}]}]},{"block_type":"element","block":"k67ev6f2","search_text":"Tip For clarity, always define a default value for optional parameters. It will be None if you don't, but this may be confusing. ","text_count":129,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For clarity, always define a default value for optional parameters. It will be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"if you don't, but this may be confusing."}]}]},{"block_type":"element","block":"k67ev6f3","search_text":"Remember to always add a help parameter with a description of the parameter; help is automatically generated, as shown in step 2. If a type is present, it will be validated, for example, number in step 3. By default, the type will be string. The actions store_true and store_false can be used to generate flags, arguments that don't require any extra parameters. Set the corresponding default value as the opposite Boolean. This is demonstrated in the U argument in steps 6 and 7. The name of the property in the args object will be, by default, the name of the argument (without the dash, if it's present). You can change it with dest . For example, in step 6, the command-line argument -U is described as uppercase . ","text_count":719,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Remember to always add&nbsp;a help parameter with a description of the parameter; help is automatically generated, as shown in step 2."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If a type is present, it will be validated, for example,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"number"}]},{"block_type":"text","content":"&nbsp;in step 3. By default, the type will be string."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The actions"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store_true"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"store_false"}]},{"block_type":"text","content":"&nbsp;can be used to generate flags, arguments that don't require any extra parameters. Set the corresponding default value as the opposite Boolean. This is demonstrated in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"U"}]},{"block_type":"text","content":"&nbsp;argument in steps 6 and 7."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The name of the property in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"args"}]},{"block_type":"text","content":"object will be, by default, the name of the argument (without the dash, if it's present). You can change it with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dest"}]},{"block_type":"text","content":". For example, in step 6, the command-line argument"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-U"}]},{"block_type":"text","content":"is described as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"uppercase"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6f4","search_text":"Tip Changing the name of an argument for internal usage is very useful when using short arguments, such as single letters. A good command-line interface will use -c , but internally it's probably a good idea to use a more verbose label, such as configuration_file . Explicit is better than implicit! ","text_count":300,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Changing the name of an argument for internal usage is very useful when using short arguments, such as single letters. A good command-line interface will use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-c"}]},{"block_type":"text","content":", but internally it's probably a good idea to use a more verbose label, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"configuration_file"}]},{"block_type":"text","content":". Explicit is better than implicit!"}]}]},{"block_type":"element","block":"k67ev6f5","search_text":"Some arguments can work in coordination with others, as shown in step 3. Perform all required operations to pass the main function as clear and concise parameters. For example, in step 3, only two parameters are passed, but one may have been modified. ","text_count":252,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Some arguments can work in coordination with others, as shown in step 3. Perform all required operations to pass the main function as clear and concise parameters. For example, in step 3, only two parameters are passed, but one may have been modified."}]}]},{"block_type":"element","block":"k67ev6f6","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6f7","search_text":"You can create long arguments as well with double dashes, for example:","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can create long arguments as well with double dashes, for example:"}]},{"block_type":"element","block":"k67ev6f8","search_text":"parser.add_argument('-v', '--verbose', action='store_true', default=False, help='Enable verbose output')","text_count":104,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"parser.add_argument('-v', '--verbose', action='store_true', default=False, \n                     help='Enable verbose output')"}]}]},{"block_type":"element","block":"k67ev6f9","search_text":"This will accept both -v and --verbose , and it will store the name verbose . ","text_count":78,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This will accept both"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-v"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"--verbose"}]},{"block_type":"text","content":", and it will store the name"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"verbose"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev6fa","search_text":"Tip Adding long names is a good way of making the interface more intuitive and easy to remember. It's easy to remember after a couple of times that there's a verbose option, and it starts with a v . ","text_count":199,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Adding long names is a good way of making the interface more intuitive and easy to remember. It's easy to remember after a couple of times that there's a verbose option, and it starts with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"v"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6fb","search_text":"The main inconvenience when dealing with command-line arguments may be ending up with too many of them. This creates confusion. Try to make your arguments as independent as possible and not make too many dependencies between them, or handling the combinations can be tricky.","text_count":274,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main inconvenience when dealing with command-line arguments may be ending up with too many of them. This creates confusion. Try to make your arguments as independent as possible and not make too many dependencies between them, or handling the combinations can be tricky."}]},{"block_type":"element","block":"k67ev6fc","search_text":"Tip In particular, try to not create more than a couple of positional arguments, as they won't have mnemonics. Positional arguments also accept default values, but most of the time that won't be the expected behavior. ","text_count":218,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In particular, try to not create more than a couple of positional arguments, as they won't have mnemonics. Positional arguments also accept default values, but most of the time that won't be the expected behavior."}]}]},{"block_type":"element","block":"k67ev6fd","search_text":"For advanced details, check the Python documentation of argparse ( https://docs.python.org/3/library/argparse.html ).","text_count":117,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For advanced details, check the Python documentation of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/argparse.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/argparse.html"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev6fe","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6ff","search_text":"The Creating a virtual environment recipe The Installing third-party packages recipe ","text_count":85,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a virtual environment"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Automating Tasks Made Easy","author":"Jaime Buelta","block":"k67eunkh","number":2,"contents":[{"block_type":"element","block":"k67ev6fg","search_text":"In this chapter, we'll cover the following recipes:","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we'll cover the following recipes:"}]},{"block_type":"element","block":"k67ev6fh","search_text":"Preparing a task Setting up a cron job Capturing errors and problems Sending email notifications ","text_count":97,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Preparing a task"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Setting up a cron job"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Capturing errors and problems"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Sending email notifications"}]}]},{"block_type":"element","block":"k67ev6fi","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev6fj","search_text":"To properly automate tasks, we need a platform so that they run automatically at the proper times. A task that needs to be run manually is not really fully automated.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To properly automate tasks, we need a platform so that they run automatically at the proper times. A task that needs to be run manually is not really fully automated."}]},{"block_type":"element","block":"k67ev6fk","search_text":"But, in order to be able to leave them running in the background while worrying about more pressing issues, the task will need to be adequate to run in fire-and-forget mode. We should be able to monitor that it runs correctly, be sure that we are capturing future actions (such as receiving notifications if something interesting arises), and know whether there have been any errors while running it.","text_count":400,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But, in order to be able to leave them running in the background while worrying about more pressing issues, the task will need to be adequate to run in"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"fire-and-forget"}]},{"block_type":"text","content":"&nbsp;mode. We should be able to monitor that it runs correctly, be sure that we are capturing future actions (such as receiving notifications if something interesting arises), and know whether there have been any errors while running it."}]},{"block_type":"element","block":"k67ev6fl","search_text":"Ensuring that a piece of software runs consistently with a high reliability is actually a very big deal and is one area that, to be done properly, requires specialized knowledge and staff, which typically go by the names of sysadmin, operations, or SRE ( Site Reliability Engineering ). Sites like Amazon and Google require huge investment in ensuring that everything works 24/7.","text_count":379,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Ensuring that a piece of software runs consistently with a high reliability is actually a very big deal&nbsp;and is one area that, to be done properly, requires specialized knowledge and staff,&nbsp;which typically go by the names of sysadmin, operations, or"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"SRE"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Site Reliability Engineering"}]},{"block_type":"text","content":"). Sites&nbsp;like Amazon and Google require huge investment in ensuring that everything works 24/7."}]},{"block_type":"element","block":"k67ev6fm","search_text":"The objective for this book is way more modest than that. You probably don't require a downtime lower than a few seconds per year. Running a task with reasonable reliability is a much easier thing to do. But, be aware that there's maintenance to be done, so be prepared for that.","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The objective for this book is way more modest than that. You probably don't require a downtime lower than a few seconds per year. Running a task with reasonable reliability is a much easier thing to do. But, be aware that there's maintenance to be done, so be prepared for that."}]},{"block_type":"element","block":"k67ev6fn","search_text":"Preparing a task","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Preparing a task"}]},{"block_type":"element","block":"k67ev6fo","search_text":"It all starts with defining exactly what task needs to be run, and designing it in a way that doesn't require human intervention to run.","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It all starts with defining exactly what task needs to be run, and designing it in a way that doesn't require human intervention to run."}]},{"block_type":"element","block":"k67ev6fp","search_text":"Some ideal characteristic points are as follows:","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some ideal characteristic points are as follows:"}]},{"block_type":"element","block":"k67ev6fq","search_text":"Single, clear entry point : No confusion on what the task to run is. Clear parameters : If there are any parameters, they should be very explicit. No interactivity : Stopping the execution to request information from the user is not possible. The result should be stored : To be able to be checked at a different time than when it runs. Clear result : If we are working interactively in a result, we accept more verbose results, or progress reports. But, for an automated task, the final result should be as concise and to the point as possible. Errors should be logged : To analyze what went wrong. ","text_count":600,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Single, clear entry point"}]},{"block_type":"text","content":":&nbsp;No confusion on what the task to run is."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Clear parameters"}]},{"block_type":"text","content":":&nbsp;If there are any parameters, they should be very explicit."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"No interactivity"}]},{"block_type":"text","content":":&nbsp;Stopping the execution to request information from the user is not possible."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"The result should be stored"}]},{"block_type":"text","content":": To be able to be checked at a different time than when it runs."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Clear result"}]},{"block_type":"text","content":":&nbsp;If we are working interactively in a result, we accept more verbose results, or progress reports. But, for an automated task, the final result should be as concise and to the point as possible."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Errors should be logged"}]},{"block_type":"text","content":": To analyze what went wrong.&nbsp;"}]}]},{"block_type":"element","block":"k67ev6fr","search_text":"A command-line program has a lot of those characteristics already. It has a clear way of running, with defined parameters, and the result can be stored, even if just in text format. But, it can be improved with a config file to clarify the parameters, and an output file.","text_count":271,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A command-line program has a lot of those characteristics already. It has a clear way of running, with defined parameters, and the result can be stored, even if just in text format. But, it can be improved with a config file to clarify the parameters, and an output file."}]},{"block_type":"element","block":"k67ev6fs","search_text":"Note that point 6 is the objective of the Capturing errors and problems recipe, and will be covered there.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that point&nbsp;6&nbsp;is the objective of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Capturing errors and problems"}]},{"block_type":"text","content":"recipe, and will be covered there."}]},{"block_type":"element","block":"k67ev6ft","search_text":"Tip To avoid interactivity, do not use any command that stops for the user to input, like input . Remember to delete breakpoints for debugging! ","text_count":144,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To avoid interactivity, do not use any command that stops for the user to input, like"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"input"}]},{"block_type":"text","content":". Remember to delete breakpoints for debugging!"}]}]},{"block_type":"element","block":"k67ev6fu","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6fv","search_text":"We'll start by following a structure in which a main function will serve as the entry point, and all parameters are supplied to it.","text_count":131,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll start by following a structure in which a main function will serve as the entry point, and all parameters are supplied to it."}]},{"block_type":"element","block":"k67ev6fw","search_text":"Tip This is the same the basic structure the was presented in the Adding command-line arguments recipe in Chapter 1, Let's Begin Our Automation Journey . ","text_count":154,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This&nbsp;is the same the basic structure&nbsp;the was presented in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding command-line arguments"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let's Begin Our Automation Journey"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6fx","search_text":"The definition of a main function will all the explicit arguments covers points 1 and 2. Point 3 is not difficult to achieve.","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The definition of a main function will all the explicit arguments covers points 1 and 2.&nbsp;Point 3 is not difficult to achieve."}]},{"block_type":"element","block":"k67ev6fy","search_text":"To improve point 2 and 5, we'll look at retrieving the configuration from a file and storing the result in another. Another option is to send a notification, such as an email, which will be covered later in this chapter.","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To improve point 2 and 5, we'll look at retrieving the configuration from a file and storing the result in another. Another option is to send a notification, such as an email, which will be covered later in this chapter."}]},{"block_type":"element","block":"k67ev6fz","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6g0","search_text":"Prepare the following task and save it as prepare_task_step1.py : ","text_count":66,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the following task&nbsp;and save it as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"prepare_task_step1.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6g1","search_text":"import argparse def main(number, other_number): result = number * other_number print(f'The result is {result}') if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('-n1', type=int, help='A number', default=1) parser.add_argument('-n2', type=int, help='Another number', default=1) args = parser.parse_args() main(args.n1, args.n2)","text_count":359,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\n\n\ndef main(number, other_number):\n    result = number * other_number\n    print(f'The result is {result}')\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-n1', type=int, help='A number', default=1)\n    parser.add_argument('-n2', type=int, help='Another number', default=1)\n\n    args = parser.parse_args()\n\n    main(args.n1, args.n2)"}]}]},{"block_type":"element","block":"k67ev6g2","search_text":"Update the file to define a config file that contains both arguments, and save it as prepare_task_step2.py . Note that defining a config file overwrites any command-line parameters: ","text_count":182,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Update the file to define a config file that contains both arguments, and save it as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"prepare_task_step2.py"}]},{"block_type":"text","content":". Note that defining a config file overwrites any command-line parameters:"}]}]},{"block_type":"element","block":"k67ev6g3","search_text":"import argparse import configparser def main(number, other_number): result = number * other_number print(f'The result is {result}') if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('-n1', type=int, help='A number', default=1) parser.add_argument('-n2', type=int, help='Another number', default=1) parser.add_argument('--config', '-c', type=argparse.FileType('r'), help='config file') args = parser.parse_args() if args.config: config = configparser.ConfigParser() config.read_file(args.config) # Transforming values into integers args.n1 = int(config['DEFAULT']['n1']) args.n2 = int(config['DEFAULT']['n2']) main(args.n1, args.n2)","text_count":663,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\nimport configparser\n\n\ndef main(number, other_number):\n    result = number * other_number\n    print(f'The result is {result}')\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-n1', type=int, help='A number', default=1)\n    parser.add_argument('-n2', type=int, help='Another number', default=1)\n\n    parser.add_argument('--config', '-c', type=argparse.FileType('r'),\n                        help='config file')\n\n    args = parser.parse_args()\n    if args.config:\n        config = configparser.ConfigParser()\n        config.read_file(args.config)\n        # Transforming values into integers\n        args.n1 = int(config['DEFAULT']['n1'])\n        args.n2 = int(config['DEFAULT']['n2'])\n\n    main(args.n1, args.n2)"}]}]},{"block_type":"element","block":"k67ev6g4","search_text":"Create the config file config.ini : ","text_count":36,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the config file"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"config.ini"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6g5","search_text":"[ARGUMENTS] n1=5 n2=7","text_count":21,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[ARGUMENTS]\nn1=5\nn2=7"}]}]},{"block_type":"element","block":"k67ev6g6","search_text":"Run the command with the config file. Note that the config file overwrites the command-line parameters, as described in step 2: ","text_count":128,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the command with the config file. Note that the config file overwrites the command-line parameters, as described in step 2:"}]}]},{"block_type":"element","block":"k67ev6g7","search_text":"$ python3 prepare_task_step2.py -c config.ini The result is 35 $ python3 prepare_task_step2.py -c config.ini -n1 2 -n2 3 The result is 35","text_count":137,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 prepare_task_step2.py -c config.ini\nThe result is 35\n$ python3 prepare_task_step2.py -c config.ini -n1 2 -n2 3\nThe result is 35"}]}]},{"block_type":"element","block":"k67ev6g8","search_text":"Add a parameter to store the result in a file, and save it as prepare_task_step5.py : ","text_count":86,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a parameter&nbsp;to store the result in a file, and save it as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"prepare_task_step5.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6g9","search_text":"import argparse import sys import configparser def main(number, other_number, output): result = number * other_number print(f'The result is {result}', file=output) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('-n1', type=int, help='A number', default=1) parser.add_argument('-n2', type=int, help='Another number', default=1) parser.add_argument('--config', '-c', type=argparse.FileType('r'), help='config file') parser.add_argument('-o', dest='output', type=argparse.FileType('w'), help='output file', default=sys.stdout) args = parser.parse_args() if args.config: config = configparser.ConfigParser() config.read_file(args.config) # Transforming values into integers args.n1 = int(config['DEFAULT']['n1']) args.n2 = int(config['DEFAULT']['n2']) main(args.n1, args.n2, args.output)","text_count":818,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\nimport sys\nimport configparser\n\n\ndef main(number, other_number, output):\n    result = number * other_number\n    print(f'The result is {result}', file=output)\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-n1', type=int, help='A number', default=1)\n    parser.add_argument('-n2', type=int, help='Another number', default=1)\n\n    parser.add_argument('--config', '-c', type=argparse.FileType('r'),\n                        help='config file')\n    parser.add_argument('-o', dest='output', type=argparse.FileType('w'),\n                        help='output file',\n                        default=sys.stdout)\n\n    args = parser.parse_args()\n    if args.config:\n        config = configparser.ConfigParser()\n        config.read_file(args.config)\n        # Transforming values into integers\n        args.n1 = int(config['DEFAULT']['n1'])\n        args.n2 = int(config['DEFAULT']['n2'])\n\n    main(args.n1, args.n2, args.output)"}]}]},{"block_type":"element","block":"k67ev6ga","search_text":"Run the result to check that it's sending the output to the defined file. Note that there's no output outside the result files: ","text_count":128,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the result to check that it's sending the output to the defined file. Note that there's no output outside the result files:"}]}]},{"block_type":"element","block":"k67ev6gb","search_text":"$ python3 prepare_task_step5.py -n1 3 -n2 5 -o result.txt $ cat result.txt The result is 15 $ python3 prepare_task_step5.py -c config.ini -o result2.txt $ cat result2.txt The result is 35","text_count":187,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 prepare_task_step5.py -n1 3 -n2 5 -o result.txt\n$ cat result.txt\nThe result is 15\n$ python3 prepare_task_step5.py -c config.ini -o result2.txt\n$ cat result2.txt\nThe result is 35"}]}]},{"block_type":"element","block":"k67ev6gc","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6gd","search_text":"Note that the argparse module allows us to define files as parameters, with the argparse.FileType type, and opens them automatically. This is very handy, and will raise an error if the file is not valid.","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":"module allows us to define files as parameters, with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse.FileType"}]},{"block_type":"text","content":"type, and opens them automatically. This is very handy, and will raise an error if the file is not valid."}]},{"block_type":"element","block":"k67ev6ge","search_text":"Tip Remember to open the file in the correct mode. In Step 5, the config file is opened in read mode ( r ) and the output file in write mode ( w ), which will overwrite the file if it exists. You may find the append mode ( a ), which will add the next piece of data at the end of an existing file. ","text_count":298,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember to open the file in the correct mode. In Step 5, the config file is opened in read mode ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r"}]},{"block_type":"text","content":") and the output file in write mode ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"w"}]},{"block_type":"text","content":"), which will overwrite the file if it exists. You may find the append mode ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"text","content":"), which will add the next piece of data at the end of an existing file."}]}]},{"block_type":"element","block":"k67ev6gf","search_text":"The configparser module allows us to use config files with ease. As demonstrated in Step 2, the parsing of the file is as simple as follows:","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"configparser"}]},{"block_type":"text","content":"module allows us to use config files with ease. As demonstrated in Step 2, the parsing of the file is as simple as follows:"}]},{"block_type":"element","block":"k67ev6gg","search_text":"config = configparser.ConfigParser() config.read_file(file)","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"config = configparser.ConfigParser()\nconfig.read_file(file)"}]}]},{"block_type":"element","block":"k67ev6gh","search_text":"The config will then be accessible as a dictionary divided by sections, and then values. Note that the values are always stored in string format, requiring to be transformed into other types, such as integers:","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The config will then be accessible as a dictionary divided by sections, and then values. Note that the values are always stored in string format, requiring to be transformed into other types, such as integers:"}]},{"block_type":"element","block":"k67ev6gi","search_text":"Tip If you need to obtain boolean values, do not perform value = bool(config[raw_value]) as it will be transformed into True no matter what; for instance, the string False is a true string, as it's not empty. Use the .getboolean method instead, for example, value = config.getboolean(raw_value) . ","text_count":297,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to obtain boolean values, do not perform"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"value = bool(config[raw_value])"}]},{"block_type":"text","content":"&nbsp;as it will be transformed into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":"no matter what; for instance, the string"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"False"}]},{"block_type":"text","content":"is a true string, as it's not empty. Use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".getboolean"}]},{"block_type":"text","content":"method instead, for example,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"value = config.getboolean(raw_value)"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6gj","search_text":"Python3 allows us to pass a file parameter to the print function, which will write to that file. Step 5 shows the usage to redirect all the printed information to a file. ","text_count":171,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python3 allows us to pass a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file"}]},{"block_type":"text","content":"parameter to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"print"}]},{"block_type":"text","content":"function, which will write to that file. Step 5 shows the usage to redirect all the printed information to a file.&nbsp;"}]},{"block_type":"element","block":"k67ev6gk","search_text":"Note that the default parameter is sys.stdout , which will print the value to the Terminal (standard output). This makes it so that calling the script without an -o parameter will display the information on the screen, which is helpful in debugging:","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the default parameter is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sys.stdout"}]},{"block_type":"text","content":", which will print the value to the Terminal (standard output). This makes it so that calling the script without an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-o"}]},{"block_type":"text","content":"parameter will display the information on the screen, which is helpful in debugging:"}]},{"block_type":"element","block":"k67ev6gl","search_text":"$ python3 prepare_task_step5.py -c config.ini The result is 35 $ python3 prepare_task_step5.py -c config.ini -o result.txt $ cat result.txt The result is 35","text_count":156,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 prepare_task_step5.py -c config.ini\nThe result is 35\n$ python3 prepare_task_step5.py -c config.ini -o result.txt\n$ cat result.txt\nThe result is 35"}]}]},{"block_type":"element","block":"k67ev6gm","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6gn","search_text":"Please check out the full documentation of configparse in the official Python documentation: https://docs.python.org/3/library/configparser.html.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please check out the full documentation of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"configparse"}]},{"block_type":"text","content":"in the official Python documentation:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/configparser.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/configparser.html."}]}]},{"block_type":"element","block":"k67ev6go","search_text":"In most cases, this configuration parser should be good enough, but if more power is needed, you can use YAML files as configuration files. YAML files ( https://learn.getgrav.org/advanced/yaml ) are very common as configuration files, and are better structured and can be parsed directly, taking into account data types.","text_count":320,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In most cases, this configuration parser should be good enough, but if more power is needed, you can use YAML files as configuration files. YAML files ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://learn.getgrav.org/advanced/yaml"},"children":[{"block_type":"text","content":"https://learn.getgrav.org/advanced/yaml"}]},{"block_type":"text","content":") are very common as configuration files, and are better structured and can be parsed directly, taking into account data types."}]},{"block_type":"element","block":"k67ev6gp","search_text":"Add PyYAML to the requirements.txt file and install it: ","text_count":56,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add PyYAML to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file and install it:&nbsp;"}]}]},{"block_type":"element","block":"k67ev6gq","search_text":"PyYAML==3.12","text_count":12,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"PyYAML==3.12"}]}]},{"block_type":"element","block":"k67ev6gr","search_text":"Create the prepare_task_yaml.py file: ","text_count":38,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"prepare_task_yaml.py"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev6gs","search_text":"import yaml import argparse import sys def main(number, other_number, output): result = number * other_number print(f'The result is {result}', file=output) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('-n1', type=int, help='A number', default=1) parser.add_argument('-n2', type=int, help='Another number', default=1) parser.add_argument('-c', dest='config', type=argparse.FileType('r'), help='config file in YAML format', default=None) parser.add_argument('-o', dest='output', type=argparse.FileType('w'), help='output file', default=sys.stdout) args = parser.parse_args() if args.config: config = yaml.load(args.config) # No need to transform values args.n1 = config['ARGUMENTS']['n1'] args.n2 = config['ARGUMENTS']['n2'] main(args.n1, args.n2, args.output)","text_count":795,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import yaml\nimport argparse\nimport sys\n\n\ndef main(number, other_number, output):\n    result = number * other_number\n    print(f'The result is {result}', file=output)\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-n1', type=int, help='A number', default=1)\n    parser.add_argument('-n2', type=int, help='Another number', default=1)\n\n    parser.add_argument('-c', dest='config', type=argparse.FileType('r'),\n help='config file in YAML format',\n default=None)\n    parser.add_argument('-o', dest='output', type=argparse.FileType('w'),\n                        help='output file',\n                        default=sys.stdout)\n\n    args = parser.parse_args()\n    if args.config:\n        config = yaml.load(args.config)\n        # No need to transform values\n        args.n1 = config['ARGUMENTS']['n1']\n        args.n2 = config['ARGUMENTS']['n2']\n\n    main(args.n1, args.n2, args.output)"}]}]},{"block_type":"element","block":"k67ev6gt","search_text":"Define the config file config.yaml, available in GitHub https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter02/config.yaml : ","text_count":154,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the config file"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"config.yaml,"}]},{"block_type":"text","content":"available in GitHub&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter02/config.yaml"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter02/config.yaml"}]},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/chapter2/config.yaml"},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6gu","search_text":"ARGUMENTS: n1: 7 n2: 4","text_count":22,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"ARGUMENTS:\n    n1: 7\n    n2: 4"}]}]},{"block_type":"element","block":"k67ev6gv","search_text":"Then, run the following: ","text_count":25,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Then, run the following:"}]}]},{"block_type":"element","block":"k67ev6gw","search_text":"$ python3 prepare_task_yaml.py -c config.yaml The result is 28 ","text_count":63,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 prepare_task_yaml.py -c config.yaml\nThe result is 28"}]}]},{"block_type":"element","block":"k67ev6gx","search_text":"There's also the possibility of setting a default config file, as well as a default output file. This can be handy to create a pure task that requires no input parameters.","text_count":171,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There's also the possibility of setting a default config file, as well as a default output file. This can be handy to create a pure task that requires no input parameters."}]},{"block_type":"element","block":"k67ev6gy","search_text":"Tip As a general rule, try to avoid creating too many input and configuration parameters if the task has a very specific objective in mind. Try to limit the input parameters to different executions of the task. A parameter that never changes is probably fine being defined as a constant . A high number of parameters will make config files or command-line arguments complicated and will create more maintenance in the long run. On the other hand, if your objective is to create a very flexible tool to be used in very different situations, then creating more parameters is probably a good idea. Try to find your own proper balance! ","text_count":632,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As a general rule, try to avoid creating too many input and configuration parameters if the task has a very specific objective in mind. Try to limit the input parameters to different executions of the task. A parameter that never changes is probably fine being defined as a"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"constant"}]},{"block_type":"text","content":". A high number of parameters will make config files or command-line arguments complicated and will create more maintenance in the long run. On the other hand, if your objective is to create a very flexible tool to be used in very different situations, then creating more parameters is probably a good idea. Try to find your own proper balance!"}]}]},{"block_type":"element","block":"k67ev6gz","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6h0","search_text":"The Command-line arguments recipe in Chapter 1, Let's Begin Our Automation Journey The Sending email notifications recipe The Debugging with breakpoints recipe in Chapter 10, Debugging Techniques ","text_count":196,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Command-line arguments"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let's Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending email notifications"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Debugging with breakpoints"}]},{"block_type":"text","content":"recipe in Chapter 10,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Debugging Techniques"}]}]}]},{"block_type":"element","block":"k67ev6h1","search_text":"Setting up a cron job","text_count":21,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Setting up a cron job"}]},{"block_type":"element","block":"k67ev6h2","search_text":"Cron is an old-fashioned but reliable way of executing commands. It has been around since the 70s in Unix, and it's an old favorite in system administration to perform maintenance, such as freeing space, rotating logs, making backups, and other common operations.","text_count":263,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Cron is an old-fashioned but reliable way of executing commands. It has been around since the 70s in Unix, and it's an old favorite in system administration to perform maintenance, such as freeing space, rotating logs, making backups, and other common operations."}]},{"block_type":"element","block":"k67ev6h3","search_text":"Note This recipe is Unix-specific, so it will work in Linux and MacOS. While it's possible to schedule a task in Windows, it's very different and uses Task Scheduler, which won't be described here. If you have access to a Linux server, it can be a good way of scheduling periodic tasks. ","text_count":287,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe is Unix-specific, so it will work in Linux and MacOS. While it's possible to schedule a task in Windows, it's very different and uses Task Scheduler, which won't be described here. If you have access to a Linux server, it can be a good way of scheduling periodic tasks."}]}]},{"block_type":"element","block":"k67ev6h4","search_text":"The main advantages are as follows:","text_count":35,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main advantages are as follows:"}]},{"block_type":"element","block":"k67ev6h5","search_text":"It's present in virtually all Unix or Linux systems and configured to run automatically. It's easy to use, though a little deceptive. It's well-known. Almost anyone involved with admin tasks will have a general idea on how to use it. It allows for easy periodic commands, with good precision. ","text_count":293,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It's present in virtually all Unix or Linux systems and configured to run automatically."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It's easy to use, though a little deceptive."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It's well-known. Almost anyone involved with admin tasks will have a general idea on how to use it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It allows for easy periodic commands, with good precision."}]}]},{"block_type":"element","block":"k67ev6h6","search_text":"But, it also has some disadvantages, as follows:","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But, it also has&nbsp;some disadvantages, as follows:"}]},{"block_type":"element","block":"k67ev6h7","search_text":"By default, it may not give much feedback. Retrieving the output, logging execution, and errors is critical. The task should be as self-contained as possible to avoid problems with environment variables, such as using the wrong Python interpreter, or what path should execute. It is Unix-specific. Only fixed periodic times are available. It doesn't control how many tasks run at the same time. Each time the countdown goes off, it creates a new task. For example, a task that takes one hour to complete, and that is scheduled to run once every 45 minutes, will have 15 minutes of overlap where two tasks will be running. ","text_count":622,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"By default, it may not give much feedback. Retrieving the output, logging execution, and errors is critical."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The task should be as self-contained as possible to avoid problems with environment variables, such as using the wrong Python interpreter, or what path should execute."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It is Unix-specific."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Only fixed periodic times are available."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It doesn't control how many tasks run at the same time. Each time the countdown goes off, it creates a new task. For example, a task that takes one hour to complete, and that is scheduled to run once every 45 minutes, will have 15 minutes of overlap where two tasks will be running."}]}]},{"block_type":"element","block":"k67ev6h8","search_text":"Tip Don't understate the latest effect. Running multiple expensive tasks at the same time can have bad effects on performance. Having expensive tasks overlapping may result in a race condition where each task is making the others never finish! Allow ample time for your tasks to finish and keep an eye on them. ","text_count":311,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Don't understate the latest effect. Running multiple expensive tasks at the same time can have bad effects on performance. Having expensive tasks overlapping may result in a race condition where each task is making the others never finish! Allow ample time for your tasks to finish and keep an eye on them."}]}]},{"block_type":"element","block":"k67ev6h9","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ha","search_text":"We will produce a script, called cron.py :","text_count":42,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will produce a script, called &nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cron.py"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6hb","search_text":"import argparse import sys from datetime import datetime import configparser def main(number, other_number, output): result = number * other_number print(f'[{datetime.utcnow().isoformat()}] The result is {result}', file=output) if __name__ == '__main__': parser = argparse.ArgumentParser(formatter_class=argparse.ArgumentDefaultsHelpFormatter) parser.add_argument('--config', '-c', type=argparse.FileType('r'), help='config file', default='/etc/automate.ini') parser.add_argument('-o', dest='output', type=argparse.FileType('a'), help='output file', default=sys.stdout) args = parser.parse_args() if args.config: config = configparser.ConfigParser() config.read_file(args.config) # Transforming values into integers args.n1 = int(config['DEFAULT']['n1']) args.n2 = int(config['DEFAULT']['n2']) main(args.n1, args.n2, args.output)","text_count":829,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\nimport sys\nfrom datetime import datetime\nimport configparser\n\n\ndef main(number, other_number, output):\n    result = number * other_number\n    print(f'[{datetime.utcnow().isoformat()}] The result is {result}', \n          file=output)\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser(formatter_class=argparse.ArgumentDefaultsHelpFormatter)\n    parser.add_argument('--config', '-c', type=argparse.FileType('r'),\n                        help='config file',\n                        default='/etc/automate.ini')\n    parser.add_argument('-o', dest='output', type=argparse.FileType('a'),\n                        help='output file',\n                        default=sys.stdout)\n\n    args = parser.parse_args()\n    if args.config:\n        config = configparser.ConfigParser()\n        config.read_file(args.config)\n        # Transforming values into integers\n        args.n1 = int(config['DEFAULT']['n1'])\n        args.n2 = int(config['DEFAULT']['n2'])\n\n    main(args.n1, args.n2, args.output)"}]}]},{"block_type":"element","block":"k67ev6hc","search_text":"Note the following details:","text_count":27,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the following details:"}]},{"block_type":"element","block":"k67ev6hd","search_text":"The config file, is by default, /etc/automate.ini . Reuse config.ini from the previous recipe. A timestamp has been added to the output. This will make it explicit when the task is run. The result is being added to the file, as shown with the 'a' mode where the file is open. The ArgumentDefaultsHelpFormatter parameter automatically adds information about default values when printing the help using the -h argument. ","text_count":418,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The config file, is by default,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/etc/automate.ini"}]},{"block_type":"text","content":".&nbsp;Reuse&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"config.ini"}]},{"block_type":"text","content":"from the previous recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A timestamp has been added to the output. This will make it explicit when the task is run."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result is being added to the file, as shown with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'a'"}]},{"block_type":"text","content":"mode where the file is open."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ArgumentDefaultsHelpFormatter"}]},{"block_type":"text","content":"parameter automatically adds information about default values when printing the help using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"argument."}]}]},{"block_type":"element","block":"k67ev6he","search_text":"Check that the task is producing the expected result and that you can log to a known file:","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check that the task is producing the expected result and that you can log to a known file:"}]},{"block_type":"element","block":"k67ev6hf","search_text":"$ python3 cron.py [2018-05-15 22:22:31.436912] The result is 35 $ python3 cron.py -o /path/automate.log $ cat /path/automate.log [2018-05-15 22:28:08.833272] The result is 35","text_count":174,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 cron.py\n[2018-05-15 22:22:31.436912] The result is 35\n$ python3 cron.py -o /path/automate.log\n$ cat /path/automate.log\n[2018-05-15 22:28:08.833272] The result is 35"}]}]},{"block_type":"element","block":"k67ev6hg","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6hh","search_text":"Obtain the full path of the Python interpreter. This is the interpreter that's on your virtual environment: ","text_count":108,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the full path of the Python interpreter. This is the interpreter that's on your virtual environment:"}]}]},{"block_type":"element","block":"k67ev6hi","search_text":"$ which python /your/path/.venv/bin/python","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ which python\n/your/path/.venv/bin/python"}]}]},{"block_type":"element","block":"k67ev6hj","search_text":"Prepare the cron to be executed. Get the full path and check that it can be executed with no problem. Execute it a couple of times: ","text_count":132,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the cron to be executed. Get the full path and check that it can be executed with no problem. Execute it a couple of times:"}]}]},{"block_type":"element","block":"k67ev6hk","search_text":"$ /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log $ /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log ","text_count":142,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log\n$ /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log"}]}]},{"block_type":"element","block":"k67ev6hl","search_text":"Check that the result is being added correctly to the result file: ","text_count":67,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check that the result is being added correctly to the result file:"}]}]},{"block_type":"element","block":"k67ev6hm","search_text":"$ cat /path/automate.log [2018-05-15 22:28:08.833272] The result is 35 [2018-05-15 22:28:10.510743] The result is 35","text_count":116,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ cat /path/automate.log\n[2018-05-15 22:28:08.833272] The result is 35\n[2018-05-15 22:28:10.510743] The result is 35"}]}]},{"block_type":"element","block":"k67ev6hn","search_text":"Edit the crontab file to run the task once every five minutes: ","text_count":63,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Edit the crontab file to run the task once every five minutes:"}]}]},{"block_type":"element","block":"k67ev6ho","search_text":"$ crontab -e */5 * * * * /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log","text_count":93,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ crontab -e\n\n*/5 * * * * /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log"}]}]},{"block_type":"element","block":"k67ev6hp","search_text":"Note that this opens an editing Terminal with your default command-line editor.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that this opens an editing Terminal with your default command-line editor."}]},{"block_type":"element","block":"k67ev6hq","search_text":"Note If you haven't set up your default command-line editor, by default, it is likely Vim. This can be disconcerting if you don't have experience with Vim. Press I to start inserting text and Esc when you're done. Then, exit after saving the file with :wq . For more information about Vim, see this introduction: https://null-byte.wonderhowto.com/how-to/intro-vim-unix-text-editor-every-hacker-should-be-familiar-with-0174674 . For information on how to change the default command-line editor, see the following: https://www.a2hosting.com/kb/developer-corner/linux/setting-the-default-text-editor-in-linux. ","text_count":607,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you haven't set up your default command-line editor, by default, it is likely Vim. This can be disconcerting if you don't have experience with Vim. Press"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"I"}]},{"block_type":"text","content":"to start inserting text and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Esc&nbsp;"}]},{"block_type":"text","content":"when you're done. Then, exit after saving the file with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":":wq"}]},{"block_type":"text","content":". For more information about Vim, see this introduction:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://null-byte.wonderhowto.com/how-to/intro-vim-unix-text-editor-every-hacker-should-be-familiar-with-0174674"},"children":[{"block_type":"text","content":"https://null-byte.wonderhowto.com/how-to/intro-vim-unix-text-editor-every-hacker-should-be-familiar-with-0174674"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"For information on how to change the default command-line editor, see the following:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.a2hosting.com/kb/developer-corner/linux/setting-the-default-text-editor-in-linux"},"children":[{"block_type":"text","content":"https://www.a2hosting.com/kb/developer-corner/linux/setting-the-default-text-editor-in-linux."}]}]}]},{"block_type":"element","block":"k67ev6hr","search_text":"Check the crontab contents. Note that this displays the crontab contents, but doesn't set it to edit: ","text_count":102,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the crontab contents. Note that this displays the crontab contents, but doesn't set it to edit:"}]}]},{"block_type":"element","block":"k67ev6hs","search_text":"$ contab -l */5 * * * * /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log","text_count":92,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ contab -l\n*/5 * * * * /your/path/.venv/bin/python /your/path/cron.py -o /path/automate.log"}]}]},{"block_type":"element","block":"k67ev6ht","search_text":"Wait and check the result file to see how the task is being executed: ","text_count":70,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Wait and check the result file to see how the task is being executed:"}]}]},{"block_type":"element","block":"k67ev6hu","search_text":"$ tail -F /path/automate.log [2018-05-17 21:20:00.611540] The result is 35 [2018-05-17 21:25:01.174835] The result is 35 [2018-05-17 21:30:00.886452] The result is 35","text_count":166,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ tail -F /path/automate.log\n[2018-05-17 21:20:00.611540] The result is 35\n[2018-05-17 21:25:01.174835] The result is 35\n[2018-05-17 21:30:00.886452] The result is 35"}]}]},{"block_type":"element","block":"k67ev6hv","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6hw","search_text":"The crontab line consists of a line describing how often to run the task (first six elements), plus the task. Each of the initial six elements mean a different unit of time to execute. Most of them are stars, meaning any :","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The crontab line consists of a line describing how often to run the task (first six elements), plus the task. Each of the initial six elements mean a different unit of time to execute. Most of them are stars, meaning"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"any"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6hx","search_text":"* * * * * * | | | | | | | | | | | +-- Year (range: 1900-3000) | | | | +---- Day of the Week (range: 1-7, 1 standing for Monday) | | | +------ Month of the Year (range: 1-12) | | +-------- Day of the Month (range: 1-31) | +---------- Hour (range: 0-23) +------------ Minute (range: 0-59)","text_count":286,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"* * * * * *\n| | | | | | \n| | | | | +-- Year              (range: 1900-3000)\n| | | | +---- Day of the Week   (range: 1-7, 1 standing for Monday)\n| | | +------ Month of the Year (range: 1-12)\n| | +-------- Day of the Month  (range: 1-31)\n| +---------- Hour              (range: 0-23)\n+------------ Minute            (range: 0-59)"}]}]},{"block_type":"element","block":"k67ev6hy","search_text":"Therefore, our line, */5 * * * * * , means every time the minute is divisible by 5, in all hours, all days... all years .","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Therefore, our line,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"*/5 * * * * *"}]},{"block_type":"text","content":", means"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"every time the minute is divisible by 5, in all hours, all days... all years"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6hz","search_text":"Here are some examples:","text_count":23,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Here are some examples:"}]},{"block_type":"element","block":"k67ev6i0","search_text":"30 15 * * * * means \"every day at 15:30\" 30 * * * * * means \"every hour, at 30 minutes\" 0,30 * * * * * means \"every hour, at 0 minutes and 30 minutes\" */30 * * * * * means \"every half hour\" 0 0 * * 1 * means \"every Monday at 00:00\"","text_count":231,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"30  15 * * * * means \"every day at 15:30\"\n30   * * * * * means \"every hour, at 30 minutes\"\n0,30 * * * * * means \"every hour, at 0 minutes and 30 minutes\"\n*/30 * * * * * means \"every half hour\"\n0    0 * * 1 * means \"every Monday at 00:00\""}]}]},{"block_type":"element","block":"k67ev6i1","search_text":"Do not try to guess too much. Use a cheat sheet like https://crontab.guru/ for examples and tweaks. Most of the common usages will be described there directly. You can also edit a formula and get a descriptive text on how it's going to run.","text_count":240,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Do not try to guess too much. Use a cheat sheet like&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://crontab.guru/"},"children":[{"block_type":"text","content":"https://crontab.guru/"}]},{"block_type":"text","content":"for examples and tweaks. Most of the common usages will be described there directly. You can also edit a formula and get a descriptive text on how it's going to run."}]},{"block_type":"element","block":"k67ev6i2","search_text":"After the description of how to run the cron job, include the line to execute the task, as prepared in Step 2 in the How to do it… section.","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After the description of how to run the cron job, include the line to execute the task, as prepared in Step 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k67ev6i3","search_text":"Tip Note that the task is described with all the full paths for every related file—the interpreter, the script, and the output file. This removes all ambiguity related to paths and reduces the chances of possible errors. A very common one is not being able to determine one (or more) of the three elements. ","text_count":307,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the task is described with all the full paths for every related file&mdash;the interpreter, the script, and the output file. This removes all ambiguity related to paths and reduces the chances of possible errors. A very common one is not being able to determine one (or more) of the three elements."}]}]},{"block_type":"element","block":"k67ev6i4","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6i5","search_text":"If there's any problem in the execution of the crontab, you should receive a system mail. This will show up as a message in the Terminal, like this:","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If there's any problem in the execution of the crontab, you should receive a system mail. This will show up as a message in the Terminal, like this:"}]},{"block_type":"element","block":"k67ev6i6","search_text":"You have mail. $","text_count":16,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"You have mail.\n$"}]}]},{"block_type":"element","block":"k67ev6i7","search_text":"This can be read with mail :","text_count":28,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This can be read with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mail"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6i8","search_text":"$ mail Mail version 8.1 6/6/93. Type ? for help. \"/var/mail/jaime\": 1 message 1 new >N 1 jaime@Jaimes-iMac-5K Thu May 17 21:15 19/914 \"Cron <jaime@Jaimes-iM\" ? 1 Message 1: ... /usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/Resources/Python.app/Contents/MacOS/Python: can't open file 'cron.py': [Errno 2] No such file or directory","text_count":355,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ mail\nMail version 8.1 6/6/93. Type ? for help.\n\"/var/mail/jaime\": 1 message 1 new\n&gt;N 1 jaime@Jaimes-iMac-5K Thu May 17 21:15 19/914 \"Cron &lt;jaime@Jaimes-iM\"\n? 1\nMessage 1:\n...\n/usr/local/Cellar/python/3.7.0/Frameworks/Python.framework/Versions/3.7/Resources/Python.app/Contents/MacOS/Python: can't open file 'cron.py': [Errno 2] No such file or directory"}]}]},{"block_type":"element","block":"k67ev6i9","search_text":"In the next recipe, we will see methods to capture the errors independently so that the task can run smoothly.","text_count":110,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the next recipe, we will see methods to capture the errors independently so that the task can run smoothly."}]},{"block_type":"element","block":"k67ev6ia","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6ib","search_text":"The Adding command-line options recipe in Chapter 1, Let's Begin Our Automation Journey The Capturing errors and problems recipe ","text_count":129,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding command-line options"}]},{"block_type":"text","content":"recipe in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let's Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Capturing errors and problems"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6ic","search_text":"Capturing errors and problems","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Capturing errors and problems"}]},{"block_type":"element","block":"k67ev6id","search_text":"An automated task's main characteristic is its fire-and-forget quality. We are not actively looking at the result, but making it run in the background.","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An automated task's main characteristic is its"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"fire-and-forget"}]},{"block_type":"text","content":"&nbsp;quality. We are not actively looking at the result, but making it run in the background."}]},{"block_type":"element","block":"k67ev6ie","search_text":"Also, as most of the recipes in this book deal with external information, such as web pages or other reports, the likelihood of finding an unexpected problem when running it is high. This recipe will present an automated task that will safely store unexpected behaviors in a log file that can be checked afterwards.","text_count":315,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Also, as most of the recipes in this book deal with external information, such as web pages or other reports, the likelihood of finding an unexpected problem when running it is high. This recipe will present an automated task that will safely store unexpected behaviors in a log file that can be checked afterwards."}]},{"block_type":"element","block":"k67ev6if","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ig","search_text":"As a starting point, we'll use a task that will divide two numbers, as described in the command line.","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As a starting point, we'll use a task that will divide two numbers, as described in the command line."}]},{"block_type":"element","block":"k67ev6ih","search_text":"Note This task is very similar to the one presented in Step 5 in the How to do it… section, but instead of multiplying two numbers, we'll divide them. ","text_count":151,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This task is very similar to the one presented in Step 5 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, but instead of multiplying two numbers, we'll divide them."}]}]},{"block_type":"element","block":"k67ev6ii","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6ij","search_text":"Create the task_with_error_handling_step1.py file, as follows: ","text_count":63,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"task_with_error_handling_step1.py"}]},{"block_type":"text","content":"file, as follows:"}]}]},{"block_type":"element","block":"k67ev6ik","search_text":"import argparse import sys def main(number, other_number, output): result = number / other_number print(f'The result is {result}', file=output) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('-n1', type=int, help='A number', default=1) parser.add_argument('-n2', type=int, help='Another number', default=1) parser.add_argument('-o', dest='output', type=argparse.FileType('w'), help='output file', default=sys.stdout) args = parser.parse_args() main(args.n1, args.n2, args.output)","text_count":514,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\nimport sys\n\ndef main(number, other_number, output):\n    result = number / other_number\n    print(f'The result is {result}', file=output)\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-n1', type=int, help='A number', default=1)\n    parser.add_argument('-n2', type=int, help='Another number', default=1)      \n    parser.add_argument('-o', dest='output', type=argparse.FileType('w'),\n                        help='output file', default=sys.stdout)\n\n    args = parser.parse_args()\n\n    main(args.n1, args.n2, args.output)"}]}]},{"block_type":"element","block":"k67ev6il","search_text":"Execute it a couple of times to see that it divides two numbers: ","text_count":65,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Execute it a couple of times to see that it divides two numbers:"}]}]},{"block_type":"element","block":"k67ev6im","search_text":"$ python3 task_with_error_handling_step1.py -n1 3 -n2 2 The result is 1.5 $ python3 task_with_error_handling_step1.py -n1 25 -n2 5 The result is 5.0","text_count":148,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 task_with_error_handling_step1.py -n1 3 -n2 2\nThe result is 1.5\n$ python3 task_with_error_handling_step1.py -n1 25 -n2 5\nThe result is 5.0"}]}]},{"block_type":"element","block":"k67ev6in","search_text":"Check that dividing by 0 produces an error, and that the error is not logged on the result file: ","text_count":97,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check that dividing by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"produces an error, and that the error is not logged on the result file:"}]}]},{"block_type":"element","block":"k67ev6io","search_text":"$ python task_with_error_handling_step1.py -n1 5 -n2 1 -o result.txt $ cat result.txt The result is 5.0 $ python task_with_error_handling_step1.py -n1 5 -n2 0 -o result.txt Traceback (most recent call last): File \"task_with_error_handling_step1.py\", line 20, in <module> main(args.n1, args.n2, args.output) File \"task_with_error_handling_step1.py\", line 6, in main result = number / other_number ZeroDivisionError: division by zero $ cat result.txt","text_count":448,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python task_with_error_handling_step1.py -n1 5 -n2 1 -o result.txt\n$ cat result.txt\nThe result is 5.0\n$ python task_with_error_handling_step1.py -n1 5 -n2 0 -o result.txt\nTraceback (most recent call last):\n File \"task_with_error_handling_step1.py\", line 20, in &lt;module&gt;\n main(args.n1, args.n2, args.output)\n File \"task_with_error_handling_step1.py\", line 6, in main\n result = number / other_number\nZeroDivisionError: division by zero\n$ cat result.txt"}]}]},{"block_type":"element","block":"k67ev6ip","search_text":"Create the task_with_error_handling_step4.py file: ","text_count":51,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"task_with_error_handling_step4.py"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev6iq","search_text":"import logging import sys import logging LOG_FORMAT = '%(asctime)s %(name)s %(levelname)s %(message)s' LOG_LEVEL = logging.DEBUG def main(number, other_number, output): logging.info(f'Dividing {number} between {other_number}') result = number / other_number print(f'The result is {result}', file=output) if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('-n1', type=int, help='A number', default=1) parser.add_argument('-n2', type=int, help='Another number', default=1) parser.add_argument('-o', dest='output', type=argparse.FileType('w'), help='output file', default=sys.stdout) parser.add_argument('-l', dest='log', type=str, help='log file', default=None) args = parser.parse_args() if args.log: logging.basicConfig(format=LOG_FORMAT, filename=args.log, level=LOG_LEVEL) else: logging.basicConfig(format=LOG_FORMAT, level=LOG_LEVEL) try: main(args.n1, args.n2, args.output) except Exception as exc: logging.exception(\"Error running task\") exit(1)","text_count":981,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import logging\nimport sys\nimport logging\n\nLOG_FORMAT = '%(asctime)s %(name)s %(levelname)s %(message)s'\nLOG_LEVEL = logging.DEBUG\n\n\ndef main(number, other_number, output):\n    logging.info(f'Dividing {number} between {other_number}')\n    result = number / other_number\n    print(f'The result is {result}', file=output)\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('-n1', type=int, help='A number', default=1)\n    parser.add_argument('-n2', type=int, help='Another number', default=1)\n\n    parser.add_argument('-o', dest='output', type=argparse.FileType('w'),\n                        help='output file', default=sys.stdout)\n    parser.add_argument('-l', dest='log', type=str, help='log file',\n                        default=None)\n\n    args = parser.parse_args()\n    if args.log:\n        logging.basicConfig(format=LOG_FORMAT, filename=args.log,\n                            level=LOG_LEVEL)\n    else:\n        logging.basicConfig(format=LOG_FORMAT, level=LOG_LEVEL)\n\n    try:\n        main(args.n1, args.n2, args.output)\n    except Exception as exc:\n        logging.exception(\"Error running task\")\n        exit(1)"}]}]},{"block_type":"element","block":"k67ev6ir","search_text":"Run it to check that it displays the proper INFO and ERROR log, and that it stores it on the log file: ","text_count":103,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run it to check that it displays the proper"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INFO"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ERROR"}]},{"block_type":"text","content":"log, and that it stores it on the log file:"}]}]},{"block_type":"element","block":"k67ev6is","search_text":"$ python3 task_with_error_handling_step4.py -n1 5 -n2 0 2018-05-19 14:25:28,849 root INFO Dividing 5 between 0 2018-05-19 14:25:28,849 root ERROR division by zero Traceback (most recent call last): File \"task_with_error_handling_step4.py\", line 31, in <module> main(args.n1, args.n2, args.output) File \"task_with_error_handling_step4.py\", line 10, in main result = number / other_number ZeroDivisionError: division by zero $ python3 task_with_error_handling_step4.py -n1 5 -n2 0 -l error.log $ python3 task_with_error_handling_step4.py -n1 5 -n2 0 -l error.log $ cat error.log 2018-05-19 14:26:15,376 root INFO Dividing 5 between 0 2018-05-19 14:26:15,376 root ERROR division by zero Traceback (most recent call last): File \"task_with_error_handling_step4.py\", line 33, in <module> main(args.n1, args.n2, args.output) File \"task_with_error_handling_step4.py\", line 11, in main result = number / other_number ZeroDivisionError: division by zero 2018-05-19 14:26:19,960 root INFO Dividing 5 between 0 2018-05-19 14:26:19,961 root ERROR division by zero Traceback (most recent call last): File \"task_with_error_handling_step4.py\", line 33, in <module> main(args.n1, args.n2, args.output) File \"task_with_error_handling_step4.py\", line 11, in main result = number / other_number ZeroDivisionError: division by zero","text_count":1310,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 task_with_error_handling_step4.py -n1 5 -n2 0\n2018-05-19 14:25:28,849 root INFO Dividing 5 between 0\n2018-05-19 14:25:28,849 root ERROR division by zero\nTraceback (most recent call last):\n  File \"task_with_error_handling_step4.py\", line 31, in &lt;module&gt;\n    main(args.n1, args.n2, args.output)\n  File \"task_with_error_handling_step4.py\", line 10, in main\n    result = number / other_number\nZeroDivisionError: division by zero\n$ python3 task_with_error_handling_step4.py -n1 5 -n2 0 -l error.log\n$ python3 task_with_error_handling_step4.py -n1 5 -n2 0 -l error.log\n$ cat error.log\n2018-05-19 14:26:15,376 root INFO Dividing 5 between 0\n2018-05-19 14:26:15,376 root ERROR division by zero\nTraceback (most recent call last):\n  File \"task_with_error_handling_step4.py\", line 33, in &lt;module&gt;\n    main(args.n1, args.n2, args.output)\n  File \"task_with_error_handling_step4.py\", line 11, in main\n    result = number / other_number\nZeroDivisionError: division by zero\n2018-05-19 14:26:19,960 root INFO Dividing 5 between 0\n2018-05-19 14:26:19,961 root ERROR division by zero\nTraceback (most recent call last):\n  File \"task_with_error_handling_step4.py\", line 33, in &lt;module&gt;\n    main(args.n1, args.n2, args.output)\n  File \"task_with_error_handling_step4.py\", line 11, in main\n    result = number / other_number\nZeroDivisionError: division by zero"}]}]},{"block_type":"element","block":"k67ev6it","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6iu","search_text":"To properly capture any unexpected exceptions, the main function should be wrapped into a try-except block, as done in Step 4 in the How to do it… section. Compare this to how Step 1 is not wrapping the code:","text_count":208,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To properly capture any unexpected exceptions, the main function should be wrapped into a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"try-except"}]},{"block_type":"text","content":"block, as done in Step 4 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section. Compare this to how Step 1 is not wrapping the code:"}]},{"block_type":"element","block":"k67ev6iv","search_text":"try: main(...) except Exception as exc: # Something went wrong logging.exception(\"Error running task\") exit(1)","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"try:\n        main(...)\n    except Exception as exc:\n        # Something went wrong\n        logging.exception(\"Error running task\")\n        exit(1)"}]}]},{"block_type":"element","block":"k67ev6iw","search_text":"Note that logging the exception is important for getting information on what went wrong.","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that logging the exception is important for getting information on what went wrong."}]},{"block_type":"element","block":"k67ev6ix","search_text":"Tip This kind of exception is nicknamed Pokémon , because it can catch'em all , as it will capture any unexpected error at the highest level. Do not use it in other areas of the code, as capturing everything can hide unexpected errors. At the very least, any unexpected exception should be logged to allow for further analysis. ","text_count":328,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This kind of exception is nicknamed"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Pok&eacute;mon"}]},{"block_type":"text","content":", because it can"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"catch'em all"}]},{"block_type":"text","content":", as it will capture any unexpected error at the highest level. Do not use it in other areas of the code, as capturing everything can hide unexpected errors. At the very least, any unexpected exception should be logged to allow for further analysis."}]}]},{"block_type":"element","block":"k67ev6iy","search_text":"The extra step to exit with status 1 with the exit(1) call informs the operating system that something went wrong with our script.","text_count":130,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The extra step to exit with status 1 with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"exit(1)"}]},{"block_type":"text","content":"call informs the operating system that something went wrong with our script."}]},{"block_type":"element","block":"k67ev6iz","search_text":"The logging module allows us to log. Note the basic configuration, which includes an optional file to store the logs, the format, and the level of the logs to display.","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging"}]},{"block_type":"text","content":"module allows us to log. Note the basic configuration, which includes an optional file to store the logs, the format, and the level of the logs to display."}]},{"block_type":"element","block":"k67ev6j0","search_text":"Note The available level for logs are, from less critical to more critical— DEBUG , INFO , WARNING , ERROR , and CRITICAL . The logging level will set the minimal severity required to log the message. For example, an INFO log won't be stored if the severity is set to WARNING . ","text_count":278,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The available level for logs are, from less critical to more critical&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DEBUG"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INFO"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"WARNING"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ERROR"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CRITICAL"}]},{"block_type":"text","content":". The logging level will set the minimal severity required to log the message. For example, an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INFO"}]},{"block_type":"text","content":"log won't be stored if the severity is set to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"WARNING"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6j1","search_text":"Creating logs is easy. You can do this by making a call to the method logging.<logging level> , (where logging level is debug , info , and so on). For example:","text_count":159,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Creating logs is easy. You can do this by making a call to the method&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging.&lt;logging level&gt;"}]},{"block_type":"text","content":", (where"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging level"}]},{"block_type":"text","content":"is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debug"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"info"}]},{"block_type":"text","content":", and so on). For example:"}]},{"block_type":"element","block":"k67ev6j2","search_text":">>> import logging >>> logging.basicConfig(level=logging.INFO) >>> logging.warning('a warning message') WARNING:root:a warning message >>> logging.info('an info message') INFO:root:an info message >>> logging.debug('a debug message') >>>","text_count":237,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import logging\n&gt;&gt;&gt; logging.basicConfig(level=logging.INFO)\n&gt;&gt;&gt; logging.warning('a warning message')\nWARNING:root:a warning message\n&gt;&gt;&gt; logging.info('an info message')\nINFO:root:an info message\n&gt;&gt;&gt; logging.debug('a debug message')\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev6j3","search_text":"Note how logs with a severity lower than INFO are not displayed. Use the level definition to tweak how much information to display. This may change, for example, how DEBUG logs may be used only while developing the task, but not be displayed when running it. Notice that task_with_error_handling_step4.py is defining the logging level to be DEBUG , by default.","text_count":360,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note how logs with a&nbsp;severity lower than"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INFO"}]},{"block_type":"text","content":"are not displayed. Use the level definition to tweak how much information to display. This may change, for example, how"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DEBUG"}]},{"block_type":"text","content":"logs may be used only while developing the task, but not be displayed when running it. Notice that&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"task_with_error_handling_step4.py"}]},{"block_type":"text","content":"is defining the logging level to be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DEBUG"}]},{"block_type":"text","content":", by default."}]},{"block_type":"element","block":"k67ev6j4","search_text":"Tip A good definition of log levels is key to displaying relevant information, while reducing spam. It is not easy to set up sometimes, but especially if more than one person is involved, try to agree on exactly what WARNING versus ERROR means to avoid misinterpretations. ","text_count":273,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A good definition of log levels is key to displaying relevant information, while reducing spam. It is not easy to set up sometimes, but especially if more than one person is involved, try to agree on exactly what"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"WARNING"}]},{"block_type":"text","content":"versus"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ERROR"}]},{"block_type":"text","content":"means to avoid misinterpretations."}]}]},{"block_type":"element","block":"k67ev6j5","search_text":"logging.exception() is a special case that will create an ERROR log, but it will also include information about the exception, such as the stack trace .","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging.exception()"}]},{"block_type":"text","content":"is a special case that will create an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ERROR"}]},{"block_type":"text","content":"log, but it will also include information about the exception, such as the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"stack trace"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6j6","search_text":"Remember to check logs to discover errors. A useful reminder is to add a note on the results file, like this:","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember to check logs to discover errors. A useful reminder is to add a note on the results file, like this:"}]},{"block_type":"element","block":"k67ev6j7","search_text":"try: main(args.n1, args.n2, args.output) except Exception as exc: logging.exception(exc) print('There has been an error. Check the logs', file=args.output)","text_count":155,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"try:\n    main(args.n1, args.n2, args.output)\nexcept Exception as exc:\n    logging.exception(exc)\n    print('There has been an error. Check the logs', file=args.output)"}]}]},{"block_type":"element","block":"k67ev6j8","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6j9","search_text":"The Python logging module has a lot of capabilities, such as the following:","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logging"}]},{"block_type":"text","content":"module has a lot of capabilities, such as the following:"}]},{"block_type":"element","block":"k67ev6ja","search_text":"Further tweaks the format of the log, for example, including the file and line number of the log that was produced. Defines different logger objects, each one with its own configuration, like logging level and format. This allows to produce logs to different systems in different ways, though is normally not used for simplicity. Sends logs to multiple places, such as that standard output and file, or even a remote logger. Automatically rotates logs, creating new log files after a certain time or size. This is handy in keeping logs organized by day, and allowing for the compression or removal of old logs. Reads standard logging configurations from files. ","text_count":661,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Further tweaks the format of the log, for example, including the file and line number of the log that was produced."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Defines different logger objects, each one with its own configuration, like logging level and format. This allows to produce logs to different systems in different ways, though is normally not used for simplicity."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Sends logs to multiple places, such as that standard output and file, or even a remote logger."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Automatically rotates logs, creating new log files after a certain time or size. This is handy in keeping logs organized by day, and allowing for the compression or removal of old logs."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reads standard logging configurations from files."}]}]},{"block_type":"element","block":"k67ev6jb","search_text":"Tip Instead of creating complex rules, try to log extensively, but with the proper level, and then filter. ","text_count":107,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead of creating complex rules, try to log&nbsp; extensively, but&nbsp;with the proper level, and then filter."}]}]},{"block_type":"element","block":"k67ev6jc","search_text":"For comprehensive detail, check the Python docs of the module at https://docs.python.org/3.7/library/logging.html , or the tutorial at https://docs.python.org/3.7/howto/logging.html .","text_count":183,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For comprehensive detail, check the Python docs of the module at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.7/library/logging.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3.7/library/logging.html"}]},{"block_type":"text","content":", or the tutorial at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.7/howto/logging.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3.7/howto/logging.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6jd","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6je","search_text":"The Adding command-line options recipe in Chapter 1, Let's Begin Our Automation Journey The Preparing a task recipe ","text_count":116,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding command-line options"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let's Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Preparing a task"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6jf","search_text":"Sending email notifications","text_count":27,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Sending email notifications"}]},{"block_type":"element","block":"k67ev6jg","search_text":"Email has become an inescapable tool that everyone uses everyday. It's probably the best place to send a notification if an automated task has detected something. On the other hand, email inboxes are already too filled up with spam messages, so be careful. ","text_count":257,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Email has become an inescapable tool that everyone uses everyday. It's probably the best place to send a notification if an automated task has detected something. On the other hand, email inboxes are already too filled up with spam messages, so be careful.&nbsp;"}]},{"block_type":"element","block":"k67ev6jh","search_text":"Note Spam filters are also a reality. Be careful with who to send emails to and the number of emails to be sent. An email server or address can be labelled as spam, and all emails will be quietly dropped by the internet. ","text_count":221,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Spam filters are also a reality. Be careful with who to send emails to and the number of emails to be sent. An email server or address can be labelled as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"spam,"}]},{"block_type":"text","content":"and all emails will be quietly dropped by the internet."}]}]},{"block_type":"element","block":"k67ev6ji","search_text":"This recipe will show how to send a single email, using an already existing email account.","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe will show how to send a single email, using an already existing email account."}]},{"block_type":"element","block":"k67ev6jj","search_text":"This approach is viable for spare emails sent to a couple of people, as a result from an automated task, but no more than that.","text_count":127,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This approach is viable for spare emails sent to a couple of people, as a result from an automated task, but no more than that."}]},{"block_type":"element","block":"k67ev6jk","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6jl","search_text":"For this recipe, we require a valid email account set up, which includes the following:","text_count":87,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we require&nbsp;a valid email account set up, which includes the following:"}]},{"block_type":"element","block":"k67ev6jm","search_text":"A valid email server A port to connect to An address A password ","text_count":64,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A valid email server"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A port to connect to"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"An address"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A password"}]}]},{"block_type":"element","block":"k67ev6jn","search_text":"These four elements should be enough to be able to send an email.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These four elements should be enough to be able to send an email."}]},{"block_type":"element","block":"k67ev6jo","search_text":"Tip Some email services, for example, Gmail, will encourage you to set up 2FA, meaning that a password is not enough to send an email. Typically, they'll allow you to create an specific password for apps to use, bypassing the 2FA request. Check your email provider's information for options. ","text_count":292,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some email services, for example, Gmail, will encourage you to set up 2FA, meaning that a password is not enough to send an email. Typically, they'll allow you to create an specific password for apps to use, bypassing the 2FA request. Check your email provider's information for options."}]}]},{"block_type":"element","block":"k67ev6jp","search_text":"The email provider to use should indicate what the SMTP server is and port to use in their documentation. They can be retrieved from email clients as well, as they are the same parameters. Check your provider documentation. In the following example, we will use a Gmail account.","text_count":278,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The email provider to use should indicate what the SMTP server is and port to use in their documentation. They can be retrieved from email clients as well, as they are the same parameters. Check your provider documentation. In the following example, we will use a Gmail account."}]},{"block_type":"element","block":"k67ev6jq","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6jr","search_text":"Create the email_task.py file, as follows: ","text_count":43,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_task.py"}]},{"block_type":"text","content":"file, as follows:"}]}]},{"block_type":"element","block":"k67ev6js","search_text":"import argparse import configparser import smtplib from email.message import EmailMessage def main(to_email, server, port, from_email, password): print(f'With love, from {from_email} to {to_email}') # Create the message subject = 'With love, from ME to YOU' text = '''This is an example test''' msg = EmailMessage() msg.set_content(text) msg['Subject'] = subject msg['From'] = from_email msg['To'] = to_email # Open communication and send server = smtplib.SMTP_SSL(server, port) server.login(from_email, password) server.send_message(msg) server.quit() if __name__ == '__main__': parser = argparse.ArgumentParser() parser.add_argument('email', type=str, help='destination email') parser.add_argument('-c', dest='config', type=argparse.FileType('r'), help='config file', default=None) args = parser.parse_args() if not args.config: print('Error, a config file is required') parser.print_help() exit(1) config = configparser.ConfigParser() config.read_file(args.config) main(args.email, server=config['DEFAULT']['server'], port=config['DEFAULT']['port'], from_email=config['DEFAULT']['email'], password=config['DEFAULT']['password'])","text_count":1131,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import argparse\nimport configparser\n\nimport smtplib \nfrom email.message import EmailMessage\n\n\ndef main(to_email, server, port, from_email, password):\n    print(f'With love, from {from_email} to {to_email}')\n\n    # Create the message\n    subject = 'With love, from ME to YOU'\n    text = '''This is an example test'''\n    msg = EmailMessage()\n    msg.set_content(text)\n    msg['Subject'] = subject\n    msg['From'] = from_email\n    msg['To'] = to_email\n\n    # Open communication and send\n    server = smtplib.SMTP_SSL(server, port)\n    server.login(from_email, password)\n    server.send_message(msg)\n    server.quit()\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    parser.add_argument('email', type=str, help='destination email')\n    parser.add_argument('-c', dest='config', type=argparse.FileType('r'),\n                        help='config file', default=None)\n\n    args = parser.parse_args()\n    if not args.config:\n        print('Error, a config file is required')\n        parser.print_help()\n        exit(1)\n\n    config = configparser.ConfigParser()\n    config.read_file(args.config)\n\n    main(args.email,\n         server=config['DEFAULT']['server'],\n         port=config['DEFAULT']['port'],\n         from_email=config['DEFAULT']['email'],\n         password=config['DEFAULT']['password'])"}]}]},{"block_type":"element","block":"k67ev6jt","search_text":"Create a configuration file called email_conf.ini with the specifics of your email account. For example, for a Gmail account, fill the following template. The template is available in GitHub https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter02/email_conf.ini , but be sure to fill it with your data: ","text_count":331,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a configuration file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_conf.ini"}]},{"block_type":"text","content":"with the specifics of your email account. For example, for a Gmail account, fill the following template. The template is available in GitHub"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter02/email_conf.ini"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter02/email_conf.ini"}]},{"block_type":"text","content":", but be sure to fill it with your data:"}]}]},{"block_type":"element","block":"k67ev6ju","search_text":"[DEFAULT] email = EMAIL@gmail.com server = smtp.gmail.com port = 465 password = PASSWORD","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[DEFAULT]\nemail = EMAIL@gmail.com\nserver = smtp.gmail.com\nport = 465\npassword = PASSWORD"}]}]},{"block_type":"element","block":"k67ev6jv","search_text":"Ensure that the file cannot be read or written by other users on the system, setting the permissions of the file to allow only our user. 600 permissions means read and write access for our user, and no access to anyone else: ","text_count":225,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Ensure that the file cannot be read or written by other users on the system, setting the permissions of the file to allow only our user."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"600"}]},{"block_type":"text","content":"permissions means read and write access for our user, and no access to anyone else:"}]}]},{"block_type":"element","block":"k67ev6jw","search_text":"$ chmod 600 email_config.ini","text_count":28,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ chmod 600 email_config.ini"}]}]},{"block_type":"element","block":"k67ev6jx","search_text":"Run the script to send a test email: ","text_count":37,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script to send a test email:"}]}]},{"block_type":"element","block":"k67ev6jy","search_text":"$ python3 email_task.py -c email_config.ini destination_email@server.com","text_count":72,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 email_task.py -c email_config.ini destination_email@server.com"}]}]},{"block_type":"element","block":"k67ev6jz","search_text":"Check the inbox of the destination email; an email should be received with the subject With love, from ME to YOU . ","text_count":115,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the inbox of the destination email; an email should be received with the subject&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"With love, from ME to YOU"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6k0","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6k1","search_text":"There are two key steps in the scripts—the generation of the message, and the sending.","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are two key steps in the scripts&mdash;the generation of the message, and the sending."}]},{"block_type":"element","block":"k67ev6k2","search_text":"The message needs to contain mainly the To and From email addresses, as well as the Subject . If the content is pure text, as in this case, calling .set_content() is enough. The whole message can then be sent.","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The message needs to contain mainly the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"To"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"From"}]},{"block_type":"text","content":"email addresses, as well as the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Subject"}]},{"block_type":"text","content":". If the content is pure text, as in this case, calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".set_content()&nbsp;"}]},{"block_type":"text","content":"is enough. The whole message can then be sent."}]},{"block_type":"element","block":"k67ev6k3","search_text":"Tip It is technically possible to send an email from a different email than the account used to send it. This is discouraged, though, as it can be considered by your email provider as trying to impersonate a different email. You can use the reply-to header as a way of allowing answering to a different account. ","text_count":312,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is technically possible to send an email from a different email than the account used to send it. This is discouraged, though, as it can be considered by your email provider as trying to impersonate a different email. You can use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"reply-to"}]},{"block_type":"text","content":"header as a way of allowing answering to a different account."}]}]},{"block_type":"element","block":"k67ev6k4","search_text":"Sending the email requires you to connect to the specified server and start an SMPT connection. SMPT is the standard for email communication. ","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sending the email requires you to connect to the specified server and start an SMPT connection. SMPT is the standard for email communication.&nbsp;"}]},{"block_type":"element","block":"k67ev6k5","search_text":"The steps are quite straightforward—configure the server, log into it, send the prepared message, and quit.","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The steps are quite straightforward&mdash;configure the server, log into it, send the prepared message, and quit."}]},{"block_type":"element","block":"k67ev6k6","search_text":"Tip If you need to send more than one message, you can log in, send multiple emails, and then quit, instead of connecting each time. ","text_count":133,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to send more than one message, you can log in, send multiple emails, and then quit, instead of connecting each time."}]}]},{"block_type":"element","block":"k67ev6k7","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6k8","search_text":"Note If the objective is a bigger operation, like a marketing campaign, or even production emails like confirming a user's email, please check Chapter 8, Dealing with Communication Channels ","text_count":190,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the objective is a bigger operation, like a marketing campaign, or even production emails like confirming a user's email, please check Chapter 8,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]}]}]},{"block_type":"element","block":"k67ev6k9","search_text":"The email message content used in this recipe is very simple, but emails can be much more complicated than that.","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The email message content used in this recipe is very simple, but emails can be much more complicated than that."}]},{"block_type":"element","block":"k67ev6ka","search_text":"The To field can contain multiple recipients. Separate them with commas, like this:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"To"}]},{"block_type":"text","content":"field can contain multiple recipients. Separate them with commas, like this:"}]},{"block_type":"element","block":"k67ev6kb","search_text":"message['To'] = ','.join(recipients)","text_count":36,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"message['To'] = ','.join(recipients)"}]}]},{"block_type":"element","block":"k67ev6kc","search_text":"Emails can be defined in HTML, with an alternative plain text, and have attachments. The basic operation is to set up a MIMEMultipart and then attach each of the MIME parts that compose the email:","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Emails can be defined in HTML, with an alternative plain text, and have attachments. The basic operation is to set up a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MIMEMultipart"}]},{"block_type":"text","content":"and then attach each of the MIME parts that compose the email:"}]},{"block_type":"element","block":"k67ev6kd","search_text":"from email.mime.multipart import MIMEMultipart from email.mime.text import MIMEText from email.mime.image import MIMEImage message = MIMEMultipart() part1 = MIMEText('some text', 'plain') message.attach(part1) with open('path/image', 'rb') as image: part2 = MIMEImage(image.read()) message.attach(part2)","text_count":303,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\nfrom email.mime.image import MIMEImage\n\nmessage = MIMEMultipart()\npart1 = MIMEText('some text', 'plain')\nmessage.attach(part1)\nwith open('path/image', 'rb') as image:\n    part2 = MIMEImage(image.read())\nmessage.attach(part2)"}]}]},{"block_type":"element","block":"k67ev6ke","search_text":"The most common SMPT connection is SMPT_SSL , which is more secure and requires a login and password, but plain, unauthenticated SMPT exists; check your email provider documentation.","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most common SMPT connection is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SMPT_SSL"}]},{"block_type":"text","content":", which is more secure and requires a login and password, but plain, unauthenticated SMPT exists; check your email provider documentation."}]},{"block_type":"element","block":"k67ev6kf","search_text":"Tip Remember that this recipe is aimed for simple notifications. Emails can grow quite complex if attaching different information. If your objective is an email for customers or any general group, try to use the ideas in Chapter 8, Dealing with Communication Channels . ","text_count":270,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember that this recipe is aimed for simple notifications. Emails can grow quite complex if attaching different information. If your objective is an email for customers or any general group, try to use the ideas in Chapter 8,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6kg","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6kh","search_text":"The Adding command-line options recipe in Chapter 1, Let's Begin Our Automation Journey The Preparing a task recipe ","text_count":116,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding command-line options"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let's Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Preparing a task"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Building Your First Web Scraping Application","author":"Jaime Buelta","block":"k67eunmn","number":3,"contents":[{"block_type":"element","block":"k67ev6ki","search_text":"In this chapter, we'll cover the following recipes:","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we'll cover the following recipes:"}]},{"block_type":"element","block":"k67ev6kj","search_text":"Downloading web pages Parsing HTML Crawling the web Subscribing to feeds Accessing web APIs Interacting with forms Using Selenium for advanced interaction Accessing password-protected pages Speeding up web scraping ","text_count":215,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Crawling the web"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Subscribing to feeds"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Accessing web APIs"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Interacting with forms"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using Selenium for advanced interaction"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Accessing password-protected pages"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Speeding up web scraping"}]}]},{"block_type":"element","block":"k67ev6kk","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev6kl","search_text":"The internet, and the WWW ( World Wide Web ), is probably the most prominent source of information today. Most of that information is retrievable through the HTTP protocol. HTTP was invented originally to share pages of hypertext (hence the name HyperText Transfer Protocol ), which started the WWW.","text_count":299,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The internet, and the&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"WWW"}]},{"block_type":"text","content":"&nbsp;("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"World Wide Web"}]},{"block_type":"text","content":"), is probably the most prominent source of information today. Most of that information is retrievable through the HTTP protocol."},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"HTTP"}]},{"block_type":"text","content":"was invented originally to share pages of hypertext (hence the name"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"HyperText Transfer Protocol"}]},{"block_type":"text","content":"), which started the WWW."}]},{"block_type":"element","block":"k67ev6km","search_text":"This operation is very familiar, as it is what happens in any web browser. But we can also perform those operations programmatically to automatically retrieve and process information. Python has included in the standard library an HTTP client, but the fantastic requests module makes it very easy. In this chapter, we will see how.","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This operation is very familiar, as it is what happens in any web browser. But we can also perform those operations programmatically to automatically retrieve and process information. Python has included in the standard library an HTTP client, but the fantastic"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"module makes it very easy. In this chapter, we will see how."}]},{"block_type":"element","block":"k67ev6kn","search_text":"Downloading web pages","text_count":21,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"element","block":"k67ev6ko","search_text":"The basic ability to download a web page involves making an HTTP GET request against a URL. This is the basic operation of any web browser. Let's quickly recap the different parts of this operation:","text_count":198,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic ability to download a web page involves making an HTTP"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"request against a URL. This is the basic operation of any web browser. Let's quickly recap the different parts of this operation:"}]},{"block_type":"element","block":"k67ev6kp","search_text":"Using the HTTP protocol. Using the GET method, which is the most common HTTP method. We'll see more in the Accessing web APIs recipe. URL describing the full address of the page, including the server and the path. ","text_count":214,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using the HTTP protocol."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"method, which is the most common HTTP method. We'll see more in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Accessing web APIs"}]},{"block_type":"text","content":"recipe."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"URL describing the full address of the page, including the server and the path."}]}]},{"block_type":"element","block":"k67ev6kq","search_text":"That request will be processed by the server and a response will be sent back. This response will contain a status code , typically 200 if everything went fine, and a body with the result, which will normally be text with an HTML page.","text_count":235,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That request will be processed by the server and a response will be sent back. This response will contain a"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"status code"}]},{"block_type":"text","content":", typically 200 if everything went fine, and a body with the result, which will normally be text with an HTML page."}]},{"block_type":"element","block":"k67ev6kr","search_text":"Most of this is handled automatically by the HTTP client used to perform the request. We'll see in this recipe how to make a simple request to obtain a web page.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most of this is handled automatically by the HTTP client used to perform the request. We'll see in this recipe how to make a simple request to obtain a web page."}]},{"block_type":"element","block":"k67ev6ks","search_text":"Note HTTP requests and responses can also contain headers. Headers contain extra information, such as the total size of the request, the format of the content, the date of the request, and what browser or server is used. ","text_count":221,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"HTTP requests and responses can also contain headers. Headers contain extra information, such as the total size of the request, the format of the content, the date of the request, and what browser or server is used.&nbsp;"}]}]},{"block_type":"element","block":"k67ev6kt","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ku","search_text":"Using the fantastic requests module, getting web pages is super simple. Install the module:","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using the fantastic"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"module, getting web pages is super simple. Install the module:"}]},{"block_type":"element","block":"k67ev6kv","search_text":"$ echo \"requests==2.18.3\" >> requirements.txt $ source .venv/bin/activate (.venv) $ pip install -r requirements.txt ","text_count":116,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"requests==2.18.3\" &gt;&gt; requirements.txt\n$ source .venv/bin/activate\n(.venv) $ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev6kw","search_text":"We'll download the page at http://www.columbia.edu/~fdc/sample.html because it is a straightforward HTML page that is easy to read in text mode.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll download the page at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.columbia.edu/~fdc/sample.html"},"children":[{"block_type":"text","content":"http://www.columbia.edu/~fdc/sample.html"}]},{"block_type":"text","content":"&nbsp;because it is a straightforward HTML page that is easy to read in text mode."}]},{"block_type":"element","block":"k67ev6kx","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6ky","search_text":"Import the requests module: ","text_count":28,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev6kz","search_text":">>> import requests","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests"}]}]},{"block_type":"element","block":"k67ev6l0","search_text":"Make a request to the URL, which will take a second or two: ","text_count":60,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make a request to the URL, which will take a second or two:"}]}]},{"block_type":"element","block":"k67ev6l1","search_text":">>> url = 'http://www.columbia.edu/~fdc/sample.html' >>> response = requests.get(url)","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; url = 'http://www.columbia.edu/~fdc/sample.html'\n&gt;&gt;&gt; response = requests.get(url)"}]}]},{"block_type":"element","block":"k67ev6l2","search_text":"Check the returned object status code: ","text_count":39,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the returned object status code:"}]}]},{"block_type":"element","block":"k67ev6l3","search_text":">>> response.status_code 200","text_count":28,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response.status_code\n200"}]}]},{"block_type":"element","block":"k67ev6l4","search_text":"Check the content of the result: ","text_count":33,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the content of the result:"}]}]},{"block_type":"element","block":"k67ev6l5","search_text":">>> response.text '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\\n<html>\\n<head>\\n ... FULL BODY ... <!-- close the <html> begun above -->\\n'","text_count":159,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response.text\n'&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"&gt;\\n&lt;html&gt;\\n&lt;head&gt;\\n\n...\nFULL BODY\n...\n&lt;!-- close the &lt;html&gt; begun above --&gt;\\n'"}]}]},{"block_type":"element","block":"k67ev6l6","search_text":"Check the ongoing and returned headers: ","text_count":40,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the ongoing and returned headers:"}]}]},{"block_type":"element","block":"k67ev6l7","search_text":">>> response.request.headers {'User-Agent': 'python-requests/2.18.4', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'} >>> response.headers {'Date': 'Fri, 25 May 2018 21:51:47 GMT', 'Server': 'Apache', 'Last-Modified': 'Thu, 22 Apr 2004 15:52:25 GMT', 'Accept-Ranges': 'bytes', 'Vary': 'Accept-Encoding,User-Agent', 'Content-Encoding': 'gzip', 'Content-Length': '8664', 'Keep-Alive': 'timeout=15, max=85', 'Connection': 'Keep-Alive', 'Content-Type': 'text/html', 'Set-Cookie': 'BIGipServer~CUIT~www.columbia.edu-80-pool=1764244352.20480.0000; expires=Sat, 26-May-2018 03:51:47 GMT; path=/; Httponly'}","text_count":632,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response.request.headers\n{'User-Agent': 'python-requests/2.18.4', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'}\n&gt;&gt;&gt; response.headers\n{'Date': 'Fri, 25 May 2018 21:51:47 GMT', 'Server': 'Apache', 'Last-Modified': 'Thu, 22 Apr 2004 15:52:25 GMT', 'Accept-Ranges': 'bytes', 'Vary': 'Accept-Encoding,User-Agent', 'Content-Encoding': 'gzip', 'Content-Length': '8664', 'Keep-Alive': 'timeout=15, max=85', 'Connection': 'Keep-Alive', 'Content-Type': 'text/html', 'Set-Cookie': 'BIGipServer~CUIT~www.columbia.edu-80-pool=1764244352.20480.0000; expires=Sat, 26-May-2018 03:51:47 GMT; path=/; Httponly'}"}]}]},{"block_type":"element","block":"k67ev6l8","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6l9","search_text":"The operation of requests is very simple; perform the operation, GET in this case, over the URL. This returns a result object that can be analyzed. The main elements are the status_code and the body content, which can be presented as text .","text_count":240,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The operation of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"is very simple; perform the operation,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"in this case, over the URL. This returns a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"result"}]},{"block_type":"text","content":"object that can be analyzed. The main elements are the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"status_code"}]},{"block_type":"text","content":"and the body content, which can be presented as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"text"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6la","search_text":"The full request can be checked in the request field:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full request can be checked in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"request"}]},{"block_type":"text","content":"field:"}]},{"block_type":"element","block":"k67ev6lb","search_text":">>> response.request <PreparedRequest [GET]> >>> response.request.url 'http://www.columbia.edu/~fdc/sample.html'","text_count":112,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response.request\n&lt;PreparedRequest [GET]&gt;\n&gt;&gt;&gt; response.request.url\n'http://www.columbia.edu/~fdc/sample.html'"}]}]},{"block_type":"element","block":"k67ev6lc","search_text":"The full request's documentation can be found here: http://docs.python-requests.org/en/master/ . Over the course of the chapter, we'll be showing more features.","text_count":160,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full request's documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python-requests.org/en/master/"},"children":[{"block_type":"text","content":"http://docs.python-requests.org/en/master/"}]},{"block_type":"text","content":". Over the course of the chapter, we'll be showing more features."}]},{"block_type":"element","block":"k67ev6ld","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6le","search_text":"All HTTP status codes can be checked on this web page: https://httpstatuses.com/ . They are also described in the httplib module with convenient constant names, such as OK , NOT_FOUND , or FORBIDDEN .","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All HTTP status codes can be checked on this web page:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://httpstatuses.com/"},"children":[{"block_type":"text","content":"https://httpstatuses.com/"}]},{"block_type":"text","content":". They are also described in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"httplib"}]},{"block_type":"text","content":"module with convenient constant names, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"OK"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"NOT_FOUND"}]},{"block_type":"text","content":", or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FORBIDDEN"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6lf","search_text":"Tip The most famous error status code is arguably 404, which happens when a URL is not found. Try it out by doing requests.get('http://www.columbia.edu/invalid') . ","text_count":164,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most famous error status code is arguably 404, which happens when a URL is not found.&nbsp;Try it out by doing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests.get('http://www.columbia.edu/invalid')"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6lg","search_text":"A request can use the HTTPS protocol ( secure HTTP ). It is equivalent, but ensures that the contents of the request and response are private. requests handles it transparently.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A request can use the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"HTTPS"}]},{"block_type":"text","content":"protocol ("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"secure HTTP"}]},{"block_type":"text","content":"). It is equivalent, but ensures that the contents of the request and response are private."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"handles it transparently."}]},{"block_type":"element","block":"k67ev6lh","search_text":"Tip Any website that handles any private information will use HTTPS to ensure that the information has not leaked out. HTTP is vulnerable to someone eavesdropping. Use HTTPS where available. ","text_count":191,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Any website that handles any private information will use HTTPS to ensure that the information has not leaked out. HTTP is vulnerable to someone eavesdropping. Use HTTPS where available."}]}]},{"block_type":"element","block":"k67ev6li","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6lj","search_text":"The Installing third-party packages recipe in Chapter 1, Let Us Begin Our Automation Journey The Parsing HTML recipe ","text_count":117,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6lk","search_text":"Parsing HTML","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"element","block":"k67ev6ll","search_text":"Downloading raw text or a binary file is a good starting point, but the main language of the web is HTML.","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Downloading raw text or a binary file is a good starting point, but the main language of the web is HTML."}]},{"block_type":"element","block":"k67ev6lm","search_text":"HTML is a structured language, defining different parts of a document such as headers and paragraphs. HTML is also hierarchical, defining sub-elements. The ability to parse raw text into a structured document is basically to be able to extract information automatically from a web page. For example, some text can be relevant if enclosed in a particular class div or after a header h3 tag.","text_count":389,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"HTML is a structured language, defining different parts of a document such as headers and paragraphs. HTML is also hierarchical, defining sub-elements. The ability to parse raw text into a structured document is basically to be able to extract information automatically from a web page. For example, some text can be relevant if enclosed in a particular"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"class div"}]},{"block_type":"text","content":"&nbsp;or after a header"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"h3"}]},{"block_type":"text","content":"tag."}]},{"block_type":"element","block":"k67ev6ln","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6lo","search_text":"We'll use the excellent Beautiful Soup module to parse the HTML text into a memory object that can be analyzed. We need to use the beautifulsoup4 package to use the latest Python 3 version that is available. Add the package to your requirements.txt and install the dependencies in the virtual environment:","text_count":305,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the excellent Beautiful Soup module to parse the HTML text into a memory object that can be analyzed. We need to use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"beautifulsoup4"}]},{"block_type":"text","content":"&nbsp;package&nbsp;to use the latest Python 3 version that is available. Add the package to your"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"and install the dependencies in the virtual environment:"}]},{"block_type":"element","block":"k67ev6lp","search_text":"$ echo \"beautifulsoup4==4.6.0\" >> requirements.txt $ pip install -r requirements.txt","text_count":84,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"beautifulsoup4==4.6.0\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev6lq","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6lr","search_text":"Import BeautifulSoup and requests : ","text_count":36,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BeautifulSoup"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6ls","search_text":">>> import requests >>> from bs4 import BeautifulSoup","text_count":53,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests\n&gt;&gt;&gt; from bs4 import BeautifulSoup"}]}]},{"block_type":"element","block":"k67ev6lt","search_text":"Set up the URL of the page to download and retrieve it: ","text_count":56,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up the URL of the page to download and retrieve it:"}]}]},{"block_type":"element","block":"k67ev6lu","search_text":">>> URL = 'http://www.columbia.edu/~fdc/sample.html' >>> response = requests.get(URL) >>> response <Response [200]>","text_count":115,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; URL = 'http://www.columbia.edu/~fdc/sample.html'\n&gt;&gt;&gt; response = requests.get(URL)\n&gt;&gt;&gt; response\n&lt;Response [200]&gt;"}]}]},{"block_type":"element","block":"k67ev6lv","search_text":"Parse the downloaded page: ","text_count":27,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse the downloaded page:"}]}]},{"block_type":"element","block":"k67ev6lw","search_text":">>> page = BeautifulSoup(response.text, 'html.parser')","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; page = BeautifulSoup(response.text, 'html.parser')"}]}]},{"block_type":"element","block":"k67ev6lx","search_text":"Obtain the title of the page. See that it is the same as what's displayed in the browser: ","text_count":90,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the title of the page. See that it is the same as what's displayed in the browser:"}]}]},{"block_type":"element","block":"k67ev6ly","search_text":">>> page.title <title>Sample Web Page</title> >>> page.title.string 'Sample Web Page'","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; page.title\n&lt;title&gt;Sample Web Page&lt;/title&gt;\n&gt;&gt;&gt; page.title.string\n'Sample Web Page'"}]}]},{"block_type":"element","block":"k67ev6lz","search_text":"Find all the h3 elements in the page, to determine the existing sections: ","text_count":74,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Find all the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"h3"}]},{"block_type":"text","content":"elements in the page, to determine the existing sections:"}]}]},{"block_type":"element","block":"k67ev6m0","search_text":">>> page.find_all('h3') [<h3><a name=\"contents\">CONTENTS</a></h3>, <h3><a name=\"basics\">1. Creating a Web Page</a></h3>, <h3><a name=\"syntax\">2. HTML Syntax</a></h3>, <h3><a name=\"chars\">3. Special Characters</a></h3>, <h3><a name=\"convert\">4. Converting Plain Text to HTML</a></h3>, <h3><a name=\"effects\">5. Effects</a></h3>, <h3><a name=\"lists\">6. Lists</a></h3>, <h3><a name=\"links\">7. Links</a></h3>, <h3><a name=\"tables\">8. Tables</a></h3>, <h3><a name=\"install\">9. Installing Your Web Page on the Internet</a></h3>, <h3><a name=\"more\">10. Where to go from here</a></h3>]","text_count":576,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; page.find_all('h3')\n[&lt;h3&gt;&lt;a name=\"contents\"&gt;CONTENTS&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"basics\"&gt;1. Creating a Web Page&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"syntax\"&gt;2. HTML Syntax&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"chars\"&gt;3. Special Characters&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"convert\"&gt;4. Converting Plain Text to HTML&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"effects\"&gt;5. Effects&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"lists\"&gt;6. Lists&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"links\"&gt;7. Links&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"tables\"&gt;8. Tables&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"install\"&gt;9. Installing Your Web Page on the Internet&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"more\"&gt;10. Where to go from here&lt;/a&gt;&lt;/h3&gt;]"}]}]},{"block_type":"element","block":"k67ev6m1","search_text":"Extract the text on the section links. Stop when you reach the next <h3> tag: ","text_count":78,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Extract the text on the section links. Stop when you reach the next"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;h3&gt;"}]},{"block_type":"text","content":"tag:"}]}]},{"block_type":"element","block":"k67ev6m2","search_text":">>> link_section = page.find('a', attrs={'name': 'links'}) >>> section = [] >>> for element in link_section.next_elements: ... if element.name == 'h3': ... break ... section.append(element.string or '') ... >>> result = ''.join(section) >>> result '7. Links\\n\\nLinks can be internal within a Web page (like to\\nthe Table of ContentsTable of Contents at the top), or they\\ncan be to external web pages or pictures on the same website, or they\\ncan be to websites, pages, or pictures anywhere else in the world.\\n\\n\\n\\nHere is a link to the Kermit\\nProject home pageKermit\\nProject home page.\\n\\n\\n\\nHere is a link to Section 5Section 5 of this document.\\n\\n\\n\\nHere is a link to\\nSection 4.0Section 4.0\\nof the C-Kermit\\nfor Unix Installation InstructionsC-Kermit\\nfor Unix Installation Instructions.\\n\\n\\n\\nHere is a link to a picture:\\nCLICK HERECLICK HERE to see it.\\n\\n\\n'","text_count":875,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; link_section = page.find('a', attrs={'name': 'links'})\n&gt;&gt;&gt; section = []\n&gt;&gt;&gt; for element in link_section.next_elements:\n...     if element.name == 'h3':\n...         break\n...     section.append(element.string or '')\n...\n&gt;&gt;&gt; result = ''.join(section)\n&gt;&gt;&gt; result\n'7. Links\\n\\nLinks can be internal within a Web page (like to\\nthe Table of ContentsTable of Contents at the top), or they\\ncan be to external web pages or pictures on the same website, or they\\ncan be to websites, pages, or pictures anywhere else in the world.\\n\\n\\n\\nHere is a link to the Kermit\\nProject home pageKermit\\nProject home page.\\n\\n\\n\\nHere is a link to Section 5Section 5 of this document.\\n\\n\\n\\nHere is a link to\\nSection 4.0Section 4.0\\nof the C-Kermit\\nfor Unix Installation InstructionsC-Kermit\\nfor Unix Installation Instructions.\\n\\n\\n\\nHere is a link to a picture:\\nCLICK HERECLICK HERE to see it.\\n\\n\\n'"}]}]},{"block_type":"element","block":"k67ev6m3","search_text":"Notice that there are no HTML tags; it's all raw text.","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that there are no HTML tags; it's all raw text."}]},{"block_type":"element","block":"k67ev6m4","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6m5","search_text":"The first step is to download the page. Then, the raw text can be parsed, as in step 3. The resulting page object contains the parsed information.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first step is to download the page. Then, the raw text can be parsed, as in step 3. The resulting&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"page"}]},{"block_type":"text","content":"&nbsp;object&nbsp;contains the parsed information."}]},{"block_type":"element","block":"k67ev6m6","search_text":"Tip The html.parser parser is the default one, but for specific operations it can have problems. For example, for big pages it can be slow, or has issue rendering highly dynamic web pages. You can use other parsers, such as, lxml , which is much faster, or html5lib , which will be closer to how a browser operates, including dynamic changes produced by HTML5. They are external modules that will need to be added to the requirements.txt file. ","text_count":444,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"html.parser"}]},{"block_type":"text","content":"&nbsp;parser&nbsp;is the default one, but for specific operations it can have problems. For example, for big pages it can be slow, or has issue rendering highly dynamic web pages. You can use other parsers,&nbsp;such as,&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lxml"}]},{"block_type":"text","content":", which is much faster, or&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"html5lib"}]},{"block_type":"text","content":", which will be closer to how a browser operates, including dynamic changes produced by HTML5. They are external modules that will need to be added to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file."}]}]},{"block_type":"element","block":"k67ev6m7","search_text":"BeautifulSoup allows us to search for HTML elements. It can search for the first one with .find() or return a list with .find_all() . In step 5, it searched for a specific tag <a> that had a particular attribute, name=link . After that, it kept iterating on .next_elements until it finds the next h3 tag, which marks the end of the section.","text_count":340,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BeautifulSoup"}]},{"block_type":"text","content":"allows us to search for HTML elements. It can search for the first one with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".find()"}]},{"block_type":"text","content":"&nbsp;or return a list with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".find_all()"}]},{"block_type":"text","content":". In step 5, it searched for a specific tag"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;a&gt;"}]},{"block_type":"text","content":"that had a particular attribute,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"name=link"}]},{"block_type":"text","content":".&nbsp;After that, it kept iterating on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".next_elements"}]},{"block_type":"text","content":"until it finds the next"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"h3"}]},{"block_type":"text","content":"tag, which marks the end of the section."}]},{"block_type":"element","block":"k67ev6m8","search_text":"The text of each element is extracted and finally composed into a single text. Note the or that avoids storing None , returned when an element has no text.","text_count":155,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The text of each element is extracted and finally composed into a single text. Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"or"}]},{"block_type":"text","content":"that avoids storing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":", returned when an element has no text."}]},{"block_type":"element","block":"k67ev6m9","search_text":"Tip HTML is highly versatile, and can have multiple structures. The case presented in this recipe is typical, but other options on dividing sections can be grouping related sections inside a big <div> tag or other elements, or even raw text. Some experimentation will be required until you find the specific process to extract the juicy bits on a web page. Don't be afraid to try! ","text_count":381,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"HTML is highly versatile, and can have multiple structures. The case presented in this recipe is typical, but other options on dividing sections can be grouping related sections inside a big"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;div&gt;"}]},{"block_type":"text","content":"tag or other elements, or even raw text. Some experimentation will be required until you find the specific process to extract the juicy bits on a web page. Don't be afraid to try!"}]}]},{"block_type":"element","block":"k67ev6ma","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6mb","search_text":"Regexes can be used as well as input in the .find() and .find_all() methods. For example, this search uses the h2 and h3 tags:","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Regexes can be used as well as input in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".find()"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".find_all()"}]},{"block_type":"text","content":"methods. For example, this search uses the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"h2"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"h3"}]},{"block_type":"text","content":"tags:"}]},{"block_type":"element","block":"k67ev6mc","search_text":">>> page.find_all(re.compile('^h(2|3)')) [<h2>Sample Web Page</h2>, <h3><a name=\"contents\">CONTENTS</a></h3>, <h3><a name=\"basics\">1. Creating a Web Page</a></h3>, <h3><a name=\"syntax\">2. HTML Syntax</a></h3>, <h3><a name=\"chars\">3. Special Characters</a></h3>, <h3><a name=\"convert\">4. Converting Plain Text to HTML</a></h3>, <h3><a name=\"effects\">5. Effects</a></h3>, <h3><a name=\"lists\">6. Lists</a></h3>, <h3><a name=\"links\">7. Links</a></h3>,","text_count":447,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; page.find_all(re.compile('^h(2|3)'))\n[&lt;h2&gt;Sample Web Page&lt;/h2&gt;, &lt;h3&gt;&lt;a name=\"contents\"&gt;CONTENTS&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"basics\"&gt;1. Creating a Web Page&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"syntax\"&gt;2. HTML Syntax&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"chars\"&gt;3. Special Characters&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"convert\"&gt;4. Converting Plain Text to HTML&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"effects\"&gt;5. Effects&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"lists\"&gt;6. Lists&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"links\"&gt;7. Links&lt;/a&gt;&lt;/h3&gt;,"}]}]},{"block_type":"element","block":"k67ev6md","search_text":"<h3><a name=\"tables\">8. Tables</a></h3>, <h3><a name=\"install\">9. Installing Your Web Page on the Internet</a></h3>, <h3><a name=\"more\">10. Where to go from here</a></h3>]","text_count":171,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&lt;h3&gt;&lt;a name=\"tables\"&gt;8. Tables&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"install\"&gt;9. Installing Your Web Page on the Internet&lt;/a&gt;&lt;/h3&gt;, &lt;h3&gt;&lt;a name=\"more\"&gt;10. Where to go from here&lt;/a&gt;&lt;/h3&gt;]"}]}]},{"block_type":"element","block":"k67ev6me","search_text":"Another useful find parameter is including the CSS class with the class_ parameter. This will be shown later in the book.","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another useful find parameter is including the CSS class with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"class_"}]},{"block_type":"text","content":"parameter. This will be shown later in the book."}]},{"block_type":"element","block":"k67ev6mf","search_text":"The full Beautiful Soup documentation can be found here: https://www.crummy.com/software/BeautifulSoup/bs4/doc/ .","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full Beautiful Soup documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.crummy.com/software/BeautifulSoup/bs4/doc/"},"children":[{"block_type":"text","content":"https://www.crummy.com/software/BeautifulSoup/bs4/doc/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6mg","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6mh","search_text":"The Installing third-party packages recipe in Chapter 1, Let Us Begin Our Automation Journey The Introducing regular expressions recipe in Chapter 1, Let Us Begin Our Automation Journey The Downloading web pages recipe ","text_count":219,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6mi","search_text":"Crawling the web","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Crawling the web"}]},{"block_type":"element","block":"k67ev6mj","search_text":"Given the nature of hyperlink pages, starting from a known place and following links to other pages is a very important tool in the arsenal when scraping the web.","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Given the nature of hyperlink pages, starting from a known place and following links to other pages is a very important tool in the arsenal when scraping the web."}]},{"block_type":"element","block":"k67ev6mk","search_text":"To do so, we crawl a page looking for a small phrase, and will print any paragraph that contains it. We will search only in pages that belong to the same site. I.e. only URLs starting with www.somesite.com. We won't follow links to external sites.","text_count":247,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To do so, we crawl a page looking for a small phrase, and will print any paragraph that contains it. We will search only in pages that belong to the same site. I.e.&nbsp;only URLs starting with www.somesite.com.&nbsp;We won't follow links to external sites."}]},{"block_type":"element","block":"k67ev6ml","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6mm","search_text":"This recipe builds on the introduced concepts, so it will download and parse the pages to search for links and continue downloading.","text_count":132,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe builds on the introduced concepts, so it will download and parse the pages to search for links and continue downloading."}]},{"block_type":"element","block":"k67ev6mn","search_text":"Tip When crawling the web, remember to set limits when downloading. It's very easy to crawl over too many pages. As anyone checking Wikipedia can confirm, the internet is potentially limitless. ","text_count":194,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When crawling the web, remember to set limits when downloading. It's very easy to crawl over too many pages. As anyone checking Wikipedia can confirm, the internet is potentially limitless."}]}]},{"block_type":"element","block":"k67ev6mo","search_text":"We'll use as an example a prepared example, available in the GitHub repo: https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter03/test_site . Download the whole site and run the included script.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use as an example a prepared example, available in the GitHub repo:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter03/test_site"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter03/test_site"}]},{"block_type":"text","content":". Download the whole site and run the included script."}]},{"block_type":"element","block":"k67ev6mp","search_text":"$ python simple_delay_server.py","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python simple_delay_server.py"}]}]},{"block_type":"element","block":"k67ev6mq","search_text":"This serves the site in the URL http://localhost:8000 . You can check it on a browser. It's a simple blog with three entries. Most of it is uninteresting, but we added a couple of paragraphs that contain the keyword python . ","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This serves the site in the URL"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"http://localhost:8000"}]},{"block_type":"text","content":". You can check it on a browser. It's a simple blog with three entries. Most of it is uninteresting, but we added a couple of paragraphs that contain the keyword"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev6mr","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000050.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6ms","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6mt","search_text":"The full script, crawling_web_step1.py , is available in GitHub at the following link: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter03/crawling_web_step1.py . The most relevant bits are displayed here: ","text_count":238,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The full script,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"crawling_web_step1.py"}]},{"block_type":"text","content":",&nbsp;is available in GitHub at the following link:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter03/crawling_web_step1.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter03/crawling_web_step1.py"}]},{"block_type":"text","content":". The most relevant bits are displayed here:"}]}]},{"block_type":"element","block":"k67ev6mu","search_text":"... def process_link(source_link, text): logging.info(f'Extracting links from {source_link}') parsed_source = urlparse(source_link) result = requests.get(source_link) # Error handling. See GitHub for details ... page = BeautifulSoup(result.text, 'html.parser') search_text(source_link, page, text) return get_links(parsed_source, page) def get_links(parsed_source, page): '''Retrieve the links on the page''' links = [] for element in page.find_all('a'): link = element.get('href') # Validate is a valid link. See GitHub for details ... links.append(link) return links","text_count":568,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"...\n\ndef process_link(source_link, text):\n    logging.info(f'Extracting links from {source_link}')\n    parsed_source = urlparse(source_link)\n    result = requests.get(source_link)\n    # Error handling. See GitHub for details\n    ...\n    page = BeautifulSoup(result.text, 'html.parser')\n    search_text(source_link, page, text)\n    return get_links(parsed_source, page)\n\ndef get_links(parsed_source, page):\n    '''Retrieve the links on the page'''\n    links = []\n    for element in page.find_all('a'):\n        link = element.get('href')\n        # Validate is a valid link. See GitHub for details\n        ...\n        links.append(link)\n    return links"}]}]},{"block_type":"element","block":"k67ev6mv","search_text":"Search for references to python , to return a list with URLs that contain it and the paragraph. Notice there are a couple of errors because of broken links: ","text_count":157,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Search for references to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"text","content":", to return a list with URLs that contain it and&nbsp;the paragraph. Notice there are a couple of errors because of broken links:"}]}]},{"block_type":"element","block":"k67ev6mw","search_text":"$ python crawling_web_step1.py https://localhost:8000/ -p python Link http://localhost:8000/: --> A smaller article , that contains a reference to Python Link http://localhost:8000/files/5eabef23f63024c20389c34b94dee593-1.html: --> A smaller article , that contains a reference to Python Link http://localhost:8000/files/33714fc865e02aeda2dabb9a42a787b2-0.html: --> This is the actual bit with a python reference that we are interested in. Link http://localhost:8000/files/archive-september-2018.html: --> A smaller article , that contains a reference to Python Link http://localhost:8000/index.html: --> A smaller article , that contains a reference to Python","text_count":660,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python crawling_web_step1.py https://localhost:8000/ -p python\nLink http://localhost:8000/: --&gt; A smaller article , that contains a reference to Python\nLink http://localhost:8000/files/5eabef23f63024c20389c34b94dee593-1.html: --&gt; A smaller article , that contains a reference to Python\nLink http://localhost:8000/files/33714fc865e02aeda2dabb9a42a787b2-0.html: --&gt; This is the actual bit with a python reference that we are interested in.\nLink http://localhost:8000/files/archive-september-2018.html: --&gt; A smaller article , that contains a reference to Python\nLink http://localhost:8000/index.html: --&gt; A smaller article , that contains a reference to Python"}]}]},{"block_type":"element","block":"k67ev6mx","search_text":"Another good search term is crocodile . Try it out: ","text_count":52,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Another good search term is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"crocodile"}]},{"block_type":"text","content":". Try it out:"}]}]},{"block_type":"element","block":"k67ev6my","search_text":"$ python crawling_web_step1.py http://localhost:8000/ -p crocodile","text_count":66,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python crawling_web_step1.py http://localhost:8000/ -p crocodile"}]}]},{"block_type":"element","block":"k67ev6mz","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6n0","search_text":"Let's see each of the components of the script:","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's see each of the components of the script:"}]},{"block_type":"element","block":"k67ev6n1","search_text":"A loop that goes through all the found links, in the main function: ","text_count":68,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A loop that goes through all the found links, in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function:"}]}]},{"block_type":"element","block":"k67ev6n2","search_text":"Note that there's a retrieval limit of 10 pages, and it's checking that any new link to add is not added already.","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that there's a retrieval limit of 10 pages, and it's checking that any new link to add is not added already."}]},{"block_type":"element","block":"k67ev6n3","search_text":"Note Note these two things are limits. We won't download the same link twice and we'll stop at some point. ","text_count":107,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note these two things are limits. We won't download the same link twice and we'll stop at some point."}]}]},{"block_type":"element","block":"k67ev6n4","search_text":"Downloading and parsing the link, in the process_link function: ","text_count":64,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Downloading and parsing&nbsp;the link, in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"process_link"}]},{"block_type":"text","content":"function:"}]}]},{"block_type":"element","block":"k67ev6n5","search_text":"It downloads the file, and checks that the status is correct to skip errors such as broken links. It also checks that the type (as described in Content-Type ) is a HTML page to skip PDFs and other formats. And finally, it parses the raw HTML into a BeautifulSoup object.","text_count":270,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It downloads the file, and checks that the status is correct to skip errors such as broken links. It also checks that the type (as described in&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Content-Type"}]},{"block_type":"text","content":") is a HTML page to skip PDFs and other formats. And finally, it parses the raw HTML into a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BeautifulSoup"}]},{"block_type":"text","content":"object."}]},{"block_type":"element","block":"k67ev6n6","search_text":"It also parses the source link using urlparse , so later, in step 4, it can skip all the references to external sources. urlparse divides a URL into its composing elements:","text_count":172,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It also parses the source link using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"urlparse"}]},{"block_type":"text","content":", so later, in step 4, it can skip all the references to external sources.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"urlparse"}]},{"block_type":"text","content":"divides a URL into its composing elements:"}]},{"block_type":"element","block":"k67ev6n7","search_text":">>> from urllib.parse import urlparse >>> >>> urlparse('http://localhost:8000/files/b93bec5d9681df87e6e8d5703ed7cd81-2.html') ParseResult(scheme='http', netloc='localhost:8000', path='/files/b93bec5d9681df87e6e8d5703ed7cd81-2.html', params='', query='', fragment='')","text_count":266,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from urllib.parse import urlparse\n&gt;&gt;&gt; &gt;&gt;&gt; urlparse('http://localhost:8000/files/b93bec5d9681df87e6e8d5703ed7cd81-2.html')\nParseResult(scheme='http', netloc='localhost:8000', path='/files/b93bec5d9681df87e6e8d5703ed7cd81-2.html', params='', query='', fragment='')"}]}]},{"block_type":"element","block":"k67ev6n8","search_text":"It finds the text to search, in the search_text function: ","text_count":58,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It finds the text to search, in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_text"}]},{"block_type":"text","content":"function:"}]}]},{"block_type":"element","block":"k67ev6n9","search_text":"It searches the parsed object for the specified text. Note the search is done as a regex and only in the text. It prints the resulting matches, including source_link , referencing the URL where the match was found:","text_count":214,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It searches the parsed object for the specified text. Note the search is done as a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"regex"}]},{"block_type":"text","content":"and only in the text. It prints the resulting&nbsp;matches, including"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"source_link"}]},{"block_type":"text","content":", referencing the URL where the match was found:"}]},{"block_type":"element","block":"k67ev6na","search_text":"for element in page.find_all(text=re.compile(text)): print(f'Link {source_link}: --> {element}')","text_count":96,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"for element in page.find_all(text=re.compile(text)):\n    print(f'Link {source_link}: --&gt; {element}')"}]}]},{"block_type":"element","block":"k67ev6nb","search_text":"The get_links function retrieves all links on a page: ","text_count":54,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;&nbsp;"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get_links"}]}]},{"block_type":"text","content":"&nbsp;function&nbsp;retrieves all links on a page:&nbsp;"}]}]},{"block_type":"element","block":"k67ev6nc","search_text":"It searches in the parsed page all <a> elements, and retrieves the href elements, but only elements that have such href elements and that are a fully qualified URL (starting with http ). This removes links that are not a URL, such as a '#' link, or that are internal to the page.","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It searches in the parsed page all"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;a&gt;"}]},{"block_type":"text","content":"elements, and retrieves the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"href"}]},{"block_type":"text","content":"elements, but only elements that have such"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"href"}]},{"block_type":"text","content":"elements and that are a fully qualified URL (starting with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"http"}]},{"block_type":"text","content":"). This removes links that are not a URL, such as a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'#'"}]},{"block_type":"text","content":"link, or that are internal to the page."}]},{"block_type":"element","block":"k67ev6nd","search_text":"An extra check is done to check they have the same source as the original link, then they are registered as valid links. The netloc attribute allows to detect that the link comes from the same URL domain than the parsed URL generated in step 2.","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An extra check is done to check they have the same source as the original link, then they are registered as valid links.&nbsp;The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"netloc"}]},{"block_type":"text","content":"attribute allows to detect that the link comes from the same URL domain than&nbsp;the parsed URL generated in step 2."}]},{"block_type":"element","block":"k67ev6ne","search_text":"Note We won't follow links that point to a different address (for example, a http://www.google.com one). ","text_count":105,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We won't follow links that point to a different address (for example, a"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.google.com"},"children":[{"block_type":"text","content":"http://www.google.com"}]},{"block_type":"text","content":"&nbsp;one)."}]}]},{"block_type":"element","block":"k67ev6nf","search_text":"Finally, the links are returned, where they'll be added to the loop described in step 1.","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the links are returned, where they'll be added to the loop described in step 1."}]},{"block_type":"element","block":"k67ev6ng","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6nh","search_text":"Further filters could be enforced, for example, discarding all links that end in .pdf , meaning they are PDF files:","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Further filters could be enforced, for example, discarding all links that end in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".pdf"}]},{"block_type":"text","content":", meaning they&nbsp;are PDF files:"}]},{"block_type":"element","block":"k67ev6ni","search_text":"# In get_links if link.endswith('pdf'): continue","text_count":48,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# In get_links\nif link.endswith('pdf'):\n  continue"}]}]},{"block_type":"element","block":"k67ev6nj","search_text":"The use of Content-Type can also be determined to parse the returned object in different ways. A PDF result ( Content-Type: application/pdf ) won't have a valid response.text object to be parsed, but it can be parsed in other ways. The same is valid for other types, such as a CSV file ( Content-Type: text/csv ) or a ZIP file that may need to be decompressed ( Content-Type: application/zip ). We'll see how to deal with those later.","text_count":434,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The use of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Content-Type"}]},{"block_type":"text","content":"can also be determined to parse the returned object in different ways. A PDF result ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Content-Type: application/pdf"}]},{"block_type":"text","content":")&nbsp;won't have a valid"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"response.text"}]},{"block_type":"text","content":"object to be parsed, but it can be parsed in other ways. The same is valid for other types, such as a CSV file ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Content-Type: text/csv"}]},{"block_type":"text","content":") or a ZIP file that may need to be decompressed ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Content-Type:&nbsp;application/zip"}]},{"block_type":"text","content":"). We'll see how to deal with those later."}]},{"block_type":"element","block":"k67ev6nk","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6nl","search_text":"The Downloading web pages recipe The Parsing HTML recipe ","text_count":57,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6nm","search_text":"Subscribing to feeds","text_count":20,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Subscribing to feeds"}]},{"block_type":"element","block":"k67ev6nn","search_text":"RSS is probably the biggest secret of the internet. While its moment of glory seemed to be during the 2000s, and now it's not in the spotlight anymore, it allows easy subscription to websites. It is present in lots of places, and it's incredibly useful.","text_count":253,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"RSS is probably the biggest"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"secret"}]},{"block_type":"text","content":"&nbsp;of the internet. While its moment of glory seemed to be during the 2000s, and now it's not in the spotlight anymore, it allows easy subscription to websites.&nbsp;It is present in lots of places, and it's incredibly useful."}]},{"block_type":"element","block":"k67ev6no","search_text":"At its core, RSS is a way of presenting a succession of ordered references (typically articles, but also other elements such as podcast episodes or YouTube publications) and a publishing time. This makes for a very natural way of knowing what articles are new since the last check, as well as presenting some structured data about them, such as the title and a summary.","text_count":369,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"At its core, RSS is a way of presenting a succession of ordered references (typically articles, but also other elements such as podcast episodes or YouTube publications) and a publishing time. This makes for a very natural way of knowing what articles are new since the last check, as well as presenting some structured data about them, such as the title and a summary."}]},{"block_type":"element","block":"k67ev6np","search_text":"In this recipe, we will present the feedparser module, and determine how to obtain data from an RSS feed.","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will present the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feedparser"}]},{"block_type":"text","content":"module, and determine how to obtain&nbsp;data from an RSS feed."}]},{"block_type":"element","block":"k67ev6nq","search_text":"Tip RSS is not the only available feed format. There's also a format called Atom , but both are very much equivalent. feedparser is also capable of parsing it, so both can be used indistinctly. ","text_count":194,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"RSS"}]},{"block_type":"text","content":"is not the only available feed format. There's also a format called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Atom"}]},{"block_type":"text","content":", but both are very much equivalent."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feedparser"}]},{"block_type":"text","content":"is also capable of parsing it, so both can be used indistinctly."}]}]},{"block_type":"element","block":"k67ev6nr","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ns","search_text":"We need to add the feedparser dependency to our requirements.txt file and reinstall it:","text_count":87,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to add the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feedparser"}]},{"block_type":"text","content":"dependency to our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file and reinstall it:"}]},{"block_type":"element","block":"k67ev6nt","search_text":"$ echo \"feedparser==5.2.1\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"feedparser==5.2.1\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev6nu","search_text":"Feed URLs can be found on almost all pages that deal with publications, including blogs, news, podcasts, and so on. Sometimes they are very easy to find, but sometimes they are a little bit hidden. Search by feed or RSS .","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Feed URLs can be found on almost all pages that deal with publications, including blogs, news, podcasts, and so on. Sometimes they are very easy to find, but sometimes they are a little bit hidden. Search by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feed"}]},{"block_type":"text","content":"&nbsp;or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RSS"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6nv","search_text":"Most newspapers and news agencies has their RSS feeds divided by themes. We'll use as example to parse The New York Times main page feed, http://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml . There are more feeds available in the main feed page: https://archive.nytimes.com/www.nytimes.com/services/xml/rss/index.html . ","text_count":325,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most newspapers and news agencies has their RSS feeds divided by themes. We'll use as example to parse"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"The New York Times"}]},{"block_type":"text","content":"main page feed,&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml"},"children":[{"block_type":"text","content":"http://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml"}]},{"block_type":"text","content":". There are more feeds available in the main feed page:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://archive.nytimes.com/www.nytimes.com/services/xml/rss/index.html?mcubz=0"},"children":[{"block_type":"text","content":"https://archive.nytimes.com/www.nytimes.com/services/xml/rss/index.html"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev6nw","search_text":"Note Please note the feeds may be subjected to terms and conditions of use. In the New York Times case, they are described at the end of the main feed page. ","text_count":157,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please note the feeds may be subjected to terms and conditions of use. In the New York Times case, they are described at the end of the main feed page."}]}]},{"block_type":"element","block":"k67ev6nx","search_text":"Please note that this feed changes quite often, meaning that the linked entries will change from the examples in this book.","text_count":123,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please note that this feed changes quite often, meaning that the linked entries will change from the examples in this book."}]},{"block_type":"element","block":"k67ev6ny","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6nz","search_text":"Import the feedparser module, as well as datetime , delorean , and requests : ","text_count":78,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feedparser"}]},{"block_type":"text","content":"module, as well as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6o0","search_text":"import feedparser import datetime import delorean import requests","text_count":65,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import feedparser\nimport datetime\nimport delorean\nimport requests"}]}]},{"block_type":"element","block":"k67ev6o1","search_text":"Parse the feed (it will be downloaded automatically) and check when it was last updated. Feed information, like the title of the feed, can be obtained in the feed attribute: ","text_count":174,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse the feed (it will be downloaded automatically) and check when it was last updated. Feed information, like the title of the feed, can be obtained in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feed"}]},{"block_type":"text","content":"attribute:"}]}]},{"block_type":"element","block":"k67ev6o2","search_text":">>> rss = feedparser.parse('http://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml')","text_count":86,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; rss = feedparser.parse('http://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml')"}]}]},{"block_type":"element","block":"k67ev6o3","search_text":">>> rss.updated 'Sat, 02 Jun 2018 19:50:35 GMT'","text_count":47,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; rss.updated\n'Sat, 02 Jun 2018 19:50:35 GMT'"}]}]},{"block_type":"element","block":"k67ev6o4","search_text":"Get the entries that are newer than six hours: ","text_count":47,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the entries that are newer than six hours:"}]}]},{"block_type":"element","block":"k67ev6o5","search_text":">>> time_limit = delorean.parse(rss.updated) - datetime.timedelta(hours=6) >>> entries = [entry for entry in rss.entries if delorean.parse(entry.published) > time_limit]","text_count":169,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; time_limit = delorean.parse(rss.updated) - datetime.timedelta(hours=6)\n&gt;&gt;&gt; entries = [entry for entry in rss.entries if delorean.parse(entry.published) &gt; time_limit]"}]}]},{"block_type":"element","block":"k67ev6o6","search_text":"There will be fewer entries than the total ones, because some of the returned entries will be older than six hours: ","text_count":116,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There will be fewer entries than the total ones, because some of the returned entries will be older than six hours:"}]}]},{"block_type":"element","block":"k67ev6o7","search_text":">>> len(entries) 10 >>> len(rss.entries) 44","text_count":43,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; len(entries)\n10\n&gt;&gt;&gt; len(rss.entries)\n44"}]}]},{"block_type":"element","block":"k67ev6o8","search_text":"Retrieve information about the entries, such as the title . The full entry URL is available as link . Explore the available information in this particular feed: ","text_count":161,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieve information about the entries, such as the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"title"}]},{"block_type":"text","content":". The full entry URL is available as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"link"}]},{"block_type":"text","content":". Explore the available information in this particular feed:"}]}]},{"block_type":"element","block":"k67ev6o9","search_text":">>> entries[5]['title'] 'Loose Ends: How to Live to 108' >>> entries[5]['link'] 'https://www.nytimes.com/2018/06/02/opinion/sunday/how-to-live-to-108.html?partner=rss&emc=rss' >>> requests.get(entries[5].link) <Response [200]>","text_count":226,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; entries[5]['title']\n'Loose Ends: How to Live to 108'\n&gt;&gt;&gt; entries[5]['link']\n'https://www.nytimes.com/2018/06/02/opinion/sunday/how-to-live-to-108.html?partner=rss&amp;emc=rss'\n&gt;&gt;&gt; requests.get(entries[5].link)\n&lt;Response [200]&gt;"}]}]},{"block_type":"element","block":"k67ev6oa","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6ob","search_text":"The parsed feed object contains the information of the entries, as well as general information about the feed itself, such as when it was updated. The feed information can be found in the feed attribute:","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The parsed"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feed"}]},{"block_type":"text","content":"object contains the information of the entries, as well as general information about the feed itself, such as when it was updated. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feed"}]},{"block_type":"text","content":"information can be found in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feed"}]},{"block_type":"text","content":"attribute:"}]},{"block_type":"element","block":"k67ev6oc","search_text":">>> rss.feed.title 'NYT > Home Page'","text_count":36,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; rss.feed.title\n'NYT &gt; Home Page'"}]}]},{"block_type":"element","block":"k67ev6od","search_text":"Each of the entries work as a dictionary, so the fields are easy to retrieve. They can also be accessed as attributes, but treating them as keys allows us to get all the available fields:","text_count":187,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the entries work as a dictionary, so the fields are easy to retrieve. They can also be accessed as attributes, but treating them as keys allows us to get all the available fields:"}]},{"block_type":"element","block":"k67ev6oe","search_text":">>> entries[5].keys() dict_keys(['title', 'title_detail', 'links', 'link', 'id', 'guidislink', 'media_content', 'summary', 'summary_detail', 'media_credit', 'credit', 'content', 'authors', 'author', 'author_detail', 'published', 'published_parsed', 'tags'])","text_count":257,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; entries[5].keys()\ndict_keys(['title', 'title_detail', 'links', 'link', 'id', 'guidislink', 'media_content', 'summary', 'summary_detail', 'media_credit', 'credit', 'content', 'authors', 'author', 'author_detail', 'published', 'published_parsed', 'tags'])"}]}]},{"block_type":"element","block":"k67ev6of","search_text":"The basic strategy when dealing with feeds is to parse them and go through the entries, performing a quick check on whether they are interesting or not, for example, by checking the description or summary . If they are download the whole page using the link field. Then, to avoid rechecking entires, store the latest publication date and next time, only check newer entries.","text_count":374,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic strategy when dealing with feeds is to parse them and go through the entries, performing a quick check on whether they are interesting or not, for example, by checking the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"description"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"summary"}]},{"block_type":"text","content":". If they are download the whole page using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"link"}]},{"block_type":"text","content":"field. Then, to avoid rechecking entires, store the latest publication date and next time, only check newer entries."}]},{"block_type":"element","block":"k67ev6og","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6oh","search_text":"The full feedparser documentation can be found here: https://pythonhosted.org/feedparser/ .","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"feedparser"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pythonhosted.org/feedparser/"},"children":[{"block_type":"text","content":"https://pythonhosted.org/feedparser/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6oi","search_text":"The information available can differ from feed to feed. In the New York Times example, there's a tag field with tag information, but this is not standard. As a minimum, entries will have a title, a description, and a link.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The information available can differ from feed to feed. In the New York Times example, there's a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tag"}]},{"block_type":"text","content":"&nbsp;field with tag information, but this is not standard. As a minimum, entries will have a title, a description, and a link."}]},{"block_type":"element","block":"k67ev6oj","search_text":"Tip RSS feeds are also a great way of curating your own selection of news sources. There are great feed readers for that. ","text_count":122,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"RSS feeds are also a great way of curating your own selection of news sources. There are great feed readers for that."}]}]},{"block_type":"element","block":"k67ev6ok","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6ol","search_text":"The Installing third-party packages recipe in Chapter 1, Let Us Begin Our Automation Journey The Downloading web pages recipe ","text_count":126,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6om","search_text":"Accessing web APIs","text_count":18,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Accessing web APIs"}]},{"block_type":"element","block":"k67ev6on","search_text":"Rich interfaces can be created through the web, allowing powerful interactions through HTTP. The most common interface is through RESTful APIs using JSON. These text-based interfaces are easy to understand and to program, and use common technologies that are language agnostic , meaning they can be accessed in any programming language that has an HTTP client module, including, of course, Python.","text_count":397,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Rich interfaces can be created through the web, allowing powerful interactions through HTTP. The most common interface is through RESTful APIs using JSON. These text-based interfaces are easy to understand and to program, and use common technologies that are"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"language agnostic"}]},{"block_type":"text","content":", meaning they can be accessed in any programming language that has an HTTP"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"client"}]},{"block_type":"text","content":"module, including, of course, Python."}]},{"block_type":"element","block":"k67ev6oo","search_text":"Note Formats other than JSON are used, such as XML, but JSON is a very simple and readable format that translates very well into Python dictionaries (and other language equivalents). JSON is, by far, the most common format in RESTful APIs at the moment. Learn more about JSON here: https://www.json.org/ . ","text_count":306,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Formats other than JSON are used, such as XML, but JSON is a very simple and readable format that translates very well into Python dictionaries (and other language equivalents). JSON is, by far, the most common format in RESTful APIs at the moment. Learn more about JSON here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.json.org/"},"children":[{"block_type":"text","content":"https://www.json.org/"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6op","search_text":"The strict definition of RESTful requires some characteristics, but a more informal definition could be accessing resources through URLs. This means a URL represents a particular resource, such as an article in a newspaper or a property on a real estate site. Resources can then be manipulated through HTTP methods ( GET to view, POST to create, PUT / PATCH to edit, and DELETE to delete) to manipulate them.","text_count":408,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The strict definition of RESTful requires some characteristics, but a more informal definition could be accessing resources through URLs. This means a URL represents a particular resource, such as an article in a newspaper or a property on a real estate site. Resources can then be manipulated through HTTP methods ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"to view,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"to create,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PUT"}]},{"block_type":"text","content":"/"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PATCH"}]},{"block_type":"text","content":"to edit, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DELETE"}]},{"block_type":"text","content":"to delete) to manipulate them."}]},{"block_type":"element","block":"k67ev6oq","search_text":"Note Proper RESTful interfaces need to have certain characteristics, and are a way of creating interfaces that is not strictly restricted to HTTP interfaces. You can read more about it here: https://codewords.recurse.com/issues/five/what-restful-actually-means . ","text_count":263,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Proper RESTful interfaces need to have certain characteristics, and are a way of creating interfaces that is not strictly restricted to HTTP interfaces. You can read more about it here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://codewords.recurse.com/issues/five/what-restful-actually-means"},"children":[{"block_type":"text","content":"https://codewords.recurse.com/issues/five/what-restful-actually-means"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6or","search_text":"Using requests is very easy with them, as it includes native JSON support.","text_count":74,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"is very easy with them, as it includes native JSON support."}]},{"block_type":"element","block":"k67ev6os","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ot","search_text":"To demonstrate how to operate RESTful APIs, we'll use the example site https://jsonplaceholder.typicode.com/ . It simulates a common case with posts, comments, and other common resources. We will use posts and comments. The URLs to use will be as follows:","text_count":255,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To demonstrate how to operate RESTful APIs, we'll use the example site&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://jsonplaceholder.typicode.com/"},"children":[{"block_type":"text","content":"https://jsonplaceholder.typicode.com/"}]},{"block_type":"text","content":". It simulates a common case with posts, comments, and other common resources. We will use posts and comments. The URLs to use will be as follows:"}]},{"block_type":"element","block":"k67ev6ou","search_text":"# The collection of all posts /posts # A single post. X is the ID of the post /posts/X # The comments of post X /posts/X/comments","text_count":129,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# The collection of all posts\n/posts\n# A single post. X is the ID of the post\n/posts/X\n# The comments of post X\n/posts/X/comments"}]}]},{"block_type":"element","block":"k67ev6ov","search_text":"The site returns the adequate result to each of them. Pretty handy!","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The site returns the adequate result to each of them. Pretty handy!"}]},{"block_type":"element","block":"k67ev6ow","search_text":"Note Because it is a test site, data won't be created, but the site will return all the correct responses. ","text_count":107,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Because it is a test site, data won't be created, but the site will return all the correct responses."}]}]},{"block_type":"element","block":"k67ev6ox","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6oy","search_text":"Import requests : ","text_count":18,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6oz","search_text":">>> import requests","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests"}]}]},{"block_type":"element","block":"k67ev6p0","search_text":"Get the list of all posts and display the latest post: ","text_count":55,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the list of all posts and display the latest post:"}]}]},{"block_type":"element","block":"k67ev6p1","search_text":">>> result = requests.get('https://jsonplaceholder.typicode.com/posts') >>> result <Response [200]> >>> result.json() # List of 100 posts NOT DISPLAYED HERE >>> result.json()[-1] {'userId': 10, 'id': 100, 'title': 'at nam consequatur ea labore ea harum', 'body': 'cupiditate quo est a modi nesciunt soluta\\nipsa voluptas error itaque dicta in\\nautem qui minus magnam et distinctio eum\\naccusamus ratione error aut'}","text_count":415,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; result = requests.get('https://jsonplaceholder.typicode.com/posts')\n&gt;&gt;&gt; result\n&lt;Response [200]&gt;\n&gt;&gt;&gt; result.json()\n# List of 100 posts NOT DISPLAYED HERE\n&gt;&gt;&gt; result.json()[-1]\n{'userId': 10, 'id': 100, 'title': 'at nam consequatur ea labore ea harum', 'body': 'cupiditate quo est a modi nesciunt soluta\\nipsa voluptas error itaque dicta in\\nautem qui minus magnam et distinctio eum\\naccusamus ratione error aut'}"}]}]},{"block_type":"element","block":"k67ev6p2","search_text":"Create a new post. See the URL of the new created resource. The call also returns the resource: ","text_count":96,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new post. See the URL of the new created resource. The call also returns the resource:"}]}]},{"block_type":"element","block":"k67ev6p3","search_text":">>> new_post = {'userId': 10, 'title': 'a title', 'body': 'something something'} >>> result = requests.post('https://jsonplaceholder.typicode.com/posts', json=new_post) >>> result <Response [201]> >>> result.json() {'userId': 10, 'title': 'a title', 'body': 'something something', 'id': 101} >>> result.headers['Location'] 'http://jsonplaceholder.typicode.com/posts/101'","text_count":370,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; new_post = {'userId': 10, 'title': 'a title', 'body': 'something something'}\n&gt;&gt;&gt; result = requests.post('https://jsonplaceholder.typicode.com/posts',\n              json=new_post)\n&gt;&gt;&gt; result\n&lt;Response [201]&gt;\n&gt;&gt;&gt; result.json()\n{'userId': 10, 'title': 'a title', 'body': 'something something', 'id': 101}\n&gt;&gt;&gt; result.headers['Location']\n'http://jsonplaceholder.typicode.com/posts/101'"}]}]},{"block_type":"element","block":"k67ev6p4","search_text":"Notice that the POST request to create the resource returns 201, which is the proper status for created.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"request to create the resource returns 201, which is the proper status for created."}]},{"block_type":"element","block":"k67ev6p5","search_text":"Fetch an existing post with GET : ","text_count":34,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Fetch an existing post with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6p6","search_text":">>> result = requests.get('https://jsonplaceholder.typicode.com/posts/2') >>> result <Response [200]> >>> result.json() {'userId': 1, 'id': 2, 'title': 'qui est esse', 'body': 'est rerum tempore vitae\\nsequi sint nihil reprehenderit dolor beatae ea dolores neque\\nfugiat blanditiis voluptate porro vel nihil molestiae ut reiciendis\\nqui aperiam non debitis possimus qui neque nisi nulla'}","text_count":388,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; result = requests.get('https://jsonplaceholder.typicode.com/posts/2')\n&gt;&gt;&gt; result\n&lt;Response [200]&gt;\n&gt;&gt;&gt; result.json()\n{'userId': 1, 'id': 2, 'title': 'qui est esse', 'body': 'est rerum tempore vitae\\nsequi sint nihil reprehenderit dolor beatae ea dolores neque\\nfugiat blanditiis voluptate porro vel nihil molestiae ut reiciendis\\nqui aperiam non debitis possimus qui neque nisi nulla'}"}]}]},{"block_type":"element","block":"k67ev6p7","search_text":"Use PATCH to update its values. Check the returned resource: ","text_count":61,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PATCH"}]},{"block_type":"text","content":"to update its values. Check the returned resource:"}]}]},{"block_type":"element","block":"k67ev6p8","search_text":">>> update = {'body': 'new body'} >>> result = requests.patch('https://jsonplaceholder.typicode.com/posts/2', json=update) >>> result <Response [200]> >>> result.json() {'userId': 1, 'id': 2, 'title': 'qui est esse', 'body': 'new body'}","text_count":236,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; update = {'body': 'new body'}\n&gt;&gt;&gt; result = requests.patch('https://jsonplaceholder.typicode.com/posts/2', json=update)\n&gt;&gt;&gt; result\n&lt;Response [200]&gt;\n&gt;&gt;&gt; result.json()\n{'userId': 1, 'id': 2, 'title': 'qui est esse', 'body': 'new body'}"}]}]},{"block_type":"element","block":"k67ev6p9","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6pa","search_text":"Two kinds of resources are typically accessed. Single resources ( https://jsonplaceholder.typicode.com/posts/X ) and collections ( https://jsonplaceholder.typicode.com/posts ):","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Two kinds of resources are typically accessed. Single resources ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"https://jsonplaceholder.typicode.com/posts/X"}]},{"block_type":"text","content":") and collections ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"https://jsonplaceholder.typicode.com/posts"}]},{"block_type":"text","content":"):"}]},{"block_type":"element","block":"k67ev6pb","search_text":"Collections accept GET to retrieve them all and POST to create a new resource Single elements accept GET to get the element, PUT and PATCH to edit, and DELETE to remove them ","text_count":174,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Collections accept"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"to retrieve them all and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"to create a new resource"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Single elements accept"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"to get the element,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PUT"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PATCH"}]},{"block_type":"text","content":"to edit, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DELETE"}]},{"block_type":"text","content":"to remove them"}]}]},{"block_type":"element","block":"k67ev6pc","search_text":"All the available HTTP methods can be called in requests . In the previous recipes, we used .get() , but .post() , .patch() , .put() , and .delete() are available.","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the available HTTP methods can be called in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":". In the previous recipes, we used"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".get()"}]},{"block_type":"text","content":", but"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".post()"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".patch()"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".put()"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".delete()"}]},{"block_type":"text","content":"are available."}]},{"block_type":"element","block":"k67ev6pd","search_text":"The returned response object has a .json() method that decodes the result from JSON. ","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The returned response object has a&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".json()"}]},{"block_type":"text","content":"&nbsp;method that decodes the result from JSON.&nbsp;"}]},{"block_type":"element","block":"k67ev6pe","search_text":"Equally, to send information, a json argument is available. This encodes a dictionary into JSON and sends it to the server. The data needs to follow the format of the resource or an error may be raised.","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Equally, to send information, a&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"json"}]},{"block_type":"text","content":"&nbsp;argument&nbsp;is available. This encodes a dictionary into JSON and sends it to the server. The data needs to follow the format of the resource or an error may be raised."}]},{"block_type":"element","block":"k67ev6pf","search_text":"Tip GET and DELETE don't require data, while PATCH , PUT , and POST do require data. ","text_count":85,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DELETE"}]},{"block_type":"text","content":"don't require data, while"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PATCH"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PUT"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"do require data."}]}]},{"block_type":"element","block":"k67ev6pg","search_text":"The referred resource will be returned, and its URL is available in the header location. This is useful when creating a new resource, where its URL is not known beforehand.","text_count":172,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The referred resource will be returned, and its URL is available in the header location. This is useful when creating a new resource, where its URL is not known beforehand."}]},{"block_type":"element","block":"k67ev6ph","search_text":"Note The difference between PATCH and PUT is that the latter replaces the whole resource, while the first does a partial update. ","text_count":129,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The difference between"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PATCH"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PUT"}]},{"block_type":"text","content":"is that the latter replaces the whole resource, while the first does a partial update."}]}]},{"block_type":"element","block":"k67ev6pi","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6pj","search_text":"RESTful APIs are very powerful, but also have huge variability. Please check the documentation of the specific API to learn about its details.","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"RESTful APIs are very powerful, but also have huge variability. Please check the documentation of the specific API to learn about its details."}]},{"block_type":"element","block":"k67ev6pk","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6pl","search_text":"The Downloading web pages recipe The Installing third-party packages recipe in Chapter 1, Let Us Begin Our Automation Journey ","text_count":126,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Installing third-party packages"}]},{"block_type":"text","content":"recipe in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]}]},{"block_type":"element","block":"k67ev6pm","search_text":"Interacting with forms","text_count":22,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Interacting with forms"}]},{"block_type":"element","block":"k67ev6pn","search_text":"A common element present in web pages is forms. Forms are a way of sending values into a web page, for example, to create a new comment on a blog post, or to submit a purchase.","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common element present in web pages is forms. Forms are a way of sending values into a web page, for example, to create a new comment on a blog post, or to submit a purchase."}]},{"block_type":"element","block":"k67ev6po","search_text":"Browsers present the forms so you can input values and send them in a single action after pressing the submit or equivalent button. We'll see how to create this action programatically in this recipe.","text_count":199,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Browsers present the forms so you can input values and send them in a single action after pressing the submit&nbsp;or equivalent button. We'll see how to create this action programatically in this recipe."}]},{"block_type":"element","block":"k67ev6pp","search_text":"Tip Be aware that sending data to a site is normally more sensible than receiving data from it. For example, sending automatic comments to a website is very much the definition of spam . This means that it can be more difficult to automate and include security measures. Double-check that what you're trying to achieve is a valid, ethical use case. ","text_count":349,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be aware that sending data to a site is normally more sensible than receiving data from it. For example, sending automatic comments to a website is very much the definition of"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"spam"}]},{"block_type":"text","content":". This means that it can be more difficult to automate and include security measures. Double-check that what you're trying to achieve is a valid, ethical use case."}]}]},{"block_type":"element","block":"k67ev6pq","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6pr","search_text":"We'll work against the test server, https://httpbin.org/forms/post , which allows us to send a test form and sends back the submitted information.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll work against the test server,&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://httpbin.org/forms/post"},"children":[{"block_type":"text","content":"https://httpbin.org/forms/post"}]},{"block_type":"text","content":", which allows us to send a test form and sends back the submitted information."}]},{"block_type":"element","block":"k67ev6ps","search_text":"The following is an example form to order a pizza:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following is an example form to order a pizza:"}]},{"block_type":"element","block":"k67ev6pt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000045.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6pu","search_text":"You can fill the form manually and see it return the information in JSON format, including extra information such as the browser use.","text_count":133,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can fill the form manually and see it return the information in JSON format, including extra information such as the browser use."}]},{"block_type":"element","block":"k67ev6pv","search_text":"The following is the frontend of the web form generated:","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following is the frontend of the web form generated:"}]},{"block_type":"element","block":"k67ev6pw","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000051.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6px","search_text":"The following image is the back end of the web form generated:","text_count":62,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following image is the back end of the web form generated:"}]},{"block_type":"element","block":"k67ev6py","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000034.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6pz","search_text":"We need to analyze the HTML to see the accepted data for the form. Checking the source code, it shows this:","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to analyze the HTML to see the accepted data for the form. Checking the source code, it shows this:"}]},{"block_type":"element","block":"k67ev6q0","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000013.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6q1","search_text":"Source code","text_count":11,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Source code"}]},{"block_type":"element","block":"k67ev6q2","search_text":"Check the name of the inputs, custname , custtel , custemail , size (a radio option), topping (a multiselection checkbox), delivery (time), and comments .","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the name of the inputs,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"custname"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"custtel"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"custemail"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"size"}]},{"block_type":"text","content":"(a radio option),"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"topping"}]},{"block_type":"text","content":"(a multiselection checkbox),"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delivery"}]},{"block_type":"text","content":"(time), and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"comments"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6q3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6q4","search_text":"Import requests , BeautifulSoup , and re modules: ","text_count":50,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BeautifulSoup"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"re"}]},{"block_type":"text","content":"&nbsp;modules:"}]}]},{"block_type":"element","block":"k67ev6q5","search_text":">>> import requests >>> from bs4 import BeautifulSoup >>> import re","text_count":67,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests\n&gt;&gt;&gt; from bs4 import BeautifulSoup\n&gt;&gt;&gt; import re"}]}]},{"block_type":"element","block":"k67ev6q6","search_text":"Retrieve the form page, parse it, and print the input fields. Check that the posting URL is /post (not /forms/post ): ","text_count":118,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieve the form page, parse it, and print the input fields. Check that the posting URL is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/post"}]},{"block_type":"text","content":"(not"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/forms/post"}]},{"block_type":"text","content":"):"}]}]},{"block_type":"element","block":"k67ev6q7","search_text":">>> response = requests.get('https://httpbin.org/forms/post') >>> page = BeautifulSoup(response.text) >>> form = soup.find('form') >>> {field.get('name') for field in form.find_all(re.compile('input|textarea'))} {'delivery', 'topping', 'size', 'custemail', 'comments', 'custtel', 'custname'}","text_count":291,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response = requests.get('https://httpbin.org/forms/post')\n&gt;&gt;&gt; page = BeautifulSoup(response.text)\n&gt;&gt;&gt; form = soup.find('form')\n&gt;&gt;&gt; {field.get('name') for field in form.find_all(re.compile('input|textarea'))}\n{'delivery', 'topping', 'size', 'custemail', 'comments', 'custtel', 'custname'}"}]}]},{"block_type":"element","block":"k67ev6q8","search_text":"Note textarea is a valid input, as well as defined in the HTML format. ","text_count":71,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"textarea"}]},{"block_type":"text","content":"&nbsp;is a valid input, as well as defined in the HTML format.&nbsp;"}]},{"block_type":"element","block":"k67ev6q9","search_text":"Prepare the data to be posted as a dictionary. Check the values are the same as defined in the form: ","text_count":101,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data to be posted as a dictionary. Check the values are the same as defined in the form:"}]}]},{"block_type":"element","block":"k67ev6qa","search_text":">>> data = {'custname': \"Sean O'Connell\", 'custtel': '123-456-789', 'custemail': 'sean@oconnell.ie', 'size': 'small', 'topping': ['bacon', 'onion'], 'delivery': '20:30', 'comments': ''}","text_count":185,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = {'custname': \"Sean O'Connell\", 'custtel': '123-456-789', 'custemail': 'sean@oconnell.ie', 'size': 'small', 'topping': ['bacon', 'onion'], 'delivery': '20:30', 'comments': ''}"}]}]},{"block_type":"element","block":"k67ev6qb","search_text":"Post the values and check that the response is the same as returned in the browser: ","text_count":84,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Post the values and check that the response is the same as returned in the browser:"}]}]},{"block_type":"element","block":"k67ev6qc","search_text":">>> response = requests.post('https://httpbin.org/post', data) >>> response <Response [200]> >>> response.json() {'args': {}, 'data': '', 'files': {}, 'form': {'comments': '', 'custemail': 'sean@oconnell.ie', 'custname': \"Sean O'Connell\", 'custtel': '123-456-789', 'delivery': '20:30', 'size': 'small', 'topping': ['bacon', 'onion']}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Content-Length':","text_count":440,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response = requests.post('https://httpbin.org/post', data)\n&gt;&gt;&gt; response\n&lt;Response [200]&gt;\n&gt;&gt;&gt; response.json()\n{'args': {}, 'data': '', 'files': {}, 'form': {'comments': '', 'custemail': 'sean@oconnell.ie', 'custname': \"Sean O'Connell\", 'custtel': '123-456-789', 'delivery': '20:30', 'size': 'small', 'topping': ['bacon', 'onion']}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Content-Length':"}]}]},{"block_type":"element","block":"k67ev6qd","search_text":"'140', 'Content-Type': 'application/x-www-form-urlencoded', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.18.3'}, 'json': None, 'origin': '89.100.17.159', 'url': 'https://httpbin.org/post'}","text_count":199,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"'140', 'Content-Type': 'application/x-www-form-urlencoded', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.18.3'}, 'json': None, 'origin': '89.100.17.159', 'url': 'https://httpbin.org/post'}"}]}]},{"block_type":"element","block":"k67ev6qe","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6qf","search_text":"requests directly accepts to send data in the proper way. By default, it sends the POST data in the application/x-www-form-urlencoded format.","text_count":141,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"directly accepts to send data in the proper way. By default, it sends the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"data in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"application/x-www-form-urlencoded"}]},{"block_type":"text","content":"&nbsp;format."}]},{"block_type":"element","block":"k67ev6qg","search_text":"Tip Compare that with the Accessing web APIs recipe, where the data is explicitly sent in JSON format using the argument json . This makes the Content-Type be application/json instead of application/x-www-form-urlencoded . ","text_count":223,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Compare that with the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Accessing web APIs"}]},{"block_type":"text","content":"&nbsp;recipe, where the data is explicitly sent in JSON format using the argument"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"json"}]},{"block_type":"text","content":". This makes the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Content-Type"}]},{"block_type":"text","content":"be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"application/json"}]},{"block_type":"text","content":"instead of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"application/x-www-form-urlencoded"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6qh","search_text":"The key aspect here is to respect the format of the form and the possible values that can return an error if incorrect, typically a 400 error.","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The key aspect here is to respect the format of the form and the possible values that can return an error if incorrect, typically a 400 error."}]},{"block_type":"element","block":"k67ev6qi","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6qj","search_text":"Other than following the format of forms and inputting valid values, the main problem when working with forms is the multiple ways of preventing spam and abusive behavior.","text_count":171,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Other than following the format of forms and inputting valid values, the main problem when working with forms is the multiple ways of preventing spam and abusive behavior."}]},{"block_type":"element","block":"k67ev6qk","search_text":"A very common limitation is to ensure that you downloaded the form before submitting it, to avoid submitting multiple forms or Cross-Site Request Forgery ( CSRF ).","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A very common limitation is to ensure that you downloaded the form before submitting it, to avoid submitting multiple forms or"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Cross-Site Request Forgery"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"CSRF"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev6ql","search_text":"Tip CSRF, which means producing a malicious call from a page to another taking advantage that your browser is authenticated, is a serious problem. For example, entering in a puppies site that take advantage of you being logged into your bank page to perform operations \"on your behalf\". Here is a good description of it: https://stackoverflow.com/a/33829607 . New techniques in browsers help with these issues by default. ","text_count":422,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"CSRF, which means&nbsp;producing a malicious call from a page to another taking advantage that&nbsp; your browser is authenticated, is a serious problem. For example, entering in a puppies site that take advantage of you being logged into your bank page to perform operations \"on your behalf\". Here is a good description of it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://stackoverflow.com/a/33829607"},"children":[{"block_type":"text","content":"https://stackoverflow.com/a/33829607"}]},{"block_type":"text","content":". New techniques in browsers help with these issues by default."}]}]},{"block_type":"element","block":"k67ev6qm","search_text":"To obtain the specific token, you need to first download the form, as shown in the recipe, obtain the value of the CSRF token, and resubmit it. Note that the token can have different names; this is just an example:","text_count":214,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To obtain the specific token, you need to first download the form, as shown in the recipe, obtain the value of the CSRF token, and resubmit it. Note that the token can have different names; this is just an example:"}]},{"block_type":"element","block":"k67ev6qn","search_text":">>> form.find(attrs={'name': 'token'}).get('value') 'ABCEDF12345'","text_count":65,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; form.find(attrs={'name': 'token'}).get('value')\n'ABCEDF12345'"}]}]},{"block_type":"element","block":"k67ev6qo","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6qp","search_text":"The Downloading web pages recipe The Parsing HTML recipe ","text_count":57,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6qq","search_text":"Using Selenium for advanced interaction","text_count":39,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Using Selenium for advanced interaction"}]},{"block_type":"element","block":"k67ev6qr","search_text":"Sometimes, nothing short of the real thing will work. Selenium is a project to achieve automation in web browsers. It's conceived as a way of automatic testing, but it also can be used to automate interactions with a site.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sometimes, nothing short of the real thing will work. Selenium is a project to achieve automation in web browsers. It's conceived as a way of&nbsp;automatic testing, but it also can be used to automate interactions with a site."}]},{"block_type":"element","block":"k67ev6qs","search_text":"Selenium can control Safari, Chrome, Firefox, Internet Explorer, or Microsoft Edge, though it requires installing a specific driver for each case. We'll use Chrome. ","text_count":165,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Selenium can control Safari, Chrome, Firefox, Internet Explorer, or Microsoft Edge, though it requires installing a specific driver for each case. We'll use Chrome.&nbsp;"}]},{"block_type":"element","block":"k67ev6qt","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6qu","search_text":"We need to install the right driver for Chrome, called chromedriver . It is available here: https://sites.google.com/a/chromium.org/chromedriver/ . It is available for most platforms. It also requires that you have Chrome installed: https://www.google.com/chrome/ .","text_count":265,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install the right driver for Chrome, called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"chromedriver"}]},{"block_type":"text","content":". It is available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://sites.google.com/a/chromium.org/chromedriver/"},"children":[{"block_type":"text","content":"https://sites.google.com/a/chromium.org/chromedriver/"}]},{"block_type":"text","content":". It is available for most platforms. It also requires that you have Chrome installed:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.google.com/chrome/"},"children":[{"block_type":"text","content":"https://www.google.com/chrome/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6qv","search_text":"Add the selenium module to requirements.txt and install it:","text_count":59,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Add the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"selenium"}]},{"block_type":"text","content":"module to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"and install it:"}]},{"block_type":"element","block":"k67ev6qw","search_text":"$ echo \"selenium==3.12.0\" >> requirements.txt $ pip install -r requirements.txt","text_count":79,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"selenium==3.12.0\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev6qx","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6qy","search_text":"Import Selenium, start a browser, and load the form page. A page will open reflecting the operations: ","text_count":102,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import Selenium, start a browser, and load the form page. A page will open reflecting the operations:"}]}]},{"block_type":"element","block":"k67ev6qz","search_text":">>> from selenium import webdriver >>> browser = webdriver.Chrome() >>> browser.get('https://httpbin.org/forms/post')","text_count":117,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from selenium import webdriver\n&gt;&gt;&gt; browser = webdriver.Chrome()\n&gt;&gt;&gt; browser.get('https://httpbin.org/forms/post')"}]}]},{"block_type":"element","block":"k67ev6r0","search_text":"Note the banner with Chrome is being controlled by automated test software.","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the banner with Chrome is being controlled by automated test software."}]},{"block_type":"element","block":"k67ev6r1","search_text":"Add a value in the Customer name field. Remember that it is called custname : ","text_count":78,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a value in the Customer name&nbsp;field. Remember that it is called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"custname"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6r2","search_text":">>> custname = browser.find_element_by_name(\"custname\") >>> custname.clear() >>> custname.send_keys(\"Sean O'Connell\")","text_count":117,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; custname = browser.find_element_by_name(\"custname\")\n&gt;&gt;&gt; custname.clear()\n&gt;&gt;&gt; custname.send_keys(\"Sean O'Connell\")"}]}]},{"block_type":"element","block":"k67ev6r3","search_text":"The form will update:","text_count":21,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The form will update:"}]},{"block_type":"element","block":"k67ev6r4","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000027.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6r5","search_text":"Select the pizza size as medium : ","text_count":34,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select the pizza size as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"medium"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6r6","search_text":">>> for size_element in browser.find_elements_by_name(\"size\"): ... if size_element.get_attribute('value') == 'medium': ... size_element.click() ... >>>","text_count":151,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for size_element in browser.find_elements_by_name(\"size\"):\n...     if size_element.get_attribute('value') == 'medium':\n...         size_element.click()\n...\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev6r7","search_text":"This will change the pizza size ratio box.","text_count":42,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This will change the pizza size ratio box."}]},{"block_type":"element","block":"k67ev6r8","search_text":"Add bacon and cheese : ","text_count":23,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"bacon"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cheese"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6r9","search_text":">>> for topping in browser.find_elements_by_name('topping'): ... if topping.get_attribute('value') in ['bacon', 'cheese']: ... topping.click() ... >>>","text_count":150,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for topping in browser.find_elements_by_name('topping'):\n...     if topping.get_attribute('value') in ['bacon', 'cheese']:\n...         topping.click()\n...\n&gt;&gt;&gt;"}]}]},{"block_type":"element","block":"k67ev6ra","search_text":"Finally, the checkboxes will appear as marked:","text_count":46,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the checkboxes will appear as marked:"}]},{"block_type":"element","block":"k67ev6rb","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000007.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6rc","search_text":"Submit the form. The page will submit and the result will be displayed: ","text_count":72,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Submit the form. The page will submit and the result will be displayed:"}]}]},{"block_type":"element","block":"k67ev6rd","search_text":">>> browser.find_element_by_tag_name('form').submit()","text_count":53,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; browser.find_element_by_tag_name('form').submit()"}]}]},{"block_type":"element","block":"k67ev6re","search_text":"The form will be submitted and the result from the server will be displayed:","text_count":76,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The form will be submitted and the result from the server will be displayed:"}]},{"block_type":"element","block":"k67ev6rf","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000019.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6rg","search_text":"Close the browser: ","text_count":19,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Close the browser:"}]}]},{"block_type":"element","block":"k67ev6rh","search_text":">>> browser.quit()","text_count":18,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; browser.quit()"}]}]},{"block_type":"element","block":"k67ev6ri","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6rj","search_text":"Step 1 in the How to do it… section shows how to create a Selenium page and go to a particular URL.","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section shows how to create a Selenium page and go to a particular URL."}]},{"block_type":"element","block":"k67ev6rk","search_text":"Selenium works in a similar way to Beautiful Soup. Select the adequate element, and then manipulate it. The selectors in Selenium work in a similar way to those in Beautiful Soup, with the most common ones being find_element_by_id , find_element_by_class_name , find_element_by_name , find_element_by_tag_name , and find_element_by_css_selector . There are equivalent find_elements_by_X that return a list instead of the first found element ( find_elements_by_tag_name , find_elements_by_name , and more). This is also useful when checking whether the element is there or not. If there's no elements, find_element will raise an error while find_elements will return an empty list.","text_count":680,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Selenium works in a similar way to Beautiful Soup. Select the adequate element, and then manipulate it.&nbsp;The selectors in Selenium work in a similar way to those in Beautiful Soup, with the most common&nbsp;ones being"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_element_by_id"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_element_by_class_name"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_element_by_name"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_element_by_tag_name"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_element_by_css_selector"}]},{"block_type":"text","content":". There are equivalent"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_elements_by_X"}]},{"block_type":"text","content":"&nbsp;&nbsp;that return a list instead of the first found element&nbsp;(&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_elements_by_tag_name"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_elements_by_name"}]},{"block_type":"text","content":", and more). This is also useful when checking whether the element is there or not. If there's no elements,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_element"}]},{"block_type":"text","content":"will raise an error while"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"find_elements"}]},{"block_type":"text","content":"will return an empty list."}]},{"block_type":"element","block":"k67ev6rl","search_text":"The data on the elements can be obtained through .get_attribute() for HTML attributes (such as the values on the form elements) or .text .","text_count":138,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The data on the elements can be obtained through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".get_attribute()"}]},{"block_type":"text","content":"&nbsp;for HTML attributes (such as the values on the form elements) or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".text"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6rm","search_text":"The elements can be manipulated by simulating sending keystrokes to input text, with the method .send_keys() , clicked with .click() or submitted with .submit() if they accept that. .submit() will search on a form for the proper submission, and .click() will select/deselect in the same way that a click of the mouse will do.","text_count":325,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The elements can be manipulated by simulating sending keystrokes to input text, with the method"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".send_keys()"}]},{"block_type":"text","content":", clicked with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".click()"}]},{"block_type":"text","content":"or submitted with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".submit()"}]},{"block_type":"text","content":"if they accept that."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".submit()"}]},{"block_type":"text","content":"will search on a form for the proper submission, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".click()"}]},{"block_type":"text","content":"will select/deselect in the same way that a click of the mouse will do."}]},{"block_type":"element","block":"k67ev6rn","search_text":"Finally, step 6 closes the browser.","text_count":35,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, step 6 closes the browser."}]},{"block_type":"element","block":"k67ev6ro","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6rp","search_text":"Here is the full Selenium documentation: http://selenium-python.readthedocs.io/ .","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Here is the full Selenium documentation:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://selenium-python.readthedocs.io/"},"children":[{"block_type":"text","content":"http://selenium-python.readthedocs.io/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6rq","search_text":"For each of the elements, there's extra information that can be extracted, such as .is_displayed() or .is_selected() . Text can be searched using .find_element_by_link_text() and .find_element_by_partial_link_text() .","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For each of the elements, there's extra information that can be extracted,&nbsp;such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".is_displayed()"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".is_selected()"}]},{"block_type":"text","content":". Text can be searched using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".find_element_by_link_text()"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".find_element_by_partial_link_text()"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6rr","search_text":"Sometimes, opening a browser can be inconvenient. An alternative is to start the browser in headless mode and manipulate it from there, like this:","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sometimes, opening a browser can be inconvenient. An alternative is to start the browser in headless mode and manipulate it from there, like this:"}]},{"block_type":"element","block":"k67ev6rs","search_text":">>> from selenium.webdriver.chrome.options import Options >>> chrome_options = Options() >>> chrome_options.add_argument(\"--headless\") >>> browser = webdriver.Chrome(chrome_options=chrome_options) >>> browser.get('https://httpbin.org/forms/post')","text_count":246,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from selenium.webdriver.chrome.options import Options\n&gt;&gt;&gt; chrome_options = Options()\n&gt;&gt;&gt; chrome_options.add_argument(\"--headless\")\n&gt;&gt;&gt; browser = webdriver.Chrome(chrome_options=chrome_options)\n&gt;&gt;&gt; browser.get('https://httpbin.org/forms/post')"}]}]},{"block_type":"element","block":"k67ev6rt","search_text":"The page won't be displayed. But a screenshot can be saved anyway with the following line:","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The page won't be displayed. But a screenshot can be saved anyway with the following line:"}]},{"block_type":"element","block":"k67ev6ru","search_text":">>> browser.save_screenshot('screenshot.png')","text_count":45,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; browser.save_screenshot('screenshot.png')"}]}]},{"block_type":"element","block":"k67ev6rv","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6rw","search_text":"The Parsing HTML recipe The Interact with forms recipe ","text_count":55,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Interact with forms"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6rx","search_text":"Accessing password-protected pages","text_count":34,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Accessing password-protected pages"}]},{"block_type":"element","block":"k67ev6ry","search_text":"Sometimes a web page is not open to the public, but protected in some way. The most basic aspect is to use basic HTTP authentication, which is integrated into virtually every web server, and it's a user/password schema.","text_count":219,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sometimes a web page is not open to the public, but protected in some way. The most basic aspect is to use basic HTTP authentication, which is integrated into virtually every web server, and it's a user/password schema."}]},{"block_type":"element","block":"k67ev6rz","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6s0","search_text":"We can test this kind of authentication in https://httpbin.org .","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We can test this kind of authentication in&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://httpbin.org"},"children":[{"block_type":"text","content":"https://httpbin.org"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6s1","search_text":"It has a path, /basic-auth/{user}/{password} , which forces authentication, with the user and password stated. This is very handy for understanding how authentication works.","text_count":173,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It has a path,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/basic-auth/{user}/{password}"}]},{"block_type":"text","content":", which forces authentication, with the user and password stated. This is very handy for understanding how authentication works."}]},{"block_type":"element","block":"k67ev6s2","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6s3","search_text":"Import requests : ","text_count":18,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6s4","search_text":">>> import requests","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests"}]}]},{"block_type":"element","block":"k67ev6s5","search_text":"Make a GET request to the URL with the wrong credentials. Notice that we set the credentials on the URL to be user and psswd : ","text_count":127,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"request to the URL with the wrong credentials. Notice that we set the credentials on the URL to be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"user"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"psswd"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6s6","search_text":">>> requests.get('https://httpbin.org/basic-auth/user/psswd', auth=('user', 'psswd')) <Response [200]>","text_count":102,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; requests.get('https://httpbin.org/basic-auth/user/psswd', \n                 auth=('user', 'psswd'))\n&lt;Response [200]&gt;"}]}]},{"block_type":"element","block":"k67ev6s7","search_text":"Use the wrong credentials to return a 401 status code (Unauthorized): ","text_count":70,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the wrong credentials to return a 401 status code (Unauthorized):"}]}]},{"block_type":"element","block":"k67ev6s8","search_text":">>> requests.get('https://httpbin.org/basic-auth/user/psswd', auth=('user', 'wrong')) <Response [401]>","text_count":102,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; requests.get('https://httpbin.org/basic-auth/user/psswd', \n                 auth=('user', 'wrong'))\n&lt;Response [401]&gt;"}]}]},{"block_type":"element","block":"k67ev6s9","search_text":"The credentials can be also passed directly in the URL, separated by a colon and an @ symbol before the server, like this: ","text_count":123,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The credentials can be also passed directly in the URL, separated by a colon and an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"@"}]},{"block_type":"text","content":"symbol before the server, like this:"}]}]},{"block_type":"element","block":"k67ev6sa","search_text":">>> requests.get('https://user:psswd@httpbin.org/basic-auth/user/psswd') <Response [200]> >>> requests.get('https://user:wrong@httpbin.org/basic-auth/user/psswd') <Response [401]>","text_count":179,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; requests.get('https://user:psswd@httpbin.org/basic-auth/user/psswd')\n&lt;Response [200]&gt;\n&gt;&gt;&gt; requests.get('https://user:wrong@httpbin.org/basic-auth/user/psswd')\n&lt;Response [401]&gt;"}]}]},{"block_type":"element","block":"k67ev6sb","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6sc","search_text":"As HTTP basic authentication is supported everywhere, support from requests is very easy.","text_count":89,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As HTTP basic authentication is supported everywhere, support from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"is very easy."}]},{"block_type":"element","block":"k67ev6sd","search_text":"Steps 2 and 4 in the How to do it… section show how to provide the proper password. Step 3 shows what happens when the password is the wrong one.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 2 and 4 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section show how to provide the proper password. Step 3 shows what happens when the password is the wrong one."}]},{"block_type":"element","block":"k67ev6se","search_text":"Tip Remember to always use HTTPS to ensure that the sending of the password is kept secret. If you use HTTP, the password will be sent in the open over the web. ","text_count":161,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember to always use HTTPS to ensure that the sending of the password is kept secret. If you use HTTP, the password will be sent in the open over the web."}]}]},{"block_type":"element","block":"k67ev6sf","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6sg","search_text":"Adding the user and password to the URL works on the browser as well. Try to access the page directly to see a box displayed asking for the username and password:","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Adding the user and password to the URL works on the browser as well. Try to access the page directly to see a box displayed asking for the username and password:"}]},{"block_type":"element","block":"k67ev6sh","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000002.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6si","search_text":"User credentials page","text_count":21,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"User credentials page"}]},{"block_type":"element","block":"k67ev6sj","search_text":"When using the URL containing the user and password, https://user:psswd@httpbin.org/basic-auth/user/psswd , the dialog does not appear and it authenticates automatically.","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When using the URL containing the user and password,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"https://user:psswd@httpbin.org/basic-auth/user/psswd"}]},{"block_type":"text","content":", the dialog does not appear and it authenticates automatically."}]},{"block_type":"element","block":"k67ev6sk","search_text":"If you need to access multiple pages, you can create a session in requests and set the authentication parameters to avoid having to input them everywhere:","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to access multiple pages, you can create a session in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"and set the authentication parameters to avoid having to input them everywhere:"}]},{"block_type":"element","block":"k67ev6sl","search_text":">>> s = requests.Session() >>> s.auth = ('user', 'psswd') >>> s.get('https://httpbin.org/basic-auth/user/psswd') <Response [200]>","text_count":129,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; s = requests.Session()\n&gt;&gt;&gt; s.auth = ('user', 'psswd')\n&gt;&gt;&gt; s.get('https://httpbin.org/basic-auth/user/psswd')\n&lt;Response [200]&gt;"}]}]},{"block_type":"element","block":"k67ev6sm","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6sn","search_text":"The Downloading web pages recipe The Accessing Web APIs recipe ","text_count":63,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Accessing Web APIs"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6so","search_text":"Speeding up web scraping","text_count":24,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Speeding up web scraping"}]},{"block_type":"element","block":"k67ev6sp","search_text":"Most of the time spent downloading information from web pages is usually spent waiting. A request goes from our computer to whatever server will process it, and until the response is composed and comes back to our computer, we cannot do much about it.","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most of the time spent downloading information from web pages is usually spent waiting. A request goes from our computer to whatever server will process it, and until the response is composed and comes back to our computer, we cannot do much about it."}]},{"block_type":"element","block":"k67ev6sq","search_text":"During the execution of the recipes in the book, you'll notice there's a wait involved in requests calls, normally of around one or two seconds. But computers can do other stuff while waiting, including making more requests at the same time. In this recipe, we will see how to download a list of pages in parallel and wait until they are all ready. We will use an intentionally slow server to show the point.","text_count":408,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"During the execution of the recipes in the book, you'll notice there's a wait involved in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"calls, normally of around one or two seconds. But computers can do other stuff while waiting, including making more requests at the same time. In this recipe, we will see how to download a list of pages in parallel and wait until they are all ready. We will use an intentionally slow server to show the point."}]},{"block_type":"element","block":"k67ev6sr","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ss","search_text":"We'll get code to crawl and search for keywords, making use of the futures capabilities of Python 3 to download multiple pages at the same time.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll get code to crawl and search for keywords, making use of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"futures"}]},{"block_type":"text","content":"capabilities of Python 3 to download multiple pages at the same time."}]},{"block_type":"element","block":"k67ev6st","search_text":"A future is an object that represents the promise of a value. This means that you immediately receive an object while the code is being executed in the background. Only, when specifically requesting for its .result() the code blocks until getting it.","text_count":250,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"future"}]},{"block_type":"text","content":"is an object that represents the promise of a value. This means that you immediately&nbsp;receive an object while the code is being executed in the background. Only, when specifically requesting for its"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".result()"}]},{"block_type":"text","content":"the code blocks until getting it."}]},{"block_type":"element","block":"k67ev6su","search_text":"To generate a future , you need a background engine, called executor . Once created, submit a function and parameters to it to retrieve a future . The retrieval of the result can be delayed as long as necessary, allowing the generation of several futures in a row, and waiting until all are finished, executing them in parallel, instead of creating one, wait until it finishes, creating another, and so on.","text_count":406,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To generate a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"future"}]},{"block_type":"text","content":", you need a background engine, called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"executor"}]},{"block_type":"text","content":". Once created,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"submit"}]},{"block_type":"text","content":"a function and parameters to it to retrieve a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"future"}]},{"block_type":"text","content":". &nbsp;The retrieval of the result can be delayed as long as necessary, allowing the generation of several"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"futures"}]},{"block_type":"text","content":"in a row, and waiting until all are finished, executing them in parallel, instead of creating one, wait until it finishes, creating another, and so on."}]},{"block_type":"element","block":"k67ev6sv","search_text":"There are several ways to create an executor; in this recipe, we'll use ThreadPoolExecutor , which will use threads.","text_count":116,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are several ways to&nbsp;create&nbsp;an executor; in this&nbsp;recipe, we'll use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ThreadPoolExecutor"}]},{"block_type":"text","content":", which will use threads."}]},{"block_type":"element","block":"k67ev6sw","search_text":"We'll use as an example a prepared example, available in the GitHub repo: https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter03/test_site . Download the whole site and run the included script","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use as an example a prepared example, available in the GitHub repo:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter03/test_site"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter03/test_site"}]},{"block_type":"text","content":". Download the whole site and run the included script"}]},{"block_type":"element","block":"k67ev6sx","search_text":"$ python simple_delay_server.py -d 2","text_count":36,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python simple_delay_server.py -d 2"}]}]},{"block_type":"element","block":"k67ev6sy","search_text":"This serves the site in the URL http://localhost:8000 . You can check it on a browser. It's s simple blog with three entries. Most of it is uninteresting, but we added a couple of paragraphs that contain the keyword python . The parameter -d 2 makes the server intentionally slow, simulating a bad connection.","text_count":309,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This serves the site in the URL&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"http://localhost:8000"}]},{"block_type":"text","content":". You can check it on a browser. It's s simple blog with three entries. Most of it is uninteresting, but we added a couple of paragraphs that contain the keyword&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python"}]},{"block_type":"text","content":". The parameter"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-d 2"}]},{"block_type":"text","content":"makes the server intentionally slow, simulating a bad connection."}]},{"block_type":"element","block":"k67ev6sz","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6t0","search_text":"Write the following script, speed_up_step1.py . The full code is available in GitHub under the Chapter03 : https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter03/speed_up_step1.py directory. Here are only the most relevant parts. It is based on crawling_web_step1.py : ","text_count":298,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write the following script,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"speed_up_step1.py"}]},{"block_type":"text","content":". The full code is available in GitHub under the&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter03"}]},{"block_type":"text","content":":"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter03/speed_up_step1.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter03/speed_up_step1.py&nbsp;"}]},{"block_type":"text","content":"directory. Here are only the most relevant parts. It is based on&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"crawling_web_step1.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6t1","search_text":"... def process_link(source_link, text): ... return source_link, get_links(parsed_source, page) ... def main(base_url, to_search, workers): checked_links = set() to_check = [base_url] max_checks = 10 with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor: while to_check: futures = [executor.submit(process_link, url, to_search) for url in to_check] to_check = [] for data in concurrent.futures.as_completed(futures): link, new_links = data.result() checked_links.add(link) for link in new_links: if link not in checked_links and link not in to_check: to_check.append(link) max_checks -= 1 if not max_checks: return if __name__ == '__main__': parser = argparse.ArgumentParser() ... parser.add_argument('-w', type=int, help='Number of workers', default=4) args = parser.parse_args() main(args.u, args.p, args.w)","text_count":831,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"...\ndef process_link(source_link, text):\n    ...\n    return source_link, get_links(parsed_source, page)\n...\n\ndef main(base_url, to_search, workers):\n    checked_links = set()\n    to_check = [base_url]\n    max_checks = 10\n\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        while to_check:\n            futures = [executor.submit(process_link, url, to_search)\n                       for url in to_check]\n            to_check = []\n            for data in concurrent.futures.as_completed(futures):\n                link, new_links = data.result()\n\n                checked_links.add(link)\n                for link in new_links:\n                    if link not in checked_links and link not in to_check:\n                        to_check.append(link)\n\n                max_checks -= 1\n                if not max_checks:\n                    return\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser()\n    ...\n    parser.add_argument('-w', type=int, help='Number of workers',\n                        default=4)\n    args = parser.parse_args()\n\n    main(args.u, args.p, args.w)"}]}]},{"block_type":"element","block":"k67ev6t2","search_text":"Notice the differences in the main function. Also, there's an extra parameter added (number of concurrent workers), and the function process_link now returns the source link. Run the crawling_web_step1.py script to get a time baseline. Notice the output has been removed here for clarity: ","text_count":289,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Notice the differences in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function. Also, there's an extra parameter added (number of concurrent workers), and the function"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"process_link"}]},{"block_type":"text","content":"&nbsp;now returns the source link."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"crawling_web_step1.py"}]},{"block_type":"text","content":"&nbsp;script&nbsp;to get a time baseline. Notice the output has been removed here for clarity:"}]}]},{"block_type":"element","block":"k67ev6t3","search_text":"$ time python crawling_web_step1.py http://localhost:8000/ ... REMOVED OUTPUT real 0m12.221s user 0m0.160s sys 0m0.034s","text_count":119,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ time python crawling_web_step1.py http://localhost:8000/\n... REMOVED OUTPUT\nreal 0m12.221s\nuser 0m0.160s\nsys 0m0.034s"}]}]},{"block_type":"element","block":"k67ev6t4","search_text":"Run the new script with one worker, which is slower than the original one: ","text_count":75,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the new script with one worker, which is slower than the original one:"}]}]},{"block_type":"element","block":"k67ev6t5","search_text":"$ time python speed_up_step1.py -w 1 ... REMOVED OUTPUT real 0m16.403s user 0m0.181s sys 0m0.068s","text_count":97,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ time python speed_up_step1.py -w 1\n... REMOVED OUTPUT\nreal 0m16.403s\nuser 0m0.181s\nsys 0m0.068s"}]}]},{"block_type":"element","block":"k67ev6t6","search_text":"Increase the number of workers: ","text_count":32,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Increase the number of workers:"}]}]},{"block_type":"element","block":"k67ev6t7","search_text":"$ time python speed_up_step1.py -w 2 ... REMOVED OUTPUT real 0m10.353s user 0m0.199s sys 0m0.068s","text_count":97,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ time python speed_up_step1.py -w 2\n... REMOVED OUTPUT\nreal 0m10.353s\nuser 0m0.199s\nsys 0m0.068s"}]}]},{"block_type":"element","block":"k67ev6t8","search_text":"Adding more workers decreases the time: ","text_count":40,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Adding more workers decreases the time:"}]}]},{"block_type":"element","block":"k67ev6t9","search_text":"$ time python speed_up_step1.py -w 5 ... REMOVED OUTPUT real 0m6.234s user 0m0.171s sys 0m0.040s","text_count":96,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ time python speed_up_step1.py -w 5\n... REMOVED OUTPUT\nreal 0m6.234s\nuser 0m0.171s\nsys 0m0.040s"}]}]},{"block_type":"element","block":"k67ev6ta","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6tb","search_text":"The main engine to create the concurrent requests is the main function. Notice that the rest of the code is basically untouched (other than returning the source link in the process_link function).","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main engine to create the concurrent requests is the main function. Notice that the rest of the code is basically untouched (other than returning the source link in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"process_link"}]},{"block_type":"text","content":"function)."}]},{"block_type":"element","block":"k67ev6tc","search_text":"Note This change is actually quite common when adapting for concurrency. Concurrent tasks need to return all the relevant data, as they cannot rely on an ordered context. ","text_count":171,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This change is actually quite common when adapting for concurrency. Concurrent tasks need to return all the relevant data, as they cannot rely on an ordered context."}]}]},{"block_type":"element","block":"k67ev6td","search_text":"This is the relevant part of the code that handles the concurrent engine:","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is the relevant part of the code that handles the concurrent engine:"}]},{"block_type":"element","block":"k67ev6te","search_text":"with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor: while to_check: futures = [executor.submit(process_link, url, to_search) for url in to_check] to_check = [] for data in concurrent.futures.as_completed(futures): link, new_links = data.result() checked_links.add(link) for link in new_links: if link not in checked_links and link not in to_check: to_check.append(link) max_checks -= 1 if not max_checks: return","text_count":436,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n    while to_check:\n        futures = [executor.submit(process_link, url, to_search)\n                   for url in to_check]\n        to_check = []\n        for data in concurrent.futures.as_completed(futures):\n            link, new_links = data.result()\n\n            checked_links.add(link)\n            for link in new_links:\n                if link not in checked_links and link not in to_check:\n                    to_check.append(link)\n\n             max_checks -= 1\n             if not max_checks:\n                return"}]}]},{"block_type":"element","block":"k67ev6tf","search_text":"The with context creates a pool of workers, specifying its number. Inside, a list of futures containing all the URLs to retrieve is created. The .as_completed() function returns the futures that are finished, and then there's some work dealing with obtaining newly found links and checking whether they need to be added to be retrieved or not. This process is similar to the one presented in the Crawling the web recipe.","text_count":420,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context creates a pool of workers, specifying its number. Inside, a list of futures containing all the URLs to retrieve is created. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".as_completed()"}]},{"block_type":"text","content":"function returns the futures that are finished, and then there's some work dealing with obtaining newly found links and checking whether they need to be added to be retrieved or not. This process is similar to the one presented in the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling the web&nbsp;"}]},{"block_type":"text","content":"recipe."}]},{"block_type":"element","block":"k67ev6tg","search_text":"The process starts again until enough links have been retrieved or there are no links to retrieve. Note that the links are retrieved in batches; the first time, the base link is processed and all links are retrieved. In the second iteration, all those links will be requested. Once they are all downloaded, a new batch will be processed.","text_count":337,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The process starts again until enough links have been retrieved or there are no links to retrieve. Note that the links are retrieved in batches; the first time, the base link is processed and all links are retrieved. In the second iteration, all those links will be requested. Once they are all downloaded, a new batch will be processed."}]},{"block_type":"element","block":"k67ev6th","search_text":"Note When dealing with concurrent requests, keep in mind that they can change order between two executions. If a request takes a little more or a little less time, that can affect the ordering of the retrieved information. Because we stop after downloading 10 pages, that also means that the 10 pages could be different. ","text_count":321,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When dealing with concurrent requests, keep in mind that they can change order between two executions. If a request takes a little more or a little less time, that can affect the ordering of the retrieved information. Because we stop after downloading 10 pages, that also means that the 10 pages could be different."}]}]},{"block_type":"element","block":"k67ev6ti","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6tj","search_text":"The full futures documentation in Python can be found here: https://docs.python.org/3/library/concurrent.futures.html .","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"futures"}]},{"block_type":"text","content":"documentation in Python can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/concurrent.futures.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/concurrent.futures.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6tk","search_text":"Tip As you can see in steps 4 and 5 in the How to do it… section, properly determining the number of workers can require some tests. Some numbers can make the process slower, due the increase in management. Do not be afraid to experiment! ","text_count":239,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As you can see in steps 4 and 5 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section,&nbsp;properly&nbsp;determining the number of workers can require some tests. Some numbers can make the process slower, due the increase in management. Do not be afraid to experiment!"}]}]},{"block_type":"element","block":"k67ev6tl","search_text":"In the Python world, there are other ways to make concurrent HTTP requests. There's a native request module that allows us to work with futures , called requests-futures . It can be found here: https://github.com/ross/requests-futures .","text_count":236,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the Python world, there are other ways to make concurrent HTTP requests. There's a native request module that allows us to work with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"futures"}]},{"block_type":"text","content":", called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests-futures"}]},{"block_type":"text","content":". It can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/ross/requests-futures"},"children":[{"block_type":"text","content":"https://github.com/ross/requests-futures"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6tm","search_text":"Another alternative is to use asynchronous programming. This way of working has recently gotten a lot of attention, as it can be very efficient in situations when dealing with many concurrent calls, but the resulting way of coding is different from the traditional way and requires some time to get used to. Python includes the asyncio module to work that way, and there's a good module called aiohttp to work with HTTP requests. You can find more information about aiohttp here: https://aiohttp.readthedocs.io/en/stable/client_quickstart.html .","text_count":545,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another alternative is to use asynchronous programming. This way of working has recently gotten a lot of attention, as it can be very efficient in situations when dealing with many concurrent calls, but the resulting way of coding is different from the traditional way and requires some time to get used to. Python includes the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"asyncio"}]},{"block_type":"text","content":"module to work that way, and there's a good module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aiohttp"}]},{"block_type":"text","content":"to work with HTTP requests. You can find more information about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aiohttp"}]},{"block_type":"text","content":"here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://aiohttp.readthedocs.io/en/stable/client_quickstart.html"},"children":[{"block_type":"text","content":"https://aiohttp.readthedocs.io/en/stable/client_quickstart.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6tn","search_text":"A good introduction to asynchronous programming can be found in this article: https://djangostars.com/blog/asynchronous-programming-in-python-asyncio/ .","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A good introduction to asynchronous programming can be found in this article:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://djangostars.com/blog/asynchronous-programming-in-python-asyncio/"},"children":[{"block_type":"text","content":"https://djangostars.com/blog/asynchronous-programming-in-python-asyncio/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6to","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6tp","search_text":"The Crawling the web recipe The Downloading web pages recipe ","text_count":61,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling the web"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Downloading web pages"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Searching and Reading Local Files","author":"Jaime Buelta","block":"k67eunp3","number":4,"contents":[{"block_type":"element","block":"k67ev6tq","search_text":"In this chapter, we'll cover the following recipes:","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we'll cover the following recipes:"}]},{"block_type":"element","block":"k67ev6tr","search_text":"Crawling and searching directories Reading text files Dealing with encodings Reading CSV files Reading log files Reading file metadata Reading images Reading PDF files Reading Word documents Scanning documents for a keyword ","text_count":224,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Dealing with encodings"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading CSV files"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading log files"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading file metadata"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading images"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading PDF files"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading Word documents"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Scanning documents for a keyword"}]}]},{"block_type":"element","block":"k67ev6ts","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev6tt","search_text":"In this chapter, we will deal with the basic operations to read files, starting with searching and opening files in directories and subdirectories. Then, we'll describe some of the most common file types and how to read them, including formats such as raw text files, PDFs, and Word documents.","text_count":293,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will deal with the basic operations to read files, starting with searching and opening files in directories and subdirectories. Then, we'll describe some of the most common file types and how to read them, including formats such as raw text files, PDFs, and Word documents."}]},{"block_type":"element","block":"k67ev6tu","search_text":"The last recipe will combine them all, showing how to search recursively in a directory for a word in different kinds of files.","text_count":127,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The last recipe will combine them all, showing how to search recursively in a directory for a word in different kinds of files."}]},{"block_type":"element","block":"k67ev6tv","search_text":"Crawling and searching directories","text_count":34,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"element","block":"k67ev6tw","search_text":"In this recipe, we'll learn how to recursively scan a directory to get all the files contained there. The files can be of a particular kind, or just all of them.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll learn how to&nbsp;recursively&nbsp;scan&nbsp;a directory to get all the files contained there. The files can be of a particular kind, or just all of them."}]},{"block_type":"element","block":"k67ev6tx","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6ty","search_text":"Let's start by creating a test directory with some file information:","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's start by creating a test directory with some file information:"}]},{"block_type":"element","block":"k67ev6tz","search_text":"$ mkdir dir $ touch dir/file1.txt $ touch dir/file2.txt $ mkdir dir/subdir $ touch dir/subdir/file3.txt $ touch dir/subdir/file4.txt $ touch dir/subdir/file5.pdf $ touch dir/file6.pdf","text_count":183,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ mkdir dir\n$ touch dir/file1.txt\n$ touch dir/file2.txt\n$ mkdir dir/subdir\n$ touch dir/subdir/file3.txt\n$ touch dir/subdir/file4.txt\n$ touch dir/subdir/file5.pdf\n$ touch dir/file6.pdf"}]}]},{"block_type":"element","block":"k67ev6u0","search_text":"All the files will be empty; we will use them in this recipe only to discover them. Notice there are four files that have a .txt extension, and two that have a .pdf extension.","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the files will be empty; we will use them in this recipe only to discover them. Notice there are four files that have a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".txt"}]},{"block_type":"text","content":"extension, and two that have a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".pdf"}]},{"block_type":"text","content":"extension."}]},{"block_type":"element","block":"k67ev6u1","search_text":"Note The files are also available in the GitHub repository here: https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter04/documents/dir . ","text_count":165,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The files are also available in the GitHub repository here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter04/documents/dir"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter04/documents/dir"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6u2","search_text":"Enter the created dir directory:","text_count":32,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Enter the created"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dir"}]},{"block_type":"text","content":"&nbsp;directory:"}]},{"block_type":"element","block":"k67ev6u3","search_text":"$ cd dir","text_count":8,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ cd dir"}]}]},{"block_type":"element","block":"k67ev6u4","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6u5","search_text":"Print all the filenames in the dir directory and subdirectories: ","text_count":65,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print all the filenames in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dir"}]},{"block_type":"text","content":"directory and subdirectories:"}]}]},{"block_type":"element","block":"k67ev6u6","search_text":">>> import os >>> for root, dirs, files in os.walk('.'): ... for file in files: ... print(file) ... file1.txt file2.txt file6.pdf file3.txt file4.txt file5.pdf","text_count":159,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import os\n&gt;&gt;&gt; for root, dirs, files in os.walk('.'):\n...     for file in files:\n...         print(file)\n...\nfile1.txt\nfile2.txt\nfile6.pdf\nfile3.txt\nfile4.txt\nfile5.pdf"}]}]},{"block_type":"element","block":"k67ev6u7","search_text":"Print the full path of the files, joining with the root : ","text_count":58,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print the full path of the files, joining with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"root"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6u8","search_text":">>> for root, dirs, files in os.walk('.'): ... for file in files: ... full_file_path = os.path.join(root, file) ... print(full_file_path) ... ./dir/file1.txt ./dir/file2.txt ./dir/file6.pdf ./dir/subdir/file3.txt ./dir/subdir/file4.txt ./dir/subdir/file5.pdf","text_count":258,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for root, dirs, files in os.walk('.'):\n...     for file in files:\n...         full_file_path = os.path.join(root, file)\n...         print(full_file_path)\n...\n./dir/file1.txt\n./dir/file2.txt\n./dir/file6.pdf\n./dir/subdir/file3.txt\n./dir/subdir/file4.txt\n./dir/subdir/file5.pdf"}]}]},{"block_type":"element","block":"k67ev6u9","search_text":"Print only the .pdf files: ","text_count":27,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print only the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".pdf"}]},{"block_type":"text","content":"files:"}]}]},{"block_type":"element","block":"k67ev6ua","search_text":">>> for root, dirs, files in os.walk('.'): ... for file in files: ... if file.endswith('.pdf'): ... full_file_path = os.path.join(root, file) ... print(full_file_path) ... ./dir/file6.pdf ./dir/subdir/file5.pdf","text_count":210,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for root, dirs, files in os.walk('.'):\n...     for file in files:\n...         if file.endswith('.pdf'):\n...             full_file_path = os.path.join(root, file)\n...             print(full_file_path)\n...\n./dir/file6.pdf\n./dir/subdir/file5.pdf"}]}]},{"block_type":"element","block":"k67ev6ub","search_text":"Print only files that contain an even number: ","text_count":46,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print only files that contain an even number:"}]}]},{"block_type":"element","block":"k67ev6uc","search_text":">>> import re >>> for root, dirs, files in os.walk('.'): ... for file in files: ... if re.search(r'[13579]', file): ... full_file_path = os.path.join(root, file) ... print(full_file_path) ... ./dir/file1.txt ./dir/subdir/file3.txt ./dir/subdir/file5.pdf","text_count":253,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import re\n&gt;&gt;&gt; for root, dirs, files in os.walk('.'):\n...     for file in files:\n...         if re.search(r'[13579]', file):\n...             full_file_path = os.path.join(root, file)\n...             print(full_file_path)\n...\n./dir/file1.txt\n./dir/subdir/file3.txt\n./dir/subdir/file5.pdf"}]}]},{"block_type":"element","block":"k67ev6ud","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6ue","search_text":"os.walk() goes through the whole directory and all subdirectories, returning all the files. It returns a tuple with the specific directory, the subdirectories that depends directly, and all the files:","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.walk()"}]},{"block_type":"text","content":"goes through the whole directory and all subdirectories, returning all the files. It returns a tuple with the specific directory, the subdirectories that depends directly, and all the files:"}]},{"block_type":"element","block":"k67ev6uf","search_text":">>> for root, dirs, files in os.walk('.'): ... print(root, dirs, files) ... . ['dir'] [] ./dir ['subdir'] ['file1.txt', 'file2.txt', 'file6.pdf'] ./dir/subdir [] ['file3.txt', 'file4.txt', 'file5.pdf']","text_count":201,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for root, dirs, files in os.walk('.'):\n... print(root, dirs, files)\n...\n. ['dir'] []\n./dir ['subdir'] ['file1.txt', 'file2.txt', 'file6.pdf']\n./dir/subdir [] ['file3.txt', 'file4.txt', 'file5.pdf']"}]}]},{"block_type":"element","block":"k67ev6ug","search_text":"The os.path.join() function allows us to cleanly join two paths, such as the base path and the file.","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path.join()"}]},{"block_type":"text","content":"&nbsp;function&nbsp;allows us to cleanly join two paths, such as the base path and the file."}]},{"block_type":"element","block":"k67ev6uh","search_text":"As files are returned as pure strings, any kind of filtering can be done, as in step 3. In step 4, the full power of regular expressions can be used to filter. ","text_count":160,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As files are returned as pure strings, any kind of filtering can be done, as in step 3. In step 4, the full power of regular expressions can be used to filter.&nbsp;"}]},{"block_type":"element","block":"k67ev6ui","search_text":"In the next recipe, we'll deal with the content of the files, and not just the filename.","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the next recipe, we'll deal with the content of the files, and not just the filename."}]},{"block_type":"element","block":"k67ev6uj","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6uk","search_text":"The returned files are not opened or modified in anyway. This operation is read-only. Files can be opened as usual, and described as in the following recipes.","text_count":158,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The returned files are not opened or modified in anyway. This operation is read-only. Files can be opened as usual, and described as in the following recipes."}]},{"block_type":"element","block":"k67ev6ul","search_text":"Tip Be aware that changing the structure of the directory while walking it may affect the results. If you need to store any file while working, for example, when copying or moving a file, it's usually a good idea to store it in a different directory. ","text_count":251,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be aware that changing the structure of the directory while walking it may affect the results. If you need to store any file while working, for example, when copying or moving a file, it's usually a good idea to store it in a different directory."}]}]},{"block_type":"element","block":"k67ev6um","search_text":"The os.path module has other interesting functions. The most useful, other than join() , are probably:","text_count":102,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path"}]},{"block_type":"text","content":"module has other interesting functions. The most useful, other than"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"join()"}]},{"block_type":"text","content":", are probably:"}]},{"block_type":"element","block":"k67ev6un","search_text":"os.path.abspath() , which returns the absolute path of a file os.path.split() , which splits the path between directory and file: ","text_count":130,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path.abspath()"}]},{"block_type":"text","content":", which returns the absolute path of a file"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path.split()"}]},{"block_type":"text","content":", which splits the path between directory and file:"}]}]},{"block_type":"element","block":"k67ev6uo","search_text":">>> os.path.split('/a/very/long/path/file.txt') ('/a/very/long/path', 'file.txt')","text_count":81,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; os.path.split('/a/very/long/path/file.txt')\n('/a/very/long/path', 'file.txt')"}]}]},{"block_type":"element","block":"k67ev6up","search_text":"os.path.exists() , to return whether a file exists or not on the filesystem ","text_count":76,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path.exists()"}]},{"block_type":"text","content":", to return whether&nbsp;a file exists or not on the filesystem"}]}]},{"block_type":"element","block":"k67ev6uq","search_text":"The full documentation about os.path can be found here: https://docs.python.org/3/library/os.path.html . Another module, pathlib , can be used for higher-level access, in an object-oriented way: https://docs.python.org/3/library/pathlib.html .","text_count":243,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full documentation about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path"}]},{"block_type":"text","content":"can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/os.path.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/os.path.html"}]},{"block_type":"text","content":". Another module,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pathlib"}]},{"block_type":"text","content":", can be used for&nbsp;higher-level access, in an object-oriented way:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/pathlib.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/pathlib.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6ur","search_text":"As demonstrated in step 4, multiple ways of filtering can be used. All of the string manipulations shown in Chapter 1, Let Us Begin Our Automation Journey can be used.","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As demonstrated in step 4, multiple ways of filtering can be used. All of the string manipulations shown in&nbsp;Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":"can be used."}]},{"block_type":"element","block":"k67ev6us","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6ut","search_text":"The Introducing regular expressions recipe in Chapter 1, Let Us Begin Our Automation Journey The Reading text files recipe ","text_count":123,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"&nbsp;recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey&nbsp;"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6uu","search_text":"Reading text files","text_count":18,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"element","block":"k67ev6uv","search_text":"After searching for a particular file, we'll probably follow up by opening it and reading it. Text files are very simple yet very powerful files. They store data in plain text, without complicated binary formats. ","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After searching for a particular file, we'll probably follow up by opening it and reading it. Text files are very simple yet very powerful files. They store data in plain text, without complicated binary formats.&nbsp;"}]},{"block_type":"element","block":"k67ev6uw","search_text":"Text file support is provided natively in Python, and it's easy to consider it a collection of lines.","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Text file support is provided natively in Python, and it's easy to consider it a collection of lines."}]},{"block_type":"element","block":"k67ev6ux","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6uy","search_text":"We'll read the zen_of_python.txt file, containing the Zen of Python by Tim Peters, which is a collection of aphorisms that very well describe the design principles behind Python. It is available in the GitHub repository here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/zen_of_python.txt :","text_count":339,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll read the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"zen_of_python.txt"}]},{"block_type":"text","content":"&nbsp;file, containing the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Zen of Python"}]},{"block_type":"text","content":"by Tim Peters, which is a collection of aphorisms that very well describe the design principles behind Python. It is available in the GitHub repository here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/zen_of_python.txt"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/zen_of_python.txt"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6uz","search_text":"Beautiful is better than ugly. Explicit is better than implicit. Simple is better than complex. Complex is better than complicated. Flat is better than nested. Sparse is better than dense. Readability counts. Special cases aren't special enough to break the rules. Although practicality beats purity. Errors should never pass silently. Unless explicitly silenced. In the face of ambiguity, refuse the temptation to guess. There should be one-- and preferably only one --obvious way to do it. Although that way may not be obvious at first unless you're Dutch. Now is better than never. Although never is often better than *right* now. If the implementation is hard to explain, it's a bad idea. If the implementation is easy to explain, it may be a good idea. Namespaces are one honking great idea -- let's do more of those!","text_count":822,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Beautiful is better than ugly.\nExplicit is better than implicit.\nSimple is better than complex.\nComplex is better than complicated.\nFlat is better than nested.\nSparse is better than dense.\nReadability counts.\nSpecial cases aren't special enough to break the rules.\nAlthough practicality beats purity.\nErrors should never pass silently.\nUnless explicitly silenced.\nIn the face of ambiguity, refuse the temptation to guess.\nThere should be one-- and preferably only one --obvious way to do it.\nAlthough that way may not be obvious at first unless you're Dutch.\nNow is better than never.\nAlthough never is often better than *right* now.\nIf the implementation is hard to explain, it's a bad idea.\nIf the implementation is easy to explain, it may be a good idea.\nNamespaces are one honking great idea -- let's do more of those!"}]}]},{"block_type":"element","block":"k67ev6v0","search_text":"The Zen of Python is described in PEP-20 here: https://www.python.org/dev/peps/pep-0020/ .","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Zen of Python"}]},{"block_type":"text","content":"is described in PEP-20&nbsp;here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.python.org/dev/peps/pep-0020/"},"children":[{"block_type":"text","content":"https://www.python.org/dev/peps/pep-0020/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6v1","search_text":"Tip The Zen of Python can be displayed in any Python interpreter by calling import this . ","text_count":90,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Zen of Python"}]},{"block_type":"text","content":"can be displayed in any Python interpreter by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"import this"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6v2","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6v3","search_text":"Open and print the whole file, line by line (the result is not displayed): ","text_count":75,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open and print the whole file, line by line (the result is not displayed):"}]}]},{"block_type":"element","block":"k67ev6v4","search_text":">>> with open('zen_of_python.txt') as file: ... for line in file: ... print(line) ... [RESULT NOT DISPLAYED]","text_count":108,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('zen_of_python.txt') as file:\n...     for line in file:\n...         print(line)\n...\n[RESULT NOT DISPLAYED]"}]}]},{"block_type":"element","block":"k67ev6v5","search_text":"Open the file and print any line containing the string should : ","text_count":64,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the file and print any line containing the string"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"should"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6v6","search_text":">>> with open('zen_of_python.txt', 'r') as file: ... for line in file: ... if 'should' in line.lower(): ... print(line) ... Errors should never pass silently. There should be one-- and preferably only one --obvious way to do it.","text_count":228,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('zen_of_python.txt', 'r') as file:\n...     for line in file:\n...         if 'should' in line.lower():\n...             print(line)\n...\nErrors should never pass silently.\nThere should be one-- and preferably only one --obvious way to do it."}]}]},{"block_type":"element","block":"k67ev6v7","search_text":"Open the file and print the first line containing the word better : ","text_count":68,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the file and print the first line containing the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"better"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6v8","search_text":">>> with open('zen_of_python.txt', 'rt') as file: ... for line in file: ... if 'better' in line.lower(): ... print(line) ... break ... Beautiful is better than ugly.","text_count":165,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('zen_of_python.txt', 'rt') as file:\n...     for line in file:\n...         if 'better' in line.lower():\n...             print(line)\n...             break\n...\nBeautiful is better than ugly."}]}]},{"block_type":"element","block":"k67ev6v9","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6va","search_text":"To open a file in text mode, use the open() function. This returns a file object that then can be iterated over to return it line by line, as shown in step 1 of the How to do it… section.","text_count":187,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To open a file in text mode, use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"open()"}]},{"block_type":"text","content":"function. This returns a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file"}]},{"block_type":"text","content":"object that then can be iterated over to return it line by line, as shown in step 1 of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k67ev6vb","search_text":"The with context manager is a very convenient way of dealing with files, as it will close them after finishing its use (leaving the block). It will do so even if there's an exception raised.","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context manager is a very convenient way of dealing with files, as it will close them after finishing its use (leaving the block). It will do so even if there's an exception raised."}]},{"block_type":"element","block":"k67ev6vc","search_text":"Step 2 shows how to iterate and filter the lines based in what lines are applicable for our tasks. The lines are returned as strings that can be filtered in multiple ways, as described before.","text_count":192,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 2 shows how to iterate and filter the lines based in what lines are applicable for our tasks. The lines are returned as strings that can be filtered in multiple ways, as described before."}]},{"block_type":"element","block":"k67ev6vd","search_text":"Reading the whole file may not be required, as shown in step 3. Because iterating through the file line by line will be reading the file as you go, you can stop at any time, avoiding reading the rest of the file. For a small file such as our example, that's not very relevant, but for long files, this can reduce memory use and time.","text_count":333,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Reading the whole file may not be required, as shown in step 3. Because iterating through the file line by line will be reading the file as you go, you can stop at any time, avoiding reading the rest of the file. For a small file such as our example, that's not very relevant, but for long files, this can reduce memory use and time."}]},{"block_type":"element","block":"k67ev6ve","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6vf","search_text":"The with context manager is the preferred way of dealing with files, but it's not the only one. You may also open and close them manually, like this:","text_count":149,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context manager is the preferred way of dealing with files, but it's not the only one. You may also open and close them manually, like this:"}]},{"block_type":"element","block":"k67ev6vg","search_text":">>> file = open('zen_of_python') >>> content = file.read() >>> file.close()","text_count":75,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file = open('zen_of_python')\n&gt;&gt;&gt; content = file.read()\n&gt;&gt;&gt; file.close()"}]}]},{"block_type":"element","block":"k67ev6vh","search_text":"Note the .close() method, to ensure that the file is closed and to free resources related to opening a file. The .read() method reads the whole file in one go, instead of line by line.","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".close()&nbsp;"}]},{"block_type":"text","content":"method, to ensure that the file is closed and to free resources related to opening a file.&nbsp;The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".read()"}]},{"block_type":"text","content":"&nbsp;method reads the whole file in one go, instead of line by line."}]},{"block_type":"element","block":"k67ev6vi","search_text":"Tip The .read() method also accepts a size parameter in bytes that limits the size of the data read. For example, file.read(1024) will return up to 1 KB of information. The next call to .read() will continue from that point. ","text_count":225,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".read()"}]},{"block_type":"text","content":"method also accepts a size parameter in bytes that limits the size of the data read. For example,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file.read(1024)"}]},{"block_type":"text","content":"will return up to 1 KB of information. The next call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".read()"}]},{"block_type":"text","content":"will continue from that point."}]}]},{"block_type":"element","block":"k67ev6vj","search_text":"Files are opened in a particular mode. Modes define a combination of read/write as well as text or binary data. By default, files are opened in read-only and text mode, which are described as 'r' (step 2) or 'rt' (step 3).","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Files are opened in a particular mode. Modes define a combination of read/write as well as text or binary data. By default, files are opened in read-only and text mode, which are described as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'r'"}]},{"block_type":"text","content":"&nbsp;(step 2) or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'rt'"}]},{"block_type":"text","content":"(step 3)."}]},{"block_type":"element","block":"k67ev6vk","search_text":"More modes will be explored in other recipes.","text_count":45,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"More modes will be explored in other recipes."}]},{"block_type":"element","block":"k67ev6vl","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6vm","search_text":"The Crawling and searching directories recipe The Dealing with encodings recipe ","text_count":80,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with encodings"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6vn","search_text":"Dealing with encodings","text_count":22,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Dealing with encodings"}]},{"block_type":"element","block":"k67ev6vo","search_text":"Text files can be present in different encodings. In recent years, the situation has greatly improved, but there are still compatibility problems when working with different systems.","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Text files can be present in different encodings. In recent years, the situation has greatly improved, but there are still compatibility problems when working with different systems."}]},{"block_type":"element","block":"k67ev6vp","search_text":"Tip There's a difference between raw data in a file and a string object in Python. The string object has been transformed from whatever encoding the file contains into a native string. Once it is in this format, it may need to be stored in different encodings. By default, Python works with the defined by the OS, which in modern operating systems is UTF-8. This is a highly compatible encoding, but you may need to save files in a different one. ","text_count":447,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There's a difference between raw data in a file and a string object in Python. The string object has been transformed from whatever encoding the file contains into a native string. Once it is in this format, it may need to be stored in different encodings. By default, Python works with the defined by the OS, which in modern operating systems is&nbsp;UTF-8.&nbsp; This is a highly compatible encoding, but you may need to save files in a different one."}]}]},{"block_type":"element","block":"k67ev6vq","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6vr","search_text":"We prepared two files in the GitHub repository that store the string 20£ in two different encodings. One in usual UTF8 and another in ISO 8859-1, another common encoding. The files are available in GitHub under the Chapter04/documents directory, with the names example_iso.txt and example_utf8.txt : ","text_count":300,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We prepared two files in the GitHub repository that store the string"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"20&pound;"}]},{"block_type":"text","content":"in two different encodings. One in usual UTF8 and another in&nbsp;ISO 8859-1, another common encoding. The files are available in GitHub under the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter04/documents"}]},{"block_type":"text","content":"&nbsp;directory, with the names"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example_iso.txt"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example_utf8.txt"}]},{"block_type":"text","content":":&nbsp;"}]},{"block_type":"element","block":"k67ev6vs","search_text":"https://github.com/PacktPublishing/Python-Automation-Cookbook","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook"}]}]},{"block_type":"element","block":"k67ev6vt","search_text":"We'll use the Beautiful Soup module, presented in the Parsing HTML recipe in Chapter 3, Building Your First Web Scraping Application .","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the Beautiful Soup&nbsp;module, presented in the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 3,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6vu","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6vv","search_text":"Open the example_utf8.txt file and display its content: ","text_count":56,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example_utf8.txt"}]},{"block_type":"text","content":"&nbsp;file&nbsp;and display its content:"}]}]},{"block_type":"element","block":"k67ev6vw","search_text":">>> with open('example_utf8.txt') as file: ... print(file.read()) ... 20£","text_count":73,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('example_utf8.txt') as file:\n...     print(file.read())\n...\n20&pound;"}]}]},{"block_type":"element","block":"k67ev6vx","search_text":"Try to open the example_iso.txt file, which will raise an exception: ","text_count":69,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Try to open the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example_iso.txt"}]},{"block_type":"text","content":"&nbsp;file, which will raise an exception:"}]}]},{"block_type":"element","block":"k67ev6vy","search_text":">>> with open('example_iso.txt') as file: ... print(file.read()) ... Traceback (most recent call last): ... UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa3 in position 2: invalid start byte","text_count":198,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('example_iso.txt') as file:\n... print(file.read())\n...\nTraceback (most recent call last):\n  ...\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0xa3 in position 2: invalid start byte"}]}]},{"block_type":"element","block":"k67ev6vz","search_text":"Open the example_iso.txt file with the proper encoding: ","text_count":56,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example_iso.txt"}]},{"block_type":"text","content":"&nbsp;file&nbsp;with the proper encoding:"}]}]},{"block_type":"element","block":"k67ev6w0","search_text":">>> with open('example_iso.txt', encoding='iso-8859-1') as file: ... print(file.read()) ... 20£","text_count":95,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('example_iso.txt', \n              encoding='iso-8859-1') as file:\n...     print(file.read())\n...\n20&pound;"}]}]},{"block_type":"element","block":"k67ev6w1","search_text":"Open the utf8 file and save its content in an iso-8859-1 file: ","text_count":63,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"utf8"}]},{"block_type":"text","content":"file and save its content in an&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"iso-8859-1"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev6w2","search_text":">>> with open('example_utf8.txt') as file: ... content = file.read() >>> with open('example_output_iso.txt', 'w', encoding='iso-8859-1') as file: ... file.write(content) ... 4","text_count":175,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('example_utf8.txt') as file:\n...     content = file.read()\n&gt;&gt;&gt; with open('example_output_iso.txt', 'w',\n               encoding='iso-8859-1') as file:\n...     file.write(content)\n...\n4"}]}]},{"block_type":"element","block":"k67ev6w3","search_text":"Finally, read from the new file in the proper format to ensure it is correctly saved: ","text_count":86,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, read from the new file in the proper format to ensure it is correctly saved:"}]}]},{"block_type":"element","block":"k67ev6w4","search_text":">>> with open('example_output_iso.txt', encoding='iso-8859-1') as file: ... print(file.read()) ... 20£","text_count":102,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('example_output_iso.txt', \n              encoding='iso-8859-1') as file:\n...     print(file.read())\n...\n20&pound;"}]}]},{"block_type":"element","block":"k67ev6w5","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6w6","search_text":"Steps 1 and 2 in the How to do it… section are very straightforward. In step 3, we add an extra parameter, encoding , to specify that the file needs to be opened in something different to UTF-8.","text_count":194,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 1 and 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section are very straightforward. In step 3, we add an extra parameter,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"encoding"}]},{"block_type":"text","content":", to specify that the file needs to be opened in something different to UTF-8."}]},{"block_type":"element","block":"k67ev6w7","search_text":"Tip Python accepts a lot of standard encodings right out of the box. Check here for all of them and their aliases: https://docs.python.org/3/library/codecs.html#standard-encodings . ","text_count":182,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python accepts a lot of standard encodings right out of the box. Check here for all of them and their aliases:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/codecs.html#standard-encodings"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/codecs.html#standard-encodings"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev6w8","search_text":"In step 4, we create a new file in ISO-8859-1 and write to it as usual. Notice the 'w' parameter, which specifies to open it for writing and in text mode. ","text_count":155,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 4, we create a new file in&nbsp;ISO-8859-1 and write to it as usual. Notice the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'w'"}]},{"block_type":"text","content":"parameter, which specifies to open it for writing and in text mode.&nbsp;"}]},{"block_type":"element","block":"k67ev6w9","search_text":"Step 5 is a confirmation that the file is properly saved.","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 5 is a confirmation that the file is properly saved."}]},{"block_type":"element","block":"k67ev6wa","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6wb","search_text":"This recipe assumes that we know the encoding a file is in. But sometimes we're not sure about that. Beautiful Soup, a module to parse HTML, can try to detect what encoding a particular file has.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe assumes that we know the encoding a file is in. But sometimes we're not sure about that.&nbsp;Beautiful Soup, a module to parse HTML, can try to detect what encoding a particular file has."}]},{"block_type":"element","block":"k67ev6wc","search_text":"Tip Automatically detecting what encoding a file has may be, well, impossible, as there are potentially an infinte number of encodings. But we'll check the usual encodings that should cover 90% of the real world cases. Just remember that the easiest way of knowing for sure is to ask whomever created the file in the first place. ","text_count":330,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Automatically detecting what encoding a file has may be, well, impossible, as there are potentially an infinte number of encodings. But we'll check the usual encodings that should cover 90% of the real world cases. Just remember that the easiest way of knowing for sure is to ask whomever created the file in the first place."}]}]},{"block_type":"element","block":"k67ev6wd","search_text":"To do so, we'll need to open the file to read in binary format with the 'rb' parameter, to then pass the binary content to the UnicodeDammit module of Beautiful Soup, like this:","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To do so, we'll need to open the file to read in binary format with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'rb'"}]},{"block_type":"text","content":"parameter, to then pass the binary content to the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"UnicodeDammit"}]},{"block_type":"text","content":"&nbsp;module&nbsp;of Beautiful Soup, like this:"}]},{"block_type":"element","block":"k67ev6we","search_text":">>> from bs4 import UnicodeDammit >>> with open('example_output_iso.txt', 'rb') as file: ... content = file.read() ... >>> suggestion = UnicodeDammit(content) >>> suggestion.original_encoding 'iso-8859-1' >>> suggestion.unicode_markup '20£\\n'","text_count":242,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from bs4 import UnicodeDammit\n&gt;&gt;&gt; with open('example_output_iso.txt', 'rb') as file:\n...     content = file.read()\n...\n&gt;&gt;&gt; suggestion = UnicodeDammit(content)\n&gt;&gt;&gt; suggestion.original_encoding\n'iso-8859-1'\n&gt;&gt;&gt; suggestion.unicode_markup\n'20&pound;\\n'"}]}]},{"block_type":"element","block":"k67ev6wf","search_text":"The encoding can then be inferred. Though .unicode_markup returns the decoded string, it's better to use this suggestion only once, to then open the file in our automated task with the proper encoding.","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The encoding can then be inferred. Though"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".unicode_markup"}]},{"block_type":"text","content":"returns the decoded string, it's better to use this suggestion only once, to then open the file in our automated task with the proper encoding."}]},{"block_type":"element","block":"k67ev6wg","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6wh","search_text":"The Manipulating strings recipe in Chapter 1, Let Us Begin Our Automation Journey The Parsing HTML recipe in Chapter 3, Building Your First Web Scraping Application ","text_count":165,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Manipulating strings"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"recipe in Chapter 3,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application"}]}]}]},{"block_type":"element","block":"k67ev6wi","search_text":"Reading CSV files","text_count":17,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading CSV files"}]},{"block_type":"element","block":"k67ev6wj","search_text":"Some text files contain tabular data separated by commas. This is a convenient way of creating structured data, instead of using proprietary, more complex formats such as Excel or others. These files are called Comma Separated Values , or CSV , files and most spreadsheet packages also export to it.","text_count":299,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some text files contain tabular data separated by commas. This is a convenient way of creating structured data, instead of using proprietary, more complex formats such as Excel or others. These files are called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Comma Separated Values"}]},{"block_type":"text","content":", or"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"CSV"}]},{"block_type":"text","content":", files and most spreadsheet packages also export to it."}]},{"block_type":"element","block":"k67ev6wk","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6wl","search_text":"We've prepared a CSV file using the data for the 10 top movies by theatre attendance, as described by this page: http://www.mrob.com/pub/film-video/topadj.html .","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We've prepared a CSV file using the data for the 10 top movies by theatre attendance, as described by this page:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.mrob.com/pub/film-video/topadj.html"},"children":[{"block_type":"text","content":"http://www.mrob.com/pub/film-video/topadj.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6wm","search_text":"We copied the first ten elements of the table into a spreadsheet program (Numbers) and exported the file as a CSV. The file is available in the GitHub repository in the Chapter04/documents directory as top_films.csv :","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We copied the first ten elements of the table into a spreadsheet program (Numbers) and exported the file as a CSV. The file is available in the GitHub repository in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter04/documents"}]},{"block_type":"text","content":"&nbsp;directory as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"top_films.csv"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6wn","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000038.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev6wo","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6wp","search_text":"Import the csv module: ","text_count":23,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev6wq","search_text":">>> import csv","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import csv"}]}]},{"block_type":"element","block":"k67ev6wr","search_text":"Open the file, create a reader, and iterate through it to show the tabular data of all rows (only three rows are shown): ","text_count":121,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the file, create a reader, and iterate through it to show the tabular data of all rows (only three rows are shown):"}]}]},{"block_type":"element","block":"k67ev6ws","search_text":">>> with open('top_films.csv') as file: ... data = csv.reader(file) ... for row in data: ... print(row) ... ['Rank', 'Admissions\\n(millions)', 'Title (year) (studio)', 'Director(s)'] ['1', '225.7', 'Gone With the Wind (1939)\\xa0(MGM)', 'Victor Fleming, George Cukor, Sam Wood'] ['2', '194.4', 'Star Wars (Ep. IV: A New Hope) (1977)\\xa0(Fox)', 'George Lucas'] ... ['10', '118.9', 'The Lion King (1994)\\xa0(BV)', 'Roger Allers, Rob Minkoff']","text_count":439,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('top_films.csv') as file:\n...   data = csv.reader(file)\n...   for row in data:\n...       print(row)\n...\n['Rank', 'Admissions\\n(millions)', 'Title (year) (studio)', 'Director(s)']\n['1', '225.7', 'Gone With the Wind (1939)\\xa0(MGM)', 'Victor Fleming, George Cukor, Sam Wood']\n['2', '194.4', 'Star Wars (Ep. IV: A New Hope) (1977)\\xa0(Fox)', 'George Lucas']\n...\n['10', '118.9', 'The Lion King (1994)\\xa0(BV)', 'Roger Allers, Rob Minkoff']"}]}]},{"block_type":"element","block":"k67ev6wt","search_text":"Open the file and use DictReader to structure the data, including the header: ","text_count":78,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the file and use&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictReader"}]},{"block_type":"text","content":"to structure the data, including the header:"}]}]},{"block_type":"element","block":"k67ev6wu","search_text":">>> with open('top_films.csv') as file: ... data = csv.DictReader(file) ... structured_data = [row for row in data] ... >>> structured_data[0] OrderedDict([('Rank', '1'), ('Admissions\\n(millions)', '225.7'), ('Title (year) (studio)', 'Gone With the Wind (1939)\\xa0(MGM)'), ('Director(s)', 'Victor Fleming, George Cukor, Sam Wood')])","text_count":332,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('top_films.csv') as file:\n...     data = csv.DictReader(file)\n...     structured_data = [row for row in data]\n...\n&gt;&gt;&gt; structured_data[0]\nOrderedDict([('Rank', '1'), ('Admissions\\n(millions)', '225.7'), ('Title (year) (studio)', 'Gone With the Wind (1939)\\xa0(MGM)'), ('Director(s)', 'Victor Fleming, George Cukor, Sam Wood')])"}]}]},{"block_type":"element","block":"k67ev6wv","search_text":"Each of the items in structured_data is a full dictionary that contains each of the values: ","text_count":92,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"&nbsp;Each of the items in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"structured_data"}]},{"block_type":"text","content":"is a full dictionary that contains each of the values:"}]}]},{"block_type":"element","block":"k67ev6ww","search_text":">>> structured_data[0].keys() odict_keys(['Rank', 'Admissions\\n(millions)', 'Title (year) (studio)', 'Director(s)']) >>> structured_data[0]['Rank'] '1' >>> structured_data[0]['Director(s)'] 'Victor Fleming, George Cukor, Sam Wood'","text_count":230,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; structured_data[0].keys()\nodict_keys(['Rank', 'Admissions\\n(millions)', 'Title (year) (studio)', 'Director(s)'])\n&gt;&gt;&gt; structured_data[0]['Rank']\n'1'\n&gt;&gt;&gt; structured_data[0]['Director(s)']\n'Victor Fleming, George Cukor, Sam Wood'"}]}]},{"block_type":"element","block":"k67ev6wx","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6wy","search_text":"Notice that the file needs to be read, and we use a with context manager. This ensures that the file is closed at the end of the block.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the file needs to be read, and we use a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context manager. This ensures&nbsp;that the file is closed at the end of the block."}]},{"block_type":"element","block":"k67ev6wz","search_text":"As shown in step 2 from the How to do it… section, the csv.reader class allows us to structure the returning lines of code by subdividing them as lists, following the format of the table data. Notice how all the values are described as strings. csv.reader does not understand whether the first line is a header or not.","text_count":318,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As shown in step 2 from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv.reader"}]},{"block_type":"text","content":"class allows us to structure the returning lines of code by subdividing them as lists, following the format of the table data. Notice how all the values are described as strings."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv.reader"}]},{"block_type":"text","content":"does not understand whether the first line is a header or not."}]},{"block_type":"element","block":"k67ev6x0","search_text":"For a more structured read of the file, in step 3 we use csv.DictReader , which by default reads the first row as a header defining the fields described later, and then converts each of the rows into dictionaries with those fields.","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For a more structured read of the file, in step 3 we use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv.DictReader"}]},{"block_type":"text","content":", which by default reads the first row as a header defining the fields described later, and then converts each of the rows into dictionaries with those fields."}]},{"block_type":"element","block":"k67ev6x1","search_text":"Tip Sometimes, like in this case, the names of the fields as described in the file can be a little verbose. Don't be afraid to translate the dictionary on an extra step into more manageable field names. ","text_count":203,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sometimes, like in this case, the names of the fields as described in the file can be a little verbose. Don't be afraid to translate the dictionary on an extra step into more manageable field names."}]}]},{"block_type":"element","block":"k67ev6x2","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6x3","search_text":"As CSV is a very loosely defined interpretation, there are several ways that the data can be stored. This is represented in the csv module as dialects . For example, the values can be delimited by commas, semicolons, or tabs. The list of default accepted dialects can be displayed by calling csv.list_dialect .","text_count":310,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As CSV is a very loosely defined interpretation, there are several ways that the data can be stored. This is represented in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"dialects"}]},{"block_type":"text","content":". For example, the values can be delimited by commas, semicolons, or tabs. The list of default accepted dialects can be displayed by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv.list_dialect"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6x4","search_text":"Tip By default, the dialect will be Excel, which is the most common one. Even other spreadsheets will commonly use it. ","text_count":119,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By default, the dialect will be Excel, which is the most common one. Even other spreadsheets will commonly use it."}]}]},{"block_type":"element","block":"k67ev6x5","search_text":"But dialects can also be inferred from the file itself through the Sniffer class. The Sniffer class analyzes a sample of the file (or the whole file) and returns a dialect object to allow reading in the proper way.","text_count":214,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But dialects can also be inferred from the file itself through the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sniffer"}]},{"block_type":"text","content":"class. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sniffer"}]},{"block_type":"text","content":"class analyzes a sample of the file (or the whole file) and returns a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dialect"}]},{"block_type":"text","content":"object to allow reading in the proper way."}]},{"block_type":"element","block":"k67ev6x6","search_text":"Notice that the file is open with no new lines, to not make any assumptions about it:","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the file is open with no new lines, to not make any assumptions about it:"}]},{"block_type":"element","block":"k67ev6x7","search_text":">>> with open('top_films.csv', newline='') as file: ... dialect = csv.Sniffer().sniff(file.read())","text_count":98,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('top_films.csv', newline='') as file:\n...    dialect = csv.Sniffer().sniff(file.read())"}]}]},{"block_type":"element","block":"k67ev6x8","search_text":"The dialect can then be used when opening the reader. Note the newline again, as the dialect will split the lines correctly:","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The dialect can then be used when opening the reader. Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"newline"}]},{"block_type":"text","content":"again, as the dialect will split the lines correctly:"}]},{"block_type":"element","block":"k67ev6x9","search_text":">>> with open('top_films.csv', newline='') as file: ... reader = csv.reader(file, dialect) ... for row in reader: ... print(row)","text_count":128,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('top_films.csv', newline='') as file:\n...     reader = csv.reader(file, dialect)\n...     for row in reader:\n...         print(row)"}]}]},{"block_type":"element","block":"k67ev6xa","search_text":"The full csv module documentation can be found here: https://docs.python.org/3.6/library/csv.html .","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.6/library/csv.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3.6/library/csv.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6xb","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6xc","search_text":"The Dealing with encodings recipe The Reading text files recipe ","text_count":64,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with encodings"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6xd","search_text":"Reading log files","text_count":17,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading log files"}]},{"block_type":"element","block":"k67ev6xe","search_text":"Another common structured text file format is log files . Log files consist of rows of logs, which are a line of text with a particular format. Typically, each one will have a time when it happened, so the file is an ordered collection of events.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another common structured text file format is"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"log files"}]},{"block_type":"text","content":". Log files consist of rows of logs, which are a line of text with a particular format. Typically, each one will have a time when it happened, so the file is an ordered collection of events."}]},{"block_type":"element","block":"k67ev6xf","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6xg","search_text":"The example_log.log file with five sales logs can be obtained from the GitHub repository here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/example_logs.log .","text_count":207,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"example_log.log"}]},{"block_type":"text","content":"&nbsp;file&nbsp;with five sales logs can be obtained from the GitHub repository here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/example_logs.log"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/example_logs.log"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6xh","search_text":"The format is the following:","text_count":28,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The format is the following:"}]},{"block_type":"element","block":"k67ev6xi","search_text":"[<Timestamp in iso format>] - SALE - PRODUCT: <product id> - PRICE: $<price of the sale>","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[&lt;Timestamp in iso format&gt;] - SALE - PRODUCT: &lt;product id&gt; - PRICE: $&lt;price of the sale&gt;"}]}]},{"block_type":"element","block":"k67ev6xj","search_text":"We'll use the Chapter01/price_log.py file to process each log into an object.","text_count":77,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter01/price_log.py"}]},{"block_type":"text","content":"&nbsp;file&nbsp;to process each log into an object."}]},{"block_type":"element","block":"k67ev6xk","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6xl","search_text":"Import PriceLog : ","text_count":18,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PriceLog"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6xm","search_text":">>> from price_log import PriceLog","text_count":34,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from price_log import PriceLog"}]}]},{"block_type":"element","block":"k67ev6xn","search_text":"Open the log file and parse all logs: ","text_count":38,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the log file and parse all logs:"}]}]},{"block_type":"element","block":"k67ev6xo","search_text":">>> with open('example_logs.log') as file: ... logs = [PriceLog.parse(log) for log in file] ... >>> len(logs) 5 >>> logs[0] <PriceLog (Delorean(datetime=datetime.datetime(2018, 6, 17, 22, 11, 50, 268396), timezone='UTC'), 1489, 9.99)>","text_count":234,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('example_logs.log') as file:\n...     logs = [PriceLog.parse(log) for log in file]\n...\n&gt;&gt;&gt; len(logs)\n5\n&gt;&gt;&gt; logs[0]\n&lt;PriceLog (Delorean(datetime=datetime.datetime(2018, 6, 17, 22, 11, 50, 268396), timezone='UTC'), 1489, 9.99)&gt;"}]}]},{"block_type":"element","block":"k67ev6xp","search_text":"Determine the total income by all sales: ","text_count":41,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Determine the total income by all sales:"}]}]},{"block_type":"element","block":"k67ev6xq","search_text":">>> total = sum(log.price for log in logs) >>> total Decimal('47.82')","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; total = sum(log.price for log in logs)\n&gt;&gt;&gt; total\nDecimal('47.82')"}]}]},{"block_type":"element","block":"k67ev6xr","search_text":"Determine how many units have been sold of each product_id : ","text_count":61,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Determine how many units have been sold of each"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"product_id"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6xs","search_text":">>> from collections import Counter >>> counter = Counter(log.product_id for log in logs) >>> counter Counter({1489: 2, 4508: 1, 8597: 1, 3086: 1})","text_count":147,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from collections import Counter\n&gt;&gt;&gt; counter = Counter(log.product_id for log in logs)\n&gt;&gt;&gt; counter\nCounter({1489: 2, 4508: 1, 8597: 1, 3086: 1})"}]}]},{"block_type":"element","block":"k67ev6xt","search_text":"Filter the logs to find all occurrences of selling product ID 1489 : ","text_count":69,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Filter the logs to find all occurrences of selling product ID"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1489"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6xu","search_text":">>> logs = [] >>> with open('example_logs.log') as file: ... for log in file: ... plog = PriceLog.parse(log) ... if plog.product_id == 1489: ... logs.append(plog) ... >> len(logs) 2 >>> logs[0].product_id, logs[0].timestamp (1489, Delorean(datetime=datetime.datetime(2018, 6, 17, 22, 11, 50, 268396), timezone='UTC')) >>> logs[1].product_id, logs[1].timestamp (1489, Delorean(datetime=datetime.datetime(2018, 6, 17, 22, 11, 50, 268468), timezone='UTC'))","text_count":453,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; logs = []\n&gt;&gt;&gt; with open('example_logs.log') as file:\n...     for log in file:\n...         plog = PriceLog.parse(log)\n...         if plog.product_id == 1489:\n...             logs.append(plog)\n...\n&gt;&gt; len(logs)\n2\n&gt;&gt;&gt; logs[0].product_id, logs[0].timestamp\n(1489, Delorean(datetime=datetime.datetime(2018, 6, 17, 22, 11, 50, 268396), timezone='UTC'))\n&gt;&gt;&gt; logs[1].product_id, logs[1].timestamp\n(1489, Delorean(datetime=datetime.datetime(2018, 6, 17, 22, 11, 50, 268468), timezone='UTC'))"}]}]},{"block_type":"element","block":"k67ev6xv","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6xw","search_text":"As each of the logs is a single line, we open the file and go one by one, parsing each of them. The parsing code is available on price_log.py . Check it for more details.","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As each of the logs is a single line, we open the file and go one by one, parsing each of them. The parsing code is available&nbsp;on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"price_log.py"}]},{"block_type":"text","content":". Check it for more details."}]},{"block_type":"element","block":"k67ev6xx","search_text":"In Step 2 in the How to do it… section, we open the file and process each of the lines to create a log list with all our processed logs. Then, we can produce aggregation operations, as in the next steps.","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Step 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, we open the file and process each of the lines to create a log list with all our processed logs. Then, we can produce aggregation operations, as in the next steps."}]},{"block_type":"element","block":"k67ev6xy","search_text":"Step 3 shows how to aggregate all values, in this case summing the price of all items sold over the log file, to get the total revenue.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 shows how to aggregate all values, in this case summing the price of all items sold over the log file, to get the total revenue."}]},{"block_type":"element","block":"k67ev6xz","search_text":"Step 4 uses the Counter to determine the amount of each item in the file log. This returns a dictionary-like object with the values to count and the number of times they appear.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 uses the Counter to determine the amount of each item in the file log. This returns a dictionary-like object with the values to count and the number of times they appear."}]},{"block_type":"element","block":"k67ev6y0","search_text":"Filtering can also be done in a line-by-line approach, as shown in step 5. This is similar to the other filtering in the recipes of this chapter.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Filtering can also be done in a line-by-line approach, as shown in step 5. This is similar to the other filtering in the recipes of this chapter."}]},{"block_type":"element","block":"k67ev6y1","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6y2","search_text":"Remember that you can stop processing a file as soon as you have all the data you need. This may be a good strategy if the file is very big, as is usually the case with log files.","text_count":179,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember that you can stop processing a file as soon as you have all the data you need. This may be a good strategy if the file is very big, as is usually the case with log files."}]},{"block_type":"element","block":"k67ev6y3","search_text":"Counter is a great tool to quickly count a list. See the Python documentation here for more details: https://docs.python.org/2/library/collections.html#counter-objects . You can get the ordered items by calling the following:","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Counter is a great tool to quickly count a list. See the Python documentation here for more details:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/2/library/collections.html#counter-objects"},"children":[{"block_type":"text","content":"https://docs.python.org/2/library/collections.html#counter-objects"}]},{"block_type":"text","content":". You can get the ordered items by calling the following:"}]},{"block_type":"element","block":"k67ev6y4","search_text":">>> counter.most_common() [(1489, 2), (4508, 1), (8597, 1), (3086, 1)]","text_count":70,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; counter.most_common()\n[(1489, 2), (4508, 1), (8597, 1), (3086, 1)]"}]}]},{"block_type":"element","block":"k67ev6y5","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6y6","search_text":"The Using a third party tool—parse recipe in Chapter 1, Let Us Begin Our Automation Journey The Reading text files recipe ","text_count":122,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third party tool&mdash;parse"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6y7","search_text":"Reading file metadata","text_count":21,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading file metadata"}]},{"block_type":"element","block":"k67ev6y8","search_text":"File metadata is everything associated with a particular file that is not the data itself. That means parameters such as the size of the file, the creation date, or its permissions.","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"File metadata is everything associated with a particular file that is not the data itself. That means parameters such as the size of the file, the creation date, or its permissions."}]},{"block_type":"element","block":"k67ev6y9","search_text":"Browsing through that data is important, for example, to filter files older than a date, or find all files bigger than a value in KBs. In this recipe, we'll see how to access the file metadata in Python.","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Browsing through that data is important, for example, to filter files older than a date, or find all files bigger than a value in KBs. In this recipe, we'll see how to access the file metadata in Python."}]},{"block_type":"element","block":"k67ev6ya","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6yb","search_text":"We'll use the zen_of_python.txt file, available in the GitHub repository ( https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/zen_of_python.txt ). As you can see by using the ls command, the file has 856 bytes, and, in this example, it was created on June 14:","text_count":302,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"zen_of_python.txt"}]},{"block_type":"text","content":"&nbsp;file, available in the GitHub repository ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/zen_of_python.txt"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/documents/zen_of_python.txt"}]},{"block_type":"text","content":"). As you can see by using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ls"}]},{"block_type":"text","content":"command, the file has"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"856"}]},{"block_type":"text","content":"bytes, and, in this example, it was created on June 14:"}]},{"block_type":"element","block":"k67ev6yc","search_text":"$ ls -lrt zen_of_python.txt -rw-r--r--@ 1 jaime staff 856 14 Jun 21:22 zen_of_python.txt","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ ls -lrt zen_of_python.txt\n-rw-r--r--@ 1 jaime staff 856 14 Jun 21:22 zen_of_python.txt"}]}]},{"block_type":"element","block":"k67ev6yd","search_text":"On your computer the dates may vary, based on when you downloaded the code.","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"On your computer the dates may vary, based on when you downloaded the code."}]},{"block_type":"element","block":"k67ev6ye","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6yf","search_text":"Import os and datetime : ","text_count":25,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os"}]},{"block_type":"text","content":"&nbsp;and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev6yg","search_text":">>> import os >>> from datetime import datetime","text_count":47,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import os\n&gt;&gt;&gt; from datetime import datetime"}]}]},{"block_type":"element","block":"k67ev6yh","search_text":"Retrieve the stats of the zen_of_python.txt file: ","text_count":50,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieve the stats of the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"zen_of_python.txt"}]},{"block_type":"text","content":"&nbsp;file:"}]}]},{"block_type":"element","block":"k67ev6yi","search_text":">>> stats = os.stat(('zen_of_python.txt') >>> stats os.stat_result(st_mode=33188, st_ino=15822537, st_dev=16777224, st_nlink=1, st_uid=501, st_gid=20, st_size=856, st_atime=1529461935, st_mtime=1529007749, st_ctime=1529007757)","text_count":226,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; stats = os.stat(('zen_of_python.txt')\n&gt;&gt;&gt; stats\nos.stat_result(st_mode=33188, st_ino=15822537, st_dev=16777224, st_nlink=1, st_uid=501, st_gid=20, st_size=856, st_atime=1529461935, st_mtime=1529007749, st_ctime=1529007757)"}]}]},{"block_type":"element","block":"k67ev6yj","search_text":"Get the size of the file, in bytes: ","text_count":36,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the size of the file, in bytes:"}]}]},{"block_type":"element","block":"k67ev6yk","search_text":">>> stats.st_size 856","text_count":21,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; stats.st_size\n856"}]}]},{"block_type":"element","block":"k67ev6yl","search_text":"Obtain when the file was last modified: ","text_count":40,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain when the file was last modified:"}]}]},{"block_type":"element","block":"k67ev6ym","search_text":">>> datetime.fromtimestamp(stats.st_mtime) datetime.datetime(2018, 6, 14, 21, 22, 29)","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; datetime.fromtimestamp(stats.st_mtime)\ndatetime.datetime(2018, 6, 14, 21, 22, 29)"}]}]},{"block_type":"element","block":"k67ev6yn","search_text":"Obtain when the file was last accessed: ","text_count":40,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain when the file was last accessed:"}]}]},{"block_type":"element","block":"k67ev6yo","search_text":">>> datetime.fromtimestamp(stats.st_atime) datetime.datetime(2018, 6, 20, 3, 32, 15)","text_count":84,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; datetime.fromtimestamp(stats.st_atime)\ndatetime.datetime(2018, 6, 20, 3, 32, 15)"}]}]},{"block_type":"element","block":"k67ev6yp","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev6yq","search_text":"os.stats returns a stats object that represents the metadata stored in the filesystem. The metadata includes:","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.stats"}]},{"block_type":"text","content":"&nbsp;returns a stats object that represents the metadata stored in the filesystem. The metadata includes:"}]},{"block_type":"element","block":"k67ev6yr","search_text":"The size of the file, in bytes, as shown in step 3 in the How to do it… section, using st_size When the file content was last modified, as shown in step 4, using st_mtime When the file was last read (accessed), as shown in step 5, using st_atime ","text_count":246,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The size of the file, in bytes, as shown in step 3 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"st_size"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When the file content was last modified, as shown in step 4, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"st_mtime"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When the file was last read (accessed), as shown in step 5, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"st_atime"}]}]}]},{"block_type":"element","block":"k67ev6ys","search_text":"The times are returned as timestamps, so in steps 4 and 5 we create a datetime object from the timestamps to better access the data.","text_count":132,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The times are returned as timestamps, so in steps 4 and 5 we create a&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":"&nbsp;object from the timestamps to better access the data."}]},{"block_type":"element","block":"k67ev6yt","search_text":"All these values can be used to filter the files.","text_count":49,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All these values can be used to filter the files."}]},{"block_type":"element","block":"k67ev6yu","search_text":"Tip Notice you don't need to open the file with open() to read its metadata. Detecting whether a file has been changed after a known value will be quicker than comparing its content, so you can take advantage of that for comparison. ","text_count":233,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice you don't need to open the file with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"open()"}]},{"block_type":"text","content":"&nbsp;to read its metadata. Detecting whether a file has been changed after a known value will be quicker than comparing its content, so you can take advantage of that for comparison."}]}]},{"block_type":"element","block":"k67ev6yv","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev6yw","search_text":"To obtain the stats one by one, there are also convenience functions available in os.path , which follow the pattern get<value> :","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To obtain the stats one by one, there are also convenience&nbsp;functions available in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path"}]},{"block_type":"text","content":", which follow the pattern"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get&lt;value&gt;"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev6yx","search_text":">>> os.path.getsize('zen_of_python.txt') 856 >>> os.path.getmtime('zen_of_python.txt') 1529531584.0 >>> os.path.getatime('zen_of_python.txt') 1529531669.0","text_count":154,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; os.path.getsize('zen_of_python.txt')\n856\n&gt;&gt;&gt; os.path.getmtime('zen_of_python.txt')\n1529531584.0\n&gt;&gt;&gt; os.path.getatime('zen_of_python.txt')\n1529531669.0"}]}]},{"block_type":"element","block":"k67ev6yy","search_text":"The value is specified in the UNIX timestamp format (seconds since January 1, 1970).","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The value is specified in the UNIX timestamp format (seconds since&nbsp; January&nbsp;1,&nbsp;1970)."}]},{"block_type":"element","block":"k67ev6yz","search_text":"Tip Notice calling these three functions will be slower than calling os.stats and processing the results. Also, returned stats can be inspected to detect the available values. ","text_count":176,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice calling these three functions will be slower than calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.stats"}]},{"block_type":"text","content":"&nbsp;and processing the results. Also, returned"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"stats"}]},{"block_type":"text","content":"can be inspected to detect the available values."}]}]},{"block_type":"element","block":"k67ev6z0","search_text":"The values described in the recipe are available for all filesystems, but there are more that can be used.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The values described in the recipe are available for all filesystems, but there are more that can be used."}]},{"block_type":"element","block":"k67ev6z1","search_text":"For example, to obtain the creation date of a file, you can use the st_birthtime parameter for MacOS or st_mtime in Windows.","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, to obtain the creation date of a file, you can use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"st_birthtime"}]},{"block_type":"text","content":"parameter for MacOS or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"st_mtime"}]},{"block_type":"text","content":"in Windows."}]},{"block_type":"element","block":"k67ev6z2","search_text":"Tip st_mtime is always available, but its meaning changes between systems. In Unix systems, it will change when the content is modified, so it's not a reliable time of creation. ","text_count":178,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"st_mtime"}]},{"block_type":"text","content":"&nbsp;is always available, but its meaning changes between systems. In Unix systems, it will change when the content is modified, so it's not a reliable time of creation."}]}]},{"block_type":"element","block":"k67ev6z3","search_text":"os.stat will follow symbolic links. If you want to get the stats of a symbolic link, use os.lstat() .","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.stat"}]},{"block_type":"text","content":"&nbsp;will follow symbolic links. If you want to get the stats of a symbolic link, use&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.lstat()"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6z4","search_text":"Check the full documentation about all available stats here: https://docs.python.org/3.6/library/os.html#os.stat_result .","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the full documentation about all available stats here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.6/library/os.html#os.stat_result"},"children":[{"block_type":"text","content":"https://docs.python.org/3.6/library/os.html#os.stat_result"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev6z5","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev6z6","search_text":"The Reading text files recipe The Reading images recipe ","text_count":56,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading images"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev6z7","search_text":"Reading images","text_count":14,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading images"}]},{"block_type":"element","block":"k67ev6z8","search_text":"Probably the most common data that is not text is image data. Images had their own set of specific metadata that can be read to filter values or perform other operations.","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Probably the most common data that is not text is image data. Images had their own set of specific metadata that can be read to filter values or perform other operations."}]},{"block_type":"element","block":"k67ev6z9","search_text":"A main challenge is dealing with multiple formats and different metadata definitions. We'll show in this recipe how to get information from both a JPEG and PNG, and how the same information can be encoded differently.","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A main challenge is dealing with multiple formats and different metadata definitions. We'll show in this recipe how to get information from both a JPEG and PNG, and how the same information can be encoded differently."}]},{"block_type":"element","block":"k67ev6za","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev6zb","search_text":"The best general toolkit for dealing with images in Python is, arguably, Pillow. This module allows you to easily read files in the most common formats, as well as perform operations on them. Pillow started as a fork of PIL ( Python Imaging Library ), a previous module that became stagnant some years ago.","text_count":306,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The best general toolkit for dealing with images in Python is, arguably, Pillow. This module allows you to easily read files in the most common formats, as well as perform operations on them. Pillow started as a fork of"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"PIL"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Python Imaging Library"}]},{"block_type":"text","content":"), a previous module that became stagnant some years ago."}]},{"block_type":"element","block":"k67ev6zc","search_text":"We will also use the xmltodict module to transform some data in XML to a more convenient dictionary. Add both modules to requirements.txt and reinstall into the virtual environment:","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will also use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xmltodict"}]},{"block_type":"text","content":"module to transform some data in XML to a more convenient dictionary. Add both modules to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"and reinstall into the virtual environment:"}]},{"block_type":"element","block":"k67ev6zd","search_text":"$ echo \"Pillow==5.1.0\" >> requirements.txt $ echo \"xmltodict==0.11.0\" >> requirements.txt $ pip install -r requirements.txt","text_count":123,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"Pillow==5.1.0\" &gt;&gt; requirements.txt\n$ echo \"xmltodict==0.11.0\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev6ze","search_text":"The metadata information in photo files is defined in the EXIF ( Exchangeable Image File ) format. EXIF is a standard to store information about pictures, including things like what camera took the picture, when it was taken, GPS on where, exposure, focal length, color info, and so on.","text_count":286,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The metadata information in photo files is defined in the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"EXIF"}]},{"block_type":"text","content":"&nbsp;("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Exchangeable Image File"}]},{"block_type":"text","content":")&nbsp;format.&nbsp;EXIF&nbsp;is a standard to store information about pictures, including things like what camera took the picture, when it was taken, GPS on where, exposure, focal length, color info, and so on."}]},{"block_type":"element","block":"k67ev6zf","search_text":"Tip You can get a good summary here: https://www.slrphotographyguide.com/what-is-exif-metadata/ . All the information is optional, but virtually all digital cameras and processing software will store some data. Because of the privacy concerns, parts of it, like the exact location, can be disabled. ","text_count":299,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can get a good summary here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.slrphotographyguide.com/what-is-exif-metadata/"},"children":[{"block_type":"text","content":"https://www.slrphotographyguide.com/what-is-exif-metadata/"}]},{"block_type":"text","content":". All the information is optional, but virtually all digital cameras and processing software will store some data. Because of the privacy concerns, parts of it, like the exact location, can be disabled."}]}]},{"block_type":"element","block":"k67ev6zg","search_text":"The following images will be used for this recipe, and are available to download in the GiHub repository ( https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter04/images ):","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following images will be used for this recipe, and are available to download in the GiHub repository ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter04/images"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter04/images"}]},{"block_type":"text","content":"):"}]},{"block_type":"element","block":"k67ev6zh","search_text":"photo-dublin-a1.jpg photo-dublin-a2.png photo-dublin-b.png ","text_count":59,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-a1.jpg"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-a2.png"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-b.png"}]}]}]},{"block_type":"element","block":"k67ev6zi","search_text":"Two of them, photo-dublin-a1.jpg and photo-dublin-a2.png , are the same photo, but while the first is the raw picture the second one has been retouched to slightly change the colors and crop it. Notice one is in JPEG format and the other in PNG. The other one, photo-dublin-b.png , is a different picture. Both pictures were taken in Dublin, with the same phone camera, on two different days.","text_count":392,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Two of them,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-a1.jpg"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-a2.png"}]},{"block_type":"text","content":", are the same photo, but while the first is the raw picture the second one has been retouched to slightly change the colors and crop it. Notice one is in JPEG format and the other in PNG. The other one,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-b.png&nbsp;"}]},{"block_type":"text","content":", is a different picture. Both pictures were taken in Dublin, with the same phone camera, on two different days."}]},{"block_type":"element","block":"k67ev6zj","search_text":"While Pillow understands how JPG files store the EXIF info directly, PNG files store XMP info, a more generic standard that can contain EXIF info. ","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While Pillow understands how JPG files store the EXIF info&nbsp;directly, PNG files store XMP info, a more generic standard that can contain EXIF info.&nbsp;"}]},{"block_type":"element","block":"k67ev6zk","search_text":"Note More info about XMP can be obtained here: https://www.adobe.com/devnet/xmp.html . For the most part, it defines an XML tree structure that's relatively readable in raw. ","text_count":174,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"More info about XMP can be obtained here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.adobe.com/devnet/xmp.html"},"children":[{"block_type":"text","content":"https://www.adobe.com/devnet/xmp.html"}]},{"block_type":"text","content":". For the most part, it defines an XML tree structure that's relatively readable in raw."}]}]},{"block_type":"element","block":"k67ev6zl","search_text":"To further complicate it, XMP is a subset of RDF, which is a standard describing the way of encoding the information.","text_count":117,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To further complicate it, XMP is a subset of RDF, which is a&nbsp;standard describing the way of encoding the information."}]},{"block_type":"element","block":"k67ev6zm","search_text":"Tip If EFIX, XMP, and RDF sounds confusing, well, it's because they are. Ultimately, they are just names to store the values we are interested in. We can inspect the specifics of the names using Python introspection tools and check exactly how the data is structured and what the name of the parameter we are looking for is. ","text_count":325,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If EFIX, XMP, and RDF sounds confusing, well, it's because they are. Ultimately, they are just names to store the values we are interested in. We can inspect the specifics of the names using Python introspection tools and check exactly how the data is structured and what the name of the parameter we are looking for is."}]}]},{"block_type":"element","block":"k67ev6zn","search_text":"As the GPS information is stored in different formats, we've included in the GitHub repository a file called gps_conversion.py , here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/gps_conversion.py . This includes the functions exif_to_decimal and rdf_to_decimal , which will transform both formats into decimals to compare them.","text_count":368,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As the GPS information is stored in different formats, we've included in the GitHub repository a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"gps_conversion.py"}]},{"block_type":"text","content":", here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/gps_conversion.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/gps_conversion.py"}]},{"block_type":"text","content":".&nbsp;This includes the functions"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"exif_to_decimal"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"rdf_to_decimal"}]},{"block_type":"text","content":", which will transform both formats into decimals to compare them."}]},{"block_type":"element","block":"k67ev6zo","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev6zp","search_text":"Import the modules and functions to use in this recipe: ","text_count":56,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the modules and functions to use in this recipe:"}]}]},{"block_type":"element","block":"k67ev6zq","search_text":">>> from PIL import Image >>> from PIL.ExifTags import TAGS, GPSTAGS >>> import xmltodict >>> from gps_conversion import exif_to_decimal, rdf_to_decimal","text_count":152,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from PIL import Image\n&gt;&gt;&gt; from PIL.ExifTags import TAGS, GPSTAGS\n&gt;&gt;&gt; import xmltodict\n&gt;&gt;&gt; from gps_conversion import exif_to_decimal, rdf_to_decimal"}]}]},{"block_type":"element","block":"k67ev6zr","search_text":"Open the first photo: ","text_count":22,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the first photo:"}]}]},{"block_type":"element","block":"k67ev6zs","search_text":">>> image1 = Image.open('photo-dublin-a1.jpg')","text_count":46,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image1 = Image.open('photo-dublin-a1.jpg')"}]}]},{"block_type":"element","block":"k67ev6zt","search_text":"Get the width, height, and format of the file: ","text_count":47,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the width, height, and format of the file:"}]}]},{"block_type":"element","block":"k67ev6zu","search_text":">>> image1.height 3024 >>> image1.width 4032 >>> image1.format 'JPEG'","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image1.height\n3024\n&gt;&gt;&gt; image1.width\n4032\n&gt;&gt;&gt; image1.format\n'JPEG'"}]}]},{"block_type":"element","block":"k67ev6zv","search_text":"Retrieve the EXIF information of the image, and process it for a convenient dictionary. Show the camera, the lens used, and when it was taken: ","text_count":143,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieve the EXIF information of the image, and process it for a convenient dictionary. Show the camera, the lens used, and when it was taken:"}]}]},{"block_type":"element","block":"k67ev6zw","search_text":">>> exif_info_1 = {TAGS.get(tag, tag): value for tag, value in image1._getexif().items()} >>> exif_info_1['Model'] 'iPhone X' >>> exif_info_1['LensModel'] 'iPhone X back dual camera 4mm f/1.8' >>> exif_info_1['DateTimeOriginal'] '2018:04:21 12:07:55'","text_count":250,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; exif_info_1 = {TAGS.get(tag, tag): value \n                   for tag, value in image1._getexif().items()}\n&gt;&gt;&gt; exif_info_1['Model']\n'iPhone X'\n&gt;&gt;&gt; exif_info_1['LensModel']\n'iPhone X back dual camera 4mm f/1.8'\n&gt;&gt;&gt; exif_info_1['DateTimeOriginal']\n'2018:04:21 12:07:55'"}]}]},{"block_type":"element","block":"k67ev6zx","search_text":"Open the second image and obtain the XMP info: ","text_count":47,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the second image and obtain the XMP info:"}]}]},{"block_type":"element","block":"k67ev6zy","search_text":">>> image2 = Image.open('photo-dublin-a2.png') >>> image2.height 2630 >>> image2.width 3943 >>> image2.format 'PNG' >>> xmp_info = xmltodict.parse(image2.info['XML:com.adobe.xmp'])","text_count":180,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image2 = Image.open('photo-dublin-a2.png')\n&gt;&gt;&gt; image2.height\n2630\n&gt;&gt;&gt; image2.width\n3943\n&gt;&gt;&gt; image2.format\n'PNG'\n&gt;&gt;&gt; xmp_info = xmltodict.parse(image2.info['XML:com.adobe.xmp'])"}]}]},{"block_type":"element","block":"k67ev6zz","search_text":"Obtain the RDF description field, which contains all the values we are looking for. Retrieve the model (a TIFF value), the lens model (an EXIF value), and the creation date (an XMP value). Check the values are the same as in step 4, even if the file is different: ","text_count":264,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the RDF description field, which contains all the values we are looking for. Retrieve the model (a TIFF value), the lens model (an EXIF value), and the creation date (an XMP value). Check the values are the same as in step 4, even if the file is different:"}]}]},{"block_type":"element","block":"k67ev700","search_text":">>> rdf_info_2 = xmp_info['x:xmpmeta']['rdf:RDF']['rdf:Description'] >>> rdf_info_2['tiff:Model'] 'iPhone X' >>> rdf_info_2['exifEX:LensModel'] 'iPhone X back dual camera 4mm f/1.8' >>> rdf_info_2['xmp:CreateDate'] '2018-04-21T12:07:55'","text_count":236,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; rdf_info_2 = xmp_info['x:xmpmeta']['rdf:RDF']['rdf:Description']\n&gt;&gt;&gt; rdf_info_2['tiff:Model']\n'iPhone X'\n&gt;&gt;&gt; rdf_info_2['exifEX:LensModel']\n'iPhone X back dual camera 4mm f/1.8'\n&gt;&gt;&gt; rdf_info_2['xmp:CreateDate']\n'2018-04-21T12:07:55'"}]}]},{"block_type":"element","block":"k67ev701","search_text":"Obtain the GPS information in both pictures, transform into an equivalent format, and check that they are the same. Notice that the resolution is not the same, but they match up to the fourth decimal point: ","text_count":207,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the GPS information in both pictures, transform into an equivalent format, and check that they are the same. Notice that the resolution is not the same, but they match up to the fourth decimal point:"}]}]},{"block_type":"element","block":"k67ev702","search_text":">>> gps_info_1 = {GPSTAGS.get(tag, tag): value for tag, value in exif_info_1['GPSInfo'].items()} >>> exif_to_decimal(gps_info_1) ('N53.34690555555556', 'W6.247797222222222') >>> rdf_to_decimal(rdf_info_2) ('N53.346905', 'W6.247796666666667')","text_count":241,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; gps_info_1 = {GPSTAGS.get(tag, tag): value \n                  for tag, value in exif_info_1['GPSInfo'].items()}\n&gt;&gt;&gt; exif_to_decimal(gps_info_1)\n('N53.34690555555556', 'W6.247797222222222')\n&gt;&gt;&gt; rdf_to_decimal(rdf_info_2)\n('N53.346905', 'W6.247796666666667')"}]}]},{"block_type":"element","block":"k67ev703","search_text":"Open the third image and obtain the creation date and GPS info, and check it doesn't match the other photo, although it is close (the second and third decimals are not the same): ","text_count":179,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the third image and obtain the creation date and GPS info, and check it doesn't match the other photo, although it is close (the second and third decimals are not the same):"}]}]},{"block_type":"element","block":"k67ev704","search_text":">>> image3 = Image.open('photo-dublin-b.png') >>> xmp_info = xmltodict.parse(image3.info['XML:com.adobe.xmp']) >>> rdf_info_3 = xmp_info['x:xmpmeta']['rdf:RDF']['rdf:Description'] >>> rdf_info_3['xmp:CreateDate'] '2018-03-08T18:16:57' >>> rdf_to_decimal(rdf_info_3) ('N53.34984166666667', 'W6.260388333333333')","text_count":310,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image3 = Image.open('photo-dublin-b.png')\n&gt;&gt;&gt; xmp_info = xmltodict.parse(image3.info['XML:com.adobe.xmp'])\n&gt;&gt;&gt; rdf_info_3 = xmp_info['x:xmpmeta']['rdf:RDF']['rdf:Description']\n&gt;&gt;&gt; rdf_info_3['xmp:CreateDate']\n'2018-03-08T18:16:57'\n&gt;&gt;&gt; rdf_to_decimal(rdf_info_3)\n('N53.34984166666667', 'W6.260388333333333')"}]}]},{"block_type":"element","block":"k67ev705","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev706","search_text":"Pillow is able to interpret files in most common languages, and open them as images in JPG format, as shown in step 2 in the How to do it… section.","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pillow is able to interpret files in most common languages, and open them as images in JPG format, as shown in step 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k67ev707","search_text":"The Image object contains the basic information about the size and format of the file, and is displayed in step 3. The info property contains information that is dependent on the format.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Image"}]},{"block_type":"text","content":"object contains the basic information about the size and format of the file, and is displayed in step 3. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"info"}]},{"block_type":"text","content":"property contains information that is dependent on the format."}]},{"block_type":"element","block":"k67ev708","search_text":"The EXIF metadata for JPG files can be parsed with the ._getexif() method, but then it needs to be translated properly, as it uses the raw binary definition. For example, the number 42,036 corresponds to the LensModel property. Fortunately, there's a definition of all tags in the PIL.ExifTags module. We translate the dictionary to readable tags in the step 4 to obtain a more readable dictionary.","text_count":398,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The EXIF metadata for JPG files can be parsed with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"._getexif()"}]},{"block_type":"text","content":"&nbsp;method, but then it needs to be translated properly, as it uses the raw binary definition. For example, the number 42,036 corresponds to the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LensModel"}]},{"block_type":"text","content":"&nbsp;property. Fortunately, there's a definition of all tags in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PIL.ExifTags"}]},{"block_type":"text","content":"&nbsp;module. We translate the dictionary to readable tags in the step 4 to obtain a more readable dictionary."}]},{"block_type":"element","block":"k67ev709","search_text":"Step 5 opens a PNG format, which has the same properties related to size, but the metadata is stored in XML/RDF format and needs to be parsed with the help of xmltodict. Step 6 shows how to navigate this metadata to extract the same information as in the JPG format. The data is the same, as both files come from the same original picture, even if the images are different.","text_count":373,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 5 opens a PNG format, which has the same properties related to size, but the metadata is stored in XML/RDF format and needs to be parsed with the help of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xmltodict."}]},{"block_type":"text","content":"Step 6 shows how to navigate this metadata to extract the same information as in the JPG format. The data is the same, as both files come from the same original picture, even if the images are different."}]},{"block_type":"element","block":"k67ev70a","search_text":"Note xmltodict has some issues when trying to parse data that's not in XML format. Check that the input is valid XML. ","text_count":118,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xmltodict"}]},{"block_type":"text","content":"has some issues when trying to parse data that's not in XML format. Check that the input is valid XML."}]}]},{"block_type":"element","block":"k67ev70b","search_text":"Step 7 extracted the GPS information for both images, which is stored in different ways, and shows they are the same (although the precision is different because of the way it is encoded).","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 7 extracted the GPS information for both images, which is stored in different ways, and shows they are the same (although the precision is different because of the way it is encoded)."}]},{"block_type":"element","block":"k67ev70c","search_text":"Step 8 shows the information on a different photo.","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 8 shows the information on a different photo."}]},{"block_type":"element","block":"k67ev70d","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev70e","search_text":"Pillow also has a lot of functionality around modifying pictures. It is very easy to resize or make simple modifications to a file, such as rotating it. You can find the complete Pillow documentation here: https://pillow.readthedocs.io .","text_count":237,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pillow also has a lot of functionality around modifying pictures. It is very easy to resize or make simple modifications to a file, such as rotating it. You can find the complete Pillow documentation here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pillow.readthedocs.io"},"children":[{"block_type":"text","content":"https://pillow.readthedocs.io"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev70f","search_text":"Tip Pillow allow a lot of operations with images. Not only simple operations such as resizing or transforming one format into another, but also things like cropping the image, applying color filters, or generating animated GIFs. If you're interested in image processing using Python, it is definitely something to take a look at. ","text_count":330,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pillow allow a lot of operations with images. Not only simple operations such as resizing or transforming one format into another, but also things like cropping the image, applying color filters, or generating animated GIFs. If you're interested in image processing using Python, it is definitely something to take a look at."}]}]},{"block_type":"element","block":"k67ev70g","search_text":"The GPS coordinates in the recipe are stated in DMS ( Degrees , Minutes , Seconds ), DDM ( Degrees , Decimal Minutes ), and transformed into DD ( Decimal Degrees ). You can find more about the different GPS formats here: http://www.ubergizmo.com/how-to/read-gps-coordinates/ . You'll also find how to search the exact locations of the pictures there, in case you're curious.","text_count":374,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The GPS coordinates in the recipe are stated in"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DMS"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Degrees"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Minutes"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Seconds"}]},{"block_type":"text","content":"),"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DDM"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Degrees"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Decimal Minutes"}]},{"block_type":"text","content":"), and transformed into"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DD"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Decimal Degrees"}]},{"block_type":"text","content":"). You can find more about the different GPS formats here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.ubergizmo.com/how-to/read-gps-coordinates/"},"children":[{"block_type":"text","content":"http://www.ubergizmo.com/how-to/read-gps-coordinates/"}]},{"block_type":"text","content":". You'll also find how to search the exact locations of the pictures there, in case you're curious."}]},{"block_type":"element","block":"k67ev70h","search_text":"A more advanced use of reading image files is to try to process them for OCR ( Optical Character Recognition ). This means automatically detecting text in an image and extracting and processing it. The open source module tesseract allows you to do this, and it can be used with Python and Pillow.","text_count":296,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A more advanced use of reading image files is to try to process them for"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"OCR"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Optical Character Recognition"}]},{"block_type":"text","content":"). This means automatically detecting text in an image and extracting and processing it. The open source module"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tesseract"}]},{"block_type":"text","content":"allows you to do this, and it can be used with Python and Pillow."}]},{"block_type":"element","block":"k67ev70i","search_text":"You need to install tesseract in your system ( https://github.com/tesseract-ocr/tesseract/wiki ), and the pytesseract Python module (using pip install pytesseract ). You can download a file with clear text, called photo-text.jpg , from the GitHub repository at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-text.jpg :","text_count":368,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need to install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tesseract"}]},{"block_type":"text","content":"in your system ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/tesseract-ocr/tesseract/wiki"},"children":[{"block_type":"text","content":"https://github.com/tesseract-ocr/tesseract/wiki"}]},{"block_type":"text","content":"), and the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pytesseract"}]},{"block_type":"text","content":"&nbsp;Python module (using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pip install pytesseract"}]},{"block_type":"text","content":"). You can download a file with clear text, called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-text.jpg"}]},{"block_type":"text","content":", from the GitHub repository at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-text.jpg"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-text.jpg"}]},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-text.jpg"},"children":[{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev70j","search_text":">>> from PIL import Image >>> import pytesseract >>> pytesseract.image_to_string(Image.open('photo-text.jpg')) 'Automate!'","text_count":122,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from PIL import Image\n&gt;&gt;&gt; import pytesseract\n&gt;&gt;&gt; pytesseract.image_to_string(Image.open('photo-text.jpg'))\n'Automate!'"}]}]},{"block_type":"element","block":"k67ev70k","search_text":"OCR can be difficult if the text is not very clear in the image, or it is mixed with images, or it uses a distinctive font. There's an example of that in the photo-dublin-a-text.jpg file, (available in the GitHub repository at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a-text.jpg ), which includes text over the picture:","text_count":382,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"OCR can be difficult if the text is not very clear in the image, or it is mixed with images, or it uses a distinctive font. There's an example of that in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"photo-dublin-a-text.jpg"}]},{"block_type":"text","content":"&nbsp;file, (available in the GitHub repository at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a-text.jpg"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a-text.jpg"}]},{"block_type":"text","content":"), which includes text over the picture:"}]},{"block_type":"element","block":"k67ev70l","search_text":">>> >>> pytesseract.image_to_string(Image.open('photo-dublin-a-text.jpg')) 'fl\\n\\nAutomat'","text_count":90,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; &gt;&gt;&gt; pytesseract.image_to_string(Image.open('photo-dublin-a-text.jpg'))\n'fl\\n\\nAutomat'"}]}]},{"block_type":"element","block":"k67ev70m","search_text":"More information about Tesseract is available at the following links: https://github.com/tesseract-ocr/tesseract https://github.com/madmaze/pytesseract","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"More information about Tesseract is available at the following links:"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/tesseract-ocr/tesseract"},"children":[{"block_type":"text","content":"https://github.com/tesseract-ocr/tesseract"}]},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/madmaze/pytesseract"},"children":[{"block_type":"text","content":"https://github.com/madmaze/pytesseract"}]}]},{"block_type":"element","block":"k67ev70n","search_text":"Tip Properly importing files to OCR may require initial image processing for better results. Image processing is out of scope for the objectives of this book, but you may use OpenCV, which more powerful than Pillow. You can process a file and then open it with Pillow: http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_tutorials.html . ","text_count":357,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Properly importing files to OCR may require initial image processing for better results. Image processing is out of scope for the objectives of this book, but you may use OpenCV,&nbsp;which more powerful than Pillow. You can process a file and then open it with Pillow:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_tutorials.html"},"children":[{"block_type":"text","content":"http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_tutorials.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev70o","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev70p","search_text":"The Reading text files recipe The Reading file metadata recipe The Crawling and searching directories recipe ","text_count":109,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading file metadata"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"text","content":"&nbsp;recipe"}]}]},{"block_type":"element","block":"k67ev70q","search_text":"Reading PDF files","text_count":17,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading PDF files"}]},{"block_type":"element","block":"k67ev70r","search_text":"A common format for documents is PDF ( Portable Document Format ). It started as a format to describe a document for any printer, so PDF is a format that ensures that the document will be printed exactly as it shows, and therefore is a great way of guaranteeing consistency. It has become a powerful standard for sharing documents, especially documents that are read-only.","text_count":372,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common format for documents is"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"PDF"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Portable Document Format"}]},{"block_type":"text","content":"). It started as a format to describe a document for any printer, so PDF is a format that ensures that the document will be printed exactly as it shows, and therefore is a great way of guaranteeing consistency. It has become a powerful standard&nbsp;for sharing documents, especially documents that are read-only."}]},{"block_type":"element","block":"k67ev70s","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev70t","search_text":"For this recipe, we are going to use the PyPDF2 module. We need to add it to our virtual environment:","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we are going to use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":"&nbsp;module. We need to add it to our virtual environment:"}]},{"block_type":"element","block":"k67ev70u","search_text":">>> echo \"PyPDF2==1.26.0\" >> requirements.txt >>> pip install -r requirements.txt","text_count":81,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"PyPDF2==1.26.0\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev70v","search_text":"In the GitHub directory Chapter03/documents , we have prepared two documents, document-1.pdf and document-2.pdf , to use in this recipe. Note they contain mostly Lorem Ipsum text, which is just placeholder text.","text_count":211,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the GitHub directory"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter03/documents"}]},{"block_type":"text","content":", we have prepared two documents,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-1.pdf"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-2.pdf"}]},{"block_type":"text","content":", to use in this recipe. Note they contain mostly Lorem Ipsum text, which is just placeholder text."}]},{"block_type":"element","block":"k67ev70w","search_text":"Tip Lorem Ipsum text is commonly used in design to show text without needing to create the content before the design. Learn more about it here: https://loremipsum.io/ . ","text_count":169,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Lorem Ipsum text is commonly used in design to show text without needing to create the content before the design. Learn more about it here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://loremipsum.io/"},"children":[{"block_type":"text","content":"https://loremipsum.io/"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev70x","search_text":"They are both the same test document, but the second one can only be opened with a password. The password is automate .","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"They are both the same test document, but the second one can only be opened with a password. The password is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"automate"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev70y","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev70z","search_text":"Import the module: ","text_count":19,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the module:"}]}]},{"block_type":"element","block":"k67ev710","search_text":">>> from PyPDF2 import PdfFileReader","text_count":36,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from PyPDF2 import PdfFileReader"}]}]},{"block_type":"element","block":"k67ev711","search_text":"Open the document-1.pdf file and create a PDF document object. Notice the file needs to be open for the whole reading: ","text_count":119,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-1.pdf"}]},{"block_type":"text","content":"&nbsp;file and create a PDF document object. Notice the file needs to be open for the whole reading:"}]}]},{"block_type":"element","block":"k67ev712","search_text":">>> file = open('document-1.pdf', 'rb') >>> document = PdfFileReader(file)","text_count":74,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file = open('document-1.pdf', 'rb')\n&gt;&gt;&gt; document = PdfFileReader(file)"}]}]},{"block_type":"element","block":"k67ev713","search_text":"Get the number of pages of the document, and check it is not encrypted: ","text_count":72,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the number of pages of the document, and check it is not encrypted:"}]}]},{"block_type":"element","block":"k67ev714","search_text":">>> document.numPages 3 >>> document.isEncrypted False","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.numPages\n3\n&gt;&gt;&gt; document.isEncrypted\nFalse"}]}]},{"block_type":"element","block":"k67ev715","search_text":"Get the creation date from the document info ( 2018-Jun-24 11:15:18 ), and discover that it has been created with a Mac Quartz PDFContext : ","text_count":140,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the creation date from the document info ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"2018-Jun-24 11:15:18"}]},{"block_type":"text","content":"), and discover that it has been created with a Mac"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Quartz PDFContext"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev716","search_text":">>> document.documentInfo['/CreationDate'] \"D:20180624111518Z00'00'\" >>> document.documentInfo['/Producer'] 'Mac OS X 10.13.5 Quartz PDFContext'","text_count":144,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.documentInfo['/CreationDate']\n\"D:20180624111518Z00'00'\"\n&gt;&gt;&gt; document.documentInfo['/Producer']\n'Mac OS X 10.13.5 Quartz PDFContext'"}]}]},{"block_type":"element","block":"k67ev717","search_text":"Get the first page, and read the text on it: ","text_count":45,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Get the first page, and read the text on it:"}]}]},{"block_type":"element","block":"k67ev718","search_text":">>> document.pages[0].extractText() '!A VERY IMPORTANT DOCUMENT \\nBy James McCormac CEO Loose Seal Inc '","text_count":104,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.pages[0].extractText()\n'!A VERY IMPORTANT DOCUMENT \\nBy James McCormac CEO Loose Seal Inc '"}]}]},{"block_type":"element","block":"k67ev719","search_text":"Do the same operation for the second page (redacted here): ","text_count":59,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Do the same operation for the second page (redacted here):"}]}]},{"block_type":"element","block":"k67ev71a","search_text":">>> document.pages[1].extractText() '\"!This is an example of a test document that is stored in PDF format. It contains some \\nsentences to describe what it is and the it has lore ipsum text.\\n!\"\\nLorem ipsum dolor sit amet, consectetur adipiscing elit. ...$'","text_count":258,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.pages[1].extractText()\n'\"!This is an example of a test document that is stored in PDF format. It contains some \\nsentences to describe what it is and the it has lore ipsum text.\\n!\"\\nLorem ipsum dolor sit amet, consectetur adipiscing elit. ...$'"}]}]},{"block_type":"element","block":"k67ev71b","search_text":"Close the file and open document-2.pdf : ","text_count":41,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Close the file and open"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-2.pdf"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev71c","search_text":">>> file.close() >>> file = open('document-2.pdf', 'rb') >>> document = PdfFileReader(file)","text_count":91,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file.close()\n&gt;&gt;&gt; file = open('document-2.pdf', 'rb')\n&gt;&gt;&gt; document = PdfFileReader(file)"}]}]},{"block_type":"element","block":"k67ev71d","search_text":"Check the document is encrypted (it requires a password) and raises an error if trying to access its content: ","text_count":110,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the document is encrypted (it requires a password) and raises an error if trying to access its content:"}]}]},{"block_type":"element","block":"k67ev71e","search_text":">>> document.isEncrypted True >>> document.numPages ... PyPDF2.utils.PdfReadError: File has not been decrypted","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.isEncrypted\nTrue\n&gt;&gt;&gt; document.numPages\n...\nPyPDF2.utils.PdfReadError: File has not been decrypted"}]}]},{"block_type":"element","block":"k67ev71f","search_text":"Decrypt the file and access its content: ","text_count":41,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Decrypt the file and access its content:"}]}]},{"block_type":"element","block":"k67ev71g","search_text":">>> document.decrypt('automate') 1 >>> document.numPages 3 >>> document.pages[0].extractText() '!A VERY IMPORTANT DOCUMENT \\nBy James McCormac CEO Loose Seal Inc ' ","text_count":164,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.decrypt('automate')\n1\n&gt;&gt;&gt; document.numPages\n3\n&gt;&gt;&gt; document.pages[0].extractText()\n'!A VERY IMPORTANT DOCUMENT \\nBy James McCormac CEO Loose Seal Inc '"}]}]},{"block_type":"element","block":"k67ev71h","search_text":"Close the file to clean up: ","text_count":28,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Close the file to clean up:"}]}]},{"block_type":"element","block":"k67ev71i","search_text":">>> file.close()","text_count":16,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file.close()"}]}]},{"block_type":"element","block":"k67ev71j","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev71k","search_text":"Once the document is open, as shown on steps 1 and 2 in the How to do it… section, the document object provides access to the document.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once the document is open, as shown on steps 1 and 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document"}]},{"block_type":"text","content":"object provides access to the document."}]},{"block_type":"element","block":"k67ev71l","search_text":"The most interesting properties are the number of pages, available in .numPages , and each of the pages, available in .pages , which can be accessed like a list.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most interesting properties are the number of pages, available in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".numPages"}]},{"block_type":"text","content":", and each of the pages, available in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".pages"}]},{"block_type":"text","content":", which can be accessed like a list."}]},{"block_type":"element","block":"k67ev71m","search_text":"Other data accessible is stored in .documentInfo , which stores metadata on the creator and when it was created.","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Other data accessible is stored in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".documentInfo"}]},{"block_type":"text","content":", which stores metadata on the creator and when it was created."}]},{"block_type":"element","block":"k67ev71n","search_text":"Tip The information in .documentInfo is optional and sometimes not up-to-date. It depends greatly on the tool used to generate the PDF. ","text_count":136,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The information in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".documentInfo"}]},{"block_type":"text","content":"is optional and sometimes not up-to-date. It depends greatly on the tool used to generate the PDF."}]}]},{"block_type":"element","block":"k67ev71o","search_text":"Each of the page objects can get its text by calling .extractText() , which will return all the text contained in the page, as done in steps 5 and 6. This method tries to extract all text, but it has some limitations. For well-structured texts, such as our example, it works quite well and the resulting text can be processed cleanly. Dealing with text in multiple columns or located in strange positions, it may complicate working with it.","text_count":440,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"page"}]},{"block_type":"text","content":"objects can get its text by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".extractText()"}]},{"block_type":"text","content":", which will return all the text contained in the page, as done in steps 5 and 6. This method tries to extract all text, but it has some limitations. For well-structured texts, such as our example, it works quite well and the resulting text can be processed cleanly. Dealing with text in multiple columns or located in strange positions, it may complicate working with it."}]},{"block_type":"element","block":"k67ev71p","search_text":"Note Notice that the PDF file needs to be open for the whole operation, instead of using a with context operator. After leaving the with block, the file is closed. ","text_count":164,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the PDF file needs to be open for the whole operation, instead of using a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context operator. After leaving the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"block, the file is closed."}]}]},{"block_type":"element","block":"k67ev71q","search_text":"Steps 8 and 9 shows how to deal with encrypted files. You can detect whether a file is encrypted or not with .isEncrypted , and then decrypt it with the .decrypt method, giving the password.","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 8 and 9 shows how to deal with encrypted files. You can detect whether a file is encrypted or not with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".isEncrypted"}]},{"block_type":"text","content":", and then decrypt it with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".decrypt"}]},{"block_type":"text","content":"method, giving the password."}]},{"block_type":"element","block":"k67ev71r","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev71s","search_text":"PDF is such a flexible format that it is very standard, but that also means that it can be difficult to parse and process.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"PDF is such a flexible format that it is very standard, but that also means that it can be difficult to parse and process."}]},{"block_type":"element","block":"k67ev71t","search_text":"While most PDF files contain text information, it is not uncommon that they contain images. This, for example, happens very often with scanned documents. This means that the information is stored as a collection of images, instead of in text. This makes it difficult to extract the data; we end up having to resolve to methods such as OCR to parse the images into text.","text_count":369,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While most PDF files contain text information, it is not uncommon that they contain images. This, for example, happens very often with scanned documents. This means that the information is stored as a collection of images, instead of in text. This makes it difficult to extract the data; we end up having to resolve to methods such as OCR to parse the images into text."}]},{"block_type":"element","block":"k67ev71u","search_text":"PyPDF2 does not provide a good interface to deal with images. You may need to transform the PDF into a collection of images and then process them. Most PDF readers can do it, or you can use a command-line tool such as pdftooppm ( https://linux.die.net/man/1/pdftoppm ) or QPDF (see the following). See the Reading images recipe for ideas about OCR.","text_count":348,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"PyPDF2 does not provide a good interface to deal with images. You may need to transform the PDF into a collection of images and then process them. Most PDF readers can do it, or you can use a command-line tool such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdftooppm"}]},{"block_type":"text","content":"&nbsp;("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://linux.die.net/man/1/pdftoppm"},"children":[{"block_type":"text","content":"https://linux.die.net/man/1/pdftoppm"}]},{"block_type":"text","content":") or QPDF (see the following). See the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading images"}]},{"block_type":"text","content":"&nbsp;recipe&nbsp; for ideas about OCR."}]},{"block_type":"element","block":"k67ev71v","search_text":"Some ways of encrypting files may not be understood by PyPDF2. It will generate NotImplementedError: only algorithm code 1 and 2 are supported . If that happens, you need to decrypt the PDF externally and open it once it is decrypted. You can use QPDF to create a copy without the password, as follows:","text_count":302,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some ways of encrypting files may not be understood by PyPDF2. It will generate"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"NotImplementedError: only algorithm code 1 and 2 are supported"}]},{"block_type":"text","content":". If that happens, you need to decrypt the PDF externally and open it once it is decrypted. You can use QPDF to create a copy without the password, as follows:"}]},{"block_type":"element","block":"k67ev71w","search_text":"$ qpdf --decrypt --password=PASSWORD encrypted.pdf output-decrypted.pdf","text_count":71,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ qpdf --decrypt --password=PASSWORD encrypted.pdf output-decrypted.pdf"}]}]},{"block_type":"element","block":"k67ev71x","search_text":"The full QPDF is available here: http://qpdf.sourceforge.net/files/qpdf-manual.html . QPDF is available in most package managers as well.","text_count":137,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full QPDF is available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://qpdf.sourceforge.net/files/qpdf-manual.html"},"children":[{"block_type":"text","content":"http://qpdf.sourceforge.net/files/qpdf-manual.html"}]},{"block_type":"text","content":". QPDF is available in most package managers as well."}]},{"block_type":"element","block":"k67ev71y","search_text":"Tip QPDF is capable of doing a lot of transformations and analyzing PDFs in-depth. There are also bindings into Python on a module called pikepdf ( https://pikepdf.readthedocs.io/en/stable/ ). This module is more difficult to use than PyPDF2 and it's not as straightforward for text extraction, but it can be useful if other operations such as extracting images from a PDF are required. ","text_count":387,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"QPDF is capable of doing a lot of transformations and analyzing PDFs in-depth. There are also bindings into Python on a module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pikepdf"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pikepdf.readthedocs.io/en/stable/"},"children":[{"block_type":"text","content":"https://pikepdf.readthedocs.io/en/stable/"}]},{"block_type":"text","content":"). This module is more difficult to use than PyPDF2 and it's not as straightforward for text extraction, but it can be useful if other operations such as extracting images from a PDF are required."}]}]},{"block_type":"element","block":"k67ev71z","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev720","search_text":"The Reading text files recipe The Crawling and searching directories recipe ","text_count":76,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev721","search_text":"Reading Word documents","text_count":22,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading Word documents"}]},{"block_type":"element","block":"k67ev722","search_text":"Word documents ( .docx ) are another common kind of document that stores text. They are typically generated with Microsoft Office, but other tools also produce compatible files. They are probably the most common format to share files that need to be editable, but they are also common for distributing documents.","text_count":312,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Word documents ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".docx"}]},{"block_type":"text","content":") are another common kind of document that stores text. They are&nbsp;typically&nbsp;generated with Microsoft Office, but other tools also produce compatible files. They are probably the most common format to share files that need to be editable, but they are also common for distributing documents."}]},{"block_type":"element","block":"k67ev723","search_text":"We'll see in this recipe how to extract text information from a Word document.","text_count":78,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll see in this recipe how to extract text information from a Word document."}]},{"block_type":"element","block":"k67ev724","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev725","search_text":"We'll use the python-docx module to read and process Word documents:","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"&nbsp;module&nbsp;to read and process Word documents:"}]},{"block_type":"element","block":"k67ev726","search_text":">>> echo \"python-docx==0.8.6\" >> requirements.txt >>> pip install -r requirements.txt","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"python-docx==0.8.6\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev727","search_text":"We have prepared a test file, available in the GitHub Chapter04/documents directory, called document-1.docx , which we'll use with this recipe. Note that this document follows the same Lorem Ipsun pattern that was described in the test document for the recipe Reading PDF files recipe .","text_count":286,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have prepared a test file, available in the GitHub&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter04/documents"}]},{"block_type":"text","content":"directory, called&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-1.docx"}]},{"block_type":"text","content":", which we'll use with this recipe. Note that this document follows the same Lorem Ipsun pattern that was described in the test document for the recipe&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading PDF files"}]},{"block_type":"text","content":"&nbsp;recipe&nbsp;."}]},{"block_type":"element","block":"k67ev728","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev729","search_text":"Import python-docx : ","text_count":21,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev72a","search_text":">> import docx","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt; import docx"}]}]},{"block_type":"element","block":"k67ev72b","search_text":"Open the document-1.docx file: ","text_count":31,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-1.docx"}]},{"block_type":"text","content":"&nbsp;file:"}]}]},{"block_type":"element","block":"k67ev72c","search_text":">>> doc = docx.Document('document-1.docx')","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; doc = docx.Document('document-1.docx')"}]}]},{"block_type":"element","block":"k67ev72d","search_text":"Check some of the metadata properties stored in core_properties : ","text_count":66,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check some of the metadata properties stored in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"core_properties"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev72e","search_text":">> doc.core_properties.title 'A very important document' >>> doc.core_properties.keywords 'lorem ipsum' >>> doc.core_properties.modified datetime.datetime(2018, 6, 24, 15, 1, 7)","text_count":177,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt; doc.core_properties.title\n'A very important document'\n&gt;&gt;&gt; doc.core_properties.keywords\n'lorem ipsum'\n&gt;&gt;&gt; doc.core_properties.modified\ndatetime.datetime(2018, 6, 24, 15, 1, 7)"}]}]},{"block_type":"element","block":"k67ev72f","search_text":"Check the number of paragraphs: ","text_count":32,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the number of paragraphs:"}]}]},{"block_type":"element","block":"k67ev72g","search_text":">>> len(doc.paragraphs) 58","text_count":26,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; len(doc.paragraphs)\n58"}]}]},{"block_type":"element","block":"k67ev72h","search_text":"Walk through the paragraphs to detect the ones that contain text. Notice not all text is displayed here: ","text_count":105,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Walk through the paragraphs to detect the ones that contain text. Notice not all text is displayed here:"}]}]},{"block_type":"element","block":"k67ev72i","search_text":">>> for index, paragraph in enumerate(doc.paragraphs): ... if paragraph.text: ... print(index, paragraph.text) ... 30 A VERY IMPORTANT DOCUMENT 31 By James McCormac 32 CEO Loose Seal Inc 34 ... 56 TITLE 2 57 ...","text_count":211,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for index, paragraph in enumerate(doc.paragraphs):\n...     if paragraph.text:\n...         print(index, paragraph.text)\n...\n30 A VERY IMPORTANT DOCUMENT\n31 By James McCormac\n32 CEO Loose Seal Inc\n34\n...\n56 TITLE 2\n57 ..."}]}]},{"block_type":"element","block":"k67ev72j","search_text":"Obtain the text for paragraphs 30 and 31 , which correspond to the title and subtitle on the first page: ","text_count":105,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the text for paragraphs"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"30"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"31"}]},{"block_type":"text","content":", which correspond to the title and subtitle on the first page:"}]}]},{"block_type":"element","block":"k67ev72k","search_text":">>> doc.paragraphs[30].text 'A VERY IMPORTANT DOCUMENT' >>> doc.paragraphs[31].text 'By James McCormac'","text_count":103,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; doc.paragraphs[30].text\n'A VERY IMPORTANT DOCUMENT'\n&gt;&gt;&gt; doc.paragraphs[31].text\n'By James McCormac'"}]}]},{"block_type":"element","block":"k67ev72l","search_text":"Each of the paragraphs has runs , which are sections of the text with different properties. Check that the first text paragraph and run is in bold and the second is in italics: ","text_count":177,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Each of the paragraphs has"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"runs"}]},{"block_type":"text","content":", which are sections of the text with different properties.&nbsp;Check that the first text paragraph and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"run"}]},{"block_type":"text","content":"is in bold and the second is in italics:"}]}]},{"block_type":"element","block":"k67ev72m","search_text":">>> doc.paragraphs[30].runs[0].italic >>> doc.paragraphs[30].runs[0].bold True >>> doc.paragraphs[31].runs[0].bold >>> doc.paragraphs[31].runs[0].italic True","text_count":157,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; doc.paragraphs[30].runs[0].italic\n&gt;&gt;&gt; doc.paragraphs[30].runs[0].bold\nTrue\n&gt;&gt;&gt; doc.paragraphs[31].runs[0].bold\n&gt;&gt;&gt; doc.paragraphs[31].runs[0].italic\nTrue"}]}]},{"block_type":"element","block":"k67ev72n","search_text":"In this document, most of the paragraphs have only one run , but we have a good example of different runs in paragraph 48 . Display its text and the different styles. For example, the word Word is in bold, and ipsum is in italics: ","text_count":231,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In this document, most of the paragraphs have only one"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"run"}]},{"block_type":"text","content":", but we have a good example of different runs in paragraph"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"48"}]},{"block_type":"text","content":". Display its text and the different styles. For example, the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Word"}]},{"block_type":"text","content":"&nbsp;is in bold, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ipsum"}]},{"block_type":"text","content":"&nbsp;is in italics:"}]}]},{"block_type":"element","block":"k67ev72o","search_text":">>> [run.text for run in doc.paragraphs[48].runs] ['This is an example of a test document that is stored in ', 'Word', ' format', '. It contains some ', 'sentences', ' to describe what it is and it has ', 'lore', 'm', ' ipsum', ' text.'] >>> run1 = doc.paragraphs[48].runs[1] >>> run1.text 'Word' >>> run1.bold True >>> run2 = doc.paragraphs[48].runs[8] >>> run2.text ' ipsum' >>> run2.italic True","text_count":397,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; [run.text for run in doc.paragraphs[48].runs]\n['This is an example of a test document that is stored in ', 'Word', ' format', '. It contains some ', 'sentences', ' to describe what it is and it has ', 'lore', 'm', ' ipsum', ' text.']\n&gt;&gt;&gt; run1 = doc.paragraphs[48].runs[1]\n&gt;&gt;&gt; run1.text\n'Word'\n&gt;&gt;&gt; run1.bold\nTrue\n&gt;&gt;&gt; run2 = doc.paragraphs[48].runs[8]\n&gt;&gt;&gt; run2.text\n' ipsum'\n&gt;&gt;&gt; run2.italic\nTrue"}]}]},{"block_type":"element","block":"k67ev72p","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev72q","search_text":"The most important peculiarity of Word documents is that the data is structured in paragraphs, instead of in pages. The size of the font, line size and other considerations may make the number of pages change.","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most important peculiarity of Word documents is that the data is structured in paragraphs, instead of in pages. The size of the font, line size and other considerations may make the number of pages change."}]},{"block_type":"element","block":"k67ev72r","search_text":"Most of the paragraphs are also typically empty, or include only new lines, tabs, or other whitespace characters. It is a good idea to check when a paragraph is empty and skip it.","text_count":179,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most of the paragraphs are also typically empty, or include only new lines, tabs, or other whitespace characters. It is a good idea to check when a paragraph is empty and skip it."}]},{"block_type":"element","block":"k67ev72s","search_text":"In the How to do it… section, step 2 opens the file and step 3 shows how to access the core properties. These are properties that are defined in Word as document metadata, such as the author or creation date.","text_count":208,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, step 2 opens the file and step 3 shows how to access the core properties. These are properties that are defined in Word as document metadata, such as the author or creation date."}]},{"block_type":"element","block":"k67ev72t","search_text":"Tip This information needs to be taken with a grain of salt, as a lot of tools that produce Word documents (but not Microsoft Office) won't necessarily fill it. Double-check before using that information. ","text_count":205,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This information needs to be taken with a grain of salt, as a lot of tools that produce Word documents (but not Microsoft Office) won't necessarily fill it. Double-check before using that information."}]}]},{"block_type":"element","block":"k67ev72u","search_text":"The paragraphs of the document can be iterated and have their text extracted in raw format, as shown in step 6. This is information that doesn't include styling information and it's typically the most useful one for processing the data automatically.","text_count":250,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The paragraphs of the document can be iterated and have their text extracted in raw format, as shown in step 6. This is information that doesn't include styling information and it's typically the most useful one for processing the data automatically."}]},{"block_type":"element","block":"k67ev72v","search_text":"If the styling information is required, the runs can be used, as in steps 7 and 8. Each paragraph can contain one or more runs, which are smaller units that share the same styling. For example, if a sentence is Word1 word2 word3 , there will be three runs, one with italic text (Word1), another with underline (word2), and another with bold (word3). Even more so, there can be intermediate runs with regular text that contains just the whitespaces, making a total of 5 runs.","text_count":474,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If the styling information is required, the runs can be used, as in steps 7 and 8. Each paragraph can contain one or more runs, which are smaller units that share the same styling. For example, if a sentence is"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Word1"}]},{"block_type":"text","content":"word2"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"word3"}]},{"block_type":"text","content":", there will be three runs, one with italic text (Word1), another with underline (word2), and another with bold (word3). Even more so, there can be intermediate runs with regular text that contains just the whitespaces, making a total of 5 runs."}]},{"block_type":"element","block":"k67ev72w","search_text":"The styling can be detected individually on properties such as bold, italic, or underline. ","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The styling can be detected individually on properties such as bold, italic, or underline.&nbsp;"}]},{"block_type":"element","block":"k67ev72x","search_text":"Tip The division in runs can quite complicated. Due to the way editors work it, is not uncommon to have half-words, a split word in two runs, sometimes with the same properties. Do not rely on the number of runs and analyse the content. In particular, double-check if trying to ensure if a part with a particular style is divided in two or more runs. A good example is the words lore m (it should be lorem ) in Step 8. ","text_count":419,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The division in runs can quite complicated. Due to the way editors work it, is not uncommon to have"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"half-words,"}]},{"block_type":"text","content":"&nbsp;a split word in two runs, sometimes with the same properties. Do not rely on the number of runs and analyse the content. In particular, double-check if trying to ensure if a part with a particular style is divided in two or more runs. A good example is the words"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lore"}]},{"block_type":"text","content":"&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"m"}]},{"block_type":"text","content":"&nbsp;(it should be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lorem"}]},{"block_type":"text","content":") in Step 8."}]}]},{"block_type":"element","block":"k67ev72y","search_text":"Be aware that, because Word documents are produced by so many sources, a lot of properties may not be set up, leaving it to the tool on what specifics to use. For example, is very common to keep the default font, which may mean that the font information is left empty.","text_count":268,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be aware that, because Word documents are produced by so many sources, a lot of properties may not be set up, leaving it to the tool on what specifics to use. For example, is very common to keep the default font, which may mean that the font information is left empty."}]},{"block_type":"element","block":"k67ev72z","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev730","search_text":"Further style information can be found under the font attribute, such as small_caps or size:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Further style information can be found under the font attribute, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"small_caps"}]},{"block_type":"text","content":"or size:"}]},{"block_type":"element","block":"k67ev731","search_text":">>> run2.font.cs_italic True >>> run2.font.size 152400 >>> run2.font.small_caps","text_count":79,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; run2.font.cs_italic\nTrue\n&gt;&gt;&gt; run2.font.size\n152400\n&gt;&gt;&gt; run2.font.small_caps"}]}]},{"block_type":"element","block":"k67ev732","search_text":"Normally focusing on the raw text, without paying attention to the style information is the correct parsing. But sometimes a bold word in a paragraph, will have special significance. It may be the header or the result you're looking for. Because it's highlighted, it likely is what you're looking for! Keep that in mind when analysing documents.","text_count":345,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Normally focusing on the raw text, without paying attention to the style information is the correct parsing. But sometimes a bold word in a paragraph, will have special significance. It may be the header or the result you're looking for. Because it's highlighted, it likely is what you're looking for! Keep that in mind when analysing documents."}]},{"block_type":"element","block":"k67ev733","search_text":"You can find the whole python-docx documentation here: https://python-docx.readthedocs.io/en/latest/ .","text_count":102,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can find the whole"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"documentation here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev734","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev735","search_text":"The Reading text files recipe The Reading PDF files recipe ","text_count":59,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading PDF files"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev736","search_text":"Scanning documents for a keyword","text_count":32,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Scanning documents for a keyword"}]},{"block_type":"element","block":"k67ev737","search_text":"In this recipe, we will join all the lessons of the previous recipes and will search the files in the directory for a particular keyword. This is a recap of the rest of the recipes in this chapter and includes a script that searches different kinds of files.","text_count":258,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will join all the lessons of the previous recipes and will search the files in the directory for a particular keyword. This is a recap of the rest of the recipes in this chapter and includes a script that searches different kinds of files."}]},{"block_type":"element","block":"k67ev738","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev739","search_text":"Be sure to include all the following modules in the requirements.txt file and install them into your virtual environment:","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be sure to include all the following modules in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file and install them into your virtual environment:"}]},{"block_type":"element","block":"k67ev73a","search_text":"beautifulsoup4==4.6.0 Pillow==5.1.0 PyPDF2==1.26.0 python-docx==0.8.6","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"beautifulsoup4==4.6.0\nPillow==5.1.0\nPyPDF2==1.26.0\npython-docx==0.8.6"}]}]},{"block_type":"element","block":"k67ev73b","search_text":"Check that the directory to search has the following files (all are available in GitHub in the Chapter04/documents directory). Note that file5.pdf and file6.pdf are copies of document-1.pdf , for simplicity. file1.txt to file4.txt are empty files:","text_count":247,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check that the directory to search has the following files&nbsp;(all are available in GitHub in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter04/documents"}]},{"block_type":"text","content":"directory). Note that&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file5.pdf"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file6.pdf"}]},{"block_type":"text","content":"are copies of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document-1.pdf"}]},{"block_type":"text","content":", for simplicity."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file1.txt"}]},{"block_type":"text","content":"to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"file4.txt"}]},{"block_type":"text","content":"are empty files:"}]},{"block_type":"element","block":"k67ev73c","search_text":"├── dir │ ├── file1.txt │ ├── file2.txt │ ├── file6.pdf │ └── subdir │ ├── file3.txt │ ├── file4.txt │ └── file5.pdf ├── document-1.docx ├── document-1.pdf ├── document-2-1.pdf ├── document-2.pdf ├── example_iso.txt ├── example_output_iso.txt ├── example_utf8.txt ├── top_films.csv └── zen_of_python.txt","text_count":303,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"├── dir\n│   ├── file1.txt\n│   ├── file2.txt\n│   ├── file6.pdf\n│   └── subdir\n│       ├── file3.txt\n│       ├── file4.txt\n│       └── file5.pdf\n├── document-1.docx\n├── document-1.pdf\n├── document-2-1.pdf\n├── document-2.pdf\n├── example_iso.txt\n├── example_output_iso.txt\n├── example_utf8.txt\n├── top_films.csv\n└── zen_of_python.txt"}]}]},{"block_type":"element","block":"k67ev73d","search_text":"We've prepared a script, scan.py , that will search for a word in all the .txt , .csv , .pdf , and .docx files. The script is available in the Chapter04 directory of the GitHub repository.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We've prepared a script,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"scan.py"}]},{"block_type":"text","content":", that will search for a word in all the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".txt"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".csv"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".pdf"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".docx"}]},{"block_type":"text","content":"files. The script is available in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Chapter04"}]},{"block_type":"text","content":"directory&nbsp;of the GitHub repository."}]},{"block_type":"element","block":"k67ev73e","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev73f","search_text":"Refer to help -h for how to use the scan.py script: ","text_count":52,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Refer to help"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-h"}]},{"block_type":"text","content":"for how to use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"scan.py"}]},{"block_type":"text","content":"&nbsp;script:"}]}]},{"block_type":"element","block":"k67ev73g","search_text":"$ python scan.py -h usage: scan.py [-h] [-w W] optional arguments: -h, --help show this help message and exit -w W Word to search","text_count":129,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python scan.py -h\nusage: scan.py [-h] [-w W]\n\noptional arguments:\n -h, --help show this help message and exit\n -w W Word to search"}]}]},{"block_type":"element","block":"k67ev73h","search_text":"Search for the word the , which is present in most of the files: ","text_count":65,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Search for the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"the"}]},{"block_type":"text","content":", which is present in most of the files:"}]}]},{"block_type":"element","block":"k67ev73i","search_text":"$ python scan.py -w the >>> Word found in ./document-1.pdf >>> Word found in ./top_films.csv >>> Word found in ./zen_of_python.txt >>> Word found in ./dir/file6.pdf >>> Word found in ./dir/subdir/file5.pdf","text_count":205,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python scan.py -w the\n&gt;&gt;&gt; Word found in ./document-1.pdf\n&gt;&gt;&gt; Word found in ./top_films.csv\n&gt;&gt;&gt; Word found in ./zen_of_python.txt\n&gt;&gt;&gt; Word found in ./dir/file6.pdf\n&gt;&gt;&gt; Word found in ./dir/subdir/file5.pdf"}]}]},{"block_type":"element","block":"k67ev73j","search_text":"Search for the word lorem , only present in the PDF and docx files: ","text_count":68,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Search for the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lorem"}]},{"block_type":"text","content":", only present in the PDF and docx files:"}]}]},{"block_type":"element","block":"k67ev73k","search_text":"$ python scan.py -w lorem >>> Word found in ./document-1.docx >>> Word found in ./document-1.pdf >>> Word found in ./dir/file6.pdf >>> Word found in ./dir/subdir/file5.pdf","text_count":171,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python scan.py -w lorem\n&gt;&gt;&gt; Word found in ./document-1.docx\n&gt;&gt;&gt; Word found in ./document-1.pdf\n&gt;&gt;&gt; Word found in ./dir/file6.pdf\n&gt;&gt;&gt; Word found in ./dir/subdir/file5.pdf"}]}]},{"block_type":"element","block":"k67ev73l","search_text":"Search for the word 20£ , only present in the two ISO files, with different encodings: ","text_count":87,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Search for the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"20&pound;"}]},{"block_type":"text","content":", only present&nbsp;in the two ISO files, with different encodings:"}]}]},{"block_type":"element","block":"k67ev73m","search_text":"$ python scan.py -w 20£ >>> Word found in ./example_iso.txt >>> Word found in ./example_output_iso.txt","text_count":102,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python scan.py -w 20&pound;\n&gt;&gt;&gt; Word found in ./example_iso.txt\n&gt;&gt;&gt; Word found in ./example_output_iso.txt"}]}]},{"block_type":"element","block":"k67ev73n","search_text":"The search is case insensitive. Search for the word BETTER , only present in the zen_of_python.txt file: ","text_count":105,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The search is case insensitive. Search for the word"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BETTER"}]},{"block_type":"text","content":", only present in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"zen_of_python.txt"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev73o","search_text":"$ python scan.py -w BETTER >>> Word found in ./zen_of_python.txt","text_count":64,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python scan.py -w BETTER\n&gt;&gt;&gt; Word found in ./zen_of_python.txt"}]}]},{"block_type":"element","block":"k67ev73p","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev73q","search_text":"The file scan.py has the following elements:","text_count":44,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The file"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"scan.py"}]},{"block_type":"text","content":"&nbsp;has the following elements:"}]},{"block_type":"element","block":"k67ev73r","search_text":"An entry point that parses the input parameters and creates the help for the command line. A main function that walks through the directory and analyses each of the files found. Based on their extension, it decides whether there's an available function to process and search it. An EXTENSION dictionary, which pairs the extensions with the function to search them. The search_txt , search_csv , search_pdf , and search_docx functions, which process and search for the required word for each kind of file. ","text_count":505,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"An entry point that parses the input parameters and creates the help for the command line."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A main function that walks through the directory and analyses each of the files&nbsp;found. Based on their extension, it decides whether there's an available function to process and search it."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"An"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EXTENSION"}]},{"block_type":"text","content":"dictionary, which pairs the extensions with the function to search them."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_txt"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_csv"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_pdf"}]},{"block_type":"text","content":",&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_docx"}]},{"block_type":"text","content":"functions, which process and search for the required word for each kind of file."}]}]},{"block_type":"element","block":"k67ev73s","search_text":"The comparison is case-insensitive, so the search word is transformed in lower case and, in all comparisons, the text is transformed into lowercase.","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The comparison is case-insensitive, so the search word is transformed in lower case and, in all comparisons, the text is transformed into lowercase."}]},{"block_type":"element","block":"k67ev73t","search_text":"Each of the search functions have their own peculiarities:","text_count":58,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the search functions have their own peculiarities:"}]},{"block_type":"element","block":"k67ev73u","search_text":"search_txt first opens the file to determine its encoding, using UnicodeDammit , then it opens the file and reads it line by line. If the word is found, it stops immediately and returns success. search_csv opens the file in CSV, and iterates not only line by line, but also column by column. As soon as the word is found, it returns. search_pdf opens the file and exits if it is encrypted. It not, it goes page by page, extracting the text and comparing it with the word. It returns as soon as it finds a match. search_docx opens the file and iterates through all its paragraphs for a match. As soon as a match is found, the function returns. ","text_count":643,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_txt"}]},{"block_type":"text","content":"first opens the file to determine its encoding, using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"UnicodeDammit"}]},{"block_type":"text","content":", then it opens the file and reads it line by line. If the word is found, it stops immediately and returns success."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_csv"}]},{"block_type":"text","content":"opens the file in CSV, and iterates not only line by line, but also column by column. As soon as the word is found, it returns."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_pdf"}]},{"block_type":"text","content":"opens the file and exits if it is encrypted. It not, it goes page by page, extracting the text and comparing it with the word. It returns as soon as it finds a match."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_docx"}]},{"block_type":"text","content":"opens the file and iterates through all its paragraphs for a match. As soon as a match is found, the function returns."}]}]},{"block_type":"element","block":"k67ev73v","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev73w","search_text":"There are some extra ideas that could be implemented:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are some extra ideas that could be implemented:"}]},{"block_type":"element","block":"k67ev73x","search_text":"More search functions could be added. In this chapter, we went through log files and images. A similar structure could work for searching for files and returning only the last 10. search_csv is not sniffing to detect the dialect. This could be added as well. Reading is quite sequential. It should be possible to read the files in parallel, analyzing them for faster returns, but be aware that reading files in parallel can lead to sorting issues, as the files won't always be processed in the same order. ","text_count":506,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"More search functions could be added. In this chapter, we went through log files and images."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A similar structure could work for searching for files and returning only the last 10."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_csv"}]},{"block_type":"text","content":"is not sniffing to detect the dialect. This could be added as well."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading is quite sequential. It should be possible to read the files in parallel, analyzing them for faster returns, but be aware that reading files in parallel can lead to sorting issues, as the files won't always be processed in the same order."}]}]},{"block_type":"element","block":"k67ev73y","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev73z","search_text":"The Crawling and searching directories recipe The Reading text files recipe The Dealing with encodings recipe The Reading CSV files recipe The Reading PDF files recipe The Reading Word documents recipe ","text_count":202,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with encodings"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading CSV files"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading PDF files"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading Word documents"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Generating Fantastic Reports","author":"Jaime Buelta","block":"k67eunrl","number":5,"contents":[{"block_type":"element","block":"k67ev740","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k67ev741","search_text":"Creating a simple report in plain text Using templates for reports Formatting text in Markdown Writing a basic Word document Styling a Word document Generating structure in Word documents Adding pictures to Word documents Writing a simple PDF document Structuring a PDF Aggregating PDF reports Watermarking and encrypting a PDF ","text_count":328,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating a simple report in plain text"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Using templates for reports"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Formatting text in Markdown"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing&nbsp;a basic Word document"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Styling a Word document"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating structure in Word documents"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Adding pictures to Word documents"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a simple PDF document"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Structuring a PDF"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF reports"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Watermarking and encrypting a PDF"}]}]},{"block_type":"element","block":"k67ev742","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev743","search_text":"In this chapter, we'll see how to write documents and perform basic operations, such as dealing with templates in different formats, such as plain text and Markdown. We'll spend the most time with common, useful formats such as Word and PDF.","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we'll see how to write documents and perform basic operations, such as dealing with templates in different formats, such as plain text and Markdown. We'll spend the most time with common, useful formats such as Word and PDF."}]},{"block_type":"element","block":"k67ev744","search_text":"Creating a simple report in plain text","text_count":38,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating a simple report in plain text"}]},{"block_type":"element","block":"k67ev745","search_text":"The most simple report is to generate some text and store it in a file.","text_count":71,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most simple report is to generate some text and store it in a file."}]},{"block_type":"element","block":"k67ev746","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev747","search_text":"For this recipe, we will generate a brief report in text format. The data to be stored will be in a dictionary.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will generate a brief report in text format. The data to be stored will be in a dictionary."}]},{"block_type":"element","block":"k67ev748","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev749","search_text":"Import datetime : ","text_count":18,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev74a","search_text":">>> from datetime import datetime","text_count":33,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from datetime import datetime"}]}]},{"block_type":"element","block":"k67ev74b","search_text":"Create the template with the report in text format: ","text_count":52,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the template with the report in text format:"}]}]},{"block_type":"element","block":"k67ev74c","search_text":">>> TEMPLATE = ''' Movies report ------------- Date: {date} Movies seen in the last 30 days: {num_movies} Total minutes: {total_minutes} '''","text_count":140,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; TEMPLATE = '''\nMovies report\n-------------\n\nDate: {date}\nMovies seen in the last 30 days: {num_movies}\nTotal minutes: {total_minutes}\n'''"}]}]},{"block_type":"element","block":"k67ev74d","search_text":"Create a dictionary with the values to store. Note this is the data that's going to be presented in the report: ","text_count":112,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a dictionary with the values to store. Note this is the data that's going to be presented in the report:"}]}]},{"block_type":"element","block":"k67ev74e","search_text":">>> data = { 'date': datetime.utcnow(), 'num_movies': 3, 'total_minutes': 376, }","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = {\n    'date': datetime.utcnow(),\n 'num_movies': 3,\n    'total_minutes': 376,\n}"}]}]},{"block_type":"element","block":"k67ev74f","search_text":"Compose the report, adding the data to the template: ","text_count":53,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Compose the report, adding the data to the template:"}]}]},{"block_type":"element","block":"k67ev74g","search_text":">>> report = TEMPLATE.format(**data)","text_count":36,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; report = TEMPLATE.format(**data)"}]}]},{"block_type":"element","block":"k67ev74h","search_text":"Create a new file with the current date and store the report: ","text_count":62,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new file with the current date and store the report:"}]}]},{"block_type":"element","block":"k67ev74i","search_text":">>> FILENAME_TMPL = \"{date}_report.txt\" >>> filename = FILENAME_TMPL.format(date=data['date'].strftime('%Y-%m-%d')) >>> filename 2018-06-26_report.txt >>> with open(filename, 'w') as file: ... file.write(report)","text_count":211,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; FILENAME_TMPL = \"{date}_report.txt\"\n&gt;&gt;&gt; filename = FILENAME_TMPL.format(date=data['date'].strftime('%Y-%m-%d'))\n&gt;&gt;&gt; filename\n2018-06-26_report.txt\n&gt;&gt;&gt; with open(filename, 'w') as file:\n...     file.write(report)"}]}]},{"block_type":"element","block":"k67ev74j","search_text":"Check the newly created report: ","text_count":32,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the newly created report:"}]}]},{"block_type":"element","block":"k67ev74k","search_text":"$ cat 2018-06-26_report.txt Movies report ------------- Date: 2018-06-26 23:40:08.737671 Movies seen in the last 30 days: 3 Total minutes: 376","text_count":142,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ cat 2018-06-26_report.txt\n\nMovies report\n-------------\n\nDate: 2018-06-26 23:40:08.737671\nMovies seen in the last 30 days: 3\nTotal minutes: 376"}]}]},{"block_type":"element","block":"k67ev74l","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev74m","search_text":"Steps 2 and 3 in the How to do it… section set up a simple template and add a dictionary with all the data to be contained in the report. Then, in step 4, those two are combined into a specific report.","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 2 and 3 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section set up a simple template and add a dictionary with all the data to be contained in the report. Then, in step 4, those two are combined into a specific report."}]},{"block_type":"element","block":"k67ev74n","search_text":"Note In step 4, the dictionary is combined with a template. Notice that the keys on the dictionary correspond to the parameters on the template. The trick is to use the double star in the format call to decompress the dictionary, passing each of the keys as a parameter to format() . ","text_count":284,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 4, the dictionary is combined with a template. Notice that the keys on the dictionary correspond to the parameters on the template. The trick is to use the double star in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"format"}]},{"block_type":"text","content":"&nbsp;call to decompress the dictionary, passing each of the keys as a parameter to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"format()"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev74o","search_text":"In Step 5, the resulting report, a string, is stored in a newly created file, using the with context manager. The open() function creates a new file, as stated in the opening mode, w , and keeps it open during the block, which writes the data to the file. When exiting the block, the file is properly closed.","text_count":308,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Step 5, the resulting report, a string, is stored in a newly created file, using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context manager. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"open()"}]},{"block_type":"text","content":"function creates a new file, as stated in the opening mode,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"w"}]},{"block_type":"text","content":", and keeps it open during the block, which writes the data to the file. When exiting the block, the file is properly closed."}]},{"block_type":"element","block":"k67ev74p","search_text":"Tip The open modes determine how to open a file, whether it is to read or write, and whether the file is in text or binary. The w mode opens the file to write it, overwriting it if it already exists. Be careful to not to delete an existing file by mistake! ","text_count":257,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The open modes determine how to open a file, whether it is to read or write, and whether the file is in text or binary. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"w"}]},{"block_type":"text","content":"mode opens the file to write it, overwriting it if it already exists. Be careful to not to delete an existing file by mistake!"}]}]},{"block_type":"element","block":"k67ev74q","search_text":"Step 6 checks that the file has been created with the proper data.","text_count":66,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 6 checks that the file has been created with the proper data."}]},{"block_type":"element","block":"k67ev74r","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev74s","search_text":"The filename is created with today's date to minimize the probability of overwriting values. The format of the date, starting with the year and ending with the day, has been selected so the files are sorted naturally in the correct order.","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The filename is created with today's date to minimize the probability of overwriting values. The format of the date, starting with the year and ending with the day, has been selected so the files are sorted naturally in the correct order."}]},{"block_type":"element","block":"k67ev74t","search_text":"The with context manager will close the file even if there's an exception. It will raise an IOError exception if there is.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context manager will close the file even if there's an exception. It will raise an&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"IOError"}]},{"block_type":"text","content":"&nbsp;exception if there is."}]},{"block_type":"element","block":"k67ev74u","search_text":"Tip Some of the common exceptions in writing could be a problem with permissions, a full hard drive, or a path problem (for instance, trying to write in a non-existent directory). ","text_count":180,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some of the common exceptions in writing could be a problem with permissions, a full hard drive, or a path problem (for instance, trying to write in a non-existent directory).&nbsp;"}]}]},{"block_type":"element","block":"k67ev74v","search_text":"Note that a file may not be fully committed to disk until it is closed or explicitly flushed. Generally, this is not a problem when dealing with files, but something to keep in mind if trying to open a file twice, one for read and one for write.","text_count":245,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that a file may not be fully committed to disk until it is closed or explicitly flushed. Generally, this is not a problem when dealing with files, but something to keep in mind if trying to open a file twice, one for read and one for write."}]},{"block_type":"element","block":"k67ev74w","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev74x","search_text":"The Using templates for reports recipe The Formatting text in Markdown recipe The Aggregating PDF reports recipe ","text_count":113,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using templates for reports"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Formatting text in Markdown"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF reports"}]},{"block_type":"text","content":"&nbsp;recipe"}]}]},{"block_type":"element","block":"k67ev74y","search_text":"Using templates for reports","text_count":27,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Using templates for reports"}]},{"block_type":"element","block":"k67ev74z","search_text":"HTML is a very flexible format that can be used to present rich reports. While an HTML template can be created by treating it as just text, there are tools that allow you to add better handling of structured text. This detaches the template from the code as well, separating the generation of the data from the representation of that data.","text_count":339,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"HTML is a very flexible format that can be used to present rich reports. While an HTML template can be created by treating it as just text, there are tools that allow you to add better handling of structured text. This detaches the template from the code as well, separating the generation of the data from the representation of that data."}]},{"block_type":"element","block":"k67ev750","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev751","search_text":"The tool used in this recipe, Jinja2, reads a file that contains the template and applies the context to it. The context contains the data to be displayed.","text_count":155,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The tool used in this recipe, Jinja2, reads a file that contains the template and applies the context to it. The context contains the data to be displayed."}]},{"block_type":"element","block":"k67ev752","search_text":"We should start by installing the module:","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We should start by installing the module:"}]},{"block_type":"element","block":"k67ev753","search_text":"$ echo \"jinja2==2.20\" >> requirements.txt $ pip install -r requirements.txt","text_count":75,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"jinja2==2.20\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev754","search_text":"Jinja2 uses its own syntax, which is a mixture of HTML and Python. It is aimed at HTML documents so it easily performs operations such as correctly escaping special characters.","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jinja2 uses its own syntax, which is a mixture of HTML and Python. It is aimed at HTML documents so it easily performs operations such as correctly escaping special characters."}]},{"block_type":"element","block":"k67ev755","search_text":"In the GitHub repository, we've included a template file called jinja_template.html with the template to use.","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the GitHub repository, we've included a template file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"jinja_template.html"}]},{"block_type":"text","content":"with the template to use."}]},{"block_type":"element","block":"k67ev756","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev757","search_text":"Import Jinja2 Template and datetime : ","text_count":38,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import Jinja2"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Template"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev758","search_text":">>> from jinja2 import Template >>> from datetime import datetime","text_count":65,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from jinja2 import Template\n&gt;&gt;&gt; from datetime import datetime"}]}]},{"block_type":"element","block":"k67ev759","search_text":"Read the template from the files into memory: ","text_count":46,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Read the template from the files into memory:"}]}]},{"block_type":"element","block":"k67ev75a","search_text":">>> with open('jinja_template.html') as file: ... template = Template(file.read())","text_count":82,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('jinja_template.html') as file:\n...     template = Template(file.read())"}]}]},{"block_type":"element","block":"k67ev75b","search_text":"Create a context with the data to be displayed: ","text_count":48,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a context with the data to be displayed:"}]}]},{"block_type":"element","block":"k67ev75c","search_text":">>> context = { 'date': datetime.now(), 'movies': ['Casablanca', 'The Sound of Music', 'Vertigo'], 'total_minutes': 404, }","text_count":122,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; context = {\n    'date': datetime.now(),\n    'movies': ['Casablanca', 'The Sound of Music', 'Vertigo'],\n    'total_minutes': 404,\n}"}]}]},{"block_type":"element","block":"k67ev75d","search_text":"Render the template and write a new file, report.html , with the following result: ","text_count":83,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Render the template and write a new file,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":", with the following result:"}]}]},{"block_type":"element","block":"k67ev75e","search_text":">>> with open('report.html', 'w') as file: ... file.write(template.render(context))","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('report.html', 'w') as file:\n...    file.write(template.render(context))"}]}]},{"block_type":"element","block":"k67ev75f","search_text":"Open the report.html file in a browser: ","text_count":40,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":"file in a browser:"}]}]},{"block_type":"element","block":"k67ev75g","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000016.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev75h","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev75i","search_text":"Steps 2 and 4 in the How to do it… section are very straightforward: they read the template and save the resulting report.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 2 and 4 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section are very straightforward: they read the template and&nbsp;&nbsp;save the resulting report."}]},{"block_type":"element","block":"k67ev75j","search_text":"As seen in Steps 3 and 4, the main task is to create a context dictionary with the information to be displayed. The template then renders that information, as shown in step 5. Let's take a look at jinja_template.html :","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As seen in Steps 3 and 4, the main task is to create a context dictionary with the information to be displayed. The template then renders that information, as shown in step 5. Let's take a look at"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"jinja_template.html"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev75k","search_text":"<!DOCTYPE html> <html lang=\"en\"> <head> <title> Movies Report</title> </head> <body> <h1>Movies Report</h1> <p>Date {{date}}</p> <p>Movies seen in the last 30 days: {{movies|length}}</p> <ol> {% for movie in movies %} <li>{{movie}}</li> {% endfor %} </ol> <p>Total minutes: {{total_minutes}} </p> </body> </html>","text_count":312,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;title&gt; Movies Report&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;Movies Report&lt;/h1&gt;\n    &lt;p&gt;Date {{date}}&lt;/p&gt;\n    &lt;p&gt;Movies seen in the last 30 days: {{movies|length}}&lt;/p&gt;\n    &lt;ol&gt;\n        {% for movie in movies %}\n        &lt;li&gt;{{movie}}&lt;/li&gt;\n        {% endfor %}\n    &lt;/ol&gt;\n    &lt;p&gt;Total minutes: {{total_minutes}} &lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;"}]}]},{"block_type":"element","block":"k67ev75l","search_text":"Most of it is replacing the context values as defined between curly brackets, such as {{total_minutes}} . ","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most of it is replacing the context values as defined between curly brackets, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{{total_minutes}}"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev75m","search_text":"Note the tag, {% for ... %} / {% endfor %} , which defines a loop. That allows a very Python-based assignment to generate multiple rows or elements.","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the tag,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{% for ... %} / {% endfor %}"}]},{"block_type":"text","content":", which defines a loop. That allows a very Python-based assignment to generate multiple rows or elements."}]},{"block_type":"element","block":"k67ev75n","search_text":"Filters can be applied to the variables to modify them. In this case, the length filter is applied to the movies list to obtain the size using the pipe symbol, as shown in {{movies|length}} .","text_count":191,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Filters can be applied to the variables to modify them. In this case, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"length"}]},{"block_type":"text","content":"filter is applied to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies"}]},{"block_type":"text","content":"list to obtain the size using the pipe symbol, as shown in&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{{movies|length}}"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev75o","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev75p","search_text":"Other than the {% for %} tag, there's an {% if %} tag, allowing it to display conditionally:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Other than the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{% for %}"}]},{"block_type":"text","content":"tag, there's an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{% if %}"}]},{"block_type":"text","content":"tag, allowing it to display conditionally:"}]},{"block_type":"element","block":"k67ev75q","search_text":"{% if movies|length > 5 %} Wow, so many movies this month! {% else %} Regular number of movies {% endif %}","text_count":106,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"{% if movies|length &gt; 5 %}\n  Wow, so many movies this month!\n{% else %}\n  Regular number of movies\n{% endif %}"}]}]},{"block_type":"element","block":"k67ev75r","search_text":"There are a good number of defined filters already (see the whole list here: http://jinja.pocoo.org/docs/2.10/templates/#list-of-builtin-filters ). But, it is also possible to define custom ones.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are a good number of defined filters already (see the whole list here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://jinja.pocoo.org/docs/2.10/templates/#list-of-builtin-filters"},"children":[{"block_type":"text","content":"http://jinja.pocoo.org/docs/2.10/templates/#list-of-builtin-filters"}]},{"block_type":"text","content":"). But, it is also possible to define custom ones."}]},{"block_type":"element","block":"k67ev75s","search_text":"Tip Note that you can add a lot of processing and logic to the template using filters. While a little bit is fine, try to limit the amount of logic in the template. Most of the calculations for data to be displayed should be done before, leaving the template to just display values. This makes the context very straightforward and simplifies the template, allowing for changes. ","text_count":378,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that you can add a lot of processing and logic to the template using filters. While a little bit is fine, try to limit the amount of logic in the template. Most of the calculations for data to be displayed should be done before, leaving the template to just display values. This makes the context very straightforward and simplifies the template, allowing for changes."}]}]},{"block_type":"element","block":"k67ev75t","search_text":"When dealing with HTML files, it is good to auto-escape the variables. This means that characters with meaning, for example, the < character, will be replaced by the equivalent HTML code to be properly displayed on an HTML page. To do so, create the template with the autoescape parameter. Check the difference here:","text_count":316,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When dealing with HTML files, it is good to auto-escape the variables. This means that characters with meaning, for example, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&lt;"}]},{"block_type":"text","content":"character, will be replaced by the equivalent HTML code to be properly displayed on an HTML page. To do so, create the template with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"autoescape"}]},{"block_type":"text","content":"parameter. Check the difference here:"}]},{"block_type":"element","block":"k67ev75u","search_text":">>> Template('{{variable}}', autoescape=False).render({'variable': '<'}) '<' >>> Template('{{variable}}', autoescape=True).render({'variable': '<'}) '<'","text_count":152,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; Template('{{variable}}', autoescape=False).render({'variable': '&lt;'})\n'&lt;'\n&gt;&gt;&gt; Template('{{variable}}', autoescape=True).render({'variable': '&lt;'})\n'&lt;'"}]}]},{"block_type":"element","block":"k67ev75v","search_text":"Escaping can be applied on each variable with the e filter (meaning escape ) and unapplied with the safe filter (meaning it is safe to render as it is ).","text_count":153,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Escaping can be applied on each variable with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"e"}]},{"block_type":"text","content":"filter (meaning"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"escape"}]},{"block_type":"text","content":") and unapplied with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"safe"}]},{"block_type":"text","content":"filter (meaning"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"it is safe to render as it is"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev75w","search_text":"Jinja2 templates are extensible, meaning that you can create a base_template.html and then extend it, changing some of the elements. You can include other files as well, partitioning and separating different sections. See the full documentation for further details.","text_count":265,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jinja2 templates are extensible, meaning that you can create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"base_template.html"}]},{"block_type":"text","content":"and then extend it, changing some of the elements. You can include other files as well, partitioning and separating different sections. See the full documentation for further details."}]},{"block_type":"element","block":"k67ev75x","search_text":"Tip Jinja2 is very powerful and allows us to create complex HTML templates, and also in other formats such as LaTeX or JavaScript, though this requires configuring. I encourage you to read the whole documentation and have a look at all its capabilities! ","text_count":254,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Jinja2 is very powerful and allows us to create complex HTML templates, and also in other formats such as LaTeX or JavaScript, though this requires configuring. I encourage you to read the whole documentation and have a look at all its capabilities!&nbsp;"}]}]},{"block_type":"element","block":"k67ev75y","search_text":"The whole Jinja2 documentation can be found here: http://jinja.pocoo.org/docs/2.10/.","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The whole Jinja2 documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://jinja.pocoo.org/docs/2.10/"},"children":[{"block_type":"text","content":"http://jinja.pocoo.org/docs/2.10/."}]}]},{"block_type":"element","block":"k67ev75z","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev760","search_text":"The Creating a simple report in plain text recipe The Formatting text in Markdown recipe ","text_count":89,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a simple report in plain text"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Formatting text in Markdown"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev761","search_text":"Formatting text in Markdown","text_count":27,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Formatting text in Markdown"}]},{"block_type":"element","block":"k67ev762","search_text":"Markdown is a very popular markup language used to create raw text that can be converted into styled HTML. It is a good way of structuring documents in a way that is readable in raw text format, while being able to properly style them in HTML. ","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Markdown"}]},{"block_type":"text","content":"is a very popular markup language&nbsp;used to create raw text that can be converted into styled HTML. It is a good way of structuring documents in a way that is readable in raw text format, while being able to&nbsp;properly style them in HTML.&nbsp;"}]},{"block_type":"element","block":"k67ev763","search_text":"In this recipe, we'll see how to transform a Markdown document into styled HTML using Python.","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to transform a Markdown document into styled HTML using Python."}]},{"block_type":"element","block":"k67ev764","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev765","search_text":"We should start by installing the mistune module, which will compile Markdown documents into HTML:","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We should start by installing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mistune"}]},{"block_type":"text","content":"module, which will compile Markdown documents into HTML:"}]},{"block_type":"element","block":"k67ev766","search_text":"$ echo \"mistune==0.8.3\" >> requirements.txt $ pip install -r requirements.txt","text_count":77,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"mistune==0.8.3\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev767","search_text":"In the GitHub repository, there is a template file called markdown_template.md with a template of the report to generate. ","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the GitHub repository, there is a template file called&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"markdown_template.md"}]},{"block_type":"text","content":"&nbsp;with a template of the report to generate.&nbsp;"}]},{"block_type":"element","block":"k67ev768","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev769","search_text":"Import mistune and datetime : ","text_count":30,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mistune"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev76a","search_text":">>> import mistune","text_count":18,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import mistune"}]}]},{"block_type":"element","block":"k67ev76b","search_text":"Read the template from the file: ","text_count":33,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Read the template from the file:"}]}]},{"block_type":"element","block":"k67ev76c","search_text":">>> with open('markdown_template.md') as file: ... template = file.read()","text_count":73,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('markdown_template.md') as file:\n...     template = file.read()"}]}]},{"block_type":"element","block":"k67ev76d","search_text":"Set up the context of the data to be included in the report: ","text_count":61,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up the context of the data to be included in the report:"}]}]},{"block_type":"element","block":"k67ev76e","search_text":"context = { 'date': datetime.now(), 'pmovies': ['Casablanca', 'The Sound of Music', 'Vertigo'], 'total_minutes': 404, }","text_count":119,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"context = {\n    'date': datetime.now(),\n    'pmovies': ['Casablanca', 'The Sound of Music', 'Vertigo'],\n    'total_minutes': 404,\n}"}]}]},{"block_type":"element","block":"k67ev76f","search_text":"As movies need to be displayed as bullet points, we transform the list into a suitable Markdown bullet list. Also, we store the number of movies: ","text_count":146,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"As movies need to be displayed as bullet points, we transform the list into a suitable Markdown bullet list. Also, we store the number of movies:"}]}]},{"block_type":"element","block":"k67ev76g","search_text":">>> context['num_movies'] = len(context['pmovies']) >>> context['movies'] = '\\n'.join('* {}'.format(movie) for movie in context['pmovies'])","text_count":139,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; context['num_movies'] = len(context['pmovies'])\n&gt;&gt;&gt; context['movies'] = '\\n'.join('* {}'.format(movie) for movie in context['pmovies'])"}]}]},{"block_type":"element","block":"k67ev76h","search_text":"Render the template and compile the resulting Markdown into HTML: ","text_count":66,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Render the template and compile the resulting Markdown into HTML:"}]}]},{"block_type":"element","block":"k67ev76i","search_text":">>> md_report = template.format(**context) >>> report = mistune.markdown(md_report)","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; md_report = template.format(**context)\n&gt;&gt;&gt; report = mistune.markdown(md_report)"}]}]},{"block_type":"element","block":"k67ev76j","search_text":"Finally, store the resulting report in the report.html file: ","text_count":61,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, store the resulting report in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev76k","search_text":">>> with open('report.html', 'w') as file: ... file.write(report)","text_count":65,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('report.html', 'w') as file:\n...    file.write(report)"}]}]},{"block_type":"element","block":"k67ev76l","search_text":"Open the report.html file in a browser to check the result: ","text_count":60,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.html"}]},{"block_type":"text","content":"file in a browser to check the result:"}]}]},{"block_type":"element","block":"k67ev76m","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000001.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev76n","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev76o","search_text":"Steps 2 and 3 in the How do it… section prepare the template and the data to be displayed. In Step 4, extra information is produced—the number of movies, which is derivative from the movies element. The movies element is then transformed into a valid Markdown element from a Python list. Note the new lines and the initial * , which will be rendered as a bullet point:","text_count":368,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 2 and 3 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How do it&hellip;"}]},{"block_type":"text","content":"section prepare the template and the data to be displayed. In Step 4, extra information is produced&mdash;the number of movies, which is derivative from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies"}]},{"block_type":"text","content":"element. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies"}]},{"block_type":"text","content":"element is then transformed into a valid Markdown element from a Python list. Note the new lines and the initial"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"*"}]},{"block_type":"text","content":", which will be rendered as a bullet point:"}]},{"block_type":"element","block":"k67ev76p","search_text":">>> '\\n'.join('* {}'.format(movie) for movie in context['pmovies']) '* Casablanca\\n* The Sound of Music\\n* Vertigo'","text_count":115,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; '\\n'.join('* {}'.format(movie) for movie in context['pmovies'])\n'* Casablanca\\n* The Sound of Music\\n* Vertigo'"}]}]},{"block_type":"element","block":"k67ev76q","search_text":"In Step 5, the template is generated in Markdown format. The format is very readable in this raw form, which is the strong point of Markdown:","text_count":141,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Step 5, the template is generated in Markdown format. The format is very readable in this raw form, which is the strong point of Markdown:"}]},{"block_type":"element","block":"k67ev76r","search_text":"Movies Report ======= Date: 2018-06-29 20:47:18.930655 Movies seen in the last 30 days: 3 * Casablanca * The Sound of Music * Vertigo Total minutes: 404","text_count":152,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"Movies Report\n=======\n\nDate: 2018-06-29 20:47:18.930655\n\nMovies seen in the last 30 days: 3\n\n* Casablanca\n* The Sound of Music\n* Vertigo\n\nTotal minutes: 404"}]}]},{"block_type":"element","block":"k67ev76s","search_text":"Then, using mistune , the report is transformed into HTML and stored in a file in Step 6.","text_count":89,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mistune"}]},{"block_type":"text","content":", the report is transformed into HTML and stored in a file in Step 6."}]},{"block_type":"element","block":"k67ev76t","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev76u","search_text":"Learning Markdown is extremely useful, as it is supported by many common web pages as a way of enabling text input that is easy and can render to a styled format. Some examples are GitHub, Stack Overflow, and most blogging platforms.","text_count":233,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Learning Markdown is extremely useful, as it is supported by many common web pages as a way of enabling text input that is easy and can render to a styled format. Some examples are GitHub, Stack Overflow, and most blogging platforms."}]},{"block_type":"element","block":"k67ev76v","search_text":"Tip There is actually more than one kind of Markdown. This is because the official definition was limited or ambiguous, and there was no interest in clarifying or standardizing it. This led to several implementations that are sightly different, such as GitHub Flavoured Markdown, MultiMarkdown, and CommonMark. ","text_count":311,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is actually more than one kind of Markdown. This is because the official definition was limited or ambiguous, and there was no interest in clarifying or standardizing it. This led to several implementations that are sightly different, such as GitHub Flavoured Markdown, MultiMarkdown, and CommonMark."}]}]},{"block_type":"element","block":"k67ev76w","search_text":"The text in Markdown is quite readable, but in case you need to interactively see how it will look, you can use the Dillinger online editor at https://dillinger.io/ .","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The text in Markdown is quite readable, but in case you need to interactively see how it will look, you can use the Dillinger online editor at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://dillinger.io/"},"children":[{"block_type":"text","content":"https://dillinger.io/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev76x","search_text":"Mistune full docs are available here: http://mistune.readthedocs.io/en/latest/.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Mistune"}]},{"block_type":"text","content":"full docs are available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://mistune.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"http://mistune.readthedocs.io/en/latest/."}]}]},{"block_type":"element","block":"k67ev76y","search_text":"The full Markdown syntax can be found at https://daringfireball.net/projects/markdown/syntax , and a good cheat sheet with the most-used elements at https://beegit.com/markdown-cheat-sheet.","text_count":189,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full Markdown syntax can be found at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://daringfireball.net/projects/markdown/syntax"},"children":[{"block_type":"text","content":"https://daringfireball.net/projects/markdown/syntax"}]},{"block_type":"text","content":", and a good cheat sheet with the most-used elements at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://beegit.com/markdown-cheat-sheet"},"children":[{"block_type":"text","content":"https://beegit.com/markdown-cheat-sheet."}]}]},{"block_type":"element","block":"k67ev76z","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev770","search_text":"The Creating a simple report in pain text recipe The Using templates for reports recipe ","text_count":88,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a simple report in pain text"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using templates for reports"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev771","search_text":"Writing a basic Word document","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a basic Word document"}]},{"block_type":"element","block":"k67ev772","search_text":"Microsoft Office is one of the most common pieces of software, and MS Word in particular is almost a de facto standard for documents. Generating docx documents is possible with an automated script, which will help distribute reports in a format that's easily readable in many business.","text_count":285,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Microsoft Office is one of the most common pieces of software, and MS Word in particular is almost a de facto standard for documents. Generating"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docx"}]},{"block_type":"text","content":"documents is possible with an automated script, which will help distribute reports in a format that's easily readable in many business."}]},{"block_type":"element","block":"k67ev773","search_text":"In this recipe, we will learn how to generate a full Word document.","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will learn how to generate a full Word document."}]},{"block_type":"element","block":"k67ev774","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev775","search_text":"We'll use the python-docx module to process Word documents:","text_count":59,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module to process Word documents:"}]},{"block_type":"element","block":"k67ev776","search_text":">>> echo \"python-docx==0.8.6\" >> requirements.txt >>> pip install -r requirements.txt","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"python-docx==0.8.6\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev777","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev778","search_text":"Import python-docx and datetime : ","text_count":34,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev779","search_text":">>> import docx >>> from datetime import datetime","text_count":49,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import docx\n&gt;&gt;&gt; from datetime import datetime"}]}]},{"block_type":"element","block":"k67ev77a","search_text":"Define the context with the data to be stored in the report: ","text_count":61,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"context"}]},{"block_type":"text","content":"with the data to be stored in the report:"}]}]},{"block_type":"element","block":"k67ev77b","search_text":"context = { 'date': datetime.now(), 'movies': ['Casablanca', 'The Sound of Music', 'Vertigo'], 'total_minutes': 404, }","text_count":118,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"context = {\n    'date': datetime.now(),\n    'movies': ['Casablanca', 'The Sound of Music', 'Vertigo'],\n    'total_minutes': 404,\n}"}]}]},{"block_type":"element","block":"k67ev77c","search_text":"Create a new docx document, and include a heading, Movies Report : ","text_count":67,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docx"}]},{"block_type":"text","content":"document, and include a heading,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Movies Report"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev77d","search_text":">>> document = docx.Document() >>> document.add_heading('Movies Report', 0)","text_count":75,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document = docx.Document()\n&gt;&gt;&gt; document.add_heading('Movies Report', 0)"}]}]},{"block_type":"element","block":"k67ev77e","search_text":"Add a paragraph describing the date, with the date in italics: ","text_count":63,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a paragraph describing the date, with the date in italics:"}]}]},{"block_type":"element","block":"k67ev77f","search_text":">>> paragraph = document.add_paragraph('Date: ') >>> paragraph.add_run(str(context['date'])).italic = True","text_count":106,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; paragraph = document.add_paragraph('Date: ')\n&gt;&gt;&gt; paragraph.add_run(str(context['date'])).italic = True"}]}]},{"block_type":"element","block":"k67ev77g","search_text":"Add information about the number of movies seen in a different paragraph: ","text_count":74,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add information about the number of movies seen in a different paragraph:"}]}]},{"block_type":"element","block":"k67ev77h","search_text":">>> paragraph = document.add_paragraph('Movies see in the last 30 days: ') >>> paragraph.add_run(str(len(context['movies']))).italic = True","text_count":139,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; paragraph = document.add_paragraph('Movies see in the last 30 days: ')\n&gt;&gt;&gt; paragraph.add_run(str(len(context['movies']))).italic = True"}]}]},{"block_type":"element","block":"k67ev77i","search_text":"Add each of the movies as a bullet point: ","text_count":42,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add each of the movies as a bullet point:"}]}]},{"block_type":"element","block":"k67ev77j","search_text":">>> for movie in context['movies']: ... document.add_paragraph(movie, style='List Bullet')","text_count":90,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for movie in context['movies']:\n...     document.add_paragraph(movie, style='List Bullet')"}]}]},{"block_type":"element","block":"k67ev77k","search_text":"Add the total minutes and save the file as follows: ","text_count":52,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the total minutes and save the file as follows:"}]}]},{"block_type":"element","block":"k67ev77l","search_text":">>> paragraph = document.add_paragraph('Total minutes: ') >>> paragraph.add_run(str(context['total_minutes'])).italic = True >>> document.save('word-report.docx')","text_count":162,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; paragraph = document.add_paragraph('Total minutes: ')\n&gt;&gt;&gt; paragraph.add_run(str(context['total_minutes'])).italic = True\n&gt;&gt;&gt; document.save('word-report.docx')"}]}]},{"block_type":"element","block":"k67ev77m","search_text":"Open the word-report.docx file to check it: ","text_count":44,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"word-report.docx"}]},{"block_type":"text","content":"file to check it:"}]}]},{"block_type":"element","block":"k67ev77n","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000044.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev77o","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev77p","search_text":"The basics of a Word document is that it is divided in to paragraphs, and each of the paragraphs is divided in to runs. A run is a part of a paragraph that shares the same style.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basics of a Word document is that it is divided in to paragraphs, and each of the paragraphs is divided in to runs. A run is a part of a paragraph that shares the same style."}]},{"block_type":"element","block":"k67ev77q","search_text":"Steps 1 and 2 in the How to do it… section are preparation for importing and defining the data that's going to be stored in the report.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 1 and 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section are preparation for importing and defining the data that's going to be stored in the report."}]},{"block_type":"element","block":"k67ev77r","search_text":"In Step 3, the document is created and a heading with the proper title is added. This automatically styles the text.","text_count":116,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Step 3, the document is created and a heading with the proper title is added. This automatically styles the text."}]},{"block_type":"element","block":"k67ev77s","search_text":"Dealing with paragraphs is introduced in Step 4. A new paragraph is created based on the introduced text with the default style, but new runs can be added to change it. Here, we added the first run with the text Date: , and then another run is added with the specific time and labelled as italic .","text_count":297,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Dealing with paragraphs is introduced in Step 4. A new paragraph is created based on the introduced text with the default style, but new runs can be added to change it. Here, we added the first run with the text"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Date:"}]},{"block_type":"text","content":", and then another run is added with the specific time and labelled as"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"italic"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev77t","search_text":"In Steps 5 and 6, we see information about the movies. The first part stores the number of movies, in a similar way to Step 4. After that, the movies are added to the report one by one, and the style is set up like bullet points.","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In Steps 5 and 6, we see information about the movies. The first part stores the number of movies, in a similar way to Step 4. After that, the movies are added to the report one by one, and the style is set up like bullet points."}]},{"block_type":"element","block":"k67ev77u","search_text":"Finally, Step 7 stores the total run time of all movies, in a similar way to Step 4, and stores the document in a file.","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, Step 7 stores the total run time of all movies, in a similar way to Step 4, and stores the document in a file."}]},{"block_type":"element","block":"k67ev77v","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev77w","search_text":"If you need to introduce extra lines in the document for formatting purposes, add empty paragraphs. ","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to introduce extra lines in the document for formatting purposes, add empty paragraphs.&nbsp;"}]},{"block_type":"element","block":"k67ev77x","search_text":"Due to the way that the MS Word format works, there's no easy way of determining how many pages is going to have. You may need to run some tests on sizes, especially if you're generating the text to store dynamically.","text_count":217,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Due to the way that the MS Word format works, there's no easy way of determining how many pages is going to have. You may need to run some tests on sizes, especially if you're generating the text to store dynamically."}]},{"block_type":"element","block":"k67ev77y","search_text":"Tip Even if you generate docx files, having MS Office is not necessary. There are other applications that can open and deal with these files, including free alternatives such as LibreOffice. ","text_count":191,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Even if you generate"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docx"}]},{"block_type":"text","content":"files, having MS Office is not necessary. There are other applications that can open and deal with these files, including free alternatives such as LibreOffice."}]}]},{"block_type":"element","block":"k67ev77z","search_text":"The whole python-docx documentation is available here: https://python-docx.readthedocs.io/en/latest/.","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The whole"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"documentation is available here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/."}]}]},{"block_type":"element","block":"k67ev780","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev781","search_text":"The Styling a Word document recipe The Generating structure in Word documents recipe ","text_count":85,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Styling a Word document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating structure in Word documents"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev782","search_text":"Styling a Word document","text_count":23,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Styling a Word document"}]},{"block_type":"element","block":"k67ev783","search_text":"A Word document can be very plain, but we can also add styling to help properly understand the displayed data. Word has a set of predefined styles that can be used to variate the document and highlight the important parts of it.","text_count":228,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A Word document can be very plain, but we can also add styling to help properly understand the displayed data. Word has a set of predefined styles that can be used to variate the document and highlight the important parts of it."}]},{"block_type":"element","block":"k67ev784","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev785","search_text":"We'll use the python-docx module to process Word documents:","text_count":59,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module to process Word documents:"}]},{"block_type":"element","block":"k67ev786","search_text":">>> echo \"python-docx==0.8.6\" >> requirements.txt >>> pip install -r requirements.txt","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"python-docx==0.8.6\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev787","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev788","search_text":"Import the python-docx module: ","text_count":31,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev789","search_text":">>> import docx","text_count":15,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import docx"}]}]},{"block_type":"element","block":"k67ev78a","search_text":"Create a new document: ","text_count":23,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new document:"}]}]},{"block_type":"element","block":"k67ev78b","search_text":">>> document = docx.Document()","text_count":30,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document = docx.Document()"}]}]},{"block_type":"element","block":"k67ev78c","search_text":"Add a paragraph that highlights some words in different ways, Italics , bold, and underline: ","text_count":93,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a paragraph that highlights some words in different ways,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Italics"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"bold,"}]},{"block_type":"text","content":"and underline:"}]}]},{"block_type":"element","block":"k67ev78d","search_text":">>> p = document.add_paragraph('This shows different kinds of emphasis: ') >>> p.add_run('bold').bold = True >>> p.add_run(', ') <docx.text.run.Run object at ...> >>> p.add_run('italics').italic = True >>> p.add_run(' and ') <docx.text.run.Run object at ...> >>> p.add_run('underline').underline = True >>> p.add_run('.') <docx.text.run.Run object at ...>","text_count":355,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; p = document.add_paragraph('This shows different kinds of emphasis: ')\n&gt;&gt;&gt; p.add_run('bold').bold = True\n&gt;&gt;&gt; p.add_run(', ')\n&lt;docx.text.run.Run object at ...&gt;\n&gt;&gt;&gt; p.add_run('italics').italic = True\n&gt;&gt;&gt; p.add_run(' and ')\n&lt;docx.text.run.Run object at ...&gt;\n&gt;&gt;&gt; p.add_run('underline').underline = True\n&gt;&gt;&gt; p.add_run('.')\n&lt;docx.text.run.Run object at ...&gt;"}]}]},{"block_type":"element","block":"k67ev78e","search_text":"Create some paragraphs, styling them with default styles, such as List Bullet , List Number , or Quote : ","text_count":105,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create some paragraphs, styling them with default styles, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"List Bullet"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"List Number"}]},{"block_type":"text","content":",&nbsp; or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Quote"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev78f","search_text":">>> document.add_paragraph('a few', style='List Bullet') <docx.text.paragraph.Paragraph object at ...> >>> document.add_paragraph('bullet', style='List Bullet') <docx.text.paragraph.Paragraph object at ...> >>> document.add_paragraph('points', style='List Bullet') <docx.text.paragraph.Paragraph object at ...> >>> >>> document.add_paragraph('Or numbered', style='List Number') <docx.text.paragraph.Paragraph object at ...> >>> document.add_paragraph('that will', style='List Number') <docx.text.paragraph.Paragraph object at ...> >>> document.add_paragraph('that keep', style='List Number') <docx.text.paragraph.Paragraph object at ...> >>> document.add_paragraph('count', style='List Number') <docx.text.paragraph.Paragraph object at ...> >>> >>> document.add_paragraph('And finish with a quote', style='Quote') <docx.text.paragraph.Paragraph object at 0x10d2336d8>","text_count":867,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.add_paragraph('a few', style='List Bullet')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt; document.add_paragraph('bullet', style='List Bullet')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt; document.add_paragraph('points', style='List Bullet')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; document.add_paragraph('Or numbered', style='List Number')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt; document.add_paragraph('that will', style='List Number')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt; document.add_paragraph('that keep', style='List Number')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt; document.add_paragraph('count', style='List Number')\n&lt;docx.text.paragraph.Paragraph object at ...&gt;\n&gt;&gt;&gt; \n&gt;&gt;&gt; document.add_paragraph('And finish with a quote', style='Quote')\n&lt;docx.text.paragraph.Paragraph object at 0x10d2336d8&gt;"}]}]},{"block_type":"element","block":"k67ev78g","search_text":"Create a paragraph in a different font and size. We'll use Arial font and a point size of 25 . The paragraph will be aligned to the right: ","text_count":139,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a paragraph in a different font and size. We'll use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Arial"}]},{"block_type":"text","content":"&nbsp;font and a point size of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"25"}]},{"block_type":"text","content":". The paragraph will be aligned to the right:"}]}]},{"block_type":"element","block":"k67ev78h","search_text":">>> from docx.shared import Pt >>> from docx.enum.text import WD_ALIGN_PARAGRAPH >>> p = document.add_paragraph('This paragraph will have a manual styling and right alignment') >>> p.runs[0].font.name = 'Arial' >>> p.runs[0].font.size = Pt(25) >>> p.alignment = WD_ALIGN_PARAGRAPH.RIGHT","text_count":286,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from docx.shared import Pt\n&gt;&gt;&gt; from docx.enum.text import WD_ALIGN_PARAGRAPH\n&gt;&gt;&gt; p = document.add_paragraph('This paragraph will have a manual styling and right alignment')\n&gt;&gt;&gt; p.runs[0].font.name = 'Arial'\n&gt;&gt;&gt; p.runs[0].font.size = Pt(25)\n&gt;&gt;&gt; p.alignment = WD_ALIGN_PARAGRAPH.RIGHT"}]}]},{"block_type":"element","block":"k67ev78i","search_text":"Save the document: ","text_count":19,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the document:"}]}]},{"block_type":"element","block":"k67ev78j","search_text":">>> document.save('word-report-style.docx')","text_count":43,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.save('word-report-style.docx')"}]}]},{"block_type":"element","block":"k67ev78k","search_text":"Open the word-report-style.docx document to verify its content: ","text_count":64,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"word-report-style.docx"}]},{"block_type":"text","content":"document to verify its content:"}]}]},{"block_type":"element","block":"k67ev78l","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000067.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev78m","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev78n","search_text":"After creating the document in Step 1, Step 2 from the How to do it… section adds a paragraph that has several runs. In Word, a paragraph can contain multiple runs, which are parts that can have different styles. In general, any format change related to individual words will be applied to a run, while a change that affects paragraphs will be applied to the paragraph.","text_count":369,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After creating the document in Step 1, Step 2 from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section adds a paragraph that has several runs. In Word, a paragraph can contain multiple runs, which are parts that can have different styles. In general, any format change related to individual words will be applied to a run, while a change that affects paragraphs will be applied to the paragraph."}]},{"block_type":"element","block":"k67ev78o","search_text":"Each of the runs are created, by default, with the Normal style. Any attribute of .bold , .italic , or .underline can be changed to True to set up if the run should be in a proper style or a combination. A value of False will deactivate it, while a None value will leave it as the default.","text_count":289,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the runs are created, by default, with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Normal"}]},{"block_type":"text","content":"style. Any attribute of&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".bold"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".italic"}]},{"block_type":"text","content":", or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".underline"}]},{"block_type":"text","content":"can be changed to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":"to set up if the run should be in a proper style or a combination. A value of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"False"}]},{"block_type":"text","content":"will deactivate it, while a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"value will leave it as the default."}]},{"block_type":"element","block":"k67ev78p","search_text":"Tip Note that the proper word in this protocol is italic , and not italics . Setting the property to italics won't have any effect, but won't display an error either. ","text_count":167,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the proper word in this protocol is"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"italic"}]},{"block_type":"text","content":", and not"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"italics"}]},{"block_type":"text","content":". Setting the property to italics won't have any effect, but won't display an error either.&nbsp;"}]}]},{"block_type":"element","block":"k67ev78q","search_text":"Step 4 shows how to apply some of the default styles for paragraphs, in this case to show bullet points, numbered lists, and quotes. There are more styles, and they can be checked in this page of the documentation: https://python-docx.readthedocs.io/en/latest/user/styles-understanding.html?highlight=List%20Bullet#paragraph-styles-in-default-template . Try to find out which ones work best for your document.","text_count":409,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 shows how to apply some of the default styles for paragraphs, in this case to show bullet points, numbered lists, and quotes. There are more styles, and they can be checked in this page of the documentation:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/user/styles-understanding.html?highlight=List%20Bullet#paragraph-styles-in-default-template"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/user/styles-understanding.html?highlight=List%20Bullet#paragraph-styles-in-default-template"}]},{"block_type":"text","content":". Try to find out which ones work best for your document."}]},{"block_type":"element","block":"k67ev78r","search_text":"The .font property of a run is shown in Step 5. This allows you to manually set up a specific font and size. Note that the size needs to be specified using the proper Pt (points) object.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".font"}]},{"block_type":"text","content":"property of a run is shown in Step 5. This allows you to manually set up a specific font and size. Note that the size needs to be specified using the proper"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Pt"}]},{"block_type":"text","content":"(points) object."}]},{"block_type":"element","block":"k67ev78s","search_text":"The alignment of the paragraph is set up in the paragraph object, and uses a constant to define whether it is left, right, center, or justified. All alignment options can be found here: https://python-docx.readthedocs.io/en/latest/api/enum/WdAlignParagraph.html.","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The alignment of the paragraph is set up in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"paragraph"}]},{"block_type":"text","content":"object, and uses a constant to define whether it is left, right, center, or justified. All alignment options can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/api/enum/WdAlignParagraph.html"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/api/enum/WdAlignParagraph.html."}]}]},{"block_type":"element","block":"k67ev78t","search_text":"Finally, step 7 saves the file so it's stored in the file system.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, step 7 saves the file so it's stored in the file system."}]},{"block_type":"element","block":"k67ev78u","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev78v","search_text":"The font attribute can also be used to set up more properties of the text, such as small caps, shadow, emboss, or strikethrough. The whole range of possibilities is shown here: https://python-docx.readthedocs.io/en/latest/api/text.html#docx.text.run.Font.","text_count":255,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"font"}]},{"block_type":"text","content":"attribute can also be used to set up more properties of the text, such as small caps, shadow, emboss, or strikethrough. The whole range of possibilities is shown here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/api/text.html#docx.text.run.Font"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/api/text.html#docx.text.run.Font."}]}]},{"block_type":"element","block":"k67ev78w","search_text":"Another available option is to change the color of the text. Note the run can be any of the previously generated runs:","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another available option is to change the color of the text. Note the run can be any of the previously generated runs:"}]},{"block_type":"element","block":"k67ev78x","search_text":">>> from docx.shared import RGBColor >>> DARK_BLUE = RGBColor.from_string('1b3866') >>> run.font.color.rbg = DARK_BLUE","text_count":118,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from docx.shared import RGBColor\n&gt;&gt;&gt; DARK_BLUE = RGBColor.from_string('1b3866')\n&gt;&gt;&gt; run.font.color.rbg = DARK_BLUE"}]}]},{"block_type":"element","block":"k67ev78y","search_text":"The color can be described in the usual hex format from a string. Try to define all the colors to use to ensure they are all consistent, and limit yourself to a maximum of three colors in a report to not overcharge it.","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The color can be described in the usual hex format from a string. Try to define all the colors to use to ensure they are all consistent, and limit yourself to a maximum of three colors in a report to not overcharge it."}]},{"block_type":"element","block":"k67ev78z","search_text":"Tip You can use an online color picker, such as this one: https://www.w3schools.com/colors/colors_picker.asp . Remember to not use the # at the beginning. If you need to generate a palette, it's a good idea to use tools such as https://coolors.co/ to generate good combinations. ","text_count":279,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can use an online color picker, such as this one:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.w3schools.com/colors/colors_picker.asp"},"children":[{"block_type":"text","content":"https://www.w3schools.com/colors/colors_picker.asp"}]},{"block_type":"text","content":". Remember to not use the # at the beginning. If you need to generate a palette, it's a good idea to use tools such as&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://coolors.co/"},"children":[{"block_type":"text","content":"https://coolors.co/"}]},{"block_type":"text","content":"&nbsp;to generate good combinations."}]}]},{"block_type":"element","block":"k67ev790","search_text":"The whole python-docx documentation is available here: https://python-docx.readthedocs.io/en/latest/.","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The whole&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"&nbsp;documentation is available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/."}]}]},{"block_type":"element","block":"k67ev791","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev792","search_text":"The Writing a basic Word document recipe The Generating structure in Word documents recipe ","text_count":91,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a basic Word document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating structure in Word documents"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev793","search_text":"Generating structure in Word documents","text_count":38,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Generating structure in Word documents"}]},{"block_type":"element","block":"k67ev794","search_text":"To create proper professional reports, they need to have the proper structure. An MS Word document doesn't have the concept of a page , as it works in paragraphs, but we can introduce breaks and sections to properly divide a document.","text_count":234,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To create proper professional reports, they need to have the proper structure. An MS Word document doesn't have the concept of"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a page"}]},{"block_type":"text","content":", as it works in paragraphs, but we can introduce breaks and sections to properly divide a document."}]},{"block_type":"element","block":"k67ev795","search_text":"We'll see in this recipe how to create a structured Word document.","text_count":66,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll see in this recipe how to create a structured Word document."}]},{"block_type":"element","block":"k67ev796","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev797","search_text":"We'll use the python-docx module to process Word documents:","text_count":59,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module to process Word documents:"}]},{"block_type":"element","block":"k67ev798","search_text":">>> echo \"python-docx==0.8.6\" >> requirements.txt >>> pip install -r requirements.txt","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"python-docx==0.8.6\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev799","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev79a","search_text":"Import the python-docx module: ","text_count":31,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev79b","search_text":">>> import docx","text_count":15,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import docx"}]}]},{"block_type":"element","block":"k67ev79c","search_text":"Create a new document: ","text_count":23,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new document:"}]}]},{"block_type":"element","block":"k67ev79d","search_text":">>> document = docx.Document()","text_count":30,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document = docx.Document()"}]}]},{"block_type":"element","block":"k67ev79e","search_text":"Create a paragraph that has a line break: ","text_count":42,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a paragraph that has a line break:"}]}]},{"block_type":"element","block":"k67ev79f","search_text":">>> p = document.add_paragraph('This is the start of the paragraph') >>> run = p.add_run() >>> run.add_break(docx.text.run.WD_BREAK.LINE) >>> p.add_run('And now this in a different line') >>> p.add_run(\". Even if it's on the same paragraph.\")","text_count":242,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; p = document.add_paragraph('This is the start of the paragraph')\n&gt;&gt;&gt; run = p.add_run()\n&gt;&gt;&gt; run.add_break(docx.text.run.WD_BREAK.LINE)\n&gt;&gt;&gt; p.add_run('And now this in a different line')\n&gt;&gt;&gt; p.add_run(\". Even if it's on the same paragraph.\")"}]}]},{"block_type":"element","block":"k67ev79g","search_text":"Create a page break and write a paragraph: ","text_count":43,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a page break and write a paragraph:"}]}]},{"block_type":"element","block":"k67ev79h","search_text":">>> document.add_page_break() >>> document.add_paragraph('This appears in a new page')","text_count":86,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.add_page_break()\n&gt;&gt;&gt; document.add_paragraph('This appears in a new page')"}]}]},{"block_type":"element","block":"k67ev79i","search_text":"Create a new section, which will be on landscape pages: ","text_count":56,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new section, which will be on landscape pages:"}]}]},{"block_type":"element","block":"k67ev79j","search_text":">>> section = document.add_section( docx.enum.section.WD_SECTION.NEW_PAGE) >>> section.orientation = docx.enum.section.WD_ORIENT.LANDSCAPE >>> section.page_height, section.page_width = section.page_width, section.page_height >>> document.add_paragraph('This is part of a new landscape section')","text_count":294,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; section = document.add_section( docx.enum.section.WD_SECTION.NEW_PAGE)\n&gt;&gt;&gt; section.orientation = docx.enum.section.WD_ORIENT.LANDSCAPE\n&gt;&gt;&gt; section.page_height, section.page_width = section.page_width, section.page_height\n&gt;&gt;&gt; document.add_paragraph('This is part of a new landscape section')"}]}]},{"block_type":"element","block":"k67ev79k","search_text":"Create another section, reverting to portrait orientation: ","text_count":59,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another section, reverting to portrait orientation:"}]}]},{"block_type":"element","block":"k67ev79l","search_text":">>> section = document.add_section( docx.enum.section.WD_SECTION.NEW_PAGE) >>> section.orientation = docx.enum.section.WD_ORIENT.PORTRAIT >>> section.page_height, section.page_width = section.page_width, section.page_height >>> document.add_paragraph('In this section, recover the portrait orientation')","text_count":303,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; section = document.add_section( docx.enum.section.WD_SECTION.NEW_PAGE)\n&gt;&gt;&gt; section.orientation = docx.enum.section.WD_ORIENT.PORTRAIT\n&gt;&gt;&gt; section.page_height, section.page_width = section.page_width, section.page_height\n&gt;&gt;&gt; document.add_paragraph('In this section, recover the portrait orientation')"}]}]},{"block_type":"element","block":"k67ev79m","search_text":"Save the document: ","text_count":19,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the document:"}]}]},{"block_type":"element","block":"k67ev79n","search_text":">>> document.save('word-report-structure.docx')","text_count":47,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.save('word-report-structure.docx')"}]}]},{"block_type":"element","block":"k67ev79o","search_text":"Check the result by opening the document and checking the resulting sections: ","text_count":78,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the result by&nbsp;opening the document and checking the resulting sections:"}]}]},{"block_type":"element","block":"k67ev79p","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000062.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev79q","search_text":"Check the new page:","text_count":19,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the new page:"}]},{"block_type":"element","block":"k67ev79r","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000057.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev79s","search_text":"Check for a landscape section:","text_count":30,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check for a landscape section:"}]},{"block_type":"element","block":"k67ev79t","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000028.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev79u","search_text":"Then, go back to portrait orientation:","text_count":38,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, go back to portrait orientation:"}]},{"block_type":"element","block":"k67ev79v","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000047.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev79w","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev79x","search_text":"After creating the document in Step 2 in the How to do it… section, we add a paragraph for the first section. Notice that the document starts with a section. The paragraph introduces a line break in the middle of the paragraph.","text_count":227,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After creating the document in Step 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, we add a paragraph for the first section. Notice that the document starts with a section. The paragraph introduces a line break in the middle of the paragraph."}]},{"block_type":"element","block":"k67ev79y","search_text":"Tip There is a small difference between a line break in a paragraph and a new paragraph, though for most uses it is quite similar. Try to experiment with them. ","text_count":160,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There is a small difference between a line break in a paragraph and a new paragraph, though for most uses it is quite similar. Try to experiment with them."}]}]},{"block_type":"element","block":"k67ev79z","search_text":"A page break is introduced in Step 3, without changing the section.","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A page break is introduced in Step 3, without changing the section."}]},{"block_type":"element","block":"k67ev7a0","search_text":"Step 4 creates a new section on a new page. Step 5 also changes the orientation of the page to landscape. In Step 6, a new section is introduced and the orientation reverts to portrait.","text_count":185,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 creates a new section on a new page. Step 5 also changes the orientation of the page to landscape. In Step 6, a new section is introduced and the orientation reverts to portrait."}]},{"block_type":"element","block":"k67ev7a1","search_text":"Note Note that when changing the orientation, we also need to swap the width and height. Each new section inherits the properties from the previous one, so this swapping needs to happen in Step 6 as well. ","text_count":205,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that when changing the orientation, we also need to swap the width and height. Each new section inherits the properties from the previous one, so this swapping needs to happen in Step 6 as well."}]}]},{"block_type":"element","block":"k67ev7a2","search_text":"Finally, the document is saved in Step 6.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the document is saved in Step 6."}]},{"block_type":"element","block":"k67ev7a3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7a4","search_text":"A section mandates page composition, including the orientation and size of the page. The size of the page can be changed using the length options, such as Inches or Cm :","text_count":169,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A section mandates page composition, including the orientation and size of the page. The size of the page can be changed using the length options, such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Inches"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Cm"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev7a5","search_text":">>> from docx.shared import Inches, Cm >>> section.page_height = Inches(10) >>> section.page_width = Cm(20)","text_count":107,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from docx.shared import Inches, Cm \n&gt;&gt;&gt; section.page_height = Inches(10)\n&gt;&gt;&gt; section.page_width = Cm(20)"}]}]},{"block_type":"element","block":"k67ev7a6","search_text":"The page margins can also be defined in the same way:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The page margins can also be defined in the same way:"}]},{"block_type":"element","block":"k67ev7a7","search_text":">>> section.left_margin = Inches(1.5) >>> section.right_margin = Cm(2.81) >>> section.top_margin = Inches(1) >>> section.bottom_margin = Cm(2.54)","text_count":145,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; section.left_margin = Inches(1.5)\n&gt;&gt;&gt; section.right_margin = Cm(2.81)\n&gt;&gt;&gt; section.top_margin = Inches(1)\n&gt;&gt;&gt; section.bottom_margin = Cm(2.54)"}]}]},{"block_type":"element","block":"k67ev7a8","search_text":"Sections can also be forced to start not only on the next page, but on the next odd page, which will look better when printing on two sides:","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Sections can also be forced to start not only on the next page, but on the next odd page, which will look better when printing on two sides:"}]},{"block_type":"element","block":"k67ev7a9","search_text":">>> document.add_section( docx.enum.section.WD_SECTION.ODD_PAGE)","text_count":64,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.add_section( docx.enum.section.WD_SECTION.ODD_PAGE)"}]}]},{"block_type":"element","block":"k67ev7aa","search_text":"The whole python-docx documentation is available here: https://python-docx.readthedocs.io/en/latest/.","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The whole&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"&nbsp;documentation is available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/."}]}]},{"block_type":"element","block":"k67ev7ab","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7ac","search_text":"The Writing a basic Word document recipe The Styling a Word document recipe ","text_count":76,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a basic Word document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Styling a Word document"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7ad","search_text":"Adding pictures to Word documents","text_count":33,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Adding pictures to Word documents"}]},{"block_type":"element","block":"k67ev7ae","search_text":"Word documents are capable of adding images to show graphs or any other kind of extra information. Being able to add an image is a great way of creating rich reports.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Word documents are capable of adding images to show graphs or any other kind of extra information. Being able to add an image is a great way of creating rich reports."}]},{"block_type":"element","block":"k67ev7af","search_text":"We'll see in this recipe how to include an existing file in a Word document.","text_count":76,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll see in this recipe how to include an existing file in a Word document."}]},{"block_type":"element","block":"k67ev7ag","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7ah","search_text":"We'll use the python-docx module to process Word documents:","text_count":59,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module to process Word documents:"}]},{"block_type":"element","block":"k67ev7ai","search_text":"$ echo \"python-docx==0.8.6\" >> requirements.txt $ pip install -r requirements.txt","text_count":81,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"python-docx==0.8.6\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7aj","search_text":"We need to prepare an image to include in the document. We'll use the file in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a1.jpg , which shows a view of Dublin. You can download it on the command line, like this:","text_count":282,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to prepare an image to include in the document. We'll use the file&nbsp;in GitHub at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a1.jpg"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a1.jpg"}]},{"block_type":"text","content":", which shows a view of Dublin. You can download it on the command line, like this:"}]},{"block_type":"element","block":"k67ev7ak","search_text":"$ wget https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a1.jpg","text_count":117,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ wget https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter04/images/photo-dublin-a1.jpg"}]}]},{"block_type":"element","block":"k67ev7al","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7am","search_text":"Import the python-docx module: ","text_count":31,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev7an","search_text":">>> import docx","text_count":15,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import docx"}]}]},{"block_type":"element","block":"k67ev7ao","search_text":"Create a new document: ","text_count":23,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new document:"}]}]},{"block_type":"element","block":"k67ev7ap","search_text":">>> document = docx.Document()","text_count":30,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document = docx.Document()"}]}]},{"block_type":"element","block":"k67ev7aq","search_text":"Create a paragraph with some text: ","text_count":35,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a paragraph with some text:"}]}]},{"block_type":"element","block":"k67ev7ar","search_text":">>> document.add_paragraph('This is a document that includes a picture taken in Dublin')","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.add_paragraph('This is a document that includes a picture taken in Dublin')"}]}]},{"block_type":"element","block":"k67ev7as","search_text":"Add the image: ","text_count":15,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the image:"}]}]},{"block_type":"element","block":"k67ev7at","search_text":">>> image = document.add_picture('photo-dublin-a1.jpg')","text_count":55,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image = document.add_picture('photo-dublin-a1.jpg')"}]}]},{"block_type":"element","block":"k67ev7au","search_text":"Scale the image properly to fit on the page ( 14 x 10 ): ","text_count":57,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Scale the image properly to fit on the page ("},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"14&nbsp;x 10"}]},{"block_type":"text","content":"):"}]}]},{"block_type":"element","block":"k67ev7av","search_text":">>> from docx.shared import Cm >>> image.width = Cm(14) >>> image.height = Cm(10)","text_count":81,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from docx.shared import Cm\n&gt;&gt;&gt; image.width = Cm(14)\n&gt;&gt;&gt; image.height = Cm(10)"}]}]},{"block_type":"element","block":"k67ev7aw","search_text":"The image has been added to a new paragraph. Align it to the center and add descriptive text: ","text_count":94,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The image has been added to a new paragraph. Align it to the center and add descriptive text:"}]}]},{"block_type":"element","block":"k67ev7ax","search_text":">>> paragraph = document.paragraphs[-1] >>> from docx.enum.text import WD_ALIGN_PARAGRAPH >>> paragraph.alignment = WD_ALIGN_PARAGRAPH.CENTER >>> paragraph.add_run().add_break() >>> paragraph.add_run('A picture of Dublin')","text_count":222,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; paragraph = document.paragraphs[-1]\n&gt;&gt;&gt; from docx.enum.text import WD_ALIGN_PARAGRAPH\n&gt;&gt;&gt; paragraph.alignment = WD_ALIGN_PARAGRAPH.CENTER\n&gt;&gt;&gt; paragraph.add_run().add_break()\n&gt;&gt;&gt; paragraph.add_run('A picture of Dublin')"}]}]},{"block_type":"element","block":"k67ev7ay","search_text":"Add a new paragraph with extra text, and save the document: ","text_count":60,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a new paragraph with extra text, and save the document:"}]}]},{"block_type":"element","block":"k67ev7az","search_text":">>> document.add_paragraph('Keep adding text after the image') <docx.text.paragraph.Paragraph object at XXX> >>> document.save('report.docx')","text_count":141,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.add_paragraph('Keep adding text after the image')\n&lt;docx.text.paragraph.Paragraph object at XXX&gt;\n&gt;&gt;&gt; document.save('report.docx')"}]}]},{"block_type":"element","block":"k67ev7b0","search_text":"Check the result: ","text_count":18,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the result:"}]}]},{"block_type":"element","block":"k67ev7b1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000058.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7b2","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7b3","search_text":"The first few steps (Step 1 to Step 3 in the How to do it… section) create the document and add some text.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first few steps (Step 1 to Step 3 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section) create the document and add some text."}]},{"block_type":"element","block":"k67ev7b4","search_text":"Step 4 adds the image from the file, and Step 5 resizes it into a manageable size. By default, the image is too big.","text_count":116,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 adds the image from the file, and Step 5 resizes it into a manageable size. By default, the image is too big."}]},{"block_type":"element","block":"k67ev7b5","search_text":"Tip Keep in mind the proportion of the image when resizing. Note that you can also use other measures such as Inch , defined in shared as well. ","text_count":144,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Keep in mind the proportion of the image when resizing. Note that you can also use other measures such as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Inch"}]},{"block_type":"text","content":", defined in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"shared"}]},{"block_type":"text","content":"as well."}]}]},{"block_type":"element","block":"k67ev7b6","search_text":"Inserting the image creates a new paragraph as well, so the paragraph can be styled to align the image or to add more text, such as a reference or description. The paragraph is obtained in Step 6 through the document.paragraph property. The last paragraph is obtained and styled properly, aligning it to the center. A new line and a run with descriptive text are added.","text_count":369,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Inserting the image creates a new paragraph as well, so the paragraph can be styled to align the image or to add more text, such as a reference or description. The paragraph is obtained in Step 6 through the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"document.paragraph"}]},{"block_type":"text","content":"property. The last paragraph is obtained and styled properly, aligning it to the center. A new line and a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"run"}]},{"block_type":"text","content":"with descriptive text are added."}]},{"block_type":"element","block":"k67ev7b7","search_text":"Step 7 adds extra text after the image and saves the document.","text_count":62,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 7 adds extra text after the image and saves the document."}]},{"block_type":"element","block":"k67ev7b8","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7b9","search_text":"The size of the image can be changed, but as we saw before, the proportion of the image needs to be calculated if that changes. The resizing may end up not being perfect if done by approximation, as in Step 5 from the How to do it… section.","text_count":240,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The size of the image can be changed, but as we saw before, the proportion of the image needs to be calculated if that changes. The resizing may end up not being perfect if done by approximation, as in Step 5 from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k67ev7ba","search_text":"Tip Notice that the image does not have a perfect ratio of 10:14. It should instead be 10:13.33. For an image, that may be good enough, but for data that is more sensitive to proportion changes, such as a chart, it may require extra care. ","text_count":239,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the image does not have a perfect ratio of 10:14. It should instead be 10:13.33. For an image, that may be good enough, but for data that is more sensitive&nbsp;to proportion changes, such as a chart, it may require extra care."}]}]},{"block_type":"element","block":"k67ev7bb","search_text":"To obtain the proper relation, divide the height by the width and then scale properly:","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To obtain the proper relation, divide the height by the width and then scale properly:"}]},{"block_type":"element","block":"k67ev7bc","search_text":">>> image = document.add_picture('photo-dublin-a1.jpg') >>> image.height / image.width 0.75 >>> RELATION = image.height / image.width >>> image.width = Cm(12) >>> image.height = Cm(12 * RELATION)","text_count":195,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image = document.add_picture('photo-dublin-a1.jpg')\n&gt;&gt;&gt; image.height / image.width\n0.75\n&gt;&gt;&gt; RELATION = image.height / image.width\n&gt;&gt;&gt; image.width = Cm(12)\n&gt;&gt;&gt; image.height = Cm(12 * RELATION)"}]}]},{"block_type":"element","block":"k67ev7bd","search_text":"If you need to transform the values to a particular size, you can use the cm , inches , mm , or pt attributes:","text_count":110,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to transform the values to a particular size, you can use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cm"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"inches"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mm"}]},{"block_type":"text","content":", or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pt"}]},{"block_type":"text","content":"attributes:"}]},{"block_type":"element","block":"k67ev7be","search_text":">>> image.width.cm 12.0 >>> image.width.mm 120.0 >>> image.width.inches 4.724409448818897 >>> image.width.pt 340.15748031496065","text_count":127,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; image.width.cm\n12.0\n&gt;&gt;&gt; image.width.mm\n120.0\n&gt;&gt;&gt; image.width.inches\n4.724409448818897\n&gt;&gt;&gt; image.width.pt\n340.15748031496065"}]}]},{"block_type":"element","block":"k67ev7bf","search_text":"The whole python-docx documentation is available here: https://python-docx.readthedocs.io/en/latest/.","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The whole&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"python-docx"}]},{"block_type":"text","content":"&nbsp;documentation is available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://python-docx.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://python-docx.readthedocs.io/en/latest/."}]}]},{"block_type":"element","block":"k67ev7bg","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7bh","search_text":"The Writing a basic Word document recipe The Styling a Word document recipe The Generating structure in Word documents recipe ","text_count":126,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a basic Word document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Styling a Word document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating structure in Word documents"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7bi","search_text":"Writing a simple PDF document","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a simple PDF document"}]},{"block_type":"element","block":"k67ev7bj","search_text":"PDF files are a common way of sharing reports. The main characteristic of PDF documents is that they define exactly how the document is going to look, and they are read-only after being produced, which makes them very straightforward to share.","text_count":243,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"PDF files are a common way of sharing reports. The main characteristic of PDF documents is that they define exactly how the document is going to look, and they are read-only after being produced, which makes them very straightforward to share."}]},{"block_type":"element","block":"k67ev7bk","search_text":"In this recipe, we'll see how to write a simple PDF report using Python.","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to write a simple PDF report using Python."}]},{"block_type":"element","block":"k67ev7bl","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7bm","search_text":"We'll use the fpdf module to create PDF documents:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fpdf"}]},{"block_type":"text","content":"module to create PDF documents:"}]},{"block_type":"element","block":"k67ev7bn","search_text":">>> echo \"fpdf==1.7.2\" >> requirements.txt >>> pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"fpdf==1.7.2\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7bo","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7bp","search_text":"Import the fpdf module: ","text_count":24,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fpdf"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev7bq","search_text":">>> import fpdf","text_count":15,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import fpdf"}]}]},{"block_type":"element","block":"k67ev7br","search_text":"Create a document: ","text_count":19,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a document:"}]}]},{"block_type":"element","block":"k67ev7bs","search_text":">>> document = fpdf.FPDF()","text_count":26,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document = fpdf.FPDF()"}]}]},{"block_type":"element","block":"k67ev7bt","search_text":"Define the font and color for a title, and add the first page: ","text_count":63,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the font and color for a title, and add the first page:"}]}]},{"block_type":"element","block":"k67ev7bu","search_text":">>> document.set_font('Times', 'B', 14) >>> document.set_text_color(19, 83, 173) >>> document.add_page()","text_count":104,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.set_font('Times', 'B', 14)\n&gt;&gt;&gt; document.set_text_color(19, 83, 173)\n&gt;&gt;&gt; document.add_page()"}]}]},{"block_type":"element","block":"k67ev7bv","search_text":"Write the title of the document: ","text_count":33,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write the title of the document:"}]}]},{"block_type":"element","block":"k67ev7bw","search_text":">>> document.cell(0, 5, 'PDF test document') >>> document.ln()","text_count":62,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.cell(0, 5, 'PDF test document')\n&gt;&gt;&gt; document.ln()"}]}]},{"block_type":"element","block":"k67ev7bx","search_text":"Write a long paragraph: ","text_count":24,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write a long paragraph:"}]}]},{"block_type":"element","block":"k67ev7by","search_text":">>> document.set_font('Times', '', 12) >>> document.set_text_color(0) >>> document.multi_cell(0, 5, 'This is an example of a long paragraph. ' * 10) [] >>> document.ln()","text_count":169,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.set_font('Times', '', 12)\n&gt;&gt;&gt; document.set_text_color(0)\n&gt;&gt;&gt; document.multi_cell(0, 5, 'This is an example of a long paragraph. ' * 10)\n[]\n&gt;&gt;&gt; document.ln()"}]}]},{"block_type":"element","block":"k67ev7bz","search_text":"Write another long paragraph: ","text_count":30,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write another long paragraph:"}]}]},{"block_type":"element","block":"k67ev7c0","search_text":">>> document.multi_cell(0, 5, 'Another long paragraph. Lorem ipsum dolor sit amet, consectetur adipiscing elit.' * 20) ","text_count":119,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.multi_cell(0, 5, 'Another long paragraph. Lorem ipsum dolor sit amet, consectetur adipiscing elit.' * 20)"}]}]},{"block_type":"element","block":"k67ev7c1","search_text":"Save the document: ","text_count":19,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the document:"}]}]},{"block_type":"element","block":"k67ev7c2","search_text":">>> document.output('report.pdf')","text_count":33,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.output('report.pdf')"}]}]},{"block_type":"element","block":"k67ev7c3","search_text":"Check the report.pdf document: ","text_count":31,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.pdf"}]},{"block_type":"text","content":"document:"}]}]},{"block_type":"element","block":"k67ev7c4","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000035.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7c5","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7c6","search_text":"The fpdf module creates a PDF document and allows us to write in it.","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fpdf"}]},{"block_type":"text","content":"module creates a PDF document and allows us to write in it."}]},{"block_type":"element","block":"k67ev7c7","search_text":"Tip Due to the peculiarities of a PDF, the best way to think about it is to imagine a cursor writing in the document and moving to the next position, similar to a typewriter. ","text_count":175,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Due to the peculiarities of a PDF, the best way to think about it is to imagine a cursor writing in the document and moving to the next position, similar to a typewriter."}]}]},{"block_type":"element","block":"k67ev7c8","search_text":"The first operations are to specify the font and size to use, and then add the first page. This is done in Step 3. The first font is in bold (second argument, 'B' ) and in a bigger font than the rest of the document to serve as a title. The color is also set up with .set_text_color , in RGB components.","text_count":303,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The first operations are to specify the font and size to use, and then add the first page. This is done in Step 3. The first font is in bold (second argument,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'B'"}]},{"block_type":"text","content":") and in a bigger font than the rest of the document to serve as a title.&nbsp;The color is also set up with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".set_text_color"}]},{"block_type":"text","content":", in RGB components."}]},{"block_type":"element","block":"k67ev7c9","search_text":"Tip The text can also be styled in italics with I and underlined with U . You can combine them, so BI will produce text in bold and italic. ","text_count":140,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The text can also be styled in italics with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"I"}]},{"block_type":"text","content":"and underlined with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"U"}]},{"block_type":"text","content":". You can combine them, so"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BI"}]},{"block_type":"text","content":"will produce text in bold and italic."}]}]},{"block_type":"element","block":"k67ev7ca","search_text":"The .cell call creates a box of text with the specified text. The first couple of parameters are the width and height. Width 0 uses the whole space up to the right margin. Height 5 (mm) is adequate for a size 12 font. The call to .ln introduces a new line.","text_count":256,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".cell"}]},{"block_type":"text","content":"call creates a box of text with the specified text. The first couple of parameters are the width and height. Width"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"uses the whole space up to the right margin. Height"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"5"}]},{"block_type":"text","content":"(mm) is&nbsp;adequate&nbsp;for a size"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"12"}]},{"block_type":"text","content":"font. The call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ln"}]},{"block_type":"text","content":"introduces a new line."}]},{"block_type":"element","block":"k67ev7cb","search_text":"To write a multiline paragraph, we use the .multi_cell method. Its parameters are the same as .cell . Two paragraphs are written in Steps 5 and 6. Notice the change in font before, to distinguish the title from the body of the report. The .set_text_color is called with a single argument to set up the color in grayscale. In this case, it is in black.","text_count":351,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To write a multiline paragraph, we use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".multi_cell"}]},{"block_type":"text","content":"method. Its parameters are the same as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".cell"}]},{"block_type":"text","content":". Two paragraphs are written in Steps 5 and 6. Notice the change in font before, to distinguish the title from the body of the report. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".set_text_color"}]},{"block_type":"text","content":"is called with a single argument to set up the color in grayscale. In this case, it is in black."}]},{"block_type":"element","block":"k67ev7cc","search_text":"Tip Using .cell for long text will make it go over the margin and off the page. Use it only for text that will fit in a single line. You can find the size of a string with .get_string_width . ","text_count":192,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".cell"}]},{"block_type":"text","content":"for long text will make it go over the margin and off the page. Use it only for text that will fit in a single line. You can find the size of a string with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".get_string_width"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev7cd","search_text":"The document is saved to disk in Step 7.","text_count":40,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The document is saved to disk in Step 7."}]},{"block_type":"element","block":"k67ev7ce","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7cf","search_text":"Pages are added automatically is a multi_cell operation occupies all space available in a page. Calling .add_page will move to a new page.","text_count":138,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pages are added automatically is a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"multi_cell"}]},{"block_type":"text","content":"operation occupies all space available in a page. Calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".add_page"}]},{"block_type":"text","content":"will move to a new page."}]},{"block_type":"element","block":"k67ev7cg","search_text":"You can use any of the default fonts ( Courier , Helvetica , and Times ), or add an extra font using .add_font . Check the documentation for more details: http://pyfpdf.readthedocs.io/en/latest/reference/add_font/index.html.","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can use any of the default fonts ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Courier"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Helvetica"}]},{"block_type":"text","content":", and&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Times"}]},{"block_type":"text","content":"), or add an extra font using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".add_font"}]},{"block_type":"text","content":". Check the documentation for more details:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pyfpdf.readthedocs.io/en/latest/reference/add_font/index.html"},"children":[{"block_type":"text","content":"http://pyfpdf.readthedocs.io/en/latest/reference/add_font/index.html."}]}]},{"block_type":"element","block":"k67ev7ch","search_text":"Tip The fonts Symbol and ZapfDingbats are also available, but are to be used with symbols. This could be useful if you need some extra symbols, but test before using them. The rest of the default fonts should include your necessities for serif, sans serif, and fixed-width cases. In PDFs, fonts used will be embedded in the document, so they'll be displayed properly. ","text_count":368,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The fonts"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Symbol"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ZapfDingbats"}]},{"block_type":"text","content":"are also available, but are to be used with symbols. This could be useful if you need some extra symbols, but test before using them. The rest of the default fonts should include your&nbsp;necessities for serif, sans serif, and fixed-width cases. In PDFs, fonts used will be embedded in the document, so they'll be displayed properly."}]}]},{"block_type":"element","block":"k67ev7ci","search_text":"Keep the height consistent through out the document, at least between text of the same size. Define a constant you're comfortable with, and use it through out the text:","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Keep the height consistent through&nbsp;out the document, at least between text of the same size. Define a constant you're comfortable with, and use it through out the text:"}]},{"block_type":"element","block":"k67ev7cj","search_text":">>> BODY_TEXT_HEIGHT = 5 >>> document.multi_cell(0, BODY_TEXT_HEIGHT, text)","text_count":75,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; BODY_TEXT_HEIGHT = 5\n&gt;&gt;&gt; document.multi_cell(0, BODY_TEXT_HEIGHT, text)"}]}]},{"block_type":"element","block":"k67ev7ck","search_text":"By default, the text will be justified, but that can be changed. Use the align argument with J (justified), C (center), R (right), or L (left). For example, this produces text aligned to the left:","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By default, the text will be justified, but that can be changed. Use the align argument with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"J"}]},{"block_type":"text","content":"(justified),"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"C"}]},{"block_type":"text","content":"(center),"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"R"}]},{"block_type":"text","content":"&nbsp;(right), or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"L"}]},{"block_type":"text","content":"(left). For example, this produces text aligned to the left:"}]},{"block_type":"element","block":"k67ev7cl","search_text":">>> document.multi_cell(0, BODY_TEXT_HEIGHT, text, align='L')","text_count":61,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; document.multi_cell(0, BODY_TEXT_HEIGHT, text, align='L')"}]}]},{"block_type":"element","block":"k67ev7cm","search_text":"The full FPDF documentation can be found here: http://pyfpdf.readthedocs.io/en/latest/index.html.","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full FPDF documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pyfpdf.readthedocs.io/en/latest/index.html"},"children":[{"block_type":"text","content":"http://pyfpdf.readthedocs.io/en/latest/index.html."}]}]},{"block_type":"element","block":"k67ev7cn","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7co","search_text":"Structuring a PDF Aggregating PDF reports Watermarking and encrypting a PDF ","text_count":76,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Structuring a PDF"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF reports"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Watermarking and encrypting a PDF"}]}]}]},{"block_type":"element","block":"k67ev7cp","search_text":"Structuring a PDF","text_count":17,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Structuring a PDF"}]},{"block_type":"element","block":"k67ev7cq","search_text":"Some elements can be automatically generated when creating a PDF to add a better look and structure to your elements. In this recipe, we'll see how to add a header and footer, and how to create links to other elements.","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Some elements can be automatically generated when creating a PDF to add a better look and structure to your elements. In this recipe, we'll see how to add a header and footer, and how to create links to other elements."}]},{"block_type":"element","block":"k67ev7cr","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7cs","search_text":"We'll use the fpdf module to create PDF documents:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fpdf"}]},{"block_type":"text","content":"module to create PDF documents:"}]},{"block_type":"element","block":"k67ev7ct","search_text":">>> echo \"fpdf==1.7.2\" >> requirements.txt >>> pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; echo \"fpdf==1.7.2\" &gt;&gt; requirements.txt\n&gt;&gt;&gt; pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7cu","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7cv","search_text":"The structuring_pdf.py script is available in GitHub here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/structuring_pdf.py . The most relevant bits are displayed here: ","text_count":207,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"structuring_pdf.py"}]},{"block_type":"text","content":"script is available in GitHub here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/structuring_pdf.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/structuring_pdf.py"}]},{"block_type":"text","content":". The most relevant bits are displayed here:"}]}]},{"block_type":"element","block":"k67ev7cw","search_text":"import fpdf from random import randint class StructuredPDF(fpdf.FPDF): LINE_HEIGHT = 5 def footer(self): self.set_y(-15) self.set_font('Times', 'I', 8) page_number = 'Page {number}/{{nb}}'.format(number=self.page_no()) self.cell(0, self.LINE_HEIGHT, page_number, 0, 0, 'R') def chapter(self, title, paragraphs): self.add_page() link = self.title_text(title) page = self.page_no() for paragraph in paragraphs: self.multi_cell(0, self.LINE_HEIGHT, paragraph) self.ln() return link, page def title_text(self, title): self.set_font('Times', 'B', 15) self.cell(0, self.LINE_HEIGHT, title) self.set_font('Times', '', 12) self.line(10, 17, 110, 17) link = self.add_link() self.set_link(link) self.ln() self.ln() return link def get_full_line(self, head, tail, fill): ...","text_count":763,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import fpdf\nfrom random import randint\n\nclass StructuredPDF(fpdf.FPDF):\n    LINE_HEIGHT = 5\n\n    def footer(self):\n        self.set_y(-15)\n        self.set_font('Times', 'I', 8)\n        page_number = 'Page {number}/{{nb}}'.format(number=self.page_no())\n        self.cell(0, self.LINE_HEIGHT, page_number, 0, 0, 'R')\n\n    def chapter(self, title, paragraphs):\n        self.add_page()\n        link = self.title_text(title)\n        page = self.page_no()\n        for paragraph in paragraphs:\n            self.multi_cell(0, self.LINE_HEIGHT, paragraph)\n            self.ln()\n\n        return link, page\n\n    def title_text(self, title):\n        self.set_font('Times', 'B', 15)\n        self.cell(0, self.LINE_HEIGHT, title)\n        self.set_font('Times', '', 12)\n        self.line(10, 17, 110, 17)\n        link = self.add_link()\n        self.set_link(link)\n        self.ln()\n        self.ln()\n\n        return link\n\n    def get_full_line(self, head, tail, fill):\n        ..."}]}]},{"block_type":"element","block":"k67ev7cx","search_text":"def toc(self, links): self.add_page() self.title_text('Table of contents') self.set_font('Times', 'I', 12) for title, page, link in links: line = self.get_full_line(title, page, '.') self.cell(0, self.LINE_HEIGHT, line, link=link) self.ln() LOREM_IPSUM = ... def main(): document = StructuredPDF() document.alias_nb_pages() links = [] num_chapters = randint(5, 40) for index in range(1, num_chapters): chapter_title = 'Chapter {}'.format(index) num_paragraphs = randint(10, 15) link, page = document.chapter(chapter_title, [LOREM_IPSUM] * num_paragraphs) links.append((chapter_title, page, link)) document.toc(links) document.output('report.pdf')","text_count":646,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def toc(self, links):\n        self.add_page()\n        self.title_text('Table of contents')\n        self.set_font('Times', 'I', 12)\n\n        for title, page, link in links:\n            line = self.get_full_line(title, page, '.')\n            self.cell(0, self.LINE_HEIGHT, line, link=link)\n            self.ln()\n\n\nLOREM_IPSUM = ...\n\ndef main():\n    document = StructuredPDF()\n    document.alias_nb_pages()\n    links = []\n    num_chapters = randint(5, 40)\n    for index in range(1, num_chapters):\n        chapter_title = 'Chapter {}'.format(index)\n        num_paragraphs = randint(10, 15)\n        link, page = document.chapter(chapter_title,\n                                      [LOREM_IPSUM] * num_paragraphs)\n        links.append((chapter_title, page, link))\n\n    document.toc(links)\n    document.output('report.pdf')"}]}]},{"block_type":"element","block":"k67ev7cy","search_text":"Run the script, and it will generate the report.pdf file, which contains some chapters and a table of contents. Note that it generates some randomness, so the specific numbers will vary each time you run it: ","text_count":208,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script, and it will generate the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.pdf"}]},{"block_type":"text","content":"file, which contains some chapters and a table of contents. Note that it generates some randomness, so the specific numbers will vary each time you run it:"}]}]},{"block_type":"element","block":"k67ev7cz","search_text":"$ python3 structuring_pdf.py","text_count":28,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python3 structuring_pdf.py"}]}]},{"block_type":"element","block":"k67ev7d0","search_text":"Check the result. Here is a sample: ","text_count":36,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the result. Here is a sample:"}]}]},{"block_type":"element","block":"k67ev7d1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000011.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7d2","search_text":"Check the table of contents at the end:","text_count":39,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the table of contents at the end:"}]},{"block_type":"element","block":"k67ev7d3","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000029.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7d4","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7d5","search_text":"Let's take a look at each of the elements of the script.","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's take a look at each of the elements of the script."}]},{"block_type":"element","block":"k67ev7d6","search_text":"StructuredPDF defines a class that inherits from FPDF . This is useful to overwrite the footer method, which creates a footer each time a page is created. It also helps simplify the code in main .","text_count":196,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"StructuredPDF"}]},{"block_type":"text","content":"defines a class that inherits from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FPDF"}]},{"block_type":"text","content":". This is useful to overwrite the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"footer"}]},{"block_type":"text","content":"method, which creates a footer each time a page is created. It also helps simplify the code in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7d7","search_text":"The main function creates the document. It starts the document, and adds each of the chapters, collecting their link information. Finally, it calls the toc method to generate a table of contents using the link information.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function creates the document. It starts the document, and adds each of the chapters, collecting their link information. Finally, it calls the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"toc"}]},{"block_type":"text","content":"method to generate a table of contents using the link information."}]},{"block_type":"element","block":"k67ev7d8","search_text":"Note The text to be stored is generated by multiplying the LOREM_IPSUM text, which is a placeholder. ","text_count":101,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The text to be stored is generated by multiplying the LOREM_IPSUM text, which is a placeholder."}]}]},{"block_type":"element","block":"k67ev7d9","search_text":"The chapter method first prints a title section, and then adds each of the paragraphs defined. It collects the page number on which the chapter starts and the link returned by the title_text method to return them.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"chapter"}]},{"block_type":"text","content":"method first prints a title section, and then adds each of the paragraphs defined. It collects the page number on which the chapter starts and the link returned by the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"title_text"}]},{"block_type":"text","content":"method to return them."}]},{"block_type":"element","block":"k67ev7da","search_text":"The title_text method writes the text in bigger and bolder text. Then, it adds a line to separate the title from the body of the chapter. It generates and sets a link object pointing to the current page in the following lines:","text_count":226,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"title_text"}]},{"block_type":"text","content":"method writes the text in bigger and bolder text. Then, it adds a line to separate the title from the body of the chapter. It generates and sets a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"link"}]},{"block_type":"text","content":"object pointing to the current page in the following lines:"}]},{"block_type":"element","block":"k67ev7db","search_text":"link = self.add_link() self.set_link(link)","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"link = self.add_link()\n self.set_link(link)"}]}]},{"block_type":"element","block":"k67ev7dc","search_text":"This link will be used in the table of contents to add a clickable element that points to this chapter.","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This link will be used in the table of contents to add a clickable element that points to this chapter."}]},{"block_type":"element","block":"k67ev7dd","search_text":"The footer method automatically adds a footer to each page. It sets a smaller font, and it adds text with the current page (obtained through page_no ) and uses {nb} , which will be replaced with the total number of pages.","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"footer"}]},{"block_type":"text","content":"method automatically adds a footer to each page. It sets a smaller font, and it adds text with the current page (obtained through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"page_no"}]},{"block_type":"text","content":") and uses"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{nb}"}]},{"block_type":"text","content":", which will be replaced with the total number of pages."}]},{"block_type":"element","block":"k67ev7de","search_text":"Note The call to alias_nb_pages in main ensures {nb} is replaced when the document is generated. ","text_count":97,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The call to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"alias_nb_pages"}]},{"block_type":"text","content":"in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"&nbsp;ensures&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"{nb}"}]},{"block_type":"text","content":"&nbsp;is replaced when the document is generated."}]}]},{"block_type":"element","block":"k67ev7df","search_text":"Finally, the table of contents is generated in the toc method. It writes the title and adds all the referenced links that have been collected as the link, page, and chapter name, which is all the info required.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the table of contents is generated in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"toc"}]},{"block_type":"text","content":"method. It writes the title and adds all the referenced links that have been collected as the link, page, and chapter name, which is all the info required."}]},{"block_type":"element","block":"k67ev7dg","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7dh","search_text":"Notice the use of randint to add a bit of randomness to the document. This call, available in Python's standard library, returns a number between the defined maximum and minimum. Both are included. ","text_count":198,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice the use of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"randint"}]},{"block_type":"text","content":"to add a bit of randomness to the document. This call, available in Python's standard library, returns a number between the defined maximum and minimum. Both are included.&nbsp;"}]},{"block_type":"element","block":"k67ev7di","search_text":"The get_full_line method generates a properly sized line for the table of contents. It takes a start (the name of the chapter) and end (the page number), and adds the number of fill characters (dots) until the line has the proper width (120 mm).","text_count":245,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get_full_line"}]},{"block_type":"text","content":"method generates a properly sized line for the table of contents. It takes a start (the name of the chapter) and end (the page number), and adds the number of fill characters (dots) until the line has the proper width (120 mm)."}]},{"block_type":"element","block":"k67ev7dj","search_text":"To calculate the size of the text, the script calls get_string_width , which takes into account the font and the size.","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To calculate the size of the text, the script calls&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get_string_width"}]},{"block_type":"text","content":", which takes into account the font and the size."}]},{"block_type":"element","block":"k67ev7dk","search_text":"Link objects can be used to point to a specific page, instead of the current one, and also not to the start of the page; use set_link(link, y=place, page=num_page) . Check the documentation at http://pyfpdf.readthedocs.io/en/latest/reference/set_link/index.html.","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Link objects can be used to point to a specific page, instead of the current one, and also not to the start of the page; use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"set_link(link, y=place, page=num_page)"}]},{"block_type":"text","content":". Check the documentation at"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pyfpdf.readthedocs.io/en/latest/reference/set_link/index.html"},"children":[{"block_type":"text","content":"http://pyfpdf.readthedocs.io/en/latest/reference/set_link/index.html."}]}]},{"block_type":"element","block":"k67ev7dl","search_text":"Tip Adjusting some of the elements can take a certain degree of trial and error, for example, to position the line. A sightly longer or shorter line can be a matter of taste. Don't be afraid to experiment and check until it produces the desired effect. ","text_count":253,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Adjusting some of the elements can take a certain degree of trial and error, for example, to position the line. A sightly longer or shorter line can be a matter of taste.&nbsp;Don't be afraid to experiment and check until it produces the desired effect."}]}]},{"block_type":"element","block":"k67ev7dm","search_text":"The full FPDF documentation can be found here: http://pyfpdf.readthedocs.io/en/latest/index.html.","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full FPDF&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://pyfpdf.readthedocs.io/en/latest/index.html"},"children":[{"block_type":"text","content":"http://pyfpdf.readthedocs.io/en/latest/index.html."}]}]},{"block_type":"element","block":"k67ev7dn","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7do","search_text":"The Writing a simple PDF document recipe The Aggregating PDF reports recipe The Watermarking and encrypting a PDF recipe ","text_count":121,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a simple PDF document"}]},{"block_type":"text","content":"recipe&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF reports"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Watermarking and encrypting a PDF"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7dp","search_text":"Aggregating PDF reports","text_count":23,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF reports"}]},{"block_type":"element","block":"k67ev7dq","search_text":"In this recipe, we'll see how to mix two PDFs into the same one. This will allow us to combine reports into a bigger one.","text_count":121,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to mix two PDFs into the same one. This will allow us to combine reports into a bigger one."}]},{"block_type":"element","block":"k67ev7dr","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7ds","search_text":"We'll use the PyPDF2 module. Pillow and pdf2image are also dependencies used by the scripts:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":"module."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Pillow"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdf2image"}]},{"block_type":"text","content":"are also dependencies used by the scripts:"}]},{"block_type":"element","block":"k67ev7dt","search_text":"$ echo \"PyPDF2==1.26.0\" >> requirements.txt $ echo \"pdf2image==0.1.14\" >> requirements.txt $ echo \"Pillow==5.1.0\" >> requirements.txt $ pip install -r requirements.txt","text_count":167,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"PyPDF2==1.26.0\" &gt;&gt; requirements.txt\n$ echo \"pdf2image==0.1.14\" &gt;&gt; requirements.txt\n$ echo \"Pillow==5.1.0\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7du","search_text":"For pdf2image to properly work, it needs to install pdftoppm , so check here for instructions on how to install it for different platforms: https://github.com/Belval/pdf2image#first-you-need-pdftoppm.","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdf2image"}]},{"block_type":"text","content":"to properly work, it needs to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdftoppm"}]},{"block_type":"text","content":", so check here for instructions on how to install it for different platforms:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/Belval/pdf2image#first-you-need-pdftoppm"},"children":[{"block_type":"text","content":"https://github.com/Belval/pdf2image#first-you-need-pdftoppm."}]}]},{"block_type":"element","block":"k67ev7dv","search_text":"We need two PDFs to combine them. For this recipe, we'll use two PDFs: a report.pdf file generated by the structuring_pdf.py script, available in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/structuring_pdf.py , and another ( report2.pdf ) after watermarking it through the following command:","text_count":341,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need two PDFs to combine them. For this recipe, we'll use two PDFs: a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.pdf"}]},{"block_type":"text","content":"file generated by the&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"structuring_pdf.py"}]},{"block_type":"text","content":"script, available in GitHub at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/structuring_pdf.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/structuring_pdf.py"}]},{"block_type":"text","content":", and another ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report2.pdf"}]},{"block_type":"text","content":") after watermarking it through the following command:"}]},{"block_type":"element","block":"k67ev7dw","search_text":"$ python watermarking_pdf.py report.pdf -u automate_user -o report2.pdf","text_count":71,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python watermarking_pdf.py report.pdf -u automate_user -o report2.pdf"}]}]},{"block_type":"element","block":"k67ev7dx","search_text":"This uses the watermarking script watermarking_pdf.py , available in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/watermarking_pdf.py .","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This uses the watermarking script&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"watermarking_pdf.py"}]},{"block_type":"text","content":", available in GitHub at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/watermarking_pdf.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/watermarking_pdf.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7dy","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7dz","search_text":"Import PyPDF2 and create the output PDF: ","text_count":41,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":"and create the output PDF:"}]}]},{"block_type":"element","block":"k67ev7e0","search_text":">>> import PyPDF2 >>> output_pdf = PyPDF2.PdfFileWriter()","text_count":57,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import PyPDF2\n&gt;&gt;&gt; output_pdf = PyPDF2.PdfFileWriter()"}]}]},{"block_type":"element","block":"k67ev7e1","search_text":"Read the first file and create a reader: ","text_count":41,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Read the first file and create a reader:"}]}]},{"block_type":"element","block":"k67ev7e2","search_text":">>> file1 = open('report.pdf', 'rb') >>> pdf1 = PyPDF2.PdfFileReader(file1)","text_count":75,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file1 = open('report.pdf', 'rb')\n&gt;&gt;&gt; pdf1 = PyPDF2.PdfFileReader(file1)"}]}]},{"block_type":"element","block":"k67ev7e3","search_text":"Append all pages to the output PDF: ","text_count":36,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Append all pages to the output PDF:"}]}]},{"block_type":"element","block":"k67ev7e4","search_text":">>> output_pdf.appendPagesFromReader(pdf1)","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; output_pdf.appendPagesFromReader(pdf1)"}]}]},{"block_type":"element","block":"k67ev7e5","search_text":"Open the second file, create a reader, and append the pages to the output PDF: ","text_count":79,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the second file, create a reader, and append the pages to the output PDF:"}]}]},{"block_type":"element","block":"k67ev7e6","search_text":">>> file2 = open('report2.pdf', 'rb') >>> pdf2 = PyPDF2.PdfFileReader(file2) >>> output_pdf.appendPagesFromReader(pdf2)","text_count":119,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file2 = open('report2.pdf', 'rb')\n&gt;&gt;&gt; pdf2 = PyPDF2.PdfFileReader(file2)\n&gt;&gt;&gt; output_pdf.appendPagesFromReader(pdf2)"}]}]},{"block_type":"element","block":"k67ev7e7","search_text":"Create the output file and save it: ","text_count":36,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the output file and save it:"}]}]},{"block_type":"element","block":"k67ev7e8","search_text":">>> with open('result.pdf', 'wb') as out_file: ... output_pdf.write(out_file)","text_count":77,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('result.pdf', 'wb') as out_file:\n...     output_pdf.write(out_file)"}]}]},{"block_type":"element","block":"k67ev7e9","search_text":"Close the open files: ","text_count":22,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Close the open files:"}]}]},{"block_type":"element","block":"k67ev7ea","search_text":">>> file1.close() >>> file2.close()","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; file1.close()\n&gt;&gt;&gt; file2.close()"}]}]},{"block_type":"element","block":"k67ev7eb","search_text":"Check the output file and confirm that it contains both PDFs pages. ","text_count":68,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the output file and confirm that it contains both PDFs pages."}]}]},{"block_type":"element","block":"k67ev7ec","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7ed","search_text":"PyPDF2 allows us to create a reader for each input file, and add all its pages to a newly created PDF writer. Note the files are opened in binary mode ( rb ).","text_count":158,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":"allows us to create a reader for each input file, and add all its pages to a newly created PDF writer. Note the files are opened in binary mode ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"rb"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev7ee","search_text":"Tip The input files need to remain open until the result is saved. This is due to the way the copy of the pages works. If the file is open, the resulting file can be stored as an empty file. ","text_count":191,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The input files need to remain open until the result is saved. This is due to the way the copy of the pages works. If the file is open, the resulting file can be stored as an empty file."}]}]},{"block_type":"element","block":"k67ev7ef","search_text":"The PDF writer is finally saved into a new file. Notice that the file needs to be open to write in binary mode ( wb ).","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The PDF writer is finally saved into a new file. Notice that the file needs to be open to write in binary mode ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"wb"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev7eg","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7eh","search_text":".appendPagesFromReader is very convenient for adding all pages, but it's also possible to add a number of pages one by one with .addPage . For example, to add the third page, the code would look like this:","text_count":205,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".appendPagesFromReader"}]},{"block_type":"text","content":"is very convenient for adding all pages, but it's also possible to add a number of pages one by one with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".addPage"}]},{"block_type":"text","content":". For example, to add the third page, the code would look like this:"}]},{"block_type":"element","block":"k67ev7ei","search_text":">>> page = pdf1.getPage(3) >>> output_pdf.addPage(page)","text_count":55,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; page = pdf1.getPage(3)\n&gt;&gt;&gt; output_pdf.addPage(page)"}]}]},{"block_type":"element","block":"k67ev7ej","search_text":"The full documentation for PyPDF2 is here: https://pythonhosted.org/PyPDF2/.","text_count":76,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full documentation for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":"is here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pythonhosted.org/PyPDF2/"},"children":[{"block_type":"text","content":"https://pythonhosted.org/PyPDF2/."}]}]},{"block_type":"element","block":"k67ev7ek","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7el","search_text":"The Writing a simple PDF document recipe The Structuring a PDF recipe The Watermarking and encrypting a PDF recipe ","text_count":115,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a simple PDF document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Structuring a PDF"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Watermarking and encrypting a PDF"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7em","search_text":"Watermarking and encrypting a PDF","text_count":33,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Watermarking and encrypting a PDF"}]},{"block_type":"element","block":"k67ev7en","search_text":"PDF files have some interesting security measures to limit the distribution of a document. We can encrypt the content, making it necessary to know a password in order to be able to read it. We'll see as well how to add a watermark to label the document clearly as not for public distribution and, if leaked, to know its origin.","text_count":327,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"PDF files have some interesting security measures to limit the distribution of a document. We can encrypt the content, making it necessary to know a password in order to be able to read it. We'll see as well how to add a watermark to label the document clearly as not for public distribution and, if leaked, to know its origin."}]},{"block_type":"element","block":"k67ev7eo","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7ep","search_text":"We'll use the pdf2image module to transform PDF documents to PIL images. Pillow is a prerequisite. We'll also use PyPDF2 :","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdf2image"}]},{"block_type":"text","content":"module to transform PDF documents to PIL images.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Pillow"}]},{"block_type":"text","content":"is a prerequisite. We'll also use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev7eq","search_text":"$ echo \"pdf2image==0.1.14\" >> requirements.txt $ echo \"Pillow==5.1.0\" >> requirements.txt $ echo \"PyPDF2==1.26.0\" >> requirements.txt $ pip install -r requirements.txt","text_count":167,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"pdf2image==0.1.14\" &gt;&gt; requirements.txt\n$ echo \"Pillow==5.1.0\" &gt;&gt; requirements.txt\n$ echo \"PyPDF2==1.26.0\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7er","search_text":"For pdf2image to properly work, it needs to install pdftoppm , so check here for instructions on how to install it for different platforms: https://github.com/Belval/pdf2image#first-you-need-pdftoppm.","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdf2image"}]},{"block_type":"text","content":"to properly work, it needs to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdftoppm"}]},{"block_type":"text","content":", so check here for instructions on how to install it for different platforms:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/Belval/pdf2image#first-you-need-pdftoppm"},"children":[{"block_type":"text","content":"https://github.com/Belval/pdf2image#first-you-need-pdftoppm."}]}]},{"block_type":"element","block":"k67ev7es","search_text":"We also need a PDF file to watermark and encrypt. We'll use a report.pdf file generated by the structuring_pdf.py script, available in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/chapter5/structuring_pdf.py .","text_count":248,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also need a PDF file to watermark and encrypt. We'll use a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.pdf"}]},{"block_type":"text","content":"&nbsp;file generated by the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"structuring_pdf.py"}]},{"block_type":"text","content":"script, available in GitHub at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/chapter5/structuring_pdf.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/chapter5/structuring_pdf.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7et","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7eu","search_text":"The script, watermarking_pdf.py , is available in GitHub here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/watermarking_pdf.py . The most relevant bits are displayed here: ","text_count":212,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;script,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"watermarking_pdf.py"}]},{"block_type":"text","content":", is available in GitHub here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/watermarking_pdf.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter05/watermarking_pdf.py"}]},{"block_type":"text","content":". The most relevant bits are displayed here:"}]}]},{"block_type":"element","block":"k67ev7ev","search_text":"def encrypt(out_pdf, password): output_pdf = PyPDF2.PdfFileWriter() in_file = open(out_pdf, \"rb\") input_pdf = PyPDF2.PdfFileReader(in_file) output_pdf.appendPagesFromReader(input_pdf) output_pdf.encrypt(password) # Intermediate file with open(INTERMEDIATE_ENCRYPT_FILE, \"wb\") as out_file: output_pdf.write(out_file) in_file.close() # Rename the intermediate file os.rename(INTERMEDIATE_ENCRYPT_FILE, out_pdf) def create_watermark(watermarked_by): mask = Image.new('L', WATERMARK_SIZE, 0) draw = ImageDraw.Draw(mask) font = ImageFont.load_default() text = 'WATERMARKED BY {}\\n{}'.format(watermarked_by, datetime.now()) draw.multiline_text((0, 100), text, 55, font=font) watermark = Image.new('RGB', WATERMARK_SIZE) watermark.putalpha(mask) watermark = watermark.resize((1950, 1950)) watermark = watermark.rotate(45) # Crop to only the watermark bbox = watermark.getbbox() watermark = watermark.crop(bbox) return watermark def apply_watermark(watermark, in_pdf, out_pdf): # Transform from PDF to images images = convert_from_path(in_pdf) ... # Paste the watermark in each page for image in images: image.paste(watermark, position, watermark) # Save the resulting PDF images[0].save(out_pdf, save_all=True, append_images=images[1:])","text_count":1229,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def encrypt(out_pdf, password):\n    output_pdf = PyPDF2.PdfFileWriter()\n\n    in_file = open(out_pdf, \"rb\")\n    input_pdf = PyPDF2.PdfFileReader(in_file)\n    output_pdf.appendPagesFromReader(input_pdf)\n    output_pdf.encrypt(password)\n\n    # Intermediate file\n    with open(INTERMEDIATE_ENCRYPT_FILE, \"wb\") as out_file:\n        output_pdf.write(out_file)\n\n    in_file.close()\n\n    # Rename the intermediate file\n    os.rename(INTERMEDIATE_ENCRYPT_FILE, out_pdf)\n\n\ndef create_watermark(watermarked_by):\n    mask = Image.new('L', WATERMARK_SIZE, 0)\n    draw = ImageDraw.Draw(mask)\n    font = ImageFont.load_default()\n    text = 'WATERMARKED BY {}\\n{}'.format(watermarked_by, datetime.now())\n    draw.multiline_text((0, 100), text, 55, font=font)\n\n    watermark = Image.new('RGB', WATERMARK_SIZE)\n    watermark.putalpha(mask)\n    watermark = watermark.resize((1950, 1950))\n    watermark = watermark.rotate(45)\n    # Crop to only the watermark\n    bbox = watermark.getbbox()\n    watermark = watermark.crop(bbox)\n\n    return watermark\n\ndef apply_watermark(watermark, in_pdf, out_pdf):\n    # Transform from PDF to images\n    images = convert_from_path(in_pdf)\n    ...\n    # Paste the watermark in each page\n    for image in images:\n        image.paste(watermark, position, watermark)\n\n    # Save the resulting PDF\n    images[0].save(out_pdf, save_all=True, append_images=images[1:])"}]}]},{"block_type":"element","block":"k67ev7ew","search_text":"Watermark the PDF file with the following command: ","text_count":51,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Watermark the PDF file with the following command:"}]}]},{"block_type":"element","block":"k67ev7ex","search_text":"$ python watermarking_pdf.py report.pdf -u automate_user -o out.pdf Creating a watermark Watermarking the document $","text_count":116,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python watermarking_pdf.py report.pdf -u automate_user -o out.pdf\nCreating a watermark\nWatermarking the document\n$"}]}]},{"block_type":"element","block":"k67ev7ey","search_text":"Check that the document added a watermark with automate_user and a timestamp to all pages of out.pdf : ","text_count":103,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check that the document added a watermark with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"automate_user"}]},{"block_type":"text","content":"and a timestamp to all pages of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"out.pdf"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7ez","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000041.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7f0","search_text":"Watermark and encrypt with the following command. Note that encrypting may take a little while: ","text_count":96,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Watermark and encrypt with the following command. Note that encrypting may take a little while:"}]}]},{"block_type":"element","block":"k67ev7f1","search_text":"$ python watermarking_pdf.py report.pdf -u automate_user -o out.pdf -p secretpassword Creating a watermark Watermarking the document Encrypting the document $","text_count":158,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python watermarking_pdf.py report.pdf -u automate_user -o out.pdf -p secretpassword\nCreating a watermark\nWatermarking the document\nEncrypting the document\n$"}]}]},{"block_type":"element","block":"k67ev7f2","search_text":"Open the resulting out.pdf , and check that it requires you to input the secretpassword password. The timestamp will also be new. ","text_count":130,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the resulting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"out.pdf"}]},{"block_type":"text","content":", and check that it requires you to input the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"secretpassword"}]},{"block_type":"text","content":"password. The timestamp will also be new."}]}]},{"block_type":"element","block":"k67ev7f3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7f4","search_text":"The watermarking_pdf.py script first obtains the parameters from the command line using argparse , and then passes it to a main function that calls the other three functions, create_watermark , apply_watermark and, if a password is used, encrypt .","text_count":247,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"watermarking_pdf.py"}]},{"block_type":"text","content":"script first obtains the parameters from the command line using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"argparse"}]},{"block_type":"text","content":", and then passes it to a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function that calls the other three functions,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_watermark"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"apply_watermark"}]},{"block_type":"text","content":"and, if a password is used,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"encrypt"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7f5","search_text":"create_watermark generates an image with the watermark. It uses the Pillow Image class to create a grey image (mode L ) and draw the text. Then, this image gets applied as an alpha channel on a new image, making the image semi-transparent, so it will show the text to watermark.","text_count":278,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_watermark"}]},{"block_type":"text","content":"generates an image with the watermark. It uses the Pillow"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Image"}]},{"block_type":"text","content":"class to create a grey image (mode"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"L"}]},{"block_type":"text","content":") and draw the text. Then, this image gets applied as an alpha channel on a new image, making the image semi-transparent, so it will show the text to watermark."}]},{"block_type":"element","block":"k67ev7f6","search_text":"Note The alpha channel makes fully transparent anything in white (color 0) and fully opaque anything in black (color 255). In this case, the background is white and the color of the text is 55, making it semi-transparent. ","text_count":222,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The alpha channel makes fully transparent anything in white (color 0) and fully opaque anything in black (color 255). In this case, the background is white and the color of the text is 55, making it semi-transparent."}]}]},{"block_type":"element","block":"k67ev7f7","search_text":"The image is then rotated 45 degrees and cropped to reduce the transparent background that may have appeared. This centers the image and allows for better positioning.","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The image is then rotated 45 degrees and cropped to reduce the transparent background that may have appeared. This centers the image and allows for better positioning."}]},{"block_type":"element","block":"k67ev7f8","search_text":"In the next step, apply_watermark transforms the PDF into a sequence of PIL Images using the pdf2image module. It calculates the position to apply the watermark, and then pastes the watermark.","text_count":192,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the next step,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"apply_watermark"}]},{"block_type":"text","content":"transforms the PDF into a sequence of PIL"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Images"}]},{"block_type":"text","content":"using the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdf2image"}]},{"block_type":"text","content":"module. It calculates the position to apply the watermark, and then pastes the watermark."}]},{"block_type":"element","block":"k67ev7f9","search_text":"Note The image needs to be located by its left-top corner. This is located in the half of the document, minus half of the watermark, in both height and width. Note that the script assumes that all the pages of the document are equal. ","text_count":234,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The image needs to be located by its left-top corner. This is located in the half of the document, minus half of the watermark, in both height and width. Note that the script assumes that all the pages of the document are equal."}]}]},{"block_type":"element","block":"k67ev7fa","search_text":"Finally, the result is saved to a PDF; notice the save_all parameter, which allows us to save a multipage PDF.","text_count":110,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the result is saved to a PDF; notice the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"save_all"}]},{"block_type":"text","content":"parameter, which allows us to save a multipage PDF."}]},{"block_type":"element","block":"k67ev7fb","search_text":"If a password is passed, the encrypt function is called. It opens the output PDF, using PdfFileReader , and creates a new intermediate PDF with PdfFileWriter . All the pages of the output PDF are added to the new PDF, the PDF is encrypted, and then the intermediate PDF is renamed as the output PDF using os.rename .","text_count":316,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If a password is passed, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"encrypt"}]},{"block_type":"text","content":"function is called. It opens the output PDF, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PdfFileReader"}]},{"block_type":"text","content":", and creates a new intermediate PDF with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PdfFileWriter"}]},{"block_type":"text","content":". All the pages of the output PDF are added to the new PDF, the PDF is encrypted, and then the intermediate PDF is renamed as the output PDF using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.rename"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7fc","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7fd","search_text":"As part of the watermarking, notice that the pages are transformed into images from text. This adds extra protection, as the text won't be extractable directly, as it is stored as an image. When protecting a file, this is a good idea, as it will stop copying/pasting directly.","text_count":276,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As part of the watermarking, notice that the pages are transformed into images from text. This adds extra protection, as the text won't be extractable directly, as it is stored as an image. When protecting a file, this is a good idea, as it will stop copying/pasting directly."}]},{"block_type":"element","block":"k67ev7fe","search_text":"Tip This is not a huge security measure, though, as the text may be extractable through OCR tools. But, it protects against casual extraction of the text. ","text_count":155,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is not a huge security measure, though, as the text may be extractable through OCR tools. But, it protects against casual extraction of the text."}]}]},{"block_type":"element","block":"k67ev7ff","search_text":"The default font from PIL can be a little rough. Another font, if the TrueType or OpenType file is available, can be added and used by calling the following:","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The default font from PIL can be a little rough. Another font, if the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TrueType"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"OpenType"}]},{"block_type":"text","content":"file is available, can be added and used by calling the following:"}]},{"block_type":"element","block":"k67ev7fg","search_text":"font = ImageFont.truetype('my_font.ttf', SIZE)","text_count":46,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"font = ImageFont.truetype('my_font.ttf', SIZE)"}]}]},{"block_type":"element","block":"k67ev7fh","search_text":"Note that this may require installing the FreeType libraries, normally available as part of the libfreetype package. Further documentation is available at https://www.freetype.org/ . Depending on the font and size, you may need to adjust the sizes.","text_count":248,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that this may require installing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FreeType"}]},{"block_type":"text","content":"libraries, normally available as part of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"libfreetype"}]},{"block_type":"text","content":"package. Further documentation is available at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.freetype.org/"},"children":[{"block_type":"text","content":"https://www.freetype.org/"}]},{"block_type":"text","content":". Depending on the font and size, you may need to adjust the sizes."}]},{"block_type":"element","block":"k67ev7fi","search_text":"The full pdf2image documentation can be found at https://github.com/Belval/pdf2image , the full documentation for PyPDF2 at https://pythonhosted.org/PyPDF2/ , and the full documentation for Pillow can be found at https://pillow.readthedocs.io/en/5.2.x/.","text_count":253,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdf2image"}]},{"block_type":"text","content":"documentation can be found at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/Belval/pdf2image"},"children":[{"block_type":"text","content":"https://github.com/Belval/pdf2image"}]},{"block_type":"text","content":", the full documentation for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":"at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pythonhosted.org/PyPDF2/"},"children":[{"block_type":"text","content":"https://pythonhosted.org/PyPDF2/"}]},{"block_type":"text","content":", and the full documentation for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Pillow"}]},{"block_type":"text","content":"can be found at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pillow.readthedocs.io/en/5.2.x/"},"children":[{"block_type":"text","content":"https://pillow.readthedocs.io/en/5.2.x/."}]}]},{"block_type":"element","block":"k67ev7fj","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7fk","search_text":"The Writing a simple PDF document recipe The Structuring a PDF recipe The Aggregating PDF reports recipe ","text_count":105,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a simple PDF document"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Structuring a PDF"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF reports"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Fun with Spreadsheets","author":"Jaime Buelta","block":"k67eunwy","number":6,"contents":[{"block_type":"element","block":"k67ev7fl","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k67ev7fm","search_text":"Writing a CSV spreadsheet Updating CSV spreadsheets Reading an Excel spreadsheet Updating an Excel spreadsheet Creating new sheets in an Excel spreadsheet Creating charts in Excel Working with format in Excel Reading and writing in LibreOffice Creating a macro in LibreOffice ","text_count":276,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Writing a CSV spreadsheet"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Updating CSV spreadsheets"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel spreadsheet"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating new sheets in an Excel spreadsheet"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating charts in Excel"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Working with format in Excel"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading and writing in LibreOffice"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating a macro in LibreOffice"}]}]},{"block_type":"element","block":"k67ev7fn","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev7fo","search_text":"Spreadsheets are one of the most versatile and omnipresent tools in the world of computing. Their intuitive approach of sheets and cells is used by virtually everyone that uses a computer as part of their day-to-day operations. There's even a joke that whole complex businesses are managed and described in a single spreadsheet. They are an incredibly powerful tool.","text_count":366,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Spreadsheets are one of the most versatile and omnipresent tools in the world of computing. Their intuitive approach of sheets and cells is used by virtually everyone that uses a computer as part of their day-to-day operations. There's even a joke that whole complex businesses are managed and described in a single spreadsheet.&nbsp;They are an incredibly powerful tool."}]},{"block_type":"element","block":"k67ev7fp","search_text":"That makes the ability to automate reading from and writing to spreadsheets so powerful. We'll see in this chapter how to process spreadsheets, mainly in the most common format, Excel. A final recipe will cover a free alternative, Libre Office, and in particular, how to use Python as a scripting language inside it.","text_count":316,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"That makes the ability to automate reading from and writing to spreadsheets so powerful. We'll see in this chapter how to process spreadsheets, mainly in the most common format, Excel. A final recipe will cover a free alternative, Libre Office, and in particular, how to use Python as a scripting language inside it."}]},{"block_type":"element","block":"k67ev7fq","search_text":"Writing a CSV spreadsheet","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Writing a CSV spreadsheet"}]},{"block_type":"element","block":"k67ev7fr","search_text":"CSV files are simple spreadsheets that are easy to share. They are basically a text file with tabular data, separated by commas (hence the name Comma-Separated Values), in a simple table format. CSV files can be created using Python's standard library and can be read by most spreadsheet software.","text_count":297,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"CSV files are simple spreadsheets that are easy to share. They are basically a text file with tabular data, separated by commas (hence the name Comma-Separated Values), in a simple table format.&nbsp;CSV files can be created using Python's standard library and can be read by most spreadsheet software."}]},{"block_type":"element","block":"k67ev7fs","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7ft","search_text":"For this recipe, only the standard library of Python is required. Everything is ready out of the box!","text_count":101,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, only the standard library of Python is required. Everything is ready out of the box!"}]},{"block_type":"element","block":"k67ev7fu","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7fv","search_text":"Import the csv module: ","text_count":23,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev7fw","search_text":">>> import csv","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import csv"}]}]},{"block_type":"element","block":"k67ev7fx","search_text":"Define the header with how the data will be ordered and the data to store: ","text_count":75,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the header with how the data will be ordered and the data to store:"}]}]},{"block_type":"element","block":"k67ev7fy","search_text":">>> HEADER = ('Admissions', 'Name', 'Year') >>> DATA = [ ... (225.7, 'Gone With the Wind', 1939), ... (194.4, 'Star Wars', 1977), ... (161.0, 'ET: The Extra-Terrestrial', 1982) ... ]","text_count":182,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; HEADER = ('Admissions', 'Name', 'Year')\n&gt;&gt;&gt; DATA = [\n... (225.7, 'Gone With the Wind', 1939),\n... (194.4, 'Star Wars', 1977),\n... (161.0, 'ET: The Extra-Terrestrial', 1982)\n... ]"}]}]},{"block_type":"element","block":"k67ev7fz","search_text":"Write the data into a CSV file: ","text_count":32,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Write the data into a CSV file:"}]}]},{"block_type":"element","block":"k67ev7g0","search_text":">>> with open('movies.csv', 'w', newline='') as csvfile: ... movies = csv.writer(csvfile) ... movies.writerow(HEADER) ... for row in DATA: ... movies.writerow(row)","text_count":163,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('movies.csv', 'w',  newline='') as csvfile:\n...     movies = csv.writer(csvfile)\n...     movies.writerow(HEADER)\n...     for row in DATA:\n...         movies.writerow(row)"}]}]},{"block_type":"element","block":"k67ev7g1","search_text":"Check the resulting CSV file in a spreadsheet. In the following screenshot, the file is displayed using the LibreOffice software: ","text_count":130,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the resulting CSV file in a spreadsheet. In the following screenshot, the file is displayed using the LibreOffice software:"}]}]},{"block_type":"element","block":"k67ev7g2","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000021.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7g3","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7g4","search_text":"After the preparation work in steps 1 and 2 in the How to do it… section, step 3 is the part that does the work.","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After the preparation work in steps 1 and 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, step 3 is the part that does the work."}]},{"block_type":"element","block":"k67ev7g5","search_text":"It opens a new file, movies.csv , in write ( w ) mode. The raw file object in csvfile then creates a writer. All this happens in a with block, so it closes the file when it's over.","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It opens a new file,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.csv"}]},{"block_type":"text","content":", in write ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"w"}]},{"block_type":"text","content":") mode. The raw file object in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csvfile"}]},{"block_type":"text","content":"&nbsp;then creates a writer. All this happens in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"block, so it closes the file when it's over."}]},{"block_type":"element","block":"k67ev7g6","search_text":"Note Note the newline='' parameter. This is done to make the writer store the newline directly and avoid incompatibility issues. ","text_count":129,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"newline=''"}]},{"block_type":"text","content":"parameter. This is done to make the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"writer"}]},{"block_type":"text","content":"&nbsp;store the newline directly and avoid incompatibility issues."}]}]},{"block_type":"element","block":"k67ev7g7","search_text":"The writer writes row by row the elements using .writerow . The first one is the HEADER , and then each of the lines of data.","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The writer writes row by row the elements using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".writerow"}]},{"block_type":"text","content":". The first one is the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HEADER"}]},{"block_type":"text","content":", and then each of the lines of data."}]},{"block_type":"element","block":"k67ev7g8","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7g9","search_text":"The code presented stores the data in the default dialect. The dialect defines what divides the data on each row (commas or other characters), how to escape, newlines, and so on. In case the dialect needs to be tweaked, each of these parameters can be defined in the writer call. See the following link for a list of all the parameters that can be defined:","text_count":356,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code presented stores the data in the default dialect. The dialect defines what divides the data on each row (commas or other characters), how to escape, newlines, and so on. In case the dialect needs to be tweaked, each of these parameters can be defined in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"writer"}]},{"block_type":"text","content":"call. See the following link for a list of all the parameters that can be defined:"}]},{"block_type":"element","block":"k67ev7ga","search_text":"https://docs.python.org/3/library/csv.html#dialects-and-formatting-parameters . ","text_count":80,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/csv.html#dialects-and-formatting-parameters"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/csv.html#dialects-and-formatting-parameters"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev7gb","search_text":"Tip CSV files are better when simple. If the data to be stored is complicated, maybe the best alternative is not a CSV file. But CSV files are extremely useful when dealing with tabular data. They can be understood by virtually all programs, and even dealing with them at a low level is easy. ","text_count":293,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"CSV files are better when simple. If the data to be stored is complicated, maybe the best alternative is not a CSV file. But CSV files are extremely useful when dealing with tabular data. They can be understood by virtually all programs, and even dealing with them at a low level is easy."}]}]},{"block_type":"element","block":"k67ev7gc","search_text":"The full csv module documentation can be found here:","text_count":52,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module documentation can be found here:"}]},{"block_type":"element","block":"k67ev7gd","search_text":"https://docs.python.org/3/library/csv.html .","text_count":44,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/csv.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/csv.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7ge","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7gf","search_text":"The Reading CSV files recipe in Chapter 4, Searching and Reading Local Files The Updating CSV files recipe ","text_count":107,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading CSV files"}]},{"block_type":"text","content":"recipe"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"in&nbsp;"}]},{"block_type":"text","content":"Chapter 4,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating CSV files"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7gg","search_text":"Updating the CSV files","text_count":22,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Updating the CSV files"}]},{"block_type":"element","block":"k67ev7gh","search_text":"Given that CSV files are simple text files, the best solution to update their content is to read them, change them to internal Python objects, and then write the result in the same format. In this recipe, will see how to do this.","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Given that CSV files are simple text files, the best solution to update their content is to read them, change them to internal Python objects, and then write the result in the same format. In this recipe, will see how to do this."}]},{"block_type":"element","block":"k67ev7gi","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7gj","search_text":"In this recipe, we will use the movies.csv file that is available on GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.csv . It contains the following data:","text_count":207,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.csv"}]},{"block_type":"text","content":"&nbsp;file that is available on GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.csv"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.csv"}]},{"block_type":"text","content":". It contains the following data:"}]},{"block_type":"element","block":"k67ev7gk","search_text":"Admissions Name Year 225.7 Gone With the Wind 1939 194.4 Star Wars 1968 161.0 ET: The Extra-Terrestrial 1982 ","text_count":109,"tag_name":"table","attributes":{"border":"1"},"children":[{"block_type":"element","tag_name":"tbody","attributes":{},"children":[{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Admissions"}]}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Name"}]}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Year"}]}]}]},{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"225.7"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Gone With the Wind"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"1939"}]}]},{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"194.4"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Star Wars"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"1968"}]}]},{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"161.0"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"ET: The Extra-Terrestrial"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"1982"}]}]}]}]},{"block_type":"element","block":"k67ev7gl","search_text":"Notice that the year of Star Wars is incorrect (it should be 1977). We'll change it in the recipe.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the year of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Star Wars"}]},{"block_type":"text","content":"&nbsp;is incorrect (it should be 1977). We'll change it in the recipe."}]},{"block_type":"element","block":"k67ev7gm","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7gn","search_text":"Import the csv module and define the filename: ","text_count":47,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module and define the filename:"}]}]},{"block_type":"element","block":"k67ev7go","search_text":">>> import csv >>> FILENAME = 'movies.csv'","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import csv\n&gt;&gt;&gt; FILENAME = 'movies.csv'"}]}]},{"block_type":"element","block":"k67ev7gp","search_text":"Read the contents of the file using a DictReader and transform them into a list of ordered rows: ","text_count":97,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Read the contents of the file using a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictReader"}]},{"block_type":"text","content":"and transform them into a list of ordered rows:"}]}]},{"block_type":"element","block":"k67ev7gq","search_text":">>> with open(FILENAME, newline='') as file: ... data = [row for row in csv.DictReader(file)]","text_count":93,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open(FILENAME, newline='') as file:\n...     data = [row for row in csv.DictReader(file)]"}]}]},{"block_type":"element","block":"k67ev7gr","search_text":"Check the obtained data. Change the proper value from 1968 to 1977: ","text_count":68,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the obtained data. Change the proper value from 1968 to 1977:"}]}]},{"block_type":"element","block":"k67ev7gs","search_text":">>> data [OrderedDict([('Admissions', '225.7'), ('Name', 'Gone With the Wind'), ('Year', '1939')]), OrderedDict([('Admissions', '194.4'), ('Name', 'Star Wars'), ('Year', '1968')]), OrderedDict([('Admissions', '161.0'), ('Name', 'ET: The Extra-Terrestrial'), ('Year', '1982')])] >>> data[1]['Year'] '1968' >>> data[1]['Year'] = '1977'","text_count":333,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data\n[OrderedDict([('Admissions', '225.7'), ('Name', 'Gone With the Wind'), ('Year', '1939')]), OrderedDict([('Admissions', '194.4'), ('Name', 'Star Wars'), ('Year', '1968')]), OrderedDict([('Admissions', '161.0'), ('Name', 'ET: The Extra-Terrestrial'), ('Year', '1982')])]\n&gt;&gt;&gt; data[1]['Year']\n'1968'\n&gt;&gt;&gt; data[1]['Year'] = '1977'"}]}]},{"block_type":"element","block":"k67ev7gt","search_text":"Open the file again, and store the values: ","text_count":43,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the file again, and store the values:"}]}]},{"block_type":"element","block":"k67ev7gu","search_text":">>> HEADER = data[0].keys() >>> with open(FILENAME, 'w', newline='') as file: ... writer = csv.DictWriter(file, fieldnames=HEADER) ... writer.writeheader() ... writer.writerows(data)","text_count":182,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; HEADER = data[0].keys()\n&gt;&gt;&gt; with open(FILENAME, 'w', newline='') as file:\n...     writer = csv.DictWriter(file, fieldnames=HEADER)\n...     writer.writeheader()\n...     writer.writerows(data)"}]}]},{"block_type":"element","block":"k67ev7gv","search_text":"Check the result in spreadsheet software. The result is similar to that displayed in step 4 of the Writing a CSV spreadsheet recipe. ","text_count":133,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the result in spreadsheet software. The result is similar to that displayed in step 4 of the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a CSV spreadsheet"}]},{"block_type":"text","content":"recipe."}]}]},{"block_type":"element","block":"k67ev7gw","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7gx","search_text":"After importing the csv module in step 2 of the How to do it… section, we extract all the data from the file. The file is opened in a with block. DictReader conveniently transforms it into a list of dictionaries, with the keys on the header values.","text_count":248,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module in step 2 of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, we extract all the data from the file. The file is opened in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"block.&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictReader"}]},{"block_type":"text","content":"conveniently transforms it into a list of dictionaries, with the keys on the header values."}]},{"block_type":"element","block":"k67ev7gy","search_text":"The conveniently formatted data can then be manipulated and changed. We change the data to the proper value in step 3.","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The conveniently formatted data can then be manipulated and changed. We change the data to the proper value in step 3."}]},{"block_type":"element","block":"k67ev7gz","search_text":"Tip In this recipe, we change the value directly, but searching may be required in a more general case. ","text_count":104,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we change the value directly, but searching may be required in a more general case."}]}]},{"block_type":"element","block":"k67ev7h0","search_text":"Step 4 overwrites the file and, using DictWriter , stores the data. DictWriter requires us to define the fields on the columns by requiring the fieldnames . To obtain it, we retrieve the keys of one of the rows and store them in HEADER .","text_count":237,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 overwrites the file and, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictWriter"}]},{"block_type":"text","content":", stores the data."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictWriter"}]},{"block_type":"text","content":"requires us to define the fields on the columns by requiring the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fieldnames"}]},{"block_type":"text","content":". To obtain it, we retrieve the keys of one of the rows and store them in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HEADER"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7h1","search_text":"The file is opened again in w mode to overwrite it. DictWriter first stores the header with .writeheader and then stores all the rows with a single call to .writerows .","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The file is opened again in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"w"}]},{"block_type":"text","content":"mode to overwrite it.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictWriter"}]},{"block_type":"text","content":"&nbsp; first stores the header with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".writeheader"}]},{"block_type":"text","content":"and then stores all the rows with a single call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".writerows"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7h2","search_text":"Note The rows can also be added one by one by calling .writerow ","text_count":64,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The rows can also be added one by one by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".writerow"}]}]}]},{"block_type":"element","block":"k67ev7h3","search_text":"After closing the with block, the file is stored and can be checked.","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After closing the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"block, the file is stored and can be checked."}]},{"block_type":"element","block":"k67ev7h4","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7h5","search_text":"The dialect of the CSV file typically known, but it may be the case that it is not. In that case, the Sniffer class can help. It analyses a sample of the file (or the whole file) and returns a dialect object to allow reading in the proper way:","text_count":243,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The dialect of the CSV file typically known, but it may be the case that it is not. In that case, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sniffer"}]},{"block_type":"text","content":"class can help. It&nbsp;analyses a sample of the file (or the whole file) and returns a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dialect"}]},{"block_type":"text","content":"object to allow reading in the proper way:"}]},{"block_type":"element","block":"k67ev7h6","search_text":">>> with open(FILENAME, newline='') as file: ... dialect = csv.Sniffer().sniff(file.read())","text_count":91,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open(FILENAME, newline='') as file:\n...    dialect = csv.Sniffer().sniff(file.read())"}]}]},{"block_type":"element","block":"k67ev7h7","search_text":"The dialect then can be passed to the DictReader class when opening the file. The file will need to be opened twice for reading.","text_count":128,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The dialect then can be passed to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictReader"}]},{"block_type":"text","content":"class when opening the file. The file will need to be opened twice for reading."}]},{"block_type":"element","block":"k67ev7h8","search_text":"Tip Remember to use the dialect on the DictWriter class as well to save the file in the same format. ","text_count":101,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember to use the dialect on the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DictWriter"}]},{"block_type":"text","content":"class as well to save the file in the same format."}]}]},{"block_type":"element","block":"k67ev7h9","search_text":"The full documentation for the csv module can be found here:","text_count":60,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full documentation for the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module can be found here:"}]},{"block_type":"element","block":"k67ev7ha","search_text":"https://docs.python.org/3.6/library/csv.html .","text_count":46,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.6/library/csv.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3.6/library/csv.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7hb","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7hc","search_text":"The Reading CSV files recipe in Chapter 4, Searching and Reading Local Files The Writing a CSV spreadsheet recipe ","text_count":114,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading CSV files"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 4,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a CSV spreadsheet"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7hd","search_text":"Reading an Excel spreadsheet","text_count":28,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel spreadsheet"}]},{"block_type":"element","block":"k67ev7he","search_text":"MS Office is arguably the most common office suite software, making its formats pretty much standards. In terms of spreadsheets, Excel is probably the most used one and a format easily exchanged.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"MS Office is arguably the most common office suite software, making its formats pretty much standards. In terms of spreadsheets, Excel is probably the most used one and a format easily exchanged."}]},{"block_type":"element","block":"k67ev7hf","search_text":"In this recipe, we'll see how to obtain information from an Excel spreadsheet programmatically from Python using the openpyxl module.","text_count":133,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to obtain information from an Excel spreadsheet programmatically from Python using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"module."}]},{"block_type":"element","block":"k67ev7hg","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7hh","search_text":"We will use the openpyxl module. We should install the module, adding it to our requirements.txt file as follows:","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"module. We should install the module, adding it to our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file as follows:"}]},{"block_type":"element","block":"k67ev7hi","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7hj","search_text":"In the GitHub repository, there's an Excel spreadsheet named movies.xlsx that contains information on the top ten movies by attendance. The file can be found here:","text_count":163,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the GitHub repository, there's an Excel spreadsheet named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.xlsx"}]},{"block_type":"text","content":"that contains information on the top ten movies by attendance. The file can be found here:"}]},{"block_type":"element","block":"k67ev7hk","search_text":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.xlsx .","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.xlsx"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.xlsx"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7hl","search_text":"The source of the information is this web page:","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The source of the information is this web page:"}]},{"block_type":"element","block":"k67ev7hm","search_text":"http://www.mrob.com/pub/film-video/topadj.html .","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.mrob.com/pub/film-video/topadj.html"},"children":[{"block_type":"text","content":"http://www.mrob.com/pub/film-video/topadj.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7hn","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7ho","search_text":"Import the openpyxl module: ","text_count":28,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev7hp","search_text":">>> import openpyxl","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import openpyxl"}]}]},{"block_type":"element","block":"k67ev7hq","search_text":"Load the file into memory: ","text_count":27,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Load the file into memory:"}]}]},{"block_type":"element","block":"k67ev7hr","search_text":">>> xlsfile = openpyxl.load_workbook('movies.xlsx')","text_count":51,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile = openpyxl.load_workbook('movies.xlsx')"}]}]},{"block_type":"element","block":"k67ev7hs","search_text":"List all sheets and get the first one, which is the only one that contains data: ","text_count":81,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"List all sheets and get the first one, which is the only one that contains data:"}]}]},{"block_type":"element","block":"k67ev7ht","search_text":"","text_count":0,"tag_name":"ol","attributes":{"start":"3"},"children":[]},{"block_type":"element","block":"k67ev7hu","search_text":">>> xlsfile.sheetnames ['Sheet1'] >>> sheet = xlsfile['Sheet1']","text_count":63,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile.sheetnames\n['Sheet1']\n&gt;&gt;&gt; sheet = xlsfile['Sheet1']"}]}]},{"block_type":"element","block":"k67ev7hv","search_text":"Obtain the value of cells B4 and D4 (admissions and director of E.T.): ","text_count":71,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the value of cells"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B4"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"D4"}]},{"block_type":"text","content":"(admissions and director of E.T.):"}]}]},{"block_type":"element","block":"k67ev7hw","search_text":">>> sheet['B4'].value 161 >>> sheet['D4'].value 'Steven Spielberg'","text_count":66,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet['B4'].value\n161\n&gt;&gt;&gt; sheet['D4'].value\n'Steven Spielberg'"}]}]},{"block_type":"element","block":"k67ev7hx","search_text":"Obtain the size in rows and columns. Any cell out of that range will return None as a value: ","text_count":93,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the size in rows and columns. Any cell out of that range will return"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"None"}]},{"block_type":"text","content":"as a value:"}]}]},{"block_type":"element","block":"k67ev7hy","search_text":">>> sheet.max_row 11 >>> sheet.max_column 4 >>> sheet['A12'].value >>> sheet['E1'].value","text_count":88,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet.max_row\n11\n&gt;&gt;&gt; sheet.max_column\n4\n&gt;&gt;&gt; sheet['A12'].value\n&gt;&gt;&gt; sheet['E1'].value"}]}]},{"block_type":"element","block":"k67ev7hz","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7i0","search_text":"After importing the module in step 1, step 2 in the How to do it… section loads the file into memory in a Workbook object. Each workbook can contain one or more sheets, which contain cells.","text_count":189,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the module in step 1, step 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section loads the file into memory in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Workbook"}]},{"block_type":"text","content":"object. Each workbook can contain one or more sheets, which contain cells."}]},{"block_type":"element","block":"k67ev7i1","search_text":"To determine the available sheets, in step 3 we obtain all the sheets (there's only one in this example) and then access the sheet like a dictionary to retrieve a Worksheet object.","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To determine the available sheets, in step 3 we obtain all the sheets (there's only one in this example) and then access the sheet like a dictionary to retrieve a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Worksheet"}]},{"block_type":"text","content":"object."}]},{"block_type":"element","block":"k67ev7i2","search_text":"Worksheet can then access all the cells directly by their names, such as A4 or C3 . Each of them will return a Cell object. The .value attribute stores the value in the cell.","text_count":174,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Worksheet"}]},{"block_type":"text","content":"can then access all the cells directly by their names, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A4"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"C3"}]},{"block_type":"text","content":". Each of them will return a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Cell"}]},{"block_type":"text","content":"object. The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".value"}]},{"block_type":"text","content":"&nbsp;attribute stores the value in the cell."}]},{"block_type":"element","block":"k67ev7i3","search_text":"Tip In the rest of the recipes in this chapter, we will see more attributes of Cell objects. Keep reading! ","text_count":107,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the rest of the recipes in this chapter, we will see more attributes of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Cell"}]},{"block_type":"text","content":"objects. Keep reading!"}]}]},{"block_type":"element","block":"k67ev7i4","search_text":"Obtaining the area where the data is stored is possible with max_columns and max_rows . This allows us to search within the limits of the data.","text_count":143,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Obtaining the area where the data is stored is possible with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"max_columns"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"max_rows"}]},{"block_type":"text","content":". This allows us to search within the limits of the data."}]},{"block_type":"element","block":"k67ev7i5","search_text":"Tip Excel defines the columns as letters (A, B, C, and so on ) and rows as numbers (1, 2, 3, and so on). Remember to always set the column, and then the row ( D1 , not 1D ), or an error will be raised. ","text_count":202,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Excel defines the columns as letters (A, B, C, and so on ) and rows as numbers (1, 2, 3, and so on). Remember to always set the column, and then the row ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"D1"}]},{"block_type":"text","content":", not"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1D"}]},{"block_type":"text","content":"), or an error will be raised."}]}]},{"block_type":"element","block":"k67ev7i6","search_text":"Cells outside the area are accessible, but won't return data. They can be used to write new info.","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Cells outside the area are accessible, but won't return data. They can be used to write new info."}]},{"block_type":"element","block":"k67ev7i7","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7i8","search_text":"Cells can also be retrieved with sheet.cell(column, row) . Both elements start at 1.","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Cells can also be retrieved with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sheet.cell(column, row)"}]},{"block_type":"text","content":". Both elements start at 1."}]},{"block_type":"element","block":"k67ev7i9","search_text":"All the cells within the data area iterating from the sheet, for example:","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the cells within the data area iterating from the sheet, for example:"}]},{"block_type":"element","block":"k67ev7ia","search_text":">>> for row in sheet: ... for cell in row: ... # Do stuff with cell","text_count":67,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for row in sheet:\n...     for cell in row:\n...         # Do stuff with cell"}]}]},{"block_type":"element","block":"k67ev7ib","search_text":"This will return a list of lists with all cells, row by row: A1, A2, A3 ... B1, B2, B3, and so on.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This will return a list of lists with all cells, row by row: A1, A2, A3 ... B1, B2, B3, and so on."}]},{"block_type":"element","block":"k67ev7ic","search_text":"Tip You can retrieve the cell's column with columns iterating through sheet.columns : A1, B1, C1, and so on, A2, B2, C2. and so on. ","text_count":132,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can retrieve the cell's column with columns iterating through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sheet.columns"}]},{"block_type":"text","content":":&nbsp;A1, B1, C1, and so on, A2, B2, C2. and so on."}]}]},{"block_type":"element","block":"k67ev7id","search_text":"When retrieving a cell, you can find their position with .coordinate , .row , and .column :","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When retrieving a cell, you can find their&nbsp;position with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".coordinate"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".row"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".column"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev7ie","search_text":">>> cell.coordinate 'D4' >>> cell.column 'D' >>> cell.row 4","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; cell.coordinate\n'D4'\n&gt;&gt;&gt; cell.column\n'D'\n&gt;&gt;&gt; cell.row\n4"}]}]},{"block_type":"element","block":"k67ev7if","search_text":"The full openpyxl documentation can be found here:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"documentation can be found here:"}]},{"block_type":"element","block":"k67ev7ig","search_text":"https://openpyxl.readthedocs.io/en/stable/index.html .","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/index.html"},"children":[{"block_type":"text","content":"https://openpyxl.readthedocs.io/en/stable/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7ih","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7ii","search_text":"The Updating an Excel spreadsheet recipe The Creating new sheets in an Excel spreadsheet recipe The Creating charts in Excel recipe The Working with the format in Excel recipe ","text_count":176,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating new sheets in an Excel spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating charts in Excel"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Working with the format in Excel"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7ij","search_text":"Updating an Excel spreadsheet","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet"}]},{"block_type":"element","block":"k67ev7ik","search_text":"In this recipe, we'll see how to update an existing Excel spreadsheet. This will include changing raw values in cells but also setting up formulas that will be evaluated when the spreadsheet is open. We'll also see how to add comments to cells.","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to update an existing Excel spreadsheet. This will include changing raw values in cells but also setting up formulas that will be evaluated when the spreadsheet is open. We'll also see how to add comments to cells."}]},{"block_type":"element","block":"k67ev7il","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7im","search_text":"We will use the module openpyxl . We should install the module, adding it to our requirements.txt file as follows:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the module"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":". We should install the module, adding it to our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file as follows:"}]},{"block_type":"element","block":"k67ev7in","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7io","search_text":"In the GitHub repository, there's an Excel spreadsheet named movies.xlsx that contains information on the top ten movies by attendance.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the GitHub repository, there's an Excel spreadsheet named"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.xlsx"}]},{"block_type":"text","content":"that contains information on the top ten movies by attendance."}]},{"block_type":"element","block":"k67ev7ip","search_text":"The file can be found here:","text_count":27,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The file can be found here:"}]},{"block_type":"element","block":"k67ev7iq","search_text":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.xlsx .","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.xlsx"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.xlsx"}]},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/chapter6/movies.xlsx"},"children":[{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev7ir","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7is","search_text":"Import the module openpyxl and the Comment class: ","text_count":50,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the module&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"and the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Comment"}]},{"block_type":"text","content":"class:"}]}]},{"block_type":"element","block":"k67ev7it","search_text":">>> import openpyxl >>> from openpyxl.comments import Comment","text_count":61,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import openpyxl\n&gt;&gt;&gt; from openpyxl.comments import Comment"}]}]},{"block_type":"element","block":"k67ev7iu","search_text":"Load the file into memory and get the sheet: ","text_count":45,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Load the file into memory and get the sheet:"}]}]},{"block_type":"element","block":"k67ev7iv","search_text":">>> xlsfile = openpyxl.load_workbook('movies.xlsx') >>> sheet = xlsfile['Sheet1']","text_count":81,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile = openpyxl.load_workbook('movies.xlsx')\n&gt;&gt;&gt; sheet = xlsfile['Sheet1']"}]}]},{"block_type":"element","block":"k67ev7iw","search_text":"Obtain the value of cell D4 (director of E.T): ","text_count":47,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain the value of cell"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"D4"}]},{"block_type":"text","content":"(director of E.T):"}]}]},{"block_type":"element","block":"k67ev7ix","search_text":">>> sheet['D4'].value 'Steven Spielberg'","text_count":40,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet['D4'].value\n'Steven Spielberg'"}]}]},{"block_type":"element","block":"k67ev7iy","search_text":"Change the value to just Spielberg : ","text_count":37,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Change the value to just"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Spielberg"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7iz","search_text":">>> sheet['D4'].value = 'Spielberg'","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet['D4'].value = 'Spielberg'"}]}]},{"block_type":"element","block":"k67ev7j0","search_text":"Add a comment to that cell: ","text_count":28,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a comment to that cell:"}]}]},{"block_type":"element","block":"k67ev7j1","search_text":">>> sheet['D4'].comment = Comment('Changed text automatically', 'User')","text_count":71,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet['D4'].comment = Comment('Changed text automatically', 'User')"}]}]},{"block_type":"element","block":"k67ev7j2","search_text":"Add a new element that obtains the total of all values in the Admission column: ","text_count":80,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add a new element that obtains the total of all values in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Admission"}]},{"block_type":"text","content":"column:"}]}]},{"block_type":"element","block":"k67ev7j3","search_text":">>> sheet['B12'] = '=SUM(B2:B11)'","text_count":33,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet['B12'] = '=SUM(B2:B11)'"}]}]},{"block_type":"element","block":"k67ev7j4","search_text":"Save the spreadsheet to the movies_comment.xlsx file: ","text_count":54,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the spreadsheet to the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies_comment.xlsx"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev7j5","search_text":">>> xlsfile.save('movies_comment.xlsx')","text_count":39,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile.save('movies_comment.xlsx')"}]}]},{"block_type":"element","block":"k67ev7j6","search_text":"Check the resulting file, which includes the comment and the calculation of the total of column B in A12 : ","text_count":107,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the resulting file, which includes the comment and the calculation of the total of column"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B"}]},{"block_type":"text","content":"in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A12"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7j7","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000072.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7j8","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7j9","search_text":"In the How to do it… section, the imports in step 1 and reading the spreadsheet in step 2, we select the cell to be changed in step 3.","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, the imports in step 1 and reading the spreadsheet in step 2, we select the cell to be changed in step 3."}]},{"block_type":"element","block":"k67ev7ja","search_text":"Updating the value is done in step 4 with an assignment. A comment in the cell is added, overwriting the .coment attribute with a new Comment . Note that the user that made the comment needs to be added as well.","text_count":211,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Updating the value is done in step 4 with an assignment. A comment in the cell is added, overwriting the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".coment"}]},{"block_type":"text","content":"attribute with a new"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Comment"}]},{"block_type":"text","content":". Note that the user that made the comment needs to be added as well."}]},{"block_type":"element","block":"k67ev7jb","search_text":"Values can also include descriptions of formulas. In step 6, we add a new formula to cell B12 . The value is calculated and displayed when the file is opened in step 8.","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Values can also include descriptions of formulas. In step 6, we add a new formula to cell"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B12"}]},{"block_type":"text","content":". The value is calculated and displayed when the file is opened in step 8."}]},{"block_type":"element","block":"k67ev7jc","search_text":"Tip The value of a formula is not calculated in the Python object. This means that the formula could contain errors or display unexpected results through bugs. Be sure to double-check that the formulas are correct. ","text_count":215,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The value of a formula is not calculated in the Python object. This means that the formula could contain errors or display unexpected results through bugs. Be sure to double-check that the formulas are correct."}]}]},{"block_type":"element","block":"k67ev7jd","search_text":"Finally, in step 9, the spreadsheet is saved to disk by calling the .save method of the file.","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, in step 9, the spreadsheet is saved to disk by calling the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".save"}]},{"block_type":"text","content":"method of the file."}]},{"block_type":"element","block":"k67ev7je","search_text":"Tip The name of the resulting file can be the same one as the input one to overwrite the file. ","text_count":95,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The name of the resulting file can be the same one as the input one to overwrite the file."}]}]},{"block_type":"element","block":"k67ev7jf","search_text":"The comment and values can be checked by externally accessing the file.","text_count":71,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The comment and values can be checked by externally accessing the file."}]},{"block_type":"element","block":"k67ev7jg","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7jh","search_text":"You can store data in multiple values, and it will be translated into the proper types for Excel. For example, storing datetime will store it in the proper date format. The same is true with float or other numeric formats.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can store data in multiple values, and it will be translated into the proper types for Excel. For example, storing&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"datetime"}]},{"block_type":"text","content":"will store it in the proper date format. The same is true with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"float"}]},{"block_type":"text","content":"or other numeric formats."}]},{"block_type":"element","block":"k67ev7ji","search_text":"If you need to infer types, you can enable this by using the guess_type parameter when loading the file, for example:","text_count":117,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you need to infer types, you can enable&nbsp;this by using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"guess_type"}]},{"block_type":"text","content":"&nbsp;parameter when loading the file, for example:"}]},{"block_type":"element","block":"k67ev7jj","search_text":">>> xlsfile = openpyxl.load_workbook('movies.xlsx', guess_types=True) >>> xlsfile['Sheet1']['A1'].value = '37%' >>> xlsfile['Sheet1']['A1'].value 0.37 >>> xlsfile['Sheet1']['A1'].value = '2.75' >>> xlsfile['Sheet1']['A1'].value 2.75","text_count":232,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile = openpyxl.load_workbook('movies.xlsx', guess_types=True)\n&gt;&gt;&gt; xlsfile['Sheet1']['A1'].value = '37%'\n&gt;&gt;&gt; xlsfile['Sheet1']['A1'].value\n0.37\n&gt;&gt;&gt; xlsfile['Sheet1']['A1'].value = '2.75'\n&gt;&gt;&gt; xlsfile['Sheet1']['A1'].value\n2.75"}]}]},{"block_type":"element","block":"k67ev7jk","search_text":"Adding comments to automatically generated cells can help review the resulting file, making clear how where they generated.","text_count":123,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Adding comments to automatically generated cells can help review the resulting file, making clear how where they generated."}]},{"block_type":"element","block":"k67ev7jl","search_text":"While is possible to add formulas to automatically generate Excel files, debugging the results can be tricky. When generating a result, generally it's better to make the calculations in Python and store the result in raw.","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While is possible to add formulas to automatically generate Excel files, debugging the results can be tricky. When generating a result, generally it's better to make the calculations in Python and store the result in raw."}]},{"block_type":"element","block":"k67ev7jm","search_text":"The full openpyxl documentation can be found here:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:"}]},{"block_type":"element","block":"k67ev7jn","search_text":"https://openpyxl.readthedocs.io/en/stable/index.html .","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/index.html"},"children":[{"block_type":"text","content":"https://openpyxl.readthedocs.io/en/stable/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7jo","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7jp","search_text":"The Reading an Excel spreadsheet recipe The Creating new sheets on an Excel spreadsheet recipe The Creating charts in Excel recipe The Working with the format in Excel recipe ","text_count":175,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating new sheets on an Excel spreadsheet"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating charts in Excel"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Working with the format in Excel"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7jq","search_text":"Creating new sheets on an Excel spreadsheet","text_count":43,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating new sheets on an Excel spreadsheet"}]},{"block_type":"element","block":"k67ev7jr","search_text":"In this recipe, we'll demonstrate how to create a new Excel spreadsheet from scratch, and add and deal with multiple sheets.","text_count":124,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll demonstrate how to create a new Excel spreadsheet from scratch, and add and deal with multiple sheets."}]},{"block_type":"element","block":"k67ev7js","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7jt","search_text":"We will use the module openpyxl . We should install the module, adding it to our requirements.txt file as follows:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the module&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":". &nbsp;We should install the module, adding it to our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file as follows:"}]},{"block_type":"element","block":"k67ev7ju","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7jv","search_text":"We'll store in the new file information about the movies with the most attendance. Data is extracted from here:","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll store in the new file information about the movies with the most attendance. Data is extracted from&nbsp;here:"}]},{"block_type":"element","block":"k67ev7jw","search_text":"http://www.mrob.com/pub/film-video/topadj.html .","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.mrob.com/pub/film-video/topadj.html"},"children":[{"block_type":"text","content":"http://www.mrob.com/pub/film-video/topadj.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7jx","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7jy","search_text":"Import the openpyxl module: ","text_count":28,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev7jz","search_text":">>> import openpyxl","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import openpyxl"}]}]},{"block_type":"element","block":"k67ev7k0","search_text":"Create a new Excel file. It creates a default sheet, called Sheet : ","text_count":68,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new Excel file. It creates a default sheet, called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sheet"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7k1","search_text":">>> xlsfile = openpyxl.Workbook() >>> xlsfile.sheetnames ['Sheet'] >>> sheet = xlsfile['Sheet']","text_count":95,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile = openpyxl.Workbook()\n&gt;&gt;&gt; xlsfile.sheetnames\n['Sheet']\n&gt;&gt;&gt; sheet = xlsfile['Sheet']"}]}]},{"block_type":"element","block":"k67ev7k2","search_text":"Add data about the number of attendees to this sheet from the source. Only the first three are added for simplicity: ","text_count":117,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add data about the number of attendees to this sheet from the source. Only the first three are added for simplicity:"}]}]},{"block_type":"element","block":"k67ev7k3","search_text":">>> data = [ ... (225.7, 'Gone With the Wind', 'Victor Fleming'), ... (194.4, 'Star Wars', 'George Lucas'), ... (161.0, 'ET: The Extraterrestrial', 'Steven Spielberg'), ... ] >>> for row, (admissions, name, director) in enumerate(data, 1): ... sheet['A{}'.format(row)].value = admissions ... sheet['B{}'.format(row)].value = name","text_count":329,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = [\n...    (225.7, 'Gone With the Wind', 'Victor Fleming'),\n...    (194.4, 'Star Wars', 'George Lucas'),\n...    (161.0, 'ET: The Extraterrestrial', 'Steven Spielberg'),\n... ]\n&gt;&gt;&gt; for row, (admissions, name, director) in enumerate(data, 1):\n...     sheet['A{}'.format(row)].value = admissions\n...     sheet['B{}'.format(row)].value = name"}]}]},{"block_type":"element","block":"k67ev7k4","search_text":"","text_count":0,"tag_name":"ol","attributes":{"start":"4"},"children":[]},{"block_type":"element","block":"k67ev7k5","search_text":"Create a new sheet: ","text_count":20,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new sheet:"}]}]},{"block_type":"element","block":"k67ev7k6","search_text":">>> sheet = xlsfile.create_sheet(\"Directors\") >>> sheet <Worksheet \"Directors\"> >>> xlsfile.sheetnames ['Sheet', 'Directors']","text_count":125,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet = xlsfile.create_sheet(\"Directors\")\n&gt;&gt;&gt; sheet\n&lt;Worksheet \"Directors\"&gt;\n&gt;&gt;&gt; xlsfile.sheetnames\n['Sheet', 'Directors']"}]}]},{"block_type":"element","block":"k67ev7k7","search_text":"Add the name of the director for each movie: ","text_count":45,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the name of the director for each movie:"}]}]},{"block_type":"element","block":"k67ev7k8","search_text":">>> for row, (admissions, name, director) in enumerate(data, 1): ... sheet['A{}'.format(row)].value = director ... sheet['B{}'.format(row)].value = name","text_count":152,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for row, (admissions, name, director) in enumerate(data, 1):\n...    sheet['A{}'.format(row)].value = director\n...    sheet['B{}'.format(row)].value = name"}]}]},{"block_type":"element","block":"k67ev7k9","search_text":"Save the file as movie_sheets.xlsx : ","text_count":37,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the file as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movie_sheets.xlsx"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7ka","search_text":">>> xlsfile.save('movie_sheets.xlsx')","text_count":37,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile.save('movie_sheets.xlsx')"}]}]},{"block_type":"element","block":"k67ev7kb","search_text":"Open the movie_sheets.xlsx file to check that it has two sheets, with the proper information, as shown in the following screenshot: ","text_count":132,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movie_sheets.xlsx"}]},{"block_type":"text","content":"file&nbsp;to check that it has two sheets, with the proper information, as shown in the following screenshot:"}]}]},{"block_type":"element","block":"k67ev7kc","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000009.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7kd","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7ke","search_text":"In the How to do it… section, after importing the module in step 1, we create a new spreadsheet in step 2. This is a new spreadsheet that contains just the default sheet.","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, after importing the module in step 1, we create a new spreadsheet in step 2. This is a new spreadsheet that contains just the default sheet."}]},{"block_type":"element","block":"k67ev7kf","search_text":"The data to be stored is defined in step 3. Note it contains the info that will go on both sheets (name in both, admissions in the first sheet, and director's name in the second). In this step, the first sheet is filled.","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The data to be stored is defined in step 3. Note it contains the info that will go on both sheets (name in both,&nbsp;admissions in the first sheet, and director's name in the second). In this step, the first sheet is filled."}]},{"block_type":"element","block":"k67ev7kg","search_text":"Note Note how the value is stored. The proper cell is defined as column A or B and the proper row (rows start at 1). The enumerate function returns a tuple with the first element as the index and the second as the enumerate parameter (an iterator). ","text_count":249,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note how the value is stored. The proper cell is defined as column&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B"}]},{"block_type":"text","content":"&nbsp; and the proper row (rows start at 1). The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"enumerate"}]},{"block_type":"text","content":"function returns a tuple with the first element as the index and the second as the enumerate parameter (an iterator)."}]}]},{"block_type":"element","block":"k67ev7kh","search_text":"After that, the new sheet is created in step 4, using the name Directors . .create_sheet returns the new sheet.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After that, the new sheet is created in step 4,&nbsp;using the name"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Directors"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".create_sheet"}]},{"block_type":"text","content":"returns the new sheet."}]},{"block_type":"element","block":"k67ev7ki","search_text":"The information in the Directors sheet is stored in step 5 and the file is saved in step 6.","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The information in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Directors"}]},{"block_type":"text","content":"sheet is stored in step 5 and the file is saved in step 6."}]},{"block_type":"element","block":"k67ev7kj","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7kk","search_text":"The name of an existing sheet can be changed through the .title property:","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The name of an existing sheet can be changed through the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".title"}]},{"block_type":"text","content":"property:"}]},{"block_type":"element","block":"k67ev7kl","search_text":">>> sheet = xlsfile['Sheet'] >>> sheet.title = 'Admissions' >>> xlsfile.sheetnames ['Admissions', 'Directors']","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet = xlsfile['Sheet']\n&gt;&gt;&gt; sheet.title = 'Admissions'\n&gt;&gt;&gt; xlsfile.sheetnames\n['Admissions', 'Directors']"}]}]},{"block_type":"element","block":"k67ev7km","search_text":"Be careful, as it won't be possible to access the sheet with xlsfile['Sheet'] . That name doesn't exist!","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be careful, as it won't be possible to access the sheet with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xlsfile['Sheet']"}]},{"block_type":"text","content":". That name doesn't exist!"}]},{"block_type":"element","block":"k67ev7kn","search_text":"The active sheet, the sheet that will be displayed when the file is opened, can be obtained through the .active property and changed with ._active_sheet_index . The index starts at 0 for the first sheet:","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The active sheet, the sheet that will be displayed when the file is opened, can be obtained through the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".active"}]},{"block_type":"text","content":"property and changed with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"._active_sheet_index"}]},{"block_type":"text","content":". The index starts at&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"&nbsp;for the first sheet:"}]},{"block_type":"element","block":"k67ev7ko","search_text":">> xlsfile.active <Worksheet \"Admissions\"> >>> xlsfile._active_sheet_index 0 >>> xlsfile._active_sheet_index = 1 >>> xlsfile.active <Worksheet \"Directors\">","text_count":155,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt; xlsfile.active\n&lt;Worksheet \"Admissions\"&gt;\n&gt;&gt;&gt; xlsfile._active_sheet_index\n0\n&gt;&gt;&gt; xlsfile._active_sheet_index = 1\n&gt;&gt;&gt; xlsfile.active\n&lt;Worksheet \"Directors\"&gt;"}]}]},{"block_type":"element","block":"k67ev7kp","search_text":"The sheet can also be copied using .copy_worksheet . Be aware that some data, for example, charts, won't be carried over. Most duplicated information will be cell data:","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The sheet can also be copied using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".copy_worksheet"}]},{"block_type":"text","content":". Be aware that some data, for example, charts, won't be carried over. Most duplicated information will be cell data:"}]},{"block_type":"element","block":"k67ev7kq","search_text":"new_copied_sheet = xlsfile.copy_worksheet(source_sheet)","text_count":55,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"new_copied_sheet = xlsfile.copy_worksheet(source_sheet)"}]}]},{"block_type":"element","block":"k67ev7kr","search_text":"The full openpyxl documentation can be found here:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:"}]},{"block_type":"element","block":"k67ev7ks","search_text":"https://openpyxl.readthedocs.io/en/stable/index.html .","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/index.html"},"children":[{"block_type":"text","content":"https://openpyxl.readthedocs.io/en/stable/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7kt","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7ku","search_text":"The Reading an Excel spreadsheet recipe The Updating an Excel spreadsheet and adding comments recipe The Creating charts in Excel recipe The Working with format in Excel recipe ","text_count":177,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet and adding comments"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating charts in Excel"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Working with format in Excel"}]},{"block_type":"text","content":"&nbsp;recipe"}]}]},{"block_type":"element","block":"k67ev7kv","search_text":"Creating charts in Excel","text_count":24,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating charts in Excel"}]},{"block_type":"element","block":"k67ev7kw","search_text":"Spreadsheets include a lot of tools to deal with data, including presenting the data in colorful charts. Let's see how to append a chart programmatically to an Excel spreadsheet.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Spreadsheets include a lot of tools to deal with data, including presenting the data in colorful charts. Let's see how to append a chart programmatically to an Excel spreadsheet."}]},{"block_type":"element","block":"k67ev7kx","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7ky","search_text":"We will use the module openpyxl . We should install the module, adding it to our requirements.txt file as follows:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the module&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":". &nbsp;We should install the module,&nbsp;adding it to our"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file as follows:"}]},{"block_type":"element","block":"k67ev7kz","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7l0","search_text":"We'll store in the new file information about the movies with the most attendance. Data is extracted from here:","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll store in the new file information about the movies with the most attendance. Data is extracted from&nbsp;here:"}]},{"block_type":"element","block":"k67ev7l1","search_text":"http://www.mrob.com/pub/film-video/topadj.html .","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.mrob.com/pub/film-video/topadj.html"},"children":[{"block_type":"text","content":"http://www.mrob.com/pub/film-video/topadj.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7l2","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7l3","search_text":"Import the openpyxl module and create a new Excel file: ","text_count":56,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;module and create a new Excel file:"}]}]},{"block_type":"element","block":"k67ev7l4","search_text":">>> import openpyxl >>> from openpyxl.chart import BarChart, Reference >>> xlsfile = openpyxl.Workbook()","text_count":104,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import openpyxl\n&gt;&gt;&gt; from openpyxl.chart import BarChart, Reference\n&gt;&gt;&gt; xlsfile = openpyxl.Workbook()"}]}]},{"block_type":"element","block":"k67ev7l5","search_text":"Add data about the number of attendees in this sheet from the source. Only the first three are added for simplicity: ","text_count":117,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add data about the number of attendees in this sheet from the source. Only the first three are added for simplicity:"}]}]},{"block_type":"element","block":"k67ev7l6","search_text":">>> data = [ ... ('Name', 'Admissions'), ... ('Gone With the Wind', 225.7), ... ('Star Wars', 194.4), ... ('ET: The Extraterrestrial', 161.0), ... ] >>> sheet = xlsfile['Sheet'] >>> for row in data: ... sheet.append(row)","text_count":220,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = [\n...     ('Name', 'Admissions'),\n...     ('Gone With the Wind', 225.7),\n...     ('Star Wars', 194.4),\n...     ('ET: The Extraterrestrial', 161.0),\n... ]\n&gt;&gt;&gt; sheet = xlsfile['Sheet']\n&gt;&gt;&gt; for row in data:\n... sheet.append(row)"}]}]},{"block_type":"element","block":"k67ev7l7","search_text":"Create a BarChart object and fill it with basic information: ","text_count":61,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BarChart"}]},{"block_type":"text","content":"object and fill it with basic information:"}]}]},{"block_type":"element","block":"k67ev7l8","search_text":">>> chart = BarChart() >>> chart.title = \"Admissions per movie\" >>> chart.y_axis.title = 'Millions'","text_count":99,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; chart = BarChart()\n&gt;&gt;&gt; chart.title = \"Admissions per movie\"\n&gt;&gt;&gt; chart.y_axis.title = 'Millions'"}]}]},{"block_type":"element","block":"k67ev7l9","search_text":"Create a reference to the data , and append the data to the chart: ","text_count":67,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a reference to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":", and append the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":"to the chart:"}]}]},{"block_type":"element","block":"k67ev7la","search_text":">>> data = Reference(sheet, min_row=2, max_row=4, min_col=1, max_col=2) >>> chart.add_data(data, from_rows=True, titles_from_data=True)","text_count":135,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = Reference(sheet, min_row=2, max_row=4, min_col=1, max_col=2)\n&gt;&gt;&gt; chart.add_data(data, from_rows=True, titles_from_data=True)"}]}]},{"block_type":"element","block":"k67ev7lb","search_text":"Add the chart to the sheet and save the file: ","text_count":46,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the chart to the sheet and save the file:"}]}]},{"block_type":"element","block":"k67ev7lc","search_text":">>> sheet.add_chart(chart, \"A6\") >>> xlsfile.save('movie_chart.xlsx')","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; sheet.add_chart(chart, \"A6\")\n&gt;&gt;&gt; xlsfile.save('movie_chart.xlsx')"}]}]},{"block_type":"element","block":"k67ev7ld","search_text":"Check the resulting chart in the spreadsheet, as shown in the following screenshot: ","text_count":84,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the resulting chart in the spreadsheet, as shown in the following screenshot:"}]}]},{"block_type":"element","block":"k67ev7le","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000025.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7lf","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7lg","search_text":"In the How to do it… section, after preparing the data in steps 1 and 2, the data is ready in the range A1:B4 . Note that A1 and B1 both contain a header that should not be used in the chart.","text_count":191,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, after preparing the data in steps 1 and 2, the data is ready in the range"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A1:B4"}]},{"block_type":"text","content":". Note that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A1"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B1"}]},{"block_type":"text","content":"&nbsp;both contain a header that should not be used in the chart."}]},{"block_type":"element","block":"k67ev7lh","search_text":"In step 3, we set up the new chart and include the basic data, such as a title and the units of the Y axis.","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 3, we set up the new chart and include the basic data, such as a title and the units of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis."}]},{"block_type":"element","block":"k67ev7li","search_text":"Note The title is changed to Millions ; although a more correct way would been Admissions(millions) , it'd be redundant with the full title of the chart. ","text_count":154,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The title is changed to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Millions"}]},{"block_type":"text","content":"; although a more correct way would been"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Admissions(millions)"}]},{"block_type":"text","content":", it'd be redundant with the full title of the chart."}]}]},{"block_type":"element","block":"k67ev7lj","search_text":"Step 4 creates a reference box through a Reference object, from row 2 column 1 to row 4 column 2, which is the area where our data lives, excluding the header. The data is added to the chart with .add_data . from_rows makes each row a different data series. titles_from_data makes the first column treated as the name of the series.","text_count":332,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 creates a reference box through a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Reference"}]},{"block_type":"text","content":"object, from row 2 column 1 to row 4 column 2, which is the area where our data lives, excluding the header. The data is added to the chart with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".add_data"}]},{"block_type":"text","content":".&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"from_rows"}]},{"block_type":"text","content":"makes each row a different data series.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"titles_from_data"}]},{"block_type":"text","content":"makes the first column treated as the name of the series."}]},{"block_type":"element","block":"k67ev7lk","search_text":"The chart is added to cell A6 in step 5 and saved to disk.","text_count":58,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The chart is added to cell"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A6"}]},{"block_type":"text","content":"in step 5 and saved to disk."}]},{"block_type":"element","block":"k67ev7ll","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7lm","search_text":"There are a bunch of different charts that can be created, including bar charts, line charts, area charts (line charts that fill the area between the line and the axis), pie charts, or scatter charts (XY charts where one value is plotted against the other). Each kind of chart has an equivalent class, for example PieChart or LineChart .","text_count":337,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are a bunch of different charts that can be created, including bar charts, line charts, area charts (line charts that fill the area between the line and the axis), pie charts, or scatter charts (XY charts where one value is plotted against the other). Each kind of chart has an equivalent class, for example&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PieChart"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LineChart"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7ln","search_text":"Each one, at the same time, can have different types. For example, the default type for BarChart is column, printing the bars vertically, but they can also be printed in vertical, selecting a different type:","text_count":207,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each one, at the same time, can have different types. For example, the default type for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BarChart"}]},{"block_type":"text","content":"is column, printing the bars vertically, but they can also be printed in vertical, selecting a different type:"}]},{"block_type":"element","block":"k67ev7lo","search_text":">>> chart.type = 'bar'","text_count":22,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; chart.type = 'bar'"}]}]},{"block_type":"element","block":"k67ev7lp","search_text":"Check the openpyxl documentation to see all available combinations.","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;documentation to see all available combinations."}]},{"block_type":"element","block":"k67ev7lq","search_text":"Instead of extracting the x axis labels from the data, they can be set explicitly with set_categories . For example, compare step 4 with the following code:","text_count":156,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Instead of extracting the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"x&nbsp;"}]},{"block_type":"text","content":"axis labels from the data, they can be set explicitly with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"set_categories"}]},{"block_type":"text","content":". For example, compare step 4 with the following code:"}]},{"block_type":"element","block":"k67ev7lr","search_text":"data = Reference(sheet, min_row=2, max_row=4, min_col=2, max_col=2) labels = Reference(sheet, min_row=2, max_row=4, min_col=1, max_col=1) chart.add_data(data, from_rows=False, titles_from_data=False) chart.set_categories(labels)","text_count":228,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"data = Reference(sheet, min_row=2, max_row=4, min_col=2, max_col=2)\nlabels = Reference(sheet, min_row=2, max_row=4, min_col=1, max_col=1)\nchart.add_data(data, from_rows=False, titles_from_data=False)\nchart.set_categories(labels)"}]}]},{"block_type":"element","block":"k67ev7ls","search_text":"The range, instead of using a Reference object, can also be input with text labels describing the region:","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The range, instead of using a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Reference"}]},{"block_type":"text","content":"object, can also be input with text labels describing the region:"}]},{"block_type":"element","block":"k67ev7lt","search_text":"chart.add_data('Sheet!B2:B4', from_rows=False, titles_from_data=False) chart.set_categories('Sheet!A2:A4')","text_count":106,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"chart.add_data('Sheet!B2:B4', from_rows=False, titles_from_data=False)\nchart.set_categories('Sheet!A2:A4')"}]}]},{"block_type":"element","block":"k67ev7lu","search_text":"This way of describing it may be more difficult to deal with if the range of data needs to be created programatically.","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This way of describing it may be more difficult to deal with if the range of data needs to be created programatically."}]},{"block_type":"element","block":"k67ev7lv","search_text":"Tip Defining charts in Excel correctly can be difficult sometimes. The way Excel extracts the data from a particular range can be baffling. Remember to allow time for trial and error, and to deal with differences. For example, in step 4 we define three series with one data point, while in the preceding code we define a single series with three data points. Most of those differences are subtle. Finally, the most important point is how the end chart looks. Try different chart types and learn the differences. ","text_count":512,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Defining charts in Excel correctly can be difficult sometimes. The way Excel extracts the data from a particular range can be baffling. Remember to allow time for trial and error, and to deal with differences. For example, in step 4 we define three series with one data point, while in the preceding code we define a single series with three data points. Most of those differences are subtle. Finally, the most important point is how the end chart looks. Try different chart types and learn the differences."}]}]},{"block_type":"element","block":"k67ev7lw","search_text":"The full openpyxl documentation can be found here:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:"}]},{"block_type":"element","block":"k67ev7lx","search_text":"https://openpyxl.readthedocs.io/en/stable/index.html .","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/index.html"},"children":[{"block_type":"text","content":"https://openpyxl.readthedocs.io/en/stable/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7ly","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7lz","search_text":"The Reading an Excel spreadsheet recipe The Updating an Excel spreadsheet and adding comments recipe The Creating new sheets on an Excel spreadsheet recipe The Working with format in Excel recipe ","text_count":196,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet and adding comments"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating new sheets on an Excel spreadsheet"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Working with format in Excel"}]},{"block_type":"text","content":"&nbsp;recipe"}]}]},{"block_type":"element","block":"k67ev7m0","search_text":"Working with format in Excel","text_count":28,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Working with format in Excel"}]},{"block_type":"element","block":"k67ev7m1","search_text":"Presenting information in spreadsheets is not just a matter of organizing it into cells or displaying it graphically in charts, but also involves changing the format to highlight the important points about it. In this recipe, we'll see how to manipulate the format of cells to enhance the data and present it in the best way.","text_count":325,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Presenting information in spreadsheets is not just a matter of organizing it into cells or displaying it graphically in charts, but also involves changing the format to highlight the important points about it. In this recipe, we'll see how to manipulate the format of cells to enhance the data and present it in the best way."}]},{"block_type":"element","block":"k67ev7m2","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7m3","search_text":"We will use the module openpyxl . We should install the module, adding it to our requirements.txt file as follows:","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the module&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":". &nbsp;We should install the module, adding it to our&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"&nbsp;file as follows:"}]},{"block_type":"element","block":"k67ev7m4","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ pip install -r requirements.txt","text_count":78,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7m5","search_text":"We'll store in the new file information about the movies with the most attendance. Data is extracted from here:","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll store in the new file information about the movies with the most attendance. Data is extracted from&nbsp;here:"}]},{"block_type":"element","block":"k67ev7m6","search_text":"http://www.mrob.com/pub/film-video/topadj.html .","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.mrob.com/pub/film-video/topadj.html"},"children":[{"block_type":"text","content":"http://www.mrob.com/pub/film-video/topadj.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7m7","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7m8","search_text":"Import the openpyxl module and create a new Excel file: ","text_count":56,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;module and create a new Excel file:"}]}]},{"block_type":"element","block":"k67ev7m9","search_text":">>> import openpyxl >>> from openpyxl.styles import Font, PatternFill, Border, Side >>> xlsfile = openpyxl.Workbook()","text_count":117,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import openpyxl\n&gt;&gt;&gt; from openpyxl.styles import Font, PatternFill, Border, Side\n&gt;&gt;&gt; xlsfile = openpyxl.Workbook()"}]}]},{"block_type":"element","block":"k67ev7ma","search_text":"Add data about the number of attendees in this sheet from the source. Only the first four are added, for simplicity: ","text_count":117,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add data about the number of attendees in this sheet from the source. Only the first four are added, for simplicity:"}]}]},{"block_type":"element","block":"k67ev7mb","search_text":">>> data = [ ... ('Name', 'Admissions'), ... ('Gone With the Wind', 225.7), ... ('Star Wars', 194.4), ... ('ET: The Extraterrestrial', 161.0), ... ('The Sound of Music', 156.4), ] >>> sheet = xlsfile['Sheet'] >>> for row in data: ... sheet.append(row)","text_count":251,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = [\n...    ('Name', 'Admissions'),\n...    ('Gone With the Wind', 225.7),\n...    ('Star Wars', 194.4),\n...    ('ET: The Extraterrestrial', 161.0),\n...    ('The Sound of Music', 156.4),\n]\n&gt;&gt;&gt; sheet = xlsfile['Sheet']\n&gt;&gt;&gt; for row in data:\n...    sheet.append(row)"}]}]},{"block_type":"element","block":"k67ev7mc","search_text":"Define the colors to use for styling the spreadsheet: ","text_count":54,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the colors to use for styling the spreadsheet:"}]}]},{"block_type":"element","block":"k67ev7md","search_text":">>> BLUE = \"0033CC\" >>> LIGHT_BLUE = 'E6ECFF' >>> WHITE = \"FFFFFF\"","text_count":66,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; BLUE = \"0033CC\"\n&gt;&gt;&gt; LIGHT_BLUE = 'E6ECFF'\n&gt;&gt;&gt; WHITE = \"FFFFFF\""}]}]},{"block_type":"element","block":"k67ev7me","search_text":"Define the header in a blue background and a white font: ","text_count":57,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the header in a blue background and a white font:"}]}]},{"block_type":"element","block":"k67ev7mf","search_text":">>> header_font = Font(name='Tahoma', size=14, color=WHITE) >>> header_fill = PatternFill(\"solid\", fgColor=BLUE) >>> for row in sheet['A1:B1']: ... for cell in row: ... cell.font = header_font ... cell.fill = header_fill","text_count":220,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; header_font = Font(name='Tahoma', size=14, color=WHITE)\n&gt;&gt;&gt; header_fill = PatternFill(\"solid\", fgColor=BLUE)\n&gt;&gt;&gt; for row in sheet['A1:B1']:\n...     for cell in row:\n...         cell.font = header_font\n...         cell.fill = header_fill"}]}]},{"block_type":"element","block":"k67ev7mg","search_text":"Define an alternate pattern for the columns and a border on each row after the header: ","text_count":87,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define an alternate pattern for the columns and a border on each row after the header:"}]}]},{"block_type":"element","block":"k67ev7mh","search_text":">>> white_side = Side(border_style='thin', color=WHITE) >>> blue_side = Side(border_style='thin', color=BLUE) >>> alternate_fill = PatternFill(\"solid\", fgColor=LIGHT_BLUE) >>> border = Border(bottom=blue_side, left=white_side, right=white_side) >>> for row_index, row in enumerate(sheet['A2:B5']): ... for cell in row: ... cell.border = border ... if row_index % 2: ... cell.fill = alternate_fill","text_count":396,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; white_side = Side(border_style='thin', color=WHITE)\n&gt;&gt;&gt; blue_side = Side(border_style='thin', color=BLUE)\n&gt;&gt;&gt; alternate_fill = PatternFill(\"solid\", fgColor=LIGHT_BLUE)\n&gt;&gt;&gt; border = Border(bottom=blue_side, left=white_side, right=white_side)\n&gt;&gt;&gt; for row_index, row in enumerate(sheet['A2:B5']):\n...     for cell in row:\n...         cell.border = border\n...         if row_index % 2:\n...             cell.fill = alternate_fill"}]}]},{"block_type":"element","block":"k67ev7mi","search_text":"Save the file as movies_format.xlsx : ","text_count":38,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the file as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies_format.xlsx"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7mj","search_text":">>> xlsfile.save('movies_format.xlsx')","text_count":38,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; xlsfile.save('movies_format.xlsx')"}]}]},{"block_type":"element","block":"k67ev7mk","search_text":"Check the resulting file: ","text_count":26,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the resulting file:&nbsp;"}]}]},{"block_type":"element","block":"k67ev7ml","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000003.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7mm","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7mn","search_text":"In the How to do it… section, in step 1 we import the openpyxl module and create a new Excel file. In step 2, we add the data to the first sheet. Step 3 is also a preparation step to define the colors to be used. The colors are defined in hex format, which is common in the web design world.","text_count":291,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;&nbsp;"}]},{"block_type":"text","content":"section, in step 1 we import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"module and create a new Excel file. In step 2, we add the data to the first sheet. Step 3 is also a preparation step to define the colors to be used. The colors are defined in hex format, which is common in the web design world."}]},{"block_type":"element","block":"k67ev7mo","search_text":"Tip To find the definition of colors, there are plenty of color pickers online or even embedded in the OS. A tool like https://coolors.co/ can be useful to define a palette to work with. ","text_count":187,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To find the definition of colors, there are plenty of color pickers online or even embedded in the OS. A tool like"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://coolors.co/"},"children":[{"block_type":"text","content":"https://coolors.co/"}]},{"block_type":"text","content":"&nbsp;can be useful to define a palette to work with."}]}]},{"block_type":"element","block":"k67ev7mp","search_text":"In step 4, we prepare the format to define the header. The header will have a different font (Tahoma), a bigger size (14pt), and it will be white on a blue background. To do this, we prepare a Font object with the font, size, and foreground color, and a PatternFill with the background color.","text_count":292,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 4, we prepare the format to define the header. The header will have a different font (Tahoma), a bigger size (14pt), and it will be white on a blue background. To do this, we prepare a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Font"}]},{"block_type":"text","content":"object with the font, size, and foreground color, and a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PatternFill"}]},{"block_type":"text","content":"with the background color."}]},{"block_type":"element","block":"k67ev7mq","search_text":"The loop after creating header_font and header_fill applies the font and fill to the proper cells.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The loop after creating"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"header_font"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"header_fill"}]},{"block_type":"text","content":"applies the font and fill to the proper cells."}]},{"block_type":"element","block":"k67ev7mr","search_text":"Note Note that iterating over a range always returns the row, then cells, even if only one row is involved. ","text_count":108,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that iterating over a range always returns the row, then cells, even if only one row is involved."}]}]},{"block_type":"element","block":"k67ev7ms","search_text":"In step 5, a border to the rows and an alternate background is applied. The border is defined with blue top and bottom and white left and right. The fill is created in a similar way to step 4, but in a light blue. The background is only applied to even rows.","text_count":258,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 5, a border to the rows and an alternate background is applied. The border is defined with blue top and bottom and white left and right. The fill is created in a similar way to step 4, but in a light blue. The background is only applied to even rows."}]},{"block_type":"element","block":"k67ev7mt","search_text":"Note Note that the top border of a cell is the bottom of the one above and vice versa. This means that it's possible to overwrite the border in a loop. ","text_count":152,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the top border of a cell is the bottom of the one above and vice versa. This means that it's possible to overwrite the border in a loop."}]}]},{"block_type":"element","block":"k67ev7mu","search_text":"The file is saved finally in step 6.","text_count":36,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The file is saved finally in step 6."}]},{"block_type":"element","block":"k67ev7mv","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7mw","search_text":"To define the font, there are other options available, such as bold, italic, strikeout, or underline. Define the font and reassign it if you need to change any of its elements. And remember to check that the font is available.","text_count":226,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To define the font, there are other options available, such as bold, italic, strikeout, or underline. Define the font and reassign it if you need to change any of its elements. And remember to check that the font is available."}]},{"block_type":"element","block":"k67ev7mx","search_text":"There are also various ways of creating a fill. The PatternFill accepts several patterns, but the most useful one is solid . GradientFill can also be used to apply a two-color gradient.","text_count":185,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are also various ways of creating a fill. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PatternFill"}]},{"block_type":"text","content":"accepts several patterns, but the most useful one is&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"solid"}]},{"block_type":"text","content":".&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GradientFill"}]},{"block_type":"text","content":"can also be used to apply a two-color gradient."}]},{"block_type":"element","block":"k67ev7my","search_text":"Tip It's best to limit yourself to solid fills using PatternFill . You can tweak the color to best represent what you want. Remember to include style='solid' , or the colour may not appear. ","text_count":190,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's best to limit yourself to solid fills using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PatternFill"}]},{"block_type":"text","content":". You can tweak the color to best represent what you want. Remember to include&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"style='solid'"}]},{"block_type":"text","content":", or the colour may not appear."}]}]},{"block_type":"element","block":"k67ev7mz","search_text":"It's also possible to define conditional formatting, but it's better to try to define the conditionals in Python and then apply the proper formatting.","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It's also possible to define conditional formatting, but it's better to try to define the conditionals in Python and then apply the proper formatting."}]},{"block_type":"element","block":"k67ev7n0","search_text":"Number formatting can be set up properly, for example:","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Number formatting can be set up properly, for example:"}]},{"block_type":"element","block":"k67ev7n1","search_text":"cell.style = 'Percent'","text_count":22,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"cell.style = 'Percent'"}]}]},{"block_type":"element","block":"k67ev7n2","search_text":"This will display the value 0.37 as 37% .","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This will display the value"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0.37"}]},{"block_type":"text","content":"as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"37%"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7n3","search_text":"The full openpyxl documentation can be found here:","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:"}]},{"block_type":"element","block":"k67ev7n4","search_text":"https://openpyxl.readthedocs.io/en/stable/index.html .","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/index.html"},"children":[{"block_type":"text","content":"https://openpyxl.readthedocs.io/en/stable/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7n5","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7n6","search_text":"The Reading an Excel spreadsheet recipe The Updating an Excel spreadsheet and adding comments recipe The Creating new sheets on an Excel spreadsheet recipe The Creating charts in Excel recipe ","text_count":192,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet and adding comments&nbsp;"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"&nbsp;Creating new sheets on an Excel spreadsheet"}]},{"block_type":"text","content":"&nbsp;recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating charts in Excel&nbsp;"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7n7","search_text":"Creating a macro in LibreOffice","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating a macro in LibreOffice"}]},{"block_type":"element","block":"k67ev7n8","search_text":"LibreOffice is a free office suite that's an alternative to MS Office and other office packages. It includes a text editor and a spreadsheet program called Calc . Calc understands the regular Excel formats, and it's also totally scriptable internally through its UNO API. The UNO interface allows programmatic access to the suite, and it's accessible in different languages, such as Java.","text_count":388,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"LibreOffice is a free office suite that's an alternative to MS Office and other office packages. It includes a text editor and a spreadsheet program called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Calc"}]},{"block_type":"text","content":". Calc understands the regular Excel formats, and it's also totally scriptable internally through its UNO API. The UNO interface allows programmatic access to the suite, and it's accessible in different languages, such as Java."}]},{"block_type":"element","block":"k67ev7n9","search_text":"One of the available language is Python, making it very easy to generate very complex applications in a suite format, as this enables the use of the full Python standard library.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One of the available language is Python, making it very easy to generate very complex applications in a suite format, as this enables the use of the full Python standard library."}]},{"block_type":"element","block":"k67ev7na","search_text":"Tip Using the full Python standard library give access to elements such as cryptography; opening external files, including ZIP files; or connecting to remote databases. Also, take advantage of the Python syntax and avoid dealing with LibreOffice BASIC. ","text_count":253,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using the full Python standard library give access to elements such as cryptography; opening external files, including ZIP&nbsp;files; or connecting to remote databases. Also, take advantage of the Python syntax and avoid dealing with LibreOffice BASIC."}]}]},{"block_type":"element","block":"k67ev7nb","search_text":"We'll see in this recipe how to add an external Python file as a macro that will change the contents of a spreadsheet.","text_count":118,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll see in this recipe how to add an external Python file as a macro that will change the contents of a spreadsheet."}]},{"block_type":"element","block":"k67ev7nc","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7nd","search_text":"LibreOffice needs to be installed. It is available at https://www.libreoffice.org/ .","text_count":84,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"LibreOffice needs to be installed. It is available at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.libreoffice.org/"},"children":[{"block_type":"text","content":"https://www.libreoffice.org/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7ne","search_text":"Once downloaded and installed, it needs to be configured to allow the execution of macros:","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once downloaded and installed, it needs to be configured to allow the execution of macros:"}]},{"block_type":"element","block":"k67ev7nf","search_text":"Go to Settings | Security to find the Macro Security details: ","text_count":62,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Go to Settings | Security to find the Macro Security details:"}]}]},{"block_type":"element","block":"k67ev7ng","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000052.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7nh","search_text":"Open Macro Security and select Medium to allow execution of our macros. This will display a warning before allowing us to run a macro: ","text_count":135,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open&nbsp;Macro Security and select Medium to allow execution of our macros. This will display a warning before allowing us to run a macro:"}]}]},{"block_type":"element","block":"k67ev7ni","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000068.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7nj","search_text":"To insert the macro into the file, we'll use a script called include_macro.py , which is available at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/include_macro.py . The script with the macro is also available as libreoffice_script.py here:","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To insert the macro into the file, we'll use a script called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"include_macro.py"}]},{"block_type":"text","content":", which is available at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/include_macro.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/include_macro.py"}]},{"block_type":"text","content":". The script with the macro is also available as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"libreoffice_script.py"}]},{"block_type":"text","content":"here:"}]},{"block_type":"element","block":"k67ev7nk","search_text":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/libreoffice_script.py .","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/libreoffice_script.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/libreoffice_script.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7nl","search_text":"The file to put the script into, called movies.ods , is also available here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.ods . It contains, in the .ods format (LibreOffice format), a table with the 10 movies with highest admissions. Data is extracted from here:","text_count":308,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The file to put the script into, called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.ods"}]},{"block_type":"text","content":", is also available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.ods"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter06/movies.ods"}]},{"block_type":"text","content":". It contains, in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ods"}]},{"block_type":"text","content":"format (LibreOffice format), a table with the 10 movies with highest admissions. Data is extracted from&nbsp;here:"}]},{"block_type":"element","block":"k67ev7nm","search_text":"http://www.mrob.com/pub/film-video/topadj.html .","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.mrob.com/pub/film-video/topadj.html"},"children":[{"block_type":"text","content":"http://www.mrob.com/pub/film-video/topadj.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7nn","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7no","search_text":"Use the include_macro.py script to attach the libreoffice_script.py to the file movies.ods macrofile: ","text_count":102,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"include_macro.py"}]},{"block_type":"text","content":"&nbsp;script to attach the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"libreoffice_script.py"}]},{"block_type":"text","content":"to the file"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.ods"}]},{"block_type":"text","content":"macrofile:"}]}]},{"block_type":"element","block":"k67ev7np","search_text":"$ python include_macro.py -h usage: It inserts the macro file \"script\" into the file \"spreadsheet\" in .ods format. The resulting file is located in the macro_file directory, that will be created [-h] spreadsheet script positional arguments: spreadsheet File to insert the script script Script to insert in the file optional arguments: -h, --help show this help message and exit $ python include_macro.py movies.ods libreoffice_script.py","text_count":436,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python include_macro.py -h\nusage: It inserts the macro file \"script\" into the file \"spreadsheet\" in .ods format. The resulting file is located in the macro_file directory, that will be created\n       [-h] spreadsheet script\n\npositional arguments:\n  spreadsheet File to insert the script\n  script Script to insert in the file\n\noptional arguments:\n  -h, --help show this help message and exit\n\n$ python include_macro.py movies.ods libreoffice_script.py"}]}]},{"block_type":"element","block":"k67ev7nq","search_text":"Open the resulting file, macro_file/movies.ods , in LibreOffice. Notice that it shows a warning to enable the macros (click on Enable). Go to Tools | Macros | Run Macro: ","text_count":170,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the resulting file,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"macro_file/movies.ods"}]},{"block_type":"text","content":", in LibreOffice. Notice that it shows a warning to enable the macros (click on Enable). Go to Tools | Macros | Run Macro:"}]}]},{"block_type":"element","block":"k67ev7nr","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000006.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7ns","search_text":"Select the ObtainAggregated under movies.ods | libreoffice_script macro and click on Run. It calculates the aggregated admissions and stores them in cell B12 . It adds a Total label in A15 : ","text_count":191,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ObtainAggregated"}]},{"block_type":"text","content":"under"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"movies.ods"}]},{"block_type":"text","content":"&nbsp;|"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"libreoffice_script"}]},{"block_type":"text","content":"&nbsp;macro and click on Run. It calculates the aggregated admissions and stores them in cell"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B12"}]},{"block_type":"text","content":". It adds a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Total"}]},{"block_type":"text","content":"label in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A15"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7nt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000059.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7nu","search_text":"Repeat steps 2 and 3 to run it again. Now it runs all the aggregations, but adds B12 and gets the result in B13 : ","text_count":114,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Repeat steps 2 and 3 to run it again. Now it runs all the aggregations, but adds"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B12"}]},{"block_type":"text","content":"and gets the result in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B13"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7nv","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000032.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7nw","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7nx","search_text":"The main work in step 1 is done in the include_macro.py script. It copies the file into the macro_file subdirectory to avoid modifying the input.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main work in step 1 is done in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"include_macro.py"}]},{"block_type":"text","content":"script. It copies the file into the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"macro_file"}]},{"block_type":"text","content":"&nbsp;subdirectory to avoid modifying the input."}]},{"block_type":"element","block":"k67ev7ny","search_text":"Internally, an .ods file is a ZIP file with a certain structure. The script takes advantage of the ZIP file Python module to add the script in the proper subdirectory internally. It also modifies the manifest.xml file to allow LibreOffice to know there's a script inside the file.","text_count":280,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Internally, an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ods"}]},{"block_type":"text","content":"file is a ZIP file with a certain structure. The script takes advantage of the ZIP file Python module to add the script in the proper subdirectory internally. It also modifies the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"manifest.xml"}]},{"block_type":"text","content":"file to allow LibreOffice to know there's a script inside the file."}]},{"block_type":"element","block":"k67ev7nz","search_text":"The macro that is executed in step 3 is defined in libreoffice_script.py and contains a single function:","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The macro that is executed in step 3 is defined in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"libreoffice_script.py"}]},{"block_type":"text","content":"&nbsp;and contains a single function:"}]},{"block_type":"element","block":"k67ev7o0","search_text":"def ObtainAggregated(*args): \"\"\"Prints the Python version into the current document\"\"\" # get the doc from the scripting context # which is made available to all scripts desktop = XSCRIPTCONTEXT.getDesktop() model = desktop.getCurrentComponent() # get the first sheet sheet = model.Sheets.getByIndex(0) # Find the admissions column MAX_ELEMENT = 20 for column in range(0, MAX_ELEMENT): cell = sheet.getCellByPosition(column, 0) if 'Admissions' in cell.String: break else: raise Exception('Admissions not found') accumulator = 0.0 for row in range(1, MAX_ELEMENT): cell = sheet.getCellByPosition(column, row) value = cell.getValue() if value: accumulator += cell.getValue() else: break cell = sheet.getCellByPosition(column, row) cell.setValue(accumulator) cell = sheet.getCellRangeByName(\"A15\") cell.String = 'Total' return None","text_count":827,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def ObtainAggregated(*args):\n    \"\"\"Prints the Python version into the current document\"\"\"\n    # get the doc from the scripting context\n    # which is made available to all scripts\n    desktop = XSCRIPTCONTEXT.getDesktop()\n    model = desktop.getCurrentComponent()\n    # get the first sheet\n    sheet = model.Sheets.getByIndex(0)\n\n    # Find the admissions column\n    MAX_ELEMENT = 20\n    for column in range(0, MAX_ELEMENT):\n        cell = sheet.getCellByPosition(column, 0)\n        if 'Admissions' in cell.String:\n            break\n    else:\n        raise Exception('Admissions not found')\n\n    accumulator = 0.0\n    for row in range(1, MAX_ELEMENT):\n        cell = sheet.getCellByPosition(column, row)\n        value = cell.getValue()\n        if value:\n            accumulator += cell.getValue()\n        else:\n            break\n\n    cell = sheet.getCellByPosition(column, row)\n    cell.setValue(accumulator)\n\n    cell = sheet.getCellRangeByName(\"A15\")\n    cell.String = 'Total'\n    return None"}]}]},{"block_type":"element","block":"k67ev7o1","search_text":"The variable XSCRIPTCONTEXT is created automatically and allowed to get the current component, and from there, the first Sheet . After that, the sheet is iterated to find the Admissions column through .getCellByPosition and obtain the string value with the .String attribute. With the same method, it aggregates all the values in the column, extracting them through .getValue to get their numerical values.","text_count":406,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The variable&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"XSCRIPTCONTEXT"}]},{"block_type":"text","content":"is created automatically and allowed to get the current component, and from there, the first"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sheet"}]},{"block_type":"text","content":". After that, the sheet is iterated to find the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Admissions"}]},{"block_type":"text","content":"column through&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".getCellByPosition&nbsp;"}]},{"block_type":"text","content":"and obtain the string value with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".String"}]},{"block_type":"text","content":"attribute. With the same method, it aggregates all the values in the column, extracting them through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".getValue"}]},{"block_type":"text","content":"to get their numerical values."}]},{"block_type":"element","block":"k67ev7o2","search_text":"Note As the loop iterates through the column until finding an empty cell, the second time it's executed it will aggregate the value in B12 , which is the aggregated value in the previous execution. This is done on purpose to show that macros can be executed multiple times, with different results. ","text_count":298,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As the loop iterates through the column until finding an empty cell, the second time it's executed it will aggregate the value in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"B12"}]},{"block_type":"text","content":", which is the aggregated value in the previous execution. This is done on purpose to show that macros can be executed multiple times, with different results."}]}]},{"block_type":"element","block":"k67ev7o3","search_text":"Cells can also be referenced by their string position through .getCellRangeByName , to store Total in cell A15 .","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Cells can also be referenced by their string position through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".getCellRangeByName"}]},{"block_type":"text","content":", to store"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Total"}]},{"block_type":"text","content":"in cell"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A15"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7o4","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7o5","search_text":"The Python interpreter is embedded into LibreOffice, meaning that the specific version can change if LibreOffice changes. In the latest version of LibreOffice at the time of writing this book (6.0.5), the version included was Python 3.5.1.","text_count":239,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The Python interpreter is embedded into LibreOffice, meaning that the specific version can change if LibreOffice changes. In the latest version of LibreOffice at the time of writing this book (6.0.5), the version included was Python 3.5.1."}]},{"block_type":"element","block":"k67ev7o6","search_text":"The UNO interface is very complete and allows you to access a lot of advanced elements. Unfortunately, the documentation is not great, and achieving it can be complicated and time consuming. The documentation is defined in Java or C++, and there are examples in LibreOffice BASIC or other languages, but few for Python. The full documentation can be found at: https://api.libreoffice.org/ , and the reference is here:","text_count":417,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The UNO interface is very complete and allows you to access a lot of advanced elements. Unfortunately, the documentation is not great, and achieving it can be complicated and time consuming. The documentation is defined in Java or C++, and there are examples in LibreOffice BASIC or other languages, but few for Python. The full documentation can be found at:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://api.libreoffice.org/"},"children":[{"block_type":"text","content":"https://api.libreoffice.org/"}]},{"block_type":"text","content":", and the reference is here:"}]},{"block_type":"element","block":"k67ev7o7","search_text":"https://api.libreoffice.org/docs/idl/ref/index.html .","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"a","attributes":{"href":"https://api.libreoffice.org/docs/idl/ref/index.html"},"children":[{"block_type":"text","content":"https://api.libreoffice.org/docs/idl/ref/index.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7o8","search_text":"Tip For example, it is possible to create complex charts or even interactive dialogs that ask for and process responses from the user. There's a lot of information in forums and old answers. The code in BASIC is also adaptable to Python most of the time. ","text_count":255,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, it is possible to create&nbsp;complex charts or even interactive dialogs that ask for and process responses from the user. There's a lot of information in forums and old answers. The code in BASIC is also adaptable to Python most of the time."}]}]},{"block_type":"element","block":"k67ev7o9","search_text":"LibreOffice is a fork of a previous project called OpenOffice. UNO was already available, meaning that some references will be found when searching the internet that refer to OpenOffice.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"LibreOffice is a fork of a previous project called OpenOffice. UNO was already available, meaning that some references will be found when searching the internet that refer to OpenOffice."}]},{"block_type":"element","block":"k67ev7oa","search_text":"Remember that LibreOffice is capable of reading and writing Excel files. Some features may not be 100% compatible; for example, there may be formatting issues.","text_count":159,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember that LibreOffice is capable of&nbsp;reading and writing Excel files.&nbsp;Some features may not be 100% compatible;&nbsp;for example, there may be formatting issues."}]},{"block_type":"element","block":"k67ev7ob","search_text":"Tip For the same reason, it is totally possible to generate a file in Excel format with the tools described in other recipes of this chapter and open it with LibreOffice. That can be a good approach as the documentation is better for openpyxl . ","text_count":245,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For the same reason, it is totally possible to generate a file in Excel format with the tools described in other recipes of this chapter and open it with LibreOffice. That can be a good approach as the documentation is better for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev7oc","search_text":"Debugging can also be tricky on occasion. Remember to ensure that a file is fully closed before reopening it with new code.","text_count":123,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Debugging can also be tricky on occasion. Remember to ensure that a file is fully closed before reopening it with new code."}]},{"block_type":"element","block":"k67ev7od","search_text":"UNO is also capable of working with other parts of the LibreOffice suite, such as for creating documents.","text_count":105,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"UNO is also capable of working with other parts of the LibreOffice suite, such as for creating documents."}]},{"block_type":"element","block":"k67ev7oe","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7of","search_text":"The Writing a CSV spreadsheet recipe The Updating an Excel spreadsheet and adding comments and formulas recipe ","text_count":111,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Writing a CSV spreadsheet"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet and adding comments and formulas"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Developing Stunning Graphs","author":"Jaime Buelta","block":"k67euo1i","number":7,"contents":[{"block_type":"element","block":"k67ev7og","search_text":"The following recipes will be covered in this chapter:","text_count":54,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following recipes will be covered in this chapter:"}]},{"block_type":"element","block":"k67ev7oh","search_text":"Plotting a simple sales graph Drawing stacked bars Plotting pie charts Displaying multiple lines Drawing a scatter plot Visualizing maps Adding legends and annotations Combining graphs Saving charts ","text_count":199,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Plotting a simple sales graph"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Drawing stacked bars"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Plotting pie charts"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Displaying multiple lines"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Drawing a scatter plot"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Visualizing maps"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Saving charts"}]}]},{"block_type":"element","block":"k67ev7oi","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev7oj","search_text":"Graphs and images are fantastic ways of presenting complex data in a way that's easily understandable. In this chapter, we will make use of the powerful matplotlib library to learn how to create all kinds of graphs. matplotlib is a library that's aimed at displaying data in multiple ways, and it can create absolute stunning plots that will help transmit and display information in the best way.","text_count":396,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Graphs and images are fantastic ways of presenting complex data in a way that's easily understandable. In this chapter, we will make use of the powerful"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;library to learn how to create all kinds of graphs."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"is a library that's aimed at displaying data in multiple ways, and it can create absolute stunning plots that will help transmit and display information in the best way."}]},{"block_type":"element","block":"k67ev7ok","search_text":"The graphs we'll cover will go from simple bar graphs to line or pie charts, and combine multiple plots in the same graph, annotate them, or even draw geographical maps.","text_count":169,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The graphs we'll cover will go from simple bar graphs to line or pie charts, and combine multiple plots in the same graph, annotate them, or even draw geographical maps."}]},{"block_type":"element","block":"k67ev7ol","search_text":"Plotting a simple sales graph","text_count":29,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Plotting a simple sales graph"}]},{"block_type":"element","block":"k67ev7om","search_text":"In this recipe, we'll see how to draw a sales graph by drawing bars proportional to sales in different periods.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to draw a sales graph by drawing bars proportional to sales in different periods."}]},{"block_type":"element","block":"k67ev7on","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7oo","search_text":"We can install matplotlib in our virtual environment using the following commands:","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We can install"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"in our virtual environment using the following commands:"}]},{"block_type":"element","block":"k67ev7op","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7oq","search_text":"In some OSes, this may require us to install additional packages; for example, in Ubuntu it may require us to run apt-get install python3-tk . Check the matplolib docs for details.","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In some OSes, this may require us to install additional packages; for example, in Ubuntu it may require us to run&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"apt-get install python3-tk"}]},{"block_type":"text","content":". Check the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"docs for details."}]},{"block_type":"element","block":"k67ev7or","search_text":"If you are using macOS, it's possible that you'll get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":226,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you'll get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7os","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7ot","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7ou","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7ov","search_text":"Prepare the data to be displayed on the graph: ","text_count":47,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data to be displayed on the graph:"}]}]},{"block_type":"element","block":"k67ev7ow","search_text":">>> DATA = ( ... ('Q1 2017', 100), ... ('Q2 2017', 150), ... ('Q3 2017', 125), ... ('Q4 2017', 175), ... )","text_count":106,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...    ('Q1 2017', 100),\n...    ('Q2 2017', 150),\n...    ('Q3 2017', 125),\n...    ('Q4 2017', 175),\n... )"}]}]},{"block_type":"element","block":"k67ev7ox","search_text":"Split the data into usable formats for the graph. This is a preparation step: ","text_count":78,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Split the data into usable formats for the graph. This is a preparation step:"}]}]},{"block_type":"element","block":"k67ev7oy","search_text":">>> POS = list(range(len(DATA))) >>> VALUES = [value for label, value in DATA] >>> LABELS = [label for label, value in DATA]","text_count":124,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; POS = list(range(len(DATA)))\n&gt;&gt;&gt; VALUES = [value for label, value in DATA]\n&gt;&gt;&gt; LABELS = [label for label, value in DATA]"}]}]},{"block_type":"element","block":"k67ev7oz","search_text":"Create a bar graph with the data: ","text_count":34,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a bar graph with the data:"}]}]},{"block_type":"element","block":"k67ev7p0","search_text":">>> plt.bar(POS, VALUES) >>> plt.xticks(POS, LABELS) >>> plt.ylabel('Sales')","text_count":76,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.bar(POS, VALUES)\n&gt;&gt;&gt; plt.xticks(POS, LABELS)\n&gt;&gt;&gt; plt.ylabel('Sales')"}]}]},{"block_type":"element","block":"k67ev7p1","search_text":"Display the graph: ","text_count":19,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the graph:"}]}]},{"block_type":"element","block":"k67ev7p2","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7p3","search_text":"The result will be displayed as follows in a new window: ","text_count":57,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed as follows in a new window:"}]}]},{"block_type":"element","block":"k67ev7p4","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000048.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7p5","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7p6","search_text":"After importing the module, the data is presented in step 2 from the How to do it… section in a convenient way, which will likely be similar to the way the data was originally stored.","text_count":183,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the module, the data is presented in step 2 from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section in a convenient way, which will likely be similar to the way the data was originally stored."}]},{"block_type":"element","block":"k67ev7p7","search_text":"Because of the way matplotlib works, it requires an X component as well as a Y component. In this case, our X component is just a sequence of integers, as many as data points. We create that in POS . In VALUES , we store the numeric value of the sales as a sequence, and in LABELS the associated label for each data point. All that preparation work is done in step 3.","text_count":367,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Because of the way"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"works, it requires an"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"component as well as a"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"component. In this case, our"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"component is just a sequence of integers, as many as data points. We create that in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":". In"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUES"}]},{"block_type":"text","content":", we store the numeric value of the sales as a sequence, and in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LABELS"}]},{"block_type":"text","content":"the associated label for each data point. All that preparation work is done in step 3."}]},{"block_type":"element","block":"k67ev7p8","search_text":"Step 4 creates the bar graph, with the sequences X ( POS ) and Y ( VALUES ). These define our bars. To specify the period it refers to, we put labels on the x axis for each value with .xticks in the same way. To clarify the meaning, we add a label with .ylabel .","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 creates the bar graph, with the sequences"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":") and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUES"}]},{"block_type":"text","content":"). These define our bars. To specify the period it refers to, we put labels on the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"x"}]},{"block_type":"text","content":"axis for each value with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":"&nbsp;in the same way. To clarify the meaning, we add a label with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7p9","search_text":"To display the resulting graph, step 5 calls .show , which opens a new window with the result.","text_count":94,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To display the resulting&nbsp; graph, step 5 calls"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":", which opens a new window with the result."}]},{"block_type":"element","block":"k67ev7pa","search_text":"Tip Calling .show blocks the execution of the program. The program will resume when the window is closed. ","text_count":106,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"blocks the execution of the program. The program will resume when the window is closed."}]}]},{"block_type":"element","block":"k67ev7pb","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7pc","search_text":"You may want to change the format in which the values are presented. In our example, maybe the numbers represent millions of dollars. To do so, you can add a formatter to the y axis, so the values represented there will have it applied to them:","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You may want to change the format in which the values are presented. In our example, maybe the numbers represent millions of dollars. To do so, you can add a formatter to the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"y"}]},{"block_type":"text","content":"axis, so the values represented there will have it applied to them:"}]},{"block_type":"element","block":"k67ev7pd","search_text":">>> from matplotlib.ticker import FuncFormatter >>> def value_format(value, position): ... return '$ {}M'.format(int(value)) >>> axes = plt.gca() >>> axes.yaxis.set_major_formatter(FuncFormatter(value_format))","text_count":209,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from matplotlib.ticker import FuncFormatter\n\n&gt;&gt;&gt; def value_format(value, position):\n...    return '$ {}M'.format(int(value))\n\n&gt;&gt;&gt; axes = plt.gca()\n&gt;&gt;&gt; axes.yaxis.set_major_formatter(FuncFormatter(value_format))"}]}]},{"block_type":"element","block":"k67ev7pe","search_text":"value_format is a function that returns a value based on the value and position of the data. Here, it will return the value 100 as $ 100 M .","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"value_format"}]},{"block_type":"text","content":"is a function that returns a value based on the value and position of the data. Here, it will return the value 100 as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"$ 100 M"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7pf","search_text":"Tip Values will be retrieved as floats, requiring you to transform them into integers for display. ","text_count":99,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Values will be retrieved as floats, requiring you to transform them into integers for display."}]}]},{"block_type":"element","block":"k67ev7pg","search_text":"To apply the formatter, we need to retrieve the axis object with .gca (get current axes). Then, the .yaxis gets the formatter.","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To apply the formatter, we need to retrieve the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"axis"}]},{"block_type":"text","content":"object with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".gca"}]},{"block_type":"text","content":"(get current axes). Then, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".yaxis"}]},{"block_type":"text","content":"gets the formatter."}]},{"block_type":"element","block":"k67ev7ph","search_text":"The color of the bars can also be determined with the color parameter. Colors can be specified in multiple formats, as described in https://matplotlib.org/api/colors_api.html , but my favorite is following the XKCD color survey, using the xkcd: prefix (no space after the colon):","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The color of the bars can also be determined with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"color"}]},{"block_type":"text","content":"parameter.&nbsp;Colors can be specified in multiple formats, as described in"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/api/colors_api.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/api/colors_api.html"}]},{"block_type":"text","content":", but my favorite&nbsp;is following the XKCD color survey, using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xkcd:"}]},{"block_type":"text","content":"prefix (no space after the colon):"}]},{"block_type":"element","block":"k67ev7pi","search_text":">>> plt.bar(POS, VALUES, color='xkcd:moss green')","text_count":49,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.bar(POS, VALUES, color='xkcd:moss green')"}]}]},{"block_type":"element","block":"k67ev7pj","search_text":"The full survey can be found here: https://xkcd.com/color/rgb/ .","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full survey can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://xkcd.com/color/rgb/"},"children":[{"block_type":"text","content":"https://xkcd.com/color/rgb/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7pk","search_text":"Tip Most common colors, such as blue or red, are also available for quick tests. They tend to be a little bright to be used in good-looking reports, though. ","text_count":157,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Most common colors, such as blue or red, are also available for quick tests. They tend to be a little bright to be used in good-looking reports, though."}]}]},{"block_type":"element","block":"k67ev7pl","search_text":"Combining the color with formatting the axis gives the following result:","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Combining the color with formatting the axis gives the following result:"}]},{"block_type":"element","block":"k67ev7pm","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000064.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7pn","search_text":"Bar graphs don't need to display information in a temporal way. As we've seen, matplotlib requires us to specify the X parameter of each bar. That's a powerful tool to generate all kinds of graphs.","text_count":197,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Bar graphs don't need to display information in a temporal way.&nbsp;As we've seen,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;requires us to specify the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"parameter of each bar. That's a powerful tool to generate all kinds of graphs."}]},{"block_type":"element","block":"k67ev7po","search_text":"Tip For example, the bars can be arranged to display a histogram, such as for displaying people of a certain height. The bars will start at a low height, increase to the average size, and then drop back. Don't limit yourself to just spreadsheet charts! ","text_count":253,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, the bars can be arranged to display a histogram, such as for displaying people of a certain height. The bars will start at a low height, increase to the average size, and then drop back. Don't limit yourself to just spreadsheet charts!"}]}]},{"block_type":"element","block":"k67ev7pp","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ .","text_count":78,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7pq","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7pr","search_text":"The Drawing stacked bars recipe The Adding legends and annotations recipe The Combining graphs recipe ","text_count":102,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Drawing stacked bars"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7ps","search_text":"Drawing stacked bars","text_count":20,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Drawing stacked bars"}]},{"block_type":"element","block":"k67ev7pt","search_text":"A powerful way of displaying different categories is to present them as stacked bars, so each of the categories and the total are displayed. We'll see in this recipe how to do that.","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A powerful way of displaying different categories is to present them as stacked bars, so each of the categories and the total are displayed. We'll see in this recipe how to do that."}]},{"block_type":"element","block":"k67ev7pu","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7pv","search_text":"We need to install matplotlib in our virtual environment:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7pw","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7px","search_text":"If you are using macOS, it's possible that you get an error like this: RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this:&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7py","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7pz","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7q0","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7q1","search_text":"Prepare the data. This represents two products' sales, one established, and a new one: ","text_count":87,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data. This represents two products' sales, one established, and a new one:"}]}]},{"block_type":"element","block":"k67ev7q2","search_text":">>> DATA = ( ... ('Q1 2017', 100, 0), ... ('Q2 2017', 105, 15), ... ('Q3 2017', 125, 40), ... ('Q4 2017', 115, 80), ... )","text_count":121,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...     ('Q1 2017', 100, 0),\n...     ('Q2 2017', 105, 15),\n...     ('Q3 2017', 125, 40),\n...     ('Q4 2017', 115, 80),\n... )"}]}]},{"block_type":"element","block":"k67ev7q3","search_text":"Process the data to prepare the expected format: ","text_count":49,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Process the data to prepare the expected format:"}]}]},{"block_type":"element","block":"k67ev7q4","search_text":">>> POS = list(range(len(DATA))) >>> VALUESA = [valueA for label, valueA, valueB in DATA] >>> VALUESB = [valueB for label, valueA, valueB in DATA] >>> LABELS = [label for label, value1, value2 in DATA]","text_count":201,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; POS = list(range(len(DATA)))\n&gt;&gt;&gt; VALUESA = [valueA for label, valueA, valueB in DATA]\n&gt;&gt;&gt; VALUESB = [valueB for label, valueA, valueB in DATA]\n&gt;&gt;&gt; LABELS = [label for label, value1, value2 in DATA]"}]}]},{"block_type":"element","block":"k67ev7q5","search_text":"Create the bar plot. Two plots are required: ","text_count":45,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the bar plot. Two plots are required:"}]}]},{"block_type":"element","block":"k67ev7q6","search_text":">>> plt.bar(POS, VALUESB) >>> plt.bar(POS, VALUESA, bottom=VALUESB) >>> plt.ylabel('Sales') >>> plt.xticks(POS, LABELS)","text_count":119,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.bar(POS, VALUESB)\n&gt;&gt;&gt; plt.bar(POS, VALUESA, bottom=VALUESB)\n&gt;&gt;&gt; plt.ylabel('Sales')\n&gt;&gt;&gt; plt.xticks(POS, LABELS)"}]}]},{"block_type":"element","block":"k67ev7q7","search_text":"Display the graph: ","text_count":19,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the graph:"}]}]},{"block_type":"element","block":"k67ev7q8","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7q9","search_text":"The result will be displayed in a new window as follows: ","text_count":57,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window as follows:"}]}]},{"block_type":"element","block":"k67ev7qa","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000037.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7qb","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7qc","search_text":"After importing the module, the data is presented in step 2 in a convenient way, which will likely be similar to the way the data was originally stored.","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the module, the data is presented in step 2 in a convenient way, which will likely be similar to the way the data was originally stored."}]},{"block_type":"element","block":"k67ev7qd","search_text":"In step 3, the data is prepared in three sequences, VALUESA , VALUEB , and LABELS . A POS sequence to correctly position the bars is added.","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 3, the data is prepared in three sequences,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUEB"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LABELS"}]},{"block_type":"text","content":". A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":"sequence to correctly position the bars is added."}]},{"block_type":"element","block":"k67ev7qe","search_text":"Step 4 creates the bar graph, with the sequences X ( POS ) and Y ( VALUESB ). The second bar sequence, VALUESA , is added on top of the previous one, using the bottom parameter. This stacks the bars.","text_count":199,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 creates the bar graph, with the sequences"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":") and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":"). The second bar sequence,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":", is added on top of the previous one, using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"bottom"}]},{"block_type":"text","content":"parameter. This stacks the bars."}]},{"block_type":"element","block":"k67ev7qf","search_text":"Note Notice that we stack the second value, VALUESB , first. The second value represents a new product introduced in the market, while VALUESA is more stable. This better shows the growth of the new product. ","text_count":208,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that we stack the second value,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":", first. The second value represents a new product introduced in the market, while"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":"is more stable. This better&nbsp;shows the growth of the new product."}]}]},{"block_type":"element","block":"k67ev7qg","search_text":"Each of the periods is labeled on the X axis with .xticks . To clarify the meaning, we add a label with .ylabel .","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the periods is labeled on the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"axis with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":". To clarify the meaning, we add a label with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7qh","search_text":"To display the resulting graph, step 5 calls .show , which opens a new window with the result.","text_count":94,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To display the resulting graph, step 5 calls"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":", which opens a new window with the result."}]},{"block_type":"element","block":"k67ev7qi","search_text":"Tip Calling .show blocks the execution of the program. The program will resume when the window is closed. ","text_count":106,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"blocks the execution of the program. The program will resume when the window is closed."}]}]},{"block_type":"element","block":"k67ev7qj","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7qk","search_text":"Another way of presenting stacked bars is adding them as percentages, so the total doesn't change, only the relative sizes compared to each other.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another way of presenting stacked bars is adding them as percentages, so the total doesn't change, only the relative sizes compared to each other."}]},{"block_type":"element","block":"k67ev7ql","search_text":"To do that, VALUESA and VALUEB need to be calculated relative to the percentages in this way:","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To do that,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUEB"}]},{"block_type":"text","content":"need to be calculated relative to the percentages in this way:"}]},{"block_type":"element","block":"k67ev7qm","search_text":">>> VALUESA = [100 * valueA / (valueA + valueB) for label, valueA, valueB in DATA] >>> VALUESB = [100 * valueB / (valueA + valueB) for label, valueA, valueB in DATA]","text_count":165,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; VALUESA = [100 * valueA / (valueA + valueB) for label, valueA, valueB in DATA]\n&gt;&gt;&gt; VALUESB = [100 * valueB / (valueA + valueB) for label, valueA, valueB in DATA]"}]}]},{"block_type":"element","block":"k67ev7qn","search_text":"This makes each value equal to the percentage of the total, and the total always adds up to 100 . This produces the following graphic:","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This makes each value equal to the percentage of the total, and the total always adds up to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"100"}]},{"block_type":"text","content":". This produces the following graphic:"}]},{"block_type":"element","block":"k67ev7qo","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000017.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7qp","search_text":"The bars doesn't necessarily need to be stacked. Sometimes, it may be interesting to present the bars one against the other for comparison. ","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The bars doesn't necessarily need to be stacked. Sometimes, it may be interesting to present the bars one against the other for comparison.&nbsp;"}]},{"block_type":"element","block":"k67ev7qq","search_text":"To do that, we need to move the position of the second bar sequence. We'll need also to set thinner bars to allow space:","text_count":120,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To do that, we need to move the position of the second bar sequence. We'll need also to set thinner bars to allow space:"}]},{"block_type":"element","block":"k67ev7qr","search_text":">>> WIDTH = 0.3 >>> plt.bar([p - WIDTH / 2 for p in POS], VALUESA, width=WIDTH) >>> plt.bar([p + WIDTH / 2 for p in POS], VALUESB, width=WIDTH)","text_count":143,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; WIDTH = 0.3\n&gt;&gt;&gt; plt.bar([p - WIDTH / 2 for p in POS], VALUESA, width=WIDTH)\n&gt;&gt;&gt; plt.bar([p + WIDTH / 2 for p in POS], VALUESB, width=WIDTH)"}]}]},{"block_type":"element","block":"k67ev7qs","search_text":"Note how the width of the bar is set to a third of the space, as our reference space is 1 between the bars. The first bar is moved to the left and the second to the right to center them. The bottom argument has been deleted to not stack the bars:","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note how the width of the bar is set to a third of the space, as our reference space is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"between the bars. The first bar is moved to the left and the second to the right to center them. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"bottom"}]},{"block_type":"text","content":"argument has been deleted to not stack the bars:"}]},{"block_type":"element","block":"k67ev7qt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000031.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7qu","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ .","text_count":78,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7qv","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7qw","search_text":"The Plotting a simple sales graph recipe The Adding legends and annotations recipe The Combining graphs recipe ","text_count":111,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Plotting a simple sales graph"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7qx","search_text":"Plotting pie charts","text_count":19,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Plotting pie charts"}]},{"block_type":"element","block":"k67ev7qy","search_text":"Pie charts! A Business 101 favorite, and a common way of presenting percentages. We'll see in this recipe how to plot a pie chart, with different slices representing proportions.","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pie charts! A Business 101 favorite, and a common way of presenting percentages. We'll see in this recipe how to plot a pie chart, with different slices representing proportions."}]},{"block_type":"element","block":"k67ev7qz","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7r0","search_text":"We need to install matplotlib in our virtual environment using the following commands:","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment using the following commands:"}]},{"block_type":"element","block":"k67ev7r1","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7r2","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplotlib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7r3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7r4","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7r5","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7r6","search_text":"Prepare the data. This represents several lines of products: ","text_count":61,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data. This represents several lines of products:"}]}]},{"block_type":"element","block":"k67ev7r7","search_text":">>> DATA = ( ... ('Common', 100), ... ('Premium', 75), ... ('Luxurious', 50), ... ('Extravagant', 20), ... )","text_count":108,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...     ('Common', 100),\n...     ('Premium', 75),\n...     ('Luxurious', 50),\n...     ('Extravagant', 20),\n... )"}]}]},{"block_type":"element","block":"k67ev7r8","search_text":"Process the data to prepare the expected format: ","text_count":49,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Process the data to prepare the expected format:"}]}]},{"block_type":"element","block":"k67ev7r9","search_text":">>> VALUES = [value for label, value in DATA] >>> LABELS = [label for label, value in DATA]","text_count":91,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; VALUES = [value for label, value in DATA]\n&gt;&gt;&gt; LABELS = [label for label, value in DATA]"}]}]},{"block_type":"element","block":"k67ev7ra","search_text":"Create the pie chart: ","text_count":22,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the pie chart:"}]}]},{"block_type":"element","block":"k67ev7rb","search_text":">>> plt.pie(VALUES, labels=LABELS, autopct='%1.1f%%') >>> plt.gca().axis('equal')","text_count":81,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.pie(VALUES, labels=LABELS, autopct='%1.1f%%')\n&gt;&gt;&gt; plt.gca().axis('equal')"}]}]},{"block_type":"element","block":"k67ev7rc","search_text":"Display the graph: ","text_count":19,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the graph:"}]}]},{"block_type":"element","block":"k67ev7rd","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7re","search_text":"The result will be displayed in a new window as follows: ","text_count":57,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window as follows:"}]}]},{"block_type":"element","block":"k67ev7rf","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000046.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7rg","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7rh","search_text":"The module is imported in step 1 of the How to do it… section, and the data to present is imported in step 2. The data is separated into two components, a list of VALUES and a list of LABELS , in step 3.","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The module is imported in step 1 of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, and the data to present is imported in step 2. The data is separated into two components, a list of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUES"}]},{"block_type":"text","content":"and a list of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LABELS"}]},{"block_type":"text","content":", in step 3."}]},{"block_type":"element","block":"k67ev7ri","search_text":"The creation of the chart happens in step 4. The pie chart is created by adding VALUES and LABELS . The autopct parameter formats the value so it displays it as a percentage to a single decimal place. ","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The creation of the chart happens in step 4. The pie chart is created by adding"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUES"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LABELS"}]},{"block_type":"text","content":". The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"autopct"}]},{"block_type":"text","content":"&nbsp;parameter formats the value so it displays it as a percentage to a single decimal place.&nbsp;"}]},{"block_type":"element","block":"k67ev7rj","search_text":"The call to axis ensure the pie chart will look round, instead of having a bit of perspective and appearing as an oval.","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"axis"}]},{"block_type":"text","content":"&nbsp;ensure&nbsp;the pie chart will look round, instead of having a bit of perspective and appearing as an oval."}]},{"block_type":"element","block":"k67ev7rk","search_text":"To display the resulting graph, step 5 calls .show , which opens a new window with the result.","text_count":94,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To display the resulting&nbsp; graph, step 5 calls&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":", which opens a new window with the result."}]},{"block_type":"element","block":"k67ev7rl","search_text":"Tip Calling .show blocks the execution of the program. The program will resume when the window is closed. ","text_count":106,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"&nbsp;blocks the execution of the program. The program will resume when the window is closed."}]}]},{"block_type":"element","block":"k67ev7rm","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7rn","search_text":"Pie charts are a little overused in business graphs. Most of the time, a bar chart with percentages or values will be a better way of visualizing the data, especially if more than two or three options are displayed. Try to limit the use of pie charts in your reports and data presentations.","text_count":290,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Pie charts are a little overused in business graphs. Most of the time, a bar chart with percentages or values will be a better way of visualizing&nbsp;the data, especially if more than two or three options are displayed. Try to limit the use of pie charts in your reports and data presentations."}]},{"block_type":"element","block":"k67ev7ro","search_text":"Rotating the start of the wedges is possible with the startangle parameter, and the direction to set up the wedges is defined by counterclock (defaults to True ):","text_count":162,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Rotating the start of the wedges is possible with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"startangle"}]},{"block_type":"text","content":"&nbsp;parameter, and the direction to set up the wedges is defined by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"counterclock"}]},{"block_type":"text","content":"(defaults to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":"):"}]},{"block_type":"element","block":"k67ev7rp","search_text":">>> plt.pie(VALUES, labels=LABELS, startangle=90, counterclock=False)","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.pie(VALUES, labels=LABELS, startangle=90, counterclock=False)"}]}]},{"block_type":"element","block":"k67ev7rq","search_text":"The format inside the label can be set by a function. As the value inside the pie is defined as a percentage, finding the original value can be a little tricky. The following snippet creates a dictionary indexing by its percentage as an integer, so we can retrieve the referenced value. Please note that this assumes that no percentage gets repeated. If that's the case, the labels may be slightly incorrect. In that case, we may need to use up to the first decimal place for better precision:","text_count":493,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The format inside the label can be set by a function. As the value inside the pie is defined as a percentage, finding the original value can be a little tricky. The following snippet creates a dictionary indexing by its percentage as an integer, so we can retrieve the referenced value.&nbsp;Please note that this assumes that no percentage gets repeated. If that's the case, the labels may be slightly incorrect. In that case, we may need to use up to the first decimal place for better precision:"}]},{"block_type":"element","block":"k67ev7rr","search_text":">>> from matplotlib.ticker import FuncFormatter >>> total = sum(value for label, value in DATA) >>> BY_VALUE = {int(100 * value / total): value for label, value in DATA} >>> def value_format(percent, **kwargs): ... value = BY_VALUE[int(percent)] ... return '{}'.format(value)","text_count":275,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from matplotlib.ticker import FuncFormatter\n\n&gt;&gt;&gt; total = sum(value for label, value in DATA)\n&gt;&gt;&gt; BY_VALUE = {int(100 * value / total): value for label, value in DATA}\n\n&gt;&gt;&gt; def value_format(percent, **kwargs):\n...     value = BY_VALUE[int(percent)]\n...     return '{}'.format(value)"}]}]},{"block_type":"element","block":"k67ev7rs","search_text":"One or more wedges can also be separated by using the explode parameter. This specifies how separated the wedge is from the center:","text_count":131,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One or more wedges can also be separated by using the explode parameter. This specifies how separated the wedge is from the center:"}]},{"block_type":"element","block":"k67ev7rt","search_text":">>> explode = (0, 0, 0.1, 0) >>> plt.pie(VALUES, labels=LABELS, explode=explode, autopct=value_format, startangle=90, counterclock=False)","text_count":137,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; explode = (0, 0, 0.1, 0)\n&gt;&gt;&gt; plt.pie(VALUES, labels=LABELS, explode=explode, autopct=value_format,\n            startangle=90, counterclock=False)"}]}]},{"block_type":"element","block":"k67ev7ru","search_text":"Combining all these options, we get the following result:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Combining all these options, we get the following result:"}]},{"block_type":"element","block":"k67ev7rv","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000022.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7rw","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ .","text_count":78,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7rx","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7ry","search_text":"The Plotting a simple sales graph recipe The Drawing stacked bars recipe ","text_count":73,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Plotting a simple sales graph"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Drawing stacked bars"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7rz","search_text":"Displaying multiple lines","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Displaying multiple lines"}]},{"block_type":"element","block":"k67ev7s0","search_text":"This recipe will show how to display multiple lines in a graph.","text_count":63,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe will show how to display multiple lines in a graph."}]},{"block_type":"element","block":"k67ev7s1","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7s2","search_text":"We need to install matplotlib in our virtual environment:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7s3","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7s4","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7s5","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7s6","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7s7","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7s8","search_text":"Prepare the data. This represents two products' sales: ","text_count":55,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data. This represents two products' sales:"}]}]},{"block_type":"element","block":"k67ev7s9","search_text":">>> DATA = ( ... ('Q1 2017', 100, 5), ... ('Q2 2017', 105, 15), ... ('Q3 2017', 125, 40), ... ('Q4 2017', 115, 80), ... )","text_count":121,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...     ('Q1 2017', 100, 5),\n...     ('Q2 2017', 105, 15),\n...     ('Q3 2017', 125, 40),\n...     ('Q4 2017', 115, 80),\n... )"}]}]},{"block_type":"element","block":"k67ev7sa","search_text":"Process the data to prepare the expected format: ","text_count":49,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Process the data to prepare the expected format:"}]}]},{"block_type":"element","block":"k67ev7sb","search_text":">>> POS = list(range(len(DATA))) >>> VALUESA = [valueA for label, valueA, valueB in DATA] >>> VALUESB = [valueB for label, valueA, valueB in DATA] >>> LABELS = [label for label, value1, value2 in DATA]","text_count":201,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; POS = list(range(len(DATA)))\n&gt;&gt;&gt; VALUESA = [valueA for label, valueA, valueB in DATA]\n&gt;&gt;&gt; VALUESB = [valueB for label, valueA, valueB in DATA]\n&gt;&gt;&gt; LABELS = [label for label, value1, value2 in DATA]"}]}]},{"block_type":"element","block":"k67ev7sc","search_text":"Create the line plot. Two lines are required: ","text_count":46,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create the line plot. Two lines are required:"}]}]},{"block_type":"element","block":"k67ev7sd","search_text":">>> plt.plot(POS, VALUESA, 'o-') >>> plt.plot(POS, VALUESB, 'o-') >>> plt.ylabel('Sales') >>> plt.xticks(POS, LABELS)","text_count":117,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.plot(POS, VALUESA, 'o-')\n&gt;&gt;&gt; plt.plot(POS, VALUESB, 'o-')\n&gt;&gt;&gt; plt.ylabel('Sales')\n&gt;&gt;&gt; plt.xticks(POS, LABELS)"}]}]},{"block_type":"element","block":"k67ev7se","search_text":"Display the graph: ","text_count":19,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the graph:"}]}]},{"block_type":"element","block":"k67ev7sf","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7sg","search_text":"The result will be displayed in a new window: ","text_count":46,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window:"}]}]},{"block_type":"element","block":"k67ev7sh","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000015.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7si","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7sj","search_text":"In the How to do it… section, step 1 imports the module and step 2 shows the data to be plotted in a formatted way.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, step 1 imports the module and step 2 shows the data to be plotted in a formatted way."}]},{"block_type":"element","block":"k67ev7sk","search_text":"In step 3, the data is prepared in three sequences, VALUESA , VALUEB , and LABELS . A POS sequence to correctly position each point is added.","text_count":141,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 3, the data is prepared in three sequences,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":",&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUEB"}]},{"block_type":"text","content":",&nbsp;and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LABELS"}]},{"block_type":"text","content":". A&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":"&nbsp;sequence to correctly position each point is added."}]},{"block_type":"element","block":"k67ev7sl","search_text":"Step 4 creates the graph, with the sequences X ( POS ) and Y ( VALUESA ), and then POS and VALUESB . The value of 'o-' is added to draw a circle on each of the data points and a full line between them.","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 creates the graph, with the sequences"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":") and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":"), and then"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POS"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":". The value of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'o-'"}]},{"block_type":"text","content":"is added to draw a circle on each of the data points and a full line between them."}]},{"block_type":"element","block":"k67ev7sm","search_text":"Note By default, the plot will display a solid line, with no marker on each point. If only the marker is used (that is, 'o' ), there'll be no line. ","text_count":148,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By default, the plot will display a solid line, with no marker on each point. If only the marker is used (that is,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'o'"}]},{"block_type":"text","content":"), there'll be no line."}]}]},{"block_type":"element","block":"k67ev7sn","search_text":"Each of the periods is labeled on the X axis with .xticks . To clarify the meaning, we add a label with .ylabel .","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each of the periods is labeled on the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"axis with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":". To clarify the meaning, we add a label with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7so","search_text":"To display the resulting graph, step 5 calls .show , which opens a new window with the result.","text_count":94,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To display the resulting graph, step 5 calls&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":", which opens a new window with the result."}]},{"block_type":"element","block":"k67ev7sp","search_text":"Tip Calling .show blocks the execution of the program. The program will resume when the window is closed. ","text_count":106,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"&nbsp;blocks the execution of the program. The program will resume when the window is closed."}]}]},{"block_type":"element","block":"k67ev7sq","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7sr","search_text":"Graphs with lines are deceptively simple and able to create a lot of interesting representations. It is probably the most convenient when showing mathematical graphs. For example, we can display a graph showing Moore's Law in a few lines of code.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Graphs with lines are deceptively simple and able to create a lot of interesting representations. It is probably the most convenient when showing mathematical graphs. For example, we can display a graph showing Moore's Law in a few lines of code."}]},{"block_type":"element","block":"k67ev7ss","search_text":"Tip Moore's Law is an observation by Gordon Moore that the number of components in an integrated circuit doubles every two years. It was first described in 1965 and then corrected in 1975. It seems to be quite close to the historic rate of technological advancement over the last 40 years. ","text_count":290,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Moore's Law is an observation by Gordon Moore that the number of components in an integrated circuit doubles every two years. It was first described in 1965 and then corrected in 1975. It seems to be quite close to the historic rate of technological advancement over the last 40 years."}]}]},{"block_type":"element","block":"k67ev7st","search_text":"We first create a line describing the theoretical line, with data points from 1970 to 2013. Starting with 1000 transistors, we double it every two years, up to 2013:","text_count":165,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We first create a line describing the theoretical line, with data points from 1970 to 2013. Starting with 1000 transistors, we double it every two years, up to 2013:"}]},{"block_type":"element","block":"k67ev7su","search_text":">>> POS = [year for year in range(1970, 2013)] >>> MOORES = [1000 * (2 ** (i * 0.5)) for i in range(len(POS))] >>> plt.plot(POS, MOORES)","text_count":136,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; POS = [year for year in range(1970, 2013)]\n&gt;&gt;&gt; MOORES = [1000 * (2 ** (i * 0.5)) for i in range(len(POS))]\n&gt;&gt;&gt; plt.plot(POS, MOORES)"}]}]},{"block_type":"element","block":"k67ev7sv","search_text":"Following some documentation, we extract a few examples of commercial CPUs, their year of release, and their number of integrated components from here: http://www.wagnercg.com/Portals/0/FunStuff/AHistoryofMicroprocessorTransistorCount.pdf . Due to the big numbers, we'll use the notation of 1_000_000 for a million, available in Python 3:","text_count":338,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Following some documentation, we extract a few examples of commercial CPUs, their year of release, and their number of integrated components from here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://www.wagnercg.com/Portals/0/FunStuff/AHistoryofMicroprocessorTransistorCount.pdf"},"children":[{"block_type":"text","content":"http://www.wagnercg.com/Portals/0/FunStuff/AHistoryofMicroprocessorTransistorCount.pdf"}]},{"block_type":"text","content":". Due to the big numbers, we'll use the notation of&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1_000_000"}]},{"block_type":"text","content":"for a million, available in Python 3:"}]},{"block_type":"element","block":"k67ev7sw","search_text":">>> DATA = ( ... ('Intel 4004', 2_300, 1971), ... ('Motorola 68000', 68_000, 1979), ... ('Pentium', 3_100_000, 1993), ... ('Core i7', 731_000_000, 2008), ... )","text_count":159,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...    ('Intel 4004', 2_300, 1971),\n...    ('Motorola 68000', 68_000, 1979),\n...    ('Pentium', 3_100_000, 1993),\n...    ('Core i7', 731_000_000, 2008),\n... )"}]}]},{"block_type":"element","block":"k67ev7sx","search_text":"Draw a line with markers to display those points at the proper places. The 'v' mark will display a triangle:","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Draw a line with markers to display those points at the proper places. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'v'"}]},{"block_type":"text","content":"&nbsp;mark&nbsp;will display a triangle:"}]},{"block_type":"element","block":"k67ev7sy","search_text":">>> data_x = [x for label, y, x in DATA] >>> data_y = [y for label, y, x in DATA] >>> plt.plot(data_x, data_y, 'v')","text_count":115,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data_x = [x for label, y, x in DATA]\n&gt;&gt;&gt; data_y = [y for label, y, x in DATA]\n&gt;&gt;&gt; plt.plot(data_x, data_y, 'v')"}]}]},{"block_type":"element","block":"k67ev7sz","search_text":"For each data point, append a label in the proper place with the name of the CPU:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For each data point, append a label in the proper place with the name of the CPU:"}]},{"block_type":"element","block":"k67ev7t0","search_text":">>> for label, y, x in DATA: >>> plt.text(x, y, label)","text_count":54,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for label, y, x in DATA:\n&gt;&gt;&gt;    plt.text(x, y, label)"}]}]},{"block_type":"element","block":"k67ev7t1","search_text":"Finally, growth doesn't make sense displayed in a linear graph, so we change the scale to be logarithmic, which makes exponential growth look like a straight line. But to keep the sense of dimension, add a grid. Call .show to display the graph:","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, growth doesn't make sense displayed in a linear graph, so we change the scale to be logarithmic, which makes exponential growth look like a straight line. But to keep the sense of dimension, add a grid. Call"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"to display the graph:"}]},{"block_type":"element","block":"k67ev7t2","search_text":">>> plt.gca().grid() >>> plt.yscale('log')","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.gca().grid()\n&gt;&gt;&gt; plt.yscale('log')"}]}]},{"block_type":"element","block":"k67ev7t3","search_text":"The resulting graph will be displayed:","text_count":38,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The resulting graph will be displayed:"}]},{"block_type":"element","block":"k67ev7t4","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000020.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7t5","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ . In particular, check the available formats for the lines (solid, dashed, dotted, and so on) and markers (dot, circle, triangle, star, and so on) here: https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html .","text_count":294,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":". In particular, check the available formats for the lines (solid, dashed, dotted, and so on) and markers (dot, circle, triangle, star, and so on) here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7t6","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7t7","search_text":"The Adding legends and annotations recipe The Combining graphs recipe ","text_count":70,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7t8","search_text":"Drawing a scatter plot","text_count":22,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Drawing a scatter plot"}]},{"block_type":"element","block":"k67ev7t9","search_text":"A scatter plot is one where the information is only displayed as dots with X and Y values. They are very useful when presenting samples and to see whether there's any relationship between two variables. In this recipe, we'll display a graph plotting time spent on a website against money spent, to see whether we can see a pattern.","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A scatter plot is one where the information is only displayed as dots with"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"values. They are very useful when presenting samples and to see whether there's any relationship between two variables. In this recipe, we'll display a graph plotting time spent on a website against money spent, to see whether we can see a pattern."}]},{"block_type":"element","block":"k67ev7ta","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7tb","search_text":"We need to install matplotlib in our virtual environment:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7tc","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7td","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7te","search_text":"As data points, we'll use the scatter.csv file to read the data. This file is available on GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/scatter.csv .","text_count":198,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As data points, we'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"scatter.csv"}]},{"block_type":"text","content":"&nbsp;file&nbsp;to read the data. This file is available on GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/scatter.csv"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/scatter.csv"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7tf","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7tg","search_text":"Import matplotlib and csv . FuncFormatter is also imported to format the axes later: ","text_count":85,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FuncFormatter"}]},{"block_type":"text","content":"is also imported to format the axes later:"}]}]},{"block_type":"element","block":"k67ev7th","search_text":">>> import csv >>> import matplotlib.pyplot as plt >>> from matplotlib.ticker import FuncFormatter","text_count":98,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import csv\n&gt;&gt;&gt; import matplotlib.pyplot as plt\n&gt;&gt;&gt; from matplotlib.ticker import FuncFormatter"}]}]},{"block_type":"element","block":"k67ev7ti","search_text":"Prepare the data, reading from the file using the csv module: ","text_count":62,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data, reading from&nbsp;the file using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev7tj","search_text":">>> with open('scatter.csv') as fp: ... reader = csv.reader(fp) ... data = list(reader)","text_count":87,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('scatter.csv') as fp:\n...    reader = csv.reader(fp)\n...    data = list(reader)"}]}]},{"block_type":"element","block":"k67ev7tk","search_text":"Prepare the data for plotting, and then plot it: ","text_count":49,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data for plotting, and then plot it:"}]}]},{"block_type":"element","block":"k67ev7tl","search_text":">>> data_x = [float(x) for x, y in data] >>> data_y = [float(y) for x, y in data] >>> plt.scatter(data_x, data_y)","text_count":113,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data_x = [float(x) for x, y in data]\n&gt;&gt;&gt; data_y = [float(y) for x, y in data]\n&gt;&gt;&gt; plt.scatter(data_x, data_y)"}]}]},{"block_type":"element","block":"k67ev7tm","search_text":"Improve the context by formatting the axes: ","text_count":44,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Improve the context by formatting the axes:"}]}]},{"block_type":"element","block":"k67ev7tn","search_text":">>> def format_minutes(value, pos): ... return '{}m'.format(int(value)) >>> def format_dollars(value, pos): ... return '${}'.format(value) >>> plt.gca().xaxis.set_major_formatter(FuncFormatter(format_minutes)) >>> plt.xlabel('Time in website') >>> plt.gca().yaxis.set_major_formatter(FuncFormatter(format_dollars)) >>> plt.ylabel('Spending')","text_count":341,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; def format_minutes(value, pos):\n...     return '{}m'.format(int(value))\n&gt;&gt;&gt; def format_dollars(value, pos):\n...     return '${}'.format(value)\n&gt;&gt;&gt; plt.gca().xaxis.set_major_formatter(FuncFormatter(format_minutes))\n&gt;&gt;&gt; plt.xlabel('Time in website')\n&gt;&gt;&gt; plt.gca().yaxis.set_major_formatter(FuncFormatter(format_dollars))\n&gt;&gt;&gt; plt.ylabel('Spending')"}]}]},{"block_type":"element","block":"k67ev7to","search_text":"Show the graph: ","text_count":16,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Show the graph:"}]}]},{"block_type":"element","block":"k67ev7tp","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7tq","search_text":"The result will be displayed in a new window: ","text_count":46,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window:"}]}]},{"block_type":"element","block":"k67ev7tr","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000030.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7ts","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7tt","search_text":"Steps 1 and 2 of the How to do it… section import the modules we'll use later and read the data from the CSV file. The data is transformed into a list to allow us to iterate through it several times, as that's necessary in step 3.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 1 and 2 of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section import the modules we'll use later and read the data from the CSV file. The data is transformed into a list to allow us to iterate through it several times, as that's necessary in step 3."}]},{"block_type":"element","block":"k67ev7tu","search_text":"Step 3 prepares the data in two arrays, and then uses .scatter to plot them. The parameters for .scatter , as with other methods of matplotlib , require an array of X and Y values. They both need to have the same size. The data is converted into float from the file format, to ensure the number format.","text_count":302,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 prepares the data in two arrays, and then uses"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".scatter"}]},{"block_type":"text","content":"to plot them. The parameters for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".scatter"}]},{"block_type":"text","content":", as with other methods of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":", require an array of"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"values. They both need to have the same size. The data is converted into"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"float"}]},{"block_type":"text","content":"from the file format, to ensure the number format."}]},{"block_type":"element","block":"k67ev7tv","search_text":"Step 4 refines the way the data is presented on each of the axis. The same operation is presented twice—a function is created that define how the values on that axis should be displayed (in dollars or in minutes). The function accepts as input the value to display and the position. Typically, the position will be ignored. The axis formatter will be overwritten with .set_major_formatter . Notice that both axes are returned with .gca (get current axes).","text_count":455,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 refines the way the data is presented on each of the axis. The same operation is presented twice&mdash;a function is created that define how the values on that axis should be displayed (in dollars or in minutes). The function accepts as input the value to display and the position. Typically, the position will be ignored. The axis formatter will be overwritten with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".set_major_formatter"}]},{"block_type":"text","content":". Notice that both axes are returned with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".gca"}]},{"block_type":"text","content":"(get current axes)."}]},{"block_type":"element","block":"k67ev7tw","search_text":"A label is added to the axes with .xlabel and .ylabel .","text_count":55,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A label is added to the axes with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xlabel"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7tx","search_text":"Finally, step 5 displays the graph in a new window. Analyzing the result, we can say that there seem to be two kinds of users, ones who spend less that 10 minutes and never spend more than $10, and users who spend more time and also have a higher chance of spending up to $100.","text_count":277,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, step 5 displays the graph in a new window. Analyzing the result, we can say that there seem to be two kinds of users, ones who spend less that 10 minutes and never spend more than $10, and users who spend more time and also have a higher chance of spending up to $100."}]},{"block_type":"element","block":"k67ev7ty","search_text":"Tip Note that the data presented is synthetic, and it has been generated with the result in mind. Real-life data will probably look more spread out. ","text_count":149,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the data presented&nbsp;is synthetic, and it has been generated with the result in mind. Real-life data will probably look more spread out."}]}]},{"block_type":"element","block":"k67ev7tz","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7u0","search_text":"A scatter plot can display not only points in two dimensions, but also add a third (area) and even a fourth dimension (color).","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A scatter plot can display not only points in two dimensions, but also add a third (area) and even a fourth dimension (color)."}]},{"block_type":"element","block":"k67ev7u1","search_text":"To add those elements, use the parameters s for size and c for color .","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To add those elements, use the parameters"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"s"}]},{"block_type":"text","content":"for"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"size"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"c"}]},{"block_type":"text","content":"for"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"color"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7u2","search_text":"Note Size is defined as the diameter of a ball in points squared. So, for a ball of diameter 10, 100 will be used. Color can use any of the usual definitions of color in matplotlib , such as hex color, RGB, and so on. See the documentation for more details: https://matplotlib.org/users/colors.html . ","text_count":301,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Size is defined as the diameter of a ball&nbsp;in points&nbsp;squared. So, for a ball of diameter 10, 100 will be used. Color can use any of the usual definitions of color in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":",&nbsp; such as hex color, RGB, and so on. See the documentation for more details:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/colors.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/colors.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev7u3","search_text":"For example, we can generate a random graph using the four dimensions in the following way:","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, we can generate a random graph using the four dimensions in the following way:"}]},{"block_type":"element","block":"k67ev7u4","search_text":">>> import matplotlib.pyplot as plt >>> import random >>> NUM_POINTS = 100 >>> COLOR_SCALE = ['#FF0000', '#FFFF00', '#FFFF00', '#7FFF00', '#00FF00'] >>> data_x = [random.random() for _ in range(NUM_POINTS)] >>> data_y = [random.random() for _ in range(NUM_POINTS)] >>> size = [(50 * random.random()) ** 2 for _ in range(NUM_POINTS)] >>> color = [random.choice(COLOR_SCALE) for _ in range(NUM_POINTS)] >>> plt.scatter(data_x, data_y, s=size, c=color, alpha=0.5) >>> plt.show()","text_count":475,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt\n&gt;&gt;&gt; import random\n&gt;&gt;&gt; NUM_POINTS = 100\n&gt;&gt;&gt; COLOR_SCALE = ['#FF0000', '#FFFF00', '#FFFF00', '#7FFF00', '#00FF00']\n&gt;&gt;&gt; data_x = [random.random() for _ in range(NUM_POINTS)]\n&gt;&gt;&gt; data_y = [random.random() for _ in range(NUM_POINTS)]\n&gt;&gt;&gt; size = [(50 * random.random()) ** 2 for _ in range(NUM_POINTS)]\n&gt;&gt;&gt; color = [random.choice(COLOR_SCALE) for _ in range(NUM_POINTS)]\n&gt;&gt;&gt; plt.scatter(data_x, data_y, s=size, c=color, alpha=0.5)\n&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7u5","search_text":"COLOR_SCALE goes from green to red, and the size of each of the points will be between 0 and 50 points in diameter. The result should be something like this:","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"COLOR_SCALE"}]},{"block_type":"text","content":"goes from green to red, and the size of each of the points will be between"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"50"}]},{"block_type":"text","content":"points in diameter. The result should be something like this:"}]},{"block_type":"element","block":"k67ev7u6","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000004.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7u7","search_text":"Note that it is random, so each time it will generate a different graph.","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that it is random, so each time it will generate a different graph."}]},{"block_type":"element","block":"k67ev7u8","search_text":"The alpha value makes each of the points semitransparent, allowing us to see where they overlap. The higher this value is, the less transparent the points will be. This parameter will affect the displayed color, as it will blend the point with the background.","text_count":259,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"alpha"}]},{"block_type":"text","content":"value makes each of the points semitransparent, allowing us to see where they overlap. The higher this value is, the less transparent the points will be. This parameter will affect the displayed color, as it will blend the point with the background."}]},{"block_type":"element","block":"k67ev7u9","search_text":"Tip Even though it's possible to display two independent values in the size and color, they can also be related to any of the other values. For example, making the color dependent on the size will make all the points of the same size the same color, which may help distinguish the data. Remember that the ultimate goal of a graph is to make data easy to understand. Try different approaches to improve this. ","text_count":408,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Even though it's possible to display two independent values in the size and color, they can also be related to any of the other values. For example, making the color dependent on the size will make all the points of the same size the same color, which may help distinguish the data. Remember that the ultimate goal of a graph is to make data easy to understand. Try different approaches to improve this."}]}]},{"block_type":"element","block":"k67ev7ua","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ . ","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev7ub","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7uc","search_text":"The Displaying multiple lines recipe The Adding legends and annotations recipe ","text_count":79,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Displaying multiple lines"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7ud","search_text":"Visualizing maps","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Visualizing&nbsp;maps"}]},{"block_type":"element","block":"k67ev7ue","search_text":"To show information that changes from region to region, the best way is to display a map that presents the information, while at the same time giving a regional sense of position and location for the data.","text_count":205,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To show information that changes from region to region, the best way is to display a map that presents the information, while at the same time giving a regional sense of position and location for the data."}]},{"block_type":"element","block":"k67ev7uf","search_text":"In this recipe, we'll make use of the fiona module to import GIS information, as well as matplotlib to display the information. We will display a map of Western Europe and display the population of each country with a color grade. The darker the color, the larger the population.","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll make use of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fiona"}]},{"block_type":"text","content":"module to import GIS information, as well as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"to display the information. We will display a map of Western Europe and display the population of each country with a color grade. The darker the color, the larger the population."}]},{"block_type":"element","block":"k67ev7ug","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7uh","search_text":"We need to install matplotlib and fiona in our virtual environment:","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fiona"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7ui","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ echo \"Fiona==1.7.13\" >> requirements.txt $ pip install -r requirements.txt","text_count":123,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ echo \"Fiona==1.7.13\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7uj","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7uk","search_text":"The map data needs to be downloaded. Fortunately, there's a lot of freely available data for geographic information. A search on Google should quickly return almost everything you need, including detailed information on regions, counties, rivers, or any other kind of data.","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The map data needs to be downloaded. Fortunately, there's a lot of freely available data for geographic information. A search on Google should&nbsp;quickly&nbsp;return almost everything you need, including detailed information on regions, counties, rivers, or any other kind of data."}]},{"block_type":"element","block":"k67ev7ul","search_text":"Note GIS information is available in different formats from a lot of public organizations. fiona is capable of understanding most common formats and treating them in equivalent ways, but there are small differences. Read the fiona documentation for more details. ","text_count":263,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"GIS information is available in different formats from a lot of public organizations."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fiona"}]},{"block_type":"text","content":"is capable of understanding most common formats and treating them in equivalent ways, but there are small differences. Read the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fiona"}]},{"block_type":"text","content":"documentation for more details."}]}]},{"block_type":"element","block":"k67ev7um","search_text":"The data we'll use in this recipe, covering all European countries, is available on GitHub at the following URL: https://github.com/leakyMirror/map-of-europe/blob/master/GeoJSON/europe.geojson . Note it is in GeoJSON, which is an easy standard to work with.","text_count":257,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The data we'll use in this recipe, covering all European countries, is available on GitHub at the following URL:&nbsp;&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/leakyMirror/map-of-europe/blob/master/GeoJSON/europe.geojson"},"children":[{"block_type":"text","content":"https://github.com/leakyMirror/map-of-europe/blob/master/GeoJSON/europe.geojson"}]},{"block_type":"text","content":". Note it is in GeoJSON, which is an easy standard to work with."}]},{"block_type":"element","block":"k67ev7un","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7uo","search_text":"Import the modules to be used later: ","text_count":37,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the modules to be used later:"}]}]},{"block_type":"element","block":"k67ev7up","search_text":">>> import matplotlib.pyplot as plt >>> import matplotlib.cm as cm >>> import fiona","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt\n&gt;&gt;&gt; import matplotlib.cm as cm\n&gt;&gt;&gt; import fiona"}]}]},{"block_type":"element","block":"k67ev7uq","search_text":"Load the population of the countries to display. The population has been: ","text_count":74,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Load the population of the countries to display. The population has been:"}]}]},{"block_type":"element","block":"k67ev7ur","search_text":">>> COUNTRIES_POPULATION = { ... 'Spain': 47.2, ... 'Portugal': 10.6, ... 'United Kingdom': 63.8, ... 'Ireland': 4.7, ... 'France': 64.9, ... 'Italy': 61.1, ... 'Germany': 82.6, ... 'Netherlands': 16.8, ... 'Belgium': 11.1, ... 'Denmark': 5.6, ... 'Slovenia': 2, ... 'Austria': 8.5, ... 'Luxembourg': 0.5, ... 'Andorra': 0.077, ... 'Switzerland': 8.2, ... 'Liechtenstein': 0.038, ... } >>> MAX_POPULATION = max(COUNTRIES_POPULATION.values()) >>> MIN_POPULATION = min(COUNTRIES_POPULATION.values())","text_count":497,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; COUNTRIES_POPULATION = {\n...     'Spain': 47.2,\n...     'Portugal': 10.6,\n...     'United Kingdom': 63.8,\n...     'Ireland': 4.7,\n...     'France': 64.9,\n...     'Italy': 61.1,\n...     'Germany': 82.6,\n...     'Netherlands': 16.8,\n...     'Belgium': 11.1,\n...     'Denmark': 5.6,\n...     'Slovenia': 2,\n...     'Austria': 8.5,\n...     'Luxembourg': 0.5,\n...     'Andorra': 0.077,\n...     'Switzerland': 8.2,\n...     'Liechtenstein': 0.038,\n... }\n&gt;&gt;&gt; MAX_POPULATION = max(COUNTRIES_POPULATION.values())\n&gt;&gt;&gt; MIN_POPULATION = min(COUNTRIES_POPULATION.values())"}]}]},{"block_type":"element","block":"k67ev7us","search_text":"Prepare the colormap , which will determine the color each country will be displayed in a shade of green. Calculate which color corresponds to each country: ","text_count":157,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"colormap"}]},{"block_type":"text","content":", which will determine the color each country will be displayed in a shade of green. Calculate which color corresponds to each country:"}]}]},{"block_type":"element","block":"k67ev7ut","search_text":">>> colormap = cm.get_cmap('Greens') >>> COUNTRY_COLOUR = { ... country_name: colormap( ... (population - MIN_POPULATION) / (MAX_POPULATION - MIN_POPULATION) ... ) ... for country_name, population in COUNTRIES_POPULATION.items() ... }","text_count":234,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; colormap = cm.get_cmap('Greens')\n&gt;&gt;&gt; COUNTRY_COLOUR = {\n...     country_name: colormap(\n...         (population - MIN_POPULATION) / (MAX_POPULATION - MIN_POPULATION)\n...     )\n...     for country_name, population in COUNTRIES_POPULATION.items()\n... }"}]}]},{"block_type":"element","block":"k67ev7uu","search_text":"Open the file and read the data, filtering by the countries we defined the population of in step 1: ","text_count":100,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Open the file and read the data, filtering by the countries we defined the population of in step 1:"}]}]},{"block_type":"element","block":"k67ev7uv","search_text":">>> with fiona.open('europe.geojson') as fd: >>> full_data = [data for data in full_data ... if data['properties']['NAME'] in COUNTRIES_POPULATION]","text_count":147,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with fiona.open('europe.geojson') as fd:\n&gt;&gt;&gt;     full_data = [data for data in full_data\n...                  if data['properties']['NAME'] in COUNTRIES_POPULATION]"}]}]},{"block_type":"element","block":"k67ev7uw","search_text":"Plot each of the countries in the proper color: ","text_count":48,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Plot each of the countries in the proper color:"}]}]},{"block_type":"element","block":"k67ev7ux","search_text":">>> for data in full_data: ... country_name = data['properties']['NAME'] ... color = COUNTRY_COLOUR[country_name] ... geo_type = data['geometry']['type'] ... if geo_type == 'Polygon': ... data_x = [x for x, y in data['geometry']['coordinates'][0]] ... data_y = [y for x, y in data['geometry']['coordinates'][0]] ... plt.fill(data_x, data_y, c=color) ... elif geo_type == 'MultiPolygon': ... for coordinates in data['geometry']['coordinates']: ... data_x = [x for x, y in coordinates[0]] ... data_y = [y for x, y in coordinates[0]] ... plt.fill(data_x, data_y, c=color)","text_count":568,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; for data in full_data:\n...     country_name = data['properties']['NAME']\n...     color = COUNTRY_COLOUR[country_name]\n...     geo_type = data['geometry']['type']\n...     if geo_type == 'Polygon':\n...         data_x = [x for x, y in data['geometry']['coordinates'][0]]\n...         data_y = [y for x, y in data['geometry']['coordinates'][0]]\n...         plt.fill(data_x, data_y, c=color)\n...     elif geo_type == 'MultiPolygon':\n...         for coordinates in data['geometry']['coordinates']:\n...             data_x = [x for x, y in coordinates[0]]\n...             data_y = [y for x, y in coordinates[0]]\n...             plt.fill(data_x, data_y, c=color)"}]}]},{"block_type":"element","block":"k67ev7uy","search_text":"Display the result: ","text_count":20,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the result:"}]}]},{"block_type":"element","block":"k67ev7uz","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7v0","search_text":"The result will be displayed in a new window: ","text_count":46,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window:"}]}]},{"block_type":"element","block":"k67ev7v1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000060.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7v2","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7v3","search_text":"After importing the modules in step 1 from the How to do it… section, the data to be displayed is defined in step 2. Note that the names need to be in the same format as they'll be in the GEO file. The minimum and maximum populations are calculated to properly balance the range later.","text_count":285,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the modules in step 1 from the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, the data to be displayed is defined in step 2. Note that the names need to be in the same format as they'll be in the GEO file. The minimum and maximum populations are calculated to properly balance the range&nbsp;later."}]},{"block_type":"element","block":"k67ev7v4","search_text":"Note The population has been rounded to a significant number, and it's defined in millions. Only a few countries have been defined for the purposes of this recipe, but there are more available in the GIS file and the map can be extended toward the East. ","text_count":254,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The population has been rounded to a significant number, and it's defined in millions. Only a few countries have been defined for the purposes of this recipe, but there are more available in the GIS file and the map can be extended toward the East."}]}]},{"block_type":"element","block":"k67ev7v5","search_text":"A colormap defining the color range in shades of green ( Greens ) is described in step 3. This is one standard colormap in matplotlib , but others described in the documentation can be used ( https://matplotlib.org/examples/color/colormaps_reference.html ), such as oranges, reds, or plasma for a more cold-to-hot approach. ","text_count":324,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"colormap"}]},{"block_type":"text","content":"defining the color range in shades of green ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Greens"}]},{"block_type":"text","content":") is described in step 3. This is one&nbsp;standard&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"colormap"}]},{"block_type":"text","content":"&nbsp;in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":", but others described in the documentation can be used ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/examples/color/colormaps_reference.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/examples/color/colormaps_reference.html"}]},{"block_type":"text","content":"), such as&nbsp;oranges,&nbsp;reds, or plasma for a more cold-to-hot approach.&nbsp;"}]},{"block_type":"element","block":"k67ev7v6","search_text":"The COUNTRY_COLOUR dictionary stores the color defined by the colormap for each country. The population is reduced to a number from 0.0 (least population) to 1.0 (most), and passed to colormap to retrieve the color at the scale it corresponds to.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"COUNTRY_COLOUR"}]},{"block_type":"text","content":"&nbsp;dictionary&nbsp;stores the color defined by the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"colormap"}]},{"block_type":"text","content":"for each country. The population is reduced to a number from 0.0 (least population) to 1.0 (most), and passed to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"colormap"}]},{"block_type":"text","content":"to retrieve the color at the scale it corresponds to."}]},{"block_type":"element","block":"k67ev7v7","search_text":"The GIS information is then retrieved in step 4. The europe.geojson file is read using fiona and the data is copied so we can use it in the next steps. It also filters to only deal with the countries we defined the population of, so no extra countries are plotted.","text_count":264,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The GIS information is&nbsp;then&nbsp;retrieved in step 4. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"europe.geojson"}]},{"block_type":"text","content":"&nbsp;file&nbsp;is read using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fiona"}]},{"block_type":"text","content":"and the data is copied so we can use it in the next steps. It also&nbsp;filters to only deal with the countries we defined the population of, so no extra countries are plotted."}]},{"block_type":"element","block":"k67ev7v8","search_text":"The loop in step 5 goes country by country, and then we plot it using .fill , which plots a polygon. The geometry of each of the different countries is either a single polygon ( Polygon ) or more than one ( MultiPolygon ). In each case, the proper polygons are drawn, all in the same color. This means MultiPolygon is drawn several times.","text_count":338,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The loop in step 5 goes country by country, and then we plot it using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".fill"}]},{"block_type":"text","content":", which plots a polygon. The geometry of each of the different countries is either a single polygon ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Polygon"}]},{"block_type":"text","content":") or more than one ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MultiPolygon"}]},{"block_type":"text","content":"). In each case, the proper polygons are drawn, all in the same color. This means&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MultiPolygon"}]},{"block_type":"text","content":"&nbsp;is drawn several times."}]},{"block_type":"element","block":"k67ev7v9","search_text":"Note GIS information is stored as points for coordinates describing the latitude and longitude of the point. Areas, such as countries, have a list of coordinates that describe an area within them. Some maps are more precise and have more points defining areas. Multiple polygons may be required to define a country, as some parts may be separated from each other, islands being the most obvious cases, but there are also enclaves. ","text_count":431,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"GIS information is stored as points for coordinates describing the latitude and longitude of the point. Areas, such as countries, have a list of coordinates that describe an area within them. Some maps are more precise and have more points defining areas. Multiple polygons may be required to define a country, as some parts may be separated from each other, islands being the most obvious cases, but there are also enclaves."}]}]},{"block_type":"element","block":"k67ev7va","search_text":"Finally, the data is displayed by calling .show .","text_count":49,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the data is displayed by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7vb","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7vc","search_text":"Taking advantage of the information contained in the GIS file, we can add extra information to the map. The properties object contains information about the name of the country, but also its ISO name, FID code, and central location as LON and LAT . We can use this information to display the name of the country using .text :","text_count":325,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Taking advantage of the information contained in the GIS file, we can add extra information to the map. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"properties"}]},{"block_type":"text","content":"&nbsp;object contains information about the name of the country, but also its ISO name, FID code, and central location as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LON"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LAT"}]},{"block_type":"text","content":". We can use this information to display the name of the country using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".text"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev7vd","search_text":"long, lat = data['properties']['LON'], data['properties']['LAT'] iso3 = data['properties']['ISO3'] plt.text(long, lat, iso3, horizontalalignment='center')","text_count":154,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"long, lat = data['properties']['LON'], data['properties']['LAT']\n    iso3 = data['properties']['ISO3']\n    plt.text(long, lat, iso3, horizontalalignment='center')"}]}]},{"block_type":"element","block":"k67ev7ve","search_text":"This code will live inside the loop in step 6 in the How to do it… section.","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This code will live inside the loop in&nbsp;step 6 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section."}]},{"block_type":"element","block":"k67ev7vf","search_text":"Tip If you analyze the file, you'll see that the properties object contains information about the population, stored as POP2005, so you can draw the population info directly from the map. That is left as an exercise. Different map files will contain different information, so be sure to play around to unleash all the possibilities. ","text_count":333,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you analyze the file, you'll see that the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"properties"}]},{"block_type":"text","content":"object contains information about the population, stored as POP2005, so you can draw the population info directly from the map. That is left as an exercise. Different map files will contain different information, so be sure to play around to unleash all the possibilities."}]}]},{"block_type":"element","block":"k67ev7vg","search_text":"Also, you may notice that the map may be distorted in some cases. matplotlib will try to present it in a square box, and if the map is not roughly square, this will be evident. For example, try to display only Spain, Portugal, Ireland, and the UK. We can force the graph to present 1 point of latitude with the same space as 1 point of longitude, which is a good approach if we are not drawing something near the poles. This is achieved by calling .set_aspect in the axes. Current axes can be obtained through .gca ( get current axes )","text_count":535,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Also, you may notice that the map may be distorted in some cases."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"will try to present it in a square box, and if the map is not roughly square, this will be evident. For example, try to display only Spain, Portugal, Ireland, and the UK. We can force the graph to present 1 point of latitude with the same space as 1 point of longitude, which is a good approach if we are not drawing something near the poles. This is achieved by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".set_aspect"}]},{"block_type":"text","content":"in the axes. Current axes can be obtained through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".gca"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"get current axes"}]},{"block_type":"text","content":")"}]},{"block_type":"element","block":"k67ev7vh","search_text":">>> axes = plt.gca() >>> axes.set_aspect('equal', adjustable='box')","text_count":67,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; axes = plt.gca()\n&gt;&gt;&gt; axes.set_aspect('equal', adjustable='box')"}]}]},{"block_type":"element","block":"k67ev7vi","search_text":"Also, to improve the look of the map, we can set up a background color that helps to differentiate between the background and the foreground, and remove the labels in the axes, as printing the latitude and longitude is probably distracting. Removing the labels on the axes is achieved by setting empty labels with .xticks and .yticks . The background color is mandated by the foreground color of the axes:","text_count":405,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Also, to improve the look of the map, we can set up a background color that helps to differentiate between the background and the foreground, and remove the labels in the axes, as printing the latitude and longitude is probably distracting. Removing the labels on the axes is achieved by setting empty labels with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".yticks"}]},{"block_type":"text","content":". The background color is mandated by the foreground color of the axes:"}]},{"block_type":"element","block":"k67ev7vj","search_text":">>> plt.xticks([]) >>> plt.yticks([]) >>> axes = plt.gca() >>> axes.set_facecolor('xkcd:light blue')","text_count":100,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.xticks([])\n&gt;&gt;&gt; plt.yticks([])\n&gt;&gt;&gt; axes = plt.gca()\n&gt;&gt;&gt; axes.set_facecolor('xkcd:light blue')"}]}]},{"block_type":"element","block":"k67ev7vk","search_text":"Finally, to better differentiate between the different regions, a line surrounding each area can be added. This can be done by drawing a thin line with the same data as .fill , right after. Notice that this code is repeated twice in step 2:","text_count":240,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, to better differentiate between the different regions, a line surrounding each area can be added. This can be done by drawing a thin line with the same data as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".fill"}]},{"block_type":"text","content":", right after. Notice that this code is repeated twice in step 2:"}]},{"block_type":"element","block":"k67ev7vl","search_text":"plt.fill(data_x, data_y, c=color) plt.plot(data_x, data_y, c='black', linewidth=0.2)","text_count":84,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"plt.fill(data_x, data_y, c=color)\n plt.plot(data_x, data_y, c='black', linewidth=0.2)"}]}]},{"block_type":"element","block":"k67ev7vm","search_text":"Applying all these elements to the map, it now looks like this: ","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Applying all these elements to the map, it now looks like this:&nbsp;"}]},{"block_type":"element","block":"k67ev7vn","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000070.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7vo","search_text":"The resulting code is available on GitHub here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/visualising_maps.py .","text_count":153,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The resulting code is available on&nbsp;GitHub&nbsp;here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/visualising_maps.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/visualising_maps.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7vp","search_text":"Tip As we've seen, maps are drawn as general polygons. Don't be afraid to include other geometrical forms. You can define your own polygons and print them with .fill or some extra labels. For example, far away regions may need to be transported to avoid having too big a map. Or, rectangles can be used to print extra information on top of parts of the map. ","text_count":358,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As we've seen, maps are drawn as general polygons. Don't be afraid to include other geometrical forms. You can define your own polygons and print them with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".fill"}]},{"block_type":"text","content":"&nbsp;or some extra labels. For example, far away regions may need to be transported to avoid having too big a&nbsp;map. Or, rectangles can be used to print extra information on top of parts of the map."}]}]},{"block_type":"element","block":"k67ev7vq","search_text":"The full fiona documentation can be found here: http://toblerity.org/fiona/ . The full matplotlib documentation can be found here: https://matplotlib.org/ . ","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fiona"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://toblerity.org/fiona/"},"children":[{"block_type":"text","content":"http://toblerity.org/fiona/"}]},{"block_type":"text","content":".&nbsp;The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":".&nbsp;"}]},{"block_type":"element","block":"k67ev7vr","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7vs","search_text":"The Adding legends and annotations recipe The Combining graphs recipe ","text_count":70,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7vt","search_text":"Adding legends and annotations","text_count":30,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"element","block":"k67ev7vu","search_text":"When drawing graphs with dense information, a legend may be required to determine the specific colors or help better understand the data presented. In matplotlib , legends can be pretty rich and have multiple ways of presenting them. Annotations to draw attention to specific points are also good ways to focus the message for the audience.","text_count":340,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When drawing graphs with dense information, a legend may be required to determine the specific colors or help better understand the data presented. In"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":", legends can be pretty rich and have multiple ways of presenting them. Annotations to draw attention to specific points are also good ways to focus the message for the audience."}]},{"block_type":"element","block":"k67ev7vv","search_text":"In this recipe, we'll create a graph with three different components and display a legend with information to better understand it, as well as annotating the most interesting points on our graph.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll create a graph with three different components and display a legend with information to better understand it, as well as annotating the most interesting points on our graph."}]},{"block_type":"element","block":"k67ev7vw","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7vx","search_text":"We need to install matplotlib in our virtual environment:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7vy","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7vz","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7w0","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7w1","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7w2","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7w3","search_text":"Prepare the data to be displayed on the graph, and the legends that should be displayed. Each of the lines is composed of the time label, sales of ProductA , sales of ProductB , and sales of ProductC : ","text_count":202,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data to be displayed on the graph, and the legends that should be displayed. Each of the lines is composed of the time label, sales of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductA"}]},{"block_type":"text","content":", sales of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductB"}]},{"block_type":"text","content":", and sales of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductC"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7w4","search_text":">>> LEGEND = ('ProductA', 'ProductB', 'ProductC') >>> DATA = ( ... ('Q1 2017', 100, 30, 3), ... ('Q2 2017', 105, 32, 15), ... ('Q3 2017', 125, 29, 40), ... ('Q4 2017', 115, 31, 80), ... )","text_count":187,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; LEGEND = ('ProductA', 'ProductB', 'ProductC')\n&gt;&gt;&gt; DATA = (\n...     ('Q1 2017', 100, 30, 3),\n...     ('Q2 2017', 105, 32, 15),\n...     ('Q3 2017', 125, 29, 40),\n...     ('Q4 2017', 115, 31, 80),\n... )"}]}]},{"block_type":"element","block":"k67ev7w5","search_text":"Split the data into usable formats for the graph. This is a preparation step: ","text_count":78,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Split the data into usable formats for the graph. This is a preparation step:"}]}]},{"block_type":"element","block":"k67ev7w6","search_text":">>> POS = list(range(len(DATA))) >>> VALUESA = [valueA for label, valueA, valueB, valueC in DATA] >>> VALUESB = [valueB for label, valueA, valueB, valueC in DATA] >>> VALUESC = [valueC for label, valueA, valueB, valueC in DATA] >>> LABELS = [label for label, valueA, valueB, valueC in DATA]","text_count":290,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; POS = list(range(len(DATA)))\n&gt;&gt;&gt; VALUESA = [valueA for label, valueA, valueB, valueC in DATA]\n&gt;&gt;&gt; VALUESB = [valueB for label, valueA, valueB, valueC in DATA]\n&gt;&gt;&gt; VALUESC = [valueC for label, valueA, valueB, valueC in DATA]\n&gt;&gt;&gt; LABELS = [label for label, valueA, valueB, valueC in DATA]"}]}]},{"block_type":"element","block":"k67ev7w7","search_text":"Create a bar graph with the data: ","text_count":34,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a bar graph with the data:"}]}]},{"block_type":"element","block":"k67ev7w8","search_text":">>> WIDTH = 0.2 >>> plt.bar([p - WIDTH for p in POS], VALUESA, width=WIDTH) >>> plt.bar([p for p in POS], VALUESB, width=WIDTH) >>> plt.bar([p + WIDTH for p in POS], VALUESC, width=WIDTH) >>> plt.ylabel('Sales') >>> plt.xticks(POS, LABELS)","text_count":239,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; WIDTH = 0.2\n&gt;&gt;&gt; plt.bar([p - WIDTH for p in POS], VALUESA, width=WIDTH)\n&gt;&gt;&gt; plt.bar([p for p in POS], VALUESB, width=WIDTH)\n&gt;&gt;&gt; plt.bar([p + WIDTH for p in POS], VALUESC, width=WIDTH)\n&gt;&gt;&gt; plt.ylabel('Sales')\n&gt;&gt;&gt; plt.xticks(POS, LABELS)"}]}]},{"block_type":"element","block":"k67ev7w9","search_text":"Add an annotation displaying the maximum growth in the chart: ","text_count":62,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add an annotation displaying the maximum growth in the chart:"}]}]},{"block_type":"element","block":"k67ev7wa","search_text":">>> plt.annotate('400% growth', xy=(1.2, 18), xytext=(1.3, 40), horizontalalignment='center', arrowprops=dict(facecolor='black', shrink=0.05))","text_count":142,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.annotate('400% growth', xy=(1.2, 18), xytext=(1.3, 40),\n                 horizontalalignment='center',\n                 arrowprops=dict(facecolor='black', shrink=0.05))"}]}]},{"block_type":"element","block":"k67ev7wb","search_text":"Add the legend : ","text_count":17,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"legend"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7wc","search_text":">>> plt.legend(LEGEND)","text_count":22,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.legend(LEGEND)"}]}]},{"block_type":"element","block":"k67ev7wd","search_text":"Display the graph: ","text_count":19,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the graph:"}]}]},{"block_type":"element","block":"k67ev7we","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7wf","search_text":"The result will be displayed in a new window: ","text_count":46,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window:"}]}]},{"block_type":"element","block":"k67ev7wg","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000012.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7wh","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7wi","search_text":"Steps 1 and 2 of the How to do it… section prepare the imports and the data that will be displayed in the bar, in a format similar to what well-structured input data will look like. In step 3, the data is split into different arrays to prepare the input in matplotlib . Basically, each data sequence is stored in a different array.","text_count":331,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 1 and 2&nbsp; of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section prepare the imports and the data that will be displayed in the bar, in a format similar to what well-structured input data will look like. In step 3, the data is split into different arrays to prepare the input in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":". Basically, each data sequence is stored in a different array."}]},{"block_type":"element","block":"k67ev7wj","search_text":"Step 4 draws the data. Each data sequence gets a call to .bar , specifying its position and values. Labels do the same as .xticks . To separate each of the bars around the labels, the first one is displaced to the left and the third to the right.","text_count":246,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 draws the data. Each data sequence gets a call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".bar"}]},{"block_type":"text","content":", specifying its position and values. Labels do the same as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":". To separate each of the bars around the labels, the first one is displaced to the left and the third to the right."}]},{"block_type":"element","block":"k67ev7wk","search_text":"An annotation is added above the bar for ProductC in the second quarter. Note that the annotation includes the point in xy and the text location in xytext .","text_count":156,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An annotation is added above the bar for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductC"}]},{"block_type":"text","content":"in the second quarter. Note that the annotation includes the point in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xy"}]},{"block_type":"text","content":"and the text location in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"xytext"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7wl","search_text":"In step 6, the legend is added. Notice that the labels need to be added in the same order as the data was input. The legend is located automatically in an area that doesn't cover any data. arroprops details the arrow to point to the data.","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 6, the legend is added. Notice that the labels need to be added in the same order as the data was input. The legend is located automatically in an area that doesn't cover any data."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"arroprops"}]},{"block_type":"text","content":"details the arrow to point to the data."}]},{"block_type":"element","block":"k67ev7wm","search_text":"Finally, the graph is drawn in step 7 by calling .show .","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the graph is drawn in step 7 by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7wn","search_text":"Tip Calling .show blocks the execution of the program. The program will resume when the window is closed. ","text_count":106,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".show"}]},{"block_type":"text","content":"&nbsp;blocks the execution of the program. The program will resume when the window is closed."}]}]},{"block_type":"element","block":"k67ev7wo","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7wp","search_text":"Legends will be display automatically in most cases with just a call to .legend . If you need to customize the order in which they appear, you may refer each label to a specific element. For example, this way (note it calls ProductA the valueC series)","text_count":251,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Legends will be display automatically in most cases with just a call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".legend"}]},{"block_type":"text","content":". If you need to customize the order in which they appear, you may refer each label to a specific element. For example, this way (note it calls"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductA"}]},{"block_type":"text","content":"the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"valueC"}]},{"block_type":"text","content":"series)"}]},{"block_type":"element","block":"k67ev7wq","search_text":">>> valueA = plt.bar([p - WIDTH for p in POS], VALUESA, width=WIDTH) >>> valueB = plt.bar([p for p in POS], VALUESB, width=WIDTH) >>> valueC = plt.bar([p + WIDTH for p in POS], VALUESC, width=WIDTH) >>> plt.legend((valueC, valueB, valueA), LEGEND)","text_count":247,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; valueA = plt.bar([p - WIDTH for p in POS], VALUESA, width=WIDTH)\n&gt;&gt;&gt; valueB = plt.bar([p for p in POS], VALUESB, width=WIDTH)\n&gt;&gt;&gt; valueC = plt.bar([p + WIDTH for p in POS], VALUESC, width=WIDTH)\n&gt;&gt;&gt; plt.legend((valueC, valueB, valueA), LEGEND)"}]}]},{"block_type":"element","block":"k67ev7wr","search_text":"The location of the legend can also be changed manually, through the loc parameter. By default, it is best and it will draw the legend over an area where there's the least overlap of data (ideally none). But values such as right , upper left , and so on can be used, or a specific (X, Y) tuple.","text_count":294,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The location of the legend can also be changed manually, through the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"loc"}]},{"block_type":"text","content":"&nbsp;parameter. By default, it is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"best"}]},{"block_type":"text","content":"&nbsp;and it will draw the legend over an area where there's the least overlap of data (ideally none). But values such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"right"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"upper left"}]},{"block_type":"text","content":", and so on can be used, or a specific"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"(X, Y)"}]},{"block_type":"text","content":"tuple."}]},{"block_type":"element","block":"k67ev7ws","search_text":"Another option is to plot the legend outside of the graph, using the bbox_to_anchor option. In this case, the legend is attached to the ( X , Y ) of the bounding box, where 0 is the bottom-left corner of the graph and 1 is the upper-right corner. This may cause the legend to be clipped by the external border, so you may need to adjust where the graph starts and ends with .subplots_adjust :","text_count":392,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another option is to plot the legend&nbsp;outside of the graph, using the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"bbox_to_anchor"}]},{"block_type":"text","content":"&nbsp;option. In this case, the legend is attached to the ("},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":") of the bounding box, where"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"is the bottom-left corner of the graph and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1"}]},{"block_type":"text","content":"is the upper-right corner. This may cause the legend to be clipped by the external border, so you may need to adjust where the graph starts and ends with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplots_adjust"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev7wt","search_text":">>> plt.legend(LEGEND, title='Products', bbox_to_anchor=(1, 0.8)) >>> plt.subplots_adjust(right=0.80)","text_count":101,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.legend(LEGEND, title='Products', bbox_to_anchor=(1, 0.8))\n&gt;&gt;&gt; plt.subplots_adjust(right=0.80)"}]}]},{"block_type":"element","block":"k67ev7wu","search_text":"Adjusting the bbox_to_anchor parameter and .subplots_adjust will require a little bit of trial and error, until the expected result is produced.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Adjusting the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"bbox_to_anchor"}]},{"block_type":"text","content":"parameter and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplots_adjust"}]},{"block_type":"text","content":"will require a little bit of trial and error, until the expected result is produced."}]},{"block_type":"element","block":"k67ev7wv","search_text":"Note .subplots_adjust references the positions as the position of the axis where it will be displayed. This means that right=0.80 will leave 20% of the screen on the right of the plot, while the default for left is 0.125, meaning it leaves 12.5% of the space on the left of the plot. See the documentation for further details: https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots_adjust.html . ","text_count":403,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplots_adjust"}]},{"block_type":"text","content":"references the positions as the position of the axis where it will be displayed. This means that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"right=0.80"}]},{"block_type":"text","content":"&nbsp;will leave 20% of the screen on the right of the plot, while the default for left is 0.125, meaning it leaves 12.5% of the space on the left of the plot. See the documentation for further details:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots_adjust.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots_adjust.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev7ww","search_text":"The annotations can be done in different styles and can be tweaked with different options regarding the way to connect and so on. For example, this code will create an arrow with the fancy style connecting with a curve. The result is displayed here:","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The annotations can be done in different styles and can be tweaked with different options regarding the way to connect and so on. For example, this code will create an arrow with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fancy"}]},{"block_type":"text","content":"&nbsp;style connecting with a curve. The result is displayed here:"}]},{"block_type":"element","block":"k67ev7wx","search_text":"plt.annotate('400% growth', xy=(1.2, 18), xytext=(1.3, 40), horizontalalignment='center', arrowprops={'facecolor': 'black', 'arrowstyle': \"fancy\", 'connectionstyle': \"angle3\", })","text_count":178,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"plt.annotate('400% growth', xy=(1.2, 18), xytext=(1.3, 40),\n             horizontalalignment='center',\n             arrowprops={'facecolor': 'black',\n                         'arrowstyle': \"fancy\",\n                         'connectionstyle': \"angle3\",\n                         })"}]}]},{"block_type":"element","block":"k67ev7wy","search_text":"In our recipe, we did not annotate to exactly the end of the bar (point ( 1.2 , 15 )), but slightly above it, to give a little bit of breathing space.","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In our recipe, we did not&nbsp;annotate to&nbsp;exactly the end of the bar (point ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"1.2"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"15"}]},{"block_type":"text","content":")), but slightly above it, to give a little bit of breathing space."}]},{"block_type":"element","block":"k67ev7wz","search_text":"Tip Adjusting the exact point to annotate and where to locate the text will require a bit of testing. The text was also positioned by looking for the best place to not overlap the text with the bars. The font size and color can be changed, using the fontsize and color parameters, in both the .legend and .annotate calls. ","text_count":322,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Adjusting the&nbsp;exact&nbsp;point to annotate and where to locate the text will require a bit of testing.&nbsp;The text was also positioned by looking for the best place to not overlap the text with the bars. The font size and color can be changed, using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fontsize"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"color"}]},{"block_type":"text","content":"parameters, in&nbsp;both&nbsp;the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".legend"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".annotate"}]},{"block_type":"text","content":"calls."}]}]},{"block_type":"element","block":"k67ev7x0","search_text":"Applying all these elements, the graph may look similar to this. This graph can be replicated by calling the legend_and_annotation.py script available in GitHub here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/adding_legend_and_annotations.py :","text_count":285,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Applying all these elements, the graph may look similar to this. This graph can be replicated by calling the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"legend_and_annotation.py"}]},{"block_type":"text","content":"script available in GitHub here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/adding_legend_and_annotations.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter07/adding_legend_and_annotations.py"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev7x1","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000061.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7x2","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ . In particular, the guide for legends is here: https://matplotlib.org/users/legend_guide.html#plotting-guide-legend and for annotations it is here: https://matplotlib.org/users/annotations.html .","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":". In particular, the guide for legends is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/legend_guide.html#plotting-guide-legend"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/legend_guide.html#plotting-guide-legend"}]},{"block_type":"text","content":"&nbsp;and for annotations it is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/annotations.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/annotations.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7x3","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7x4","search_text":"The Drawing stacked bars recipe The Combining graphs recipe ","text_count":60,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Drawing stacked bars"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7x5","search_text":"Combining graphs","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"element","block":"k67ev7x6","search_text":"More than one graph can be combined in the same graph. In this recipe, we'll see how to present data in the same plot, on two different axes, and how to add more plots to the same graph.","text_count":186,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"More than one graph can be combined in the same graph. In this recipe, we'll see how to present data in the same plot, on two different axes, and how to add more plots to the same graph."}]},{"block_type":"element","block":"k67ev7x7","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7x8","search_text":"We need to install matplotlib in our virtual environment:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7x9","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7xa","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7xb","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7xc","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7xd","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7xe","search_text":"Prepare the data to be displayed on the graph and the legends that should be displayed. Each of the lines is composed of the time label, sales of ProductA , and sales of ProductB . Notice how ProductB has a much higher value than A : ","text_count":234,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data to be displayed on the graph and the legends that should be displayed. Each of the lines is composed of the time label,&nbsp;&nbsp;sales of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductA"}]},{"block_type":"text","content":", and sales of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductB"}]},{"block_type":"text","content":". Notice how"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ProductB"}]},{"block_type":"text","content":"has a much higher value than"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"A"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7xf","search_text":">>> DATA = ( ... ('Q1 2017', 100, 3000, 3), ... ('Q2 2017', 105, 3200, 5), ... ('Q3 2017', 125, 2900, 7), ... ('Q4 2017', 115, 3100, 3), ... )","text_count":142,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...  ('Q1 2017', 100, 3000, 3),\n...  ('Q2 2017', 105, 3200, 5),\n...  ('Q3 2017', 125, 2900, 7),\n...  ('Q4 2017', 115, 3100, 3),\n... )"}]}]},{"block_type":"element","block":"k67ev7xg","search_text":"Prepare the data in independent arrays: ","text_count":40,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data in independent arrays:"}]}]},{"block_type":"element","block":"k67ev7xh","search_text":">>> POS = list(range(len(DATA))) >>> VALUESA = [valueA for label, valueA, valueB, valueC in DATA] >>> VALUESB = [valueB for label, valueA, valueB, valueC in DATA] >>> VALUESC = [valueC for label, valueA, valueB, valueC in DATA] >>> LABELS = [label for label, valueA, valueB, valueC in DATA]","text_count":290,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; POS = list(range(len(DATA)))\n&gt;&gt;&gt; VALUESA = [valueA for label, valueA, valueB, valueC in DATA]\n&gt;&gt;&gt; VALUESB = [valueB for label, valueA, valueB, valueC in DATA]\n&gt;&gt;&gt; VALUESC = [valueC for label, valueA, valueB, valueC in DATA]\n&gt;&gt;&gt; LABELS = [label for label, valueA, valueB, valueC in DATA]"}]}]},{"block_type":"element","block":"k67ev7xi","search_text":"Note that this expands and creates a list for each of the values.","text_count":65,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that this expands and creates a list for each of the values."}]},{"block_type":"element","block":"k67ev7xj","search_text":"Tip The values can also be expanded with this— LABELS , VALUESA , VALUESB , VALUESC = ZIP(*DATA) ","text_count":97,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The values can also be expanded with this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"LABELS"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESC = ZIP(*DATA)"}]}]}]},{"block_type":"element","block":"k67ev7xk","search_text":"Create a first subplot: ","text_count":24,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a first subplot:"}]}]},{"block_type":"element","block":"k67ev7xl","search_text":">>> plt.subplot(2, 1, 1)","text_count":24,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.subplot(2, 1, 1)"}]}]},{"block_type":"element","block":"k67ev7xm","search_text":"Create a bar graph with information about VALUESA : ","text_count":52,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a bar graph with information about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7xn","search_text":">>> valueA = plt.bar(POS, VALUESA) >>> plt.ylabel('Sales A')","text_count":60,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; valueA = plt.bar(POS, VALUESA)\n&gt;&gt;&gt; plt.ylabel('Sales A')"}]}]},{"block_type":"element","block":"k67ev7xo","search_text":"Create a different Y axis, and add information about VALUESB as a line plot: ","text_count":77,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a different"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis, and add information about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":"as a line plot:"}]}]},{"block_type":"element","block":"k67ev7xp","search_text":">>> plt.twinx() >>> valueB = plt.plot(POS, VALUESB, 'o-', color='red') >>> plt.ylabel('Sales B') >>> plt.xticks(POS, LABELS)","text_count":124,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.twinx()\n&gt;&gt;&gt; valueB = plt.plot(POS, VALUESB, 'o-', color='red')\n&gt;&gt;&gt; plt.ylabel('Sales B')\n&gt;&gt;&gt; plt.xticks(POS, LABELS)"}]}]},{"block_type":"element","block":"k67ev7xq","search_text":"Create another subplot and fill it with VALUESC : ","text_count":50,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create another subplot and fill it with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESC"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7xr","search_text":">>> plt.subplot(2, 1, 2) >>> plt.plot(POS, VALUESC) >>> plt.gca().set_ylim(ymin=0) >>> plt.xticks(POS, LABELS)","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.subplot(2, 1, 2)\n&gt;&gt;&gt; plt.plot(POS, VALUESC)\n&gt;&gt;&gt; plt.gca().set_ylim(ymin=0)\n&gt;&gt;&gt; plt.xticks(POS, LABELS)"}]}]},{"block_type":"element","block":"k67ev7xs","search_text":"Display the graph: ","text_count":19,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the graph:"}]}]},{"block_type":"element","block":"k67ev7xt","search_text":">>> plt.show()","text_count":14,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.show()"}]}]},{"block_type":"element","block":"k67ev7xu","search_text":"The result will be displayed in a new window: ","text_count":46,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The result will be displayed in a new window:"}]}]},{"block_type":"element","block":"k67ev7xv","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000040.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7xw","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7xx","search_text":"After importing the module, the data is presented in step 2 in the How to do it… section in a convenient way, which will likely be similar to the way the data was originally stored. Step 3 is a preparation step that splits the data into different arrays for the next steps.","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the module, the data is presented in step 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section in a convenient way, which will likely be similar to the way the data was originally stored. Step 3 is a preparation step that splits the data into different arrays for the next steps."}]},{"block_type":"element","block":"k67ev7xy","search_text":"Step 4 creates a new .subplot . This splits the full drawing into two elements. The parameters are number of rows, columns, and selected subplot. So, we create two subplots in a column and drew in the first one.","text_count":211,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 creates a new"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplot"}]},{"block_type":"text","content":". This splits the full drawing into two elements. The parameters are number of rows, columns, and selected subplot. So, we create two subplots in a column and drew in the first one."}]},{"block_type":"element","block":"k67ev7xz","search_text":"Step 5 prints a .bar plot in this subplot using VALUESA data, and labels the Y axis with Sales A using .ylabel .","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 5 prints a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".bar"}]},{"block_type":"text","content":"plot in this subplot using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESA"}]},{"block_type":"text","content":"data, and labels the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sales A"}]},{"block_type":"text","content":"&nbsp;using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7y0","search_text":"Step 6 creates a new Y axis with .twinx , drawing VALUESB now as a line plot through .plot . The label is marked with .ylabel as Sales B . The X axis is labeled using .xticks .","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 6 creates a new"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".twinx"}]},{"block_type":"text","content":", drawing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":"&nbsp;now&nbsp;as a line plot through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".plot"}]},{"block_type":"text","content":". The label is marked with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Sales B"}]},{"block_type":"text","content":". The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"axis is labeled using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7y1","search_text":"Note The VALUESB plot is set as red to avoid both plots having the same color. By default, the first color is the same in both cases, and that will lead to confusion. The data points are marked with the 'o' option. ","text_count":215,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESB"}]},{"block_type":"text","content":"plot is set as red to avoid both plots having the same color. By default, the first color is the same in both cases, and that will lead to confusion. The data points are marked with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'o'"}]},{"block_type":"text","content":"&nbsp;option."}]}]},{"block_type":"element","block":"k67ev7y2","search_text":"In step 7, we changed to the second subplot using .subplot . The plot prints VALUESC as a line, and again puts the labels on the X axis with .xticker and sets the minimum of the Y axis to 0 . The graph is then displayed in step 8.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 7, we changed to the second subplot using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplot"}]},{"block_type":"text","content":". The plot prints&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"VALUESC"}]},{"block_type":"text","content":"as a line, and&nbsp;again&nbsp;puts the labels on the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"axis with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticker"}]},{"block_type":"text","content":"&nbsp;and sets the minimum of the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":". The graph is then displayed in step 8."}]},{"block_type":"element","block":"k67ev7y3","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7y4","search_text":"Plots with multiple axes are complicated to read as a general rule. Use them only when there's a good reason to do so and the data is highly correlated.","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Plots with multiple axes are complicated to read as a general rule. Use them only when there's a good reason to do so and the data is highly correlated."}]},{"block_type":"element","block":"k67ev7y5","search_text":"Tip By default, the Y axis in line plots will try to present information between the minimum and maximum Y values. Truncating the axis is normally not the best way to present information, as it can distort the perceived differences. For example, changing values in the range from 10 to 11 can look like a huge deal if the graph goes from 10 to 11, but this is less than 10%. Setting the Y axis minimum to 0 with plt.gca().set_ylim(ymin=0) is a good idea, especially with two different axes. ","text_count":491,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"By default, the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis in line plots will try to present information between the minimum and maximum"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"values. Truncating the axis is normally not the best way to present information, as it can distort the perceived differences. For example, changing values in the range from 10 to 11 can look like a huge deal if the graph goes from 10 to 11, but this is less than 10%. Setting the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Y"}]},{"block_type":"text","content":"axis minimum to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"0"}]},{"block_type":"text","content":"with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"plt.gca().set_ylim(ymin=0)"}]},{"block_type":"text","content":"&nbsp;is a good idea, especially with two different axes."}]}]},{"block_type":"element","block":"k67ev7y6","search_text":"The call to select the subplot will first go by row, then by column, so .subplot(2, 2, 3) will select the subplot in the first column, second row.","text_count":146,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The call to select the subplot will first&nbsp;go&nbsp;by row, then by column, so"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplot(2, 2, 3)"}]},{"block_type":"text","content":"will select the subplot in the first column, second row."}]},{"block_type":"element","block":"k67ev7y7","search_text":"The divided subplot grid can be changed. A first call to .subplot(2, 2, 1) and .subplot(2, 2, 2) , and then calling .subplot(2, 1, 2) , will create a structure with two small plots in the first row and a wider one in the second. Going back will overwrite previously drawn subplots.","text_count":281,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The divided subplot grid can be changed. A first call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplot(2, 2, 1)"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplot(2, 2, 2)"}]},{"block_type":"text","content":", and then calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".subplot(2, 1, 2)"}]},{"block_type":"text","content":", will create a structure with two small plots in the first row and a wider one in the second. Going back will overwrite previously drawn subplots."}]},{"block_type":"element","block":"k67ev7y8","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ . In particular, the guide for legends is here: https://matplotlib.org/users/legend_guide.html#plotting-guide-legend . For annotations, it is here: https://matplotlib.org/users/annotations.html .","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":". In particular, the guide for legends is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/legend_guide.html#plotting-guide-legend"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/legend_guide.html#plotting-guide-legend"}]},{"block_type":"text","content":". For annotations, it is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/annotations.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/annotations.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7y9","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7ya","search_text":"The Drawing multiple lines recipe The Visualizing maps recipe ","text_count":62,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Drawing multiple lines"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Visualizing maps"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev7yb","search_text":"Saving charts","text_count":13,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Saving charts"}]},{"block_type":"element","block":"k67ev7yc","search_text":"Once a chart is ready, we can store it on the hard drive so it can be referenced in other documents. We'll see in this recipe how to save charts in different formats.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once a chart is ready, we can store it on the hard drive so it can be referenced in other documents. We'll see in this recipe how to save charts in different formats."}]},{"block_type":"element","block":"k67ev7yd","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7ye","search_text":"We need to install matplotlib in our virtual environment:","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to install&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;in our virtual environment:"}]},{"block_type":"element","block":"k67ev7yf","search_text":"$ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":80,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7yg","search_text":"If you are using macOS, it's possible that you get an error like this— RuntimeError: Python is not installed as a framework . See the matplolib documentation on how to fix it: https://matplotlib.org/faq/osx_framework.html .","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using macOS, it's possible that you get an error like this&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RuntimeError: Python is not installed as a framework"}]},{"block_type":"text","content":". See the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplolib"}]},{"block_type":"text","content":"&nbsp;documentation on how to fix it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/faq/osx_framework.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/faq/osx_framework.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7yh","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7yi","search_text":"Import matplotlib : ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7yj","search_text":">>> import matplotlib.pyplot as plt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import matplotlib.pyplot as plt"}]}]},{"block_type":"element","block":"k67ev7yk","search_text":"Prepare the data to be displayed on the graph and split it into different arrays: ","text_count":82,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the data to be displayed on the graph and split it into different arrays:"}]}]},{"block_type":"element","block":"k67ev7yl","search_text":">>> DATA = ( ... ('Q1 2017', 100), ... ('Q2 2017', 150), ... ('Q3 2017', 125), ... ('Q4 2017', 175), ... ) >>> POS = list(range(len(DATA))) >>> VALUES = [value for label, value in DATA] >>> LABELS = [label for label, value in DATA]","text_count":231,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; DATA = (\n...    ('Q1 2017', 100),\n...    ('Q2 2017', 150),\n...    ('Q3 2017', 125),\n...    ('Q4 2017', 175),\n... )\n&gt;&gt;&gt; POS = list(range(len(DATA)))\n&gt;&gt;&gt; VALUES = [value for label, value in DATA]\n&gt;&gt;&gt; LABELS = [label for label, value in DATA]"}]}]},{"block_type":"element","block":"k67ev7ym","search_text":"Create a bar graph with the data: ","text_count":34,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a bar graph with the data:"}]}]},{"block_type":"element","block":"k67ev7yn","search_text":">>> plt.bar(POS, VALUES) >>> plt.xticks(POS, LABELS) >>> plt.ylabel('Sales')","text_count":76,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.bar(POS, VALUES)\n&gt;&gt;&gt; plt.xticks(POS, LABELS)\n&gt;&gt;&gt; plt.ylabel('Sales')"}]}]},{"block_type":"element","block":"k67ev7yo","search_text":"Save the graph to the hard drive: ","text_count":34,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the graph to the hard drive:"}]}]},{"block_type":"element","block":"k67ev7yp","search_text":">>> plt.savefig('data.png')","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.savefig('data.png')"}]}]},{"block_type":"element","block":"k67ev7yq","search_text":"","text_count":0,"tag_name":"ol","attributes":{"start":"6"},"children":[]},{"block_type":"element","block":"k67ev7yr","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7ys","search_text":"After importing and preparing the data in steps 1 and 2 in the How to do it… section, the graph is generated in step 3 by calling .bar . A .ylabel is added and the X axis is labeled with the proper time description through .xticks .","text_count":232,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing and preparing the data in steps 1 and 2 in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"How to do it&hellip;"}]},{"block_type":"text","content":"section, the graph is generated in step 3 by calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".bar"}]},{"block_type":"text","content":". A"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".ylabel"}]},{"block_type":"text","content":"is added and the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"axis is labeled with the proper time description through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".xticks"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7yt","search_text":"Step 4 saves the file to the hard drive with the name data.png .","text_count":64,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 saves the file to the hard drive with the name"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"data.png"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7yu","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev7yv","search_text":"The resolution of the image can be determined through the dpi parameter. This will affect the size of the file. Use resolutions between 72 and 300 . Lower ones will be difficult to read, and higher ones won't make sense unless the size of the graph is humongous:","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The resolution of the image can be determined through the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dpi"}]},{"block_type":"text","content":"parameter. This will affect the size of the file. Use resolutions between"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"72"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"300"}]},{"block_type":"text","content":". Lower ones will be difficult to read, and higher ones won't make sense unless the size of the graph is humongous:"}]},{"block_type":"element","block":"k67ev7yw","search_text":">>> plt.savefig('data.png', dpi=72)","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; plt.savefig('data.png', dpi=72)"}]}]},{"block_type":"element","block":"k67ev7yx","search_text":"matplotlib understands how to store the most common file formats, such as JPEG, PDF, and PNG. It will be used automatically when the filename has the proper extension.","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"understands how to store the most common file formats, such as JPEG, PDF, and PNG. It will be used automatically when the filename has the proper extension."}]},{"block_type":"element","block":"k67ev7yy","search_text":"Tip Unless you have a specific requirement, use PNG. It is very efficient at storing graphs with limited colors when compared with other formats. If you need to find all the supported files, you can call plt.gcf().canvas.get_supported_filetypes() . ","text_count":249,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Unless you have a specific requirement, use PNG. It is very efficient at storing graphs with limited colors when compared with other formats. If you need to find all the supported files, you can call&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"plt.gcf().canvas.get_supported_filetypes()"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev7yz","search_text":"The full matplotlib documentation can be found here: https://matplotlib.org/ . In particular, the guide for legends is here: https://matplotlib.org/users/legend_guide.html#plotting-guide-legend . For annotations, it is here: https://matplotlib.org/users/annotations.html .","text_count":272,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"&nbsp;documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":". In particular, the guide for legends is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/legend_guide.html#plotting-guide-legend"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/legend_guide.html#plotting-guide-legend"}]},{"block_type":"text","content":". For annotations, it is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/users/annotations.html"},"children":[{"block_type":"text","content":"https://matplotlib.org/users/annotations.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7z0","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev7z1","search_text":"The Plotting a simple sales graph recipe The Adding legends and annotations recipe ","text_count":83,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Plotting a simple sales graph"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Dealing with Communication Channels","author":"Jaime Buelta","block":"k67euo9v","number":8,"contents":[{"block_type":"element","block":"k67ev7z2","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k67ev7z3","search_text":"Working with email templates Sending an individual email Reading an email Adding subscribers to an email newsletter Sending notifications via email Producing SMS Receiving SMS Creating a Telegram bot ","text_count":200,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Working with email templates"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Sending an individual email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Reading an email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Adding subscribers to an email newsletter"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Sending notifications via email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Receiving SMS"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating a Telegram bot"}]}]},{"block_type":"element","block":"k67ev7z4","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev7z5","search_text":"Dealing with communication channels is where automating things can produce big gains. In this recipe, we'll see how to work with two of the most common communication channels—emails, including newsletters, as well as sending and receiving text messages by phone.","text_count":262,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Dealing with communication channels is where automating things can produce big gains. In this recipe, we'll see how to work with two of the most common communication channels&mdash;emails, including newsletters, as well as sending and receiving text messages by phone."}]},{"block_type":"element","block":"k67ev7z6","search_text":"During the years, there has been a fair amount of abuse in methods of delivery, like spam or unsolicited marketing messages, making necessary to partner with external tools to avoid messages to be automatically rejected by automated filters. We will present the proper caveats where applicable. All the tools presented have excellent documentation, so do not be afraid to read it. They also have a lot of features, and they may be able to do something that is exactly what you're looking for.","text_count":492,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"During the years, there has been a fair amount of abuse in methods of delivery, like spam or unsolicited marketing messages, making necessary to partner with external tools to avoid messages to be automatically rejected by automated filters. We will present the proper caveats where applicable. All the tools&nbsp;presented&nbsp;have excellent documentation, so do not be afraid to read it. They also have a lot of features, and they may be able to do something that is exactly what you're looking for."}]},{"block_type":"element","block":"k67ev7z7","search_text":"Working with email templates","text_count":28,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Working with email templates"}]},{"block_type":"element","block":"k67ev7z8","search_text":"To send an email, we first need to generate its content. In this recipe, we'll see how to generate a proper template, in both text-only style and HTML.","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To send an email, we first need to generate its content. In this recipe, we'll see how to generate a proper template, in both text-only style and HTML."}]},{"block_type":"element","block":"k67ev7z9","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev7za","search_text":"We should start by installing the mistune module, which will compile Markdown documents into HTML. We will also use the jinja2 module to combine HTML with our text:","text_count":164,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We should start by installing the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mistune"}]},{"block_type":"text","content":"&nbsp;module, which will compile Markdown documents into HTML. We will also use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"jinja2"}]},{"block_type":"text","content":"&nbsp;module&nbsp;to combine HTML with our text:"}]},{"block_type":"element","block":"k67ev7zb","search_text":"$ echo \"mistune==0.8.3\" >> requirements.txt $ echo \"jinja2==2.20\" >> requirements.txt $ pip install -r requirements.txt","text_count":119,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"mistune==0.8.3\" &gt;&gt; requirements.txt\n$ echo \"jinja2==2.20\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev7zc","search_text":"In the GitHub repo, there are a couple of templates we will use— email_template.md in https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/email_template.md and a template for styling, email_styling.html , in https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/email_styling.html .","text_count":344,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the GitHub repo, there are a couple of templates we will use&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_template.md"}]},{"block_type":"text","content":"in&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/email_template.md"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/email_template.md"}]},{"block_type":"text","content":"and a template for styling,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_styling.html"}]},{"block_type":"text","content":", in&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/email_styling.html"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/email_styling.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7zd","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev7ze","search_text":"Import the modules: ","text_count":20,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the modules:"}]}]},{"block_type":"element","block":"k67ev7zf","search_text":">>> import mistune >>> import jinja2","text_count":36,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import mistune\n&gt;&gt;&gt; import jinja2"}]}]},{"block_type":"element","block":"k67ev7zg","search_text":"Read both templates from disk: ","text_count":31,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Read both templates from disk:"}]}]},{"block_type":"element","block":"k67ev7zh","search_text":">>> with open('email_template.md') as md_file: ... markdown = md_file.read() >>> with open('email_styling.html') as styling_file: ... styling = styling_file.read()","text_count":163,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('email_template.md') as md_file:\n...     markdown = md_file.read()\n\n&gt;&gt;&gt; with open('email_styling.html') as styling_file:\n...     styling = styling_file.read()"}]}]},{"block_type":"element","block":"k67ev7zi","search_text":"Define the data to include in the template. The template is quite simple and accepts only a single parameter: ","text_count":110,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":"to include in the template. The template is quite simple and accepts only a single parameter:"}]}]},{"block_type":"element","block":"k67ev7zj","search_text":">>> data = {'name': 'Seamus'}","text_count":29,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = {'name': 'Seamus'}"}]}]},{"block_type":"element","block":"k67ev7zk","search_text":"Render the Markdown template. This produces the text-only version of the data : ","text_count":80,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Render the Markdown template. This produces the text-only version of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev7zl","search_text":">>> text = markdown.format(**data)","text_count":34,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; text = markdown.format(**data)"}]}]},{"block_type":"element","block":"k67ev7zm","search_text":"Render the Markdown and add the styling: ","text_count":41,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Render the Markdown and add the styling:"}]}]},{"block_type":"element","block":"k67ev7zn","search_text":">>> html_content = mistune.markdown(text) >>> html = jinja2.Template(styling).render(content=html_content)","text_count":106,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; html_content = mistune.markdown(text)\n&gt;&gt;&gt; html = jinja2.Template(styling).render(content=html_content)"}]}]},{"block_type":"element","block":"k67ev7zo","search_text":"Save the text and the HTML version to disk to check them: ","text_count":58,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Save the text and the HTML version to disk to check them:"}]}]},{"block_type":"element","block":"k67ev7zp","search_text":">>> with open('text_version.txt', 'w') as fp: ... fp.write(text) >>> with open('html_version.html', 'w') as fp: ... fp.write(html)","text_count":130,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with open('text_version.txt', 'w') as fp:\n...     fp.write(text)\n&gt;&gt;&gt; with open('html_version.html', 'w') as fp:\n...     fp.write(html)"}]}]},{"block_type":"element","block":"k67ev7zq","search_text":"Check the text version: ","text_count":24,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the text version:"}]}]},{"block_type":"element","block":"k67ev7zr","search_text":"$ cat text_version.txt Hi Seamus: This is an email talking about **things** ### Very important info 1. One thing 2. Other thing 3. Some extra detail Best regards, *The email team*","text_count":179,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ cat text_version.txt\nHi Seamus:\n\nThis is an email talking about **things**\n\n### Very important info\n\n1. One thing\n2. Other thing\n3. Some extra detail\n\nBest regards,\n\n  *The email team*"}]}]},{"block_type":"element","block":"k67ev7zs","search_text":"Check the HTML version in a browser: ","text_count":37,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the HTML version in a browser:"}]}]},{"block_type":"element","block":"k67ev7zt","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000049.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev7zu","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev7zv","search_text":"Step 1 gets the modules that will be used later, and step 2 reads the two templates that will be rendered. email_template.md is the basis of the content, and it's a Markdown template. email_styling.html is an HTML template that contains the basic HTML surrounding and CSS styling information.","text_count":292,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 gets the modules that will be used later, and step 2 reads the two templates that will be rendered.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_template.md"}]},{"block_type":"text","content":"&nbsp;is the basis of the content, and it's a Markdown template.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_styling.html"}]},{"block_type":"text","content":"is an HTML template that contains the basic HTML surrounding and CSS styling information."}]},{"block_type":"element","block":"k67ev7zw","search_text":"Note The basic structure is to create the content in Markdown format. This is a plain-text file that's readable and can be send as part of the email. That content can then be converted into HTML and surrounded with some styling to create an HTML function. email_styling.html has a content area to put the rendered HTML from Markdown. ","text_count":334,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic structure is to create the content in Markdown format. This is a plain-text file that's readable and can be send as part of the email. That content can then be converted into HTML and surrounded with some styling to create an HTML function.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_styling.html"}]},{"block_type":"text","content":"has a content area to put the rendered HTML from Markdown."}]}]},{"block_type":"element","block":"k67ev7zx","search_text":"Step 3 defines the data that will render in email_template.md . It is a very simple template that only requires a parameter called name .","text_count":137,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 defines the data that will render in&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_template.md"}]},{"block_type":"text","content":". It is a very simple template that only requires a parameter called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"name"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev7zy","search_text":"In step 4, the Markdown template gets rendered with the data . This produces the plain-text version of the email.","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 4, the Markdown template gets rendered with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"data"}]},{"block_type":"text","content":". This produces the plain-text version of the email."}]},{"block_type":"element","block":"k67ev7zz","search_text":"The HTML version is rendered in step 5. The plain-text version is rendered to HTML using mistune , and then it is wrapped in email_styling.html using a jinja2 template. The final version is a self-contained HTML document.","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HTML"}]},{"block_type":"text","content":"version is rendered in step 5. The plain-text version is rendered to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HTML"}]},{"block_type":"text","content":"using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mistune"}]},{"block_type":"text","content":", and then it is wrapped in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_styling.html"}]},{"block_type":"text","content":"using a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"jinja2"}]},{"block_type":"text","content":"template. The final version is a self-contained HTML document."}]},{"block_type":"element","block":"k67ev800","search_text":"Finally, we save both versions, plain-text (as text ) and HTML (as html ), to a file in step 6. Steps 7 and 8 check the stored values. The information is the same, but in the HTML version, it is styled.","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, we save both versions, plain-text (as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"text"}]},{"block_type":"text","content":") and HTML (as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"html"}]},{"block_type":"text","content":"), to a file in step 6. Steps 7 and 8 check the stored values. The information is the same, but in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HTML"}]},{"block_type":"text","content":"version, it is styled."}]},{"block_type":"element","block":"k67ev801","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev802","search_text":"Using Markdown makes dual emails with text and HTML easy to generate. Markdown is quite readable in text format, and renders very naturally into HTML. That said, it is possible to generate a totally different HTML version, which will allow for more customization and taking advantage of HTML's features.","text_count":303,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Using Markdown makes dual emails with text and HTML easy to generate. Markdown is quite readable in text format, and renders very naturally into HTML. That said, it is possible to generate a totally different HTML version, which will allow for more customization and taking advantage of HTML's features."}]},{"block_type":"element","block":"k67ev803","search_text":"The full Markdown syntax can be found at https://daringfireball.net/projects/markdown/syntax and a good cheat sheet with the most commonly used elements is at https://beegit.com/markdown-cheat-sheet .","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full&nbsp;Markdown&nbsp;syntax can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://daringfireball.net/projects/markdown/syntax"},"children":[{"block_type":"text","content":"https://daringfireball.net/projects/markdown/syntax"}]},{"block_type":"text","content":"&nbsp;and a good cheat sheet with the most commonly used elements is at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://beegit.com/markdown-cheat-sheet"},"children":[{"block_type":"text","content":"https://beegit.com/markdown-cheat-sheet"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev804","search_text":"Tip While making a plain-text-only version of an email is not strictly necessary, it is a good practice and shows you care about who reads the email. Most email clients accept HTML, but it's not totally universal. ","text_count":214,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While making a plain-text-only version of an email is not strictly necessary, it is a good practice and shows you care about who reads the email. Most email clients accept HTML, but it's not totally universal.&nbsp;"}]}]},{"block_type":"element","block":"k67ev805","search_text":"For an HTML email, note that the whole style should be contained in the email. That means that the CSS needs to be embedded into the HTML . Avoid making external calls that could lead the email to not render properly in some email clients, or even be qualified as spam.","text_count":269,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For an HTML email, note that the whole style should be contained in the email. That means that the CSS needs to be embedded into the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HTML"}]},{"block_type":"text","content":". Avoid making external calls that could lead the email to not render properly in some email clients, or even be qualified as spam."}]},{"block_type":"element","block":"k67ev806","search_text":"The styling in email_styling.html is based on the modest style that can be found here: http://markdowncss.github.io/ . There are more CSS styles that can be used, and a search in Google should find more. Remember to remove any external references, as discussed before.","text_count":268,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The styling in&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email_styling.html"}]},{"block_type":"text","content":"&nbsp;is based on the&nbsp;modest&nbsp;style that can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://markdowncss.github.io/"},"children":[{"block_type":"text","content":"http://markdowncss.github.io/"}]},{"block_type":"text","content":". There are more CSS styles that can be used, and a search in Google should find more. Remember to remove any external references, as discussed before."}]},{"block_type":"element","block":"k67ev807","search_text":"Images can be included in HTML by encoding the image in base64 format so it can be embedded directly in the HTML img tag, instead of adding a reference:","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Images can be included in HTML by encoding the image in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"base64"}]},{"block_type":"text","content":"format so it can be embedded directly in the HTML"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"img"}]},{"block_type":"text","content":"tag, instead of adding a reference:"}]},{"block_type":"element","block":"k67ev808","search_text":">>> import base64 >>> with open(\"image.png\",'rb') as file: ... encoded_data = base64.b64encode(file) >>> print \"<img data-src='https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/data:image/png;base64,{data}'/>\".format(data=encoded_data)","text_count":275,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import base64\n&gt;&gt;&gt; with open(\"image.png\",'rb') as file:\n...    encoded_data = base64.b64encode(file)\n&gt;&gt;&gt; print \"&lt;img data-src='https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/data:image/png;base64,{data}'/&gt;\".format(data=encoded_data)"}]}]},{"block_type":"element","block":"k67ev809","search_text":"You can find more information about this technique in this article: https://css-tricks.com/data-uris/ .","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can find more information about this technique in&nbsp;this article:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://css-tricks.com/data-uris/"},"children":[{"block_type":"text","content":"https://css-tricks.com/data-uris/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev80a","search_text":"The mistune full docs are available at http://mistune.readthedocs.io/en/latest/ and the jinja2 documentation at http://jinja.pocoo.org/docs/2.10/ .","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mistune"}]},{"block_type":"text","content":"full docs are available at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://mistune.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"http://mistune.readthedocs.io/en/latest/"}]},{"block_type":"text","content":"&nbsp;and the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"jinja2"}]},{"block_type":"text","content":"documentation at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://jinja.pocoo.org/docs/2.10/"},"children":[{"block_type":"text","content":"http://jinja.pocoo.org/docs/2.10/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev80b","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev80c","search_text":"The Formatting text in Markdown recipe in Chapter 5, Generating Fantastic Reports The Using templates for reports recipe in Chapter 5, Generating Fantastic Reports The Sending transactional emails recipe in Chapter 5, Generating Fantastic Reports ","text_count":247,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Formatting text in Markdown"}]},{"block_type":"text","content":"recipe in Chapter 5,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using templates for reports recipe"}]},{"block_type":"text","content":"in Chapter 5,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports&nbsp;"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending transactional emails"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 5,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports&nbsp;"}]}]}]},{"block_type":"element","block":"k67ev80d","search_text":"Sending an individual email","text_count":27,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Sending an individual email"}]},{"block_type":"element","block":"k67ev80e","search_text":"The most basic way of sending an email is to send an individual one from an email account. This option is only recommended for very sporadic use, but for simple purposes such as sending a couple of emails a day to controlled addresses, it can be good enough.","text_count":258,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The most basic way of sending an email is to send an individual one from an email account. This option is only recommended for very sporadic use, but for simple purposes such as sending a couple of emails a day to controlled addresses, it can be good enough."}]},{"block_type":"element","block":"k67ev80f","search_text":"Tip Do not use this method to send emails in bulk to distribution lists or to customers with unknown email addresses. You risk being banned from your service provider due to anti-spam rules. See other recipes in this chapter for more options. ","text_count":243,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Do not use this method to send emails in bulk to distribution lists or to customers with unknown email addresses. You risk being banned from your service provider due to anti-spam rules. See other recipes in this chapter for more options."}]}]},{"block_type":"element","block":"k67ev80g","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev80h","search_text":"For this recipe, we'll need an email account with a service provider. There are small differences based on the provider to use, but we'll use a Gmail account, as it is very common and free to access.","text_count":199,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we'll need an email account with a service provider. There are small differences based on the provider to use, but we'll use a Gmail account, as it is very common and free to access."}]},{"block_type":"element","block":"k67ev80i","search_text":"Due to Gmail's security, we'll need to create a specific app password that can be used to send an email. Follow the instructions here: https://support.google.com/accounts/answer/185833 . This will help to generate a password for the purpose of this recipe. Remember to create it for mail access. You can delete the password afterwards to remove it.","text_count":348,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Due to Gmail's security, we'll need to create a specific app password that can be used to send an email. Follow the instructions here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://support.google.com/accounts/answer/185833"},"children":[{"block_type":"text","content":"https://support.google.com/accounts/answer/185833"}]},{"block_type":"text","content":". This will help to generate a password for the purpose of this recipe. Remember to create it for mail access. You can delete the password afterwards to remove it."}]},{"block_type":"element","block":"k67ev80j","search_text":"We'll use the smtplib module, which is part of Python's standard library.","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"smtplib"}]},{"block_type":"text","content":"module, which is part of Python's standard library."}]},{"block_type":"element","block":"k67ev80k","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev80l","search_text":"Import the smtplib and email modules: ","text_count":38,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"smtplib"}]},{"block_type":"text","content":"&nbsp;and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email"}]},{"block_type":"text","content":"&nbsp;modules:"}]}]},{"block_type":"element","block":"k67ev80m","search_text":">>> import smtplib >>> from email.mime.multipart import MIMEMultipart >>> from email.mime.text import MIMEText","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import smtplib\n&gt;&gt;&gt; from email.mime.multipart import MIMEMultipart\n&gt;&gt;&gt; from email.mime.text import MIMEText"}]}]},{"block_type":"element","block":"k67ev80n","search_text":"Set up the credentials, replacing these with your own ones. For testing purposes, we'll send to the same email, but feel free to use a different address: ","text_count":154,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up the credentials, replacing these with your own ones. For testing purposes, we'll send to the same email, but feel free to use a different address:"}]}]},{"block_type":"element","block":"k67ev80o","search_text":">>> USER = 'your.account@gmail.com' >>> PASSWORD = 'YourPassword' >>> sent_from = USER >>> send_to = [USER]","text_count":107,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; USER = 'your.account@gmail.com'\n&gt;&gt;&gt; PASSWORD = 'YourPassword'\n&gt;&gt;&gt; sent_from = USER\n&gt;&gt;&gt; send_to = [USER]"}]}]},{"block_type":"element","block":"k67ev80p","search_text":"Define the data to be sent. Notice the two alternatives, a plain-text one and an HTML one: ","text_count":91,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the data to be sent. Notice the two alternatives, a plain-text one and an HTML one:"}]}]},{"block_type":"element","block":"k67ev80q","search_text":">>> text = \"Hi!\\nThis is the text version linking to https://www.packtpub.com/\\nCheers!\" >>> html = \"\"\"<html><head></head><body> ... <p>Hi!<br> ... This is the HTML version linking to <a href=\"https://www.packtpub.com/\">Packt</a><br> ... </p> ... </body></html> \"\"\"","text_count":265,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; text = \"Hi!\\nThis is the text version linking to https://www.packtpub.com/\\nCheers!\"\n&gt;&gt;&gt; html = \"\"\"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;\n... &lt;p&gt;Hi!&lt;br&gt;\n... This is the HTML version linking to &lt;a href=\"https://www.packtpub.com/\"&gt;Packt&lt;/a&gt;&lt;br&gt;\n... &lt;/p&gt;\n... &lt;/body&gt;&lt;/html&gt;\n\"\"\""}]}]},{"block_type":"element","block":"k67ev80r","search_text":"Compose the message as a MIME multipart, including subject , to , and from : ","text_count":77,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Compose the message as a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MIME"}]},{"block_type":"text","content":"multipart, including&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"subject"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"to"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"from"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev80s","search_text":">>> msg = MIMEMultipart('alternative') >>> msg['Subject'] = 'An interesting email' >>> msg['From'] = sent_from >>> msg['To'] = ', '.join(send_to)","text_count":145,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; msg = MIMEMultipart('alternative')\n&gt;&gt;&gt; msg['Subject'] = 'An interesting email'\n&gt;&gt;&gt; msg['From'] = sent_from\n&gt;&gt;&gt; msg['To'] = ', '.join(send_to)"}]}]},{"block_type":"element","block":"k67ev80t","search_text":"Fill the data content parts of the email: ","text_count":42,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Fill the data&nbsp;content parts of the email:"}]}]},{"block_type":"element","block":"k67ev80u","search_text":">>> part_plain = MIMEText(text, 'plain') >>> part_html = MIMEText(html, 'html') >>> msg.attach(part_plain) >>> msg.attach(part_html)","text_count":132,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; part_plain = MIMEText(text, 'plain')\n&gt;&gt;&gt; part_html = MIMEText(html, 'html')\n&gt;&gt;&gt; msg.attach(part_plain)\n&gt;&gt;&gt; msg.attach(part_html)"}]}]},{"block_type":"element","block":"k67ev80v","search_text":"Send the email, using the SMTP SSL protocol: ","text_count":45,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send the email, using the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SMTP SSL"}]},{"block_type":"text","content":"protocol:"}]}]},{"block_type":"element","block":"k67ev80w","search_text":">>> with smtplib.SMTP_SSL('smtp.gmail.com', 465) as server: ... server.login(USER, PASSWORD) ... server.sendmail(sent_from, send_to, msg.as_string())","text_count":149,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; with smtplib.SMTP_SSL('smtp.gmail.com', 465) as server:\n...     server.login(USER, PASSWORD)\n...     server.sendmail(sent_from, send_to, msg.as_string())"}]}]},{"block_type":"element","block":"k67ev80x","search_text":"The email is sent. Check your email account for the message. Checking the original email , you can see the full raw email, with elements in both HTML and plain-text. The email is presented redacted: ","text_count":199,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The email is sent. Check your email account for the message. Checking the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"original email"}]},{"block_type":"text","content":", you can see the full raw email, with elements in both&nbsp;HTML and plain-text. The email is presented redacted:"}]}]},{"block_type":"element","block":"k67ev80y","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000073.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev80z","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev810","search_text":"After step 1, making the pertinent imports from stmplib and email , step 2 defines the credentials obtained from Gmail.","text_count":119,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After step 1, making the pertinent imports from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"stmplib"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email"}]},{"block_type":"text","content":", step 2 defines the credentials obtained from Gmail."}]},{"block_type":"element","block":"k67ev811","search_text":"Step 3 shows the HTML and text that is going to be sent. They are alternatives, so they should present the same information, but in different formats.","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 shows the HTML and text that is going to be sent. They are alternatives, so they should present the same information, but in different formats."}]},{"block_type":"element","block":"k67ev812","search_text":"The basic message information is set up in step 4. It specifies the subject of the email, as well as the from and to . Step 5 adds multiple parts, each with the proper MIMEText type.","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic message information is set up in step 4. It specifies the subject of the email, as well as the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"from"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"to"}]},{"block_type":"text","content":". Step 5 adds multiple parts, each with the proper"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MIMEText"}]},{"block_type":"text","content":"type."}]},{"block_type":"element","block":"k67ev813","search_text":"Note The last part added is the preferred alternative, according to the MIME format, so we add the HTML part last. ","text_count":115,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The last part added&nbsp;is the preferred alternative, according to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MIME"}]},{"block_type":"text","content":"format, so we add the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"HTML"}]},{"block_type":"text","content":"part last."}]}]},{"block_type":"element","block":"k67ev814","search_text":"Step 6 sets up the connection with the server, logs in using the credentials, and sends the message. It uses a with context to get the connection. ","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 6 sets up the connection with the server, logs in using the credentials, and sends the message. It uses a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"with"}]},{"block_type":"text","content":"context to get the connection.&nbsp;"}]},{"block_type":"element","block":"k67ev815","search_text":"If there's an error with the credentials, it will raise an exception with username and password not accepted.","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If there's an error with the credentials, it will raise an exception with&nbsp;username and password not accepted."}]},{"block_type":"element","block":"k67ev816","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev817","search_text":"Note that sent_to is a list of addresses. You can send an email to more than one address. The only caveat is in step 4, where it needs to be specified as a list of comma-separated value for all addresses.","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sent_to"}]},{"block_type":"text","content":"is a list of addresses. You can send an email to more than one address. The only caveat is in step 4, where it needs to be specified as a list of comma-separated value for all addresses."}]},{"block_type":"element","block":"k67ev818","search_text":"Tip Although it is possible to label sent_from as a different address than that used to send the email, it is not recommended. That can be interpreted as an indication of trying to fake the origin of the email, and provoke detection as a spam source. ","text_count":251,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Although it is possible to label"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sent_from"}]},{"block_type":"text","content":"as a different address than that used to send the email, it is not recommended. That can be interpreted as an indication of trying to fake the origin of the email, and provoke detection as a spam source."}]}]},{"block_type":"element","block":"k67ev819","search_text":"The server used here, smtp.gmail.com , is the one specified by Gmail, and the defined port for SMTPS (secure SMTP ) is 465 . Gmail also accepts port 587 , which is the standard, but requires you to specify the kind of session by calling .starttls , as shown in the next code:","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The server used here,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"smtp.gmail.com"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":",&nbsp;"}]},{"block_type":"text","content":"is the one specified by Gmail, and the defined port for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SMTPS"}]},{"block_type":"text","content":"(secure"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SMTP"}]},{"block_type":"text","content":") is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"465"}]},{"block_type":"text","content":". Gmail also accepts port&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"587"}]},{"block_type":"text","content":", which is the standard, but requires you to specify the kind of session by calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".starttls"}]},{"block_type":"text","content":", as shown in the next code:"}]},{"block_type":"element","block":"k67ev81a","search_text":"with smtplib.SMTP('smtp.gmail.com', 587) as server: server.starttls() server.login(USER, PASSWORD) server.sendmail(sent_from, send_to, msg.as_string())","text_count":151,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"with smtplib.SMTP('smtp.gmail.com', 587) as server:\n    server.starttls()\n    server.login(USER, PASSWORD)\n    server.sendmail(sent_from, send_to, msg.as_string())"}]}]},{"block_type":"element","block":"k67ev81b","search_text":"If you are interested in more details about these differences and both protocols, you can find more information in this article: https://www.fastmail.com/help/technical/ssltlsstarttls.html .","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are interested in more details about these differences and both protocols, you can find more information in this&nbsp;article:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.fastmail.com/help/technical/ssltlsstarttls.html"},"children":[{"block_type":"text","content":"https://www.fastmail.com/help/technical/ssltlsstarttls.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev81c","search_text":"The full smtplib documentation can be found at https://docs.python.org/3/library/smtplib.html , and the email module, with info on the different formats for emails, including examples on MIME types, can be found here: https://docs.python.org/3/library/email.html .","text_count":264,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"smtplib"}]},{"block_type":"text","content":"documentation can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/smtplib.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/smtplib.html"}]},{"block_type":"text","content":", and the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email"}]},{"block_type":"text","content":"module, with info on the different formats for emails, including examples on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MIME"}]},{"block_type":"text","content":"types, can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/email.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/email.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev81d","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev81e","search_text":"The Working with email templates recipe The Sending an individual email recipe ","text_count":79,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Working with email templates"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending an individual email"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev81f","search_text":"Reading an email","text_count":16,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Reading an email"}]},{"block_type":"element","block":"k67ev81g","search_text":"In this recipe, we'll see how to read emails from an account. We'll use the IMAP4 standard, which is the most commonly used standard for reading email.","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to read emails from an account. We'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"IMAP4"}]},{"block_type":"text","content":"standard, which is the most commonly used standard for&nbsp;reading&nbsp;email."}]},{"block_type":"element","block":"k67ev81h","search_text":"Once read, the email can be processed and analyzed automatically to generate actions such as smart automated responses, forwarding the email to a different target, aggregating the results for monitoring, and so on. The options are unlimited!","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once read, the email can be processed and analyzed automatically to generate actions such as smart automated responses, forwarding the email to a different target, aggregating the results for monitoring, and so on. The options are unlimited!"}]},{"block_type":"element","block":"k67ev81i","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev81j","search_text":"For this recipe, we'll need an email account with a service provider. There are small differences based on the provider to use, but we'll use a Gmail account, as it is very common and free to access.","text_count":199,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we'll need an email account with a service provider. There are small differences based on the provider to use, but we'll use a Gmail account, as it is very common and free to access."}]},{"block_type":"element","block":"k67ev81k","search_text":"Due to Gmail's security, we'll need to create a specific app password to use to send an email. Follow the instructions here: https://support.google.com/accounts/answer/185833 . This will generate a password for the purpose of this recipe. Remember to create it for mail. You can delete the password afterwards to remove it.","text_count":323,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Due to Gmail's security, we'll need to create a specific app password to use to send an email. Follow the instructions here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://support.google.com/accounts/answer/185833"},"children":[{"block_type":"text","content":"https://support.google.com/accounts/answer/185833"}]},{"block_type":"text","content":". This will generate a password for the purpose of this recipe. Remember to create it for mail. You can delete the password afterwards to remove it."}]},{"block_type":"element","block":"k67ev81l","search_text":"We'll use the imaplib module, which is part of Python's standard library.","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"imaplib"}]},{"block_type":"text","content":"&nbsp;module, which is part of Python's standard library."}]},{"block_type":"element","block":"k67ev81m","search_text":"The recipe will read the last received email, so you can use it for better control over what's going to be read. We'll send a short email that looks like it was sent to support.","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The recipe will read the last received email, so you can use it for better control over what's going to be read. We'll send a short email that looks like it was sent to support."}]},{"block_type":"element","block":"k67ev81n","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev81o","search_text":"Import the imaplib and email modules: ","text_count":38,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"imaplib"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email"}]},{"block_type":"text","content":"&nbsp;modules:"}]}]},{"block_type":"element","block":"k67ev81p","search_text":">>> import imaplib >>> import email >>> from email.parser import BytesParser, Parser >>> from email.policy import default","text_count":121,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import imaplib\n&gt;&gt;&gt; import email\n&gt;&gt;&gt; from email.parser import BytesParser, Parser\n&gt;&gt;&gt; from email.policy import default"}]}]},{"block_type":"element","block":"k67ev81q","search_text":"Set up the credentials, replacing these with your own ones: ","text_count":60,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up the credentials, replacing these with your own ones:"}]}]},{"block_type":"element","block":"k67ev81r","search_text":">>> USER = 'your.account@gmail.com' >>> PASSWORD = 'YourPassword'","text_count":65,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; USER = 'your.account@gmail.com'\n&gt;&gt;&gt; PASSWORD = 'YourPassword'"}]}]},{"block_type":"element","block":"k67ev81s","search_text":"Connect to the email server: ","text_count":29,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Connect to the email server:"}]}]},{"block_type":"element","block":"k67ev81t","search_text":">>> mail = imaplib.IMAP4_SSL('imap.gmail.com') >>> mail.login(USER, PASSWORD)","text_count":77,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; mail = imaplib.IMAP4_SSL('imap.gmail.com')\n&gt;&gt;&gt; mail.login(USER, PASSWORD)"}]}]},{"block_type":"element","block":"k67ev81u","search_text":"Select the inbox folder: ","text_count":25,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Select the inbox folder:"}]}]},{"block_type":"element","block":"k67ev81v","search_text":">>> mail.select('inbox')","text_count":24,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; mail.select('inbox')"}]}]},{"block_type":"element","block":"k67ev81w","search_text":"Read all email UIDs and retrieve the latest received email: ","text_count":60,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Read all email UIDs and retrieve the latest received email:"}]}]},{"block_type":"element","block":"k67ev81x","search_text":">>> result, data = mail.uid('search', None, 'ALL') >>> latest_email_uid = data[0].split()[-1] >>> result, data = mail.uid('fetch', latest_email_uid, '(RFC822)') >>> raw_email = data[0][1]","text_count":187,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; result, data = mail.uid('search', None, 'ALL')\n&gt;&gt;&gt; latest_email_uid = data[0].split()[-1]\n&gt;&gt;&gt; result, data = mail.uid('fetch', latest_email_uid, '(RFC822)')\n&gt;&gt;&gt; raw_email = data[0][1]"}]}]},{"block_type":"element","block":"k67ev81y","search_text":"Parse the email into a Python object: ","text_count":38,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parse the email into a Python object:"}]}]},{"block_type":"element","block":"k67ev81z","search_text":">>> email_message = BytesParser(policy=default).parsebytes(raw_email)","text_count":69,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; email_message = BytesParser(policy=default).parsebytes(raw_email)"}]}]},{"block_type":"element","block":"k67ev820","search_text":"Display the subject and sender of the email: ","text_count":45,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display the subject and sender of the email:"}]}]},{"block_type":"element","block":"k67ev821","search_text":">>> email_message['subject'] '[Ref ABCDEF] Subject: Product A' >>> email.utils.parseaddr(email_message['From']) ('Sender name', 'sender@gmail.com')","text_count":147,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; email_message['subject']\n'[Ref ABCDEF] Subject: Product A'\n&gt;&gt;&gt; email.utils.parseaddr(email_message['From'])\n('Sender name', 'sender@gmail.com')"}]}]},{"block_type":"element","block":"k67ev822","search_text":"Retrieve the payload of the text: ","text_count":34,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieve the payload of the text:"}]}]},{"block_type":"element","block":"k67ev823","search_text":">>> email_type = email_message.get_content_maintype() >>> if email_type == 'multipart': ... for part in email_message.get_payload(): ... if part.get_content_type() == 'text/plain': ... payload = part.get_payload() ... elif email_type == 'text': ... payload = email_message.get_payload() >>> print(payload) Hi: I'm having difficulties getting into my account. What was the URL, again? Thanks! A confuser customer","text_count":411,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; email_type = email_message.get_content_maintype()\n&gt;&gt;&gt; if email_type == 'multipart':\n...     for part in email_message.get_payload():\n...         if part.get_content_type() == 'text/plain':\n...             payload = part.get_payload()\n... elif email_type == 'text':\n...     payload = email_message.get_payload()\n&gt;&gt;&gt; print(payload)\nHi:\n\n  I'm having difficulties getting into my account. What was the URL, again?\n\n  Thanks!\n    A confuser customer"}]}]},{"block_type":"element","block":"k67ev824","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev825","search_text":"After importing the modules that will be used and defining the credentials, we connect to the server in step 3.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the modules that will be used and defining the credentials, we connect to the server in step 3."}]},{"block_type":"element","block":"k67ev826","search_text":"Step 4 connects to the inbox . This is a default folder in Gmail that contains the received email.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 connects to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"inbox"}]},{"block_type":"text","content":". This is a default folder in Gmail that contains the received email."}]},{"block_type":"element","block":"k67ev827","search_text":"Tip Of course, you may need to read a different folder. You can get a list of all folders by calling mail.list() . ","text_count":115,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Of course, you may need to read a different folder. You can get a list of all folders by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"mail.list()"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev828","search_text":"In step 5, first a list of UIDs is retrieved for all the emails in the inbox by calling .uid('search', None, \"ALL\") . The last email received is then retrieved again from the server through a fetch action with .uid('fetch', latest_email_uid, '(RFC822)') . This retrieves the email in RFC822 format, which is the standard. Note that retrieving the email marks it as read.","text_count":370,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 5, first a list of UIDs is retrieved for all the emails in the inbox by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".uid('search', None, \"ALL\")"}]},{"block_type":"text","content":". The last email received is then retrieved again from the server through a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fetch"}]},{"block_type":"text","content":"action with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".uid('fetch', latest_email_uid, '(RFC822)')"}]},{"block_type":"text","content":". This retrieves the email in RFC822 format, which is the standard. Note that retrieving the email marks it as read."}]},{"block_type":"element","block":"k67ev829","search_text":"Note The .uid command allows us to call IMAP4 commands, returning a tuple with the result ( OK or NO ) and the data. If there's an error, it will raise the proper exception. ","text_count":174,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".uid"}]},{"block_type":"text","content":"command allows us to call IMAP4 commands, returning a tuple with the result ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"OK"}]},{"block_type":"text","content":"&nbsp;or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"NO"}]},{"block_type":"text","content":") and the data. If there's an error, it will raise the proper exception."}]}]},{"block_type":"element","block":"k67ev82a","search_text":"The BytesParser module is used to transform from the raw RFC822 email into a Python object. This is done in Step 6.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BytesParser"}]},{"block_type":"text","content":"&nbsp;module&nbsp;is used to transform from the raw"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"RFC822"}]},{"block_type":"text","content":"email into a Python object. This is done in Step 6."}]},{"block_type":"element","block":"k67ev82b","search_text":"The metadata, including details such as the subject, the sender, and the timestamp, can be accessed like a dictionary, as shown in step 7. The addresses can be parsed from raw text format to separate the part with email.utils.parseaddr .","text_count":237,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The metadata, including details such as the subject, the sender, and the timestamp, can be accessed like a dictionary, as shown in step 7. The addresses can be parsed from raw text format to separate the part with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"email.utils.parseaddr"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev82c","search_text":"Finally, the content can be unfolded and extracted. If the type of the email is multipart, each of the parts can be extracted by iterating through .get_payload() . The one that's easier to deal with is plain/text , so assuming it is present, the code in step 8 will extract it.","text_count":277,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the content can be unfolded and extracted. If the type of the email is multipart, each of the parts can be extracted by iterating through&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".get_payload()"}]},{"block_type":"text","content":". The one that's easier to deal with is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"plain/text"}]},{"block_type":"text","content":", so assuming it is present, the code in step 8 will extract it."}]},{"block_type":"element","block":"k67ev82d","search_text":"The email body is stored in the payload variable.","text_count":49,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The email body is stored in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"payload"}]},{"block_type":"text","content":"variable."}]},{"block_type":"element","block":"k67ev82e","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev82f","search_text":"In step 5, we are retrieving all the emails in the inbox, but that's not necessary. The search can be filtered, for example by retrieving only the last day's emails:","text_count":165,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 5, we are retrieving all the emails in the inbox, but that's not necessary. The search can be filtered, for example by retrieving only the last day's emails:"}]},{"block_type":"element","block":"k67ev82g","search_text":"import datetime since = (datetime.date.today() - datetime.timedelta(days=1)).strftime(\"%d-%b-%Y\") result, data = mail.uid('search', None, f'(SENTSINCE {since})')","text_count":161,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import datetime\nsince = (datetime.date.today() - datetime.timedelta(days=1)).strftime(\"%d-%b-%Y\")\nresult, data = mail.uid('search', None, f'(SENTSINCE {since})')"}]}]},{"block_type":"element","block":"k67ev82h","search_text":"This will search according to the date of the email. Notice the resolution is in days.","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This will search according to the date&nbsp;of the email. Notice the resolution is in days."}]},{"block_type":"element","block":"k67ev82i","search_text":"There are more actions that can be done through IMAP4 . Check RFC 3501 https://tools.ietf.org/html/rfc3501 and RFC 6851 https://tools.ietf.org/html/rfc6851 for further details.","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are more actions that can be done through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"IMAP4"}]},{"block_type":"text","content":". Check RFC 3501&nbsp;&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://tools.ietf.org/html/rfc3501"},"children":[{"block_type":"text","content":"https://tools.ietf.org/html/rfc3501"}]},{"block_type":"text","content":"&nbsp;and RFC 6851&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://tools.ietf.org/html/rfc6851"},"children":[{"block_type":"text","content":"https://tools.ietf.org/html/rfc6851"}]},{"block_type":"text","content":"&nbsp;for further details."}]},{"block_type":"element","block":"k67ev82j","search_text":"Tip The RFCs describe the IMAP4 protocol and can be a little arid. Checking the possible actions will give you an idea of the possibilities to investigate in detail, probably by Googling for examples. ","text_count":201,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The RFCs describe the IMAP4 protocol and can be a little arid. Checking the possible actions will give you an idea of the possibilities to investigate in detail, probably by Googling for examples.&nbsp;"}]}]},{"block_type":"element","block":"k67ev82k","search_text":"The subject and body of the email, as well as other metadata such as date, to, from, and so on, can be parsed and processed. For example, the subject retrieved in this recipe can be processed in the following way:","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The subject and body of the email, as well as other metadata such as date, to, from, and so on, can be parsed and processed. For example, the subject retrieved in this recipe can be processed in the following way:"}]},{"block_type":"element","block":"k67ev82l","search_text":">>> import re >>> re.search(r'\\[Ref (\\w+)] Subject: (\\w+)', '[Ref ABCDEF] Subject: Product A').groups() ('ABCDEF', 'Product') ","text_count":126,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import re\n&gt;&gt;&gt; re.search(r'\\[Ref (\\w+)] Subject: (\\w+)', '[Ref ABCDEF] Subject: Product A').groups()\n('ABCDEF', 'Product')"}]}]},{"block_type":"element","block":"k67ev82m","search_text":"See Chapter 1, Let Us Begin Our Automation Journey for more info about regular expressions and other ways of parsing information.","text_count":129,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"See Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":"for more info about regular expressions and other ways of parsing information."}]},{"block_type":"element","block":"k67ev82n","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev82o","search_text":"The Introducing regular expressions recipe in Chapter 1, Let Us Begin Our Automation Journey ","text_count":93,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"recipe in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]}]}]},{"block_type":"element","block":"k67ev82p","search_text":"Adding subscribers to an email newsletter","text_count":41,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Adding subscribers to an email newsletter"}]},{"block_type":"element","block":"k67ev82q","search_text":"A common marketing tool is email newsletters. They are convenient ways of sending information to multiple targets. A good newsletter system is difficult to implement, and the recommended way is to use ones available in the market. A well known one is MailChimp ( https://mailchimp.com/ ).","text_count":288,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"A common marketing tool is email newsletters. They are convenient ways of sending information to multiple targets. A good newsletter system is difficult to implement, and the recommended way is to use&nbsp;ones&nbsp;available in the market. A well known one is MailChimp ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://mailchimp.com/"},"children":[{"block_type":"text","content":"https://mailchimp.com/"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev82r","search_text":"MailChimp has a lot of possibilities, but the interesting one in regard to this book is its API, which can be scripted to automate tools. This RESTful API can be accessed through Python. In this recipe, we will see how to add more subscribers to an existing list.","text_count":263,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"MailChimp has a lot of possibilities, but the interesting one in regard to this book is its API, which can be scripted to automate tools. This RESTful API can be accessed through Python. In this recipe, we will see how to add more subscribers to an existing list."}]},{"block_type":"element","block":"k67ev82s","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev82t","search_text":"As we will use MailChimp, we need to have an account available. You can create a free account at https://login.mailchimp.com/signup/ .","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As we will use MailChimp, we need to have an account&nbsp;available. You can create a free account at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://login.mailchimp.com/signup/"},"children":[{"block_type":"text","content":"https://login.mailchimp.com/signup/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev82u","search_text":"After creating the account, be sure to at least have a list that we will add subscribers to. As part of the registration, it is possible that it has been created. It will appear under Lists:","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After creating the account, be sure to at least&nbsp;have&nbsp;a list that we will add subscribers to. As part of the registration, it is possible that it has been created. It will appear under Lists:"}]},{"block_type":"element","block":"k67ev82v","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000039.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev82w","search_text":"The list will contain the subscribed users.","text_count":43,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The list will contain the subscribed users."}]},{"block_type":"element","block":"k67ev82x","search_text":"For the API, we'll need an API key. Go to Account | Extras | API keys and create a new one:","text_count":91,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For the API, we'll need an API key. Go to Account | Extras | API keys and create a new one:"}]},{"block_type":"element","block":"k67ev82y","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000063.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev82z","search_text":"We will use the requests module for accessing the API. Add it to your virtual environment:","text_count":90,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the&nbsp;requests&nbsp;module for accessing the API. Add it to your virtual environment:"}]},{"block_type":"element","block":"k67ev830","search_text":"$ echo \"requests==2.18.3\" >> requirements.txt $ pip install -r requirements.txt","text_count":79,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"requests==2.18.3\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev831","search_text":"The MailChimp API uses the concept of the DC ( data center ) that your account uses. This can be obtained from the last digits of your API, or from the start of the URL from the MailChimp admin site. For example, in all the previous screenshots, it is us19 .","text_count":258,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The MailChimp API uses the concept of the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"DC"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"data center"}]},{"block_type":"text","content":") that your account uses. This can be obtained from the last digits of your API,&nbsp;or from the start of the URL from the MailChimp admin site. For example, in all the previous screenshots, it is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"us19"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev832","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev833","search_text":"Import the requests module: ","text_count":28,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev834","search_text":">>> import requests","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests"}]}]},{"block_type":"element","block":"k67ev835","search_text":"Define the authentication and base URLs. The base URL requires your dc at the start (such as us19 ): ","text_count":101,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Define the authentication and base URLs. The base URL requires your"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dc"}]},{"block_type":"text","content":"at the start (such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"us19"}]},{"block_type":"text","content":"):"}]}]},{"block_type":"element","block":"k67ev836","search_text":">>> API = 'your secret key' >>> BASE = 'https://<dc>.api.mailchimp.com/3.0' >>> auth = ('user', API)","text_count":100,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; API = 'your secret key'\n&gt;&gt;&gt; BASE = 'https://&lt;dc&gt;.api.mailchimp.com/3.0'\n&gt;&gt;&gt; auth = ('user', API)"}]}]},{"block_type":"element","block":"k67ev837","search_text":"Obtain all your lists: ","text_count":23,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Obtain all your lists:"}]}]},{"block_type":"element","block":"k67ev838","search_text":">>> url = f'{BASE}/lists' >>> response = requests.get(url, auth=auth) >>> result = response.json()","text_count":98,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; url = f'{BASE}/lists'\n&gt;&gt;&gt; response = requests.get(url, auth=auth)\n&gt;&gt;&gt; result = response.json()"}]}]},{"block_type":"element","block":"k67ev839","search_text":"Filter your lists to obtain the href for the required list: ","text_count":60,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Filter your lists to obtain the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"href"}]},{"block_type":"text","content":"for the required list:"}]}]},{"block_type":"element","block":"k67ev83a","search_text":">>> LIST_NAME = 'Your list name' >>> this_list = [l for l in result['lists'] if l['name'] == LIST_NAME][0] >>> list_url = [l['href'] for l in this_list['_links'] if l['rel'] == 'self'][0]","text_count":187,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; LIST_NAME = 'Your list name'\n&gt;&gt;&gt; this_list = [l for l in result['lists'] if l['name'] == LIST_NAME][0]\n&gt;&gt;&gt; list_url = [l['href'] for l in this_list['_links'] if l['rel'] == 'self'][0]"}]}]},{"block_type":"element","block":"k67ev83b","search_text":"With the list URL, you can obtain the URL for the members of the list: ","text_count":71,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"With the list URL, you can obtain the URL for the members of the list:"}]}]},{"block_type":"element","block":"k67ev83c","search_text":">>> response = requests.get(list_url, auth=auth) >>> result = response.json() >>> result['stats'] {'member_count': 1, 'unsubscribe_count': 0, 'cleaned_count': 0, ...} >>> members_url = [l['href'] for l in result['_links'] if l['rel'] == 'members'][0]","text_count":250,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response = requests.get(list_url, auth=auth)\n&gt;&gt;&gt; result = response.json()\n&gt;&gt;&gt; result['stats']\n{'member_count': 1, 'unsubscribe_count': 0, 'cleaned_count': 0, ...}\n&gt;&gt;&gt; members_url = [l['href'] for l in result['_links'] if l['rel'] == 'members'][0]"}]}]},{"block_type":"element","block":"k67ev83d","search_text":"The list of members can be retrieved through a GET request to members_url : ","text_count":76,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The list of members can be retrieved through a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"request to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"members_url"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev83e","search_text":">>> response = requests.get(members_url, json=new_member, auth=auth) >>> result = response.json() >>> len(result['members']) 1","text_count":126,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response = requests.get(members_url, json=new_member, auth=auth)\n&gt;&gt;&gt; result = response.json()\n&gt;&gt;&gt; len(result['members'])\n1"}]}]},{"block_type":"element","block":"k67ev83f","search_text":"Append a new member to the list: ","text_count":33,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Append a new member to the list:"}]}]},{"block_type":"element","block":"k67ev83g","search_text":">>> new_member = { 'email_address': 'test@test.com', 'status': 'subscribed', } >>> response = requests.post(members_url, json=new_member, auth=auth)","text_count":148,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; new_member = {\n    'email_address': 'test@test.com',\n    'status': 'subscribed',\n}\n&gt;&gt;&gt; response = requests.post(members_url, json=new_member, auth=auth)"}]}]},{"block_type":"element","block":"k67ev83h","search_text":"Retrieving the list of users with a GET obtains both users: ","text_count":60,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieving the list of users with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"obtains both users:"}]}]},{"block_type":"element","block":"k67ev83i","search_text":">>> response = requests.post(members_url, json=new_member, auth=auth) >>> result = response.json() >>> len(result['members']) 2","text_count":127,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response = requests.post(members_url, json=new_member, auth=auth)\n&gt;&gt;&gt; result = response.json()\n&gt;&gt;&gt; len(result['members'])\n2"}]}]},{"block_type":"element","block":"k67ev83j","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev83k","search_text":"After importing the requests module in step 1, we define the basic values to connect in step 2, the base URL, and the credentials. Note that for the authentication, we only require the API key as the password, and any user (as described by the MailChimp documentation: https://developer.mailchimp.com/documentation/mailchimp/guides/get-started-with-mailchimp-api-3/ ).","text_count":368,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After importing the requests module in step 1, we define the basic values to connect in step 2, the base URL, and the credentials. Note that for the authentication, we only require the API key as the password, and any user (as described by the MailChimp documentation:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://developer.mailchimp.com/documentation/mailchimp/guides/get-started-with-mailchimp-api-3/"},"children":[{"block_type":"text","content":"https://developer.mailchimp.com/documentation/mailchimp/guides/get-started-with-mailchimp-api-3/"}]},{"block_type":"text","content":")."}]},{"block_type":"element","block":"k67ev83l","search_text":"Step 3 retrieves all the lists, calling the proper URL. The result is returned in JSON format. The call includes the auth parameter with the defined credentials. All subsequent calls will be made with that auth parameter for authentication purposes.","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 retrieves all the lists, calling the proper URL. The result is returned in JSON format. The call includes the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"auth"}]},{"block_type":"text","content":"parameter with the defined credentials. All subsequent calls will be made with that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"auth"}]},{"block_type":"text","content":"parameter for authentication purposes."}]},{"block_type":"element","block":"k67ev83m","search_text":"Step 4 shows how to filter the returned list to grab the URL of the particular list of interest. Each of the returned calls includes a list of _links with related information, making it possible to walk through the API.","text_count":219,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 4 shows how to filter the returned list to grab the URL of the particular list of interest. Each of the returned calls includes a list of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"_links"}]},{"block_type":"text","content":"with related information, making it possible to walk through the API."}]},{"block_type":"element","block":"k67ev83n","search_text":"The URL for the list is called in step 5. This returns information for the list, including the basic stats. Applying a similar filtering to step 4, we retrieve the URL for the members.","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The URL for the list is called in step 5. This returns information for the list, including the basic stats. Applying a similar filtering to step 4, we retrieve the URL for the members."}]},{"block_type":"element","block":"k67ev83o","search_text":"Tip Due to size constraints and to show relevant data, not all of the retrieved elements are displayed. Feel free to analyze them interactively and find out about them. The data is well constructed, following the RESTful principles of discoverability; plus the Python ability of introspection makes it quite readable and understandable. ","text_count":337,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Due to size&nbsp;constraints and to show relevant data, not all of the retrieved elements are displayed. Feel free to analyze them interactively and find out about them. The data is well constructed, following the RESTful principles of discoverability; plus the Python ability of introspection makes it quite readable and understandable."}]}]},{"block_type":"element","block":"k67ev83p","search_text":"Step 6 retrieves the list of members, making a GET request to members_url , which can be seen as a single user. This can be seen in the Getting Ready section, in the web interface. ","text_count":181,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 6 retrieves the list of members, making a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"&nbsp;request to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"members_url"}]},{"block_type":"text","content":", which can be seen as a single user. This can be seen in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting Ready"}]},{"block_type":"text","content":"&nbsp;section, in the web interface.&nbsp;"}]},{"block_type":"element","block":"k67ev83q","search_text":"Step 7 creates a new user and posts on the members_url with the information passed in the json parameter, so it gets translated into JSON format. The updated data is retrieved in step 7, showing that there's a new user in the list.","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 7 creates a new user and posts on the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"members_url"}]},{"block_type":"text","content":"&nbsp;with the information passed in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"json"}]},{"block_type":"text","content":"parameter, so it gets translated into JSON format. The updated data is retrieved in step 7, showing that there's a new user in the list."}]},{"block_type":"element","block":"k67ev83r","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev83s","search_text":"The full MailChimp API is quite powerful and can perform a large number of tasks. Go to the full MailChimp documentation to discover all the possibilities: https://developer.mailchimp.com/ .","text_count":190,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full MailChimp API is quite powerful and can perform a large number of tasks. Go to the full MailChimp documentation to discover all the possibilities:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://developer.mailchimp.com/"},"children":[{"block_type":"text","content":"https://developer.mailchimp.com/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev83t","search_text":"Tip As a brief note, and a little out of scope of this book, please be aware of the legal implications of adding subscribers to an automated list. Spam is a serious worry and there are new regulations in place to protect the rights of customers, such as GPDR. Ensure that you have the permission of users to email them. The good thing is that MailChimp automatically implements tools to help with this, such as automatic unsubscribe buttons. ","text_count":442,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As a brief note, and a little out of scope of this book, please be aware of the legal implications of adding subscribers to an automated list. Spam is a serious worry and there are new regulations in place to protect the rights of customers, such as GPDR. Ensure that you have the permission of users to email them. The good thing is that MailChimp automatically&nbsp;implements tools to help with this, such as automatic unsubscribe buttons."}]}]},{"block_type":"element","block":"k67ev83u","search_text":"The general MailChimp documentation is also quite interesting and shows a lot of possibilities. MailChimp is capable of managing newsletter and general distribution lists, but it can also be tailored to generate flows, schedule the sending of emails, and automatically send messages to your audience based on parameters such as their birthday.","text_count":343,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The general MailChimp documentation is also quite interesting and shows a lot of possibilities. MailChimp is capable of managing newsletter and general distribution lists, but it can also be tailored to generate flows, schedule the sending of emails, and automatically send messages to your audience based on parameters such as their birthday."}]},{"block_type":"element","block":"k67ev83v","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev83w","search_text":"The Sending an individual email recipe The Sending transactional emails recipe ","text_count":79,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending an individual email"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending transactional emails"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev83x","search_text":"Sending notifications via email","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Sending notifications via email"}]},{"block_type":"element","block":"k67ev83y","search_text":"In this recipe, we will cover how to send emails that will be send towards customers. An email that is sent in response to an action by a user, for example, a confirmation email or an alert email, is called a transactional email . Due to spam protection and other limitations, it is better to implement this kind of email with the help of external tools. ","text_count":355,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will cover how to send emails that will be send towards customers. An email that is sent in response to an action by a user, for example, a confirmation email or an alert email, is called"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"a"}]},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"transactional email"}]},{"block_type":"text","content":". Due to spam protection and other limitations, it is better to implement this kind of email with the help of external tools.&nbsp;"}]},{"block_type":"element","block":"k67ev83z","search_text":"In this recipe, we will use Mailgun ( https://www.mailgun.com ), which is able to send this kind of email, as well as communicate responses.","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will use Mailgun ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.mailgun.com"},"children":[{"block_type":"text","content":"https://www.mailgun.com"}]},{"block_type":"text","content":"), which is able to send this kind of email, as well as communicate responses."}]},{"block_type":"element","block":"k67ev840","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev841","search_text":"We'll need to create an account in Mailgun. Go to https://signup.mailgun.com to create one. Notice that the credit card information is optional.","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll need to create an account in Mailgun. Go to"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://signup.mailgun.com/new/signup"},"children":[{"block_type":"text","content":"https://signup.mailgun.com"}]},{"block_type":"text","content":"to create one. Notice that the credit card information is optional."}]},{"block_type":"element","block":"k67ev842","search_text":"Once registered, go to Domains to see there's a sandbox environment. We can use it to test the functionality, although it will only send emails to registered test email accounts. The API credentials will be displayed there:","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once registered, go to Domains to see there's a sandbox environment. We can use it to test the functionality, although it will only send emails to registered test email accounts. The API credentials will be displayed there:"}]},{"block_type":"element","block":"k67ev843","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000053.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev844","search_text":"We need to register the account so we'll receive the email as an authorized recipient . You can add it here:","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to register the account so we'll receive the email as an"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"authorized recipient"}]},{"block_type":"text","content":". You can add it here:"}]},{"block_type":"element","block":"k67ev845","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000014.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev846","search_text":"To verify the account, check the email of the authorized recipient and confirm it. The email address is now ready to receive test emails:","text_count":137,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To verify the account, check the email of the authorized recipient and confirm it. The email address is now ready to receive test emails:"}]},{"block_type":"element","block":"k67ev847","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000043.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev848","search_text":"We will use the requests module for making the connection to the Mailgun API. Install it in the virtual environment:","text_count":116,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use the requests&nbsp;module&nbsp;for making the connection to the Mailgun API. Install it in the virtual environment:"}]},{"block_type":"element","block":"k67ev849","search_text":"$ echo \"requests==2.18.3\" >> requirements.txt $ pip install -r requirements.txt","text_count":79,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"requests==2.18.3\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev84a","search_text":"Everything is ready to send emails, but notice only to authorized recipients. Being able to send emails everywhere requires us to set up a domain. Follow the Mailgun documentation: https://documentation.mailgun.com/en/latest/quickstart-sending.html#verify-your-domain .","text_count":269,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Everything is ready to send emails, but notice only to authorized recipients. Being able to send emails everywhere requires us to set up a domain.&nbsp;Follow the Mailgun documentation:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://documentation.mailgun.com/en/latest/quickstart-sending.html#verify-your-domain"},"children":[{"block_type":"text","content":"https://documentation.mailgun.com/en/latest/quickstart-sending.html#verify-your-domain"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev84b","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev84c","search_text":"Import the requests module: ","text_count":28,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"&nbsp;module:"}]}]},{"block_type":"element","block":"k67ev84d","search_text":">>> import requests","text_count":19,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import requests"}]}]},{"block_type":"element","block":"k67ev84e","search_text":"Prepare the credentials, as well as the to and from emails. Note we're using a mock from: ","text_count":90,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the credentials, as well as the to and from emails. Note we're using a mock from:"}]}]},{"block_type":"element","block":"k67ev84f","search_text":">>> KEY = 'YOUR-SECRET-KEY' >>> DOMAIN = 'YOUR-DOMAIN.mailgun.org' >>> TO = 'YOUR-AUTHORISED-RECEIVER'","text_count":102,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; KEY = 'YOUR-SECRET-KEY'\n&gt;&gt;&gt; DOMAIN = 'YOUR-DOMAIN.mailgun.org'\n&gt;&gt;&gt; TO = 'YOUR-AUTHORISED-RECEIVER'"}]}]},{"block_type":"element","block":"k67ev84g","search_text":">>> FROM = f'sender@{DOMAIN}' >>> auth = ('api', KEY)","text_count":53,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; FROM = f'sender@{DOMAIN}'\n&gt;&gt;&gt; auth = ('api', KEY)"}]}]},{"block_type":"element","block":"k67ev84h","search_text":"Prepare the email to be sent. Here, there is the HTML version and an alternative plain-text one: ","text_count":97,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepare the email to be sent. Here, there is the HTML version and an alternative plain-text one:"}]}]},{"block_type":"element","block":"k67ev84i","search_text":">>> text = \"Hi!\\nThis is the text version linking to https://www.packtpub.com/\\nCheers!\" >>> html = '''<html><head></head><body> ... <p>Hi!<br> ... This is the HTML version linking to <a href=\"https://www.packtpub.com/\">Packt</a><br> ... </p> ... </body></html>'''","text_count":264,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; text = \"Hi!\\nThis is the text version linking to https://www.packtpub.com/\\nCheers!\"\n&gt;&gt;&gt; html = '''&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;\n...     &lt;p&gt;Hi!&lt;br&gt;\n...        This is the HTML version linking to &lt;a href=\"https://www.packtpub.com/\"&gt;Packt&lt;/a&gt;&lt;br&gt;\n...     &lt;/p&gt;  \n...   &lt;/body&gt;&lt;/html&gt;'''"}]}]},{"block_type":"element","block":"k67ev84j","search_text":"Set up the data to send to Mailgun: ","text_count":36,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up the data to send to Mailgun:"}]}]},{"block_type":"element","block":"k67ev84k","search_text":">>> data = { ... 'from': f'Sender <{FROM}>', ... 'to': f'Jaime Buelta <{TO}>', ... 'subject': 'An interesting email!', ... 'text': text, ... 'html': html, ... }","text_count":160,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; data = {\n...     'from': f'Sender &lt;{FROM}&gt;',\n...     'to': f'Jaime Buelta &lt;{TO}&gt;',\n...     'subject': 'An interesting email!',\n...     'text': text,\n...     'html': html,\n... }"}]}]},{"block_type":"element","block":"k67ev84l","search_text":"Make the call to the API: ","text_count":26,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Make the call to the API:"}]}]},{"block_type":"element","block":"k67ev84m","search_text":">>> response = requests.post(f\"https://api.mailgun.net/v3/{DOMAIN}/messages\", auth=auth, data=data) >>> response.json() {'id': '<YOUR-ID.mailgun.org>', 'message': 'Queued. Thank you.'}","text_count":184,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response = requests.post(f\"https://api.mailgun.net/v3/{DOMAIN}/messages\", auth=auth, data=data)\n&gt;&gt;&gt; response.json()\n{'id': '&lt;YOUR-ID.mailgun.org&gt;', 'message': 'Queued. Thank you.'}"}]}]},{"block_type":"element","block":"k67ev84n","search_text":"Retrieve the events and check the email has been delivered: ","text_count":60,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Retrieve the events and check the email has been delivered:"}]}]},{"block_type":"element","block":"k67ev84o","search_text":">>> response_events = requests.get(f'https://api.mailgun.net/v3/{DOMAIN}/events', auth=auth) >>> response_events.json()['items'][0]['recipient'] == TO True >>> response_events.json()['items'][0]['event'] 'delivered'","text_count":215,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; response_events = requests.get(f'https://api.mailgun.net/v3/{DOMAIN}/events', auth=auth)\n&gt;&gt;&gt; response_events.json()['items'][0]['recipient'] == TO\nTrue\n&gt;&gt;&gt; response_events.json()['items'][0]['event']\n'delivered'"}]}]},{"block_type":"element","block":"k67ev84p","search_text":"The email should appear in your inbox. As it was sent through the sandbox environment, be sure to check your spam folder if it doesn't show up directly. ","text_count":153,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The email should appear in your inbox. As it was sent through the sandbox environment, be sure to check your spam folder if it doesn't show up directly."}]}]},{"block_type":"element","block":"k67ev84q","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev84r","search_text":"Step 1 imports the requests module to be used later. The credentials and the basic information in the message are defined in step 2, and should be extracted from the Mailgun web interface, as shown before.","text_count":205,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 imports the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"&nbsp;module&nbsp;to be used later. The credentials and the basic information in the message are defined in step 2, and should be extracted from the Mailgun web interface, as shown before."}]},{"block_type":"element","block":"k67ev84s","search_text":"Step 3 defines the email that will be sent. Step 4 structures the information in the way Mailgun expects. Notice the html and text fields. By default, it will set HTML as preferred and the plain-text option as an alternative. The format for the TO and FROM should be in the Name <address> format. You can use commas to separate multiple recipients in TO .","text_count":355,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 defines the email that will be sent. Step 4 structures the information in the way Mailgun expects. Notice the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"html"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"text"}]},{"block_type":"text","content":"fields. By default, it will set HTML as preferred and the plain-text option as an alternative. The format for the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TO"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"FROM"}]},{"block_type":"text","content":"should be in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Name &lt;address&gt;"}]},{"block_type":"text","content":"format. You can use commas to separate multiple recipients in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TO"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev84t","search_text":"The call to the API is made in step 5. It is a POST call to the messages endpoint. The data is transferred in the standard way, and basic authentication is used with the auth parameter. Notice the definition in step 2. All calls to Mailgun should include this parameter. It returns a message notifying you that it was successful and the message is queued.","text_count":355,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The call to the API&nbsp; is made in step 5. It is a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"call to the messages endpoint. The data is transferred in the standard way, and basic authentication is used with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"auth"}]},{"block_type":"text","content":"parameter. Notice the definition in step 2. All calls to Mailgun should include this parameter. It returns a message notifying you that it was successful and the message is queued."}]},{"block_type":"element","block":"k67ev84u","search_text":"In step 6, a call to retrieve the events through a GET request is made. This will show the latest actions performed, the last of which will be the recent send. Information about delivery can also be found.","text_count":205,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 6, a call to retrieve the events through a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"request is made. This will show the latest actions performed, the last of which will be the recent send. Information about delivery can also be found."}]},{"block_type":"element","block":"k67ev84v","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev84w","search_text":"To send emails, you'll need to set up the domain with which to send it, instead of using the sandbox environment. You can find the instructions here: https://documentation.mailgun.com/en/latest/quickstart-sending.html#verify-your-domain . This requires you to change your DNS records to verify that you are their legitimate owner, and increases the deliverability of emails.","text_count":374,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To send emails, you'll need to set up the domain with which to send it, instead of using the sandbox environment. You can find the instructions here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://documentation.mailgun.com/en/latest/quickstart-sending.html#verify-your-domain"},"children":[{"block_type":"text","content":"https://documentation.mailgun.com/en/latest/quickstart-sending.html#verify-your-domain"}]},{"block_type":"text","content":". This requires you to change your DNS records to verify that you are their legitimate owner, and increases the deliverability of emails."}]},{"block_type":"element","block":"k67ev84x","search_text":"The emails can include attachments in the following way:","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The emails can include attachments in the following way:"}]},{"block_type":"element","block":"k67ev84y","search_text":"attachments = [(\"attachment\", (\"attachment1.jpg\", open(\"image.jpg\",\"rb\").read())), (\"attachment\", (\"attachment2.txt\", open(\"text.txt\",\"rb\").read()))] response = requests.post(f\"https://api.mailgun.net/v3/{DOMAIN}/messages\", auth=auth, files=attachments, data=data)","text_count":264,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"attachments = [(\"attachment\", (\"attachment1.jpg\", open(\"image.jpg\",\"rb\").read())),\n               (\"attachment\", (\"attachment2.txt\", open(\"text.txt\",\"rb\").read()))]\nresponse = requests.post(f\"https://api.mailgun.net/v3/{DOMAIN}/messages\",\n                         auth=auth, files=attachments, data=data)"}]}]},{"block_type":"element","block":"k67ev84z","search_text":"The data can include the usual info such as cc or bcc , but you can also delay the delivery for up to three days with the o:deliverytime parameter:","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The data can include the usual info such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cc"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"bcc"}]},{"block_type":"text","content":", but you can also delay the delivery for up to three days with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"o:deliverytime"}]},{"block_type":"text","content":"parameter:"}]},{"block_type":"element","block":"k67ev850","search_text":"import datetime import email.utils delivery_time = datetime.datetime.now() + datetime.timedelta(days=1) data = { ... 'o:deliverytime': email.utils.format_datetime(delivery_time), }","text_count":180,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import datetime\nimport email.utils\ndelivery_time = datetime.datetime.now() + datetime.timedelta(days=1)\ndata = {\n    ...\n    'o:deliverytime': email.utils.format_datetime(delivery_time),\n}"}]}]},{"block_type":"element","block":"k67ev851","search_text":"Mailgun can also be used to receive emails and to trigger processes when they arrive, for example, forwarding them based on rules. Check the Mailgun documentation to find more.","text_count":176,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Mailgun can also be used to receive emails and to trigger processes when they arrive, for example, forwarding them based on rules. Check the Mailgun documentation to find more."}]},{"block_type":"element","block":"k67ev852","search_text":"The full Mailgun documentation can be found here, https://documentation.mailgun.com/en/latest/quickstart.html . Be sure to check their Best Practices section ( https://documentation.mailgun.com/en/latest/best_practices.html#email-best-practices ) to understand the world of sending emails and how to avoid being labeled as spam.","text_count":328,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full Mailgun documentation can be found here,&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://documentation.mailgun.com/en/latest/quickstart.html"},"children":[{"block_type":"text","content":"https://documentation.mailgun.com/en/latest/quickstart.html"}]},{"block_type":"text","content":". Be sure to check their"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Best Practices"}]},{"block_type":"text","content":"section ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://documentation.mailgun.com/en/latest/best_practices.html#email-best-practices"},"children":[{"block_type":"text","content":"https://documentation.mailgun.com/en/latest/best_practices.html#email-best-practices"}]},{"block_type":"text","content":") to understand the world of sending emails and how to avoid being labeled as spam."}]},{"block_type":"element","block":"k67ev853","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev854","search_text":"The Working with email templates recipe The Sending an individual email recipe ","text_count":79,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Working with email templates"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending an individual email"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev855","search_text":"Producing SMS","text_count":13,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"element","block":"k67ev856","search_text":"One of the most widely available communication channels is text messages. Text messages are very convenient to use to distribute information.","text_count":141,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One of the most widely available communication channels is text messages. Text messages are very convenient to use to distribute information."}]},{"block_type":"element","block":"k67ev857","search_text":"Tip SMS messages can be used for marketing purposes, but also as ways of alerting or sending notifications, or, very common recently, as a way of implementing two-factor authentication systems. ","text_count":194,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"SMS messages can be used for marketing purposes, but also as ways of alerting or sending notifications, or, very common recently, as a way of implementing two-factor authentication systems."}]}]},{"block_type":"element","block":"k67ev858","search_text":"We will use Twilio, a service exposing an API to send SMS in an easy way. ","text_count":74,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We will use Twilio, a service exposing an API to send SMS in an easy way.&nbsp;"}]},{"block_type":"element","block":"k67ev859","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev85a","search_text":"We need to create an account for Twilio at https://www.twilio.com/ . Go to the page and register a new account.","text_count":111,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to create an account for Twilio at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/"},"children":[{"block_type":"text","content":"https://www.twilio.com/"}]},{"block_type":"text","content":". Go to the page and register a new account."}]},{"block_type":"element","block":"k67ev85b","search_text":"You'll need to follow the instructions and set up a phone number to receive messages. You'll need to input a code sent to this phone or receive a call to verify this line.","text_count":171,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You'll need to follow the instructions and set up a phone number to receive messages. You'll need to input a code sent to this phone or receive a call to verify this line."}]},{"block_type":"element","block":"k67ev85c","search_text":"Create a new project and check the dashboard. From there, you'll be able to create a first phone number, able to receive and send SMS:","text_count":134,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Create a new project and check the dashboard. From there, you'll be able to create a first phone number, able to receive and send SMS:"}]},{"block_type":"element","block":"k67ev85d","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000042.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev85e","search_text":"Once the number is configured, it will appear in the Active Numbers section in All Products and Services | Phone Numbers .","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once the number is configured, it will appear in the Active Numbers&nbsp;section in All Products and Services | Phone Numbers"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev85f","search_text":"On the main dashboard, check ACCOUNT SID and AUTH TOKEN . They'll be used later. Notice you'll need to display the auth token.","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"On the main dashboard, check"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ACCOUNT SID"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"AUTH TOKEN"}]},{"block_type":"text","content":". They'll be used later. Notice you'll need to display the auth token."}]},{"block_type":"element","block":"k67ev85g","search_text":"We'll also need to install the twilio module. Add it to your virtual environment:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll&nbsp;also&nbsp;need to install the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"twilio"}]},{"block_type":"text","content":"module. Add it to your virtual environment:"}]},{"block_type":"element","block":"k67ev85h","search_text":"$ echo \"twilio==6.16.1\" >> requirements.txt $ pip install -r requirements.txt","text_count":77,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"twilio==6.16.1\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev85i","search_text":"Notice that the receiver phone number can only be a verified number with a trial account. You can verify more than one number; follow the documentation at https://support.twilio.com/hc/en-us/articles/223180048-Adding-a-Verified-Phone-Number-or-Caller-ID-with-Twilio .","text_count":267,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that the receiver phone number can only be a verified number with a trial account. You can verify more than one number; follow the documentation at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://support.twilio.com/hc/en-us/articles/223180048-Adding-a-Verified-Phone-Number-or-Caller-ID-with-Twilio"},"children":[{"block_type":"text","content":"https://support.twilio.com/hc/en-us/articles/223180048-Adding-a-Verified-Phone-Number-or-Caller-ID-with-Twilio"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev85j","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev85k","search_text":"Import the Client from the twilio module: ","text_count":42,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Client"}]},{"block_type":"text","content":"from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"twilio"}]},{"block_type":"text","content":"module:"}]}]},{"block_type":"element","block":"k67ev85l","search_text":">>> from twilio.rest import Client","text_count":34,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from twilio.rest import Client"}]}]},{"block_type":"element","block":"k67ev85m","search_text":"Set up the authentication credentials obtained from the dashboard before. Also, set your Twilio phone number; as an example, here we set +353 12 345 6789 , a fake Irish number. It will be local to your country: ","text_count":211,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Set up the authentication credentials obtained from the dashboard before. Also, set your Twilio phone number; as an example, here&nbsp;we set"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"+353 12 345 6789"}]},{"block_type":"text","content":", a fake Irish number. It will be local to your country:"}]}]},{"block_type":"element","block":"k67ev85n","search_text":">>> ACCOUNT_SID = 'Your account SID' >>> AUTH_TOKEN = 'Your secret token' >>> FROM = '+353 12 345 6789'","text_count":103,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; ACCOUNT_SID = 'Your account SID'\n&gt;&gt;&gt; AUTH_TOKEN = 'Your secret token'\n&gt;&gt;&gt; FROM = '+353 12 345 6789'"}]}]},{"block_type":"element","block":"k67ev85o","search_text":"Start the client to access the API: ","text_count":36,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"client"}]},{"block_type":"text","content":"to access the API:"}]}]},{"block_type":"element","block":"k67ev85p","search_text":">>> client = Client(ACCOUNT_SID, AUTH_TOKEN)","text_count":44,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; client = Client(ACCOUNT_SID, AUTH_TOKEN)"}]}]},{"block_type":"element","block":"k67ev85q","search_text":"Send a message to your authorized phone number. Notice the underscore at the end of from_ : ","text_count":92,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send a message to your authorized phone number. Notice the underscore at the end of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"from_"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev85r","search_text":">>> message = client.messages.create(body='This is a test message from Python!', from_=FROM, to='+your authorised number')","text_count":122,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; message = client.messages.create(body='This is a test message from Python!', \n                                     from_=FROM, \n                                     to='+your authorised number')"}]}]},{"block_type":"element","block":"k67ev85s","search_text":"You'll receive an SMS to your phone: ","text_count":37,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You'll receive an SMS to your phone:"}]}]},{"block_type":"element","block":"k67ev85t","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000033.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev85u","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev85v","search_text":"The use of the Twilio client to send messages is very straightforward.","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The use of the Twilio client to send messages is very straightforward."}]},{"block_type":"element","block":"k67ev85w","search_text":"In step 1, we import the Client , and prepare the credentials and the phone number configured in step 2.","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 1, we import the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Client"}]},{"block_type":"text","content":", and prepare the credentials and the phone number configured in step 2."}]},{"block_type":"element","block":"k67ev85x","search_text":"Step 3 creates the client with the proper authentication, and the message is sent in step 4.","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 creates the client with the proper authentication, and the message is sent in step 4."}]},{"block_type":"element","block":"k67ev85y","search_text":"Note Note that the to number needs to be one of the authenticated numbers while in a trial account, or it will produce an error. You can add more authenticated numbers; check the Twilio documentation. ","text_count":201,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"to"}]},{"block_type":"text","content":"number needs to be one of the authenticated numbers while in a trial account, or it will produce an error. You can add more authenticated numbers; check the Twilio documentation."}]}]},{"block_type":"element","block":"k67ev85z","search_text":"All the messages that are sent from a trial account will include that detail in the SMS, as you can see in step 5.","text_count":114,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the messages that are sent from a trial account will include that detail in the SMS, as you can see in step 5."}]},{"block_type":"element","block":"k67ev860","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev861","search_text":"In certain regions (US and Canada at the time of writing this), SMS numbers have the ability to send MMS messages, including images. To attach images to the message, add the media_url parameter and the URL of the image to send:","text_count":227,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In certain regions (US and Canada at the time of writing this), SMS numbers have the ability to send MMS messages, including images. To attach images to the message, add the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"media_url"}]},{"block_type":"text","content":"parameter and the URL of the image to send:"}]},{"block_type":"element","block":"k67ev862","search_text":"client.messages.create(body='An MMS message', media_url='http://my.image.com/image.png', from_=FROM, to='+your authorised number')","text_count":130,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"client.messages.create(body='An MMS message',\n                       media_url='http://my.image.com/image.png', \n                       from_=FROM, \n                       to='+your authorised number')"}]}]},{"block_type":"element","block":"k67ev863","search_text":"The client is based on a RESTful API, and allows you to perform multiple operations, such as create a new phone number, or obtain an available number first and then purchase it:","text_count":177,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The client is based on a RESTful API, and allows you to perform multiple operations, such as create a new phone number, or obtain an available number first and then purchase it:"}]},{"block_type":"element","block":"k67ev864","search_text":"available_numbers = client.available_phone_numbers(\"IE\").local.list() number = available_numbers[0] new_number = client.incoming_phone_numbers.create(phone_number=number.phone_number)","text_count":183,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"available_numbers = client.available_phone_numbers(\"IE\").local.list()\nnumber = available_numbers[0]\nnew_number = client.incoming_phone_numbers.create(phone_number=number.phone_number)"}]}]},{"block_type":"element","block":"k67ev865","search_text":"Check the documentation for more available actions, but most of the dashboard point-and-click actions can be performed programmatically.","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the documentation for more available actions, but most of the dashboard point-and-click actions can be performed programmatically."}]},{"block_type":"element","block":"k67ev866","search_text":"Note Twilio is also capable of performing other phone services, such as phone calls and text-to-speech. Check it out in the full documentation. ","text_count":144,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Twilio is also capable of performing other phone services, such as phone calls and text-to-speech.&nbsp;Check it out in the full documentation."}]}]},{"block_type":"element","block":"k67ev867","search_text":"The full Twilio documentation is available here: https://www.twilio.com/docs/ .","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full Twilio documentation is available here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/docs/"},"children":[{"block_type":"text","content":"https://www.twilio.com/docs/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev868","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev869","search_text":"The Receiving SMS recipe The Creating a Telegram bot recipe ","text_count":60,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Receiving SMS"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a Telegram bot"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev86a","search_text":"Receiving SMS","text_count":13,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Receiving SMS"}]},{"block_type":"element","block":"k67ev86b","search_text":"SMS can also be received and processed automatically. This enables services such as delivering information on request (for instance, send INFO GOALS to receive the results from the Soccer League), but also more complex flows such as in bots, which can have simple conversations with users that enable rich services such as remotely configuring a thermostat. ","text_count":358,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"SMS can also be received and processed automatically. This enables services such as delivering information on request (for instance, send INFO GOALS to receive the results from the Soccer&nbsp;League), but also more complex flows such as in bots, which can have simple conversations with users that enable rich services such as remotely&nbsp;configuring&nbsp;a thermostat.&nbsp;"}]},{"block_type":"element","block":"k67ev86c","search_text":"Note Each time Twilio receives an SMS to one of your registered phone numbers, it performs a request to a publicly available URL. This is configured in the service, meaning it should be under your control. This creates the problem of having a URL under your control available on the internet. This means that just your local computer won't work, as it's not addressable. We will use Heroku ( http://heroku.com ) to deliver an available service, but there are other alternatives. The Twilio documentation has examples using grok , which allows for local development by creating a tunnel between a public address and your local development environment. See here for more details: https://www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html . ","text_count":759,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Each time Twilio receives an SMS to one of your registered phone numbers, it performs a request to a publicly available URL. This is configured in the service, meaning it should be under your control. This creates the problem of having a URL under your control available on the internet. This means that just your local computer won't work, as it's not addressable. We will use Heroku ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://heroku.com"},"children":[{"block_type":"text","content":"http://heroku.com"}]},{"block_type":"text","content":") to deliver an available service, but there are other alternatives. The Twilio documentation has examples using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"grok"}]},{"block_type":"text","content":", which allows for local development by creating a tunnel between a public address and your local development environment. See here for more details:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html"},"children":[{"block_type":"text","content":"https://www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev86d","search_text":"This way of operating is common in communication APIs. It should be noted that Twilio has a beta API for WhatsApp, which works in a similar way. Check the docs for more information at https://www.twilio.com/docs/sms/whatsapp/quickstart/python .","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This way of operating is common in communication APIs. It should be noted that Twilio has a beta API for WhatsApp, which works in a similar way. Check the docs for more information at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/docs/sms/whatsapp/quickstart/python"},"children":[{"block_type":"text","content":"https://www.twilio.com/docs/sms/whatsapp/quickstart/python"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev86e","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev86f","search_text":"We need to create an account for Twilio at https://www.twilio.com/ . Refer to the Getting ready section in the Producing SMS recipe for detailed instructions.","text_count":158,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to create an account for Twilio at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/"},"children":[{"block_type":"text","content":"https://www.twilio.com/"}]},{"block_type":"text","content":".&nbsp;Refer to the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"text","content":"section in the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"text","content":"&nbsp;recipe&nbsp;for detailed instructions."}]},{"block_type":"element","block":"k67ev86g","search_text":"For this recipe, we will also need to set up a web service in Heroku ( https://www.heroku.com/ ) to be able to create a webhook capable of receiving SMS addressed to Twilio. Because the main objective of this recipe is the SMS part, we will be concise when setting up Heroku, but you can refer to its excellent documentation. It is quite easy to use:","text_count":350,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will also need to set up a web service in Heroku ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.heroku.com/"},"children":[{"block_type":"text","content":"https://www.heroku.com/"}]},{"block_type":"text","content":") to be able to create a webhook capable of receiving SMS addressed to Twilio. Because the main objective of this recipe is the SMS part, we will be concise when setting up Heroku, but you can refer to its excellent documentation. It is quite easy to use:"}]},{"block_type":"element","block":"k67ev86h","search_text":"Create an account in Heroku. ","text_count":29,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create an account in Heroku."}]}]},{"block_type":"element","block":"k67ev86i","search_text":"You'll need to install the command line interface for Heroku (instructions for all platforms are at https://devcenter.heroku.com/articles/getting-started-with-python#set-up ) and then log in to the command line: ","text_count":212,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You'll need to install the command line interface for Heroku (instructions for all platforms are at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://devcenter.heroku.com/articles/getting-started-with-python#set-up"},"children":[{"block_type":"text","content":"https://devcenter.heroku.com/articles/getting-started-with-python#set-up"}]},{"block_type":"text","content":") and then log in to the command line:"}]}]},{"block_type":"element","block":"k67ev86j","search_text":"$ heroku login Enter your Heroku credentials. Email: your.user@server.com Password:","text_count":83,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ heroku login\nEnter your Heroku credentials.\nEmail: your.user@server.com\nPassword:"}]}]},{"block_type":"element","block":"k67ev86k","search_text":"Download a basic Heroku template from https://github.com/datademofun/heroku-basic-flask . We will use it as a base for our server. Add the twilio client to the requirements.txt file: ","text_count":183,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Download a basic Heroku template from"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/datademofun/heroku-basic-flask"},"children":[{"block_type":"text","content":"&nbsp;https://github.com/datademofun/heroku-basic-flask"}]},{"block_type":"text","content":". We will use it as a base for our server."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"twilio"}]},{"block_type":"text","content":"client to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requirements.txt"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev86l","search_text":"$ echo \"twilio\" >> requirements.txt","text_count":35,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"twilio\" &gt;&gt; requirements.txt"}]}]},{"block_type":"element","block":"k67ev86m","search_text":"Replace app.py with the one in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/app.py . ","text_count":134,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Replace&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"app.py"}]},{"block_type":"text","content":"with the one in GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/app.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/app.py"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev86n","search_text":"Tip You can keep the existing app.py to check the template example and how Heroku works. Check out the README at https://github.com/datademofun/heroku-basic-flask . ","text_count":165,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can keep the existing"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"app.py"}]},{"block_type":"text","content":"to check the template example and how Heroku works. Check out the README at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/datademofun/heroku-basic-flask"},"children":[{"block_type":"text","content":"https://github.com/datademofun/heroku-basic-flask"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev86o","search_text":"Once done, commit the changes to Git: ","text_count":38,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Once done, commit the changes to Git:"}]}]},{"block_type":"element","block":"k67ev86p","search_text":"$ git add . $ git commit -m 'first commit'","text_count":42,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ git add .\n$ git commit -m 'first commit'"}]}]},{"block_type":"element","block":"k67ev86q","search_text":"Create a new service in Heroku. It will generate a new service name randomly (we use service-name-12345 here). This URL is accessible: ","text_count":135,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new service in Heroku. It will generate a new service name randomly (we use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"service-name-12345"}]},{"block_type":"text","content":"here). This URL is accessible:"}]}]},{"block_type":"element","block":"k67ev86r","search_text":"$ heroku create Creating app... done, ⬢ SERVICE-NAME-12345 https://service-name-12345.herokuapp.com/ | https://git.heroku.com/service-name-12345.git","text_count":148,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ heroku create\nCreating app... done, ⬢ SERVICE-NAME-12345\nhttps://service-name-12345.herokuapp.com/ | https://git.heroku.com/service-name-12345.git"}]}]},{"block_type":"element","block":"k67ev86s","search_text":"Deploy the service. In Heroku, deploying a service pushes the code to the remote Git server: ","text_count":93,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Deploy the service. In Heroku, deploying a service pushes the code to the remote Git server:"}]}]},{"block_type":"element","block":"k67ev86t","search_text":"$ git push heroku master ... remote: Verifying deploy... done. To https://git.heroku.com/service-name-12345.git b6cd95a..367a994 master -> master","text_count":145,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ git push heroku master\n...\nremote: Verifying deploy... done.\nTo https://git.heroku.com/service-name-12345.git\n b6cd95a..367a994 master -&gt; master"}]}]},{"block_type":"element","block":"k67ev86u","search_text":"Check that the service is up and running at the webhook URL. Note it is displayed as output in the previous step. You can also check it in a browser: ","text_count":150,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check that the service is up and running at the webhook URL. Note it is displayed as output in the previous step. You can also check it in a browser:"}]}]},{"block_type":"element","block":"k67ev86v","search_text":"$ curl https://service-name-12345.herokuapp.com/ All working!","text_count":61,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ curl https://service-name-12345.herokuapp.com/\nAll working!"}]}]},{"block_type":"element","block":"k67ev86w","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev86x","search_text":"Go to Twilio and access the PHONE NUMBER section. Configure the webhook URL. This will make the URL be called on each received SMS. Go to the Active Numbers section in All Products and Services | Phone Numbers and fill in the webhook. Note the /sms at the end of the webhook. Click on Save: ","text_count":291,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Go to Twilio and access the&nbsp;PHONE NUMBER&nbsp;section.&nbsp;Configure the webhook URL. This will make the URL be called on each received SMS. Go to the&nbsp;Active&nbsp;Numbers&nbsp;section in&nbsp;All Products and Services&nbsp;|&nbsp;Phone Numbers and fill in the webhook. Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/sms"}]},{"block_type":"text","content":"at the end of the webhook. Click on Save:"}]}]},{"block_type":"element","block":"k67ev86y","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000074.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev86z","search_text":"The service is now up and can be used. Send an SMS to your Twilio phone number and you should get back an automated response: ","text_count":126,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The service is now up and can be used. Send an SMS to your Twilio phone number and you should get back an automated response:"}]}]},{"block_type":"element","block":"k67ev870","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000026.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev871","search_text":"Note the blurred parts should be replaced with your info.","text_count":57,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the blurred parts should be replaced with your info."}]},{"block_type":"element","block":"k67ev872","search_text":"Tip If you have a trial account, you can only send messages back to one of your authorized phone numbers, so you'll need to send the text from them. ","text_count":149,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you have a trial account, you can only send messages back to one of your authorized phone numbers, so you'll need to send the text from them."}]}]},{"block_type":"element","block":"k67ev873","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev874","search_text":"Step 1 sets up the webhook, so Twilio calls your Heroku app when receiving an SMS on the phone line.","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 sets up the webhook, so Twilio calls your Heroku app when receiving an SMS on the phone line."}]},{"block_type":"element","block":"k67ev875","search_text":"Let's take a look at the code in app.py to see how this works. Here it is redacted for clarity; check the full file at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/app.py :","text_count":211,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's take a look at the code in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"app.py"}]},{"block_type":"text","content":"to see how this works. Here it is redacted for clarity; check the full file at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/app.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/app.py"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev876","search_text":"... @app.route('/') def homepage(): return 'All working!' @app.route(\"/sms\", methods=['GET', 'POST']) def sms_reply(): from_number = request.form['From'] body = request.form['Body'] resp = MessagingResponse() msg = (f'Awwwww! Thanks so much for your message {from_number}, ' f'\"{body}\" to you too.') resp.message(msg) return str(resp) ...","text_count":338,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"...\n@app.route('/')\ndef homepage():\n    return 'All working!'\n\n@app.route(\"/sms\", methods=['GET', 'POST'])\ndef sms_reply():\n    from_number = request.form['From']\n    body = request.form['Body']\n    resp = MessagingResponse()\n    msg = (f'Awwwww! Thanks so much for your message {from_number}, '\n           f'\"{body}\" to you too.')\n\n    resp.message(msg)\n    return str(resp)\n..."}]}]},{"block_type":"element","block":"k67ev877","search_text":"app.py can be divided into three parts—the Python imports at start of the file and startup of the Flask app at the end, which is just setting up Flask (not shown here); the call to homepage , which is generated to test that the server is working; and sms_reply , which is where the magic happens.","text_count":296,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"app.py"}]},{"block_type":"text","content":"can be divided into three parts&mdash;the Python imports at start of the file and startup of the Flask app at the end, which is just setting up Flask (not shown here); the call to&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"homepage"}]},{"block_type":"text","content":", which is generated to test that the server is working; and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sms_reply"}]},{"block_type":"text","content":", which is where the magic happens."}]},{"block_type":"element","block":"k67ev878","search_text":"The sms_reply function obtains the phone number that sends the SMS, as well as the body of the message, from the request.form dictionary. Then, compose a response in msg , attach it to a new MessagingResponse , and return it.","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sms_reply"}]},{"block_type":"text","content":"&nbsp;function&nbsp;obtains the phone number that sends the SMS, as well as the body of the message, from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"request.form"}]},{"block_type":"text","content":"dictionary. Then, compose a response in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"msg"}]},{"block_type":"text","content":", attach it to a new&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MessagingResponse"}]},{"block_type":"text","content":", and return it."}]},{"block_type":"element","block":"k67ev879","search_text":"Tip We are using the message from the user as a whole, but remember all the techniques to parse text mentioned in Chapter 1, Let Us Begin Our Automation Journey . They are all applicable here to detecting predefined actions or any other text processing. ","text_count":254,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We are using the message from the user as a whole, but remember all the techniques to parse text mentioned in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":". They are all applicable here to detecting predefined actions or any other text processing."}]}]},{"block_type":"element","block":"k67ev87a","search_text":"The returned value will be sent back by Twilio to the sender, producing the result seen in step 2.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The returned value will be sent back by Twilio to the sender, producing the result seen in step 2."}]},{"block_type":"element","block":"k67ev87b","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev87c","search_text":"To be able to generate automated conversations, the state of the conversation should be stored. For advanced state, it should probably be stored in a database, generating a flow, but for simple cases, storing information in session may be enough. The session is able to store information in the cookies that is persistent between the same combination of to and from phone numbers, allowing you to retrieve it between messages.","text_count":426,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To be able to generate automated conversations, the state of the conversation should be stored. For advanced state, it should probably be stored in a database, generating a flow, but for simple cases, storing information in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"session"}]},{"block_type":"text","content":"may be enough. The session is able to store information in the cookies that is persistent between the same combination of to and from phone numbers, allowing you to retrieve it between messages."}]},{"block_type":"element","block":"k67ev87d","search_text":"For example, this modification will return not only the send body, but the previous one as well. Only the relevant parts have been included:","text_count":140,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, this modification will return not only the send body, but the previous one as well. Only the relevant parts have been included:"}]},{"block_type":"element","block":"k67ev87e","search_text":"app = Flask(__name__) app.secret_key = b'somethingreallysecret!!!!' ... @app.route(\"/sms\", methods=['GET', 'POST']) def sms_reply(): from_number = request.form['From'] last_message = session.get('MESSAGE', None) body = request.form['Body'] resp = MessagingResponse() msg = (f'Awwwww! Thanks so much for your message {from_number}, ' f'\"{body}\" to you too. ') if last_message: msg += f'Not so long ago you said \"{last_message}\" to me..' session['MESSAGE'] = body resp.message(msg) return str(resp)","text_count":496,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"app = Flask(__name__)\napp.secret_key = b'somethingreallysecret!!!!'\n... \n@app.route(\"/sms\", methods=['GET', 'POST'])\ndef sms_reply():\n    from_number = request.form['From']\n    last_message = session.get('MESSAGE', None)\n    body = request.form['Body']\n    resp = MessagingResponse()\n    msg = (f'Awwwww! Thanks so much for your message {from_number}, '\n           f'\"{body}\" to you too. ')\n    if last_message:\n        msg += f'Not so long ago you said \"{last_message}\" to me..'\n    session['MESSAGE'] = body\n    resp.message(msg)\n    return str(resp)"}]}]},{"block_type":"element","block":"k67ev87f","search_text":"The previous body is stored in the MESSAGE key of the session, which is carried over. Notice the requirement for a secret key to use the session data. Read this for information about it: http://flask.pocoo.org/docs/1.0/quickstart/?highlight=session#sessions .","text_count":259,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The previous"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"body"}]},{"block_type":"text","content":"is stored in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MESSAGE"}]},{"block_type":"text","content":"&nbsp;key of the session, which is carried over. Notice the requirement for a secret key to use the session data. Read this for information about it:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://flask.pocoo.org/docs/1.0/quickstart/?highlight=session#sessions"},"children":[{"block_type":"text","content":"http://flask.pocoo.org/docs/1.0/quickstart/?highlight=session#sessions"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev87g","search_text":"Tip To deploy the new version in Heroku, commit the new app.py to Git, and then do git push heroku master . The new version will be deployed automatically! ","text_count":156,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To deploy the new version in Heroku, commit the new"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"app.py"}]},{"block_type":"text","content":"&nbsp;to Git, and then do"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"git push heroku master"}]},{"block_type":"text","content":". The new version will be deployed automatically!"}]}]},{"block_type":"element","block":"k67ev87h","search_text":"Because the main objective of this recipe is to demonstrate how to reply, Heroku and Flask as not described in detail, but they both have excellent documentation. The full documentation for Heroku can be found at https://devcenter.heroku.com/categories/reference and the documentation for Flask is here: http://flask.pocoo.org/docs/ .","text_count":334,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Because the main objective of this recipe is to demonstrate how to reply, Heroku and Flask as not described in detail, but they both have excellent documentation. The full documentation for Heroku can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://devcenter.heroku.com/categories/reference"},"children":[{"block_type":"text","content":"https://devcenter.heroku.com/categories/reference"}]},{"block_type":"text","content":"&nbsp;and the documentation for Flask is here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://flask.pocoo.org/docs/"},"children":[{"block_type":"text","content":"http://flask.pocoo.org/docs/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev87i","search_text":"Tip Remember, the use of Heroku and Flask is just a convenience for this recipe, as they are great and easy tools to use. There are multiple alternatives to them, as long as you are able to expose a URL so Twilio can call it. Also, check the security measures to ensure that requests to this endpoint come from Twilio: https://www.twilio.com/docs/usage/security#validating-requests . ","text_count":384,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember, the use of Heroku and Flask is just a convenience for this recipe, as they are great and easy tools to use. There are multiple alternatives to them, as long as you are able to expose a URL so Twilio can call it. Also, check the security measures to ensure that requests to this endpoint come from Twilio:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/docs/usage/security#validating-requests"},"children":[{"block_type":"text","content":"https://www.twilio.com/docs/usage/security#validating-requests"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev87j","search_text":"The full documentation for Twilio can be found here: https://www.twilio.com/docs/ .","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full documentation for Twilio can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.twilio.com/docs/"},"children":[{"block_type":"text","content":"https://www.twilio.com/docs/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev87k","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev87l","search_text":"The Producing SMS recipe The Creating a Telegram bot recipe ","text_count":60,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Creating a Telegram bot"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev87m","search_text":"Creating a Telegram bot","text_count":23,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating a Telegram bot"}]},{"block_type":"element","block":"k67ev87n","search_text":"Telegram Messenger is an instant messaging app that has good support for creating bots. Bots are small applications that aim to produce automatic conversations. The big promise of bots is as machines that can create any kind of conversation, totally indistinguishable from a conversation with a human being, and pass the Turing Test, but that objective is quite ambitious and not realistic yet for the most part.","text_count":412,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Telegram Messenger is an instant messaging app that has good support for creating bots. Bots are small applications that aim to produce automatic conversations. The big promise of bots is as machines that can create any kind of conversation, totally indistinguishable from a conversation with a human being, and pass the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Turing Test,"}]},{"block_type":"text","content":"&nbsp;but that objective is quite ambitious and not realistic yet for the most part."}]},{"block_type":"element","block":"k67ev87o","search_text":"Note The Turing Test was proposed by Alan Turing in 1951. Two participants, a human and an Artificial Intelligence (a machine or software program), communicate via text (like in an instant messaging app) with a human judge that decides which one is human and which one is not. If the judge can only guess correctly 50% of the time, it can't be easily differentiated and therefore the AI passes the test. This was one of the first attempts to measure Artificial Intelligence. ","text_count":475,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The Turing Test was proposed by Alan Turing in 1951. Two participants, a human and an Artificial Intelligence (a machine or software program), communicate via text (like in an instant messaging app) with a human judge that decides which one is human and which one is not. If the judge can only guess correctly 50% of the time, it can't be easily differentiated and therefore the AI passes the test. This was one of the first attempts to measure Artificial Intelligence."}]}]},{"block_type":"element","block":"k67ev87p","search_text":"But bots can be very useful with a more limited approach, similar to phone systems where you need to press 2 for checking your account, and press 3 for reporting a missing card. We'll see in this recipe how to generate a simple bot that will display offers and events for a company.","text_count":282,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But bots can be very useful with a more limited approach, similar to phone systems where you need to press"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"2"}]},{"block_type":"text","content":"for checking your account, and press"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"3"}]},{"block_type":"text","content":"for reporting a missing card. We'll see in this recipe how to generate a simple bot that will display offers and events for a company."}]},{"block_type":"element","block":"k67ev87q","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev87r","search_text":"We need to create a new bot for Telegram. This is done through an interface called the BotFather , which is a Telegram special channel that allows us to create a new bot. You can access the channel here: https://telegram.me/botfather . Access it through your Telegram account.","text_count":276,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to create a new bot for Telegram. This is done through an interface called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"the BotFather"}]},{"block_type":"text","content":", which is a Telegram special channel that allows us to create a new bot. You can access the channel here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://telegram.me/botfather"},"children":[{"block_type":"text","content":"https://telegram.me/botfather"}]},{"block_type":"text","content":". Access it through your Telegram account."}]},{"block_type":"element","block":"k67ev87s","search_text":"Run /start to start the interface and then create a new bot with /newbot . The interface will ask you the name of the bot and a username, which should be unique.","text_count":161,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/start"}]},{"block_type":"text","content":"to start the interface and then create a new bot with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"/newbot"}]},{"block_type":"text","content":". The interface will ask you the name of the bot and a username, which should be unique."}]},{"block_type":"element","block":"k67ev87t","search_text":"Once it's set up, it will give you the following:","text_count":49,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once it's set up, it will give you the following:"}]},{"block_type":"element","block":"k67ev87u","search_text":"The Telegram channel of your bot— https:/t.me/<yourusername> . A token to allow access the bot. Copy it as it will be used later. ","text_count":130,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The Telegram channel of your bot&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"https:/t.me/&lt;yourusername&gt;"}]},{"block_type":"text","content":"."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A token to allow access the bot. Copy it as it will be used later."}]}]},{"block_type":"element","block":"k67ev87v","search_text":"Tip You can generate a new token if you lose it. Read The BotFather's documentation. ","text_count":85,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can generate a new token if you lose it. Read The BotFather's documentation."}]}]},{"block_type":"element","block":"k67ev87w","search_text":"We also need to install the Python module telepot , which wraps the RESTful interface from Telegram:","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We also need to install the Python module"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telepot"}]},{"block_type":"text","content":", which wraps the RESTful interface from Telegram:"}]},{"block_type":"element","block":"k67ev87x","search_text":"$ echo \"telepot==12.7\" >> requirements.txt $ pip install -r requirements.txt","text_count":76,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"telepot==12.7\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev87y","search_text":"Download the telegram_bot.py script from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/telegram_bot.py .","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telegram_bot.py"}]},{"block_type":"text","content":"&nbsp;script&nbsp;from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/telegram_bot.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/telegram_bot.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev87z","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev880","search_text":"Setup your generated token into the telegram_bot.py script on the TOKEN constant in line 6: ","text_count":92,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Setup your generated token into the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telegram_bot.py"}]},{"block_type":"text","content":"script on the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"TOKEN"}]},{"block_type":"text","content":"constant in line 6:"}]}]},{"block_type":"element","block":"k67ev881","search_text":"TOKEN = '<YOUR TOKEN>'","text_count":22,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"TOKEN = '&lt;YOUR TOKEN&gt;'"}]}]},{"block_type":"element","block":"k67ev882","search_text":"Start the bot: ","text_count":15,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Start the bot:"}]}]},{"block_type":"element","block":"k67ev883","search_text":"$ python telegram_bot.py","text_count":24,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python telegram_bot.py"}]}]},{"block_type":"element","block":"k67ev884","search_text":"Open the Telegram channel in your phone using the URL and start it. You can use the help , offers , and events commands: ","text_count":121,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"&nbsp;Open the Telegram channel in your phone using the URL and start it. You can use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"help"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"offers"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"events"}]},{"block_type":"text","content":"&nbsp;commands:"}]}]},{"block_type":"element","block":"k67ev885","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000024.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev886","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev887","search_text":"Step 1 sets the token to use for your specific channel. In step 2, we start the bot locally.","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 sets the token to use for your specific channel. In step 2, we start the bot locally."}]},{"block_type":"element","block":"k67ev888","search_text":"Let's see how the code in telegram_bot.py is structured:","text_count":56,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's see how the code in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telegram_bot.py"}]},{"block_type":"text","content":"is structured:"}]},{"block_type":"element","block":"k67ev889","search_text":"IMPORTS TOKEN # Define the information to return per command def get_help(): def get_offers(): def get_events(): COMMANDS = { 'help': get_help, 'offers': get_offers, 'events': get_events, } class MarketingBot(telepot.helper.ChatHandler): ... # Create and start the bot ","text_count":269,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"IMPORTS\n\nTOKEN\n\n# Define the information to return per command\ndef get_help():\ndef get_offers():\ndef get_events():\nCOMMANDS = {\n    'help': get_help,\n    'offers': get_offers,\n    'events': get_events,\n}\n\nclass MarketingBot(telepot.helper.ChatHandler):\n...\n\n\n# Create and start the bot"}]}]},{"block_type":"element","block":"k67ev88a","search_text":"The MarketingBot class creates an interface to handle the communication with Telegram:","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"MarketingBot"}]},{"block_type":"text","content":"class creates an interface to handle the communication with Telegram:"}]},{"block_type":"element","block":"k67ev88b","search_text":"When the channel is started, the open method will be called When a message is received, the on_chat_message method will be called If there's no answer in a while, on_idle will be called ","text_count":186,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When the channel is started, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"open"}]},{"block_type":"text","content":"method will be called"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"When a message is received, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"on_chat_message"}]},{"block_type":"text","content":"method will be called"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"If there's no answer in a while,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"on_idle"}]},{"block_type":"text","content":"will be called"}]}]},{"block_type":"element","block":"k67ev88c","search_text":"In each case, the self.sender.sendMessage method is used to send a message back to the user. Most of the interesting bits happen in on_chat_message :","text_count":149,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In each case, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self.sender.sendMessage"}]},{"block_type":"text","content":"&nbsp;method&nbsp;is used to send a message back to the user. Most of the interesting bits happen in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"on_chat_message"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev88d","search_text":"def on_chat_message(self, msg): # If the data sent is not test, return an error content_type, chat_type, chat_id = telepot.glance(msg) if content_type != 'text': self.sender.sendMessage(\"I don't understand you. \" \"Please type 'help' for options\") return # Make the commands case insensitive command = msg['text'].lower()","text_count":320,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def on_chat_message(self, msg):\n    # If the data sent is not test, return an error\n    content_type, chat_type, chat_id = telepot.glance(msg)\n    if content_type != 'text':\n        self.sender.sendMessage(\"I don't understand you. \"\n                                \"Please type 'help' for options\")\n        return\n\n    # Make the commands case insensitive\n    command = msg['text'].lower()"}]}]},{"block_type":"element","block":"k67ev88e","search_text":"if command not in COMMANDS: self.sender.sendMessage(\"I don't understand you. \" \"Please type 'help' for options\") return message = COMMANDS[command]() self.sender.sendMessage(message)","text_count":182,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"if command not in COMMANDS:\n        self.sender.sendMessage(\"I don't understand you. \"\n                                \"Please type 'help' for options\")\n        return\n\n    message = COMMANDS[command]()\n    self.sender.sendMessage(message)"}]}]},{"block_type":"element","block":"k67ev88f","search_text":"First, it checks whether the received message is text and returns an error message if it's not. It analyzes the received text, and if it's one of the defined commands, it executes the corresponding function to retrieve the text to return.","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"First, it checks whether the received message is text and returns an error message if it's not. It analyzes the received text, and if it's one of the defined commands, it executes the corresponding function to retrieve the text to return."}]},{"block_type":"element","block":"k67ev88g","search_text":"Then, it sends the message back to the user.","text_count":44,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, it sends the message back to the user."}]},{"block_type":"element","block":"k67ev88h","search_text":"Step 3 shows how this works from the point of view of the user who is interacting with the bot.","text_count":95,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 shows how this works from the point of view of the user who is interacting with the bot."}]},{"block_type":"element","block":"k67ev88i","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev88j","search_text":"You can add more info, an avatar picture, and so on to your Telegram channel using the BotFather interface.","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can add more info, an avatar picture, and so on to your Telegram channel using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BotFather"}]},{"block_type":"text","content":"interface."}]},{"block_type":"element","block":"k67ev88k","search_text":"To simplify our interface, we can create a custom keyboard to simplify the bot. Create it after defining the commands, around line 44 of the script:","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To simplify our interface, we can create a custom keyboard to simplify the bot. Create it after defining the commands, around line 44 of the script:"}]},{"block_type":"element","block":"k67ev88l","search_text":"from telepot.namedtuple import ReplyKeyboardMarkup, KeyboardButton keys = [[KeyboardButton(text=text)] for text in COMMANDS] KEYBOARD = ReplyKeyboardMarkup(keyboard=keys)","text_count":170,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"from telepot.namedtuple import ReplyKeyboardMarkup, KeyboardButton\nkeys = [[KeyboardButton(text=text)] for text in COMMANDS]\nKEYBOARD = ReplyKeyboardMarkup(keyboard=keys)"}]}]},{"block_type":"element","block":"k67ev88m","search_text":"Notice it is creating a keyboard with three rows, each with one of the commands. Then, add the resulting KEYBOARD as the reply_markup on each of the sendMessage calls, for example as follows:","text_count":191,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice it is creating a keyboard with three rows, each with one of the commands. Then, add the resulting&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"KEYBOARD"}]},{"block_type":"text","content":"as the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"reply_markup"}]},{"block_type":"text","content":"on each of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sendMessage"}]},{"block_type":"text","content":"calls, for example as follows:"}]},{"block_type":"element","block":"k67ev88n","search_text":"message = COMMANDS[command]() self.sender.sendMessage(message, reply_markup=KEYBOARD)","text_count":85,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"message = COMMANDS[command]()\n self.sender.sendMessage(message, reply_markup=KEYBOARD)"}]}]},{"block_type":"element","block":"k67ev88o","search_text":"This replaces the keyboard with only the defined buttons, making the interface very obvious:","text_count":92,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This replaces the keyboard with only the defined buttons, making&nbsp;the interface&nbsp;very obvious:"}]},{"block_type":"element","block":"k67ev88p","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000018.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev88q","search_text":"These changes can be downloaded in the telegram_bot_custom_keyboard.py file, available in GitHub here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/telegram_bot_custom_keyboard.py .","text_count":220,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These changes can be downloaded in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telegram_bot_custom_keyboard.py"}]},{"block_type":"text","content":"&nbsp;file, available in GitHub here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/telegram_bot_custom_keyboard.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter08/telegram_bot_custom_keyboard.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev88r","search_text":"You can create other kinds of custom interfaces, such as inline buttons or even a platform for creating games. Check the Telegram API docs for more information.","text_count":160,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can create other kinds of custom interfaces, such as inline buttons or even a platform for creating games. Check the Telegram API docs for more information."}]},{"block_type":"element","block":"k67ev88s","search_text":"Interacting with Telegram can also be done through webhooks, in a similar way as presented in the Receiving SMS recipe. Check the example for Flask in the telepot documentation here: https://github.com/nickoala/telepot/tree/master/examples/webhook .","text_count":249,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Interacting with Telegram can&nbsp;also&nbsp;be done through webhooks, in a similar way as presented in the&nbsp;Receiving SMS&nbsp;recipe. Check the example for Flask in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telepot"}]},{"block_type":"text","content":"documentation here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/nickoala/telepot/tree/master/examples/webhook"},"children":[{"block_type":"text","content":"https://github.com/nickoala/telepot/tree/master/examples/webhook"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev88t","search_text":"Tip Setting up a Telegram webhook can be done through telepot . It requires that your service is behind an HTTPS address to ensure the communication is private. This can be tricky to do with simple services. You can check the documentation on setting up a webhook in the Telegram docs: https://core.telegram.org/bots/api#setwebhook . ","text_count":334,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Setting up a Telegram webhook can be done through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telepot"}]},{"block_type":"text","content":". It requires that your service is behind an HTTPS address to ensure the communication is private. This can be tricky to do with simple services. You can check the documentation on setting up a webhook in the Telegram docs:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://core.telegram.org/bots/api#setwebhook"},"children":[{"block_type":"text","content":"https://core.telegram.org/bots/api#setwebhook"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev88u","search_text":"The full Telegram API for bots can be found here: https://core.telegram.org/bots .","text_count":82,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full Telegram API for bots can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://core.telegram.org/bots"},"children":[{"block_type":"text","content":"https://core.telegram.org/bots"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev88v","search_text":"The documentation for the telepot module is found here: https://telepot.readthedocs.io/en/latest/ .","text_count":99,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The documentation for the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"telepot"}]},{"block_type":"text","content":"module is found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://telepot.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://telepot.readthedocs.io/en/latest/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev88w","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev88x","search_text":"The Producing SMS recipe The Receiving SMS recipe ","text_count":50,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Receiving SMS"}]},{"block_type":"text","content":"recipe"}]}]}]},{"title":"Why Not Automate Your Marketing Campaign?","author":"Jaime Buelta","block":"k67euoca","number":9,"contents":[{"block_type":"element","block":"k67ev88y","search_text":"In this chapter, we will cover the following recipes, which are related to a marketing campaign:","text_count":96,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes, which are related to a marketing campaign:"}]},{"block_type":"element","block":"k67ev88z","search_text":"Detecting the opportunities Creating personalized coupon codes Sending a notification to the customer on their preferred channel Preparing sales information Generating a sales report ","text_count":183,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Detecting the opportunities"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creating personalized&nbsp;coupon codes"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Sending a notification to the customer on their preferred&nbsp;channel"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Preparing sales information"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generating a sales report"}]}]},{"block_type":"element","block":"k67ev890","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev891","search_text":"In this chapter, we will create a whole marketing campaign, going through each of the automatic steps we'll take. We will leverage all the concepts and recipes throughout the book in a single project that will require different steps. ","text_count":235,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will create a whole marketing campaign, going through each of the automatic steps we'll take.&nbsp;We will leverage all the concepts and recipes throughout the book in a single project that will require different steps.&nbsp;"}]},{"block_type":"element","block":"k67ev892","search_text":"Let's take an example. For our project, our company wishes to set up up a marketing campaign to improve engagement and sales. A very laudable effort. To do so, we can divide the action into several steps:","text_count":204,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's take an example.&nbsp;For our project, our company&nbsp; wishes to set up up&nbsp;a marketing campaign to improve engagement and sales. A very laudable effort. To do so, we can divide the action into several steps:"}]},{"block_type":"element","block":"k67ev893","search_text":"We want to detect the best moment to launch the campaign, so we will be notified from different sources about keywords that will help us make an informed decision The campaign will include the generation of individual codes to be sent to potential customers ","text_count":258,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We want to detect the best moment to launch the campaign, so we will be notified from different sources about keywords that will help us make an informed decision"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The campaign will include the generation of individual codes to be sent to potential customers"}]}]},{"block_type":"element","block":"k67ev894","search_text":"Parts of these codes will be sent directly to users over their preferred channel, text message or email To monitor the result of the campaign, the sales information will be compiled and a sales report will be generated ","text_count":219,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Parts of these codes will be sent directly to users over their preferred channel, text message or email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To monitor the result of the campaign, the sales information will be compiled and a sales report will be generated"}]}]},{"block_type":"element","block":"k67ev895","search_text":"This chapter will go through each of these steps and present a combined solution based on modules and techniques that have been introduced in the book.","text_count":151,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This chapter will go through each of these steps and present a combined solution based on modules and techniques that have been introduced in the book."}]},{"block_type":"element","block":"k67ev896","search_text":"Tip While these examples have been created with real-life requirements in mind, take into account that your specific environment will always surprise you. Don't be afraid to experiment, tweak, and improve your system as you learn more about it. Iterating is the way to create great systems. ","text_count":291,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While these examples have been created with real-life requirements in mind, take into account that your specific environment will always surprise you. Don't be afraid to experiment, tweak, and improve your system as you learn more about it. Iterating is the way to create great systems."}]}]},{"block_type":"element","block":"k67ev897","search_text":"Let's get to it!","text_count":16,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's get to it!"}]},{"block_type":"element","block":"k67ev898","search_text":"Detecting the opportunities","text_count":27,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Detecting the opportunities"}]},{"block_type":"element","block":"k67ev899","search_text":"In this recipe, we present a marketing campaign that is divided into several steps:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we present a marketing campaign that is divided into several steps:"}]},{"block_type":"element","block":"k67ev89a","search_text":"Detect the best moment to launch the campaign Generate individual codes to be sent to potential customers Send the codes directly to users over their preferred channel, text message or email Collate the results of the campaign and generate a sales report with analysis of the results ","text_count":284,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Detect the best moment to launch the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate individual codes to be sent to potential customers"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send the codes directly to users over their preferred channel, text message or email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Collate the results of the campaign and generate a sales report with analysis of the results"}]}]},{"block_type":"element","block":"k67ev89b","search_text":"This recipe shows step 1 of the campaign.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows step 1 of the campaign."}]},{"block_type":"element","block":"k67ev89c","search_text":"Our first stage is to detect the best time to launch a campaign. To do so, we will monitor a list of news sites, searching for news containing one of our defined keywords. Any article that matches these keywords will be added to a report that will be sent in an email.","text_count":268,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Our first stage is to detect the best time to launch a campaign. To do so, we will monitor a list of news sites, searching for news containing one of our defined keywords. Any article that matches these keywords will be added to a report that will be sent in an email."}]},{"block_type":"element","block":"k67ev89d","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev89e","search_text":"In this recipe, we will use several external modules previously presented in the book, delorean , requests , and BeautifulSoup . We need to add them to our virtual environment if not already there:","text_count":197,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will use several external modules previously presented in the book,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":", and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BeautifulSoup"}]},{"block_type":"text","content":". We need to add them to our virtual environment if not already there:"}]},{"block_type":"element","block":"k67ev89f","search_text":"$ echo \"delorean==1.0.0\" >> requirements.txt $ echo \"requests==2.18.3\" >> requirements.txt $ echo \"beautifulsoup4==4.6.0\" >> requirements.txt $ echo \"feedparser==5.2.1\" >> requirements.txt $ echo \"jinja2==2.10\" >> requirements.txt $ echo \"mistune==0.8.3\" >> requirements.txt $ pip install -r requirements.txt","text_count":308,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"delorean==1.0.0\" &gt;&gt; requirements.txt\n$ echo \"requests==2.18.3\" &gt;&gt; requirements.txt\n$ echo \"beautifulsoup4==4.6.0\" &gt;&gt; requirements.txt\n$ echo \"feedparser==5.2.1\" &gt;&gt; requirements.txt\n$ echo \"jinja2==2.10\" &gt;&gt; requirements.txt\n$ echo \"mistune==0.8.3\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev89g","search_text":"You need to make a list of RSS feeds, from which we will put our data. ","text_count":71,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need to make a list of RSS feeds, from which we will put our data.&nbsp;"}]},{"block_type":"element","block":"k67ev89h","search_text":"Note In our example, we use the following feeds, which are all technology feeds in well-known news sites: http://feeds.reuters.com/reuters/technologyNews http://rss.nytimes.com/services/xml/rss/nyt/Technology.xml http://feeds.bbci.co.uk/news/science_and_environment/rss.xml ","text_count":274,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In our example, we use the following feeds, which are all technology feeds in well-known news sites:&nbsp;"},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"a","attributes":{"href":"http://feeds.reuters.com/reuters/technologyNews"},"children":[{"block_type":"text","content":"http://feeds.reuters.com/reuters/technologyNews"}]},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"a","attributes":{"href":"http://rss.nytimes.com/services/xml/rss/nyt/Technology.xml"},"children":[{"block_type":"text","content":"http://rss.nytimes.com/services/xml/rss/nyt/Technology.xml"}]},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"element","tag_name":"a","attributes":{"href":"http://feeds.bbci.co.uk/news/science_and_environment/rss.xml"},"children":[{"block_type":"text","content":"http://feeds.bbci.co.uk/news/science_and_environment/rss.xml"}]}]}]},{"block_type":"element","block":"k67ev89i","search_text":"Download the search_keywords.py script, which will perform the actions, from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/search_keywords.py . You also need to download the email templates, which can be found at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/email_styling.html and https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/email_template.md . There is a config template in https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-opportunity.ini .","text_count":610,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_keywords.py"}]},{"block_type":"text","content":"script, which will perform the actions, from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/search_keywords.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/search_keywords.py"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"You also need to download the email templates, which can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/email_styling.html"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/email_styling.html"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/email_template.md"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/email_template.md"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"There is a config template in&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-opportunity.ini"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-opportunity.ini"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev89j","search_text":"You need a valid username and password for an email service. Check the Sending an individual email recipe in Chapter 8, Dealing with Communication Channels .","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You need a valid username and password for an email service. Check the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending an individual email"}]},{"block_type":"text","content":"&nbsp;recipe in&nbsp;Chapter 8,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev89k","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev89l","search_text":"Create a config-opportunity.ini file, which should be in the following format. Remember to fill it with your details: ","text_count":118,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"config-opportunity.ini"}]},{"block_type":"text","content":"file, which should be in the following format. Remember to fill it with your details:&nbsp;"}]}]},{"block_type":"element","block":"k67ev89m","search_text":"[SEARCH] keywords = keyword, keyword feeds = feed, feed [EMAIL] user = <YOUR EMAIL USERNAME> password = <YOUR EMAIL PASSWORD> from = <EMAIL ADDRESS FROM> to = <EMAIL ADDRESS TO>","text_count":177,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[SEARCH]\nkeywords = keyword, keyword\nfeeds = feed, feed\n\n[EMAIL]\nuser = &lt;YOUR EMAIL USERNAME&gt;\npassword = &lt;YOUR EMAIL PASSWORD&gt;\nfrom = &lt;EMAIL ADDRESS FROM&gt;\nto = &lt;EMAIL ADDRESS TO&gt;"}]}]},{"block_type":"element","block":"k67ev89n","search_text":"You can use the template from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-opportunity.ini to search for the keyword cpu and some test feeds. Remember to fill in the EMAIL fields with your own account details.","text_count":265,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can use the template from&nbsp; GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-opportunity.ini"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-opportunity.ini"}]},{"block_type":"text","content":"to search for the keyword&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cpu"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"text","content":"and some test feeds. Remember to fill in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EMAIL"}]},{"block_type":"text","content":"fields with your own account details."}]},{"block_type":"element","block":"k67ev89o","search_text":"Call the script to produce the email and report: ","text_count":49,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Call the script to produce the email and report:"}]}]},{"block_type":"element","block":"k67ev89p","search_text":"$ python search_keywords.py config-opportunity.ini","text_count":50,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python search_keywords.py config-opportunity.ini"}]}]},{"block_type":"element","block":"k67ev89q","search_text":"Check the to email, and you should receive a report with the articles found. It should be something similar to this: ","text_count":117,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"to"}]},{"block_type":"text","content":"&nbsp;email, and you should receive a report with the articles&nbsp;found. It should be something similar to this:"}]}]},{"block_type":"element","block":"k67ev89r","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000056.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev89s","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev89t","search_text":"After creating the proper configuration for the script in step 1, web scraping and sending an email with the results is done in step 2 by calling search_keywords.py .","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After creating the proper configuration for the script in step 1, web scraping and sending an email with the results&nbsp;is done in step 2&nbsp;by&nbsp;calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_keywords.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev89u","search_text":"Let's take a look at the search_keywords.py script. The code is structured into the following parts:","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's take a look at the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"search_keywords.py"}]},{"block_type":"text","content":"script. The code is structured into the following parts:"}]},{"block_type":"element","block":"k67ev89v","search_text":"The IMPORTS section makes available all the Python modules to be used later. It also defines EmailConfig namedtuple to help with handling the email parameters. READ TEMPLATES retrieves the email templates and stores them for later use in the EMAIL_TEMPLATE and EMAIL_STYLING constants. The __main__ block starts the process by, getting the configuration parameters, parsing the config file, and then calling the main function. The main function combines the other functions. First, it retrieves the articles, and then it obtains the body and sends the email. get_articles walks through all the feeds, discards any article that is over a week old, retrieves each of them, and searches for a match on the keywords. All the matched articles are returned, including information about the link and a summary. compose_email_body uses the email templates to compile the email body. Notice that the template is in Markdown and it gets parsed into HTML, to give the same information in plain-text and in HTML. send_email gets the body information, as well as required info such as the username/password, and finally sends the email. ","text_count":1124,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"IMPORTS"}]},{"block_type":"text","content":"section makes available all the Python modules to be used later. It also defines&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EmailConfig&nbsp;namedtuple"}]},{"block_type":"text","content":"to help with handling the email parameters.&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"READ TEMPLATES"}]},{"block_type":"text","content":"retrieves the email templates and stores them for later use in the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EMAIL_TEMPLATE"}]},{"block_type":"text","content":"and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EMAIL_STYLING"}]},{"block_type":"text","content":"constants."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__main__"}]},{"block_type":"text","content":"block starts the process by, getting the configuration parameters, parsing the config file, and then calling the main function."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function combines the other functions. First, it retrieves the articles, and then it obtains the body and sends the email."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get_articles"}]},{"block_type":"text","content":"walks through all the feeds, discards any article that is over a week old, retrieves each of them, and searches for a match on the keywords. All the matched articles are returned, including information about the link and a summary."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"compose_email_body"}]},{"block_type":"text","content":"uses the email templates to compile the email body. Notice that the template is in Markdown and it gets parsed into HTML, to give the same information in plain-text and in HTML."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_email"}]},{"block_type":"text","content":"gets the body information, as well as required info such as the username/password, and finally sends the email."}]}]},{"block_type":"element","block":"k67ev89w","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev89x","search_text":"One of the main challenges in retrieving information from different sources is to parse the text in all cases. Some of the feeds may return information in different formats.","text_count":173,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"One of the main challenges in retrieving information from different sources is to parse the text in all cases. Some of the feeds may return information in different formats."}]},{"block_type":"element","block":"k67ev89y","search_text":"For instance, in our example you can see that the Reuters feed summary includes HTML information that gets rendered in the resulting email. If you have that kind of problem, you may need to process the returned data further, until it becomes consistent. This may be highly dependent on the expected quality of the resulting report. ","text_count":332,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For instance, in our example you can see that the Reuters feed summary includes HTML information that gets rendered in the resulting email. If you have that kind of problem, you may need to process the returned data further, until it becomes consistent. This may be highly dependent on the expected quality of the resulting report.&nbsp;"}]},{"block_type":"element","block":"k67ev89z","search_text":"Tip When developing automatic tasks, especially when dealing with multiple input sources, expect to spend a lot of time cleaning the input in a way that's consistent. But, on the other hand, find a balance and keep in mind the final recipient. If the email is to be received, for example, by yourself or an understanding teammate, you can be a little bit more permissive than in the case of an important client. ","text_count":412,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When developing automatic tasks, especially when dealing with multiple input sources, expect to spend a lot of time cleaning the input in a way that's consistent. But, on the other hand, find a balance and keep in mind the final recipient. If the email is to be received, for example, by yourself or an understanding teammate, you can be a little bit more permissive than in the case of an important client."}]}]},{"block_type":"element","block":"k67ev8a0","search_text":"Another possibility is to increase the complexity of the match. In this recipe, the check is done with a simple in , but remember that all the techniques in Chapter 1, Let Us Begin Our Automation Journey, including all the regular expression capabilities, are available for you to use.","text_count":285,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Another possibility is to increase the complexity of the match. In this recipe, the check is done with a simple"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"in"}]},{"block_type":"text","content":", but remember that all the techniques in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey,&nbsp;"}]},{"block_type":"text","content":"including all the regular expression capabilities, are available for you to use."}]},{"block_type":"element","block":"k67ev8a1","search_text":"Tip This script is automatable through a cron job as described in Chapter 2, Automating Tasks Made Easy . Try to run it every week! ","text_count":132,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This script is automatable through a cron job as&nbsp;described in Chapter 2,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]},{"block_type":"text","content":". Try to run it every week!"}]}]},{"block_type":"element","block":"k67ev8a2","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8a3","search_text":"The Adding command line arguments recipe in Chapter 1, Let Us Begin Our Automation Journey The Introducing regular expressions recipe in Chapter 1, Let Us Begin Our Automation Journey The Preparing a task recipe in Chapter 2, Automating Tasks Made Easy The Setting up a cron job in Chapter 2, Automating Tasks Made Easy The Parsing HTML in Chapter 3, Building Your First Web Scraping Application The Crawling the web recipe in Chapter 3, Building Your First Web Scraping Application The Subscribing to feeds recipe in Chapter 3, Building Your First Web Scraping Application The Sending an individual email recipe in Chapter 8, Dealing with Communication Channels ","text_count":663,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding command line arguments"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The Introducing regular expressions recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Preparing a task"}]},{"block_type":"text","content":"recipe in Chapter 2,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Setting up a cron job"}]},{"block_type":"text","content":"in&nbsp;Chapter 2,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Parsing HTML"}]},{"block_type":"text","content":"in Chapter 3,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling the web"}]},{"block_type":"text","content":"recipe in Chapter 3,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The Subscribing to feeds recipe in&nbsp;&nbsp;Chapter 3,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Building Your First Web Scraping Application"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The Sending an individual email recipe in Chapter 8,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]}]}]},{"block_type":"element","block":"k67ev8a4","search_text":"Creating personalized coupon codes","text_count":34,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Creating personalized coupon codes"}]},{"block_type":"element","block":"k67ev8a5","search_text":"In this chapter, we are presenting a marketing campaign divided into steps:","text_count":75,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we are presenting a marketing campaign divided into steps:"}]},{"block_type":"element","block":"k67ev8a6","search_text":"Detect the best moment to launch the campaign Generate individual codes to be sent to potential customers Send the codes directly to users over their preferred channel, text message or email Collect the results of the campaign Generate a sales report with analysis of the results ","text_count":280,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Detect the best moment to launch the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate individual codes to be sent to potential customers"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send the codes directly to users over their preferred channel, text message or email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Collect the results of the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate a sales report with analysis of the results"}]}]},{"block_type":"element","block":"k67ev8a7","search_text":"This recipe shows step 2 of the campaign.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows step 2 of the campaign."}]},{"block_type":"element","block":"k67ev8a8","search_text":"After an opportunity is detected, we decide to generate a campaign for all customers. To direct promotions and avoid duplication, we will generate a million unique coupons, divided into three batches:","text_count":200,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After an opportunity is detected, we decide to generate a campaign for all customers. To direct promotions and avoid duplication, we will generate a million unique coupons, divided into three batches:"}]},{"block_type":"element","block":"k67ev8a9","search_text":"Half of the codes will be printed and distributed in a marketing action 300,000 codes will be reserved to be used later if the campaign hits some goals The remainder 200,000 will be directed to customers through SMS and emails, as we will see later ","text_count":249,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Half of the codes will be printed and distributed in a marketing action"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"300,000 codes&nbsp;will be reserved to be used later if the campaign hits some goals"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The remainder 200,000&nbsp;will be directed to customers through SMS and emails, as we will see later"}]}]},{"block_type":"element","block":"k67ev8aa","search_text":"These coupons can be redeemed in the online system. Our task will be to generate the proper codes, which should meet the following requirements:","text_count":144,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These coupons can be redeemed in the online system. Our task will be to generate the proper codes, which should meet the following requirements:"}]},{"block_type":"element","block":"k67ev8ab","search_text":"The codes need to be unique The codes need to be printable and easy to read, as some customers will be dictating them over the phone There should be a quick way of discarding codes before checking them (avoiding spam attacks) The codes should be presented in a CSV format for printing ","text_count":285,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The codes need to be unique"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The codes need to be printable and easy to read, as some customers will be dictating them over the phone"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"There should be a quick way of discarding codes before checking them (avoiding spam attacks)"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The codes should be presented in a CSV format for printing"}]}]},{"block_type":"element","block":"k67ev8ac","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev8ad","search_text":"Download the create_personalised_coupons.py script, which will generate the coupons in CSV files, from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/create_personalised_coupons.py .","text_count":229,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_personalised_coupons.py"}]},{"block_type":"text","content":"&nbsp;script, which will generate the coupons in CSV files, from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/create_personalised_coupons.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/create_personalised_coupons.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8ae","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8af","search_text":"Call the create_personalised_coupons.py script. It will take a minute or two to run, depending on your computer speed. It will display the generated codes onscreen: ","text_count":165,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Call the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_personalised_coupons.py"}]},{"block_type":"text","content":"&nbsp;script. It will take a minute or two to run, depending on your computer speed. It will display the generated codes onscreen:"}]}]},{"block_type":"element","block":"k67ev8ag","search_text":"$ python create_personalised_coupons.py Code: HWLF-P9J9E-U3 Code: EAUE-FRCWR-WM Code: PMW7-P39MP-KT ...","text_count":103,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python create_personalised_coupons.py\nCode: HWLF-P9J9E-U3\nCode: EAUE-FRCWR-WM\nCode: PMW7-P39MP-KT\n..."}]}]},{"block_type":"element","block":"k67ev8ah","search_text":"Check it created three CSV files with the codes codes_batch_1.csv , codes_batch_2.csv , and codes_batch_3.csv , each with the proper number of codes: ","text_count":150,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check it created three CSV files with the codes"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"codes_batch_1.csv"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"codes_batch_2.csv"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"codes_batch_3.csv"}]},{"block_type":"text","content":", each with the proper number of codes:"}]}]},{"block_type":"element","block":"k67ev8ai","search_text":"$ wc -l codes_batch_*.csv 500000 codes_batch_1.csv 300000 codes_batch_2.csv 200000 codes_batch_3.csv 1000000 total","text_count":114,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ wc -l codes_batch_*.csv\n  500000 codes_batch_1.csv\n  300000 codes_batch_2.csv\n  200000 codes_batch_3.csv\n 1000000 total"}]}]},{"block_type":"element","block":"k67ev8aj","search_text":"Check that each of the batch files contains unique codes. Your codes will be unique and different from the ones displayed here: ","text_count":128,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check that each of the batch files contains unique codes. Your codes will be unique and different from the ones displayed here:"}]}]},{"block_type":"element","block":"k67ev8ak","search_text":"$ head codes_batch_2.csv 9J9F-M33YH-YR 7WLP-LTJUP-PV WHFU-THW7R-T9 ...","text_count":70,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ head codes_batch_2.csv\n9J9F-M33YH-YR\n7WLP-LTJUP-PV\nWHFU-THW7R-T9\n..."}]}]},{"block_type":"element","block":"k67ev8al","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8am","search_text":"Step 1 calls the script that generates all the codes, and step 2 checks that the results are correct. Step 3 shows the format in which the codes are stored. Let's analyze the create_personalised_coupons.py script.","text_count":213,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 calls the script that generates all the codes, and step 2 checks that the results are correct. Step 3 shows the format in which the codes are stored. Let's analyze the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_personalised_coupons.py"}]},{"block_type":"text","content":"script."}]},{"block_type":"element","block":"k67ev8an","search_text":"In summary, it has the following structure:","text_count":43,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In summary, it has the following structure:"}]},{"block_type":"element","block":"k67ev8ao","search_text":"# IMPORTS # FUNCTIONS def random_code(digits) def checksum(code1, code2) def check_code(code) def generate_code() # SET UP TASK # GENERATE CODES # CREATE AND SAVE BATCHES","text_count":170,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# IMPORTS\n\n# FUNCTIONS\ndef random_code(digits)\ndef checksum(code1, code2)\ndef check_code(code)\ndef generate_code()\n\n# SET UP TASK\n\n# GENERATE CODES\n\n# CREATE AND SAVE BATCHES"}]}]},{"block_type":"element","block":"k67ev8ap","search_text":"The different functions work together to create a code. random_code generates a combination of random letters and numbers, taken from CHARACTERS . This string contains all the valid characters to choose from.","text_count":208,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The different functions work together to create a code."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"random_code&nbsp;"}]},{"block_type":"text","content":"generates a combination of random letters and numbers, taken from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CHARACTERS"}]},{"block_type":"text","content":".&nbsp; This string contains all the valid characters to choose from."}]},{"block_type":"element","block":"k67ev8aq","search_text":"Tip The selection of characters is defined as symbols that are easy to print and not mistake for each other. For example, it will be difficult to distinguish between a letter O and the number 0, or the number 1 and the letter I, depending on the font. This may depend on the specifics, so check printing tests if necessary to tailor the characters. But avoid using all letter and numbers, as it may cause confusion. Increase the length of the codes if necessary. ","text_count":463,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The selection of characters is defined as symbols that are easy to print and not mistake for each other. For example, it will be difficult to distinguish between a letter O and the number 0, or the number 1 and the letter I, depending on the font. This may depend on the specifics, so check printing tests if necessary to tailor the characters. But avoid using all letter and numbers, as it may cause confusion. Increase the length of the codes if necessary."}]}]},{"block_type":"element","block":"k67ev8ar","search_text":"The checksum function generates, based on two codes, an extra digit that is derived from the two codes. This process is called hashing , and it's a well known process in computing, especially for cryptography.","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"checksum"}]},{"block_type":"text","content":"&nbsp;function&nbsp;generates, based on two codes, an extra digit that is derived from the two codes. This process is called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"hashing"}]},{"block_type":"text","content":", and it's a well known process in computing, especially for cryptography."}]},{"block_type":"element","block":"k67ev8as","search_text":"Note The basic function of hashing is to produce an output from an input that is smaller and is not reversible, meaning it's very difficult to guess unless the input is known. Hashing has a lot of common applications in computing, normally under the hood. For example, Python dictionaries make extensive use of hashing. ","text_count":320,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The basic function of hashing is to produce an output from an input that is smaller and is&nbsp;not reversible, meaning it's&nbsp;very difficult to guess unless the input is known. Hashing has a lot of common applications in computing, normally under the hood. For example, Python dictionaries make extensive use of hashing."}]}]},{"block_type":"element","block":"k67ev8at","search_text":"In our recipe, we'll use SHA256, a well known fast hashing algorithm included in the Python hashlib module:","text_count":107,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In our recipe, we'll use&nbsp;SHA256,&nbsp;a well known fast hashing algorithm included in the Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"hashlib"}]},{"block_type":"text","content":"module:"}]},{"block_type":"element","block":"k67ev8au","search_text":"def checksum(code1, code2): m = hashlib.sha256() m.update(code1.encode()) m.update(code2.encode()) checksum = int(m.hexdigest()[:2], base=16) digit = CHARACTERS[checksum % len(CHARACTERS)] return digit","text_count":201,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def checksum(code1, code2):\n    m = hashlib.sha256()\n    m.update(code1.encode())\n    m.update(code2.encode())\n    checksum = int(m.hexdigest()[:2], base=16)\n    digit = CHARACTERS[checksum % len(CHARACTERS)]\n    return digit"}]}]},{"block_type":"element","block":"k67ev8av","search_text":"Both codes are added as input, and the resulting two hex digits of the hash are applied over CHARACTERS to obtain one of the available characters. The digits get transformed into a number (as they are in base 16) and we apply the modulo operator to be sure to obtain one of the available characters.","text_count":299,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Both codes are added as input, and the resulting two hex digits of the hash are applied over"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"CHARACTERS"}]},{"block_type":"text","content":"to obtain one of the available characters. The digits get transformed into a number (as they are in base 16) and we apply the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"modulo"}]},{"block_type":"text","content":"operator to be sure to obtain one of the available characters."}]},{"block_type":"element","block":"k67ev8aw","search_text":"The objective of this checksum is to be able to quickly check whether a code looks like it is correct and discard possible spam. We can produce the operation again over a code to see whether the checksum is the same. Note that this is not a cryptographic hash, as no secret is required at any point of the operation. Given this specific use case, this (low) level of security is probably fine for our purposes.","text_count":410,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The objective of this checksum is to be able to quickly check whether a code looks like it is correct and discard possible spam. We can produce the operation again over a code to see whether the checksum is the same. Note that this is not a cryptographic hash, as no secret is required at any point of the operation. Given this specific use case, this (low) level of security is probably fine for our purposes."}]},{"block_type":"element","block":"k67ev8ax","search_text":"Tip Cryptography is a much bigger theme and ensuring that security is strong can be difficult. The main strategy in cryptography involving hashing is probably to store just the hash to avoid storing passwords in a readable format. You can read a quick intro to that here: https://crackstation.net/hashing-security.htm . ","text_count":320,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Cryptography is a much bigger theme and ensuring that security is strong can be difficult. The main strategy in cryptography involving hashing is probably to store just the hash to avoid storing passwords in a readable format. You can read a quick intro to that here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://crackstation.net/hashing-security.htm"},"children":[{"block_type":"text","content":"https://crackstation.net/hashing-security.htm"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev8ay","search_text":"The generate_code function then produces a random code, composed of four digits, then five digits, and then two digits of the checksum, divided by dashes. The first digit is generated with the first nine digits in order (four then five), and the second reversing them (five then four).","text_count":285,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_code"}]},{"block_type":"text","content":"&nbsp;function&nbsp;then produces a random code, composed of four digits, then five digits, and then two digits of the checksum, divided by dashes. The first digit is generated with the first nine digits in order (four then five), and the second reversing them (five then four)."}]},{"block_type":"element","block":"k67ev8az","search_text":"The check_code function reverses the process and returns True if the code is correct, and False otherwise.","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"check_code"}]},{"block_type":"text","content":"&nbsp;function&nbsp;reverses the process and returns"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":"if the code is correct, and&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"False"}]},{"block_type":"text","content":"otherwise."}]},{"block_type":"element","block":"k67ev8b0","search_text":"With the basic elements in place, the script starts by defining the required batches—500,000, 300,000, and 200,000.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"With the basic elements in place, the script starts by defining the required batches&mdash;500,000, 300,000, and 200,000."}]},{"block_type":"element","block":"k67ev8b1","search_text":"All the codes are generated in the same pool, called codes . This is to avoid duplicates between pools. Note that, due to the randomness of the process, we can't rule out the possibility of generating a duplicated code, though this is small. We allow to retry up to three times to avoid generating a duplicate code. The codes are added to a set accumulator to guarantee their uniqueness and to speed up checking whether a code is already there.","text_count":444,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the codes are generated in the same pool, called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"codes"}]},{"block_type":"text","content":". This is to avoid duplicates between pools. Note that, due to the randomness of the process, we can't rule out the possibility of generating a duplicated code, though this is small. We allow to retry up to three times to avoid generating a duplicate code. The codes are added to a set accumulator to guarantee their uniqueness and to speed up checking whether a code is already there."}]},{"block_type":"element","block":"k67ev8b2","search_text":"Tip sets are another of the places where Python uses hashing under the hood, so it hashes the element to be added and compares it with the hashes of the elements already there. This makes checking in sets very quick. ","text_count":217,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sets"}]},{"block_type":"text","content":"are another of the places where Python uses hashing under the hood, so it hashes the element to be added and compares it with the hashes of the elements already there. This makes checking in sets very quick."}]}]},{"block_type":"element","block":"k67ev8b3","search_text":"To be sure that the process is correct, each code is verified and printed to display progress while generating the code and allow inspecting that everything is working as expected.","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To be sure that the process is correct, each code is verified and printed to display&nbsp;progress while generating the code and allow inspecting that everything is working as expected."}]},{"block_type":"element","block":"k67ev8b4","search_text":"Finally, the codes are divided into the proper number of batches and each one is saved in an individual .csv file. The codes are removed removed one by one from codes using .pop() until the batch has the proper size:","text_count":216,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Finally, the codes are divided into the proper number of batches and each one is saved in an individual"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".csv"}]},{"block_type":"text","content":"file. The codes are removed removed&nbsp;one by one from"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"codes"}]},{"block_type":"text","content":"&nbsp;using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".pop()"}]},{"block_type":"text","content":"until the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"batch"}]},{"block_type":"text","content":"has the proper size:"}]},{"block_type":"element","block":"k67ev8b5","search_text":"batch = [(codes.pop(),) for _ in range(batch_size)]","text_count":51,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"batch = [(codes.pop(),) for _ in range(batch_size)]"}]}]},{"block_type":"element","block":"k67ev8b6","search_text":"Note how the previous line creates a batch of the proper size of rows with a single element. Each row is still a list, as it should be for a CSV file.","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note how the previous line creates a batch of the proper size of rows with a single element. Each row is still a list, as it should be for a CSV file."}]},{"block_type":"element","block":"k67ev8b7","search_text":"Then, a file is created and, using a csv.writer , the codes are stored as rows.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, a file is created and, using a&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"csv.writer"}]},{"block_type":"text","content":", the codes are stored as rows."}]},{"block_type":"element","block":"k67ev8b8","search_text":"As a final test, the remaining codes are verified to be empty.","text_count":62,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As a final test, the remaining"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"codes"}]},{"block_type":"text","content":"are verified to be empty."}]},{"block_type":"element","block":"k67ev8b9","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8ba","search_text":"In this recipe, a direct approach has been used in the flow. This is in opposition to the principles presented in the Preparing a task to run recipe in Chapter 2, Automating Tasks Made Easy . Notice that, compared with the tasks presented there, this script is aimed to be run a single time to produce the codes, and that's it. It also uses defined constants, such as BATCHES , for configuration.","text_count":396,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, a direct approach has been used in the flow. This is in opposition to the principles presented in the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Preparing a task to run"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 2,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]},{"block_type":"text","content":". Notice that, compared with the tasks presented there, this script is aimed to be run a single time to produce the codes, and that's it. It also uses defined constants, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"BATCHES"}]},{"block_type":"text","content":", for configuration."}]},{"block_type":"element","block":"k67ev8bb","search_text":"Given that it is a unique task, designed to be run once, spending time structuring it into a reusable component is probably not the best use of our time.","text_count":153,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Given that it is a unique task, designed to be run once, spending time structuring it into a reusable component is probably not the best use of our time."}]},{"block_type":"element","block":"k67ev8bc","search_text":"Tip Over-engineering is definitively possible, and choosing between a pragmatic design and a more future-facing approach may not be easy. Be realistic about maintenance costs and try to find your own balance. ","text_count":209,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Over-engineering is definitively possible, and choosing between a pragmatic design and a more future-facing approach may not be easy. Be realistic about maintenance costs and try to find your own balance."}]}]},{"block_type":"element","block":"k67ev8bd","search_text":"In the same way, the design in this recipe on the checksum is aimed to give a minimum way to check whether a code is totally made up or looks legit. Given that codes will be checked against a system, this seems like a sensible approach, but be aware of your particular use case.","text_count":278,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the same way, the design in this recipe on the checksum is aimed to give a minimum way to check whether a code is totally made up or looks legit. Given that codes will be checked against a system, this seems like a sensible approach, but be aware of your particular use case."}]},{"block_type":"element","block":"k67ev8be","search_text":"Our code space is of 22 characters ** 9 digits = 1,207,269,217,792 possible codes , meaning the probability of guessing one of the million generated is very small. Is also not very likely to produce the same code twice, but nevertheless, we protected our code against that with up to three retries.","text_count":298,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Our code space is of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"22 characters ** 9 digits =&nbsp;1,207,269,217,792 possible codes"}]},{"block_type":"text","content":", meaning the probability of guessing one of the million generated is very small. Is also not very likely to produce the same code twice, but nevertheless, we protected our code against that with up to three retries."}]},{"block_type":"element","block":"k67ev8bf","search_text":"These kinds of checks, as well as checking that each code verifies and that we end up with no remaining codes, are very useful when developing this kind of script. It ensures that we are going in the right direction and things are going according to plan. Just be aware that asserts may not be executed in some conditions.","text_count":322,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These kinds of checks, as well as checking that each code verifies and that we end up with no remaining codes, are very useful when developing this kind of script. It ensures that we are going in the right direction and things are going according to plan. Just be aware that"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"asserts"}]},{"block_type":"text","content":"may not be executed in some conditions."}]},{"block_type":"element","block":"k67ev8bg","search_text":"Note As described in the Python documentation, assert commands are ignored if the Python code is optimized (run with the -O command). See the documentation here https://docs.python.org/3/reference/simple_stmts.html#the-assert-statement . This is normally not done, but can be confusing if that's the case. Avoid depending heavily on asserts . ","text_count":343,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As described in the Python documentation,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"assert"}]},{"block_type":"text","content":"commands are ignored if the Python code is optimized (run with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-O"}]},{"block_type":"text","content":"command). See the documentation here&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/reference/simple_stmts.html#the-assert-statement"},"children":[{"block_type":"text","content":"https://docs.python.org/3/reference/simple_stmts.html#the-assert-statement"}]},{"block_type":"text","content":". This is normally not done, but can be confusing if that's the case. Avoid depending heavily on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"asserts"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev8bh","search_text":"Learning the basics of cryptography is not as difficult as you may assume. There are a small number of basic schema that are well known and easily learned. A good introduction article is this one, https://thebestvpn.com/cryptography/ . Python also has a good number of cryptographic functions integrated; see the documentation at https://docs.python.org/3/library/crypto.html . The best approach is to find a good book and know that, while it's a difficult subject to truly master, it is definitely approachable.","text_count":512,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Learning the basics of cryptography is not as difficult as you may assume. There are a small number of basic schema that are well known and easily learned.&nbsp;A good introduction article is this one,&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://thebestvpn.com/cryptography/"},"children":[{"block_type":"text","content":"https://thebestvpn.com/cryptography/"}]},{"block_type":"text","content":". Python also has a good number of cryptographic functions integrated; see the documentation at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/crypto.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/crypto.html"}]},{"block_type":"text","content":". The best approach is to find a good book and know that, while it's a difficult subject to truly master, it is definitely approachable."}]},{"block_type":"element","block":"k67ev8bi","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8bj","search_text":"The Introducing regular expressions recipe in Chapter 1, Let Us Begin Our Automation Journey The Reading CSV files recipe in Chapter 4, Searching and Reading Local Files ","text_count":170,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Introducing regular expressions"}]},{"block_type":"text","content":"recipe in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey&nbsp;"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading CSV files"}]},{"block_type":"text","content":"recipe in Chapter 4,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]}]}]},{"block_type":"element","block":"k67ev8bk","search_text":"Sending a notification to the customer on their preferred channel","text_count":65,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Sending a notification to the customer on their preferred channel"}]},{"block_type":"element","block":"k67ev8bl","search_text":"In this chapter, we are presenting a marketing campaign divided into several steps:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we are presenting a marketing campaign divided into several steps:"}]},{"block_type":"element","block":"k67ev8bm","search_text":"Detect the best moment to launch the campaign Generate individual codes to be sent to potential customers Send the codes directly to users over their preferred channel, text message or email Collect the results of the campaign Generate a sales report with analysis of the results ","text_count":280,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Detect the best moment to launch the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate individual codes to be sent to potential customers"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send the codes directly to users over their preferred channel, text message or email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Collect the results of the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate a sales report with analysis of the results"}]}]},{"block_type":"element","block":"k67ev8bn","search_text":"This recipe shows step 3 of the campaign.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows step 3 of the campaign."}]},{"block_type":"element","block":"k67ev8bo","search_text":"Once our codes are created for direct marketing, we need to distribute them to our customers.","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once our codes are created for direct marketing, we need to distribute them to our customers."}]},{"block_type":"element","block":"k67ev8bp","search_text":"For this recipe, from an input from a CSV file with the information of all customers and their preferred contact methods, we will fill the file with the codes generated previously, and then send a notification through the proper method that will include the promotional code.","text_count":275,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, from an input from a CSV file with the information of all customers and their preferred contact methods, we will fill the file&nbsp;with the codes generated previously, and then send a notification through the proper method that will include the promotional code."}]},{"block_type":"element","block":"k67ev8bq","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev8br","search_text":"In this recipe, we will use several modules already presented— delorean , requests , and twilio . We need to add them to our virtual environment if not already there:","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will use several modules&nbsp;already presented&mdash;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":","},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":", and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"twilio"}]},{"block_type":"text","content":". We need to add them to our virtual environment if not already there:"}]},{"block_type":"element","block":"k67ev8bs","search_text":"$ echo \"delorean==1.0.0\" >> requirements.txt $ echo \"requests==2.18.3\" >> requirements.txt $ echo \"twilio==6.16.3\" >> requirements.txt $ pip install -r requirements.txt","text_count":168,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"delorean==1.0.0\" &gt;&gt; requirements.txt\n$ echo \"requests==2.18.3\" &gt;&gt; requirements.txt\n$ echo \"twilio==6.16.3\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev8bt","search_text":"We need to define a config-channel.ini file with our credentials for the services to use, Mailgun and Twilio. A template of this file can be found in GitHub here: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-channel.ini .","text_count":267,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We need to define a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"config-channel.ini"}]},{"block_type":"text","content":"file with our credentials for the services to use, Mailgun and Twilio.&nbsp;A template of this file can be found in GitHub here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-channel.ini"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/config-channel.ini"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8bu","search_text":"Note For information on how to obtain the credentials, refer to the Sending notifications via emails and Producing SMS recipes Chapter 8, Dealing with Communication Channels ","text_count":174,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For information on how to obtain the credentials, refer to the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending notifications via emails"}]},{"block_type":"text","content":"&nbsp;and&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"text","content":"&nbsp;recipes&nbsp;Chapter 8,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]}]}]},{"block_type":"element","block":"k67ev8bv","search_text":"The file has the following format:","text_count":34,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The file has the following format:"}]},{"block_type":"element","block":"k67ev8bw","search_text":"[MAILGUN] KEY = <YOUR KEY> DOMAIN = <YOUR DOMAIN> FROM = <YOUR FROM EMAIL> [TWILIO] ACCOUNT_SID = <YOUR SID> AUTH_TOKEN = <YOUR TOKEN> FROM = <FROM TWILIO PHONE NUMBER>","text_count":168,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"[MAILGUN]\nKEY = &lt;YOUR KEY&gt;\nDOMAIN = &lt;YOUR DOMAIN&gt;\nFROM = &lt;YOUR FROM EMAIL&gt;\n[TWILIO]\nACCOUNT_SID = &lt;YOUR SID&gt;\nAUTH_TOKEN = &lt;YOUR TOKEN&gt;\nFROM = &lt;FROM TWILIO PHONE NUMBER&gt;"}]}]},{"block_type":"element","block":"k67ev8bx","search_text":"For a description of all the contacts to target, we need to generate a CSV file, notifications.csv , in the following format:","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For a description of all the contacts to target, we need to generate a CSV file,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"notifications.csv"}]},{"block_type":"text","content":", in the following format:"}]},{"block_type":"element","block":"k67ev8by","search_text":"Name Contact Method Target Status Code Timestamp John Smith PHONE +1-555-12345678 NOT-SENT Paul Smith EMAIL paul.smith@test.com NOT-SENT … ","text_count":139,"tag_name":"table","attributes":{"border":"1"},"children":[{"block_type":"element","tag_name":"tbody","attributes":{},"children":[{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Name"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Contact Method"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Target"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Status"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Code"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Timestamp"}]}]},{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"John Smith"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"PHONE"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"+1-555-12345678"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"NOT-SENT"}]}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]}]},{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"Paul Smith"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"EMAIL"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"paul.smith@test.com"}]}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"NOT-SENT"}]}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]}]},{"block_type":"element","tag_name":"tr","attributes":{},"children":[{"block_type":"element","tag_name":"td","attributes":{},"children":[{"block_type":"text","content":"&hellip;"}]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]},{"block_type":"element","tag_name":"td","attributes":{},"children":[]}]}]}]},{"block_type":"element","block":"k67ev8bz","search_text":"Note that the Code column is empty, and all statuses should be NOT-SENT or empty.","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Code"}]},{"block_type":"text","content":"&nbsp;column is empty, and all statuses should be"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"NOT-SENT"}]},{"block_type":"text","content":"or empty."}]},{"block_type":"element","block":"k67ev8c0","search_text":"Tip If you are using a test account in Twilio and Mailgun, be aware of its limitations. For example, Twilio only allows you to send messages to authenticated phone numbers. You can create a small CSV with only two or three contacts to test the script. ","text_count":252,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"If you are using a test account in Twilio and Mailgun, be aware of its limitations. For example, Twilio only allows you to send messages to authenticated phone numbers. You can create a small CSV with only two or three contacts to test the script."}]}]},{"block_type":"element","block":"k67ev8c1","search_text":"The coupon codes to be used should be ready in a CSV file. You can generate several batches with the create_personalised_coupons.py script, available in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/create_personalised_coupons.py .","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The coupon codes to be used should be ready in a CSV file. You can generate several batches with the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_personalised_coupons.py"}]},{"block_type":"text","content":"&nbsp;script, available in GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/create_personalised_coupons.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/create_personalised_coupons.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8c2","search_text":"Download the script to be used, send_notifications.py , from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/send_notifications.py .","text_count":178,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the script to be used,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_notifications.py"}]},{"block_type":"text","content":", from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/send_notifications.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/send_notifications.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8c3","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8c4","search_text":"Run send_notifications.py to see its options and usage: ","text_count":56,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_notifications.py"}]},{"block_type":"text","content":"to see its options and usage:"}]}]},{"block_type":"element","block":"k67ev8c5","search_text":"$ python send_notifications.py --help usage: send_notifications.py [-h] [-c CODES] [--config CONFIG_FILE] notif_file positional arguments: notif_file notifications file optional arguments: -h, --help show this help message and exit -c CODES, --codes CODES Optional file with codes. If present, the file will be populated with codes. No codes will be sent --config CONFIG_FILE config file (default config.ini)","text_count":408,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python send_notifications.py --help\nusage: send_notifications.py [-h] [-c CODES] [--config CONFIG_FILE] notif_file\n\npositional arguments:\n  notif_file notifications file\n\noptional arguments:\n  -h, --help show this help message and exit\n  -c CODES, --codes CODES\n                        Optional file with codes. If present, the file will be\n                        populated with codes. No codes will be sent\n  --config CONFIG_FILE config file (default config.ini)"}]}]},{"block_type":"element","block":"k67ev8c6","search_text":"Add the codes to the notifications.csv file: ","text_count":45,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add the codes to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"notifications.csv"}]},{"block_type":"text","content":"file:"}]}]},{"block_type":"element","block":"k67ev8c7","search_text":"$ python send_notifications.py --config config-channel.ini notifications.csv -c codes_batch_3.csv $ head notifications.csv Name,Contact Method,Target,Status,Code,Timestamp John Smith,PHONE,+1-555-12345678,NOT-SENT,CFXK-U37JN-TM, Paul Smith,EMAIL,paul.smith@test.com,NOT-SENT,HJGX-M97WE-9Y, ...","text_count":293,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python send_notifications.py --config config-channel.ini notifications.csv -c codes_batch_3.csv \n$ head notifications.csv\nName,Contact Method,Target,Status,Code,Timestamp\nJohn Smith,PHONE,+1-555-12345678,NOT-SENT,CFXK-U37JN-TM,\nPaul Smith,EMAIL,paul.smith@test.com,NOT-SENT,HJGX-M97WE-9Y,\n..."}]}]},{"block_type":"element","block":"k67ev8c8","search_text":"Finally, send the notifications: ","text_count":33,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Finally, send the notifications:"}]}]},{"block_type":"element","block":"k67ev8c9","search_text":"$ python send_notifications.py --config config-channel.ini notifications.csv $ head notifications.csv Name,Contact Method,Target,Status,Code,Timestamp John Smith,PHONE,+1-555-12345678,SENT,CFXK-U37JN-TM,2018-08-25T13:08:15.908986+00:00 Paul Smith,EMAIL,paul.smith@test.com,SENT,HJGX-M97WE-9Y,2018-08-25T13:08:16.980951+00:00 ...","text_count":328,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python send_notifications.py --config config-channel.ini notifications.csv\n$ head notifications.csv\nName,Contact Method,Target,Status,Code,Timestamp\nJohn Smith,PHONE,+1-555-12345678,SENT,CFXK-U37JN-TM,2018-08-25T13:08:15.908986+00:00\nPaul Smith,EMAIL,paul.smith@test.com,SENT,HJGX-M97WE-9Y,2018-08-25T13:08:16.980951+00:00\n..."}]}]},{"block_type":"element","block":"k67ev8ca","search_text":"Check the emails and phones to verify the messages were received. ","text_count":66,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the emails and phones to verify the messages were received."}]}]},{"block_type":"element","block":"k67ev8cb","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8cc","search_text":"Step 1 shows the use of the script. The general idea is to call it several times, the first to fill it with codes, and the second to send the messages. If there's an error, the script can be executed again, and only messages not previously sent will be retried.","text_count":261,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 shows the use of the script. The general idea is to call it several times, the first to fill it with codes, and the second to send the messages. If there's an error, the script can be executed again, and only messages not previously sent will be retried."}]},{"block_type":"element","block":"k67ev8cd","search_text":"The notifications.csv file gets the codes that will be injected in step 2. The codes are finally sent in step 3.","text_count":112,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"notifications.csv"}]},{"block_type":"text","content":"file gets the codes that will be injected in step 2. The codes are finally sent in step 3."}]},{"block_type":"element","block":"k67ev8ce","search_text":"Let's analyze the code of send_notifications.py . Only the most relevant bits are shown here:","text_count":93,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's analyze the code of&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_notifications.py"}]},{"block_type":"text","content":". Only the most relevant bits are shown here:"}]},{"block_type":"element","block":"k67ev8cf","search_text":"# IMPORTS def send_phone_notification(...): def send_email_notification(...): def send_notification(...): def save_file(...): def main(...): if __name__ == '__main__': # Parse arguments and prepare configuration ...","text_count":215,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# IMPORTS\n\ndef send_phone_notification(...):\ndef send_email_notification(...):\ndef send_notification(...):\n\ndef save_file(...):\ndef main(...):\n\nif __name__ == '__main__':\n    # Parse arguments and prepare configuration\n    ..."}]}]},{"block_type":"element","block":"k67ev8cg","search_text":"The main function goes through the file line by line and analyzes what to do in each case. If the entry is SENT , it skips it. If it has no code, it tries to fill it. If it tries to send it, it will attach the timestamp to record when it was sent or tried to be sent.","text_count":267,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main function goes through the file line by line and analyzes what to do in each case. If the entry is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SENT"}]},{"block_type":"text","content":", it skips it. If it has no code, it tries to fill it. If it tries to send it, it will attach the timestamp to record when it was sent or tried to be sent."}]},{"block_type":"element","block":"k67ev8ch","search_text":"For each entry, the whole file is saved again in a file called save_file . Notice how the file cursor is positioned at the start of the file, the file is written, and then flushed to disk. This makes the file overwritten on each entry operation, without having to close and open the file again.","text_count":294,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For each entry, the whole file is saved again&nbsp;in a file called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"save_file"}]},{"block_type":"text","content":". Notice how the file cursor is positioned at the start of the file, the file is written, and then flushed to disk. This makes the file overwritten on each entry operation, without having to close and open the file again."}]},{"block_type":"element","block":"k67ev8ci","search_text":"Note Why write the whole file for each entry? This is to allow you to retry. If one of the entries produces an unexpected error or a timeout, or even if there's a general failure, all the progress and previous codes will be marked as SENT already, and not sent a second time. This means the operation can be retried needed. For a huge number of entries, this is a good way of ensuring that a problem in the middle of the process doesn't make us resend messages to our customers. ","text_count":479,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Why write the whole file for each entry? This is to allow you to retry. If one of the entries produces an unexpected error or a timeout, or even if there's a general failure, all the progress and previous codes will be marked as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SENT"}]},{"block_type":"text","content":"already, and not sent a second time. This means the operation can be retried needed. For a huge number of entries, this is a good way of ensuring that a problem in the middle of the process doesn't make us resend messages to our customers."}]}]},{"block_type":"element","block":"k67ev8cj","search_text":"For each code to be sent, the send_notification function decides to call either send_phone_notification or send_email_notification . It appends the current time in both cases.","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For each code to be sent, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_notification"}]},{"block_type":"text","content":"&nbsp;function&nbsp;decides to call&nbsp;either&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_phone_notification"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_email_notification"}]},{"block_type":"text","content":". It appends the current time in both cases."}]},{"block_type":"element","block":"k67ev8ck","search_text":"Both send functions return an error if they can't send the message. This allows you to mark it in the resulting notifications.csv and retry it later.","text_count":149,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Both"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send"}]},{"block_type":"text","content":"functions return an error&nbsp;if they can't send the message. This allows you to mark it in the resulting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"notifications.csv"}]},{"block_type":"text","content":"and retry it later."}]},{"block_type":"element","block":"k67ev8cl","search_text":"Tip The notifications.csv file can also be changed manually. For example, imagine there's a typo in an email and that's the reason for the error. It can be changed and retried. ","text_count":177,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"notifications.csv"}]},{"block_type":"text","content":"file can also be changed manually. For example, imagine there's a typo in an email and that's the reason for the error. It can be changed and retried."}]}]},{"block_type":"element","block":"k67ev8cm","search_text":"send_email_notification sends the message based on the Mailgun interface. For more information, refer to the Sending notifications via emails recipe in Chapter 8, Dealing with Communication Channels . Note that the email sent here is text only.","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_email_notification"}]},{"block_type":"text","content":"&nbsp;sends the message based on the Mailgun interface. For more information, refer to the&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending notifications via emails"}]},{"block_type":"text","content":"&nbsp;recipe in Chapter 8,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]},{"block_type":"text","content":". Note that the email sent here is text only."}]},{"block_type":"element","block":"k67ev8cn","search_text":"send_phone_notification sends the message based on the Twilio interface. For more information, refer to the Producing SMS recipe in Chapter 8, Dealing with Communication Channels .","text_count":180,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_phone_notification"}]},{"block_type":"text","content":"sends the message based on the Twilio interface.&nbsp;For more information, refer to the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"text","content":"recipe in Chapter 8,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8co","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8cp","search_text":"The format of the timestamp has been deliberately written in ISO format, as it is a parsable format. This means that we can get back a proper object in an easy way, like this:","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The format of the timestamp has been deliberately written in ISO format, as it is a parsable format. This means that we can get back a proper object in an easy way, like this:"}]},{"block_type":"element","block":"k67ev8cq","search_text":">>> import datetime >>> timestamp = datetime.datetime.now(datetime.timezone.utc).isoformat() >>> timestamp '2018-08-25T14:13:53.772815+00:00' >>> datetime.datetime.fromisoformat(timestamp) datetime.datetime(2018, 9, 11, 21, 5, 41, 979567, tzinfo=datetime.timezone.utc)","text_count":268,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; import datetime\n&gt;&gt;&gt; timestamp = datetime.datetime.now(datetime.timezone.utc).isoformat()\n&gt;&gt;&gt; timestamp\n'2018-08-25T14:13:53.772815+00:00'\n&gt;&gt;&gt; datetime.datetime.fromisoformat(timestamp)\ndatetime.datetime(2018, 9, 11, 21, 5, 41, 979567, tzinfo=datetime.timezone.utc)"}]}]},{"block_type":"element","block":"k67ev8cr","search_text":"This allows you to easily parse the timestamp back and forth.","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This allows you to easily parse&nbsp;the timestamp&nbsp;back and forth."}]},{"block_type":"element","block":"k67ev8cs","search_text":"Tip ISO 8601 time format is well supported in most programming languages and very precisely defines the time, as it includes the time zone. It is an excellent choice for recording times, if you can use it. ","text_count":206,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"ISO 8601 time format is well supported in most programming languages and&nbsp;very precisely&nbsp;defines the time, as it includes the time zone. It is an excellent choice for recording times, if you can use it."}]}]},{"block_type":"element","block":"k67ev8ct","search_text":"The strategy used in send_notification to route the notifications is an interesting one:","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The strategy used in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"send_notification"}]},{"block_type":"text","content":"to route the notifications is an interesting one:"}]},{"block_type":"element","block":"k67ev8cu","search_text":"# Route each of the notifications METHOD = { 'PHONE': send_phone_notification, 'EMAIL': send_email_notification, } try: method = METHOD[entry['Contact Method']] result = method(entry, config) except KeyError: result = 'INVALID_METHOD'","text_count":234,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Route each of the notifications\nMETHOD = {\n    'PHONE': send_phone_notification,\n    'EMAIL': send_email_notification,\n}\ntry:\n    method = METHOD[entry['Contact Method']]\n    result = method(entry, config)\nexcept KeyError:\n    result = 'INVALID_METHOD'"}]}]},{"block_type":"element","block":"k67ev8cv","search_text":"The METHOD dictionary assigns each of the possible Contact Method to a function that has the same definition, accepting both an entry and a config.","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"METHOD"}]},{"block_type":"text","content":"dictionary assigns each of the possible&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Contact Method"}]},{"block_type":"text","content":"&nbsp;to a function that has the same definition, accepting both an entry and a config."}]},{"block_type":"element","block":"k67ev8cw","search_text":"Then, based on the specific method, the function is retrieved from the dictionary and called. Note the method variable contains the correct function to call.","text_count":157,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, based on the specific method, the function is retrieved from the dictionary and called. Note the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"method"}]},{"block_type":"text","content":"variable contains the correct function to call."}]},{"block_type":"element","block":"k67ev8cx","search_text":"Note This acts in a similar way to the switch operation that is available in other programming languages. It is also possible to achieve this through if…else blocks. For simple cases like this code, the dictionary method makes the code very readable. ","text_count":251,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This acts in a similar way to the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"switch"}]},{"block_type":"text","content":"operation that is available in other programming languages.&nbsp;It is also possible to achieve this through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"if&hellip;else"}]},{"block_type":"text","content":"blocks. For simple cases like this code, the dictionary method makes the code very readable."}]}]},{"block_type":"element","block":"k67ev8cy","search_text":"The invalid_method function is used as a default. If the Contact Method is not one of the available ones ( PHONE or EMAIL ), a KeyError will be raised, captured, and the result will be defined as INVALID METHOD .","text_count":212,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"invalid_method"}]},{"block_type":"text","content":"&nbsp;function&nbsp;is used as a default. If the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Contact Method"}]},{"block_type":"text","content":"is not one of the available ones ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PHONE"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"EMAIL"}]},{"block_type":"text","content":"), a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"KeyError"}]},{"block_type":"text","content":"will be raised, captured, and the result will be defined as"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INVALID METHOD"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8cz","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8d0","search_text":"The Sending notifications via emails recipe in Chapter 8, Dealing with Communication Channels The Producing SMS recipe in Chapter 8, Dealing with Communication Channels ","text_count":169,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Sending notifications via emails"}]},{"block_type":"text","content":"recipe in Chapter 8,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels&nbsp;"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Producing SMS"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 8,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Dealing with Communication Channels&nbsp;"}]}]}]},{"block_type":"element","block":"k67ev8d1","search_text":"Preparing sales information","text_count":27,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Preparing sales information"}]},{"block_type":"element","block":"k67ev8d2","search_text":"In this chapter, we are presenting a marketing campaign divided into several steps:","text_count":83,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we are presenting a marketing campaign divided into several steps:"}]},{"block_type":"element","block":"k67ev8d3","search_text":"Detect the best moment to launch the campaign Generate individual codes to be sent to potential customers Send the codes directly to users over their preferred channel, text message or email Collect the results of the campaign Generate a sales report with analysis of the results ","text_count":280,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Detect the best moment to launch the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate individual codes to be sent to potential customers"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send the codes directly to users over their preferred channel, text message or email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Collect the results of the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate a sales report with analysis of the results"}]}]},{"block_type":"element","block":"k67ev8d4","search_text":"This recipe shows step 4 of the campaign.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows step 4 of the campaign."}]},{"block_type":"element","block":"k67ev8d5","search_text":"After sending the information to users, we need to collect the sales log from the shops to monitor how it is going and how big the campaign's impact is.","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After sending the information to users, we need to collect the sales log from the shops to monitor how it is going and how big the campaign's impact is."}]},{"block_type":"element","block":"k67ev8d6","search_text":"The sales logs are reported as individual files from each of the associated shops, so in this recipe we'll see how to aggregate all the info into a spreadsheet to be able to treat the information as a whole.","text_count":207,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The sales logs are reported as individual files from each of the associated shops, so in this recipe we'll see how to aggregate all the info into a&nbsp;spreadsheet to be able to treat the information as a whole."}]},{"block_type":"element","block":"k67ev8d7","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev8d8","search_text":"For this recipe, we need to install the following modules:","text_count":58,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we need to install the following modules:"}]},{"block_type":"element","block":"k67ev8d9","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ echo \"parse==1.8.2\" >> requirements.txt $ echo \"delorean==1.0.0\" >> requirements.txt $ pip install -r requirements.txt","text_count":165,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ echo \"parse==1.8.2\" &gt;&gt; requirements.txt\n$ echo \"delorean==1.0.0\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev8da","search_text":"We can obtain a test structure and test logs for this recipe from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter09/sales . Please download the full sales directory, which contains a lot of test logs. To display the structure, we'll use the tree command ( http://mama.indstate.edu/users/ice/tree/ ), which is installed by default in Linux and can be installed using brew in macOs ( https://brew.sh/ ). You can use a graphical tool to inspect the directory as well.","text_count":508,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We can obtain a test structure and test logs for this recipe from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter09/sales"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter09/sales"}]},{"block_type":"text","content":". Please download the full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sales"}]},{"block_type":"text","content":"&nbsp;directory, which contains a lot of test logs.&nbsp;To display the structure, we'll use the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"tree"}]},{"block_type":"text","content":"command ("},{"block_type":"element","tag_name":"a","attributes":{"href":"http://mama.indstate.edu/users/ice/tree/"},"children":[{"block_type":"text","content":"http://mama.indstate.edu/users/ice/tree/"}]},{"block_type":"text","content":"), which is installed by default in Linux and can be installed using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"brew"}]},{"block_type":"text","content":"in macOs ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://brew.sh/"},"children":[{"block_type":"text","content":"https://brew.sh/"}]},{"block_type":"text","content":"). You can use a graphical tool to inspect the directory as well."}]},{"block_type":"element","block":"k67ev8db","search_text":"We'll also need the sale_log.py module and the parse_sales_log.py script, available in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/parse_sales_log.py .","text_count":201,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll also need the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sale_log.py"}]},{"block_type":"text","content":"&nbsp;module&nbsp;and the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse_sales_log.py"}]},{"block_type":"text","content":"&nbsp;script, available in GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/parse_sales_log.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/parse_sales_log.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8dc","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8dd","search_text":"Check the structure of the sales directory. Each subdirectory represents a shop that has submitted its sales logs for the period: ","text_count":130,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the structure of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sales"}]},{"block_type":"text","content":"directory. Each subdirectory represents a shop that has submitted its sales logs for the period:"}]}]},{"block_type":"element","block":"k67ev8de","search_text":"$ tree sales sales ├── 345 │ └── logs.txt ├── 438 │ ├── logs_1.txt │ ├── logs_2.txt │ ├── logs_3.txt │ └── logs_4.txt └── 656 └── logs.txt","text_count":138,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ tree sales\nsales\n├── 345\n│   └── logs.txt\n├── 438\n│   ├── logs_1.txt\n│   ├── logs_2.txt\n│   ├── logs_3.txt\n│   └── logs_4.txt\n└── 656\n └── logs.txt"}]}]},{"block_type":"element","block":"k67ev8df","search_text":"Check the log files: ","text_count":21,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check&nbsp; the log files:"}]}]},{"block_type":"element","block":"k67ev8dg","search_text":"$ head sales/438/logs_1.txt [2018-08-27 21:05:55+00:00] - SALE - PRODUCT: 12346 - PRICE: $02.99 - NAME: Single item - DISCOUNT: 0% [2018-08-27 22:05:55+00:00] - SALE - PRODUCT: 12345 - PRICE: $07.99 - NAME: Family pack - DISCOUNT: 20% ...","text_count":238,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ head sales/438/logs_1.txt\n[2018-08-27 21:05:55+00:00] - SALE - PRODUCT: 12346 - PRICE: $02.99 - NAME: Single item - DISCOUNT: 0%\n[2018-08-27 22:05:55+00:00] - SALE - PRODUCT: 12345 - PRICE: $07.99 - NAME: Family pack - DISCOUNT: 20%\n..."}]}]},{"block_type":"element","block":"k67ev8dh","search_text":"Call the parse_sales_log.py script to generate the repository: ","text_count":63,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Call the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse_sales_log.py"}]},{"block_type":"text","content":"&nbsp;script to generate the repository:"}]}]},{"block_type":"element","block":"k67ev8di","search_text":"$ python parse_sales_log.py sales -o report.xlsx","text_count":48,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python parse_sales_log.py sales -o report.xlsx"}]}]},{"block_type":"element","block":"k67ev8dj","search_text":"Check the generated Excel result, report.xlsx : ","text_count":48,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the generated Excel result,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"report.xlsx"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8dk","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000008.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev8dl","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8dm","search_text":"Steps 1 and 2 show how the data is structured. Step 3 calls parse_sales_log.py to read all the log files and parse them, and then stores them in an Excel spreadsheet. The contents of the spreadsheet are displayed in step 4.","text_count":223,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Steps 1 and 2 show how the data is structured. Step 3 calls"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse_sales_log.py&nbsp;"}]},{"block_type":"text","content":"to read all the log files and parse them, and then stores them in an Excel spreadsheet. The contents of the spreadsheet are displayed in step 4."}]},{"block_type":"element","block":"k67ev8dn","search_text":"Let's see how parse_sales_log.py is structured:","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's see how&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse_sales_log.py"}]},{"block_type":"text","content":"is structured:"}]},{"block_type":"element","block":"k67ev8do","search_text":"# IMPORTS from sale_log import SaleLog def get_logs_from_file(shop, log_filename): with open(log_filename) as logfile: logs = [SaleLog.parse(shop=shop, text_log=log) for log in logfile] return logs def main(log_dir, output_filename): logs = [] for dirpath, dirnames, filenames in os.walk(log_dir): for filename in filenames: # The shop is the last directory shop = os.path.basename(dirpath) fullpath = os.path.join(dirpath, filename) logs.extend(get_logs_from_file(shop, fullpath)) # Create and save the Excel sheet xlsfile = openpyxl.Workbook() sheet = xlsfile['Sheet'] sheet.append(SaleLog.row_header()) for log in logs: sheet.append(log.row()) xlsfile.save(output_filename) if __name__ == '__main__': # PARSE COMMAND LINE ARGUMENTS AND CALL main() ","text_count":751,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# IMPORTS\nfrom sale_log import SaleLog\n\ndef get_logs_from_file(shop, log_filename):\n    with open(log_filename) as logfile:\n        logs = [SaleLog.parse(shop=shop, text_log=log)\n                for log in logfile]\n    return logs\n\ndef main(log_dir, output_filename):\n    logs = []\n    for dirpath, dirnames, filenames in os.walk(log_dir):\n        for filename in filenames:\n            # The shop is the last directory\n            shop = os.path.basename(dirpath)\n            fullpath = os.path.join(dirpath, filename)\n            logs.extend(get_logs_from_file(shop, fullpath))\n\n    # Create and save the Excel sheet\n    xlsfile = openpyxl.Workbook()\n    sheet = xlsfile['Sheet']\n    sheet.append(SaleLog.row_header())\n    for log in logs:\n        sheet.append(log.row())\n    xlsfile.save(output_filename)\n\nif __name__ == '__main__':\n  # PARSE COMMAND LINE ARGUMENTS AND CALL main()"}]}]},{"block_type":"element","block":"k67ev8dp","search_text":"The command line arguments are explained in Chapter 1, Let Us Begin Our Automation Journey . Note that the imports include SaleLog .","text_count":132,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The command line arguments are explained in Chapter 1,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":". Note that the imports include"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SaleLog"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8dq","search_text":"The main function walks through the whole directory and grabs all the files through os.walk . You can get more information about os.walk in Chapter 2, Automating Tasks Made Easy . Each file is then passed to get_logs_from_file to parse its logs and add them to the global logs list.","text_count":282,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The main function walks through the whole directory and grabs all the files through"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.walk"}]},{"block_type":"text","content":". You can get more information about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.walk"}]},{"block_type":"text","content":"in Chapter 2,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]},{"block_type":"text","content":". Each file is then passed to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"get_logs_from_file"}]},{"block_type":"text","content":"to parse its logs and add them to the global"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"logs"}]},{"block_type":"text","content":"list."}]},{"block_type":"element","block":"k67ev8dr","search_text":"Note that the specific shop is stored in the last subdirectory, so it is extracted with os.path.basename .","text_count":106,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the specific shop is stored in the last subdirectory, so it is extracted with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"os.path.basename"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8ds","search_text":"Once the list of logs has been completed, a new Excel sheet is created using the openpyxl module. The SaleLog module has a .row_header method to add the first row, and then all the logs are converted to row format using .row . Finally, the file is saved.","text_count":254,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once the list of logs has been completed, a new Excel sheet is created using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"module. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SaleLog"}]},{"block_type":"text","content":"module has a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".row_header"}]},{"block_type":"text","content":"method to add the first row, and then all the logs are converted to row format using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".row"}]},{"block_type":"text","content":". Finally, the file is saved."}]},{"block_type":"element","block":"k67ev8dt","search_text":"To parse the logs, we make a module called sale_log.py . This abstracts parsing and dealing with a row. Most of it is straightforward and it structures each of the different parameters properly, but the parse method requires a bit of attention:","text_count":244,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To parse the logs, we make a module called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sale_log.py"}]},{"block_type":"text","content":". This abstracts parsing and dealing with a row. Most of it is straightforward and it structures each of the different parameters properly, but the parse method requires a bit of attention:"}]},{"block_type":"element","block":"k67ev8du","search_text":"@classmethod def parse(cls, shop, text_log): ''' Parse from a text log with the format ... to a SaleLog object ''' def price(string): return Decimal(string) def isodate(string): return delorean.parse(string) FORMAT = ('[{timestamp:isodate}] - SALE - PRODUCT: {product:d} ' '- PRICE: ${price:price} - NAME: {name:D} ' '- DISCOUNT: {discount:d}%') formats = {'price': price, 'isodate': isodate} result = parse.parse(FORMAT, text_log, formats) return cls(timestamp=result['timestamp'], product_id=result['product'], price=result['price'], name=result['name'], discount=result['discount'], shop=shop)","text_count":596,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"@classmethod\n    def parse(cls, shop, text_log):\n        '''\n        Parse from a text log with the format\n        ...\n        to a SaleLog object\n        '''\n        def price(string):\n            return Decimal(string)\n\n        def isodate(string):\n            return delorean.parse(string)\n\n        FORMAT = ('[{timestamp:isodate}] - SALE - PRODUCT: {product:d} '\n                  '- PRICE: ${price:price} - NAME: {name:D} '\n                  '- DISCOUNT: {discount:d}%')\n\n        formats = {'price': price, 'isodate': isodate}\n        result = parse.parse(FORMAT, text_log, formats)\n\n        return cls(timestamp=result['timestamp'],\n                   product_id=result['product'],\n                   price=result['price'],\n                   name=result['name'],\n                   discount=result['discount'],\n                   shop=shop)"}]}]},{"block_type":"element","block":"k67ev8dv","search_text":"sale_log.py is a classmethod , meaning that it can be used by calling SaleLog.parse , and it returns a new element of the class.","text_count":128,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sale_log.py"}]},{"block_type":"text","content":"is a"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"classmethod"}]},{"block_type":"text","content":", meaning that it can be used by calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SaleLog.parse"}]},{"block_type":"text","content":", and it returns a new element of the class."}]},{"block_type":"element","block":"k67ev8dw","search_text":"Note Classmethods are called with a first argument that stores the class, instead of the object normally stored in self . The convention is to use cls to represent it. Calling cls(...) at the end is equivalent to SaleFormat(...) , so it calls the __init__ method. ","text_count":264,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Classmethods"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"&nbsp;"}]},{"block_type":"text","content":"are called with a first argument that stores the class, instead of the object normally stored in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"self"}]},{"block_type":"text","content":". The convention is to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cls"}]},{"block_type":"text","content":"to represent it. Calling&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"cls(...)&nbsp;"}]},{"block_type":"text","content":"&nbsp;at the end&nbsp;is equivalent to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SaleFormat(...)"}]},{"block_type":"text","content":", so it calls the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__init__"}]},{"block_type":"text","content":"&nbsp;method."}]}]},{"block_type":"element","block":"k67ev8dx","search_text":"The method uses the parse module to retrieve the values from the template. Note how two elements, timestamp and price , have custom parsing. The delorean module helps us with parsing the date, and the price is better described as a Decimal to keep the proper resolution. The custom filters are applied in the formats argument.","text_count":326,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The method uses the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"module to retrieve the values from the template. Note how two elements,"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"timestamp"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"price"}]},{"block_type":"text","content":", have custom parsing. The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"&nbsp;module&nbsp;helps us with parsing the date, and the price is better described as a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"to keep the proper resolution. The custom filters are applied in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"formats"}]},{"block_type":"text","content":"argument."}]},{"block_type":"element","block":"k67ev8dy","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8dz","search_text":"The Decimal type is described in detail in the Python documentation here: https://docs.python.org/3/library/decimal.html .","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Decimal"}]},{"block_type":"text","content":"type is described in detail in the Python documentation here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/decimal.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/decimal.html"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8e0","search_text":"The full openpyxl can be found here: https://openpyxl.readthedocs.io/en/stable/ . Also, check Chapter 6, Fun with Spreadsheets , for more examples on how to use the module.","text_count":172,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"can be found here:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/"},"children":[{"block_type":"text","content":"&nbsp;https://openpyxl.readthedocs.io/en/stable/"}]},{"block_type":"text","content":". Also, check Chapter 6,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Fun with Spreadsheets"}]},{"block_type":"text","content":", for more examples on how to use the module."}]},{"block_type":"element","block":"k67ev8e1","search_text":"The full parse documentation can be found here: https://github.com/r1chardj0n3s/parse . Chapter 1, Let Us Begin Our Automation Journey , also describes this module in greater detail.","text_count":182,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/r1chardj0n3s/parse"},"children":[{"block_type":"text","content":"https://github.com/r1chardj0n3s/parse"}]},{"block_type":"text","content":". Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey"}]},{"block_type":"text","content":", also describes this module in greater detail."}]},{"block_type":"element","block":"k67ev8e2","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8e3","search_text":"The Using a third-party tool—parse recipe in Chapter 1, Let Us Begin Our Automation Journey The Crawling and searching directories recipe in Chapter 4, Searching and Reading Local Files The Reading text files recipe in Chapter 4, Searching and Reading Local Files The Updating an Excel spreadsheet recipe in Chapter 6, Fun with Spreadsheets ","text_count":341,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Using a third-party tool&mdash;parse"}]},{"block_type":"text","content":"recipe in Chapter 1,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Let Us Begin Our Automation Journey &nbsp;"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Crawling and searching directories"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 4,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading text files"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 4,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Searching and Reading Local Files"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Updating an Excel spreadsheet"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 6,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Fun with Spreadsheets"}]}]}]},{"block_type":"element","block":"k67ev8e4","search_text":"Generating a sales report","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Generating a sales report"}]},{"block_type":"element","block":"k67ev8e5","search_text":"In this chapter, we are presenting a marketing campaign divided in several steps:","text_count":81,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we are presenting a marketing campaign divided in several steps:"}]},{"block_type":"element","block":"k67ev8e6","search_text":"Detect the best moment to launch the campaign Generate individual codes to be sent to potential customers Send the codes directly to users over their preferred channel, text message or email Collect the results of the campaign Generate a sales report with analysis of the results ","text_count":280,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Detect the best moment to launch the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate individual codes to be sent to potential customers"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Send the codes directly to users over their preferred channel, text message or email"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Collect the results of the campaign"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Generate a sales report with analysis of the results"}]}]},{"block_type":"element","block":"k67ev8e7","search_text":"This recipe shows step 5 of the campaign.","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe shows step 5 of the campaign."}]},{"block_type":"element","block":"k67ev8e8","search_text":"As the final step, all the information about each of the sales is aggregated and displayed in a sales report.","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As the final step, all the information about each of the sales is aggregated and displayed in a sales report."}]},{"block_type":"element","block":"k67ev8e9","search_text":"In this recipe, we'll see how to leverage reading from spreadsheets, creating PDFs, and producing graphs to generate a comprehensive report automatically in order to analyze the performance of our campaign.","text_count":206,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll see how to leverage reading from spreadsheets, creating PDFs, and producing graphs to generate a comprehensive report automatically in order to analyze the performance of our campaign."}]},{"block_type":"element","block":"k67ev8ea","search_text":"Getting Ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting Ready"}]},{"block_type":"element","block":"k67ev8eb","search_text":"In this recipe, we'll require the following modules in our virtual environment:","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll require the following modules in our virtual environment:"}]},{"block_type":"element","block":"k67ev8ec","search_text":"$ echo \"openpyxl==2.5.4\" >> requirements.txt $ echo \"fpdf==1.7.2\" >> requirements.txt $ echo \"delorean==1.0.0\" >> requirements.txt $ echo \"PyPDF2==1.26.0\" >> requirements.txt $ echo \"matplotlib==2.2.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":255,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"openpyxl==2.5.4\" &gt;&gt; requirements.txt\n$ echo \"fpdf==1.7.2\" &gt;&gt; requirements.txt\n$ echo \"delorean==1.0.0\" &gt;&gt; requirements.txt\n$ echo \"PyPDF2==1.26.0\" &gt;&gt; requirements.txt\n$ echo \"matplotlib==2.2.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev8ed","search_text":"We'll need the sale_log.py module available in GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/sale_log.py .","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We'll need the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sale_log.py"}]},{"block_type":"text","content":"&nbsp;module&nbsp;available in GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/sale_log.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/sale_log.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8ee","search_text":"Note The input spreadsheet is generated in the previous recipe, preparing sales information. Check there for more information. ","text_count":127,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The input spreadsheet is generated in&nbsp;the previous recipe, preparing sales information. Check there for more information."}]}]},{"block_type":"element","block":"k67ev8ef","search_text":"You can download the script to generate the input spreadsheet, parse_sales_log.py , from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/parse_sales_log.py .","text_count":203,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can download the script to generate the input spreadsheet,&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse_sales_log.py"}]},{"block_type":"text","content":", from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/parse_sales_log.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/parse_sales_log.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8eg","search_text":"Download the raw log files from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter09/sales . Please download the full sales directory.","text_count":175,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the raw log files from GitHub at"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter09/sales"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/tree/master/Chapter09/sales"}]},{"block_type":"text","content":". Please download the full&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"sales"}]},{"block_type":"text","content":"&nbsp;directory."}]},{"block_type":"element","block":"k67ev8eh","search_text":"Download the generate_sales_report.py script from GitHub at https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/generate_sales_report.py .","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_sales_report.py"}]},{"block_type":"text","content":"&nbsp;script&nbsp;from GitHub at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/generate_sales_report.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter09/generate_sales_report.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8ei","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8ej","search_text":"Check the input file and the use of generate_sales_report.py : ","text_count":63,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the input file and the use of&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_sales_report.py"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8ek","search_text":"$ ls report.xlsx report.xlsx $ python generate_sales_report.py --help usage: generate_sales_report.py [-h] input_file output_file positional arguments: input_file output_file optional arguments: -h, --help show this help message and exit","text_count":237,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ ls report.xlsx\nreport.xlsx\n$ python generate_sales_report.py --help\nusage: generate_sales_report.py [-h] input_file output_file\n\npositional arguments:\n  input_file\n  output_file\n\noptional arguments:\n  -h, --help show this help message and exit"}]}]},{"block_type":"element","block":"k67ev8el","search_text":"Call the generate_sales_report.py script with the input file and an output file: ","text_count":81,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Call the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_sales_report.py"}]},{"block_type":"text","content":"&nbsp;script with the input file and an output file:"}]}]},{"block_type":"element","block":"k67ev8em","search_text":"$ python generate_sales_report.py report.xlsx output.pdf","text_count":56,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python generate_sales_report.py report.xlsx output.pdf"}]}]},{"block_type":"element","block":"k67ev8en","search_text":"Check the output.pdf output file. It will contain three pages, the first a brief summary and the second and third graphs with the sales by day and by shop: ","text_count":156,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"output.pdf"}]},{"block_type":"text","content":"&nbsp;output file. It will contain three pages, the first a brief summary and the second and third graphs with the sales by day and by shop:"}]}]},{"block_type":"element","block":"k67ev8eo","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000005.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev8ep","search_text":"The second page shows a graph of sales by day:","text_count":46,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The second page shows a graph of sales by day:"}]},{"block_type":"element","block":"k67ev8eq","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000000.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev8er","search_text":"The third page divides the sales by shop:","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The third page divides the sales by shop:"}]},{"block_type":"element","block":"k67ev8es","search_text":"","text_count":0,"tag_name":"p","attributes":{"class":"f-center"},"children":[{"block_type":"element","tag_name":"img","attributes":{"src":"https://learnable-static.s3.amazonaws.com/premium/reeedr/books/python-automation-cookbook/images/000036.png","class":"lazyload"},"children":[]}]},{"block_type":"element","block":"k67ev8et","search_text":"How it works","text_count":12,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works"}]},{"block_type":"element","block":"k67ev8eu","search_text":"Step 1 shows how to use the script and step 2 calls it on the input file. Let's take a look at the basic structure of the generate_sales_report.py script:","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 shows how to use the script and step 2 calls it on the input file. Let's take a look at the basic structure of the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_sales_report.py"}]},{"block_type":"text","content":"script:"}]},{"block_type":"element","block":"k67ev8ev","search_text":"# IMPORTS def generate_summary(logs): def aggregate_by_day(logs): def aggregate_by_shop(logs): def graph(...): def create_summary_brief(...): def main(input_file, output_file): # open and read input file # Generate each of the pages calling the other calls # Group all the pdfs into a single file # Write the resulting PDF if __name__ == '__main__': # Compile the input and output files from the command line # call main","text_count":420,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# IMPORTS\ndef generate_summary(logs):\n\ndef aggregate_by_day(logs):\ndef aggregate_by_shop(logs):\n\ndef graph(...):\n\ndef create_summary_brief(...):\n\n\ndef main(input_file, output_file):\n  # open and read input file\n  # Generate each of the pages calling the other calls\n  # Group all the pdfs into a single file\n  # Write the resulting PDF\n\nif __name__ == '__main__':\n  # Compile the input and output files from the command line\n  # call main"}]}]},{"block_type":"element","block":"k67ev8ew","search_text":"There are two key elements—the aggregation of the logs in different ways (by shop and by day) and the generation of a summary in each case. The summary is generated with generate_summary , which, from a list of logs, generates a dictionary with its aggregated information. The aggregation of the logs is done in different styles in the aggregate_by functions.","text_count":359,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are two key elements&mdash;the aggregation of the logs in different ways (by shop and by day) and the generation of a summary in each case. The summary is generated with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_summary"}]},{"block_type":"text","content":", which, from a list of logs, generates a dictionary with its aggregated information. The aggregation of the logs is done in different styles in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aggregate_by"}]},{"block_type":"text","content":"functions."}]},{"block_type":"element","block":"k67ev8ex","search_text":"Note generate_summary produces a dictionary with the aggregated information, including start and end time, total income of all logs, total units, average discount, and a breakdown of the same data by product. ","text_count":209,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"generate_summary"}]},{"block_type":"text","content":"&nbsp;produces a dictionary with the aggregated information, including start and end time, total income of all logs, total units, average discount, and a breakdown of the same data by product."}]}]},{"block_type":"element","block":"k67ev8ey","search_text":"The script is better understood by starting at the end. The main functions join all the different operations. Read each of the logs and transform them into native SaleLog objects.","text_count":179,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The script is better understood by starting at the end. The main functions join all the different operations. Read each of the logs and transform them into native&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"SaleLog"}]},{"block_type":"text","content":"objects."}]},{"block_type":"element","block":"k67ev8ez","search_text":"Then, it generates each of the pages into an intermediate PDF file:","text_count":67,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Then, it generates each of the pages into an intermediate PDF file:"}]},{"block_type":"element","block":"k67ev8f0","search_text":"A brief, generated by create_summary_brief over a general summary of all the data. The logs are aggregate_by_day . A summary is created and a graph is produced. The logs are aggregate_by_shop . A summary is created and a graph is produced. ","text_count":240,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"A brief, generated by&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_summary_brief"}]},{"block_type":"text","content":"over a general summary of all the data."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The logs are"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aggregate_by_day"}]},{"block_type":"text","content":". A summary is created and a graph is produced."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The logs are"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aggregate_by_shop"}]},{"block_type":"text","content":". A summary is created and a graph is produced.&nbsp;"}]}]},{"block_type":"element","block":"k67ev8f1","search_text":"All the intermediate PDF pages are joined, using PyPDF2 , into a single file. Finally, the intermediate pages are deleted.","text_count":122,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the intermediate PDF pages are joined, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PyPDF2"}]},{"block_type":"text","content":", into a single file. Finally, the intermediate pages are deleted."}]},{"block_type":"element","block":"k67ev8f2","search_text":"Both aggregate_by_day and aggregate_by_shop return a list with a summary of each of the elements. In aggregate_by_day , we detect when a day ends by using .end_of_day to differentiate one day from another.","text_count":205,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Both"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aggregate_by_day"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aggregate_by_shop"}]},{"block_type":"text","content":"return a list with a summary of each of the elements. In"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"aggregate_by_day"}]},{"block_type":"text","content":", we detect when a&nbsp;day ends by using"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".end_of_day"}]},{"block_type":"text","content":"to differentiate one day from another."}]},{"block_type":"element","block":"k67ev8f3","search_text":"The graph function does the following:","text_count":38,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"graph"}]},{"block_type":"text","content":"function does the following:"}]},{"block_type":"element","block":"k67ev8f4","search_text":"Prepares all the data that is going to be displayed. That includes the number of units per tag (day or shop), and the total income per tag. Creates a top graph with the total income, split by product into stacked bars. To be able to do this, at the same time the total income is calculated, the baseline (the position where the next stack is located) is calculated. It divides the bottom part of the graph into as many graphs as there are products, and displays the number of units sold on each one, per tag (day or shop). ","text_count":523,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Prepares all the data that is going to be displayed. That includes the number of units per tag (day or shop), and the total income per tag."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Creates a top graph with the total income, split by product into stacked bars. To be able to do this, at the same time the total income is calculated, the baseline (the position where the next stack is located) is calculated."}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"It divides the bottom part of the graph into as many graphs as there are products, and displays the number of units sold on each one, per tag (day or shop)."}]}]},{"block_type":"element","block":"k67ev8f5","search_text":"Note For a better display, the graph is defined to be the size of an A4 sheet. It also allows us, using skip_labels , to print one of each X label on the second graph on the X axis to avoid overlapping. This is useful when displaying the days, and it's set to show only one label per week. ","text_count":290,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For a better display, the graph is defined to be the size of an A4 sheet. It also allows us, using&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"skip_labels"}]},{"block_type":"text","content":", to print one of each"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"label on the second graph on the"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"X"}]},{"block_type":"text","content":"axis to avoid overlapping. This is useful when displaying the days, and it's set to show only one label per week."}]}]},{"block_type":"element","block":"k67ev8f6","search_text":"The resulting graph is saved to a file.","text_count":39,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The resulting graph is saved to a file."}]},{"block_type":"element","block":"k67ev8f7","search_text":"create_summary_brief uses the fpdf module to save a text PDF page with the total summary information. ","text_count":102,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_summary_brief"}]},{"block_type":"text","content":"uses the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fpdf"}]},{"block_type":"text","content":"module to save a text PDF page with the total summary information.&nbsp;"}]},{"block_type":"element","block":"k67ev8f8","search_text":"Tip The template and information in create_summary_brief has been left deliberately simple to avoid complicating this recipe, but it can be complicated with better descriptive text and formatting. Refer to Chapter 5, Generating Fantastic Reports , for more details on how to use fpdf . ","text_count":286,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The template and information in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"create_summary_brief"}]},{"block_type":"text","content":"has been left deliberately simple to avoid complicating this recipe, but it can be complicated with better descriptive text and formatting. Refer to Chapter 5,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating&nbsp;Fantastic Reports"}]},{"block_type":"text","content":", for more details on how to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"fpdf"}]},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"."}]}]}]},{"block_type":"element","block":"k67ev8f9","search_text":"As shown before, the main function groups all the PDF pages and joins them into a single document, removing the intermediate pages later.","text_count":137,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As shown before, the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"main"}]},{"block_type":"text","content":"function groups all the PDF pages and joins them into a single document, removing the intermediate pages later."}]},{"block_type":"element","block":"k67ev8fa","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8fb","search_text":"The reports included in this recipe could be expanded. For example, the average discount could be calculated in each of the pages and displayed as a line:","text_count":154,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The reports included in this recipe could be expanded. For example, the average discount could be calculated in each of the pages and displayed as a line:"}]},{"block_type":"element","block":"k67ev8fc","search_text":"# Generate a data series with the average discount discount = [summary['average_discount'] for _, summary in full_summary] .... # Print the legend # Plot the discount in a second axis plt.twinx() plt.plot(pos, discount,'o-', color='green') plt.ylabel('Average Discount')","text_count":270,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# Generate a data series with the average discount\ndiscount = [summary['average_discount'] for _, summary in full_summary]\n....\n# Print the legend\n# Plot the discount in a second axis\nplt.twinx()\nplt.plot(pos, discount,'o-', color='green')\nplt.ylabel('Average Discount')"}]}]},{"block_type":"element","block":"k67ev8fd","search_text":"Be careful not to put too much information in a single graph, though. It may reduce the readability. In this case, another graph is probably a better way of displaying it.","text_count":171,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be careful not to put too much information in a single graph, though. It may reduce the readability. In this case, another graph is&nbsp;probably&nbsp;a better way of displaying it."}]},{"block_type":"element","block":"k67ev8fe","search_text":"Tip Be careful to print the legend before creating the second axis, or it will display only the information on the second axis. ","text_count":128,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Be careful to print the legend before creating the second axis, or it will display only the information on the second axis."}]}]},{"block_type":"element","block":"k67ev8ff","search_text":"The size and orientation of the graphs can determine whether to use more labels or fewer, so they are clear and readable. This is demonstrated in the use of skip_labels to avoid clutter. Keep an eye on the resulting graphics and try to adapt to possible problems in that area by changing sizes or limiting labels in some cases.","text_count":327,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The size and orientation of the graphs can determine whether to use more labels or fewer, so they are clear and readable. This is demonstrated in the use of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"skip_labels"}]},{"block_type":"text","content":"to avoid clutter. Keep an eye on the resulting graphics and try to adapt to possible problems in that area by changing sizes or limiting labels in some cases."}]},{"block_type":"element","block":"k67ev8fg","search_text":"Tip For example, a possible limit is to have no more than three products, as printing four graphs in the second row in our graphs will probably make the text illegible. Feel free to experiment and check the limits of the code. ","text_count":227,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For example, a possible limit is to have no more than three products, as printing four graphs in the second row in our graphs will probably&nbsp;make the text illegible. Feel free to experiment and check the limits of the code."}]}]},{"block_type":"element","block":"k67ev8fh","search_text":"The complete matplotlib documentation can be found at https://matplotlib.org/ . The delorean documentation can be found here: https://delorean.readthedocs.io/en/latest/ . All the documentation for openpyxl is available at https://openpyxl.readthedocs.io/en/stable/ . The full documentation for the PDF manipulation modules can be found for PyPDF2 at https://pythonhosted.org/PyPDF2/ and for pyfdf at https://pyfpdf.readthedocs.io/en/latest/ .","text_count":442,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The complete&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"matplotlib"}]},{"block_type":"text","content":"documentation can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://matplotlib.org/"},"children":[{"block_type":"text","content":"https://matplotlib.org/"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"delorean"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://delorean.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://delorean.readthedocs.io/en/latest/"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"All the documentation for&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"openpyxl"}]},{"block_type":"text","content":"is available at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://openpyxl.readthedocs.io/en/stable/"},"children":[{"block_type":"text","content":"https://openpyxl.readthedocs.io/en/stable/"}]},{"block_type":"text","content":"."},{"block_type":"element","tag_name":"br","attributes":{},"children":[]},{"block_type":"text","content":"The full documentation for the PDF manipulation modules can be found for PyPDF2 at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pythonhosted.org/PyPDF2/"},"children":[{"block_type":"text","content":"https://pythonhosted.org/PyPDF2/"}]},{"block_type":"text","content":"and&nbsp; for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pyfdf"}]},{"block_type":"text","content":"at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pyfpdf.readthedocs.io/en/latest/"},"children":[{"block_type":"text","content":"https://pyfpdf.readthedocs.io/en/latest/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8fi","search_text":"Note This recipe makes use of different concepts and techniques that are available in Chapter 5, Generating Fantastic Reports , for PDF creation and manipulation, Chapter 6, Fun with Spreadsheets , for spreadsheet reading, and Chapter 7, Developing Stunning Graphs , for graph creation. Check them out to know more. ","text_count":316,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This recipe makes use of different concepts and techniques that are available in Chapter 5,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports"}]},{"block_type":"text","content":", for PDF creation and manipulation, Chapter 6,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Fun with Spreadsheets"}]},{"block_type":"text","content":", for spreadsheet reading, and Chapter 7,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":", for graph creation. Check them out to know more."}]}]},{"block_type":"element","block":"k67ev8fj","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8fk","search_text":"The Aggregating PDF reports recipe in Chapter 5, Generating Fantastic Reports The Reading an Excel spreadsheet recipe in Chapter 6, Fun with Spreadsheets The Drawing stacked bars recipe in Chapter 7, Developing Stunning Graphs The Displaying multiple lines recipe in Chapter 7, Developing Stunning Graphs The Adding legends and annotations recipe in Chapter 7, Developing Stunning Graphs The Combining graphs recipe in Chapter 7, Developing Stunning Graphs The Saving charts recipe in Chapter 7, Developing Stunning Graphs ","text_count":523,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Aggregating PDF"}]},{"block_type":"text","content":"reports recipe in Chapter 5,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Generating Fantastic Reports"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Reading an Excel"}]},{"block_type":"text","content":"spreadsheet recipe in Chapter 6,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Fun with Spreadsheets"}]}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Drawing stacked bars"}]},{"block_type":"text","content":"recipe in Chapter 7,"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Displaying multiple lines"}]},{"block_type":"text","content":"recipe in&nbsp;Chapter 7,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Adding legends and annotations"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 7,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Combining graphs"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 7,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":"&nbsp;"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Saving charts"}]},{"block_type":"text","content":"recipe&nbsp;in&nbsp;Chapter 7,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Developing Stunning Graphs"}]},{"block_type":"text","content":"&nbsp;"}]}]}]},{"title":"Debugging Techniques","author":"Jaime Buelta","block":"k67euofd","number":10,"contents":[{"block_type":"element","block":"k67ev8fl","search_text":"In this chapter, we will cover the following recipes:","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will cover the following recipes:"}]},{"block_type":"element","block":"k67ev8fm","search_text":"Learning Python interpreter basics Debugging through logging Debugging with breakpoints Improving your debugging skills ","text_count":120,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Learning Python interpreter basics"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Debugging through logging"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Debugging with breakpoints"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Improving your debugging skills"}]}]},{"block_type":"element","block":"k67ev8fn","search_text":"Introduction","text_count":12,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Introduction"}]},{"block_type":"element","block":"k67ev8fo","search_text":"Writing code is not easy. Actually, it is very hard. Even the best programmer in the world can't foresee any possible alternative and flow of the code. ","text_count":152,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Writing code is not easy. Actually, it is very hard. Even the best programmer in the world can't foresee any possible alternative and flow of the code.&nbsp;"}]},{"block_type":"element","block":"k67ev8fp","search_text":"This means that executing our code will always produce surprises and unexpected behavior. Some will be very evident and others will be very subtle, but the ability to identify and remove these defects in the code is critical to building solid software.","text_count":252,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This means that executing our code will always produce surprises and unexpected behavior. Some will be very evident and others will be very subtle, but the ability to identify and remove these defects in the code is critical to building solid software."}]},{"block_type":"element","block":"k67ev8fq","search_text":"These defects in software are known as bugs , and therefore removing them is called debugging .","text_count":95,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"These defects in software are known as"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"bugs"}]},{"block_type":"text","content":", and therefore removing them is called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"debugging"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8fr","search_text":"Inspecting the code just by reading it is not great. There are always surprises, and complex code is difficult to follow. That's why the ability to debug by stopping execution and taking a look at the current state of things is important.","text_count":238,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Inspecting the code just by reading it is not great. There are always surprises, and complex code is difficult to follow. That's why the ability to debug by stopping execution and taking a look at the current state of things is important."}]},{"block_type":"element","block":"k67ev8fs","search_text":"Tip Everyone, EVERYONE introduces bugs in the code, normally to be surprised by them later. Some people have described debugging as being the detective in a crime movie where you are also the murderer . ","text_count":203,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Everyone, EVERYONE introduces bugs in the code, normally to be surprised by them later. Some people have described debugging as&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"being the detective in a crime movie where you are also the murderer"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev8ft","search_text":"Any debugging process roughly follows this path:","text_count":48,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Any debugging process roughly follows this path:"}]},{"block_type":"element","block":"k67ev8fu","search_text":"You realize there's a problem You understand what the correct behavior should be You discover why the current code produces the bug You change the code to produce the proper result ","text_count":181,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You realize there's a problem"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You understand what the correct behavior&nbsp;should&nbsp;be"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You discover why the current code produces the bug"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"You change the code to produce the proper result"}]}]},{"block_type":"element","block":"k67ev8fv","search_text":"95% of the time, everything but step 3 is trivial, which is the bulk of the debugging process. ","text_count":95,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"95% of the time, everything but step 3 is trivial, which is the bulk of the debugging process.&nbsp;"}]},{"block_type":"element","block":"k67ev8fw","search_text":"Realizing the why of a bug, at its core, uses the scientific method:","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Realizing the why of a bug, at its core, uses the scientific method:"}]},{"block_type":"element","block":"k67ev8fx","search_text":"Measure and observe what the code is doing Produce a hypothesis on why that is Validate or disprove that's correct, maybe through an experiment Use the resulting information to iterate the process ","text_count":197,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Measure and observe what the code is doing"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Produce a hypothesis on why that is"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Validate or disprove that's correct, maybe through an experiment"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Use the resulting information to iterate the process"}]}]},{"block_type":"element","block":"k67ev8fy","search_text":"Debugging is an ability, and as such, it will improve over time. Practice plays an important role in developing intuition on what paths look promising to identify an error, but there are some general ideas that may help you:","text_count":224,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Debugging is an ability, and as such, it will improve over time. Practice plays an important role in developing intuition on what paths look promising to identify an error, but there are some general ideas that may help you:"}]},{"block_type":"element","block":"k67ev8fz","search_text":"Divide and conquer: Isolate small parts of the code, so that it is possible to understand the code. Simplify the problem as much as possible. ","text_count":142,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Divide and conquer:&nbsp;"}]},{"block_type":"text","content":"Isolate small parts of the code, so that it is possible to understand the code. Simplify the problem as much as possible."}]}]},{"block_type":"element","block":"k67ev8g0","search_text":"There's a format of this called the Wolf fence algorithm , described by Eduard Gauss:","text_count":85,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There's a format of this called the"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Wolf fence algorithm"}]},{"block_type":"text","content":", described by Eduard Gauss:"}]},{"block_type":"element","block":"k67ev8g1","search_text":"\"There's one wolf in Alaska; how do you find it? First build a fence down the middle of the state, wait for the wolf to howl, determine which side of the fence it is on. Repeat process on that side only, until you get to the point where you can see the wolf.\" ","text_count":260,"tag_name":"blockquote","attributes":{},"children":[{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"\"There's one wolf in Alaska; how do you find it? First build a fence down the middle of the state, wait for the wolf to howl, determine which side of the fence it is on. Repeat process on that side only, until you get to the point where you can see the wolf.\""}]}]},{"block_type":"element","block":"k67ev8g2","search_text":"Move backwards from the error: If there's a clear error at a specific point, the bug is likely located in the surroundings. Move progressively backwards from the error, following the track until the source of the error is found. ","text_count":229,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Move backwards from the error:&nbsp;"}]},{"block_type":"text","content":"If there's a clear error at a specific point, the bug is likely located in the surroundings.&nbsp;Move progressively backwards from the error, following the track until the source of the error is found."}]}]},{"block_type":"element","block":"k67ev8g3","search_text":"You can assume anything you want, as long as you prove your assumption: Code is very complex to keep in your head all at once. You need to validate small assumptions that, when combined, will provide solid ground to move forward with detecting and fixing the problem. Make small experiments, which will allow you to remove from your mind parts of the code that actually work and focus on untested ones. ","text_count":403,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"You can assume anything you want, as long as you prove your assumption:"}]},{"block_type":"text","content":"&nbsp;Code is very complex to keep in your head all at once. You need to validate small assumptions that, when combined, will provide solid ground to move forward with detecting and fixing the problem. Make small experiments, which will allow you to remove from your mind parts of the code that actually work and focus on untested ones."}]}]},{"block_type":"element","block":"k67ev8g4","search_text":"Or in the words of Sherlock Holmes:","text_count":35,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Or in the words of Sherlock Holmes:"}]},{"block_type":"element","block":"k67ev8g5","search_text":"\" Once you eliminate the impossible, whatever remains, no matter how improbable, must be the truth.\"","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"\""},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Once you eliminate the impossible, whatever remains, no matter how improbable, must be the truth.\""}]}]},{"block_type":"element","block":"k67ev8g6","search_text":"But remember to prove it. Avoid untested assumptions.","text_count":53,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But remember to prove it. Avoid untested assumptions."}]},{"block_type":"element","block":"k67ev8g7","search_text":"Note All of this sounds a bit scary, but actually most of the bugs are pretty evident. Maybe a typo, or a piece of code not ready for a particular value. Try to keep things simple. Simple code is easier to analyze and debug. ","text_count":225,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All of this sounds a bit scary, but actually most of the bugs are pretty evident. Maybe a typo, or a piece of code not ready for a particular value. Try to keep things simple.&nbsp;Simple code is easier to analyze and debug."}]}]},{"block_type":"element","block":"k67ev8g8","search_text":"In this chapter, we will see some of the tools and techniques for debugging, and apply them specifically to Python scripts. The scripts will have some bugs that we will fix as part of the recipe.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this chapter, we will see some of the tools and techniques for debugging, and apply them specifically to Python scripts. The scripts will have some bugs that we will fix as part of the recipe."}]},{"block_type":"element","block":"k67ev8g9","search_text":"Learning Python interpreter basics","text_count":34,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Learning Python interpreter basics"}]},{"block_type":"element","block":"k67ev8ga","search_text":"In this recipe, we'll cover some of Python's built-in capabilities to examine code, to investigate what's going on, and to detect when things are not behaving properly.","text_count":168,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we'll cover some of Python's built-in capabilities to examine code, to investigate what's going on, and to detect when things are not behaving properly."}]},{"block_type":"element","block":"k67ev8gb","search_text":"Tip We can also verify when things are working as expected. Remember that being able to discard part of the code as the source of a bug is incredibly important. ","text_count":161,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We can also verify when things are working as expected. Remember that being able to discard part of the code as the source of a bug is incredibly important."}]}]},{"block_type":"element","block":"k67ev8gc","search_text":"While debugging, we typically need to analyze unknown elements and objects that come from an external module or service. Given the dynamic nature of Python, the code is highly discoverable at any point in the execution.","text_count":219,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"While debugging, we typically need to analyze unknown elements and objects that come from an external module or service. Given the dynamic nature of Python, the code is highly discoverable at any point in the execution."}]},{"block_type":"element","block":"k67ev8gd","search_text":"Everything in this recipe is included by default in Python's interpreter.","text_count":73,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Everything&nbsp;in this recipe is&nbsp;included by default in Python's interpreter."}]},{"block_type":"element","block":"k67ev8ge","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8gf","search_text":"Import pprint : ","text_count":16,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Import"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pprint"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8gg","search_text":">>> from pprint import pprint","text_count":29,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; from pprint import pprint"}]}]},{"block_type":"element","block":"k67ev8gh","search_text":"Create a new dictionary called dictionary : ","text_count":44,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Create a new dictionary called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dictionary"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8gi","search_text":">>> dictionary = {'example': 1}","text_count":31,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; dictionary = {'example': 1}"}]}]},{"block_type":"element","block":"k67ev8gj","search_text":"Display globals into this environment: ","text_count":39,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Display&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"globals"}]},{"block_type":"text","content":"into this environment:"}]}]},{"block_type":"element","block":"k67ev8gk","search_text":">>> globals() {...'pprint': <function pprint at 0x100995048>, ...'dictionary': {'example': 1}}","text_count":94,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; globals()\n{...'pprint': &lt;function pprint at 0x100995048&gt;, \n...'dictionary': {'example': 1}}"}]}]},{"block_type":"element","block":"k67ev8gl","search_text":"Print the globals dictionary in a readable format with pprint : ","text_count":64,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Print the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"globals"}]},{"block_type":"text","content":"dictionary in a readable format with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pprint"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8gm","search_text":">>> pprint(globals()) {'__annotations__': {}, ... 'dictionary': {'example': 1}, 'pprint': <function pprint at 0x100995048>}","text_count":123,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; pprint(globals())\n{'__annotations__': {},\n ...\n 'dictionary': {'example': 1},\n 'pprint': &lt;function pprint at 0x100995048&gt;}"}]}]},{"block_type":"element","block":"k67ev8gn","search_text":"Display all of the attributes of the dictionary : ","text_count":50,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"&nbsp;Display all of the attributes of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dictionary"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8go","search_text":">>> dir(dictionary) ['__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values']","text_count":512,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; dir(dictionary)\n['__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values']"}]}]},{"block_type":"element","block":"k67ev8gp","search_text":"Show the help for the dictionary object: ","text_count":41,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Show the help for the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dictionary"}]},{"block_type":"text","content":"object:"}]}]},{"block_type":"element","block":"k67ev8gq","search_text":">>> help(dictionary) Help on dict object: class dict(object) | dict() -> new empty dictionary | dict(mapping) -> new dictionary initialized from a mapping object's | (key, value) pairs ...","text_count":188,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; help(dictionary)\n\nHelp on dict object:\n\nclass dict(object)\n | dict() -&gt; new empty dictionary\n | dict(mapping) -&gt; new dictionary initialized from a mapping object's\n | (key, value) pairs\n..."}]}]},{"block_type":"element","block":"k67ev8gr","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8gs","search_text":"After the import of pprint (pretty print) in step 1, we create a new dictionary to work as the example in step 2.","text_count":113,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After the import of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pprint"}]},{"block_type":"text","content":"(pretty print) in step 1, we create a new dictionary to work as the example in step 2."}]},{"block_type":"element","block":"k67ev8gt","search_text":"Step 3 shows how the global namespace contains, among other things, the defined dictionary and the module. globals() displays all imported modules an other global variables.","text_count":173,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 shows how the global namespace contains, among other things, the defined dictionary and the module."},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"globals()"}]},{"block_type":"text","content":"&nbsp;displays all imported modules an other global variables."}]},{"block_type":"element","block":"k67ev8gu","search_text":"Note There's an equivalent locals() for local namespaces. ","text_count":58,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There's an equivalent"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"locals()"}]},{"block_type":"text","content":"for local namespaces."}]}]},{"block_type":"element","block":"k67ev8gv","search_text":"pprint helps to display the globals in a more readable format in step 4, adding more space and separating the elements by line.","text_count":127,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pprint"}]},{"block_type":"text","content":"helps to display the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"globals"}]},{"block_type":"text","content":"in a more readable format in step 4, adding more space and separating the elements by line."}]},{"block_type":"element","block":"k67ev8gw","search_text":"Step 5 shows how to use dir() to obtain all the attributes of a Python object. Note this includes all the double underscore values, such as __len__ .","text_count":149,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 5 shows how to use"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dir()"}]},{"block_type":"text","content":"to obtain all the attributes of a Python object. Note this includes all the double underscore values, such as&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"__len__"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8gx","search_text":"The use of the built-in help() function will display relevant information for objects.","text_count":86,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The use of the&nbsp;built-in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"help()"}]},{"block_type":"text","content":"&nbsp;function will display relevant information for objects."}]},{"block_type":"element","block":"k67ev8gy","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8gz","search_text":"dir() in particular is extremely useful for inspecting unknown objects, modules, or classes. If you need to filter out the default attributes, and clarify the output, you can filter the output this way:","text_count":202,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dir()"}]},{"block_type":"text","content":"in particular is extremely useful for inspecting unknown objects, modules, or classes. If you need to filter out the default attributes, and clarify the output, you can filter the output this way:"}]},{"block_type":"element","block":"k67ev8h0","search_text":">>> [att for att in dir(dictionary) if not att.startswith('__')] ['clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values']","text_count":170,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; [att for att in dir(dictionary) if not att.startswith('__')]\n['clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values']"}]}]},{"block_type":"element","block":"k67ev8h1","search_text":"In the same way, if you're searching for a particular method (such as something that starts with set ), you can filter in the same way.","text_count":135,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the same way, if you're searching for a particular method (such as something that starts with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"set"}]},{"block_type":"text","content":"), you can filter in the same way."}]},{"block_type":"element","block":"k67ev8h2","search_text":"help() will display the docstring of a function or class. docstring is the string defined just after the definition to document the function or class:","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"help()"}]},{"block_type":"text","content":"will display the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docstring"}]},{"block_type":"text","content":"of a function or class.&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docstring"}]},{"block_type":"text","content":"is the string defined just after the definition to document the function or class:"}]},{"block_type":"element","block":"k67ev8h3","search_text":">>> def something(): ... ''' ... This is help for something ... ''' ... pass ... >>> help(something) Help on function something in module __main__: something() This is help for something","text_count":186,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"&gt;&gt;&gt; def something():\n...     '''\n...     This is help for something\n...     '''\n...     pass\n...\n&gt;&gt;&gt; help(something)\nHelp on function something in module __main__:\n\nsomething()\n    This is help for something"}]}]},{"block_type":"element","block":"k67ev8h4","search_text":"Notice how in the next example, the This is help for something string is defined just after the definition of the function.","text_count":123,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice how in the next example, the &nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"This is help for something"}]},{"block_type":"text","content":"&nbsp;string is defined just after the definition of the function."}]},{"block_type":"element","block":"k67ev8h5","search_text":"Tip docstring is normally enclosed in triple quotes to allow writing string with multiple lines. Python will treat everything inside triple-quotes as a big string, even if there are newlines. You can use either ' or \" characters, as long as you use three of them. You can find more information about docstrings at https://www.python.org/dev/peps/pep-0257/ . ","text_count":358,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docstring"}]},{"block_type":"text","content":"is normally enclosed in triple quotes to allow writing string with multiple lines. Python will treat everything inside triple-quotes as a big string, even if there are newlines. You can use either&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'"}]},{"block_type":"text","content":"or"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\""}]},{"block_type":"text","content":"&nbsp;characters,&nbsp; as long as you use three of them. You can find more information about"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"docstrings"}]},{"block_type":"text","content":"at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.python.org/dev/peps/pep-0257/"},"children":[{"block_type":"text","content":"https://www.python.org/dev/peps/pep-0257/"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev8h6","search_text":"The documentation for the built-in functions can be found at https://docs.python.org/3/library/functions.html#built-in-functions , and the full documentation for pprint can be found at https://docs.python.org/3/library/pprint.html# .","text_count":233,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The documentation for the built-in functions can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/functions.html#built-in-functions"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/functions.html#built-in-functions"}]},{"block_type":"text","content":", and the full documentation for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pprint"}]},{"block_type":"text","content":"can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/pprint.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/pprint.html#"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8h7","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8h8","search_text":"The Improving your debugging skills recipe The Debugging through logging recipe ","text_count":80,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Improving your debugging skills"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Debugging through logging"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev8h9","search_text":"Debugging through logging","text_count":25,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Debugging through logging"}]},{"block_type":"element","block":"k67ev8ha","search_text":"Debugging is, after all, detecting what's going on inside our program and what unexpected or incorrect effects may be happening. A simple, yet very effective, approach is to output variables and other information at strategic parts of your code to follow the flow of the program.","text_count":279,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Debugging is, after all, detecting what's going on inside our program and what unexpected or incorrect effects may be happening. A simple, yet very effective, approach is to output variables and other information at strategic parts of your code to follow the flow of the program."}]},{"block_type":"element","block":"k67ev8hb","search_text":"The simplest form of this approach is called print debugging , or inserting print statements at certain points to print the value of variables or points while debugging.","text_count":169,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The simplest form of this approach is called"},{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"print debugging"}]},{"block_type":"text","content":", or inserting print statements at certain points to print the value of variables or points while debugging."}]},{"block_type":"element","block":"k67ev8hc","search_text":"But taking this technique a little bit further and combining it with the logging techniques presented in Chapter 2, Automating Tasks Made Easy allows us to create a semi-permanent trace of the execution of the program, which can be really useful when detecting issues in a running program.","text_count":289,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"But taking this technique a little bit further and combining it with the logging techniques presented in Chapter 2,&nbsp;"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Automating Tasks Made Easy"}]},{"block_type":"text","content":"allows us to create a semi-permanent trace of the execution of the program, which can be really useful when detecting issues in a running program."}]},{"block_type":"element","block":"k67ev8hd","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev8he","search_text":"Download the debug_logging.py file from GitHub: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_logging.py .","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debug_logging.py"}]},{"block_type":"text","content":"&nbsp;file from GitHub:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_logging.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_logging.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8hf","search_text":"It contains an implementation of the bubble sort algorithm ( https://www.studytonight.com/data-structures/bubble-sort ), which is the simplest way to sort a list of elements. It iterates several times over the list, and on each iteration, two adjacent values are checked and interchanged, so the bigger one is after the smaller. This makes the bigger values ascend like bubbles in the list.","text_count":390,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It contains an implementation of the bubble sort algorithm ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.studytonight.com/data-structures/bubble-sort"},"children":[{"block_type":"text","content":"https://www.studytonight.com/data-structures/bubble-sort"}]},{"block_type":"text","content":"), which is the simplest way to sort a list of elements. It iterates several times over the list, and on each iteration, two adjacent values are checked and interchanged, so the bigger one is after the smaller. This makes&nbsp;the bigger values ascend like bubbles in the list."}]},{"block_type":"element","block":"k67ev8hg","search_text":"Tip Bubble sort is a simple but naive way of implementing a sort, and there are better alternatives. Unless you have an extremely good reason not to, rely on the standard .sort method in lists. ","text_count":194,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Bubble sort is a simple but naive way of implementing a sort, and there are better alternatives. Unless you have an extremely good reason not to, rely on the standard&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":".sort"}]},{"block_type":"text","content":"method in lists."}]}]},{"block_type":"element","block":"k67ev8hh","search_text":"When run, it checks the following list to verify that it is correct:","text_count":68,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When run, it checks the following list to verify that it is correct:"}]},{"block_type":"element","block":"k67ev8hi","search_text":"assert [1, 2, 3, 4, 7, 10] == bubble_sort([3, 7, 10, 2, 4, 1])","text_count":62,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"assert [1, 2, 3, 4, 7, 10] == bubble_sort([3, 7, 10, 2, 4, 1])"}]}]},{"block_type":"element","block":"k67ev8hj","search_text":"We have a bug in this implementation, so we can fix it as part of the recipe!","text_count":77,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We have a bug in this implementation, so we can fix it as part of the recipe!"}]},{"block_type":"element","block":"k67ev8hk","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8hl","search_text":"Run the debug_logging.py script and check whether it fails: ","text_count":60,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debug_logging.py"}]},{"block_type":"text","content":"script and check whether it fails:"}]}]},{"block_type":"element","block":"k67ev8hm","search_text":"$ python debug_logging.py INFO:Sorting the list: [3, 7, 10, 2, 4, 1] INFO:Sorted list: [2, 3, 4, 7, 10, 1] Traceback (most recent call last): File \"debug_logging.py\", line 17, in <module> assert [1, 2, 3, 4, 7, 10] == bubble_sort([3, 7, 10, 2, 4, 1]) AssertionError","text_count":265,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_logging.py\nINFO:Sorting the list: [3, 7, 10, 2, 4, 1]\nINFO:Sorted list:      [2, 3, 4, 7, 10, 1]\nTraceback (most recent call last):\n  File \"debug_logging.py\", line 17, in &lt;module&gt;\n    assert [1, 2, 3, 4, 7, 10] == bubble_sort([3, 7, 10, 2, 4, 1])\nAssertionError"}]}]},{"block_type":"element","block":"k67ev8hn","search_text":"Enable the dubug logging, changing the second line of the debug_logging.py script: ","text_count":83,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Enable the dubug logging, changing the second line of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debug_logging.py"}]},{"block_type":"text","content":"script:&nbsp;"}]}]},{"block_type":"element","block":"k67ev8ho","search_text":"logging.basicConfig(format='%(levelname)s:%(message)s', level=logging.INFO)","text_count":75,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"logging.basicConfig(format='%(levelname)s:%(message)s', level=logging.INFO)"}]}]},{"block_type":"element","block":"k67ev8hp","search_text":"Change the preceding line to the following one:","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Change the preceding line to the following one:"}]},{"block_type":"element","block":"k67ev8hq","search_text":"logging.basicConfig(format='%(levelname)s:%(message)s', level=logging.DEBUG)","text_count":76,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"logging.basicConfig(format='%(levelname)s:%(message)s', level=logging.DEBUG)"}]}]},{"block_type":"element","block":"k67ev8hr","search_text":"Note the different level .","text_count":26,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note the different"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"level"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8hs","search_text":"Run the script again, with more information inside: ","text_count":52,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script again, with more information inside:"}]}]},{"block_type":"element","block":"k67ev8ht","search_text":"$ python debug_logging.py INFO:Sorting the list: [3, 7, 10, 2, 4, 1] DEBUG:alist: [3, 7, 10, 2, 4, 1] DEBUG:alist: [3, 7, 10, 2, 4, 1] DEBUG:alist: [3, 7, 2, 10, 4, 1] DEBUG:alist: [3, 7, 2, 4, 10, 1] DEBUG:alist: [3, 7, 2, 4, 10, 1] DEBUG:alist: [3, 2, 7, 4, 10, 1] DEBUG:alist: [3, 2, 4, 7, 10, 1] DEBUG:alist: [2, 3, 4, 7, 10, 1] DEBUG:alist: [2, 3, 4, 7, 10, 1] DEBUG:alist: [2, 3, 4, 7, 10, 1] INFO:Sorted list : [2, 3, 4, 7, 10, 1] Traceback (most recent call last): File \"debug_logging.py\", line 17, in <module> assert [1, 2, 3, 4, 7, 10] == bubble_sort([3, 7, 10, 2, 4, 1]) AssertionError","text_count":596,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_logging.py\nINFO:Sorting the list: [3, 7, 10, 2, 4, 1]\nDEBUG:alist: [3, 7, 10, 2, 4, 1]\nDEBUG:alist: [3, 7, 10, 2, 4, 1]\nDEBUG:alist: [3, 7, 2, 10, 4, 1]\nDEBUG:alist: [3, 7, 2, 4, 10, 1]\nDEBUG:alist: [3, 7, 2, 4, 10, 1]\nDEBUG:alist: [3, 2, 7, 4, 10, 1]\nDEBUG:alist: [3, 2, 4, 7, 10, 1]\nDEBUG:alist: [2, 3, 4, 7, 10, 1]\nDEBUG:alist: [2, 3, 4, 7, 10, 1]\nDEBUG:alist: [2, 3, 4, 7, 10, 1]\nINFO:Sorted list : [2, 3, 4, 7, 10, 1]\nTraceback (most recent call last):\n  File \"debug_logging.py\", line 17, in &lt;module&gt;\n    assert [1, 2, 3, 4, 7, 10] == bubble_sort([3, 7, 10, 2, 4, 1])\nAssertionError"}]}]},{"block_type":"element","block":"k67ev8hu","search_text":"After analyzing the output, we realize that the last element of the list is not sorted. We analyze the code and discover an off-by-one error in line 7. Do you see it? Let's fix it by changing the following line: ","text_count":212,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"After analyzing the output, we realize that the last element of the list is not sorted. We analyze the code and discover an off-by-one error in line 7. Do you see it? Let's fix it by changing the following line:"}]}]},{"block_type":"element","block":"k67ev8hv","search_text":"for passnum in reversed(range(len(alist) - 1)):","text_count":47,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"for passnum in reversed(range(len(alist) - 1)):"}]}]},{"block_type":"element","block":"k67ev8hw","search_text":"Change the preceding line to the following one:","text_count":47,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Change the preceding line to the following one:"}]},{"block_type":"element","block":"k67ev8hx","search_text":"for passnum in reversed(range(len(alist))):","text_count":43,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"for passnum in reversed(range(len(alist))):"}]}]},{"block_type":"element","block":"k67ev8hy","search_text":"(Notice the removal of the -1 operation.)","text_count":41,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"(Notice the removal of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"-1"}]},{"block_type":"text","content":"operation.)"}]},{"block_type":"element","block":"k67ev8hz","search_text":"Run it again and you will see that it works as expected. The debug logs are not displayed here: ","text_count":96,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"&nbsp;Run it again and&nbsp;you will see that it works as expected. The debug logs are not displayed here:&nbsp;"}]}]},{"block_type":"element","block":"k67ev8i0","search_text":"$ python debug_logging.py INFO:Sorting the list: [3, 7, 10, 2, 4, 1] ... INFO:Sorted list : [1, 2, 3, 4, 7, 10]","text_count":111,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_logging.py\nINFO:Sorting the list: [3, 7, 10, 2, 4, 1]\n...\nINFO:Sorted list     : [1, 2, 3, 4, 7, 10]"}]}]},{"block_type":"element","block":"k67ev8i1","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8i2","search_text":"Step 1 presents the script and shows that the code is faulty, as it's not properly sorting the list.","text_count":100,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 1 presents the script and shows that the code is faulty, as it's not properly sorting the list."}]},{"block_type":"element","block":"k67ev8i3","search_text":"The script already has some logs to show the start and end result, as well as some debug logs that show each intermediate step. In step 2, we activate the display of the DEBUG logs, as in step 1 only the INFO ones were shown.","text_count":225,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The script already has some logs to show the start and end result, as well as some debug logs that show each intermediate step. In step 2, we activate the display of the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"DEBUG"}]},{"block_type":"text","content":"logs, as in step 1 only the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"INFO"}]},{"block_type":"text","content":"ones were shown."}]},{"block_type":"element","block":"k67ev8i4","search_text":"Note Note that the logs are displayed by default in the standard error output. This is displayed by default in the Terminal. If you need to direct the logs somewhere else, such as a file, see how to configure a different handler. See the logging configuration in Python for more details: https://docs.python.org/3/howto/logging.html . ","text_count":335,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Note that the logs are displayed by default in the standard error output. This is displayed by default in the Terminal. If you need to direct the logs somewhere else, such as a file, see how to configure a different handler. See the logging configuration in Python for more details:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/howto/logging.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/howto/logging.html"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev8i5","search_text":"Step 3 runs the script again, this time displaying extra information, showing that the last element in the list is not sorted.","text_count":126,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 3 runs the script again, this time displaying extra information, showing that the last element in the list is not sorted."}]},{"block_type":"element","block":"k67ev8i6","search_text":"The bug is an off-by-one error, a very common kind of error, as it should iterate to the whole size of the list. This is fixed in step 4.","text_count":137,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The bug is an off-by-one error, a very common kind of error, as it should iterate to the whole size of the list. This is fixed in step 4."}]},{"block_type":"element","block":"k67ev8i7","search_text":"Note Check the code to understand why there's an error. The whole list should be compared, but we made the mistake of reducing the size by one. ","text_count":144,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check the code to understand why there's an error. The whole list should be compared, but we made the mistake of reducing the size by one."}]}]},{"block_type":"element","block":"k67ev8i8","search_text":"Step 5 shows that the fixed script runs correctly.","text_count":50,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 5 shows that the fixed script runs correctly."}]},{"block_type":"element","block":"k67ev8i9","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8ia","search_text":"In this recipe, we have strategically located the debug logs beforehand, but that may not be the case in a real-life debugging exercise. You may need to add more or change the location as part of the bug investigation.","text_count":218,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we have strategically located the debug logs beforehand, but that may not be the case in a real-life debugging exercise. You may need to add more or change the location as part of the bug investigation."}]},{"block_type":"element","block":"k67ev8ib","search_text":"The biggest advantage of this technique is that we're able to see the flow of the program, being able to inspect one moment of the code execution to another, and make sense of the flow. But the disadvantage is that we can end with a wall of text that doesn't provide specific information about our problem. You need to find a balance between too much and too little information.","text_count":378,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The biggest advantage of this technique is that we're able to see the flow of the program, being able to inspect one moment of the code execution to another, and make sense of the flow. But the disadvantage is that we can end with a wall of text that doesn't provide specific information about our problem. You need to find a balance between too much and too little information."}]},{"block_type":"element","block":"k67ev8ic","search_text":"For the same reason, try to limit very long variables unless they're necessary.","text_count":79,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For the same reason, try to limit very long variables unless they're necessary."}]},{"block_type":"element","block":"k67ev8id","search_text":"Remember to turn down the logging level after fixing the bug. It is likely that some logs that you discover to be irrelevant may need to be deleted.","text_count":148,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember to turn down the logging level after fixing the bug. It is likely that some logs that you discover to be irrelevant may need to be deleted."}]},{"block_type":"element","block":"k67ev8ie","search_text":"Tip The quick and dirty version of this technique is to add print statements instead of debug logs. While some people are resistant to this, it is actually a valuable technique to use for debug purposes. But remember to clean them up when you're done. ","text_count":252,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The quick and dirty version of this technique is to add print statements instead of debug logs. While some people are resistant to this, it is actually a valuable technique to use for debug purposes. But remember to clean them up when you're done."}]}]},{"block_type":"element","block":"k67ev8if","search_text":"All the introspection elements are available, so you can create logs that display, for example, all the attributes of a dir(object) object:","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"All the introspection elements are available, so you can create logs that display, for example, all the attributes of a&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"dir(object)"}]},{"block_type":"text","content":"object:"}]},{"block_type":"element","block":"k67ev8ig","search_text":"logging.debug(f'object {dir(object)}')","text_count":38,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"logging.debug(f'object {dir(object)}')"}]}]},{"block_type":"element","block":"k67ev8ih","search_text":"Anything that can be displayed as a string is able to be presented in a log, including any text manipulation.","text_count":109,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Anything that can be displayed as a string is able to be presented in a log, including any text manipulation."}]},{"block_type":"element","block":"k67ev8ii","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8ij","search_text":"The Learning Python interpreter basics recipe The Improving your debugging skills recipe ","text_count":89,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Learning Python interpreter basics"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Improving your debugging skills"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev8ik","search_text":"Debugging with breakpoints","text_count":26,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Debugging with breakpoints"}]},{"block_type":"element","block":"k67ev8il","search_text":"Python has a ready-to-go debugger called pdb . Given that Python code is interpreted, this means that stopping the execution of the code at any point is possible by setting a breakpoint, which will jump into a command line where any code can be used to analyze the situation and execute any number of instructions.","text_count":314,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Python has a ready-to-go debugger called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdb"}]},{"block_type":"text","content":". Given that Python code is interpreted, this means that stopping the execution of the code at any point is possible by setting a breakpoint, which will jump into a command line where any code can be used to analyze the situation and execute any number of instructions."}]},{"block_type":"element","block":"k67ev8im","search_text":"Let's see how to do it.","text_count":23,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Let's see how to do it."}]},{"block_type":"element","block":"k67ev8in","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev8io","search_text":"Download the debug_algorithm.py script, available from GitHub: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_algorithm.py .","text_count":167,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Download the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debug_algorithm.py"}]},{"block_type":"text","content":"&nbsp;script, available from GitHub:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_algorithm.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_algorithm.py"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8ip","search_text":"In the next section, we will analyze the execution of the code in detail. The code checks whether numbers follow certain properties:","text_count":132,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the next section, we will analyze the execution of the code in detail. The&nbsp;code&nbsp;checks whether numbers follow certain properties:"}]},{"block_type":"element","block":"k67ev8iq","search_text":"def valid(candidate): if candidate <= 1: return False lower = candidate - 1 while lower > 1: if candidate / lower == candidate // lower: return False lower -= 1 return True assert not valid(1) assert valid(3) assert not valid(15) assert not valid(18) assert not valid(50) assert valid(53)","text_count":288,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"def valid(candidate):\n    if candidate &lt;= 1:\n        return False\n\n    lower = candidate - 1\n    while lower &gt; 1:\n        if candidate / lower == candidate // lower:\n            return False\n        lower -= 1\n\n    return True\n\n\nassert not valid(1)\nassert valid(3)\nassert not valid(15)\nassert not valid(18)\nassert not valid(50)\nassert valid(53)"}]}]},{"block_type":"element","block":"k67ev8ir","search_text":"It is possible that you recognize what the code is doing, but bear with me so that we can analyze it interactively.","text_count":115,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It is possible that you recognize what the code is doing, but bear with me so that we can analyze it interactively."}]},{"block_type":"element","block":"k67ev8is","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8it","search_text":"Run the code to see all the assertions are valid: ","text_count":50,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code to see all the assertions are valid:"}]}]},{"block_type":"element","block":"k67ev8iu","search_text":"$ python debug_algorithm.py","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_algorithm.py"}]}]},{"block_type":"element","block":"k67ev8iv","search_text":"Add breakpoint() , after the while loop, just before line 7, resulting in the following: ","text_count":89,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Add&nbsp;&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint()"}]},{"block_type":"text","content":", after the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"while"}]},{"block_type":"text","content":"loop, just before line 7, resulting in&nbsp;the following:"}]}]},{"block_type":"element","block":"k67ev8iw","search_text":"while lower > 1: breakpoint() if candidate / lower == candidate // lower:","text_count":73,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"while lower &gt; 1:\n        breakpoint()\n        if candidate / lower == candidate // lower:"}]}]},{"block_type":"element","block":"k67ev8ix","search_text":"Execute the code again, and see that it stops at the breakpoint, entering into the interactive Pdb mode: ","text_count":105,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"&nbsp;Execute the code again, and see that it stops at the breakpoint, entering into the interactive"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"Pdb"}]},{"block_type":"text","content":"mode:"}]}]},{"block_type":"element","block":"k67ev8iy","search_text":"$ python debug_algorithm.py > .../debug_algorithm.py(8)valid() -> if candidate / lower == candidate // lower: (Pdb)","text_count":115,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_algorithm.py\n&gt; .../debug_algorithm.py(8)valid()\n-&gt; if candidate / lower == candidate // lower:\n(Pdb)"}]}]},{"block_type":"element","block":"k67ev8iz","search_text":"Check the value of the candidate and the two operations. This line is checking whether the dividing of candidate by lower is an integer (the float and integer division is the same): ","text_count":182,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Check the value of the candidate and the two operations. This line is checking whether the dividing of"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"candidate"}]},{"block_type":"text","content":"by"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"lower"}]},{"block_type":"text","content":"is an integer (the float and integer division is the same):"}]}]},{"block_type":"element","block":"k67ev8j0","search_text":"(Pdb) candidate 3 (Pdb) candidate / lower 1.5 (Pdb) candidate // lower 1","text_count":72,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) candidate\n3\n(Pdb) candidate / lower\n1.5\n(Pdb) candidate // lower\n1"}]}]},{"block_type":"element","block":"k67ev8j1","search_text":"Continue to the next instruction with n . See that it ends the while loop and returns True : ","text_count":93,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Continue to the next instruction with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"n"}]},{"block_type":"text","content":". See that it ends the while loop and returns"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"True"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8j2","search_text":"(Pdb) n > ...debug_algorithm.py(10)valid() -> lower -= 1 (Pdb) n > ...debug_algorithm.py(6)valid() -> while lower > 1: (Pdb) n > ...debug_algorithm.py(12)valid() -> return True (Pdb) n --Return-- > ...debug_algorithm.py(12)valid()->True -> return True","text_count":251,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) n\n&gt; ...debug_algorithm.py(10)valid()\n-&gt; lower -= 1\n(Pdb) n\n&gt; ...debug_algorithm.py(6)valid()\n-&gt; while lower &gt; 1:\n(Pdb) n\n&gt; ...debug_algorithm.py(12)valid()\n-&gt; return True\n(Pdb) n\n--Return--\n&gt; ...debug_algorithm.py(12)valid()-&gt;True\n-&gt; return True"}]}]},{"block_type":"element","block":"k67ev8j3","search_text":"Continue the execution until another breakpoint is found with c . Note that this is the next call to valid() , which has 15 as an input: ","text_count":137,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Continue the execution until another breakpoint is found with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"c"}]},{"block_type":"text","content":". Note that this is the next call to"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"valid()"}]},{"block_type":"text","content":", which has 15 as an input:"}]}]},{"block_type":"element","block":"k67ev8j4","search_text":"(Pdb) c > ...debug_algorithm.py(8)valid() -> if candidate / lower == candidate // lower: (Pdb) candidate 15 (Pdb) lower 14","text_count":122,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) c\n&gt; ...debug_algorithm.py(8)valid()\n-&gt; if candidate / lower == candidate // lower:\n(Pdb) candidate\n15\n(Pdb) lower\n14"}]}]},{"block_type":"element","block":"k67ev8j5","search_text":"Continue running and inspecting the numbers until what the valid function is doing makes sense. Are you able to find out what the code does? (If you can't, don't worry and check the next section.) When you're done, exit with q . This stops the execution: ","text_count":255,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Continue running and inspecting the numbers until what the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"valid"}]},{"block_type":"text","content":"function is doing makes sense. Are you able to find out what the code does?&nbsp;(If you can't, don't worry and check the next section.) When you're done, exit with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"q"}]},{"block_type":"text","content":". This stops the execution:"}]}]},{"block_type":"element","block":"k67ev8j6","search_text":"(Pdb) q ... bdb.BdbQuit","text_count":23,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) q\n...\nbdb.BdbQuit"}]}]},{"block_type":"element","block":"k67ev8j7","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8j8","search_text":"The code is, as you probably know already, checking whether a number is a prime number. It tries to divide the number by all integers lower than it. If at any point is divisible, it returns a False result, because it's not a prime.","text_count":231,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code is, as you probably know already, checking whether a number is a prime number. It tries to divide the number by all integers lower than it. If at any point is divisible,&nbsp;it returns a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"False"}]},{"block_type":"text","content":"result, because it's not a prime."}]},{"block_type":"element","block":"k67ev8j9","search_text":"Tip This is actually a very inefficient way of checking for a prime number, as it will take a very long time to deal with big numbers. It is fast enough for our teaching purposes, though. If you're interested in finding primes, you can take a look at math packages such as SymPy ( https://docs.sympy.org/latest/modules/ntheory.html?highlight=prime#sympy.ntheory.primetest.isprime ). ","text_count":383,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is actually a very inefficient way of checking for a prime number, as it will take a very long time to deal with big numbers. It is fast enough for our teaching purposes, though. If you're interested in finding primes, you can take a look at math packages such as SymPy ("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.sympy.org/latest/modules/ntheory.html?highlight=prime#sympy.ntheory.primetest.isprime"},"children":[{"block_type":"text","content":"https://docs.sympy.org/latest/modules/ntheory.html?highlight=prime#sympy.ntheory.primetest.isprime"}]},{"block_type":"text","content":")."}]}]},{"block_type":"element","block":"k67ev8ja","search_text":"After checking the general execution in step 1, in step 2, we introduced a breakpoint in the code.","text_count":98,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After checking the general execution in step 1, in step 2, we introduced a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"in the code."}]},{"block_type":"element","block":"k67ev8jb","search_text":"When the code is executed in step 3, it stops at the breakpoint position, entering into an interactive mode.","text_count":108,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When the code is executed in step 3, it stops at the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"position, entering into an interactive mode."}]},{"block_type":"element","block":"k67ev8jc","search_text":"In the interactive mode, we can inspect the values of any variable as well as perform any kind of operation. As demonstrated in step 4, sometimes, a line of code can be better analyzed by reproducing its parts.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In the interactive mode, we can inspect the values of any variable as well as perform any kind of operation. As demonstrated in step 4, sometimes, a line of code can be better analyzed by reproducing its parts."}]},{"block_type":"element","block":"k67ev8jd","search_text":"The code can be inspected and regular operations can be executed in the command line. The next line of code can be executed by calling n(ext) , as done in step 5 several times, to see the flow of the code.","text_count":205,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code can be inspected&nbsp;and regular operations can be executed in the command line. The next line of code can be executed by calling"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"n(ext)"}]},{"block_type":"text","content":", as done in step 5 several times, to see the flow of the code."}]},{"block_type":"element","block":"k67ev8je","search_text":"Step 6 shows how to resume the execution with the c(ontinue) command in order, to stop in the next breakpoint. All these operations can be iterated to see the flow and values, and to understand what the code is doing at any point.","text_count":230,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Step 6 shows how to resume the execution with the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"c(ontinue)"}]},{"block_type":"text","content":"&nbsp;command in order, to stop in the next breakpoint. All these operations can be iterated to see the flow and values, and to understand what the code is doing at any point."}]},{"block_type":"element","block":"k67ev8jf","search_text":"The execution can be stopped with q(uit) , as demonstrated in step 7.","text_count":69,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The execution can be stopped with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"q(uit)"}]},{"block_type":"text","content":", as demonstrated in step 7."}]},{"block_type":"element","block":"k67ev8jg","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8jh","search_text":"To see all the available operations, you can call h(elp) at any point.","text_count":70,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"To see all the available operations, you can call&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"h(elp)"}]},{"block_type":"text","content":"&nbsp;at any point."}]},{"block_type":"element","block":"k67ev8ji","search_text":"You can check the surrounding code at any point using the l(ist) command. For example, in step 4:","text_count":97,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can check&nbsp;the surrounding code at any point using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"l(ist)"}]},{"block_type":"text","content":"command. For example, in step 4:"}]},{"block_type":"element","block":"k67ev8jj","search_text":"(Pdb) l 3 return False 4 5 lower = candidate - 1 6 while lower > 1: 7 breakpoint() 8 -> if candidate / lower == candidate // lower: 9 return False 10 lower -= 1 11 12 return True","text_count":178,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) l\n  3   return False\n  4\n  5   lower = candidate - 1\n  6   while lower &gt; 1:\n  7     breakpoint()\n  8 -&gt;  if candidate / lower == candidate // lower:\n  9       return False\n 10     lower -= 1\n 11\n 12   return True"}]}]},{"block_type":"element","block":"k67ev8jk","search_text":"The other two main debugger commands are s(tep) , which will execute the next step, including entering a new call, and r(eturn) , which will return from the current function.","text_count":174,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The other two main debugger commands are"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"s(tep)"}]},{"block_type":"text","content":", which will execute the next step, including entering a new call, and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"r(eturn)"}]},{"block_type":"text","content":", which will return from the current function."}]},{"block_type":"element","block":"k67ev8jl","search_text":"Tip You can set up (and disable) more breakpoints using the pdb command b(reak) . You need to specify the file and line for the breakpoint, but it's actually more straightforward and less error-prone to just change the code and run it again. ","text_count":242,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can set up (and disable) more breakpoints using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdb"}]},{"block_type":"text","content":"command"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"b(reak)"}]},{"block_type":"text","content":". You need to specify the file and line for the breakpoint, but it's actually more straightforward and less error-prone to just change the code and run it again."}]}]},{"block_type":"element","block":"k67ev8jm","search_text":"You can overwrite variables as well as read them. Or create new variables. Or make extra calls. Or anything else you can imagine. The full power of the Python interpreter is at your service! Use it to check how something works or verify whether something is happening.","text_count":268,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can overwrite variables as well as read them. Or create new variables. Or make extra calls. Or anything else you can imagine. The full power of the Python interpreter is at your service! Use it to check how something works or verify&nbsp;whether something is happening."}]},{"block_type":"element","block":"k67ev8jn","search_text":"Tip Avoid creating variables with names that are reserved for the debugger, such as calling a list l . It will make things confusing and interfere when trying to debug, sometimes in non-obvious ways. ","text_count":200,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Avoid creating variables with names that are reserved for the debugger, such as calling a list"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"l"}]},{"block_type":"text","content":". It will make things confusing and interfere when trying to debug, sometimes in non-obvious ways."}]}]},{"block_type":"element","block":"k67ev8jo","search_text":"The breakpoint() function is new in Python 3.7, but it's highly recommended if you're using that version. In previous versions, you need to replace it with the following:","text_count":170,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint()"}]},{"block_type":"text","content":"function is new in Python 3.7, but it's highly recommended if you're using that version. In previous versions, you need to replace it with&nbsp;the following:"}]},{"block_type":"element","block":"k67ev8jp","search_text":"import pdb; pdb.set_trace()","text_count":27,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"import pdb; pdb.set_trace()"}]}]},{"block_type":"element","block":"k67ev8jq","search_text":"They work in exactly the same way. Note the two statements in the same line, which is not recommended in Python in general, but it's a great way of keeping the breakpoint in a single line.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"They work in exactly the same way. Note the two statements in the same line, which is not recommended in Python in general, but it's a great way of keeping the breakpoint in a single line."}]},{"block_type":"element","block":"k67ev8jr","search_text":"Note Remember to remove any breakpoints once debugging is done! Especially when committing to a version-control system such as Git. ","text_count":132,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Remember to remove any"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoints"}]},{"block_type":"text","content":"once&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debugging"}]},{"block_type":"text","content":"is done! Especially when committing to a version-control system such as Git."}]}]},{"block_type":"element","block":"k67ev8js","search_text":"You can read more about the new breakpoint call in the official PEP describing its usage at: https://www.python.org/dev/peps/pep-0553/ .","text_count":136,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"You can read more about the new"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"call in the official PEP describing its usage at:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.python.org/dev/peps/pep-0553/"},"children":[{"block_type":"text","content":"https://www.python.org/dev/peps/pep-0553/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8jt","search_text":"The full pdb documentation can be found here: https://docs.python.org/3.7/library/pdb.html#module-pdb . It includes all the debug commands.","text_count":139,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The full"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdb"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3.7/library/pdb.html#module-pdb"},"children":[{"block_type":"text","content":"https://docs.python.org/3.7/library/pdb.html#module-pdb"}]},{"block_type":"text","content":". It includes all the debug commands."}]},{"block_type":"element","block":"k67ev8ju","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8jv","search_text":"The Learning Python interpreter basics recipe The Improving your debugging skills recipe ","text_count":89,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Learning Python interpreter basics"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Improving your debugging skills"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev8jw","search_text":"Improving your debugging skills","text_count":31,"tag_name":"h2","attributes":{},"children":[{"block_type":"text","content":"Improving your debugging skills"}]},{"block_type":"element","block":"k67ev8jx","search_text":"In this recipe, we will analyze a small script that replicates a call to an external service, analyzing it and fixing some bugs. We will show different techniques to improve the debugging.","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In this recipe, we will analyze a small script that replicates a call to an&nbsp;external service, analyzing it and fixing some bugs. We will show different techniques to improve the debugging."}]},{"block_type":"element","block":"k67ev8jy","search_text":"The script will ping some personal names to an internet server ( httpbin.org , a test site) to get them back, simulating its retrieval from an external server. It will then split them into first and last name and prepare them to be sorted by surname. Finally, it will sort them.","text_count":278,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The script will ping some personal names to an internet server ("},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"httpbin.org"}]},{"block_type":"text","content":", a test site) to get them back, simulating its retrieval from an external server. It will then split them into first and last name and prepare them to be sorted by surname. Finally, it will sort them."}]},{"block_type":"element","block":"k67ev8jz","search_text":"The script contains several bugs that we will detect and fix.","text_count":61,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The script contains several bugs that we will detect and fix."}]},{"block_type":"element","block":"k67ev8k0","search_text":"Getting ready","text_count":13,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Getting ready"}]},{"block_type":"element","block":"k67ev8k1","search_text":"For this recipe, we will use the requests and parse modules and include them in our virtual environment:","text_count":104,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"For this recipe, we will use the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"&nbsp;modules and include them in our virtual environment:"}]},{"block_type":"element","block":"k67ev8k2","search_text":"$ echo \"requests==2.18.3\" >> requirements.txt $ echo \"parse==1.8.2\" >> requirements.txt $ pip install -r requirements.txt","text_count":121,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ echo \"requests==2.18.3\" &gt;&gt; requirements.txt\n$ echo \"parse==1.8.2\" &gt;&gt; requirements.txt\n$ pip install -r requirements.txt"}]}]},{"block_type":"element","block":"k67ev8k3","search_text":"The debug_skills.py script is available from GitHub: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_skills.py . Note that it contains bugs that we will fix as part of this recipe.","text_count":222,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"debug_skills.py"}]},{"block_type":"text","content":"&nbsp;script is available from GitHub:"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_skills.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_skills.py"}]},{"block_type":"text","content":". Note that it contains bugs that we will fix as part of this recipe."}]},{"block_type":"element","block":"k67ev8k4","search_text":"How to do it...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How to do it..."}]},{"block_type":"element","block":"k67ev8k5","search_text":"Run the script, which will generate an error: ","text_count":46,"tag_name":"ol","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script, which will generate an error:"}]}]},{"block_type":"element","block":"k67ev8k6","search_text":"$ python debug_skills.py Traceback (most recent call last): File \"debug_skills.py\", line 26, in <module> raise Exception(f'Error accessing server: {result}') Exception: Error accessing server: <Response [405]>","text_count":209,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills.py\nTraceback (most recent call last):\n File \"debug_skills.py\", line 26, in &lt;module&gt;\n raise Exception(f'Error accessing server: {result}')\nException: Error accessing server: &lt;Response [405]&gt;"}]}]},{"block_type":"element","block":"k67ev8k7","search_text":"Analyze the status code. We get 405, which means that the method we sent is not allowed. We inspect the code and realize that for the call in line 24, we used GET , when the proper one is POST (as described in the URL). Replace the code with the following: ","text_count":257,"tag_name":"ol","attributes":{"start":"2"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Analyze the status code. We get 405, which means that the method we sent is not allowed. We inspect the code and realize that for the call in line 24, we used"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":", when the proper one is"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":"(as described in the URL). Replace the code&nbsp;with the following:"}]}]},{"block_type":"element","block":"k67ev8k8","search_text":"# ERROR Step 2. Using .get when it should be .post # (old) result = requests.get('http://httpbin.org/post', json=data) result = requests.post('http://httpbin.org/post', json=data)","text_count":179,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# ERROR Step 2. Using .get when it should be .post\n# (old) result = requests.get('http://httpbin.org/post', json=data)\nresult = requests.post('http://httpbin.org/post', json=data)"}]}]},{"block_type":"element","block":"k67ev8k9","search_text":"We keep the old buggy code commented with (old) for clarity of changes.","text_count":71,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We keep the old buggy code commented with&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"(old)"}]},{"block_type":"text","content":"for clarity of changes."}]},{"block_type":"element","block":"k67ev8ka","search_text":"Run the code again, which will produce a different error: ","text_count":58,"tag_name":"ol","attributes":{"start":"3"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code again, which will produce a different error:"}]}]},{"block_type":"element","block":"k67ev8kb","search_text":"$ python debug_skills.py Traceback (most recent call last): File \"debug_skills_solved.py\", line 34, in <module> first_name, last_name = full_name.split() ValueError: too many values to unpack (expected 2)","text_count":204,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills.py\nTraceback (most recent call last):\n  File \"debug_skills_solved.py\", line 34, in &lt;module&gt;\n    first_name, last_name = full_name.split()\nValueError: too many values to unpack (expected 2)"}]}]},{"block_type":"element","block":"k67ev8kc","search_text":"Insert a breakpoint in line 33, one preceding the error. Run it again and enter into debugging mode: ","text_count":101,"tag_name":"ol","attributes":{"start":"4"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Insert a breakpoint in line 33, one preceding the error. Run it again and enter into debugging mode:"}]}]},{"block_type":"element","block":"k67ev8kd","search_text":"$ python debug_skills_solved.py ..debug_skills.py(35)<module>() -> first_name, last_name = full_name.split() (Pdb) n > ...debug_skills.py(36)<module>() -> ready_name = f'{last_name}, {first_name}' (Pdb) c > ...debug_skills.py(34)<module>() -> breakpoint()","text_count":255,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills_solved.py\n..debug_skills.py(35)&lt;module&gt;()\n-&gt; first_name, last_name = full_name.split()\n(Pdb) n\n&gt; ...debug_skills.py(36)&lt;module&gt;()\n-&gt; ready_name = f'{last_name}, {first_name}'\n(Pdb) c\n&gt; ...debug_skills.py(34)&lt;module&gt;()\n-&gt; breakpoint()"}]}]},{"block_type":"element","block":"k67ev8ke","search_text":"Running n does not produce an error, meaning that it's not the first value. After a few runs on c , we realize that this is not the correct approach, as we don't know what input is the one generating the error.","text_count":210,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Running&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"n"}]},{"block_type":"text","content":"&nbsp;does not produce an error, meaning that it's not the first value. After a few runs on"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"&nbsp;c"}]},{"block_type":"text","content":", we realize that this is not the correct approach, as we don't know what input is the one generating the error."}]},{"block_type":"element","block":"k67ev8kf","search_text":"Instead, we wrap the line with a try...except block and produce a breakpoint at that point: ","text_count":92,"tag_name":"ol","attributes":{"start":"5"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Instead, we wrap the line with a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"try...except"}]},{"block_type":"text","content":"block and produce a breakpoint at that point:"}]}]},{"block_type":"element","block":"k67ev8kg","search_text":"try: first_name, last_name = full_name.split() except: breakpoint()","text_count":67,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"try:\n        first_name, last_name = full_name.split()\n    except:\n        breakpoint()"}]}]},{"block_type":"element","block":"k67ev8kh","search_text":"We run the code again. This time the code stops at the moment the data produced an error: ","text_count":90,"tag_name":"ol","attributes":{"start":"6"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We run the code again. This time the code stops at the moment the data produced an error:"}]}]},{"block_type":"element","block":"k67ev8ki","search_text":"$ python debug_skills.py > ...debug_skills.py(38)<module>() -> ready_name = f'{last_name}, {first_name}' (Pdb) full_name 'John Paul Smith'","text_count":138,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills.py\n&gt; ...debug_skills.py(38)&lt;module&gt;()\n-&gt; ready_name = f'{last_name}, {first_name}'\n(Pdb) full_name\n'John Paul Smith'"}]}]},{"block_type":"element","block":"k67ev8kj","search_text":"The cause is now clear, line 35 only allows us to split two words, but raises an error if a middle name is added. After some testing, we settle into this line to fix it: ","text_count":170,"tag_name":"ol","attributes":{"start":"7"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The cause is now clear, line 35 only allows us to split two words, but raises an error if a middle name is added. After some testing, we settle into this line to fix it:"}]}]},{"block_type":"element","block":"k67ev8kk","search_text":"# ERROR Step 6 split only two words. Some names has middle names # (old) first_name, last_name = full_name.split() first_name, last_name = full_name.rsplit(maxsplit=1)","text_count":167,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# ERROR Step 6 split only two words. Some names has middle names\n    # (old) first_name, last_name = full_name.split()\n    first_name, last_name = full_name.rsplit(maxsplit=1)"}]}]},{"block_type":"element","block":"k67ev8kl","search_text":"We run the script again. Be sure to remove the breakpoint and try..except block. This time, it generates a list of names! And they are sorted alphabetically by surname. However, a few of the names look incorrect: ","text_count":213,"tag_name":"ol","attributes":{"start":"8"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"We run the script again. Be sure to remove the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"and"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"try..except"}]},{"block_type":"text","content":"block.&nbsp;This time, it generates a list of names! And they are sorted alphabetically by surname. However, a few of the names look incorrect:"}]}]},{"block_type":"element","block":"k67ev8km","search_text":"$ python debug_skills_solved.py ['Berg, Keagan', 'Cordova, Mai', 'Craig, Michael', 'Garc\\\\u00eda, Roc\\\\u00edo', 'Mccabe, Fathima', \"O'Carroll, S\\\\u00e9amus\", 'Pate, Poppy-Mae', 'Rennie, Vivienne', 'Smith, John Paul', 'Smyth, John', 'Sullivan, Roman']","text_count":250,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills_solved.py\n['Berg, Keagan', 'Cordova, Mai', 'Craig, Michael', 'Garc\\\\u00eda, Roc\\\\u00edo', 'Mccabe, Fathima', \"O'Carroll, S\\\\u00e9amus\", 'Pate, Poppy-Mae', 'Rennie, Vivienne', 'Smith, John Paul', 'Smyth, John', 'Sullivan, Roman']"}]}]},{"block_type":"element","block":"k67ev8kn","search_text":"Who's called O'Carroll, S\\\\u00e9amus ?","text_count":38,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Who's called&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"O'Carroll, S\\\\u00e9amus"}]},{"block_type":"text","content":"?"}]},{"block_type":"element","block":"k67ev8ko","search_text":"To analyse this particular case, but skip the rest, we must create an if condition to break only for that name in line 33. Notice the in to avoid having to be totally correct: ","text_count":176,"tag_name":"ol","attributes":{"start":"9"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"To analyse this particular case, but skip the rest, we must create an"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"if"}]},{"block_type":"text","content":"condition to break only for that name in line 33. Notice the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"in"}]},{"block_type":"text","content":"to avoid having to be totally correct:"}]}]},{"block_type":"element","block":"k67ev8kp","search_text":"full_name = parse.search('\"custname\": \"{name}\"', raw_result)['name'] if \"O'Carroll\" in full_name: breakpoint()","text_count":110,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"full_name = parse.search('\"custname\": \"{name}\"', raw_result)['name']\n    if \"O'Carroll\" in full_name:\n        breakpoint()"}]}]},{"block_type":"element","block":"k67ev8kq","search_text":"Run the script once more. The breakpoint stops at the proper moment: ","text_count":69,"tag_name":"ol","attributes":{"start":"10"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the script once more. The breakpoint stops at the proper moment:"}]}]},{"block_type":"element","block":"k67ev8kr","search_text":"$ python debug_skills.py > debug_skills.py(38)<module>() -> first_name, last_name = full_name.rsplit(maxsplit=1) (Pdb) full_name \"S\\\\u00e9amus O'Carroll\"","text_count":153,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills.py\n&gt; debug_skills.py(38)&lt;module&gt;()\n-&gt; first_name, last_name = full_name.rsplit(maxsplit=1)\n(Pdb) full_name\n\"S\\\\u00e9amus O'Carroll\""}]}]},{"block_type":"element","block":"k67ev8ks","search_text":"Move upward in the code and check the different variables: ","text_count":59,"tag_name":"ol","attributes":{"start":"11"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Move upward in the code and check the different variables:"}]}]},{"block_type":"element","block":"k67ev8kt","search_text":"(Pdb) full_name \"S\\\\u00e9amus O'Carroll\" (Pdb) raw_result '{\"custname\": \"S\\\\u00e9amus O\\'Carroll\"}' (Pdb) result.json() {'args': {}, 'data': '{\"custname\": \"S\\\\u00e9amus O\\'Carroll\"}', 'files': {}, 'form': {}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Content-Length': '37', 'Content-Type': 'application/json', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.18.3'}, 'json': {'custname': \"Séamus O'Carroll\"}, 'origin': '89.100.17.159', 'url': 'http://httpbin.org/post'}","text_count":523,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) full_name\n\"S\\\\u00e9amus O'Carroll\"\n(Pdb) raw_result\n'{\"custname\": \"S\\\\u00e9amus O\\'Carroll\"}'\n(Pdb) result.json()\n{'args': {}, 'data': '{\"custname\": \"S\\\\u00e9amus O\\'Carroll\"}', 'files': {}, 'form': {}, 'headers': {'Accept': '*/*', 'Accept-Encoding': 'gzip, deflate', 'Connection': 'close', 'Content-Length': '37', 'Content-Type': 'application/json', 'Host': 'httpbin.org', 'User-Agent': 'python-requests/2.18.3'}, 'json': {'custname': \"S&eacute;amus O'Carroll\"}, 'origin': '89.100.17.159', 'url': 'http://httpbin.org/post'}"}]}]},{"block_type":"element","block":"k67ev8ku","search_text":"In the result.json() dictionary, there's actually a different field that seems to be rendering the name properly, which is called 'json' . Let's look at it in detail; we can see that it's a dictionary: ","text_count":202,"tag_name":"ol","attributes":{"start":"12"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"In the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"result.json()"}]},{"block_type":"text","content":"dictionary, there's actually a different field that seems to be rendering the name properly, which is called"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'json'"}]},{"block_type":"text","content":". Let's look at it in detail; we can see that it's a dictionary:"}]}]},{"block_type":"element","block":"k67ev8kv","search_text":"(Pdb) result.json()['json'] {'custname': \"Séamus O'Carroll\"} (Pdb) type(result.json()['json']) <class 'dict'>","text_count":109,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"(Pdb) result.json()['json']\n{'custname': \"S&eacute;amus O'Carroll\"}\n(Pdb) type(result.json()['json'])\n&lt;class 'dict'&gt;"}]}]},{"block_type":"element","block":"k67ev8kw","search_text":"Change the code, instead of parsing the raw value in 'data' , use directly the 'json' field from the result. This simplifies the code, which is great! ","text_count":151,"tag_name":"ol","attributes":{"start":"13"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Change the code, instead of parsing the raw value in"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'data'"}]},{"block_type":"text","content":", use directly the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'json'"}]},{"block_type":"text","content":"field from the result. This&nbsp; simplifies the code, which is great!"}]}]},{"block_type":"element","block":"k67ev8kx","search_text":"# ERROR Step 11. Obtain the value from a raw value. Use # the decoded JSON instead # raw_result = result.json()['data'] # Extract the name from the result # full_name = parse.search('\"custname\": \"{name}\"', raw_result)['name'] raw_result = result.json()['json'] full_name = raw_result['custname']","text_count":295,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"# ERROR Step 11. Obtain the value from a raw value. Use\n    # the decoded JSON instead\n    # raw_result = result.json()['data']\n    # Extract the name from the result\n    # full_name = parse.search('\"custname\": \"{name}\"', raw_result)['name']\n    raw_result = result.json()['json']\n    full_name = raw_result['custname']"}]}]},{"block_type":"element","block":"k67ev8ky","search_text":"Run the code again. Remember to remove the breakpoint : ","text_count":56,"tag_name":"ol","attributes":{"start":"14"},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"Run the code again. Remember to remove the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8kz","search_text":"$ python debug_skills.py ['Berg, Keagan', 'Cordova, Mai', 'Craig, Michael', 'García, Rocío', 'Mccabe, Fathima', \"O'Carroll, Séamus\", 'Pate, Poppy-Mae', 'Rennie, Vivienne', 'Smith, John Paul', 'Smyth, John', 'Sullivan, Roman']","text_count":225,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ python debug_skills.py\n['Berg, Keagan', 'Cordova, Mai', 'Craig, Michael', 'Garc&iacute;a, Roc&iacute;o', 'Mccabe, Fathima', \"O'Carroll, S&eacute;amus\", 'Pate, Poppy-Mae', 'Rennie, Vivienne', 'Smith, John Paul', 'Smyth, John', 'Sullivan, Roman']"}]}]},{"block_type":"element","block":"k67ev8l0","search_text":"This time, it's all correct! You have successfully debugged the program!","text_count":72,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This time, it's all correct! You have successfully debugged the program!"}]},{"block_type":"element","block":"k67ev8l1","search_text":"How it works...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"How it works..."}]},{"block_type":"element","block":"k67ev8l2","search_text":"The structure of the recipe is divided into three different problems. Let's analyze it in small blocks:","text_count":103,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The structure of the recipe is divided into three different problems. Let's analyze it in small blocks:"}]},{"block_type":"element","block":"k67ev8l3","search_text":"First error—Wrong call to the external service : ","text_count":49,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"First error&mdash;Wrong call to the external service"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8l4","search_text":"After showing the first error in step 1, we read with care the resulting error, saying that the server is returning a 405 status code. This corresponds to a method not allowed, indicating that our calling method is not correct.","text_count":227,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"After showing the first error in step 1, we read with care the resulting error, saying that the server is returning a 405 status code. This corresponds to a&nbsp;method not allowed, indicating that our calling method is not correct."}]},{"block_type":"element","block":"k67ev8l5","search_text":"Inspect the following line:","text_count":27,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Inspect the following line:"}]},{"block_type":"element","block":"k67ev8l6","search_text":"result = requests.get('http://httpbin.org/post', json=data)","text_count":59,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"result = requests.get('http://httpbin.org/post', json=data)"}]}]},{"block_type":"element","block":"k67ev8l7","search_text":"It gives us the indication that we are using a GET call to one URL that's defined for POST , so we make the change in step 2.","text_count":125,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It gives us the indication that we are using a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"GET"}]},{"block_type":"text","content":"call to one URL that's defined for"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"POST"}]},{"block_type":"text","content":", so we make the change in step 2."}]},{"block_type":"element","block":"k67ev8l8","search_text":"Tip Notice that there has been no extra debugging steps as such in this error, but a careful reading of the error message and the code. Remember to pay attention to error messages and logs. Often, this is enough to discover the issue. ","text_count":235,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Notice that there has been no extra debugging steps as such in this error, but a careful reading of the error message and the code. Remember to pay attention to error messages and logs. Often, this is enough to discover the issue."}]}]},{"block_type":"element","block":"k67ev8l9","search_text":"We run the code in step 3 to find the next problem.","text_count":51,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We run the code in step 3 to find the next problem."}]},{"block_type":"element","block":"k67ev8la","search_text":"Second error—Wrong handling of middle names : ","text_count":46,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Second error&mdash;Wrong handling of middle names"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8lb","search_text":"In step 3, we get an error of too many values to unpack. We create a breakpoint to analyze the data in step 4 at this point, but discover that not all the data produces this error. The analysis done in step 4 shows that it may be very confusing to stop the execution when an error is not produced, having to continue until it does. We know that the error is produced at this point, but only for certain kind of data.","text_count":416,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 3, we get an error of too many values to unpack. We create a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"to analyze the data in step 4 at this point, but discover that not all the data produces this error. The analysis done in step 4 shows that it may be very confusing to stop the execution when an error is not produced, having to continue until it does. We know that the error is produced at this point, but only for certain kind of data."}]},{"block_type":"element","block":"k67ev8lc","search_text":"As we know that the error is being produced at some point, we capture it in a try..except block in step 5. When the exception is produced, we trigger the breakpoint .","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"As we know that the error is being produced at some point, we capture it in a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"try..except"}]},{"block_type":"text","content":"block in step 5. When the exception is produced, we trigger the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8ld","search_text":"This makes step 6 execution of the script to stop when the full_name is 'John Paul Smith' . This produces an error as the split expects two elements, not three.","text_count":160,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This makes step 6 execution of the script to stop when the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"full_name"}]},{"block_type":"text","content":"is&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"'John Paul Smith'"}]},{"block_type":"text","content":". This produces an error as the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"split"}]},{"block_type":"text","content":"expects two elements, not three."}]},{"block_type":"element","block":"k67ev8le","search_text":"This is fixed in step 7, allowing everything except the last word to be part of the first name, grouping any middle name(s) into the first element. This fits our purpose for this program, to sort by last name.","text_count":209,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This is fixed in step 7, allowing everything except the last word to be part of the first name, grouping any middle name(s) into the first element. This fits our purpose for this program, to sort by last name."}]},{"block_type":"element","block":"k67ev8lf","search_text":"Tip Names are actually quite complex to handle. Check out this article if you want to be delighted with the great amount of wrong assumptions one can make regarding names: https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/ . ","text_count":255,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Names are actually quite complex to handle. Check out this article if you want to be delighted with the great amount of wrong assumptions one can make regarding names:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/"},"children":[{"block_type":"text","content":"https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/"}]},{"block_type":"text","content":"."}]}]},{"block_type":"element","block":"k67ev8lg","search_text":"The following line does that with rsplit :","text_count":42,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The following line does that with"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"rsplit"}]},{"block_type":"text","content":":"}]},{"block_type":"element","block":"k67ev8lh","search_text":"first_name, last_name = full_name.rsplit(maxsplit=1)","text_count":52,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"first_name, last_name = full_name.rsplit(maxsplit=1)"}]}]},{"block_type":"element","block":"k67ev8li","search_text":"It divides the text by words, starting from the right and making a maximum of one split, guaranteeing that only two elements will be returned.","text_count":142,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"It divides the text by words, starting from the right and making a maximum of one split, guaranteeing that only two elements will be returned."}]},{"block_type":"element","block":"k67ev8lj","search_text":"When the code is changed, step 8 runs the code again to discover the next error.","text_count":80,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"When the code is changed, step 8 runs the code again to discover the next error."}]},{"block_type":"element","block":"k67ev8lk","search_text":"Third error—Using a wrong returned value by the external service : ","text_count":67,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"strong","attributes":{},"children":[{"block_type":"text","content":"Third error&mdash;Using a wrong returned value by the external service"}]},{"block_type":"text","content":":"}]}]},{"block_type":"element","block":"k67ev8ll","search_text":"Running the code in step 8 displays the list and does not produce any errors. But, examining the results, we can see that some of the names are incorrectly processed.","text_count":166,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Running the code in step 8 displays the list and does not produce any errors. But, examining the results, we can see that some of the names are incorrectly processed."}]},{"block_type":"element","block":"k67ev8lm","search_text":"We pick one of the examples in step 9 and create a conditional breakpoint. We only activate the breakpoint if the data fulfills the if condition.","text_count":145,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We pick one of the examples in step 9 and create a conditional breakpoint. We only activate the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint"}]},{"block_type":"text","content":"if the data fulfills the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"if"}]},{"block_type":"text","content":"condition."}]},{"block_type":"element","block":"k67ev8ln","search_text":"Note The if condition in this case stops at any time the \"O'Carroll\" string appears, not having to make it stricter with an equal statement. Be pragmatic about this code, as you'll need to remove it after the bug is fixed anyway. ","text_count":230,"tag_name":"div","attributes":{"class":"box note"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Note"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"if"}]},{"block_type":"text","content":"condition in this case stops at any time the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"\"O'Carroll\""}]},{"block_type":"text","content":"&nbsp;string appears, not having to make it stricter with an equal statement. Be pragmatic about this code, as you'll need to remove it after the bug is fixed anyway."}]}]},{"block_type":"element","block":"k67ev8lo","search_text":"The code is run again in step 10. From there, once validated that the data is as expected, we worked backward to find the root of the problem. Step 11 analyzes previous values and the code up to that point, trying to find out what lead to the incorrect value.","text_count":259,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The code is run again in step 10. From there, once validated that the data is as expected, we worked"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"backward"}]},{"block_type":"text","content":"&nbsp;to find the root of the problem. Step 11 analyzes previous values and the code up to that point, trying to find out what lead to the incorrect value."}]},{"block_type":"element","block":"k67ev8lp","search_text":"We then discover that we used the wrong field in the returned value from the result from the server. The value in the json field is better for this task and it's already parsed for us. Step 12 checks the value and sees how it should be used.","text_count":241,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"We then discover that we used the wrong field in the returned value from the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"result"}]},{"block_type":"text","content":"from the server. The value in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"json"}]},{"block_type":"text","content":"field is better for this task and it's already parsed for us. Step 12 checks the value and sees how it should be used."}]},{"block_type":"element","block":"k67ev8lq","search_text":"In step 13, we change the code to adjust. Notice that the parse module is no longer needed and that the code is actually cleaner using the json field.","text_count":150,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"In step 13, we change the code to adjust. Notice that the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"module is no longer needed and that the code is actually cleaner using the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"json"}]},{"block_type":"text","content":"field."}]},{"block_type":"element","block":"k67ev8lr","search_text":"Tip This result is actually more common than it looks, especially when dealing with external interfaces. We may use it in a way that works, but maybe it's not the best. Take a little bit of time to read the documentation and keep an eye on improvements and learn how to better use the tools. ","text_count":292,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This result is actually more common than it looks, especially when dealing with external interfaces. We may use it in a way that works, but maybe it's not the best. Take a little bit of time to read the documentation and keep an eye on improvements and learn how to better use the tools."}]}]},{"block_type":"element","block":"k67ev8ls","search_text":"Once this is fixed, the code is run again in step 14. Finally, the code is doing what's expected, sorting the names alphabetically by surname. Notice that the other name that contained strange characters is fixed as well.","text_count":221,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Once this is fixed, the code is run again in step 14. Finally, the code is doing what's expected, sorting the names alphabetically by surname. Notice that the other name that contained strange characters is fixed as well."}]},{"block_type":"element","block":"k67ev8lt","search_text":"There's more...","text_count":15,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"There's more..."}]},{"block_type":"element","block":"k67ev8lu","search_text":"The fixed script is available from GitHub: https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_skills_fixed.py . You can download it and see the differences.","text_count":195,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The fixed script is available from GitHub:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_skills_fixed.py"},"children":[{"block_type":"text","content":"https://github.com/PacktPublishing/Python-Automation-Cookbook/blob/master/Chapter10/debug_skills_fixed.py"}]},{"block_type":"text","content":". You can download it and see the differences."}]},{"block_type":"element","block":"k67ev8lv","search_text":"There are other ways of creating conditional breakpoints. There's actually support from the debugger to create breakpoints that stop, but only if some conditions are met. When possible, we find it easier to work directly with code, as it is persistent between runs and easier to remember and operate. You can check how to create it in the Python pdb documentation: https://docs.python.org/3/library/pdb.html#pdbcommand-break .","text_count":426,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are other ways of creating conditional breakpoints. There's actually support from the debugger to create breakpoints that stop, but only if some conditions are met. When possible, we find it easier to work directly with code, as it is persistent between runs and easier to remember and operate. You can check how to create it in the Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdb"}]},{"block_type":"text","content":"documentation:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/pdb.html#pdbcommand-break"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/pdb.html#pdbcommand-break"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8lw","search_text":"The kind of breakpoint catching an exception shown in the first error is a demonstration of how making conditions in code is straightforward. Just be careful to remove them afterwards!","text_count":184,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The kind of breakpoint catching an exception shown in the first error is a demonstration of how making conditions in code is straightforward. Just be careful to remove them afterwards!"}]},{"block_type":"element","block":"k67ev8lx","search_text":"There are other debuggers available that have an increased set of features. For example:","text_count":88,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are other debuggers available that have an increased set of features. For example:"}]},{"block_type":"element","block":"k67ev8ly","search_text":"ipdb ( https://github.com/gotcha/ipdb ): Adds tab completion and syntax highlights pudb ( https://documen.tician.de/pudb/ ): Displays an old-style, semi-graphical, text-based interface, in the style of early 90s tools that display the environment variables automatically web-pdb ( https://pypi.org/project/web-pdb/ ): Opens a web server to access a graphic interface with the debugger ","text_count":385,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ipdb"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/gotcha/ipdb"},"children":[{"block_type":"text","content":"https://github.com/gotcha/ipdb"}]},{"block_type":"text","content":"): Adds tab completion and syntax highlights"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pudb"}]},{"block_type":"text","content":"("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://documen.tician.de/pudb/"},"children":[{"block_type":"text","content":"https://documen.tician.de/pudb/"}]},{"block_type":"text","content":"): Displays an old-style, semi-graphical, text-based interface, in the style of early 90s tools that display the environment variables automatically"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"web-pdb"}]},{"block_type":"text","content":"&nbsp;("},{"block_type":"element","tag_name":"a","attributes":{"href":"https://pypi.org/project/web-pdb/"},"children":[{"block_type":"text","content":"https://pypi.org/project/web-pdb/"}]},{"block_type":"text","content":"): Opens a web server to access a graphic interface with the debugger"}]}]},{"block_type":"element","block":"k67ev8lz","search_text":"Check their documentations to know how to install them and run them. ","text_count":69,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Check their documentations to know how to install them and run them.&nbsp;"}]},{"block_type":"element","block":"k67ev8m0","search_text":"Tip There are more debuggers available, a search on the internet will give you more options, including Python IDEs. In any case, be aware of adding dependencies. It is always good to be able to use the default debugger. ","text_count":220,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"There are more debuggers available, a search on the internet will give you more options, including Python IDEs. In any case, be aware of adding dependencies. It is always good to be able to use the default debugger."}]}]},{"block_type":"element","block":"k67ev8m1","search_text":"The new breakpoint commands in Python 3.7 allow us to change easily between debuggers using the PYTHONBREAKPOINT environment variable. For example:","text_count":147,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The new breakpoint commands in Python 3.7 allow us to change easily between debuggers using the&nbsp;"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PYTHONBREAKPOINT"}]},{"block_type":"text","content":"environment variable. For example:"}]},{"block_type":"element","block":"k67ev8m2","search_text":"$ PYTHONBREAKPOINT=ipdb.set_trace python my_script.py","text_count":53,"tag_name":"pre","attributes":{},"children":[{"block_type":"element","tag_name":"code","attributes":{"language":"python"},"children":[{"block_type":"text","content":"$ PYTHONBREAKPOINT=ipdb.set_trace python my_script.py"}]}]},{"block_type":"element","block":"k67ev8m3","search_text":"This starts ipdb on any breakpoint in the code. You can see more about this in the breakpoint() documentation can be found: https://www.python.org/dev/peps/pep-0553/#environment-variable .","text_count":188,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"This starts"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"ipdb"}]},{"block_type":"text","content":"on any breakpoint in the code. You can see more about this in the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint()"}]},{"block_type":"text","content":"documentation&nbsp;can be found:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://www.python.org/dev/peps/pep-0553/#environment-variable"},"children":[{"block_type":"text","content":"https://www.python.org/dev/peps/pep-0553/#environment-variable"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8m4","search_text":"Tip An important effect on this is to disable all breakpoints by setting PYTHONBREAKPOINT=0 , which is a great tool to ensure that code in production is never interrupted by a breakpoint() left by mistake. ","text_count":206,"tag_name":"div","attributes":{"class":"box tip"},"children":[{"block_type":"element","tag_name":"h4","attributes":{},"children":[{"block_type":"text","content":"Tip"}]},{"block_type":"element","tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"An important effect on this is to disable all breakpoints by setting"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"PYTHONBREAKPOINT=0"}]},{"block_type":"text","content":", which is a great tool to ensure that code in production is never interrupted by a"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"breakpoint()"}]},{"block_type":"text","content":"left by mistake."}]}]},{"block_type":"element","block":"k67ev8m5","search_text":"The Python pdb documentation can be found here: https://docs.python.org/3/library/pdb.html The whole documentation of the parse module can be found at https://github.com/r1chardj0n3s/parse and the whole requests documentation at http://docs.python-requests.org/en/master/ .","text_count":273,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"The Python"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"pdb"}]},{"block_type":"text","content":"documentation can be found here:&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://docs.python.org/3/library/pdb.html"},"children":[{"block_type":"text","content":"https://docs.python.org/3/library/pdb.html"}]},{"block_type":"text","content":"The whole documentation of the"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"parse"}]},{"block_type":"text","content":"module can be found at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"https://github.com/r1chardj0n3s/parse"},"children":[{"block_type":"text","content":"https://github.com/r1chardj0n3s/parse"}]},{"block_type":"text","content":"&nbsp;and the whole"},{"block_type":"element","tag_name":"kbd","attributes":{},"children":[{"block_type":"text","content":"requests"}]},{"block_type":"text","content":"documentation at&nbsp;"},{"block_type":"element","tag_name":"a","attributes":{"href":"http://docs.python-requests.org/en/master/"},"children":[{"block_type":"text","content":"http://docs.python-requests.org/en/master/"}]},{"block_type":"text","content":"."}]},{"block_type":"element","block":"k67ev8m6","search_text":"See also","text_count":8,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"See also"}]},{"block_type":"element","block":"k67ev8m7","search_text":"The Learning Python interpreter basics recipe The Debugging with breakpoints recipe ","text_count":84,"tag_name":"ul","attributes":{},"children":[{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Learning Python interpreter basics"}]},{"block_type":"text","content":"recipe"}]},{"block_type":"element","tag_name":"li","attributes":{},"children":[{"block_type":"text","content":"The"},{"block_type":"element","tag_name":"em","attributes":{},"children":[{"block_type":"text","content":"Debugging with breakpoints"}]},{"block_type":"text","content":"recipe"}]}]},{"block_type":"element","block":"k67ev8m8","search_text":"Leave a review - let other readers know what you think","text_count":54,"tag_name":"h3","attributes":{},"children":[{"block_type":"text","content":"Leave a review - let other readers know what you think"}]},{"block_type":"element","block":"k67ev8m9","search_text":"Please share your thoughts on this book with others by leaving a review on the site that you bought it from. If you purchased the book from Amazon, please leave us an honest review on this book's Amazon page. This is vital so that other potential readers can see and use your unbiased opinion to make purchasing decisions, we can understand what our customers think about our products, and our authors can see your feedback on the title that they have worked with Packt to create. It will only take a few minutes of your time, but is valuable to other potential customers, our authors, and Packt. Thank you!","text_count":607,"tag_name":"p","attributes":{},"children":[{"block_type":"text","content":"Please share your thoughts on this book with others by leaving a review on the site that you bought it from. If you purchased the book from Amazon, please leave us an honest review on this book's Amazon page. This is vital so that other potential readers can see and use your unbiased opinion to make purchasing decisions, we can understand what our customers think about our products, and our authors can see your feedback on the title that they have worked with Packt to create. It will only take a few minutes of your time, but is valuable to other potential customers, our authors, and Packt. Thank you!"}]}]}]}